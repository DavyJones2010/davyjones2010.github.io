<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Coders@Work</title>
  
  
  <link href="https://davyjones2010.github.io/atom.xml" rel="self"/>
  
  <link href="https://davyjones2010.github.io/"/>
  <updated>2022-11-05T09:46:04.502Z</updated>
  <id>https://davyjones2010.github.io/</id>
  
  <author>
    <name>Davy Walker</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åä¸‡ä¸ªä¸ºä»€ä¹ˆ--ç”¨æ™¶ä½“ç®¡æ•°é‡è¡¡é‡èŠ¯ç‰‡çš„å…ˆè¿›æ€§åˆç†ä¹ˆ?</title>
    <link href="https://davyjones2010.github.io/2022-11-05-transistor-cnt-a-flawed-metric/"/>
    <id>https://davyjones2010.github.io/2022-11-05-transistor-cnt-a-flawed-metric/</id>
    <published>2022-11-05T02:55:04.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-Intro"><a href="#0x00-Intro" class="headerlink" title="0x00: Intro"></a>0x00: Intro</h1><p>æœ€è¿‘åœ¨çœ‹ <a href="https://zhuanlan.zhihu.com/p/479978458">The Basic Principles of Computers for Everyone</a> è¿™æœ¬ä¹¦, ä» </p><ul><li>ä¸éé—¨(NAND) å¼€å§‹, åŠ ä¸Šéé—¨, æ„å»ºä¸é—¨</li><li>4ä¸ªNANDæ„å»ºä¸€ä½å¸¦å¼€å…³çš„å­˜å‚¨å•å…ƒ(M); </li><li>8ä¸ªå­˜å‚¨å•å…ƒ(M)æ„å»º1Byteçš„å­˜å‚¨(B)</li><li>8ä¸ªä¸é—¨æ„å»ºä¸€ä¸ª8ä½çš„Enabler(E)</li><li>B+E æ„å»ºä¸€ä¸ª 8ä½ <strong>å¯„å­˜å™¨(R)</strong> + æ€»çº¿</li><li>8ä¸ªä¸é—¨+3ä¸ªéé—¨æ„å»ºä¸€ä¸ª <strong>3X8è¯‘ç å™¨(Decoder)</strong></li><li>1ä¸ª8ä½å¯„å­˜å™¨&amp;2ä¸ª4X16è¯‘ç å™¨(ç”¨äºå¯»å€) + 256ä¸ª1ä½å¯„å­˜å™¨(R)&amp;3ä¸ªä¸é—¨(ç”¨äºå­˜æ•°) æ„å»º 256ä½ çš„RAM</li></ul><p>ç­‰ç­‰, éå¸¸æ·±å…¥æµ…å‡º. åè¾¹ä¼šæŠŠè¯»ä¹¦ç¬”è®°è¡¥å……ä¸Šæ¥. </p><p>å¿ä¸ä½æ€ç»´è·³è·ƒäº†ä¸‹, æ„å»ºä¸€ä¸ª256ä½çš„RAMè‡³å°‘éœ€è¦((4*8+8) + (4+16) + (4+1)*256 + 3 &#x3D; 1343)ä¸ªé—¨(4ä¸ªMOSç®¡æ„å»ºå‡ºä¸€ä¸ªä¸éé—¨, ä½†å½“å‰ä¸»æµçš„éƒ½æ˜¯FinFET, åœºæ•ˆåº”æ™¶ä½“ç®¡). è™½ç„¶æ˜¯RAMçš„å®ç°, ä¸å®é™…CPUä¸ŠL1&#x2F;L2&#x2F;L3Cacheçš„å®ç°æ–¹å¼ä¸åŒ, ä½†ä¹Ÿèƒ½åŸºæœ¬è¯´æ˜ç‚¹å„¿é—®é¢˜, å°±æ˜¯æˆ‘ä»¬æ„å»ºCPU&#x2F;DRAMç­‰éƒ½éœ€è¦åºå¤§æ•°é‡çš„æ™¶ä½“ç®¡.</p><p>æƒ³èµ·è‹¹æœ2021å‘å¸ƒçš„M1 MaxèŠ¯ç‰‡, <a href="https://www.apple.com/hk/en/newsroom/2021/10/introducing-m1-pro-and-m1-max-the-most-powerful-chips-apple-has-ever-built/">æ™¶ä½“ç®¡æ•°é‡æ˜¯570äº¿, 57 billion transistors</a>, ä¾‹å¦‚è‡ªå·±åœ¨ç”¨çš„<code>Intel Xeon E5 2660 V3</code>, ä¹Ÿæœ‰2.6 billionä¸ªtransistors. è¿™ç§åºå¤§çš„æ•°å­—, æ€»æ˜¯è®©äººå¾ˆéœ‡æ’¼. ä¹Ÿæ— å¤–ä¹å‚å•†ä¼šç”¨è¿™ä¸ªæ•°å­—æ¥å¹å˜˜, æ¥ä½œä¸ºé‡è¦æŒ‡æ ‡, è¯´æ˜è‡ªå·±çš„CPU&#x2F;èŠ¯ç‰‡æœ‰å¤šå¤æ‚å¤šå…ˆè¿›. æ¯•ç«ŸèŠ¯ç‰‡é¢ç§¯æ€»å…±å°±é‚£ä¹ˆå¤§, 10å€æ™¶ä½“ç®¡æ•°é‡çš„æå‡, åŸºæœ¬å°±åªèƒ½æå‡å¯†åº¦äº†, ä¹Ÿå°±æ˜¯å¾—é å…ˆè¿›åˆ¶ç¨‹ç­‰. </p><p>ä½†æˆ‘ä»¬æŠ€æœ¯äººéƒ½è¦æœ‰æ‰¹åˆ¤æ€§æ€ç»´, ä»”ç»†å†æƒ³ä¸‹, CPUä¸­<a href="https://zhuanlan.zhihu.com/p/31422201">å‡ ä¹ä¸€åŠçš„é¢ç§¯éƒ½æ˜¯L3 Cache</a>, Cacheçš„ç”µè·¯è®¾è®¡å¹¶ä¸å¤æ‚, å› æ­¤éƒ½æ˜¯å…ˆè¿›åˆ¶ç¨‹å¸¦æ¥çš„çº¢åˆ©ä¹ˆ? æ™¶ä½“ç®¡æ•°é‡åºå¤§, çœŸçš„èƒ½è¯´æ˜æŠ€æœ¯NBä¹ˆ?</p><p>é‚æœç´¢äº†ä¸‹èµ„æ–™, å‘ç°æœç„¶æœ‰äººç ¸åœºå­çš„, <a href="https://www.realworldtech.com/transistor-count-flawed-metric/">Transistor Count: A Flawed Metric</a>, åœ¨æ ‡é¢˜é‡Œå°±æ˜ç¡®ä¹‹å¤„, <strong>æ™¶ä½“ç®¡æ•°é‡æ˜¯ä¸€ä¸ªæœ‰ç¼ºé™·çš„æŒ‡æ ‡</strong>. è¯¦ç»†é˜…è¯»äº†ä¹‹å, æˆ‘è¯•ç€æ€»ç»“ä¸‹ä½œè€…çš„å‡ ä¸ªç†ç”±.</p><h1 id="0x01-æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„"><a href="#0x01-æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„" class="headerlink" title="0x01: æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„!!"></a>0x01: æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„!!</h1><hr><p>å‚å•†ç»™å‡ºçš„æ™¶ä½“ç®¡æ•°é‡éƒ½æ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼. åŒæ ·çš„è®¾è®¡, æ™¶ä½“ç®¡æ•°é‡ä¼šæœ‰33%åˆ°37%çš„è¯¯å·®. ä¸ºå•¥å‘¢? æ‘˜å½• <a href="https://www.eet-china.com/news/202009071737.html">ä¸ºä»€ä¹ˆè¯´Intelçš„10nmå·¥è‰ºæ¯”åˆ«å®¶7nmæ›´å…ˆè¿›ï¼Ÿ</a> ä¸­çš„ç‰‡æ®µ:</p><blockquote><p>æ¯”è¾ƒå¤è€çš„ä¸€ç§è®¡é‡å¯†åº¦çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯ç”¨ CPPï¼ˆcontacted poly pitchï¼Œå³ gate pitchï¼Œæ …é—´è·ï¼‰å»ä¹˜ä»¥ metal pitch æœ€å°é‡‘å±é—´è·ã€‚<br>åˆ°äº† FinFET æ™¶ä½“ç®¡æ—¶æœŸï¼Œå¢åŠ  finï¼ˆé³ï¼‰é«˜åº¦ã€å‡å°‘ fin ä¹‹é—´çš„é—´è·å°±èƒ½æœ‰æ•ˆå¢åŠ é©±åŠ¨ç”µæµã€‚é©±åŠ¨ç”µæµä¸Šå»ä¹‹åï¼Œå°±å¯ä»¥å‡å°‘ fin çš„æ•°é‡â€”â€”ä¸€ä¸ªå•å…ƒå‡å°‘ fin çš„æ•°é‡ï¼Œä¹Ÿå°±å®ç°äº†é‡‘å± track çš„å‡å°‘ï¼Œå¯ä»¥é™ä½åŠ¨æ€åŠŸè€—ï¼Œä¸æ­¤åŒæ—¶ç¡®ä¿æ€§èƒ½ï¼Œç”šè‡³è¿˜èƒ½é€šè¿‡ä¸€äº›ä¼˜åŒ–æ‰‹æ³•æ¥æå‡é€Ÿåº¦ã€‚<br>åœ¨é‡‘å± track å‡å°‘ä¹‹åï¼Œä¼ ç»Ÿè®¡ç®—å¯†åº¦çš„æ–¹æ³•å…¶å®å°±ä¸æ€ä¹ˆå‡†ç¡®äº†ï¼Œå› ä¸ºå®ƒå…¶å®ä¸èƒ½åæ˜ å•å…ƒé«˜åº¦å‡å°‘è¿™æ ·çš„å®é™…ç»“æ„å˜åŒ–ã€‚æ‰€ä»¥åæ¥æœ‰æ–¹æ³•æ˜¯ CPP ä¹˜ä»¥ MMPï¼ˆæœ€å°é‡‘å±é—´è·ï¼‰ï¼Œå†ä¹˜ä»¥ Track æ•°ã€‚<br>ä½†æ›´å¤šçš„ç»“æ„ä¼˜åŒ–ï¼Œæ¯”å¦‚åæ–‡ä¼šæåˆ°çš„ COAG æŠ€æœ¯è¿›ä¸€æ­¥é™ä½äº†å•å…ƒé«˜åº¦ï¼ŒåŒæ—¶é‡‡ç”¨ dummy gate æ¥ç¼©å‡å•å…ƒçš„å®½åº¦ã€‚é‚£ä¹ˆåœ¨å•å…ƒå®½åº¦ã€é«˜åº¦åŒæ—¶é™ä½çš„æƒ…å†µä¸‹ï¼Œä¸Šé¢è¿™ç§è®¡ç®—æ–¹æ³•å°±åˆä¸å‡†ç¡®äº†ã€‚<br>æ‰€ä»¥å¦‚ä»Šçš„æ™¶ä½“ç®¡æ•°å­—ï¼Œæ›´å¤šçš„åº”å½“ä½œä¸ºä¸€ç§å‚è€ƒæ¥çœ‹ï¼Œæ¯•ç«Ÿæ™¶ä½“ç®¡å¹¶ä¸æ˜¯ä»¥å‡åŒ€çš„æ–¹å¼åˆ†å¸ƒåœ¨ die ä¸Šçš„ã€‚</p></blockquote><h1 id="0x02-ä¸åŒç±»å‹çš„èŠ¯ç‰‡-è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„-ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦"><a href="#0x02-ä¸åŒç±»å‹çš„èŠ¯ç‰‡-è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„-ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦" class="headerlink" title="0x02: ä¸åŒç±»å‹çš„èŠ¯ç‰‡, è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„, ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦"></a>0x02: ä¸åŒç±»å‹çš„èŠ¯ç‰‡, è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„, ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦</h1><hr><p>ä¾‹å¦‚</p><ul><li>ASCIèŠ¯ç‰‡, åªéœ€è¦è¾¾åˆ°ç›®æ ‡çš„ååé‡å³å¯, ä¸éœ€è¦è¿½æ±‚é«˜ä¸»é¢‘. ä¾‹å¦‚<code>Cisco Silicon One</code>, åªéœ€è¦è¾¾åˆ°ç›®æ ‡çš„400Gbpsä»¥å¤ªç½‘ååé‡å³å¯. å› æ­¤ASCIè®¾è®¡å›¢é˜Ÿæ›´å€¾å‘äº 1. ä½¿ç”¨è‡ªåŠ¨åŒ–è®¾è®¡å·¥å…· 2. æ›´å°‘çš„å®šåˆ¶ç”µè·¯ 3. æ›´é«˜å¯†åº¦æ™¶ä½“ç®¡(å•Finçš„FinFETæ™¶ä½“ç®¡). </li><li>æœåŠ¡å™¨èŠ¯ç‰‡è¿½æ±‚æ›´é«˜é¢‘ç‡, ä¾‹å¦‚<code>Xeon 8268</code>å’Œ<code>Xeon 8260</code>éƒ½æœ‰24 Core, ä½†8268çš„é¢‘ç‡æ˜¯2.9GHz, 8260æ˜¯2.4GHz, ä»·æ ¼ç›¸å·®äº†$1600. å› æ­¤æœåŠ¡å™¨èŠ¯ç‰‡è®¾è®¡æ›´å€¾å‘äº 1. æ›´å¤šçš„å®šåˆ¶ç”µè·¯ 2. æ›´å¤§çš„æ™¶ä½“ç®¡(2Fin, 3Finç”šè‡³æ›´å¤šFinçš„FinFETæ™¶ä½“ç®¡)<blockquote><p>TODO: FinFETä¸­Finæ•°é‡ä¸ä¸»é¢‘çš„å…³ç³»æ˜¯?</p></blockquote></li></ul><h1 id="0x03-èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ"><a href="#0x03-èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ" class="headerlink" title="0x03. èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ"></a>0x03. èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ</h1><hr><p><img data-src="https://plantegg.github.io/images/951413iMgBlog/4Z1nU.png"><br>å¦‚ä¸Šå›¾, å¤„ç†å™¨ç»„æˆéƒ¨åˆ†:</p><ol><li>CPU Cores, åŒ…å« cores, L1 Cache, L2 Cache</li><li>L3 Cache</li><li>System Interface</li><li>I&#x2F;O, åŒ…å« QPI, DIMM</li></ol><p>å¦‚ä¸‹ä¸¤ä¸ªå¤„ç†å™¨, éƒ½æ˜¯foræœåŠ¡å™¨åœºæ™¯:<br><img data-src="https://www.realworldtech.com/wp-content/uploads/2020/05/Table1.png?x97168" alt="Table 1. Transistor count and density for major regions for the Poulson and Tukwila generations of Itanium processors"></p><p>å¦‚ä¸Šå›¾, CPU ä¸åŒåŒºåŸŸ, å¯†åº¦å·®å¼‚èƒ½é«˜è¾¾20å€. ä¾‹å¦‚Poulsonçš„L3 Cacheå¯†åº¦æ˜¯13.33Mtr&#x2F;mm2, ä½†IOåŒºåŸŸå¯†åº¦æ˜¯0.65Mtr&#x2F;mm2</p><blockquote><p>Naturally, the cache region which primarily comprises ultra-dense SRAM is the densest and makes up most of the transistors in each design.<br>The I&#x2F;O is the least dense portion of the two designs, because it contains many delicate analog circuits such as PLLs and DLLs, digital filters, and the large, high-voltage I&#x2F;O transistors that are used to transmit and receive off-chip data.</p></blockquote><p>å¦‚æœåªè¿½æ±‚é«˜å¯†åº¦, åºå¤§æ•°é‡, ç›´æ¥å †L3Cacheå°±è¡Œäº†.</p><h1 id="0x04-å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡"><a href="#0x04-å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡" class="headerlink" title="0x04: å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡"></a>0x04: å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡</h1><hr><p>æ­£å¸¸å·¥ä½œçš„å«åšactive transistors, ä½†å®é™…ä¸Š, ç”Ÿäº§å‡ºæ¥çš„èŠ¯ç‰‡é‡Œè¿˜ä¼šåŒ…å«: </p><ol><li>dummy transistors: ä¸»è¦ç”¨æ¥æå‡è‰¯å“ç‡, ä½†æ•°é‡ä¸ç®—é‚£ä¹ˆåºå¤§.</li><li>decap transistors(decoupling capacitors): æ•°é‡å°±æ¯”è¾ƒå·¨å¤§äº†.</li></ol><blockquote><p>To ensure yield, the die must be relatively uniform and the whitespace cannot be truly empty. Many designs will fill the whitespace with decap cells to provide decoupling capacitance for power delivery and thereby improve operating frequency.</p></blockquote><p>å®é™…ä¸Šæ— æ•ˆæ™¶ä½“ç®¡æ•°é‡å åˆ°äº†20%~30%, ç”šè‡³æ›´å¤š.</p><blockquote><p>They found that in the small sampled regions that the active transistors were between 70-80% of the total, and the remaining 20-30% of layout transistors were decap and dummy devices.</p></blockquote><h1 id="0x05-æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾"><a href="#0x05-æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾" class="headerlink" title="0x05. æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾"></a>0x05. æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾</h1><hr><p>ä¾‹å¦‚ AMD Radeon VII æ¯” RX 5700å¤šäº†28%çš„transistors, ä½†æ˜¯ä¸¤è€…æ€§èƒ½å·®ä¸å¤š. éƒ¨åˆ†åŸå› æ˜¯RX 5700ä½¿ç”¨äº†æ›´åŠ å…ˆè¿›çš„æ¶æ„, è€Œä¸”RX 5700è¦ä¾¿å®œå¾ˆå¤š.</p><blockquote><p>When it comes to actual value to customers, itâ€™s not about the transistor count, but how the transistors are used.</p></blockquote><h1 id="0x06-æ€»ç»“"><a href="#0x06-æ€»ç»“" class="headerlink" title="0x06: æ€»ç»“"></a>0x06: æ€»ç»“</h1><p>æ‰€ä»¥, è¿™ä¸œè¥¿å°±è·Ÿå¨±ä¹å¤§å¸ˆè·‘åˆ†ä¸€æ ·, åªä½œä¸ºä¸€ä¸ªå‚è€ƒé¡¹, ä¸è¦ä½œä¸ºå”¯ä¸€æŒ‡æ ‡. ä¸èƒ½ä¸€å¶éšœç›®ä¸è§æ³°å±±.</p><p>æ›´é‡è¦çš„æ˜¯, æˆ‘ä»¬æŠ€æœ¯äºº, <strong>éœ€è¦ä¿æŒç‹¬ç«‹æ€è€ƒèƒ½åŠ›</strong>, çŸ¥å…¶ç„¶, ä¹Ÿè¦çŸ¥å…¶æ‰€ä»¥ç„¶, ä¸è¦è¢«å‚å•†å¿½æ‚ äº†. </p><h1 id="0xFF-å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®"><a href="#0xFF-å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®" class="headerlink" title="0xFF:å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®"></a>0xFF:å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®</h1><ol><li>L3 Cacheä¸ºå•¥ä¸èƒ½åšå¾—æ›´å¤§ä¸€äº›? ç›´æ¥æ›¿æ¢æ‰RAMä¸è¡Œä¹ˆ?</li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;0x00-Intro&quot;&gt;&lt;a href=&quot;#0x00-Intro&quot; class=&quot;headerlink&quot; title=&quot;0x00: Intro&quot;&gt;&lt;/a&gt;0x00: Intro&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨çœ‹ &lt;a href=&quot;https://zhuanlan.zhihu.com/p/479978458&quot;&gt;The Basic Principles of Computers for Everyone&lt;/a&gt; è¿™æœ¬ä¹¦, ä» &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸éé—¨(NAND) å¼€å§‹, åŠ ä¸Šéé—¨, æ„å»ºä¸é—¨&lt;/li&gt;
&lt;li&gt;4ä¸ªNANDæ„å»ºä¸€ä½å¸¦å¼€å…³çš„å­˜å‚¨å•å…ƒ(M); &lt;/li&gt;
&lt;li&gt;8ä¸ªå­˜å‚¨å•å…ƒ(M)æ„å»º1Byteçš„å­˜å‚¨(B)&lt;/li&gt;
&lt;li&gt;8ä¸ªä¸é—¨æ„å»ºä¸€ä¸ª8ä½çš„Enabler(E)&lt;/li&gt;
&lt;li&gt;B+E æ„å»ºä¸€ä¸ª 8ä½ &lt;strong&gt;å¯„å­˜å™¨(R)&lt;/strong&gt; + æ€»çº¿&lt;/li&gt;
&lt;li&gt;8ä¸ªä¸é—¨+3ä¸ªéé—¨æ„å»ºä¸€ä¸ª &lt;strong&gt;3X8è¯‘ç å™¨(Decoder)&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;1ä¸ª8ä½å¯„å­˜å™¨&amp;amp;2ä¸ª4X16è¯‘ç å™¨(ç”¨äºå¯»å€) + 256ä¸ª1ä½å¯„å­˜å™¨(R)&amp;amp;3ä¸ªä¸é—¨(ç”¨äºå­˜æ•°) æ„å»º 256ä½ çš„RAM&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç­‰ç­‰, éå¸¸æ·±å…¥æµ…å‡º. åè¾¹ä¼šæŠŠè¯»ä¹¦ç¬”è®°è¡¥å……ä¸Šæ¥. &lt;/p&gt;
&lt;p&gt;å¿ä¸ä½æ€ç»´è·³è·ƒäº†ä¸‹, æ„å»ºä¸€ä¸ª256ä½çš„RAMè‡³å°‘éœ€è¦((4*8+8) + (4+16) + (4+1)*256 + 3 &amp;#x3D; 1343)ä¸ªé—¨(4ä¸ªMOSç®¡æ„å»ºå‡ºä¸€ä¸ªä¸éé—¨, ä½†å½“å‰ä¸»æµçš„éƒ½æ˜¯FinFET, åœºæ•ˆåº”æ™¶ä½“ç®¡). è™½ç„¶æ˜¯RAMçš„å®ç°, ä¸å®é™…CPUä¸ŠL1&amp;#x2F;L2&amp;#x2F;L3Cacheçš„å®ç°æ–¹å¼ä¸åŒ, ä½†ä¹Ÿèƒ½åŸºæœ¬è¯´æ˜ç‚¹å„¿é—®é¢˜, å°±æ˜¯æˆ‘ä»¬æ„å»ºCPU&amp;#x2F;DRAMç­‰éƒ½éœ€è¦åºå¤§æ•°é‡çš„æ™¶ä½“ç®¡.&lt;/p&gt;
&lt;p&gt;æƒ³èµ·è‹¹æœ2021å‘å¸ƒçš„M1 MaxèŠ¯ç‰‡, &lt;a href=&quot;https://www.apple.com/hk/en/newsroom/2021/10/introducing-m1-pro-and-m1-max-the-most-powerful-chips-apple-has-ever-built/&quot;&gt;æ™¶ä½“ç®¡æ•°é‡æ˜¯570äº¿, 57 billion transistors&lt;/a&gt;, ä¾‹å¦‚è‡ªå·±åœ¨ç”¨çš„&lt;code&gt;Intel Xeon E5 2660 V3&lt;/code&gt;, ä¹Ÿæœ‰2.6 billionä¸ªtransistors. è¿™ç§åºå¤§çš„æ•°å­—, æ€»æ˜¯è®©äººå¾ˆéœ‡æ’¼. ä¹Ÿæ— å¤–ä¹å‚å•†ä¼šç”¨è¿™ä¸ªæ•°å­—æ¥å¹å˜˜, æ¥ä½œä¸ºé‡è¦æŒ‡æ ‡, è¯´æ˜è‡ªå·±çš„CPU&amp;#x2F;èŠ¯ç‰‡æœ‰å¤šå¤æ‚å¤šå…ˆè¿›. æ¯•ç«ŸèŠ¯ç‰‡é¢ç§¯æ€»å…±å°±é‚£ä¹ˆå¤§, 10å€æ™¶ä½“ç®¡æ•°é‡çš„æå‡, åŸºæœ¬å°±åªèƒ½æå‡å¯†åº¦äº†, ä¹Ÿå°±æ˜¯å¾—é å…ˆè¿›åˆ¶ç¨‹ç­‰. &lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä»¬æŠ€æœ¯äººéƒ½è¦æœ‰æ‰¹åˆ¤æ€§æ€ç»´, ä»”ç»†å†æƒ³ä¸‹, CPUä¸­&lt;a href=&quot;https://zhuanlan.zhihu.com/p/31422201&quot;&gt;å‡ ä¹ä¸€åŠçš„é¢ç§¯éƒ½æ˜¯L3 Cache&lt;/a&gt;, Cacheçš„ç”µè·¯è®¾è®¡å¹¶ä¸å¤æ‚, å› æ­¤éƒ½æ˜¯å…ˆè¿›åˆ¶ç¨‹å¸¦æ¥çš„çº¢åˆ©ä¹ˆ? æ™¶ä½“ç®¡æ•°é‡åºå¤§, çœŸçš„èƒ½è¯´æ˜æŠ€æœ¯NBä¹ˆ?&lt;/p&gt;
&lt;p&gt;é‚æœç´¢äº†ä¸‹èµ„æ–™, å‘ç°æœç„¶æœ‰äººç ¸åœºå­çš„, &lt;a href=&quot;https://www.realworldtech.com/transistor-count-flawed-metric/&quot;&gt;Transistor Count: A Flawed Metric&lt;/a&gt;, åœ¨æ ‡é¢˜é‡Œå°±æ˜ç¡®ä¹‹å¤„, &lt;strong&gt;æ™¶ä½“ç®¡æ•°é‡æ˜¯ä¸€ä¸ªæœ‰ç¼ºé™·çš„æŒ‡æ ‡&lt;/strong&gt;. è¯¦ç»†é˜…è¯»äº†ä¹‹å, æˆ‘è¯•ç€æ€»ç»“ä¸‹ä½œè€…çš„å‡ ä¸ªç†ç”±.&lt;/p&gt;
&lt;h1 id=&quot;0x01-æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„&quot;&gt;&lt;a href=&quot;#0x01-æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„&quot; class=&quot;headerlink&quot; title=&quot;0x01: æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„!!&quot;&gt;&lt;/a&gt;0x01: æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„!!&lt;/h1&gt;&lt;hr&gt;</summary>
    
    
    
    <category term="åä¸‡ä¸ªä¸ºä»€ä¹ˆ" scheme="https://davyjones2010.github.io/categories/%E5%8D%81%E4%B8%87%E4%B8%AA%E4%B8%BA%E4%BB%80%E4%B9%88/"/>
    
    
    <category term="semi-conductor" scheme="https://davyjones2010.github.io/tags/semi-conductor/"/>
    
    <category term="cpu" scheme="https://davyjones2010.github.io/tags/cpu/"/>
    
    <category term="hardware" scheme="https://davyjones2010.github.io/tags/hardware/"/>
    
    <category term="chip" scheme="https://davyjones2010.github.io/tags/chip/"/>
    
  </entry>
  
  <entry>
    <title>ç©è½¬minikube</title>
    <link href="https://davyjones2010.github.io/2022-11-02-k8s-play-with-minikube/"/>
    <id>https://davyjones2010.github.io/2022-11-02-k8s-play-with-minikube/</id>
    <published>2022-11-02T15:31:12.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><ul><li><p>ç™»å½•Node</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">minikube <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å¸¸ç”¨å‘½ä»¤&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨å‘½ä»¤&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨å‘½ä»¤&quot;&gt;&lt;/a&gt;å¸¸ç”¨å‘½ä»¤&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç™»å½•Node&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;minikube &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
</summary>
    
    
    
    
    <category term="k8s" scheme="https://davyjones2010.github.io/tags/k8s/"/>
    
    <category term="kubectl" scheme="https://davyjones2010.github.io/tags/kubectl/"/>
    
    <category term="minikube" scheme="https://davyjones2010.github.io/tags/minikube/"/>
    
  </entry>
  
  <entry>
    <title>K8séƒ¨ç½²ä½¿ç”¨é”™è¯¯æ’æŸ¥</title>
    <link href="https://davyjones2010.github.io/2022-11-01-k8s-trouble-shooting/"/>
    <id>https://davyjones2010.github.io/2022-11-01-k8s-trouble-shooting/</id>
    <published>2022-11-01T13:45:41.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ImagePullBackOff"><a href="#ImagePullBackOff" class="headerlink" title="ImagePullBackOff"></a>ImagePullBackOff</h1><h2 id="é”™è¯¯"><a href="#é”™è¯¯" class="headerlink" title="é”™è¯¯"></a>é”™è¯¯</h2><hr><p>åœ¨macä¸Šä½¿ç”¨minikube, åˆ›å»ºpodå‡ºç°å¦‚ä¸‹ ImagePullBackOff:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Normal   Pulling    8s               kubelet            Pulling image <span class="token string">"docker.io/nginx:1.23"</span>Warning  Failed     8s               kubelet            Failed to pull image <span class="token string">"docker.io/nginx:1.23"</span><span class="token builtin class-name">:</span> rpc error: code <span class="token operator">=</span> Unknown desc <span class="token operator">=</span> Error response from daemon: Get <span class="token string">"https://registry-1.docker.io/v2/"</span><span class="token builtin class-name">:</span> dial tcp: lookup registry-1.docker.io on <span class="token number">192.168</span>.64.1:53: server misbehavingWarning  Failed     8s               kubelet            Error: ErrImagePullNormal   BackOff    6s <span class="token punctuation">(</span>x2 over 7s<span class="token punctuation">)</span>  kubelet            Back-off pulling image <span class="token string">"docker.io/nginx:1.23"</span>Warning  Failed     6s <span class="token punctuation">(</span>x2 over 7s<span class="token punctuation">)</span>  kubelet            Error: ImagePullBackOff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><hr><p>å‚è§: <a href="https://github.com/docker/for-mac/issues/1317">è§£å†³æ–¹æ¡ˆ</a></p><ol><li><p>ç™»å½•minikubeçš„èŠ‚ç‚¹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ minikube <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨minikube nodeä¸Šæ‰‹åŠ¨ pull docker image, å¦‚ä¸‹, å‘ç°é—®é¢˜ä»ç„¶é‡ç°</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> pull docker.io/nginxUsing default tag: latestError response from daemon: Get <span class="token string">"https://registry-1.docker.io/v2/"</span><span class="token builtin class-name">:</span> dial tcp: lookup registry-1.docker.io on <span class="token number">192.168</span>.64.1:53: server misbehaving<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>ä¿®æ”¹minikube nodeä¸Šçš„resolv.confæ–‡ä»¶çš„nameserver:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/resolv.confnameserver <span class="token number">8.8</span>.8.8search <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>é‡æ–°å°è¯•æ‰‹åŠ¨pull image, å‘ç°é—®é¢˜è§£å†³:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> pull docker.io/nginx:1.23<span class="token number">1.23</span>: Pulling from library/nginxDigest: sha256:943c25b4b66b332184d5ba6bb18234273551593016c0e0ae906bab111548239fStatus: Downloaded newer image <span class="token keyword">for</span> nginx:1.23docker.io/library/nginx:1.23<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é€€å‡ºnode, åœ¨Macä¸Šé‡æ–°æ£€æŸ¥podçŠ¶æ€, é—®é¢˜è§£å†³ğŸ‰ğŸ‰ğŸ‰:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalkerdeMacBook-Pro:~ davywalker$ k get poNAME                              READY   STATUS    RESTARTS   AGEhello-minikube-67b8c7bdfd-965qn   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          87s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ä¸ºå•¥å«â€ImagePullBackOffâ€"><a href="#ä¸ºå•¥å«â€ImagePullBackOffâ€" class="headerlink" title="ä¸ºå•¥å«â€ImagePullBackOffâ€??"></a>ä¸ºå•¥å«â€ImagePullBackOffâ€??</h2><hr><p>å‚è§æ–‡ç«  <a href="https://www.tutorialworks.com/kubernetes-imagepullbackoff/">Kubernetes ImagePullBackOff error: what you need to know</a> è¯´æ˜.</p><blockquote><p>The status ImagePullBackOff means that a Pod couldnâ€™t start,<br>because Kubernetes couldnâ€™t pull a container image.<br>The â€˜BackOffâ€™ part means that Kubernetes will keep trying to pull the image,<br>with an increasing delay (â€˜back-offâ€™).</p></blockquote><p>è¿™é‡Œçš„â€BackOffâ€å°±æ˜¯â€é€€é¿â€çš„æ„æ€, å½“æ‹‰å–å¤±è´¥æ—¶, kubeletåº”è¯¥æœ‰ä¸ªé€€é¿ç®—æ³•æ¥é‡è¯•æ‹‰å–. å…·ä½“é€€é¿ç®—æ³•æ˜¯å•¥, æœ‰å¾…åç»­é’»ç ”. ğŸ¤”</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ImagePullBackOff&quot;&gt;&lt;a href=&quot;#ImagePullBackOff&quot; class=&quot;headerlink&quot; title=&quot;ImagePullBackOff&quot;&gt;&lt;/a&gt;ImagePullBackOff&lt;/h1&gt;&lt;h2 id=&quot;é”™è¯¯&quot;&gt;&lt;a href=&quot;#é”™è¯¯&quot; class=&quot;headerlink&quot; title=&quot;é”™è¯¯&quot;&gt;&lt;/a&gt;é”™è¯¯&lt;/h2&gt;&lt;hr&gt;
&lt;p&gt;åœ¨macä¸Šä½¿ç”¨minikube, åˆ›å»ºpodå‡ºç°å¦‚ä¸‹ ImagePullBackOff:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;Normal   Pulling    8s               kubelet            Pulling image &lt;span class=&quot;token string&quot;&gt;&quot;docker.io/nginx:1.23&quot;&lt;/span&gt;
Warning  Failed     8s               kubelet            Failed to pull image &lt;span class=&quot;token string&quot;&gt;&quot;docker.io/nginx:1.23&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; rpc error: code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Unknown desc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Error response from daemon: Get &lt;span class=&quot;token string&quot;&gt;&quot;https://registry-1.docker.io/v2/&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; dial tcp: lookup registry-1.docker.io on &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.64.1:53: server misbehaving
Warning  Failed     8s               kubelet            Error: ErrImagePull
Normal   BackOff    6s &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x2 over 7s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  kubelet            Back-off pulling image &lt;span class=&quot;token string&quot;&gt;&quot;docker.io/nginx:1.23&quot;&lt;/span&gt;
Warning  Failed     6s &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x2 over 7s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  kubelet            Error: ImagePullBackOff&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;è§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#è§£å†³æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;&lt;hr&gt;
&lt;p&gt;å‚è§: &lt;a href=&quot;https://github.com/docker/for-mac/issues/1317&quot;&gt;è§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;ç™»å½•minikubeçš„èŠ‚ç‚¹&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ minikube &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;åœ¨minikube nodeä¸Šæ‰‹åŠ¨ pull docker image, å¦‚ä¸‹, å‘ç°é—®é¢˜ä»ç„¶é‡ç°&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; pull docker.io/nginx
Using default tag: latest
Error response from daemon: Get &lt;span class=&quot;token string&quot;&gt;&quot;https://registry-1.docker.io/v2/&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; dial tcp: lookup registry-1.docker.io on &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.64.1:53: server misbehaving&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¿®æ”¹minikube nodeä¸Šçš„resolv.confæ–‡ä»¶çš„nameserver:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;vi&lt;/span&gt; /etc/resolv.conf
nameserver &lt;span class=&quot;token number&quot;&gt;8.8&lt;/span&gt;.8.8
search &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é‡æ–°å°è¯•æ‰‹åŠ¨pull image, å‘ç°é—®é¢˜è§£å†³:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; pull docker.io/nginx:1.23
&lt;span class=&quot;token number&quot;&gt;1.23&lt;/span&gt;: Pulling from library/nginx
Digest: sha256:943c25b4b66b332184d5ba6bb18234273551593016c0e0ae906bab111548239f
Status: Downloaded newer image &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; nginx:1.23
docker.io/library/nginx:1.23&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é€€å‡ºnode, åœ¨Macä¸Šé‡æ–°æ£€æŸ¥podçŠ¶æ€, é—®é¢˜è§£å†³ğŸ‰ğŸ‰ğŸ‰:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;davywalkerdeMacBook-Pro:~ davywalker$ k get po
NAME                              READY   STATUS    RESTARTS   AGE
hello-minikube-67b8c7bdfd-965qn   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          87s&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;ä¸ºå•¥å«â€ImagePullBackOffâ€&quot;&gt;&lt;a href=&quot;#ä¸ºå•¥å«â€ImagePullBackOffâ€&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºå•¥å«â€ImagePullBackOffâ€??&quot;&gt;&lt;/a&gt;ä¸ºå•¥å«â€ImagePullBackOffâ€??&lt;/h2&gt;</summary>
    
    
    
    
    <category term="k8s" scheme="https://davyjones2010.github.io/tags/k8s/"/>
    
    <category term="kubectl" scheme="https://davyjones2010.github.io/tags/kubectl/"/>
    
    <category term="trouble-shooting" scheme="https://davyjones2010.github.io/tags/trouble-shooting/"/>
    
  </entry>
  
  <entry>
    <title>åä¸‡ä¸ªä¸ºä»€ä¹ˆä¹‹--ä¸ºä»€ä¹ˆç£ç›˜éœ€è¦åˆ†åŒºä¸æŒ‚è½½?</title>
    <link href="https://davyjones2010.github.io/2022-08-30-disk-partition/"/>
    <id>https://davyjones2010.github.io/2022-08-30-disk-partition/</id>
    <published>2022-08-30T03:41:13.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ç»å¸¸ä¼šæœ‰ä¸ªç–‘é—®</p><ul><li>ä¸ºä»€ä¹ˆç£ç›˜éœ€è¦è¿›è¡Œåˆ†åŒº, ä¸åˆ†åŒºç›´æ¥æŒ‰ç…§æ–‡ä»¶å¤¹åˆ’åˆ†æœ‰å•¥é—®é¢˜? è¿™ä¸ªåœ¨Windowsä¸‹å°¤å…¶æœ‰ç–‘é—®.</li><li>ä¸ºå•¥éœ€è¦æŒ‚è½½? ç›´æ¥æ’å…¥è®¾å¤‡, ä¸ºå•¥ä¸èƒ½åƒWindowsä¸‹Uç›˜ä¸€æ ·ç›´æ¥çƒ­æ’æ‹”? Linuxä¸‹ä¸ºå•¥è¿˜éœ€è¦æ‰‹åŠ¨æŒ‚è½½ä¸‹?</li></ul><h1 id="ä¸ºå•¥éœ€è¦åˆ†åŒº"><a href="#ä¸ºå•¥éœ€è¦åˆ†åŒº" class="headerlink" title="ä¸ºå•¥éœ€è¦åˆ†åŒº?"></a>ä¸ºå•¥éœ€è¦åˆ†åŒº?</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹ æƒ¯äº†ä½¿ç”¨Linux&#x2F;Macä¹‹å, å®Œå…¨æ²¡æœ‰åˆ†åŒºçš„æ¦‚å¿µäº†.</p><ul><li>Linux&#x2F;Ubuntuè£…æœºæ­¥éª¤:<ul><li>ä¸€æ•´å—ç£ç›˜, é€‰å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹, è¿›è¡Œæ ¼å¼åŒ–.</li><li>ç›´æ¥åœ¨ç£ç›˜ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿ, å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†.</li></ul></li><li>Macç”šè‡³æ— éœ€è£…æœº, å¼€æœºç›´æ¥ä½¿ç”¨.</li></ul><p>å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­, ä¸åˆ†åŒºæœ‰å¦‚ä¸‹ä¼˜åŠ¿:</p><ul><li>è½¯ä»¶å®‰è£…: æ— éœ€å…³æ³¨éœ€è¦æŠŠè½¯ä»¶å®‰è£…åœ¨å“ªä¸ªç›˜(Cç›˜&#x2F;Dç›˜&#x2F;Eç›˜â€¦), é€šå¸¸åªéœ€è¦é»˜è®¤è·¯å¾„å°±å¥½;</li><li>æ–‡ä»¶ä¸‹è½½å­˜å‚¨: æ— éœ€å…³æ³¨æ–‡ä»¶è¦ä¿å­˜åœ¨å“ªä¸ªç›˜, åªéœ€è¦å…³æ³¨ä¿å­˜åœ¨å“ªä¸ªç›®å½•å³å¯.</li></ul><blockquote><p>å› æ­¤å®Œå…¨ä¸ç”¨æ‹…å¿ƒåˆ°åº•åˆ†å‡ ä¸ªåŒº, æ¯ä¸ªåˆ†åŒºå¤§å°å¤šå°‘, Cç›˜æ»¡äº†å¦‚ä½•æ‰©å®¹ä¹‹ç±»çš„é—®é¢˜.</p></blockquote><p>å› æ­¤, åœ¨æ”’äº†å°Windowsæœºå™¨ä¹‹å, çŠ¹è±«è¦ä¸è¦åˆ†å¤šä¸ªåŒº. åæ¥äº‹å®æ•™ä¼šäº†æˆ‘æ€ä¹ˆåšäºº.</p><blockquote><p>Win10å¾ˆæ— èŠ‚æ“åœ°ä¼šåœ¨Cç›˜é¢„ç•™30GB+çš„ç©ºé—´, è¿˜è¦æ”¾è™šæ‹Ÿå†…å­˜æ–‡ä»¶ç­‰, å¯¼è‡´å¯æ€œçš„Cç›˜ç«‹åˆ»å­˜å‚¨æŠ¥è­¦.</p></blockquote><h2 id="ä¸ªäººå®è·µç†è§£"><a href="#ä¸ªäººå®è·µç†è§£" class="headerlink" title="ä¸ªäººå®è·µç†è§£"></a>ä¸ªäººå®è·µç†è§£</h2><p>ä¸ªäººä½¿ç”¨ä¸‹æ¥, å”¯ä¸€çš„ç†ç”±å°±æ˜¯: <strong>åˆ†åŒºéš”ç¦», æ–¹ä¾¿æ— æŸé‡è£…ç³»ç»Ÿ.</strong></p><p>Mac&#x2F;Linuxä¸Š, å‡ ä¹æ— éœ€ä¹Ÿæ²¡æœ‰é‡è£…è¿‡ç³»ç»Ÿ. ä½†<strong>åœ¨Windowsä¸‹, é‡è£…ç³»ç»Ÿç®€ç›´æ˜¯å¸¸æ€</strong>. </p><blockquote><p>åƒåœ¾(ç—…æ¯’)è½¯ä»¶å¤ªå¤š, è¿æ‰€è°“çš„çº¯å‡€é•œåƒä¹Ÿæ ¹æœ¬ä¸çº¯å‡€.</p></blockquote><ul><li>éƒ½æƒ³å¾€æ³¨å†Œè¡¨é‡Œå·å·å¡ä¸œè¥¿. æ¸…ç†æ³¨å†Œè¡¨, ä¸€ä¸å°å¿ƒå°±ä¼šæŠŠç³»ç»Ÿæ¸…ç†è“å±.</li><li>æˆ–è€…æœ‰ç—…æ¯’, ç›´æ¥ç³»ç»Ÿå´©æºƒ.</li></ul><blockquote><p>è§£å†³æ–¹æ¡ˆ</p></blockquote><ul><li>è¦ä¹ˆé€šè¿‡PEè¿›å…¥ç³»ç»Ÿ, æ‰¾åˆ°é—®é¢˜ç‚¹, è¿›è¡Œä¿®å¤. </li><li>è¦ä¹ˆç›´æ¥é‡è£…ç³»ç»Ÿ. </li><li>æ‰¾åˆ°é—®é¢˜ç‚¹å¤ªéº»çƒ¦, æ‰€ä»¥è¿˜æ˜¯æ— è„‘ä¸€é”®é‡è£…å§.</li></ul><p>ä½†é‡è£…ç³»ç»Ÿ, å°±éœ€è¦æŠŠåˆ†åŒºé‡æ–°æ ¼å¼åŒ–. æƒ³æƒ³å§, è¾›è‹¦å®‰è£…çš„è½¯ä»¶, è®¾å®šçš„é…ç½®, ä¿å­˜çš„æ–‡ä»¶, éƒ½ä¼šéšç€æ ¼å¼åŒ–è¢«å®Œå…¨æŠ¹é™¤!<br>æ‰€ä»¥è¿˜æ˜¯åˆ†åŒºå§, åªæ ¼å¼åŒ–Cç›˜å°±å¥½. è½¯ä»¶å•Š, æ–‡ä»¶å•Š, é…ç½®å•Š, éƒ½æ”¾åˆ°å…¶ä»–ç›˜é‡Œå¥½äº†.</p><h2 id="å…¶ä»–ä¸“ä¸šç†ç”±"><a href="#å…¶ä»–ä¸“ä¸šç†ç”±" class="headerlink" title="å…¶ä»–ä¸“ä¸šç†ç”±"></a>å…¶ä»–ä¸“ä¸šç†ç”±</h2><p>å‚ç…§çŸ¥ä¹ <a href="https://www.zhihu.com/question/47538075/answer/107737383">å…¶å®windowsåˆ†åŒºæ˜¯ä¸æ˜¯åˆ†Cç›˜å’ŒDç›˜å°±å¥½äº†ï¼Ÿ</a> å›ç­”.</p><ul><li>ç—…æ¯’æ³›æ»¥, ä¼šæŠŠç³»ç»ŸæCrash, éœ€è¦é¢‘ç¹é‡è£…ç³»ç»Ÿ.</li><li>æ—©æœŸçš„FAT16&#x2F;32æ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„å•ä¸ªåˆ†åŒºå®¹é‡æœ‰é™. FAT32æœ€å¤§æ–‡ä»¶ç³»ç»Ÿæ€»å®¹é‡ 128GB, åœ¨ç°åœ¨éšä¾¿ä¸€ä¸ªç¡¬ç›˜å°±æ˜¯1TB+, æ— æ³•å……åˆ†åˆ©ç”¨ç£ç›˜ç©ºé—´.</li><li>xpä¹‹å‰çš„windowsç³»åˆ—æ“ä½œç³»ç»Ÿæœ¬èº«ç¨³å®šæ€§å ªå¿§ï¼Œå¾ˆå®¹æ˜“å› ä¸ºç”¨æˆ·æ“ä½œã€è½¯ä»¶æ•…éšœå´©æºƒç”šè‡³ç ´åã€‚å°¤å…¶æ˜¯ç»å¸¸æŠ˜è…¾çš„æ¡Œé¢ç³»ç»Ÿã€‚è¿™å°±å¯¼è‡´ç”¨æˆ·ä¸å¾—ä¸é¢‘ç¹é‡è£…ç³»ç»Ÿã€‚</li><li>æ“ä½œç³»ç»Ÿæƒé™&amp;è½¯ä»¶å…¼å®¹é—®é¢˜: ç°åœ¨win10ç®¡ç†å‘˜æƒé™å°äº†ï¼ŒæŸäº›è½¯ä»¶è£…åœ¨Cç›˜ä¼šæœ‰æƒé™é—®é¢˜ï¼Œæ¯”å¦‚notepad++è£…åœ¨Cç›˜ï¼Œç›´æ¥è¿è¡Œçš„è¯æ˜¯ä¸èƒ½ä¿å­˜è‡ªå®šä¹‰é…ç½®çš„</li></ul><blockquote><p>æ‰€ä»¥åœ¨Windowsä¸‹, è¿˜æ˜¯è€è€å®å®åˆ†åŒºå§! å½“ç„¶åœ¨ä¸¥è‚ƒçš„ä¼ä¸šåœºæ™¯, ä¹Ÿæ¨èæŒ‰ç…§ç³»ç»Ÿç›˜ä¸æ•°æ®ç›˜è¿›è¡Œä¸‹åŒºåˆ†.</p></blockquote><h1 id="ä¸ºå•¥éœ€è¦æŒ‚è½½"><a href="#ä¸ºå•¥éœ€è¦æŒ‚è½½" class="headerlink" title="ä¸ºå•¥éœ€è¦æŒ‚è½½?"></a>ä¸ºå•¥éœ€è¦æŒ‚è½½?</h1><h1 id="ç£ç›˜-amp-æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†"><a href="#ç£ç›˜-amp-æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†" class="headerlink" title="ç£ç›˜&amp;æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†"></a>ç£ç›˜&amp;æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†</h1><h2 id="ç£ç›˜-åˆ†åŒº-æ–‡ä»¶ç³»ç»Ÿ-å…³ç³»"><a href="#ç£ç›˜-åˆ†åŒº-æ–‡ä»¶ç³»ç»Ÿ-å…³ç³»" class="headerlink" title="ç£ç›˜, åˆ†åŒº, æ–‡ä»¶ç³»ç»Ÿ å…³ç³»"></a>ç£ç›˜, åˆ†åŒº, æ–‡ä»¶ç³»ç»Ÿ å…³ç³»</h2><p>å¦‚ä¸‹: </p><pre class="mermaid">erDiagram    DiskDevice ||--|{ Partition : contain    Partition ||--|| FileSystem : format</pre><h3 id="ç£ç›˜-x2F-å—è®¾å¤‡-gt-åˆ†åŒº"><a href="#ç£ç›˜-x2F-å—è®¾å¤‡-gt-åˆ†åŒº" class="headerlink" title="ç£ç›˜&#x2F;å—è®¾å¤‡ -&gt; åˆ†åŒº"></a>ç£ç›˜&#x2F;å—è®¾å¤‡ -&gt; åˆ†åŒº</h3><p>ä¸€ä¸ªç£ç›˜è®¾å¤‡(HDD, SSD, Uç›˜ç­‰), å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒº. åˆ†åŒºæ–¹å¼æœ‰MBR, GPTä¸¤ç§.<br>é‚£ä¹ˆç£ç›˜åˆ†åŒºçš„å…ƒä¿¡æ¯å†™åœ¨å“ªé‡Œ? </p><ul><li>æ˜¯å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¹ˆ? æ­¤æ—¶ç£ç›˜è¿˜æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿ, æ‰€ä»¥åº”è¯¥ä¸æ˜¯ä»¥æ–‡ä»¶å½¢å¼ä¿å­˜, æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå°±æ— æ³•ç›´æ¥åœ¨æ“ä½œç³»ç»Ÿé‡Œæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶å¹¶æ“ä½œ.</li><li>æ˜¯å­˜å‚¨åœ¨è£¸è®¾å¤‡çš„å›ºå®šä½ç½®(å®ƒåœ¨ç¡¬ç›˜ä¸Šçš„ä¸‰ç»´åœ°å€ä¸ºï¼ˆæŸ±é¢ï¼Œç£å¤´ï¼Œæ‰‡åŒºï¼‰ï¼ï¼ˆ0ï¼Œ0ï¼Œ1ï¼‰ã€‚)</li><li>é€šè¿‡ <code>lsblk</code> å‘½ä»¤æŸ¥çœ‹å·²ç»æŒ‚è½½çš„å—è®¾å¤‡<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@662fd3213ce8:/data<span class="token comment"># lsblk</span>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTvda    <span class="token number">254</span>:0    <span class="token number">0</span> <span class="token number">59</span>.6G  <span class="token number">0</span> disk`-vda1 <span class="token number">254</span>:1    <span class="token number">0</span> <span class="token number">59</span>.6G  <span class="token number">0</span> part /etc/hosts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="åˆ†åŒº-gt-æ–‡ä»¶ç³»ç»Ÿ"><a href="#åˆ†åŒº-gt-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="åˆ†åŒº -&gt; æ–‡ä»¶ç³»ç»Ÿ"></a>åˆ†åŒº -&gt; æ–‡ä»¶ç³»ç»Ÿ</h3><p>ä¸€ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ. å› æ­¤åŒä¸€ä¸ªç£ç›˜è®¾å¤‡çš„å¤šä¸ªåˆ†åŒº, å„ä¸ªåˆ†åŒºéƒ½å¯ä»¥æ ¼å¼åŒ–æˆä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹.</p><ul><li>é€šè¿‡ <code>df -h</code> å‘½ä»¤æŸ¥çœ‹åˆ†åŒº<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@662fd3213ce8:/data<span class="token comment"># df -h</span>Filesystem      Size  Used Avail Use% Mounted onoverlay          59G  <span class="token number">2</span>.7G   53G   <span class="token number">5</span>% /tmpfs            64M     <span class="token number">0</span>   64M   <span class="token number">0</span>% /devshm              64M     <span class="token number">0</span>   64M   <span class="token number">0</span>% /dev/shm/dev/vda1        59G  <span class="token number">2</span>.7G   53G   <span class="token number">5</span>% /datatmpfs           <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G   <span class="token number">0</span>% /proc/acpitmpfs           <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G   <span class="token number">0</span>% /sys/firmware<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®"><a href="#æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®"></a>æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®</h3><div class="note warning"><p>TODO: æš‚æ—¶è¿˜æ²¡æœç´¢åˆ°ç›¸å…³ä¿¡æ¯.</p></div><h3 id="æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•-amp-æ–‡ä»¶å…ƒæ•°æ®"><a href="#æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•-amp-æ–‡ä»¶å…ƒæ•°æ®" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•&amp;æ–‡ä»¶å…ƒæ•°æ®:"></a>æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•&amp;æ–‡ä»¶å…ƒæ•°æ®:</h3><ul><li>ä¾‹å¦‚ext4, ä»¥inodeå½¢å¼ä¿å­˜. åŒ…æ‹¬æ–‡ä»¶å¤§å°, æƒé™ä¿¡æ¯, gmtCreated, gmtModified, åŒ…å«çš„blockæ•°é‡, å­˜å‚¨åœ¨ç£ç›˜çš„ä½ç½®(æŸ±é¢) ç­‰</li><li>å¯ä»¥ä½¿ç”¨ stat å‘½ä»¤æŸ¥çœ‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@662fd3213ce8:/data<span class="token comment"># stat dump.rdb</span>  File: dump.rdb  Size: <span class="token number">105</span>       Blocks: <span class="token number">8</span>          IO Block: <span class="token number">4096</span>   regular <span class="token function">file</span>Device: fe01h/65025dInode: <span class="token number">1055693</span>     Links: <span class="token number">1</span>Access: <span class="token punctuation">(</span>0600/-rw-------<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span>  <span class="token number">999</span>/   redis<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span>  <span class="token number">999</span>/   redis<span class="token punctuation">)</span>Access: <span class="token number">2022</span>-10-12 <span class="token number">16</span>:01:07.043330092 +0000Modify: <span class="token number">2022</span>-06-26 <span class="token number">10</span>:16:40.880774990 +0000Change: <span class="token number">2022</span>-06-26 <span class="token number">10</span>:16:40.896774990 +0000 Birth: <span class="token number">2022</span>-06-26 <span class="token number">10</span>:16:40.869774990 +0000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="note warning"><p>TODO: åˆ†æä¸‹statçš„å…·ä½“ä¿¡æ¯å«ä¹‰, å°¤å…¶æ˜¯ Device ç›¸å…³çš„, æ˜¯ä¸æ˜¯æ“ä½œç³»ç»Ÿç›´æ¥å°±æŒ‰ç…§è¿™ä¸ªä¿¡æ¯å»å¯»æ‰¾åˆ°æ–‡ä»¶çš„æŸ±é¢èŒƒå›´äº†?</p></div><h3 id="åˆ†åŒºåç§°è§„èŒƒ"><a href="#åˆ†åŒºåç§°è§„èŒƒ" class="headerlink" title="åˆ†åŒºåç§°è§„èŒƒ"></a>åˆ†åŒºåç§°è§„èŒƒ</h3><ul><li>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œç¡¬ç›˜åˆ†åŒºå‘½åä¸ºsda1ï¼sda4æˆ–è€…hda1ï¼hda4</li></ul><div class="note warning"><p>TODO: è‡ªå·±æ‰¾ä¸ªUç›˜è¯•ä¸‹åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒº, æ¯ä¸ªåˆ†åŒºä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹?</p></div><h2 id="ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨"><a href="#ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨" class="headerlink" title="ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨?"></a>ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨?</h2>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;ç»å¸¸ä¼šæœ‰ä¸ªç–‘é—®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆç£ç›˜éœ€è¦è¿›è¡Œåˆ†åŒº, ä¸åˆ†åŒºç›´æ¥æŒ‰ç…§æ–‡ä»¶å¤¹åˆ’åˆ†æœ‰å•¥é—®é¢˜? è¿™ä¸ªåœ¨Windowsä¸‹å°¤å…¶æœ‰ç–‘é—®.&lt;/li&gt;
&lt;li&gt;ä¸ºå•¥éœ€è¦æŒ‚è½½? ç›´æ¥æ’å…¥è®¾å¤‡, ä¸ºå•¥ä¸èƒ½åƒWindowsä¸‹Uç›˜ä¸€æ ·ç›´æ¥çƒ­æ’æ‹”? Linuxä¸‹ä¸ºå•¥è¿˜éœ€è¦æ‰‹åŠ¨æŒ‚è½½ä¸‹?&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;ä¸ºå•¥éœ€è¦åˆ†åŒº&quot;&gt;&lt;a href=&quot;#ä¸ºå•¥éœ€è¦åˆ†åŒº&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºå•¥éœ€è¦åˆ†åŒº?&quot;&gt;&lt;/a&gt;ä¸ºå•¥éœ€è¦åˆ†åŒº?&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹ æƒ¯äº†ä½¿ç”¨Linux&amp;#x2F;Macä¹‹å, å®Œå…¨æ²¡æœ‰åˆ†åŒºçš„æ¦‚å¿µäº†.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linux&amp;#x2F;Ubuntuè£…æœºæ­¥éª¤:&lt;ul&gt;
&lt;li&gt;ä¸€æ•´å—ç£ç›˜, é€‰å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹, è¿›è¡Œæ ¼å¼åŒ–.&lt;/li&gt;
&lt;li&gt;ç›´æ¥åœ¨ç£ç›˜ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿ, å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Macç”šè‡³æ— éœ€è£…æœº, å¼€æœºç›´æ¥ä½¿ç”¨.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­, ä¸åˆ†åŒºæœ‰å¦‚ä¸‹ä¼˜åŠ¿:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è½¯ä»¶å®‰è£…: æ— éœ€å…³æ³¨éœ€è¦æŠŠè½¯ä»¶å®‰è£…åœ¨å“ªä¸ªç›˜(Cç›˜&amp;#x2F;Dç›˜&amp;#x2F;Eç›˜â€¦), é€šå¸¸åªéœ€è¦é»˜è®¤è·¯å¾„å°±å¥½;&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶ä¸‹è½½å­˜å‚¨: æ— éœ€å…³æ³¨æ–‡ä»¶è¦ä¿å­˜åœ¨å“ªä¸ªç›˜, åªéœ€è¦å…³æ³¨ä¿å­˜åœ¨å“ªä¸ªç›®å½•å³å¯.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å› æ­¤å®Œå…¨ä¸ç”¨æ‹…å¿ƒåˆ°åº•åˆ†å‡ ä¸ªåŒº, æ¯ä¸ªåˆ†åŒºå¤§å°å¤šå°‘, Cç›˜æ»¡äº†å¦‚ä½•æ‰©å®¹ä¹‹ç±»çš„é—®é¢˜.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="åä¸‡ä¸ªä¸ºä»€ä¹ˆ" scheme="https://davyjones2010.github.io/categories/%E5%8D%81%E4%B8%87%E4%B8%AA%E4%B8%BA%E4%BB%80%E4%B9%88/"/>
    
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="disk" scheme="https://davyjones2010.github.io/tags/disk/"/>
    
    <category term="os" scheme="https://davyjones2010.github.io/tags/os/"/>
    
  </entry>
  
  <entry>
    <title>çæŠ˜è…¾æ´‹åƒåœ¾ç”µè„‘ç¬”è®°</title>
    <link href="https://davyjones2010.github.io/2022-08-13-computer-diy/"/>
    <id>https://davyjones2010.github.io/2022-08-13-computer-diy/</id>
    <published>2022-08-13T13:39:48.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<p>åƒåœ¾ä½¬çš„å‘¨æœ«, æ²¡äº‹å„¿å°±æ˜¯çæŠ˜è…¾, è‡ªä»åœ¨Bç«™è¢«ç§è‰äº†æ´‹åƒåœ¾, æŒ‰è€ä¸ä½å¿ƒä¸­çš„å†²åŠ¨, å†³å®šä¹Ÿç”¨æ´‹åƒåœ¾ç»„è£…ä¸€å°èƒ½æ•°æ¡†æ¡†çš„ç”µè„‘, ç©ç©å„¿æ¸¸æˆ, å‹æ¦¨å‹æ¦¨æ€§èƒ½.</p><h1 id="ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾"><a href="#ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾" class="headerlink" title="ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾"></a>ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾</h1><ul><li>ä¸€: ç©·, </li><li>äºŒ: ç©,</li></ul><h1 id="é…ç½®æ¸…å•"><a href="#é…ç½®æ¸…å•" class="headerlink" title="é…ç½®æ¸…å•"></a>é…ç½®æ¸…å•</h1><blockquote><p>å‡ ä¹éƒ½æ˜¯ä»æµ·é²œå¸‚åœºæ·˜æ¥çš„</p><ul><li>ä¼˜ç‚¹æ˜¯ä¾¿å®œ, æ€§ä»·æ¯”é«˜; </li><li>ç¼ºç‚¹æ˜¯ç”µæ°”ç‰¹æ€§è¡°å‡ä¸æ˜ç¡®, é•¿æœŸç¨³å®šæ€§æ²¡æœ‰ä¿éšœ.</li></ul></blockquote><p>ä½†å¯¹äºå¶å°”ç©ä¸€ç©æ¸¸æˆ, ä¸æ˜¯é•¿æœŸé«˜è´Ÿè·è·‘æ¸²æŸ“ç­‰, æ•´ä½“è¿˜OK. ç›®æ ‡æ˜¯<strong>1000å…ƒ</strong>å·¦å³æå®š.</p><h2 id="è¯¦ç»†æ¸…å•"><a href="#è¯¦ç»†æ¸…å•" class="headerlink" title="è¯¦ç»†æ¸…å•"></a>è¯¦ç»†æ¸…å•</h2><table><thead><tr><th>é…ä»¶åç§°</th><th>å“ç‰Œ</th><th>æ•°é‡</th><th>ä»·æ ¼</th><th>è¯¦ç»†è¯´æ˜</th></tr></thead><tbody><tr><td>CPU</td><td><a href="https://ark.intel.com/content/www/us/en/ark/products/83357/intel-xeon-processor-e52630l-v3-20m-cache-1-80-ghz.html">IntelÂ® XeonÂ® Processor E5-2630L v3</a></td><td>1</td><td>80</td><td>Haswell; 8Core 16HT; 22 nmåˆ¶ç¨‹; Base 1.8GHz, Burst 2.90 GHz; 20MB L3 Cache; 55W TDP</td></tr><tr><td>ä¸»æ¿</td><td><a href="https://item.taobao.com/item.htm?id=676047268901">X99å¯¨æ¿</a></td><td>1</td><td>250</td><td></td></tr><tr><td>å†…å­˜</td><td>å¨åˆšä¸‡ç´«åƒçº¢</td><td>4</td><td>160 + 200</td><td>8GB; DDR4 2133MHz; å¼ºè¿«ç—‡4æ¡å¿…é¡»æ’æ»¡, ç»„æˆ4é€šé“^_^</td></tr><tr><td>é—ªå­˜</td><td><a href="https://www.intel.com/content/www/us/en/products/sku/134583/intel-ssd-760p-series-256gb-m-2-80mm-pcie-3-1-x4-3d2-tlc/specifications.html">IntelÂ® SSD 760P</a></td><td>1</td><td>160</td><td>256GB; PCIe 3.1 x4 æ¥å£, NVMe</td></tr><tr><td>æ˜¾å¡</td><td>è“å®çŸ³RX460</td><td>1</td><td>350</td><td>4GBæ˜¾å­˜; æ— éœ€å•ç‹¬ä¾›ç”µ; HDMI + VGA + DP æ¥å£</td></tr><tr><td>ç”µæº</td><td>é‘«è°·å…¨æ¨¡ç»„</td><td>1</td><td>120</td><td>550W, æ•´ä½“ç»°ç»°æœ‰ä½™äº†</td></tr><tr><td>CPUæ•£çƒ­å™¨</td><td>é•¿åŸéœ„é¾™400</td><td>1</td><td>45</td><td>4é“œç®¡, 3é’ˆè„š</td></tr><tr><td>æœºç®±</td><td>å¾…æŒ‘é€‰</td><td>1</td><td>??</td><td>??</td></tr></tbody></table><p>åˆè®¡ <code>80 + 250 + 160 + 200 + 160 + 350 + 120 + 45 = 1,365</code><br>ç°åœ¨æ˜¾å¡ç”µæºéƒ½è¿˜æ²¡åˆ°, å¸Œæœ›ç»„è£…ä¸Šå»ä¹‹åä¸€æ¬¡ç‚¹äº®, å°±å¯ä»¥è¯´å£°â€çœŸé¦™!â€å•¦.</p><h2 id="ä¸»æ¿ç»†èŠ‚"><a href="#ä¸»æ¿ç»†èŠ‚" class="headerlink" title="ä¸»æ¿ç»†èŠ‚"></a>ä¸»æ¿ç»†èŠ‚</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208132325729.png"></p><div class="note info"><p>x99å«ä¹‰<br>æ‰€è°“çš„x99ä¸»æ¿, ä»£è¡¨çš„å…¶å®æ˜¯<code>Intel X99 chipset</code>, æ˜¯Intelçš„PCH(Platform Controller Hub)å³å—æ¡¥èŠ¯ç‰‡, å®šä¹‰äº†ä¸»æ¿çš„è§„èŒƒ, å¦‚ä¸‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208140001662.png"></p></div><p>å…¶ä»–ç»†èŠ‚: </p><ul><li>CPUæ’æ§½: å•è·¯; LGA2011, å› æ­¤æ˜¯2011ä¸ªé’ˆè„š;</li><li>CPUåªæ”¯æŒDDR4å†…å­˜, ä½†ä¸»æ¿æ”¯æŒDDR3(é—®äº†åº—å®¶, ä¸»æ¿åŒæ—¶ä¹Ÿæ”¯æŒDDR4), ç°åœ¨DDR4æ™®éä»·æ ¼æ¯”è¾ƒè´µ, æ²¡åŠæ³•ä½¿ç”¨é—²é±¼ä¸Šä»·æ ¼å·¨ä¾¿å®œçš„DDR3 ECCå†…å­˜.</li><li></li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="CPUå‹å·"><a href="#CPUå‹å·" class="headerlink" title="CPUå‹å·"></a>CPUå‹å·</h3><p>ä¹°çš„æ—¶å€™æ²¡æœ‰çœ‹æ¸…æ¥šCPUå‹å·, ä»¥ä¸ºæ˜¯ <code>E5-2630 V3</code>, ç»“æœå®é™…æ˜¯ <code>E5-2630L V3</code>, æ‰çŸ¥é“å¤šäº†çš„è¿™ä¸ª<code>L</code>ä»£è¡¨<mark>ä½åŠŸè€—(Low Power)</mark>, åŸºé¢‘åªæœ‰<code>1.8GHz</code>ä¸èƒ½å¿.<br>å› æ­¤å°±åˆæ·˜äº†å¦‚ä¸‹ä¸¤ä¸ªèƒ½å¤Ÿé€‚é…X99ä¸»æ¿çš„CPU, å‡†å¤‡åˆ°æ—¶å€™å„è‡ªå¯¹æ¯”æµ‹è¯•ä¸‹:</p><table><thead><tr><th>é…ä»¶åç§°</th><th>å“ç‰Œ</th><th>æ•°é‡</th><th>ä»·æ ¼</th><th>è¯¦ç»†è¯´æ˜</th></tr></thead><tbody><tr><td>CPU</td><td><a href="https://ark.intel.com/content/www/us/en/ark/products/83357/intel-xeon-processor-e52630l-v3-20m-cache-1-80-ghz.html">IntelÂ® XeonÂ® Processor E5-2630L v3</a></td><td>1</td><td>80</td><td>8Core 16HT; 22 nmåˆ¶ç¨‹; Base 1.8GHz, Burst 2.90 GHz; 20MB L3 Cache; 55W TDP</td></tr><tr><td>CPU</td><td><a href="https://ark.intel.com/content/www/us/en/ark/products/81706/intel-xeon-processor-e52660-v3-25m-cache-2-60-ghz.html">IntelÂ® XeonÂ® Processor E5-2660 v3</a></td><td>1</td><td>100</td><td>10Core 20HT; 22 nmåˆ¶ç¨‹; Base 2.60 GHz, Burst 3.3 GHz; 25MB L3 Cache; 105W TDP</td></tr><tr><td>CPU</td><td><a href="https://ark.intel.com/content/www/us/en/ark/products/83352/intel-xeon-processor-e52620-v3-15m-cache-2-40-ghz.html">IntelÂ® XeonÂ® Processor E5-2620 v3</a></td><td>1</td><td>20</td><td>6Core 12HT; 22 nmåˆ¶ç¨‹; Base 2.40 GHz, Burst 3.20 GHz; 15MB L3 Cache; 85W TDP; ä½ ä¸èƒ½å¯¹ä¸€ä¸ª20å—é’±çš„CPUè¦æ±‚æ›´å¤šäº†! :)</td></tr></tbody></table><div class="note info"><blockquote><p>CPUç›–å­ä¸Šçš„<code>Costa Rica</code>, <code>Malay</code> ä»£è¡¨å•¥æ„æ€?<br>Just to clear something up, the markings on the back of the CPU refer to the packaging site - not the manufacturing site of the actual silicon chip itself.<br>ä¹Ÿå°±æ˜¯è¯´<mark>ä»£è¡¨çš„æ˜¯å°è£…å·¥å‚çš„åœ°ç‚¹</mark>, <code>Malay</code> ä»£è¡¨ <code>Malaysia</code></p></blockquote></div><h3 id="ECCå†…å­˜"><a href="#ECCå†…å­˜" class="headerlink" title="ECCå†…å­˜"></a>ECCå†…å­˜</h3><div class="note warning"><p>å†…å­˜ä¹°æˆECCå´ä¸èƒ½ç”¨ ECCå†…å­˜åˆ°åº•æ˜¯ä»€ä¹ˆé¬¼?</p></div><ul><li>è¿™æ˜¯å› ä¸ºä¸€èˆ¬çš„ç”µè„‘ä¸ºäº†é€Ÿåº¦ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸æ”¯æŒECCå†…å­˜ï¼Œè€ŒECCå†…å­˜ç”±äºæœ‰æ ¡éªŒè¿™ä¸€æ­¥éª¤ï¼Œä¸€èˆ¬éƒ½å¤šç”¨åœ¨æœåŠ¡å™¨é¢†åŸŸï¼Œ<mark>æ™®é€šçš„å®¶ç”¨ä¸»æ¿ä¸€èˆ¬éƒ½æ˜¯ä¸æ”¯æŒçš„</mark>ï¼Œè€Œä¸”å¯¹äºæœåŠ¡å™¨ï¼Œè¿˜è¦åŒºåˆ†REG-ECCå’Œçº¯ECCçš„åŒºåˆ«ï¼ŒREGæ˜¯å¸¦å¯„å­˜å™¨çš„ECCå†…å­˜ï¼Œå¯ä»¥æ”¯æŒæ›´å¤§çš„å•æ¡å®¹é‡ï¼Œä½†æ˜¯ç”±äºæœ‰å¯„å­˜å™¨çš„å­˜åœ¨ï¼Œå»¶è¿Ÿä¼šæ›´é«˜ã€‚</li></ul><h3 id="CPUæ•£çƒ­å™¨"><a href="#CPUæ•£çƒ­å™¨" class="headerlink" title="CPUæ•£çƒ­å™¨"></a>CPUæ•£çƒ­å™¨</h3><div class="note warning"><p>ä¸»æ¿ä¸Š<code>CPU FAN</code>æ˜¯4é’ˆçš„, ä¹°æ¥çš„æ•£çƒ­å™¨é£æ‰‡æ˜¯3é’ˆçš„. åŒºåˆ«æ˜¯å•¥? æ€ä¹ˆæ’?</p></div><blockquote><p>2é’ˆ, 3é’ˆä¸4é’ˆé£æ‰‡åŒºåˆ«?</p></blockquote><ul><li>2é’ˆçš„æ•£çƒ­é£æ‰‡ï¼ˆç»“æ„ç®€å•ï¼Œä½†ä¸èƒ½æµ‹é€Ÿï¼‰: ä¸€ä¸ªç”¨äºä¾›ç”µã€ä¸€ä¸ªç”¨äºæ¥åœ°ï¼Œä¸è¿‡æ²¡æœ‰æµ‹é€ŸåŠŸèƒ½ã€‚ç›®å‰2é’ˆçš„æ•£çƒ­é£æ‰‡å·²ç»åœ¨å¸‚åœºä¸Šå¤§é‡é‡‡ç”¨ï¼Œä½†æ˜¯2é’ˆçš„é£æ‰‡åœ¨å˜é€Ÿç­‰æ–¹é¢ä¸Šå·²ç»ä¸èƒ½æ»¡è¶³è¦æ±‚äº†</li><li>3é’ˆçš„æ•£çƒ­é£æ‰‡ï¼ˆVCç”µå‹è°ƒé€Ÿï¼Œçµæ´»æ€§æ¬ ä½³ï¼‰: ç¬¬ä¸‰æ¡çº¿, ä¸»è¦æ˜¯èµ·ç€æµ‹é€Ÿçš„ä½œç”¨ï¼Œé€šè¿‡ä¸»æ¿èƒ½å¤Ÿä¾¦æµ‹åˆ°é£æ‰‡æ˜¯å¦åœ¨è½¬ã€è½¬é€Ÿä¸ºå¤šå°‘ï¼Œä½†æ˜¯3é’ˆæ•£çƒ­é£æ‰‡çš„è°ƒé€Ÿæ˜¯é€šè¿‡è°ƒæ•´é£æ‰‡ç”µå‹æ¥å®ç°çš„ï¼Œæ­¤å¤–ï¼Œèƒ½ä¸èƒ½è°ƒé€Ÿè¿˜éœ€è¦çœ‹ä¸‹ä¸»æ¿æ˜¯å¦æ”¯æŒï¼Œæ˜¾ç„¶è¿™ç§è°ƒèŠ‚è½¬é€Ÿå¹¶ä¸å¤Ÿçµæ´»ï¼Œä¸èƒ½å®æ—¶åæ˜ CPUçŠ¶æ€çš„ä¿¡æ¯ï¼Œè¿˜éœ€è¦åœ¨ä¸»æ¿BIOSä¸­è¿›è¡Œå„ç§è®¾ç½®ã€‚</li><li>4é’ˆçš„æ•£çƒ­é£æ‰‡ï¼ˆæ›´åŠ çµæ´»æ›´åŠ æ™ºèƒ½çš„è°ƒé€Ÿï¼‰: 4é’ˆçš„æ•£çƒ­é£æ‰‡æ˜¯åœ¨3é’ˆåŸºç¡€ä¸Šåˆå¤šäº†ä¸€æ ¹PWMçº¿ï¼ˆ è„‰å®½è°ƒå˜ï¼‰ï¼Œæ‰€è°“çš„PWMçº¿å°±æ˜¯åˆ©ç”¨PWMæœºåˆ¶æ¥è°ƒèŠ‚é£æ‰‡è½¬é€Ÿï¼Œè€Œé£æ‰‡ç”µå‹æ˜¯æ’å®šçš„ï¼Œé¿å…äº†æ§åˆ¶ç”µå‹æ¥å˜é€Ÿçš„ä¸€ç³»åˆ—å¼Šç«¯ã€‚è€ŒPWMé£æ‰‡æ— éœ€ä¾èµ–ä¸»æ¿BIOSï¼Œæ›´åŠ çœå¿ƒæ–¹ä¾¿ã€‚PWMè„‰å†²ä¿¡å·å¯ä»¥è¾“å‡ºä¸åŒçš„å ç©ºæ¯”ï¼ˆDuty Cycleï¼‰ï¼Œ0-100%ä¹‹é—´çš„å ç©ºæ¯”å°±èƒ½è°ƒèŠ‚å‡ºä¸åŒçš„é£æ‰‡è½¬é€Ÿï¼Œæ‰€ä»¥èƒ½å¤Ÿåšåˆ°ç²¾ç¡®ã€çµæ´»æ§åˆ¶ã€‚</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208140950640.png"></p><blockquote><p>3é’ˆæ€ä¹ˆæ’å…¥ä¸»æ¿4é’ˆæ¥å£ä¸­?</p></blockquote><ul><li>å…¼å®¹, æœ‰é˜²å‘†æœºåˆ¶.</li></ul><p>æ€»ä½“æ¥è¯´, é£æ‰‡è¸©å‘äº†, ä½†ä¹Ÿå¤Ÿç”¨äº†:</p><ol><li>åº”è¯¥è´­ä¹°6é“œç®¡</li><li>åº”è¯¥è´­ä¹°4é’ˆçš„</li></ol><h2 id="æˆæœå±•ç¤º"><a href="#æˆæœå±•ç¤º" class="headerlink" title="æˆæœå±•ç¤º"></a>æˆæœå±•ç¤º</h2><h3 id="æˆå“å›¾"><a href="#æˆå“å›¾" class="headerlink" title="æˆå“å›¾"></a>æˆå“å›¾</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172253812.png"></p><h3 id="æ•°æ¡†æ¡†"><a href="#æ•°æ¡†æ¡†" class="headerlink" title="æ•°æ¡†æ¡†"></a>æ•°æ¡†æ¡†</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172318658.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172253927.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172254393.png"></p><h2 id="å‡çº§æ½œåŠ›-amp-è®¡åˆ’"><a href="#å‡çº§æ½œåŠ›-amp-è®¡åˆ’" class="headerlink" title="å‡çº§æ½œåŠ›&amp;è®¡åˆ’"></a>å‡çº§æ½œåŠ›&amp;è®¡åˆ’</h2><p>æ•´ä½“CPUè¿˜æ˜¯æ¯”è¾ƒå¼ºæ‚çš„, æœ‰å¾ˆå¤§å‡çº§æ½œåŠ›</p><h3 id="ä¸»æ¿å‡çº§"><a href="#ä¸»æ¿å‡çº§" class="headerlink" title="ä¸»æ¿å‡çº§"></a>ä¸»æ¿å‡çº§</h3><ul><li>å‡çº§æˆä¸¤è·¯, çœ‹æœ‰æ²¡å¿…è¦å§, è¿™æ ·ç”µè´¹åƒä¸æ¶ˆ, ç”µæºå¯èƒ½ä¹Ÿè¦å‡çº§; <a href="https://post.smzdm.com/p/aoo8wewm/pic_3/#bigImg">X99åŒè·¯ä¸»æ¿ç®€è¯„</a> æŒ‡æ˜äº†æ–¹å‘</li></ul><h3 id="CPUå‡çº§"><a href="#CPUå‡çº§" class="headerlink" title="CPUå‡çº§"></a>CPUå‡çº§</h3><ul><li>X99æ•´ä½“è¿˜æ”¯æŒV4(Broadwell)çš„CPU, ä¾‹å¦‚ <code>E5-2660 V4</code>, 16å¹´ä¸Šå¸‚, 14nmåˆ¶ç¨‹. å…¨éƒ¨åˆ—è¡¨å‚è§: </li><li>2699 v3: 650RMBå·¦å³</li><li><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208141020764.png"></li></ul><h3 id="å†…å­˜å‡çº§"><a href="#å†…å­˜å‡çº§" class="headerlink" title="å†…å­˜å‡çº§"></a>å†…å­˜å‡çº§</h3><ul><li>ECCå†…å­˜: è¿™å‡ ä¸ªCPUéƒ½æ”¯æŒECCå†…å­˜, ç­‰ä¸‹æ‰¹æœåŠ¡å™¨æ·˜æ±°, æˆ–è€…DDR5ä¸»æµ, å°±å¯ä»¥ä½ä»·æ·˜å‡ ä¸ªDDR4 ECCå†…å­˜;</li><li>å®¹é‡å‡çº§: CPUæ”¯æŒ <code>192GB * 4 = 768GB</code> ä¸»æ¿æ”¯æŒ<code>32GB*4=128GB</code>; å½“å‰æ˜¯<code>8GB*4=32GB</code>, æœ‰å¾ˆå¤§å‡çº§æ½œåŠ›, ç­‰å†…å­˜ä»·æ ¼ä¸‹é™å§~</li><li>é¢‘ç‡å‡çº§: CPUé™åˆ¶æœ€å¤§æ”¯æŒ2133MHz, å¯¼è‡´æœ€æ–°çš„3200MHzéƒ½æ²¡æ³•ç”¨(èƒ½ç”¨, ä½†ä¼šè‡ªåŠ¨é™é¢‘åˆ°2133MHz).</li></ul><h1 id="å­¦åˆ°äº†å•¥"><a href="#å­¦åˆ°äº†å•¥" class="headerlink" title="å­¦åˆ°äº†å•¥"></a>å­¦åˆ°äº†å•¥</h1><h2 id="å¸¸ç”¨ä¸»æ¿å‹å·"><a href="#å¸¸ç”¨ä¸»æ¿å‹å·" class="headerlink" title="å¸¸ç”¨ä¸»æ¿å‹å·"></a>å¸¸ç”¨ä¸»æ¿å‹å·</h2><ul><li>X79<ul><li>Sandy Bridge-E, Ivy Bridge-E</li><li>Quad-channel DDR3, up to two DIMMs per channel</li></ul></li><li>X99<ul><li>Haswell-E, Broadwell-E</li><li>Quad-channel DDR4, up to two DIMMs per channel</li></ul></li></ul><h2 id="å®¶ç”¨æœºç®±å‹å·"><a href="#å®¶ç”¨æœºç®±å‹å·" class="headerlink" title="å®¶ç”¨æœºç®±å‹å·"></a>å®¶ç”¨æœºç®±å‹å·</h2><ul><li>E-ATX</li><li>ATX</li><li>M-ATX</li><li>ITX</li></ul><h2 id="å¥‡æŠ€æ·«å·§"><a href="#å¥‡æŠ€æ·«å·§" class="headerlink" title="å¥‡æŠ€æ·«å·§"></a>å¥‡æŠ€æ·«å·§</h2><blockquote><p>Q: é‹ç›’æœºç®±, å¦‚ä½•æ— å¼€å…³å¼€æœº?<br>A: ç›´æ¥èºä¸åˆ€æˆ³ä¸»æ¿, è¿æ¥é’ˆè„š.<br><img data-src="http://p8.itc.cn/images01/20200823/5eb93a0ca39443f68d7d3392fc3615ea.jpeg"></p></blockquote><h2 id="å…¶ä»–ä½“æ‚Ÿ"><a href="#å…¶ä»–ä½“æ‚Ÿ" class="headerlink" title="å…¶ä»–ä½“æ‚Ÿ"></a>å…¶ä»–ä½“æ‚Ÿ</h2><ul><li>çŸ¥é“äº†ç»å¸¸è¯´çš„V3, V4åˆ©æ—§æ˜¯å•¥äº†; å¯¹è¿™ç§æ´‹åƒåœ¾CPUå¸‚åœºè¡Œæƒ…æœ‰äº†å¤§æ¦‚çš„è®¤çŸ¥.</li><li>è®¡ç®—æœºå¹¶éåªæœ‰CPU, è¿˜æœ‰å†…å­˜, ä¸»æ¿, æ˜¾å¡ç”šè‡³ç”µæº, æ•£çƒ­å™¨ç­‰; ä¹Ÿéƒ½æ˜¯æä¸ºå…³é”®çš„. å°¤å…¶æ˜¯è¿™ç§æ´‹åƒåœ¾, CPUè·Ÿä¸è¦é’±ä¸€æ ·, å…¶ä»–ç»„ä»¶çš„å¯æ‰©å±•æ€§ä¸ç¨³å®šæ€§å°±è‡³å…³é‡è¦äº†. å¾ˆå¤šç‰¹æ€§ä¸æ­¢è¦çœ‹CPUæ˜¯å¦æ”¯æŒ, ä¹Ÿè¦çœ‹ä¸»æ¿. ä¾‹å¦‚å†…å­˜çš„DDRä»£æ•°, æœ€å¤§å®¹é‡, é€šé“æ•°, æœ€å¤§é¢‘ç‡, æ˜¯å¦æ”¯æŒECC; ä¾‹å¦‚CPUæ’æ§½çš„é’ˆè„šæ•°;</li><li>æ‘©å°”å®šå¾‹çš„ææ€–: ä¸Šè¾¹å‡ ä¸ªCPUåŸºæœ¬éƒ½æ˜¯14å¹´Q3ä¸Šå¸‚, åˆ°ä»Šå¤©2022å¹´Q2, ä»…ä»…8å¹´å·¦å³:  <ul><li>ä»·æ ¼: å°±å·²ç»è·Œå€’äº†ç™½èœä»·, ä»¥<code>E5-2660 v3</code>ä¸ºä¾‹, ä¸Šå¸‚ä»·æ ¼æ˜¯<code>$1445.00</code>, ç°åœ¨æ˜¯<code>100RMB=$15</code>. </li><li>æ€§èƒ½: å½“å‰ä¸»æµçš„12ä»£Intel, ä»¥å®¶ç”¨çš„ <a href="https://ark.intel.com/content/www/cn/zh/ark/products/134594/intel-core-i712700k-processor-25m-cache-up-to-5-00-ghz.html">i7-12700K</a> ä¸ºä¾‹, åˆ¶ç¨‹å·²ç»åˆ°äº†7nm; æ›´ä¸ç”¨æARMæ¶æ„ä¸‹çš„ä¸»æµåˆ¶ç¨‹éƒ½æ˜¯5nmäº†.</li></ul></li></ul><blockquote><p>æ—§æ—¶ç‹è°¢å ‚å‰ç‡•, é£å…¥å¯»å¸¸ç™¾å§“å®¶</p></blockquote><h2 id="è€å¸æœºè¸©å‘è®°"><a href="#è€å¸æœºè¸©å‘è®°" class="headerlink" title="è€å¸æœºè¸©å‘è®°"></a>è€å¸æœºè¸©å‘è®°</h2><blockquote><p>è‡ªè¯©ä¸ºåƒåœ¾ä½¬, ç»“æœè¿™æ¬¡ç»„è£…ç”µè„‘, ç»“ç»“å®å®æŠŠè‡ªå·±ç»™æ•™è‚²äº†ä¸€ç•ª.</p></blockquote><h3 id="Uç›˜å¥—è·¯"><a href="#Uç›˜å¥—è·¯" class="headerlink" title="Uç›˜å¥—è·¯"></a>Uç›˜å¥—è·¯</h3><p>åœ¨æŸå®ä¹°äº†2ä¸ª32GBçš„Uç›˜, æƒ³è¦åˆ†åˆ«ä½œä¸ºwin10ä¸centosçš„è£…æœºPE.<br>ç»“æœåœ¨æ‹·è´é•œåƒåˆ°Uç›˜çš„æ—¶å€™, å‘ç°ä¼ è¾“é€Ÿåº¦å¥‡æ…¢æ— æ¯”, åªæœ‰6MB&#x2F;s.<br>æ™®é€šçš„win10é•œåƒå¤§å°æ˜¯4GBå·¦å³, ä¹Ÿå°±æ˜¯å…¨éƒ¨æ‹·è´åˆ°Uç›˜é‡Œéœ€è¦: <code>4 * 1024 / 6 / 60 = 11.3</code>, è¦10min+;<br>ä¸è§£, é‚é—®å®¢æœ, è§£é‡Šé“æ˜¯USB2.0çš„. ä»”ç»†çœ‹äº†ä¸‹è¯¦æƒ…é¡µ, ç¡•å¤§çš„â€USB 2.0â€ä»¿ä½›åœ¨å˜²è®½æˆ‘@-@<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172225310.png"></p><p>What??? éƒ½2202å¹´äº†, ç«Ÿç„¶è¿˜æœ‰USB 2.0?? æˆ‘ä»¿ä½›å¬åˆ°äº†ä¸€ä¸ªå›½é™…ç¬‘è¯.<br>ä¸ªäººä¸‹æ„è¯†é‡ŒUSB2.0éƒ½å·²ç»è·Ÿé¼ æ ‡&#x2F;é”®ç›˜çš„PS&#x2F;2æ¥å£ä¸€æ ·, å·²ç»é”€å£°åŒ¿è¿¹äº†, by defaultä¸éƒ½åº”è¯¥æ˜¯3.0çš„ä¹ˆ?</p><p>æ­¤ä¸ºå‘ä¸€.</p><h3 id="é•œåƒæ–‡ä»¶å¥—è·¯"><a href="#é•œåƒæ–‡ä»¶å¥—è·¯" class="headerlink" title="é•œåƒæ–‡ä»¶å¥—è·¯"></a>é•œåƒæ–‡ä»¶å¥—è·¯</h3><p>ä¸ºå›¾çœäº‹å„¿, åœ¨æŸCSXNç½‘ç«™èŠ±äº†Nå¤šç§¯åˆ†, ä¸‹è½½äº†ä¸ªâ€çº¯å‡€ç‰ˆâ€é•œåƒ.<br>ç»“æœä¸€å®‰è£…, é‡Œè¾¹å¯†å¯†éº»éº»å„ç§è½¯ä»¶, ä»€ä¹ˆ360å…¨å®¶æ¡¶, TXå…¨å®¶æ¡¶, 2345å…¨å®¶æ¡¶.<br>æµè§ˆå™¨ä¸»é¡µè¢«ä¿®æ”¹å¾—ä¸åƒæ ·å­.<br><mark>åŸæ¥ä¼ªè£…æˆçº¯å‡€ç‰ˆå•Š</mark></p><p>å»æœè‡ªå·±ä»ç„¶åœç•™åœ¨åå¹´å‰çš„ç»å…¸çš„ é›¨æ—Xé£, æ·±åº¦, ç³»ç»Ÿä¹‹å®¶ç­‰, ç»“æœä¸€ä¸ªä¸€ä¸ªéƒ½ä¸åƒæ ·å­. ä¸€ç‚¹éƒ½ä¸<code>çº¯å‡€</code>!<br>æœ€ååªèƒ½è€è€å®å®å»ä¸‹è½½å®˜æ–¹é•œåƒ, åˆä¸æ˜¯ä¸èƒ½ç”¨@-@</p><h3 id="2345å¥—è·¯"><a href="#2345å¥—è·¯" class="headerlink" title="2345å¥—è·¯"></a>2345å¥—è·¯</h3><p>æ³¨å†Œè¡¨é‡Œæœç´¢â€çœ‹å›¾ç‹â€, ä¸æŸ¥ä¸çŸ¥é“, ä¸€æŸ¥å“ä¸€è·³. å¯†å¯†éº»éº»çš„, çœ‹å¾—æˆ‘ç¥ç»è¡°å¼±.<br>å¿ƒæƒ³ä¸€ä¸ªä¸€ä¸ªåˆ é™¤ä¹Ÿä¸æ˜¯ä¸ªäº‹å„¿å•Š.<br>ç´¢æ€§å¤§ç¬”ä¸€æŒ¥, ç›´æ¥æŠŠçˆ¶èŠ‚ç‚¹åˆ é™¤. ç»“æœç›´æ¥ç»å…¸çš„windowsè“å±.<br>æ²¡åŠæ³•, åªå¥½æ‹¾èµ·ä¼ ç»Ÿè‰ºèƒ½, è¿›å…¥PE, é‡è£…ç³»ç»Ÿ!</p><ul><li>ä¸æœä¸çŸ¥é“, ä¸€æœå“ä¸€è·³. <a href="https://www.zhihu.com/question/35188509/answer/1266544765">åŠ£è¿¹æ–‘æ–‘</a>. åŸæ¥è€æ¿å·²ç»è·‘è·¯, æèµ·äº†ç½‘è´·, åŒºå—é“¾.</li><li>å¥½å®¶ä¼™, æˆ‘ç›´å‘¼å¥½å®¶ä¼™. åŸæ¥è¿˜æƒ³åšç™¾å¹´ä¼ä¸š, å¤©å¤©åœ¨å®˜ç½‘ç»™è‡ªå·±å€’è®¡æ—¶å‘¢.</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172241888.png"></p><blockquote><p>åŒæ ·æ˜¯å°ç« é±¼, å·®åˆ«å’‹å°±é‚£ä¹ˆå¤§å‘¢? ç§ç§äººå®¶ <a href="https://github.com/">GitHub</a> å¤šæœ‰èŠ‚æ“.</p></blockquote><h3 id="win10æ— èŠ‚æ“å¥—è·¯"><a href="#win10æ— èŠ‚æ“å¥—è·¯" class="headerlink" title="win10æ— èŠ‚æ“å¥—è·¯"></a>win10æ— èŠ‚æ“å¥—è·¯</h3><p>å®‰è£…å¥½ç³»ç»Ÿ, å‡†å¤‡å®‰è£…æ˜¾å¡é©±åŠ¨, ç»“æœæŠ¥è­¦, Cç›˜å­˜å‚¨ç©ºé—´ä¸è¶³.<br>What??? æˆ‘Cç›˜å¯æ˜¯40GBçš„å®¹é‡, å°±è£…äº†ä¸ªç³»ç»Ÿ, å•¥è½¯ä»¶éƒ½æ²¡å®‰è£…å‘¢, å’‹å°±æ²¡äº†?<br>æ¯ä¸ªæ–‡ä»¶å¤¹å¤§å°åŠ èµ·æ¥, æ€»å…±ä¹Ÿæ‰10å¤šGB, å‰©ä¸‹çš„20GBå“ªé‡Œå»äº†? æŸ¥è¯¢æ‰çŸ¥é“, åŸæ¥æ˜¯è¢«å¾®è½¯å¥—è·¯äº†.</p><ul><li><a href="https://www.itechtics.com/reserved-storage-windows-10/">17GBçš„é¢„ç•™ç©ºé—´</a></li><li>5GBçš„ä¼‘çœ æ–‡ä»¶</li></ul><blockquote><p>FxxK MicroSoft!</p></blockquote><h3 id="å¤šä¹ˆç—›çš„é¢†æ‚Ÿ"><a href="#å¤šä¹ˆç—›çš„é¢†æ‚Ÿ" class="headerlink" title="å¤šä¹ˆç—›çš„é¢†æ‚Ÿ"></a>å¤šä¹ˆç—›çš„é¢†æ‚Ÿ</h3><p>æƒ³æƒ³ä¹‹å‰, è‡ªå·±è¢«mac&#x2F;linuxä¿æŠ¤å¾—å¤ªå¥½äº†. è¿˜ä¸€ç›´åœ¨çº³é—·ä¸ºå•¥è¦ç»™ç¡¬ç›˜åˆ†åŒº, Cç›˜, Dç›˜å•¥çš„å¤šéº»çƒ¦.<br>è¿™æ¬¡æˆ‘çŸ¥é“äº†, æˆ‘ä¹–ä¹–åœ°åˆ†æˆäº†å‡ ä¸ªåŒº, å®‰è£…å¥½äº†GHOSTå·¥å…·, ä¹–ä¹–ç»™Cç›˜æ‰“äº†ä¸ªGHOSTé•œåƒ.<br>éšæ—¶å‡†å¤‡è¢«è¿™äº›æµæ°“è½¯ä»¶â€XXâ€, éšæ—¶å‡†å¤‡é‡è£…&#x2F;æ¢å¤ç³»ç»Ÿ.</p><blockquote><p>æ²¡åŠæ³•, Windowsçš„ç”Ÿå­˜ç¯å¢ƒå®åœ¨æ˜¯å¤ªæ¶åŠ£äº†!!</p></blockquote><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul><li><a href="https://www.expreview.com/62077.html">æ•£çƒ­é£æ‰‡çš„2é’ˆã€3é’ˆã€4é’ˆéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;åƒåœ¾ä½¬çš„å‘¨æœ«, æ²¡äº‹å„¿å°±æ˜¯çæŠ˜è…¾, è‡ªä»åœ¨Bç«™è¢«ç§è‰äº†æ´‹åƒåœ¾, æŒ‰è€ä¸ä½å¿ƒä¸­çš„å†²åŠ¨, å†³å®šä¹Ÿç”¨æ´‹åƒåœ¾ç»„è£…ä¸€å°èƒ½æ•°æ¡†æ¡†çš„ç”µè„‘, ç©ç©å„¿æ¸¸æˆ, å‹æ¦¨å‹æ¦¨æ€§èƒ½.&lt;/p&gt;
&lt;h1 id=&quot;ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾&quot;&gt;&lt;a href=&quot;#ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾&quot;&gt;&lt;/a&gt;ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;ä¸€: ç©·, &lt;/li&gt;
&lt;li&gt;äºŒ: ç©,&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;é…ç½®æ¸…å•&quot;&gt;&lt;a href=&quot;#é…ç½®æ¸…å•&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®æ¸…å•&quot;&gt;&lt;/a&gt;é…ç½®æ¸…å•&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;å‡ ä¹éƒ½æ˜¯ä»æµ·é²œå¸‚åœºæ·˜æ¥çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹æ˜¯ä¾¿å®œ, æ€§ä»·æ¯”é«˜; &lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹æ˜¯ç”µæ°”ç‰¹æ€§è¡°å‡ä¸æ˜ç¡®, é•¿æœŸç¨³å®šæ€§æ²¡æœ‰ä¿éšœ.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½†å¯¹äºå¶å°”ç©ä¸€ç©æ¸¸æˆ, ä¸æ˜¯é•¿æœŸé«˜è´Ÿè·è·‘æ¸²æŸ“ç­‰, æ•´ä½“è¿˜OK. ç›®æ ‡æ˜¯&lt;strong&gt;1000å…ƒ&lt;/strong&gt;å·¦å³æå®š.&lt;/p&gt;
&lt;h2 id=&quot;è¯¦ç»†æ¸…å•&quot;&gt;&lt;a href=&quot;#è¯¦ç»†æ¸…å•&quot; class=&quot;headerlink&quot; title=&quot;è¯¦ç»†æ¸…å•&quot;&gt;&lt;/a&gt;è¯¦ç»†æ¸…å•&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é…ä»¶åç§°&lt;/th&gt;
&lt;th&gt;å“ç‰Œ&lt;/th&gt;
&lt;th&gt;æ•°é‡&lt;/th&gt;
&lt;th&gt;ä»·æ ¼&lt;/th&gt;
&lt;th&gt;è¯¦ç»†è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;CPU&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://ark.intel.com/content/www/us/en/ark/products/83357/intel-xeon-processor-e52630l-v3-20m-cache-1-80-ghz.html&quot;&gt;IntelÂ® XeonÂ® Processor E5-2630L v3&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;80&lt;/td&gt;
&lt;td&gt;Haswell; 8Core 16HT; 22 nmåˆ¶ç¨‹; Base 1.8GHz, Burst 2.90 GHz; 20MB L3 Cache; 55W TDP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸»æ¿&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://item.taobao.com/item.htm?id=676047268901&quot;&gt;X99å¯¨æ¿&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;250&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å†…å­˜&lt;/td&gt;
&lt;td&gt;å¨åˆšä¸‡ç´«åƒçº¢&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;160 + 200&lt;/td&gt;
&lt;td&gt;8GB; DDR4 2133MHz; å¼ºè¿«ç—‡4æ¡å¿…é¡»æ’æ»¡, ç»„æˆ4é€šé“^_^&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é—ªå­˜&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://www.intel.com/content/www/us/en/products/sku/134583/intel-ssd-760p-series-256gb-m-2-80mm-pcie-3-1-x4-3d2-tlc/specifications.html&quot;&gt;IntelÂ® SSD 760P&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;160&lt;/td&gt;
&lt;td&gt;256GB; PCIe 3.1 x4 æ¥å£, NVMe&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ˜¾å¡&lt;/td&gt;
&lt;td&gt;è“å®çŸ³RX460&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;350&lt;/td&gt;
&lt;td&gt;4GBæ˜¾å­˜; æ— éœ€å•ç‹¬ä¾›ç”µ; HDMI + VGA + DP æ¥å£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”µæº&lt;/td&gt;
&lt;td&gt;é‘«è°·å…¨æ¨¡ç»„&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;120&lt;/td&gt;
&lt;td&gt;550W, æ•´ä½“ç»°ç»°æœ‰ä½™äº†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CPUæ•£çƒ­å™¨&lt;/td&gt;
&lt;td&gt;é•¿åŸéœ„é¾™400&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;45&lt;/td&gt;
&lt;td&gt;4é“œç®¡, 3é’ˆè„š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœºç®±&lt;/td&gt;
&lt;td&gt;å¾…æŒ‘é€‰&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;??&lt;/td&gt;
&lt;td&gt;??&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;åˆè®¡ &lt;code&gt;80 + 250 + 160 + 200 + 160 + 350 + 120 + 45 = 1,365&lt;/code&gt;&lt;br&gt;ç°åœ¨æ˜¾å¡ç”µæºéƒ½è¿˜æ²¡åˆ°, å¸Œæœ›ç»„è£…ä¸Šå»ä¹‹åä¸€æ¬¡ç‚¹äº®, å°±å¯ä»¥è¯´å£°â€çœŸé¦™!â€å•¦.&lt;/p&gt;
&lt;h2 id=&quot;ä¸»æ¿ç»†èŠ‚&quot;&gt;&lt;a href=&quot;#ä¸»æ¿ç»†èŠ‚&quot; class=&quot;headerlink&quot; title=&quot;ä¸»æ¿ç»†èŠ‚&quot;&gt;&lt;/a&gt;ä¸»æ¿ç»†èŠ‚&lt;/h2&gt;</summary>
    
    
    
    <category term="çæŠ˜è…¾" scheme="https://davyjones2010.github.io/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="diy" scheme="https://davyjones2010.github.io/tags/diy/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸ç”¨çš„Nginxå‘½ä»¤ä¸é…ç½®</title>
    <link href="https://davyjones2010.github.io/2022-08-09-nginx-scripts/"/>
    <id>https://davyjones2010.github.io/2022-08-09-nginx-scripts/</id>
    <published>2022-08-09T13:42:45.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MACç¯å¢ƒ"><a href="#MACç¯å¢ƒ" class="headerlink" title="MACç¯å¢ƒ"></a>MACç¯å¢ƒ</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/local/var/www/usr/local/Cellar/nginx/1.21.3/html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="é…ç½®æ–‡ä»¶è·¯å¾„"><a href="#é…ç½®æ–‡ä»¶è·¯å¾„" class="headerlink" title="é…ç½®æ–‡ä»¶è·¯å¾„"></a>é…ç½®æ–‡ä»¶è·¯å¾„</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/local/etc/nginx/usr/local/etc/nginx/nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ç¦æ­¢é€šè¿‡IPè®¿é—®"><a href="#ç¦æ­¢é€šè¿‡IPè®¿é—®" class="headerlink" title="ç¦æ­¢é€šè¿‡IPè®¿é—®"></a>ç¦æ­¢é€šè¿‡IPè®¿é—®</h3><ul><li>ç»‘å®šäº†hosts<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1 example.org www.example.org<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>åªå…è®¸é€šè¿‡<code>localhost:8080</code>æˆ–è€…<code>example.org:8080</code>æˆ–è€…<code>www.example.org:8080</code>è®¿é—®, </li><li>ç¦æ­¢é€šè¿‡<code>127.0.0.1:8080</code>è®¿é—®, è¿”å›502é”™è¯¯.<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>    listen  <span class="token number">8080</span><span class="token punctuation">;</span>    <span class="token builtin class-name">return</span> <span class="token number">502</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>server <span class="token punctuation">&#123;</span>    listen       <span class="token number">8080</span><span class="token punctuation">;</span>    server_name  localhost example.org www.example.org<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092149192.png"></p><h3 id="å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡"><a href="#å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡" class="headerlink" title="å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡"></a>å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡</h3><ul><li>ç»‘å®šäº†hosts<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1 example.org www.example.org<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>é€šè¿‡<code>localhost:8080</code>è®¿é—®, åˆ™è®¿é—®åˆ° <code>$NGINX_HOME/html/</code> ç›®å½•</li><li>é€šè¿‡<code>example.org:8080</code>æˆ–è€…<code>www.example.org:8080</code>è®¿é—®, åˆ™è®¿é—®åˆ° <code>$NGINX_HOME/html2/</code> ç›®å½•</li><li>ç¦æ­¢é€šè¿‡<code>127.0.0.1:8080</code>è®¿é—®, è¿”å›502é”™è¯¯.<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>    listen  <span class="token number">8080</span><span class="token punctuation">;</span>    <span class="token builtin class-name">return</span> <span class="token number">502</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>server <span class="token punctuation">&#123;</span>    listen       <span class="token number">8080</span><span class="token punctuation">;</span>    server_name  example.org www.example.org<span class="token punctuation">;</span>    location / <span class="token punctuation">&#123;</span>        root html2<span class="token punctuation">;</span>        index index.html index.htm<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>    location <span class="token operator">=</span> /50x.html <span class="token punctuation">&#123;</span>        root   html2<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>server <span class="token punctuation">&#123;</span>    listen       <span class="token number">8080</span><span class="token punctuation">;</span>    server_name  localhost<span class="token punctuation">;</span>    location / <span class="token punctuation">&#123;</span>        root   html<span class="token punctuation">;</span>        index  index.html index.htm<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>    location <span class="token operator">=</span> /50x.html <span class="token punctuation">&#123;</span>        root   html<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092152127.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092152948.png"></li></ul><h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>NGINX_HOME:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/local/Cellar/nginx/1.21.3location / <span class="token punctuation">&#123;</span>root   html<span class="token punctuation">;</span>index  index.html index.htm<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¾¹çš„htmlå°±æ˜¯ NGINX_HOME&#x2F;html&#x2F;</p><h2 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew services start nginxbrew services restart nginxbrew services stop nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚-è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå-å¦‚æœæ˜¯åŸŸåçš„è¯-å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†"><a href="#Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚-è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå-å¦‚æœæ˜¯åŸŸåçš„è¯-å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†" class="headerlink" title="Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚, è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå? å¦‚æœæ˜¯åŸŸåçš„è¯, å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†?"></a>Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚, è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå? å¦‚æœæ˜¯åŸŸåçš„è¯, å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†?</h3><ul><li>å¦‚ä¸‹å›¾, æœ¬è´¨ä¸Šè¿˜æ˜¯Nginxè§£æHTTPåè®®, æ ¹æ®è¯·æ±‚è¡Œé‡Œçš„<code>RequestURL</code>æ¥è¿›è¡Œåˆ¤æ–­.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092154665.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092154173.png"></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;MACç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#MACç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;MACç¯å¢ƒ&quot;&gt;&lt;/a&gt;MACç¯å¢ƒ&lt;/h1&gt;&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; nginx&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;å†…å®¹&quot;&gt;&lt;a href=&quot;#å†…å®¹&quot; class=&quot;headerlink&quot; title=&quot;å†…å®¹&quot;&gt;&lt;/a&gt;å†…å®¹&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;/usr/local/var/www
/usr/local/Cellar/nginx/1.21.3/html&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;é…ç½®&quot;&gt;&lt;a href=&quot;#é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®&quot;&gt;&lt;/a&gt;é…ç½®&lt;/h2&gt;&lt;h3 id=&quot;é…ç½®æ–‡ä»¶è·¯å¾„&quot;&gt;&lt;a href=&quot;#é…ç½®æ–‡ä»¶è·¯å¾„&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®æ–‡ä»¶è·¯å¾„&quot;&gt;&lt;/a&gt;é…ç½®æ–‡ä»¶è·¯å¾„&lt;/h3&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;/usr/local/etc/nginx
/usr/local/etc/nginx/nginx.conf&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;ç¦æ­¢é€šè¿‡IPè®¿é—®&quot;&gt;&lt;a href=&quot;#ç¦æ­¢é€šè¿‡IPè®¿é—®&quot; class=&quot;headerlink&quot; title=&quot;ç¦æ­¢é€šè¿‡IPè®¿é—®&quot;&gt;&lt;/a&gt;ç¦æ­¢é€šè¿‡IPè®¿é—®&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ç»‘å®šäº†hosts&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1 example.org www.example.org&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;åªå…è®¸é€šè¿‡&lt;code&gt;localhost:8080&lt;/code&gt;æˆ–è€…&lt;code&gt;example.org:8080&lt;/code&gt;æˆ–è€…&lt;code&gt;www.example.org:8080&lt;/code&gt;è®¿é—®, &lt;/li&gt;
&lt;li&gt;ç¦æ­¢é€šè¿‡&lt;code&gt;127.0.0.1:8080&lt;/code&gt;è®¿é—®, è¿”å›502é”™è¯¯.&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;server &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    listen  &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token builtin class-name&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;502&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

server &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    listen       &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    server_name  localhost example.org www.example.org&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://davyjones2010.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="mac" scheme="https://davyjones2010.github.io/tags/mac/"/>
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="network" scheme="https://davyjones2010.github.io/tags/network/"/>
    
    <category term="nginx" scheme="https://davyjones2010.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥æ¢ç©¶DNSæµç¨‹ä¸æŠ¥æ–‡</title>
    <link href="https://davyjones2010.github.io/2022-08-08-dns-deep-dive/"/>
    <id>https://davyjones2010.github.io/2022-08-08-dns-deep-dive/</id>
    <published>2022-08-08T14:26:58.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DNSæœåŠ¡å™¨ç±»å‹"><a href="#DNSæœåŠ¡å™¨ç±»å‹" class="headerlink" title="DNSæœåŠ¡å™¨ç±»å‹"></a>DNSæœåŠ¡å™¨ç±»å‹</h1><h2 id="root-nameserver"><a href="#root-nameserver" class="headerlink" title="root nameserver"></a>root nameserver</h2><p>å³è´Ÿè´£<code>.</code>åŸŸåçš„, å…¨çƒåªæœ‰13å°(è‡³äºä¸ºå•¥åªæœ‰13å°, è‡ªå·±googleå§):  </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalkerdeMBP:_assets davywalker$ <span class="token function">dig</span> baidu.com +trace<span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> DiG <span class="token number">9.10</span>.6 <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> baidu.com +trace<span class="token punctuation">;</span><span class="token punctuation">;</span> global options: +cmd<span class="token builtin class-name">.</span><span class="token number">1</span>INNSm.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSa.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSh.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSl.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSi.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSg.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSj.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSc.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSk.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSe.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSf.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSb.root-servers.net.<span class="token builtin class-name">.</span><span class="token number">1</span>INNSd.root-servers.net.<span class="token punctuation">;</span><span class="token punctuation">;</span> Received <span class="token number">239</span> bytes from <span class="token number">192.168</span>.1.1<span class="token comment">#53(192.168.1.1) in 7 ms</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="TLD-Top-Level-Domain-nameserver"><a href="#TLD-Top-Level-Domain-nameserver" class="headerlink" title="TLD(Top Level Domain) nameserver"></a>TLD(Top Level Domain) nameserver</h2><p>å³å¯¹åº” <code>.com</code>, <code>.gov</code>, <code>.cn</code> ç­‰çš„è§£ææœåŠ¡å™¨. </p><h2 id="authoritative-nameserver"><a href="#authoritative-nameserver" class="headerlink" title="authoritative nameserver"></a>authoritative nameserver</h2><p>å³å¯¹åº” <code>.baidu.com</code> <code>.hangzhou.gov</code>, <code>gitee.cn</code> ç­‰çš„è§£ææœåŠ¡å™¨.<br>é€šå¸¸ authoritative nameserver æ˜¯DNSè§£æçš„æœ€åä¸€æ­¥</p><blockquote><p>The authoritative nameserver is usually the resolverâ€™s last step in the journey for an IP address.</p></blockquote><h1 id="DNSæŸ¥è¯¢ç±»å‹"><a href="#DNSæŸ¥è¯¢ç±»å‹" class="headerlink" title="DNSæŸ¥è¯¢ç±»å‹"></a>DNSæŸ¥è¯¢ç±»å‹</h1><h2 id="é€’å½’å¼-Recursive-Query"><a href="#é€’å½’å¼-Recursive-Query" class="headerlink" title="é€’å½’å¼(Recursive Query)"></a>é€’å½’å¼(Recursive Query)</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092118248.png"></p><h3 id="DNSè¯·æ±‚"><a href="#DNSè¯·æ±‚" class="headerlink" title="DNSè¯·æ±‚:"></a>DNSè¯·æ±‚:</h3><p>å¦‚ä¸‹, æ˜¯ä¸ªè¯·æ±‚ä¸­çš„æ ‡è¯†ä½, ä½¿ç”¨digå‘½ä»¤, </p><ul><li>å¦‚æœ<code>+trace</code>åˆ™è¯·æ±‚è‡ªåŠ¨ç¦ç”¨é€’å½’(å³å¦‚ä¸‹é€’å½’æ ‡è¯†è®¾ç½®ä¸ºfalse);<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082351183.png"></li><li>ä¸åŠ <code>+trace</code>, åˆ™è¯·æ±‚è‡ªåŠ¨ä½¿ç”¨é€’å½’.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092101659.png"></li></ul><h3 id="DNSå“åº”"><a href="#DNSå“åº”" class="headerlink" title="DNSå“åº”:"></a>DNSå“åº”:</h3><p>å¦‚ä¸‹, </p><ul><li>ä»£è¡¨å½“å‰LocalDNSæœåŠ¡å™¨æ”¯æŒé€’å½’æŸ¥è¯¢.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082352908.png"></li><li>ä¸æ­¤å½¢æˆé²œæ˜å¯¹æ¯”çš„æ˜¯ROOTæ ¹DNSæœåŠ¡å™¨è¿”å›ä¸æ”¯æŒé€’å½’æŸ¥è¯¢.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082353697.png"></li></ul><h2 id="è¿­ä»£å¼-Iterative-Query"><a href="#è¿­ä»£å¼-Iterative-Query" class="headerlink" title="è¿­ä»£å¼(Iterative Query)"></a>è¿­ä»£å¼(Iterative Query)</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092115451.png"></p><h1 id="dig-é‡è¦å‚æ•°ä¸æ¨¡å¼"><a href="#dig-é‡è¦å‚æ•°ä¸æ¨¡å¼" class="headerlink" title="dig é‡è¦å‚æ•°ä¸æ¨¡å¼"></a><code>dig</code> é‡è¦å‚æ•°ä¸æ¨¡å¼</h1><h2 id="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨"><a href="#æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨" class="headerlink" title="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨"></a>æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨</h2><h3 id="æ–¹å¼1-ä½¿ç”¨-traceå‚æ•°"><a href="#æ–¹å¼1-ä½¿ç”¨-traceå‚æ•°" class="headerlink" title="æ–¹å¼1: ä½¿ç”¨+traceå‚æ•°:"></a>æ–¹å¼1: ä½¿ç”¨<code>+trace</code>å‚æ•°:</h3><p>ä¾‹å¦‚ <code>dig @8.8.8.8 baidu.com +trace</code>: </p><ol><li>@8.8.8.8 åˆ™dig +traceæ—¶, ä»£è¡¨è·å–ROOT ServeråŸŸååˆ—è¡¨, ä¼šè¯·æ±‚8.8.8.8</li><li>ä¹‹åä¼šæŠŠæ¯ä¸ªROOT Serverçš„åŸŸå, ä¾‹å¦‚ a.root-servers.net b.root-servers.net ç­‰, è¯·æ±‚LocalDNS(å¦‚å›¾ä¸­çš„30.30.30.30), é€šè¿‡é€’å½’æ–¹å¼(recurse&#x3D;1), è·å–åˆ°å¯¹åº”çš„Aè®°å½•. æ³¨æ„, è¿™é‡Œå°±ä¸å†æ˜¯è¯·æ±‚ 8.8.8.8 äº†!!</li><li>ä¹‹åå†è¯·æ±‚æŸä¸ªROOT Server, è·å–åˆ°TLD Serverçš„åŸŸå. ä¾æ¬¡ç±»æ¨, èµ°æ­£å¸¸è¿­ä»£DNSæ–¹å¼.<br>æ‰€ä»¥ @x.x.x.x +trace, æœ¬è´¨ä¸Šæ˜¯ä» 8.8.8.8 è·å–åˆ°æ ¹åŸŸååœ°å€. ä¹‹åè¿˜æ˜¯èµ°çš„æ­£å¸¸è¿­ä»£æŸ¥è¯¢DNSæµç¨‹.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092122506.png"></li></ol><h3 id="æ–¹å¼2-ä¸ä½¿ç”¨-traceå‚æ•°"><a href="#æ–¹å¼2-ä¸ä½¿ç”¨-traceå‚æ•°" class="headerlink" title="æ–¹å¼2: ä¸ä½¿ç”¨+traceå‚æ•°:"></a>æ–¹å¼2: ä¸ä½¿ç”¨<code>+trace</code>å‚æ•°:</h3><p>ä¾‹å¦‚ <code>dig @8.8.8.8 baidu.com</code></p><ol><li>@8.8.8.8 åˆ™digæ—¶, ä¼šè¯·æ±‚8.8.8.8, è®©8.8.8.8é€šè¿‡é€’å½’æ–¹å¼, ç›´æ¥ç»™å‡ºå¯¹åº”baidu.comå¯¹åº”çš„IPåœ°å€.</li><li>æ³¨æ„: è¿™ç§å°±æ˜¯å®é™…å¸¸ç”¨çš„æ­£å¸¸DNSè§£ææµç¨‹.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092124056.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092125582.png"></li></ol><p>å¦‚ä¸‹å›¾, è¿™æ˜¯ä»æµè§ˆå™¨é‡Œè¾“å…¥baidu.comä¹‹åçš„DNSæµç¨‹, å¯çŸ¥æ˜¯é€’å½’å¼çš„:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092128420.png"></p><h3 id="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“"><a href="#æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“" class="headerlink" title="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“"></a>æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“</h3><p>å¦‚æœä¸æŒ‡å®š, åˆ™é»˜è®¤: </p><ol><li>è¯·æ±‚LocalDNS, é€šè¿‡ <code>cat /etc/resolv.conf</code> å¯çŸ¥LocalDNSçš„IP</li><li>è®©LocalDNSä½¿ç”¨é€’å½’çš„æ–¹å¼ç»™å‡ºç»“æœ.</li></ol><h2 id="æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ"><a href="#æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ" class="headerlink" title="æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ"></a>æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ</h2><p>é»˜è®¤DNSåè®®æ˜¯åŸºäºUDP 53ç«¯å£; ä½†ä¹Ÿå¯ä»¥åŸºäºTCP 53ç«¯å£å®Œæˆè¯·æ±‚.  </p><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dig</span> @8.8.8.8 baidu.com +tcp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="åŒ…è§£æ"><a href="#åŒ…è§£æ" class="headerlink" title="åŒ…è§£æ"></a>åŒ…è§£æ</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092204677.png"></p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>&#x2F;&#x2F; TODO:<br>&#x2F;&#x2F; 1. å¯ä»¥æ€è€ƒä¸‹ DNS over TCP(DoT) ä¸DNS over UDP(DoU)å„è‡ªçš„ä¼˜ç¼ºç‚¹<br>&#x2F;&#x2F; 2. è¿‘å‡ å¹´æœ‰ DNS over TLS; DNS over HTTP; DNS over HTTPS; ä¸ºå•¥ä¼šæœ‰è¿™ä¹ˆå¤šå¥—å¨ƒåè®®? æ˜¯ä¸ºäº†è§£å†³å•¥é—®é¢˜? ä¼˜ç¼ºç‚¹æ˜¯å•¥? </p><h1 id="WireSharkæŠ“åŒ…å®æˆ˜"><a href="#WireSharkæŠ“åŒ…å®æˆ˜" class="headerlink" title="WireSharkæŠ“åŒ…å®æˆ˜"></a>WireSharkæŠ“åŒ…å®æˆ˜</h1><h2 id="ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…"><a href="#ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…" class="headerlink" title="ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…"></a>ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…</h2><h3 id="å‘½ä»¤-1"><a href="#å‘½ä»¤-1" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°±ç®€å•åœ°å¯¹baidu.comè¿›è¡ŒDNSæŠ“åŒ…</span>davywalkerdeMBP:_assets davywalker$ <span class="token function">dig</span> baidu.com +trace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="traceè¿­ä»£å¼-WireSharkåˆ†æ"><a href="#traceè¿­ä»£å¼-WireSharkåˆ†æ" class="headerlink" title="+traceè¿­ä»£å¼, WireSharkåˆ†æ"></a><code>+trace</code>è¿­ä»£å¼, WireSharkåˆ†æ</h3><h4 id="ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–-å¯¹åº”çš„root-nameserver"><a href="#ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–-å¯¹åº”çš„root-nameserver" class="headerlink" title="ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–.å¯¹åº”çš„root nameserver"></a>ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–<code>.</code>å¯¹åº”çš„root nameserver</h4><h5 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>/etc/resolv.conf</code>ä¸­å¯¹åº”çš„LocalDNS IP</li><li>è¯·æ±‚æ˜¯UDPåè®®, ç›®æ ‡LocalDNSçš„ç«¯å£å·æ˜¯53</li><li>è¯·æ±‚å†…å®¹æ˜¯: <code>&lt;ROOT&gt;</code>, å³æ ¹åŸŸåDNS; ç±»å‹æ˜¯ <code>NS</code>, å³nameserver; å°±æ˜¯è¯·æ±‚æ ¹åŸŸåçš„nameserver<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082303614.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082259231.png"></li></ul><h5 id="å“åº”"><a href="#å“åº”" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>å“åº”å†…å®¹é‡Œæœ‰13ä¸ªæ ¹åŸŸåæœåŠ¡å™¨çš„åŸŸå </li><li>ä½†æ³¨æ„: <mark>æ²¡æœ‰è¿”å›nameserverçš„domainå¯¹åº”çš„IPåœ°å€!!!</mark> , ç»åˆ†æä¸æ¨æµ‹, ç”±äºå…¨çƒ13ä¸ªæ ¹åŸŸåæœåŠ¡å™¨çš„IPæ˜¯<del>æ°¸è¿œä¸ä¼šå˜</del>çš„(æœ‰å¯èƒ½ä¼šå˜åŒ–, <a href="https://web.archive.org/web/20130310100321/http://d.root-servers.org/renumber.html">å†å²ä¸Šä¹Ÿå˜åŒ–è¿‡</a>), å„ä¸ªdomainå¯¹åº”çš„IPåœ°å€åº”è¯¥æ˜¯<mark>é€šè¿‡<a href="https://www.iana.org/domains/root/files">Root Hint File</a>, ç¼“å­˜åœ¨æ“ä½œç³»ç»Ÿä¸­</mark>.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082306546.png"></li></ul><h4 id="ç¬¬äºŒæ­¥-å‘root-nameserverè¯·æ±‚-è¯·æ±‚è·å–-com-å¯¹åº”çš„TLDâ€™s-nameserver"><a href="#ç¬¬äºŒæ­¥-å‘root-nameserverè¯·æ±‚-è¯·æ±‚è·å–-com-å¯¹åº”çš„TLDâ€™s-nameserver" class="headerlink" title="ç¬¬äºŒæ­¥: å‘root nameserverè¯·æ±‚, è¯·æ±‚è·å–.com.å¯¹åº”çš„TLDâ€™s nameserver"></a>ç¬¬äºŒæ­¥: å‘root nameserverè¯·æ±‚, è¯·æ±‚è·å–<code>.com.</code>å¯¹åº”çš„TLDâ€™s nameserver</h4><h5 id="è¯·æ±‚-1"><a href="#è¯·æ±‚-1" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>202.12.27.33</code>, ç»åˆ†æ, æ˜¯<code>m.root-servers.net.</code>å¯¹åº”çš„IPåœ°å€. åº”è¯¥æ˜¯æŒ‰ç…§æŸç§ç®—æ³•éšæœºé€‰çš„.</li><li>è¯·æ±‚æƒ³è¦ç›´æ¥ä»root nameserverä¸­è·å–åˆ° baidu.com çš„Aè®°å½•<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082308662.png"></li></ul><h5 id="å“åº”-1"><a href="#å“åº”-1" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>å“åº”å†…å®¹é‡Œæœ‰13ä¸ª<code>.com.</code>åŸŸåæœåŠ¡å™¨çš„åŸŸå.</li><li>ä½†æ³¨æ„: <mark>åŒæ—¶åœ¨Additional recordséƒ¨åˆ†, æŠŠå„ä¸ªåŸŸåæœåŠ¡å™¨å¯¹åº”çš„IPä¹Ÿéƒ½ä»¥Aè®°å½•å½¢å¼è¿”å›</mark>. è¿™ä¸ªå°±æ˜¯æ‰€è°“çš„ <strong><a href="https://blog.csdn.net/dranker/article/details/109754755">Glue Record</a></strong>, è¯•æƒ³ä¸‹, å¦‚æœæ²¡æœ‰è¿”å›Aè®°å½•, é‚£ä¹ˆå¦‚æœ<code>.com.</code>è¿”å›çš„nameserveræ˜¯<code>a.com.</code>, é‚£ä¹ˆå¦‚ä½•è·å–åˆ°è¿™ä¸ªdomainå¯¹åº”çš„IP? é€šè¿‡DNSä¹ˆ? é‚£å°±æ— é™é€’å½’äº†!</li><li>Additional recordsä¸­<code>AAAA</code>è®°å½•, ä»£è¡¨çš„æ˜¯å„ä¸ªåŸŸåæœåŠ¡å™¨å¯¹åº”çš„IPV6åœ°å€.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082315463.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082321212.png"></li></ul><h4 id="ç¬¬ä¸‰æ­¥-å‘TLDâ€™s-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„authoritative-nameserver"><a href="#ç¬¬ä¸‰æ­¥-å‘TLDâ€™s-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„authoritative-nameserver" class="headerlink" title="ç¬¬ä¸‰æ­¥: å‘TLDâ€™s nameserverè¯·æ±‚, è¯·æ±‚è·å–baidu.com.å¯¹åº”çš„authoritative nameserver"></a>ç¬¬ä¸‰æ­¥: å‘TLDâ€™s nameserverè¯·æ±‚, è¯·æ±‚è·å–<code>baidu.com.</code>å¯¹åº”çš„authoritative nameserver</h4><h5 id="è¯·æ±‚-2"><a href="#è¯·æ±‚-2" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>192.31.80.30</code>, é€šè¿‡ç¿»çœ‹ä¸Šä¸€ä¸ªGlue Record, å¯ä»¥çŸ¥é“æ­£æ˜¯<code>d.gtld-servers.net: type A, class IN, addr 192.31.80.30</code>å¯¹åº”çš„IP.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082323511.png"></li></ul><h5 id="å“åº”-2"><a href="#å“åº”-2" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>å“åº”çš„å†…å®¹é‡Œæ²¡æœ‰<code>baidu.com</code>çš„Aè®°å½•ä¿¡æ¯, è€Œæ˜¯ä¸€å †çš„NSè®°å½•ä¿¡æ¯, ä»¥åŠNSå¯¹åº”çš„IP, å› æ­¤è¿˜éœ€è¦ç»§ç»­å¾€ä¸‹æŸ¥.</li><li>å¦‚æœæ˜¯æŸ¥è¯¢é¡¶çº§åŸŸå(ä¾‹å¦‚github.com), æˆ–è€…äºŒçº§åŸŸå(ä¾‹å¦‚login.github.com)ç­‰:  <ul><li>é‚£ä¹ˆç†è®ºä¸Šè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç›´æ¥è¿”å›Aè®°å½•äº†. å³ä¸ç”¨å†èµ°ç¬¬å››æ­¥äº†. æ­¤æ—¶Aè®°å½•å¯ä»¥æ˜¯ä¸ªVIP, ç„¶åæ ¹æ®è¯·æ±‚å…·ä½“çš„äºŒçº§åŸŸå, ä¾‹å¦‚<code>login.github.com</code>, é€šè¿‡Nginxç­‰åå‘ä»£ç†åˆ°å¯¹åº”æœåŠ¡å³å¯.</li><li>ä½†å®é™…åˆ†æäº†ä¸‹, å¤§éƒ¨åˆ†ç½‘ç«™(å¦‚ä¸‹å›¾ä¸­<code>alibaba.com</code>, <code>zhihu.com</code>, <code>aliyun.com</code>ç­‰), éƒ½æ˜¯åœ¨è¿™é‡Œè¿”å›è‡ªå·±çš„<code>authoritative nameserver</code>, è‡ªå·±æ€è€ƒäº†ä¸‹åŸå› : <ul><li>ä¸€æ˜¯: å› ä¸º TLDâ€™s nameserver é€šå¸¸æ˜¯ç”±å›½å®¶æˆ–è€…ç»„ç»‡ç»Ÿä¸€ç®¡ç†çš„, å„ä¸ªå…¬å¸å¦‚æœIPå˜åŒ–, ä¸å¥½åŒæ­¥åˆ° TLD ä¸­. è€Œ authoritative nameserver ä¸€èˆ¬éƒ½æ˜¯å„ä¸ªå…¬å¸è‡ªå·±ç®¡ç†, æ—¶æ•ˆæ€§ä¸çµæ´»æ€§éƒ½å¾ˆé«˜. ä¾‹å¦‚å¯ä»¥ç»™æŸäº›äºŒçº§&#x2F;ä¸‰çº§åŸŸåé…ç½®ä¸åŒçš„IP.  </li><li>äºŒæ˜¯: å› ä¸ºå¦‚æœç›´æ¥Aè®°å½•æ³¨å†Œåœ¨TLDä¸Š, é‚£ä¹ˆæ•´ä¸ªç½‘ç«™çš„æ‰€æœ‰äºŒçº§&#x2F;ä¸‰çº§åŸŸåç­‰, å°±åªèƒ½æœ‰ä¸€ä¸ªIPå…¥å£äº†. æ•´ä½“é£é™©å°±å¾ˆå¤§äº†. å¦‚æœVIPæŒ‚äº†, æ•´ä¸ªç½‘ç«™éƒ½ä¸å¯ç”¨äº†. å¦‚æœæ˜¯ä¸åŒçš„äºŒçº§åŸŸå, åˆ†é…ä¸åŒnameserver, åˆ™</li></ul></li></ul></li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082326335.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082343058.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082343720.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082344089.png"></p><h4 id="ç¬¬å››æ­¥-å‘authoritative-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„ip"><a href="#ç¬¬å››æ­¥-å‘authoritative-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„ip" class="headerlink" title="ç¬¬å››æ­¥: å‘authoritative nameserverè¯·æ±‚, è¯·æ±‚è·å–baidu.com.å¯¹åº”çš„ip"></a>ç¬¬å››æ­¥: å‘authoritative nameserverè¯·æ±‚, è¯·æ±‚è·å–<code>baidu.com.</code>å¯¹åº”çš„ip</h4><h5 id="è¯·æ±‚-3"><a href="#è¯·æ±‚-3" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°:</p><ul><li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>14.215.178.80</code>, é€šè¿‡ç¿»çœ‹ä¸Šä¸€ä¸ªGlue Record, å¯ä»¥çŸ¥é“æ­£æ˜¯<code>ns4.baidu.com: type A, class IN, addr 14.215.178.80</code>å¯¹åº”çš„IP.</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082345386.png"></p><h5 id="å“åº”-3"><a href="#å“åº”-3" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>æ­£ç¡®åœ°è¿”å›äº†<code>baidu.com</code>çš„Aè®°å½•<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082347974.png"></li></ul><h3 id="ä¸åŠ -traceé€’å½’å¼-WireSharkåˆ†æ"><a href="#ä¸åŠ -traceé€’å½’å¼-WireSharkåˆ†æ" class="headerlink" title="ä¸åŠ +traceé€’å½’å¼, WireSharkåˆ†æ"></a>ä¸åŠ <code>+trace</code>é€’å½’å¼, WireSharkåˆ†æ</h3><h4 id="ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–aliyun-comçš„IPåœ°å€-Aè®°å½•"><a href="#ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–aliyun-comçš„IPåœ°å€-Aè®°å½•" class="headerlink" title="ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–aliyun.comçš„IPåœ°å€(Aè®°å½•)"></a>ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–<code>aliyun.com</code>çš„IPåœ°å€(Aè®°å½•)</h4><h5 id="è¯·æ±‚-4"><a href="#è¯·æ±‚-4" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°:</p><ul><li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>/etc/resolv.conf</code>ä¸­å¯¹åº”çš„LocalDNS IP<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208090001833.png"></li></ul><h5 id="å“åº”-4"><a href="#å“åº”-4" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p><ul><li>LocalDNSç›´æ¥æŠŠDNSçš„Aè®°å½•ç»“æœè¿”å›äº†. æ‰€æœ‰çš„è¿­ä»£æ“ä½œéƒ½æ˜¯LocalDNSæ‰§è¡Œçš„äº†.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208090002803.png"></li></ul><h1 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h1><h2 id="åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜"><a href="#åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜" class="headerlink" title="åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜"></a>åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜</h2><p>DNSåè®®è¿”å›äº†æ ¹åŸŸåæœåŠ¡å™¨çš„åŸŸå, ä¾‹å¦‚<code>m.root-servers.net.</code>, ä½†å®é™…åç»­å‘æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢TLDåŸŸåæœåŠ¡å™¨çš„è¯·æ±‚æ—¶, æ˜¯éœ€è¦çŸ¥é“æ ¹åŸŸåæœåŠ¡å™¨çš„IPçš„! è¿™ä¸ªIPä»å“ªé‡Œè·å–? é€šè¿‡WireSharkæŠ“åŒ…, å‘ç°è¿”å›çš„æ ¹åŸŸåæœåŠ¡å™¨åŸŸååˆ—è¡¨é‡Œ, æ²¡æœ‰è¿™äº›åŸŸåå¯¹åº”çš„IPåœ°å€. éš¾é“ä¹Ÿæ˜¯é€šè¿‡DNSè§£æçš„ä¹ˆ? è¿™æ ·å°±æ¶‰åŠåˆ°å¾ªç¯.<br><mark> Glue Record </mark></p><h2 id="digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ"><a href="#digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ" class="headerlink" title="digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ?"></a>digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ?</h2><blockquote><p>åˆ‡æ¢æŸ¥è¯¢ä¸­çš„ RDï¼ˆè¦æ±‚é€’å½’ï¼‰ä½è®¾ç½®ã€‚<br>åœ¨ç¼ºçœæƒ…å†µä¸‹è®¾ç½®è¯¥ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ dig æ­£å¸¸æƒ…å½¢ä¸‹å‘é€é€’å½’æŸ¥è¯¢ã€‚<br>å½“ä½¿ç”¨æŸ¥è¯¢é€‰é¡¹ +nssearch æˆ– +trace æ—¶ï¼Œé€’å½’è‡ªåŠ¨ç¦ç”¨ã€‚</p></blockquote><h2 id="æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„"><a href="#æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„" class="headerlink" title="æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„?"></a>æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„?</h2><p>ä¾‹å¦‚ <code>dig passport.baidu.com +trace</code>, è¿”å›: </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">passport.baidu.com. <span class="token number">1200</span> IN CNAME passport.n.shifen.com.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åœ¨digè°ƒç”¨æµç¨‹ä¸­, åˆ°CNAMEå°±ç»“æŸäº†; å› ä¸ºæ²¡æœ‰ç»§ç»­æ‰§è¡Œ<code>dig passport.n.shifen.com +trace</code></li><li>ä½†åœ¨å®é™…æµè§ˆå™¨è®¿é—®æ—¶, æµè§ˆå™¨æ”¶åˆ°CNAMEè®°å½•, ä¼šé‡æ–°å‘ä¸€ä¸ªDNSè¯·æ±‚è§£æ<code>passport.n.shifen.com</code>åŸŸå.</li></ul><h2 id="ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ"><a href="#ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ" class="headerlink" title="ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ?"></a>ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ?</h2><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å¦‚ä¸‹, è¿”å›çš„<code>baidu.com</code>çš„Aè®°å½•<code>39.156.66.10</code>IPåœ°å€: </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">^CdavywalkerdeMBP:~ davywalker$ <span class="token function">dig</span> baidu.com<span class="token punctuation">;</span><span class="token punctuation">;</span> QUESTION SECTION:<span class="token punctuation">;</span>baidu.com.INA<span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:baidu.com.<span class="token number">1</span>INA<span class="token number">110.242</span>.68.66baidu.com.<span class="token number">1</span>INA<span class="token number">39.156</span>.66.10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ˜¯å¦å¯ä»¥ä¸ç”¨åŸŸåç›´æ¥é€šè¿‡IPè®¿é—®?</li><li>ç­”æ¡ˆæ˜¯<mark>ä¸å¯ä»¥</mark><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092137035.png"></li></ul><h3 id="ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ"><a href="#ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ" class="headerlink" title="ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ"></a>ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ</h3><ul><li>è™šæ‹Ÿä¸»æœºï¼Œä¸»æœºä¸Šæ”¾ç½®äº†Nä¸ªç½‘ç«™ï¼Œè€Œæ¯ä¸ªç½‘ç«™ç»‘å®š1ä¸ªæˆ–ä»¥ä¸ŠåŸŸåï¼Œæ‰€ä»¥ç”¨åŸŸåè®¿é—®ä¸»æœºå¯ä»¥è§£æåˆ°ç½‘ç«™ç›®å½•ï¼Œä½†ç”¨IPçš„è¯æœåŠ¡å™¨å°±ä¸çŸ¥é“è§£æåˆ°å“ªä¸ªç›®å½•äº†ï¼</li><li>ä¸ºäº†é¿å…åˆ«äººæŠŠæœªå¤‡æ¡ˆçš„åŸŸåè§£æåˆ°è‡ªå·±çš„æœåŠ¡å™¨IPè€Œå¯¼è‡´æœåŠ¡å™¨è¢«æ–­ç½‘; ç›®å‰å›½å†…å¾ˆå¤šæœºæˆ¿éƒ½è¦æ±‚ç½‘ç«™ä¸»å…³é—­ç©ºä¸»æœºå¤´ï¼Œé˜²æ­¢æœªå¤‡æ¡ˆçš„åŸŸåæŒ‡å‘è¿‡æ¥é€ æˆéº»çƒ¦</li><li>å¯èƒ½æ˜¯å‡ºäºå®‰å…¨çš„è€ƒè™‘, å¦‚æœç›´æ¥ä½¿ç”¨IPè®¿é—®, åˆ™HTTPSè¯ä¹¦æœ‰æ•ˆæ€§å°±æ— æ³•æ ¡éªŒäº†. è¿™æ ·è¢«é’“é±¼äº†ä¹Ÿä¸çŸ¥é“.</li></ul><h3 id="å®è·µ-å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®-ä»¥Nginxä¸ºä¾‹"><a href="#å®è·µ-å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®-ä»¥Nginxä¸ºä¾‹" class="headerlink" title="å®è·µ: å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®(ä»¥Nginxä¸ºä¾‹)"></a>å®è·µ: å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®(ä»¥Nginxä¸ºä¾‹)</h3><ul><li>å‚è§å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£: <a href="http://nginx.org/en/docs/http/request_processing.html">How to prevent processing requests with undefined server names</a></li><li>å®è·µå‚ç…§: <a href="https://davyjones2010.github.io/2022-08-09-nginx-scripts/#%E7%A6%81%E6%AD%A2%E9%80%9A%E8%BF%87IP%E8%AE%BF%E9%97%AE">Nginxé…ç½®-ç¦æ­¢é€šè¿‡IPè®¿é—®</a></li></ul><h3 id="å®è·µ-å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡-ä»¥Nginxä¸ºä¾‹"><a href="#å®è·µ-å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡-ä»¥Nginxä¸ºä¾‹" class="headerlink" title="å®è·µ: å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡(ä»¥Nginxä¸ºä¾‹)"></a>å®è·µ: å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡(ä»¥Nginxä¸ºä¾‹)</h3><ul><li>å‚è§å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£: <a href="http://nginx.org/en/docs/http/request_processing.html">How to prevent processing requests with undefined server names</a></li><li>å®è·µå‚ç…§: <a href="https://davyjones2010.github.io/2022-08-09-nginx-scripts/#%E5%8D%95Host%E5%A4%9A%E5%9F%9F%E5%90%8D-%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%90%8C%E6%9C%8D%E5%8A%A1">Nginxé…ç½®-å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡</a></li></ul><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul><li><a href="https://www.cloudflare.com/learning/dns/dns-server-types/">https://www.cloudflare.com/learning/dns/dns-server-types/</a></li><li><a href="https://www.jianshu.com/p/f6ef04bf6af2">https://www.jianshu.com/p/f6ef04bf6af2</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;DNSæœåŠ¡å™¨ç±»å‹&quot;&gt;&lt;a href=&quot;#DNSæœåŠ¡å™¨ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;DNSæœåŠ¡å™¨ç±»å‹&quot;&gt;&lt;/a&gt;DNSæœåŠ¡å™¨ç±»å‹&lt;/h1&gt;&lt;h2 id=&quot;root-nameserver&quot;&gt;&lt;a href=&quot;#root-nameserver&quot; class=&quot;headerlink&quot; title=&quot;root nameserver&quot;&gt;&lt;/a&gt;root nameserver&lt;/h2&gt;&lt;p&gt;å³è´Ÿè´£&lt;code&gt;.&lt;/code&gt;åŸŸåçš„, å…¨çƒåªæœ‰13å°(è‡³äºä¸ºå•¥åªæœ‰13å°, è‡ªå·±googleå§):  &lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;davywalkerdeMBP:_assets davywalker$ &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; baidu.com +trace

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; DiG &lt;span class=&quot;token number&quot;&gt;9.10&lt;/span&gt;.6 &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; baidu.com +trace
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; global options: +cmd
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	m.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	a.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	h.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	l.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	i.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	g.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	j.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	c.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	k.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	e.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	f.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	b.root-servers.net.
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;			&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;	IN	NS	d.root-servers.net.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Received &lt;span class=&quot;token number&quot;&gt;239&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.1.1&lt;span class=&quot;token comment&quot;&gt;#53(192.168.1.1) in 7 ms&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;TLD-Top-Level-Domain-nameserver&quot;&gt;&lt;a href=&quot;#TLD-Top-Level-Domain-nameserver&quot; class=&quot;headerlink&quot; title=&quot;TLD(Top Level Domain) nameserver&quot;&gt;&lt;/a&gt;TLD(Top Level Domain) nameserver&lt;/h2&gt;&lt;p&gt;å³å¯¹åº” &lt;code&gt;.com&lt;/code&gt;, &lt;code&gt;.gov&lt;/code&gt;, &lt;code&gt;.cn&lt;/code&gt; ç­‰çš„è§£ææœåŠ¡å™¨. &lt;/p&gt;
&lt;h2 id=&quot;authoritative-nameserver&quot;&gt;&lt;a href=&quot;#authoritative-nameserver&quot; class=&quot;headerlink&quot; title=&quot;authoritative nameserver&quot;&gt;&lt;/a&gt;authoritative nameserver&lt;/h2&gt;&lt;p&gt;å³å¯¹åº” &lt;code&gt;.baidu.com&lt;/code&gt; &lt;code&gt;.hangzhou.gov&lt;/code&gt;, &lt;code&gt;gitee.cn&lt;/code&gt; ç­‰çš„è§£ææœåŠ¡å™¨.&lt;br&gt;é€šå¸¸ authoritative nameserver æ˜¯DNSè§£æçš„æœ€åä¸€æ­¥&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The authoritative nameserver is usually the resolverâ€™s last step in the journey for an IP address.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;DNSæŸ¥è¯¢ç±»å‹&quot;&gt;&lt;a href=&quot;#DNSæŸ¥è¯¢ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;DNSæŸ¥è¯¢ç±»å‹&quot;&gt;&lt;/a&gt;DNSæŸ¥è¯¢ç±»å‹&lt;/h1&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://davyjones2010.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="dns" scheme="https://davyjones2010.github.io/tags/dns/"/>
    
    <category term="network" scheme="https://davyjones2010.github.io/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins Alibaba Cloud æ’ä»¶å¼€å‘æ€»ç»“</title>
    <link href="https://davyjones2010.github.io/2022-08-07-jenkins-cloud-plugin-dev-summary/"/>
    <id>https://davyjones2010.github.io/2022-08-07-jenkins-cloud-plugin-dev-summary/</id>
    <published>2022-08-07T14:31:55.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ"><a href="#Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ" class="headerlink" title="Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ"></a>Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ</h1><hr><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><h3 id="ERå›¾"><a href="#ERå›¾" class="headerlink" title="ERå›¾"></a>ERå›¾</h3><pre class="mermaid">erDiagram    Jenkins ||--o{ hudson_slaves_Cloud : contains    hudson_slaves_Cloud {        id name    }    hudson_slaves_Cloud ||--|{ SlaveTemplate : contains    SlaveTemplate {        id templateName    }    SlaveTemplate ||--o{ AlibabaEcsSpotFollower : "provision"    AlibabaEcsSpotFollower {        id ecsInstanceId    }    AlibabaEcsSpotFollower ||--|| SlaveComputer : createComputer    SlaveComputer {        id     }</pre><h3 id="å„Entityå…³è”å…³ç³»"><a href="#å„Entityå…³è”å…³ç³»" class="headerlink" title="å„Entityå…³è”å…³ç³»"></a>å„Entityå…³è”å…³ç³»</h3><p>&#x2F;&#x2F; TODO: å¾…è¡¥å……å®Œå–„.</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Jenkins</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h2 id="noDelayProvisioning"><a href="#noDelayProvisioning" class="headerlink" title="noDelayProvisioning"></a>noDelayProvisioning</h2><ul><li>å½“ä»»åŠ¡é˜Ÿåˆ—é‡Œæœ‰ä»»åŠ¡æ—¶, è‡ªåŠ¨ä¼šåœ¨ instanceFloorä¸instanceCap ä¹‹é—´è¿›è¡Œå¼¹æ€§åˆ›å»ºnode.</li></ul><p>&#x2F;&#x2F; TODO: å¾…è¡¥å……å®Œå–„.</p><h1 id="å…¶ä»–é‡è¦ä¿¡æ¯"><a href="#å…¶ä»–é‡è¦ä¿¡æ¯" class="headerlink" title="å…¶ä»–é‡è¦ä¿¡æ¯"></a>å…¶ä»–é‡è¦ä¿¡æ¯</h1><p>å¯¹è±¡åºåˆ—åŒ–åXMLæ–‡ä»¶è·¯å¾„:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token variable">$&#123;proj_path&#125;</span>/alibabacloud-ecs-plugin/work/config.xml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="æ’ä»¶å¼€å‘çš„ç»éªŒ"><a href="#æ’ä»¶å¼€å‘çš„ç»éªŒ" class="headerlink" title="æ’ä»¶å¼€å‘çš„ç»éªŒ"></a>æ’ä»¶å¼€å‘çš„ç»éªŒ</h1><hr><h2 id="è§„æ ¼é€‰æ‹©"><a href="#è§„æ ¼é€‰æ‹©" class="headerlink" title="è§„æ ¼é€‰æ‹©"></a>è§„æ ¼é€‰æ‹©</h2><p>åœ¨è§„æ ¼é€‰æ‹©æ , è®¾è®¡çš„æ—¶å€™ä¸ºäº†ç®€ä¾¿ç”¨æˆ·é€‰æ‹©:</p><ol><li>ä¸‹æ‹‰æ¡†æ–¹å¼, æ–¹ä¾¿ä¸ç†Ÿæ‚‰ECSçš„ç”¨æˆ·é€‰æ‹©</li><li>é»˜è®¤ä½¿ç”¨2C8G, å³ç‹¬äº«å‹æœ€å°è§„æ ¼. ä»è€Œå‡å°‘ä¸‹æ‹‰æ¡†è§„æ ¼é‡, ä¾¿äºå…¥é—¨.</li></ol><p>ä½†åœ¨å®é™…ä¼ä¸šçº§åœºæ™¯ä¸‹, ç”¨æˆ·</p><ol><li>éœ€è¦æœ‰å¤§è§„æ ¼, åŸºæœ¬éƒ½æ˜¯48Cä»¥ä¸Š, å³ 12xlarge, 16xlarge, 24xlarge çš„è§„æ ¼</li><li>æœ¬èº«ä½¿ç”¨ECS, å¯¹ECSè§„æ ¼ç†Ÿæ‚‰, æœ‰ç›®æ ‡è§„æ ¼.</li></ol><h2 id="SKUé€‰æ‹©"><a href="#SKUé€‰æ‹©" class="headerlink" title="SKUé€‰æ‹©"></a>SKUé€‰æ‹©</h2><ol><li>å•ä¸ªCloudProvider, åªæ”¯æŒä¸€ä¸ªSKU, æ•°é‡å¯ä»¥é€‰æ‹©å¤šä¸ª.<br>ä½†åœ¨å®é™…åœºæ™¯ä¸‹:</li><li>ç”¨æˆ·å¸Œæœ›åœ¨å¤šå¯ç”¨åŒº, å¤šè§„æ ¼, è¿™æ ·éœ€è¦é‡å¤é€ä¸€é…ç½®CloudProvider, éå¸¸éº»çƒ¦.</li></ol><h2 id="ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©"><a href="#ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©" class="headerlink" title="ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©"></a>ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©</h2><p>åœ¨ç³»ç»Ÿç›˜é€‰æ‹©é¡¹ä¸Š, è®¾è®¡çš„æ—¶å€™ä¸ºäº†ç®€ä¾¿ç”¨æˆ·ä¸Šæ‰‹:</p><ol><li>ä¸éœ€è¦ç”¨æˆ·å¡«å…¥ç³»ç»Ÿç›˜ç±»å‹, åˆ›å»ºECS(RunInstances)æ—¶ä¸ä¼ å…¥ç³»ç»Ÿç›˜ç±»å‹&amp;å¤§å°, ä»è€Œè®©ECSä½¿ç”¨çš„é»˜è®¤å€¼, å³cloud_efficiency</li><li>ä¸éœ€è¦ç”¨æˆ·å¡«å…¥ç³»ç»Ÿç›˜å¤§å°, å³ä½¿ç”¨é»˜è®¤çš„20GB</li></ol><p>ä½†åœ¨å®é™…åœºæ™¯ä¸‹, ç”¨æˆ·:</p><ol><li>é€‰æ‹©ecs.c7.xxxè§„æ ¼, 7ä»£è§„æ ¼ä¸æ”¯æŒcloud_efficiency, åªæ”¯æŒcloud_essd, å³RunInstancesæ¥å£å¿…é¡»ä¼ å…¥cloud_essdç³»ç»Ÿç›˜ç±»å‹</li></ol><h2 id="æ•°æ®ç›˜ç±»å‹"><a href="#æ•°æ®ç›˜ç±»å‹" class="headerlink" title="æ•°æ®ç›˜ç±»å‹"></a>æ•°æ®ç›˜ç±»å‹</h2><p>åœ¨æ•°æ®ç›˜é€‰é¡¹ä¸Š, ä¸ºäº†ç”¨æˆ·ä¸Šæ‰‹æ–¹ä¾¿:</p><ol><li>é»˜è®¤ä¸åˆ›å»º&amp;æŒ‚è½½ç³»ç»Ÿç›˜, å› æ­¤ä¸éœ€è¦ç”¨æˆ·é€‰æ‹©æ•°æ®ç›˜ç±»å‹&amp;æ•°æ®ç›˜å¤§å°<br>ä½†åœ¨å®é™…åœºæ™¯ä¸‹, ç”¨æˆ·:</li><li>ä¼šæœ‰å…¨é•œåƒ, å³é•œåƒä¸­æ—¢åŒ…å«ç³»ç»Ÿç›˜, åˆåŒ…å«æ•°æ®ç›˜</li></ol><h2 id="Masterä¸Slaveé€šä¿¡æ–¹å¼"><a href="#Masterä¸Slaveé€šä¿¡æ–¹å¼" class="headerlink" title="Masterä¸Slaveé€šä¿¡æ–¹å¼"></a>Masterä¸Slaveé€šä¿¡æ–¹å¼</h2><p>JenkinsMasterä¸Slaveçš„è”é€šæ–¹å¼, è®¾è®¡çš„æ—¶å€™ä¸ºäº†æ–¹ä¾¿åº”å¯¹ç”¨æˆ·Masteråœ¨äº‘ä¸Š&#x2F;å…¶ä»–äº‘ä¸Š&#x2F;äº‘ä¸‹ç­‰åœºæ™¯, é»˜è®¤ä¸ºSlaveåˆ›å»ºå…¬ç½‘IP, ä»è€ŒMasteré€šè¿‡å…¬ç½‘IPä¸Slaveè”é€š.<br>ä½†åœ¨å®é™…åœºæ™¯ä¸‹:</p><ol><li>åˆ›å»ºå…¬ç½‘IPä¼šå¯¼è‡´é¢‘ç¹çš„æ”»å‡».<pre class="line-numbers language-java" data-language="java"><code class="language-java">ã€XXXã€‘å°Šæ•¬çš„xxxxï¼šäº‘å®‰å…¨ä¸­å¿ƒæ£€æµ‹åˆ°æ¶æ„XX<span class="token punctuation">.</span>XX<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxxæ­£åœ¨å°è¯•æ”»å‡»æ‚¨çš„æœåŠ¡å™¨ï¼šXX<span class="token punctuation">.</span>XX<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxxï¼ˆXX<span class="token operator">-</span>XX<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>ï¼‰ï¼Œå·²ä¸ºæ‚¨åˆ›å»ºIPæ‹¦æˆªç­–ç•¥ï¼Œå¹¶æˆåŠŸæ‹¦æˆªè¯¥æ¶æ„IPï¼Œå»ºè®®æ‚¨ç™»å½•äº‘å®‰å…¨ä¸­å¿ƒæ§åˆ¶å°å®‰å…¨å‘Šè­¦é¡µä¸­æŸ¥çœ‹IPæ‹¦æˆªç­–ç•¥ã€‚è‹¥æ‚¨éœ€è¦æ”¾è¡Œè¯¥ IP ï¼Œæ‚¨å¯ä»¥åœ¨IP æ‹¦æˆªç­–ç•¥ä¸­ç¦ç”¨å®‰å…¨ç­–ç•¥ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li>ç”¨æˆ·æœ¬èº«VPCå°±æ˜¯åœ¨é˜¿é‡Œäº‘ä¸Š, é€šè¿‡å…¬ç½‘è¿æ¥, ä¼šäº§ç”Ÿé¢å¤–çš„è´¹ç”¨.</li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ&quot;&gt;&lt;/a&gt;Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ&lt;/h1&gt;&lt;hr&gt;
&lt;h2 id=&quot;æ¶æ„&quot;&gt;&lt;a href=&quot;#æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;æ¶æ„&quot;&gt;&lt;/a&gt;æ¶æ„&lt;/h2&gt;&lt;h3 id=&quot;ERå›¾&quot;&gt;&lt;a href=&quot;#ERå›¾&quot; class=&quot;headerlink&quot; title=&quot;ERå›¾&quot;&gt;&lt;/a&gt;ERå›¾&lt;/h3&gt;&lt;pre class=&quot;mermaid&quot;&gt;erDiagram
    Jenkins ||--o{ hudson_slaves_Cloud : contains
    hudson_slaves_Cloud {
        id name
    }
    hudson_slaves_Cloud ||--|{ SlaveTemplate : contains
    SlaveTemplate {
        id templateName
    }
    SlaveTemplate ||--o{ AlibabaEcsSpotFollower : &quot;provision&quot;
    AlibabaEcsSpotFollower {
        id ecsInstanceId
    }
    AlibabaEcsSpotFollower ||--|| SlaveComputer : createComputer
    SlaveComputer {
        id 
    }&lt;/pre&gt;

&lt;h3 id=&quot;å„Entityå…³è”å…³ç³»&quot;&gt;&lt;a href=&quot;#å„Entityå…³è”å…³ç³»&quot; class=&quot;headerlink&quot; title=&quot;å„Entityå…³è”å…³ç³»&quot;&gt;&lt;/a&gt;å„Entityå…³è”å…³ç³»&lt;/h3&gt;&lt;p&gt;&amp;#x2F;&amp;#x2F; TODO: å¾…è¡¥å……å®Œå–„.&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Jenkins&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ¦‚å¿µ&lt;/h2&gt;&lt;h2 id=&quot;noDelayProvisioning&quot;&gt;&lt;a href=&quot;#noDelayProvisioning&quot; class=&quot;headerlink&quot; title=&quot;noDelayProvisioning&quot;&gt;&lt;/a&gt;noDelayProvisioning&lt;/h2&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://davyjones2010.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="jenkins" scheme="https://davyjones2010.github.io/tags/jenkins/"/>
    
    <category term="ci" scheme="https://davyjones2010.github.io/tags/ci/"/>
    
    <category term="ci/cd" scheme="https://davyjones2010.github.io/tags/ci-cd/"/>
    
  </entry>
  
  <entry>
    <title>çæŠ˜è…¾è½¯è·¯ç”±ç¬”è®°</title>
    <link href="https://davyjones2010.github.io/2022-08-07-software-based-router/"/>
    <id>https://davyjones2010.github.io/2022-08-07-software-based-router/</id>
    <published>2022-08-07T12:38:43.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<p>åƒåœ¾ä½¬çš„å‘¨æœ«, æ²¡äº‹å„¿å°±æ˜¯çæŠ˜è…¾, å‰æ®µæ—¶é—´è¢«ç§è‰äº†è½¯è·¯ç”±, ä¸€ç›´å¿ƒç—’ç—’. æœˆåº•ä¸‹å•å¥¢ä¾ˆä¸€æŠŠ, ä»Šå¤©ç»™å½»åº•æèµ·æ¥äº†. ç°åœ¨æ€»ç»“ä¸‹.</p><h1 id="ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±"><a href="#ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±" class="headerlink" title="ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±?"></a>ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±?</h1><p>æœ‰å‡ ä¸ªåŸå› : </p><ol><li>å®¶é‡Œçš„Android(V2RayNG), Mac(ClashX), Windows, Ubuntuç­‰è®¾å¤‡éƒ½æœ‰ç›¸å…³è½¯ä»¶èƒ½ç§‘å­¦ä¸Šç½‘; ä½†iPad, iPhoneç­‰è®¾å¤‡, å®‰è£…å°ç«ç®­, å¿…é¡»è¦ç™»å½•æµ·å¤–AppStore, è€Œä¸”è½¯ä»¶è¿˜æ”¶è´¹, å¤ªéº»çƒ¦, å› æ­¤æ²¡æœ‰é…ç½®ç§‘å­¦ä¸Šç½‘. å¯¹å¼ºè¿«ç—‡æ‚£è€…æ¥è¯´, ç®€ç›´æ˜¯ç¾éš¾.</li><li>æƒ³è¦å¯¹ç½‘ç»œè®¾å¤‡çš„å·¥ä½œåŸç†èƒ½æœ‰æ›´æ·±å…¥çš„ç†è§£. ä¾‹å¦‚è·¯ç”±å™¨çš„åº•å±‚å·¥ä½œåŸç†, å®é™…çš„è·¯ç”±è¡¨æ˜¯å’‹æ ·çš„? ä¹‹å‰ä½¿ç”¨åä¸ºçš„è·¯ç”±å™¨, è¿™äº›æƒé™å®Œå…¨æ˜¯æ²¡æœ‰çš„, ä¹Ÿæ²¡åŠæ³•çœ‹åˆ°è¿™äº›çš„. å¯¹äºè¶Šç‹±ç‹‚é­”æ¥è¯´, ä¹ŸåŒæ ·æ˜¯ç¾éš¾.</li><li>å®¶é‡Œçš„è·¯ç”±å™¨æ˜æ˜¾æ„Ÿè§‰åŠ›ä¸ä»å¿ƒ, 100Mçš„å¸¦å®½, å¹³å¸¸æ ¹æœ¬è·‘ä¸æ»¡, å°±å¼€å§‹å‘çƒ­. </li><li>IPTVå…±äº«: <ol><li>æ— æ³•å•Šå¿å—ä¸‘é™‹çš„ç”µä¿¡æœºé¡¶ç›’(çƒ½ç« HG680-J), è®¾è®¡å¾—ä¸‘é™‹ä¸å ª, é¥æ§å™¨å·¨éš¾ç”¨; </li><li>åªèƒ½åœ¨å®¢å…ä½¿ç”¨, å§å®¤é‡Œä¹Ÿæƒ³è¿æ¥IPTV, ä½†æ˜¯è¿æ¥ä¸ä¸Š.</li></ol></li></ol><p>è½¯è·¯ç”±æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä½åŠŸè€—çš„x86æœºå™¨, åº”è¯¥èƒ½å¾ˆå¥½åœ°è§£å†³ä¸Šè¾¹çš„é—®é¢˜. </p><h1 id="é…ç½®æ¸…å•"><a href="#é…ç½®æ¸…å•" class="headerlink" title="é…ç½®æ¸…å•"></a>é…ç½®æ¸…å•</h1><table><thead><tr><th>é…ä»¶åç§°</th><th>å“ç‰Œ</th><th>ä»·æ ¼</th><th>è¯¦ç»†è¯´æ˜</th></tr></thead><tbody><tr><td>ä¸»æœº</td><td><a href="https://detail.tmall.com/item.htm?id=673002078011&spm=a1z09.2.0.0.237b2e8dIxvpd0&_u=77rqrdmc3b6">å€æ§</a></td><td>729</td><td>è£¸æœº,</td></tr><tr><td>CPU</td><td><a href="https://www.intel.com/content/www/us/en/products/sku/212328/intel-celeron-processor-n5105-4m-cache-up-to-2-90-ghz/specifications.html">Intel N5105</a></td><td>æ— , åŒ…å«åœ¨ä¸»æœºé‡Œ</td><td>ç¬¬11ä»£, Jasper Lake; 4Core; 10nm; Base 2GHz, Burst 2.9GHz; 4MB L3 Cache; 10W TDP</td></tr><tr><td>å†…å­˜</td><td>ä¸‰æ˜Ÿ</td><td>380*2</td><td>16GB * 2(ç»„æˆåŒé€šé“); DDR4; 3200MHz;</td></tr><tr><td>é—ªå­˜</td><td>è¥¿æ•° SN570</td><td>350</td><td>500GB; NVME</td></tr><tr><td>ç½‘å¡</td><td>Intel I225-V</td><td>æ— , åŒ…å«åœ¨ä¸»æœºé‡Œ</td><td>4ä¸ªç‰©ç†ç½‘å£&#x2F;å¡; 1000Mbps</td></tr></tbody></table><p>åˆè®¡: <code>729 + 380*2 + 350 = 1839</code>, å‡ ä¹å¯ä»¥è¯´æ˜¯ç›®å‰å·¥æ§æœºçš„é¡¶é…äº†.</p><div class="note warning"><p>å†…å­˜é¢‘ç‡é™åˆ¶<br>CPUæ”¯æŒçš„å†…å­˜é¢‘ç‡æœ€å¤§ä¸º<code>2933 MHz</code>, å› æ­¤ä½¿ç”¨çš„ DDR4 <code>3200MHz</code> è¢«è‡ªåŠ¨é™é¢‘åˆ°äº†<code>2933 MHz</code>;</p></div><h1 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h1><h2 id="OpenWrtå®‰è£…"><a href="#OpenWrtå®‰è£…" class="headerlink" title="OpenWrtå®‰è£…"></a>OpenWrtå®‰è£…</h2><p>è£¸æœºä¸Šå®‰è£…OpenWrt, é…ç½®æ­¥éª¤ç›´æ¥çœ‹å°ç”µè§†: <a href="https://www.bilibili.com/video/BV1w541157Uo?spm_id_from=333.880.my_history.page.click&amp;vd_source=25b2aadfc1b4b676c371c31423142e7b">https://www.bilibili.com/video/BV1w541157Uo?spm_id_from=333.880.my_history.page.click&amp;vd_source=25b2aadfc1b4b676c371c31423142e7b</a></p><h2 id="æ’ä»¶é…ç½®"><a href="#æ’ä»¶é…ç½®" class="headerlink" title="æ’ä»¶é…ç½®"></a>æ’ä»¶é…ç½®</h2><ul><li>OpenClash: &#x2F;&#x2F; TODO:</li></ul><h1 id="ç½‘ç»œæ‹“æ‰‘"><a href="#ç½‘ç»œæ‹“æ‰‘" class="headerlink" title="ç½‘ç»œæ‹“æ‰‘"></a>ç½‘ç»œæ‹“æ‰‘</h1><p>ç”±äºå®¶é‡Œçš„ç½‘ç»œæ˜¯FTTB(Fiber-To-The-Building)çš„, å› æ­¤æ²¡æœ‰å…‰çŒ«, åªæœ‰ä¸€æ ¹å…¥æˆ·çº¿. </p><h2 id="è½¯è·¯ç”±æ”¹é€ å‰"><a href="#è½¯è·¯ç”±æ”¹é€ å‰" class="headerlink" title="è½¯è·¯ç”±æ”¹é€ å‰"></a>è½¯è·¯ç”±æ”¹é€ å‰</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072212775.png"></p><h2 id="è½¯è·¯ç”±æ”¹é€ å"><a href="#è½¯è·¯ç”±æ”¹é€ å" class="headerlink" title="è½¯è·¯ç”±æ”¹é€ å"></a>è½¯è·¯ç”±æ”¹é€ å</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072216377.png"></p><h1 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h1><h2 id="æ•ˆæœé¢„è§ˆ"><a href="#æ•ˆæœé¢„è§ˆ" class="headerlink" title="æ•ˆæœé¢„è§ˆ"></a>æ•ˆæœé¢„è§ˆ</h2><ol><li>å®‰è£…å¥½ <a href="https://github.com/vernesong/OpenClash">OpenClash</a> æ’ä»¶, å±€åŸŸç½‘å†…ç§‘å­¦ä¸Šç½‘æ— å¿§.  </li><li>ç›´æ¥SSHä¸Šå», çœ‹åˆ°ä»»ä½•çš„ç½‘ç»œç›¸å…³ä¿¡æ¯:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072139468.png" alt="ARPè¡¨"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072140766.png" alt="è·¯ç”±è¡¨"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072141717.png" alt="ç½‘æ¡¥"></li><li>ç½‘é€ŸåŸºæœ¬èƒ½è·‘æ»¡:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072137732.png"></li><li>IPTVå…±äº«: ç›®å‰è¿˜æœªå®ç°, æ¶‰åŠåˆ°ç»„æ’­+vLanç­‰, è¿˜åœ¨ç ”ç©¶ä¸­.</li></ol><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>CPU Loadæä½, é•¿æœŸç»´æŒåœ¨0.1-;</li><li>MEM ä½¿ç”¨æ¯”ä¾‹æä½, é•¿æœŸå¯ç”¨å†…å­˜ç»´æŒåœ¨96%+;</li><li>èµ„æºå®Œå…¨æ²¡æœ‰å……åˆ†åˆ©ç”¨èµ·æ¥!<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072130374.png"></li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»ä½“æ¥è¯´, è™½ç„¶è¾¾åˆ°äº†éƒ¨åˆ†ç›®æ ‡, ä½†è¿˜æ˜¯å¤§æå°ç”¨äº†! åè¾¹è®¡åˆ’æœ‰å‡ ç§æ–¹æ¡ˆæ¥å……åˆ†å‹æ¦¨: </p><ul><li>å¤šè·‘å‡ ä¸ªdockerå®¹å™¨, ä¾‹å¦‚æ­å»ºJenkins, GitLab, Nginx, Redis; æ–¹ä¾¿è‡ªå·±å¹³å¸¸çš„å‹æµ‹éªŒè¯. </li><li>æ”¹æˆè£¸æœºä¸Šåˆ·esxi, æ­å»ºå‡ ä¸ªè™šæ‹Ÿæœº, æŠŠOpenWrtæ”¾åœ¨å…¶ä¸­ä¸€ä¸ªè™šæ‹Ÿæœºé‡Œ, å…¶ä»–çš„Ubuntu, Windowsç­‰ä½œä¸ºæ—¥å¸¸ä¼‘é—²å¨±ä¹æœº.</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;åƒåœ¾ä½¬çš„å‘¨æœ«, æ²¡äº‹å„¿å°±æ˜¯çæŠ˜è…¾, å‰æ®µæ—¶é—´è¢«ç§è‰äº†è½¯è·¯ç”±, ä¸€ç›´å¿ƒç—’ç—’. æœˆåº•ä¸‹å•å¥¢ä¾ˆä¸€æŠŠ, ä»Šå¤©ç»™å½»åº•æèµ·æ¥äº†. ç°åœ¨æ€»ç»“ä¸‹.&lt;/p&gt;
&lt;h1 id=&quot;ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±&quot;&gt;&lt;a href=&quot;#ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±?&quot;&gt;&lt;/a&gt;ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±?&lt;/h1&gt;&lt;p&gt;æœ‰å‡ ä¸ªåŸå› : &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¶é‡Œçš„Android(V2RayNG), Mac(ClashX), Windows, Ubuntuç­‰è®¾å¤‡éƒ½æœ‰ç›¸å…³è½¯ä»¶èƒ½ç§‘å­¦ä¸Šç½‘; ä½†iPad, iPhoneç­‰è®¾å¤‡, å®‰è£…å°ç«ç®­, å¿…é¡»è¦ç™»å½•æµ·å¤–AppStore, è€Œä¸”è½¯ä»¶è¿˜æ”¶è´¹, å¤ªéº»çƒ¦, å› æ­¤æ²¡æœ‰é…ç½®ç§‘å­¦ä¸Šç½‘. å¯¹å¼ºè¿«ç—‡æ‚£è€…æ¥è¯´, ç®€ç›´æ˜¯ç¾éš¾.&lt;/li&gt;
&lt;li&gt;æƒ³è¦å¯¹ç½‘ç»œè®¾å¤‡çš„å·¥ä½œåŸç†èƒ½æœ‰æ›´æ·±å…¥çš„ç†è§£. ä¾‹å¦‚è·¯ç”±å™¨çš„åº•å±‚å·¥ä½œåŸç†, å®é™…çš„è·¯ç”±è¡¨æ˜¯å’‹æ ·çš„? ä¹‹å‰ä½¿ç”¨åä¸ºçš„è·¯ç”±å™¨, è¿™äº›æƒé™å®Œå…¨æ˜¯æ²¡æœ‰çš„, ä¹Ÿæ²¡åŠæ³•çœ‹åˆ°è¿™äº›çš„. å¯¹äºè¶Šç‹±ç‹‚é­”æ¥è¯´, ä¹ŸåŒæ ·æ˜¯ç¾éš¾.&lt;/li&gt;
&lt;li&gt;å®¶é‡Œçš„è·¯ç”±å™¨æ˜æ˜¾æ„Ÿè§‰åŠ›ä¸ä»å¿ƒ, 100Mçš„å¸¦å®½, å¹³å¸¸æ ¹æœ¬è·‘ä¸æ»¡, å°±å¼€å§‹å‘çƒ­. &lt;/li&gt;
&lt;li&gt;IPTVå…±äº«: &lt;ol&gt;
&lt;li&gt;æ— æ³•å•Šå¿å—ä¸‘é™‹çš„ç”µä¿¡æœºé¡¶ç›’(çƒ½ç« HG680-J), è®¾è®¡å¾—ä¸‘é™‹ä¸å ª, é¥æ§å™¨å·¨éš¾ç”¨; &lt;/li&gt;
&lt;li&gt;åªèƒ½åœ¨å®¢å…ä½¿ç”¨, å§å®¤é‡Œä¹Ÿæƒ³è¿æ¥IPTV, ä½†æ˜¯è¿æ¥ä¸ä¸Š.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è½¯è·¯ç”±æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä½åŠŸè€—çš„x86æœºå™¨, åº”è¯¥èƒ½å¾ˆå¥½åœ°è§£å†³ä¸Šè¾¹çš„é—®é¢˜. &lt;/p&gt;
&lt;h1 id=&quot;é…ç½®æ¸…å•&quot;&gt;&lt;a href=&quot;#é…ç½®æ¸…å•&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®æ¸…å•&quot;&gt;&lt;/a&gt;é…ç½®æ¸…å•&lt;/h1&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é…ä»¶åç§°&lt;/th&gt;
&lt;th&gt;å“ç‰Œ&lt;/th&gt;
&lt;th&gt;ä»·æ ¼&lt;/th&gt;
&lt;th&gt;è¯¦ç»†è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;ä¸»æœº&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://detail.tmall.com/item.htm?id=673002078011&amp;spm=a1z09.2.0.0.237b2e8dIxvpd0&amp;_u=77rqrdmc3b6&quot;&gt;å€æ§&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;729&lt;/td&gt;
&lt;td&gt;è£¸æœº,&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CPU&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://www.intel.com/content/www/us/en/products/sku/212328/intel-celeron-processor-n5105-4m-cache-up-to-2-90-ghz/specifications.html&quot;&gt;Intel N5105&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ— , åŒ…å«åœ¨ä¸»æœºé‡Œ&lt;/td&gt;
&lt;td&gt;ç¬¬11ä»£, Jasper Lake; 4Core; 10nm; Base 2GHz, Burst 2.9GHz; 4MB L3 Cache; 10W TDP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å†…å­˜&lt;/td&gt;
&lt;td&gt;ä¸‰æ˜Ÿ&lt;/td&gt;
&lt;td&gt;380*2&lt;/td&gt;
&lt;td&gt;16GB * 2(ç»„æˆåŒé€šé“); DDR4; 3200MHz;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é—ªå­˜&lt;/td&gt;
&lt;td&gt;è¥¿æ•° SN570&lt;/td&gt;
&lt;td&gt;350&lt;/td&gt;
&lt;td&gt;500GB; NVME&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘å¡&lt;/td&gt;
&lt;td&gt;Intel I225-V&lt;/td&gt;
&lt;td&gt;æ— , åŒ…å«åœ¨ä¸»æœºé‡Œ&lt;/td&gt;
&lt;td&gt;4ä¸ªç‰©ç†ç½‘å£&amp;#x2F;å¡; 1000Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;åˆè®¡: &lt;code&gt;729 + 380*2 + 350 = 1839&lt;/code&gt;, å‡ ä¹å¯ä»¥è¯´æ˜¯ç›®å‰å·¥æ§æœºçš„é¡¶é…äº†.&lt;/p&gt;
&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;å†…å­˜é¢‘ç‡é™åˆ¶&lt;br&gt;CPUæ”¯æŒçš„å†…å­˜é¢‘ç‡æœ€å¤§ä¸º&lt;code&gt;2933 MHz&lt;/code&gt;, å› æ­¤ä½¿ç”¨çš„ DDR4 &lt;code&gt;3200MHz&lt;/code&gt; è¢«è‡ªåŠ¨é™é¢‘åˆ°äº†&lt;code&gt;2933 MHz&lt;/code&gt;;&lt;/p&gt;
&lt;/div&gt;


&lt;h1 id=&quot;å®‰è£…æ­¥éª¤&quot;&gt;&lt;a href=&quot;#å®‰è£…æ­¥éª¤&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…æ­¥éª¤&quot;&gt;&lt;/a&gt;å®‰è£…æ­¥éª¤&lt;/h1&gt;</summary>
    
    
    
    <category term="çæŠ˜è…¾" scheme="https://davyjones2010.github.io/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="network" scheme="https://davyjones2010.github.io/tags/network/"/>
    
    <category term="open-wrt" scheme="https://davyjones2010.github.io/tags/open-wrt/"/>
    
    <category term="software-based-router" scheme="https://davyjones2010.github.io/tags/software-based-router/"/>
    
    <category term="router" scheme="https://davyjones2010.github.io/tags/router/"/>
    
  </entry>
  
  <entry>
    <title>ä»GitHub CLIç¦æ­¢ç”¨æˆ·åå¯†ç ç™»å½•å¼•å‘çš„æ€è€ƒä¸æ€»ç»“</title>
    <link href="https://davyjones2010.github.io/2022-07-23-github-token-login/"/>
    <id>https://davyjones2010.github.io/2022-07-23-github-token-login/</id>
    <published>2022-07-23T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨æœ¬åœ°CLIä¸­push githubä»£ç æ—¶, è¦æ±‚è¾“å…¥ç”¨æˆ·åå¯†ç , ä½†è¾“å…¥å¯†ç ä¹‹å, æç¤ºç¦æ­¢ä½¿ç”¨å¯†ç ç™»å½•.</p><ul><li>æ ¹æ®æç¤ºé…ç½®äº†åŠå¤©SSHå…ç™», ç»“æœå‘ç°å¹¶ä¸ç”Ÿæ•ˆ, pushæ—¶ä»ç„¶è®©è¾“å…¥è´¦å·åå¯†ç .</li><li>åç»­æ ¹æ®æç¤º, åœ¨<a href="https://github.com/settings/tokens">GitHubé¡µé¢æ–°ç”³è¯·äº†Token</a>, ç„¶åä½¿ç”¨ ç”¨æˆ·å+Token ç™»å½•å°±å¯ä»¥äº†.<br>ä»è€Œå¼•å‘äº†è¯¸å¤šç–‘é—®ä¸æ€è€ƒ.</li></ul><h1 id="GitHubè®¿é—®å‡ ç§æ–¹å¼"><a href="#GitHubè®¿é—®å‡ ç§æ–¹å¼" class="headerlink" title="GitHubè®¿é—®å‡ ç§æ–¹å¼"></a>GitHubè®¿é—®å‡ ç§æ–¹å¼</h1><h2 id="æ–¹æ¡ˆ1-SSHæ–¹å¼"><a href="#æ–¹æ¡ˆ1-SSHæ–¹å¼" class="headerlink" title="æ–¹æ¡ˆ1: SSHæ–¹å¼"></a>æ–¹æ¡ˆ1: SSHæ–¹å¼</h2><h3 id="é…ç½®æ–¹å¼"><a href="#é…ç½®æ–¹å¼" class="headerlink" title="é…ç½®æ–¹å¼"></a>é…ç½®æ–¹å¼</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242155452.png"></p><p>è¿™ç§æ–¹å¼, å¯ä»¥é€šè¿‡é…ç½®SSHå…ç™»å³å¯.</p><h3 id="å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey"><a href="#å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey" class="headerlink" title="å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey?"></a>å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey?</h3><p>å¦‚æœåœ¨æœ¬åœ°, æ—¢éœ€è¦é…ç½®giteeçš„SSHå…ç™», åˆéœ€è¦é…ç½®githubçš„SSHå…ç™», æœ‰éœ€è¦é…ç½®å…¶ä»–Hostçš„SSHå…ç™», æ€ä¹ˆèƒ½è®©ä¸åŒçš„Hostä½¿ç”¨ä¸åŒçš„å…¬ç§é’¥å¯¹?</p><ul><li>é…ç½®æ ·ä¾‹å¦‚ä¸‹:</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> ~/.ssh/config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- ä¸º git@gitee.com:/xxx sshåœ°å€é…ç½®Host gitee.com  HostName gitee.com  AddKeysToAgent <span class="token function">yes</span>  UseKeychain <span class="token function">yes</span>  IdentityFile ~/.ssh/id_rsa-- ä¸º git@github.com:xxx/xxx sshåœ°å€é…ç½®Host github.com  HostName github.com  AddKeysToAgent <span class="token function">yes</span>  UseKeychain <span class="token function">yes</span>  IdentityFile ~/.ssh/id_ed25519-- å…¶ä»–åœ°å€é»˜è®¤sshåœ°å€é…ç½®Host *  AddKeysToAgent <span class="token function">yes</span>  UseKeychain <span class="token function">yes</span>  IdentityFile ~/.ssh/id_ed25519<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>éªŒè¯æ˜¯å¦é…ç½®æ­£ç¡®:</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>davywalker@davywalkers-MacBook-Pro ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> git@github.comPTY allocation request failed on channel <span class="token number">1</span>Hi DavyJones2010<span class="token operator">!</span> You've successfully authenticated, but GitHub does not provide shell access.Connection to github.com closed.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–¹æ¡ˆ2-HTTPSæ–¹å¼"><a href="#æ–¹æ¡ˆ2-HTTPSæ–¹å¼" class="headerlink" title="æ–¹æ¡ˆ2: HTTPSæ–¹å¼"></a>æ–¹æ¡ˆ2: HTTPSæ–¹å¼</h2><h3 id="é…ç½®æ–¹å¼-1"><a href="#é…ç½®æ–¹å¼-1" class="headerlink" title="é…ç½®æ–¹å¼"></a>é…ç½®æ–¹å¼</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242155904.png"></p><p>è¿™ç§æ–¹å¼, å³èƒŒæ™¯ä¸­çš„æ¡ˆä¾‹, å¿…é¡»é€šè¿‡ ç”¨æˆ·å+Tokenæ–¹å¼ ç™»å½•, å³CLIä¸­å¯†ç å­—æ®µ, ä¸è¦è¾“å…¥è´¦å·çš„å¯†ç , è€Œæ˜¯è¾“å…¥Token</p><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242158549.png"></p><p>æœç´¢äº†ä¸‹, <strong>ä»2021å¹´8æœˆ13æ—¥å¼€å§‹, GitHubå·²ç»ç¦æ­¢äº† ç”¨æˆ·å+å¯†ç æ–¹å¼ ç™»å½•</strong></p><blockquote><p>From August 13, 2021, <br/><br>GitHub is no longer accepting account passwords when authenticating Git operations. <br/><br>You need to add a PAT (Personal Access Token) instead, <br/><br>and you can follow the below method to add a PAT on your system. <br/></p></blockquote><h3 id="GitHubå¯†ç å­˜å‚¨ä½ç½®"><a href="#GitHubå¯†ç å­˜å‚¨ä½ç½®" class="headerlink" title="GitHubå¯†ç å­˜å‚¨ä½ç½®"></a>GitHubå¯†ç å­˜å‚¨ä½ç½®</h3><p>åœ¨ä½¿ç”¨SourceTreeçš„æ—¶å€™, ç”±äºrepoä½¿ç”¨çš„ä¹Ÿæ˜¯HTTPS, å› æ­¤ä¹Ÿæç¤ºè¾“å…¥ ç”¨æˆ·å+å¯†ç , ç”±äºå¯†ç æ–¹å¼è¢«ç¦ç”¨, å› æ­¤åç»­å†pushè¿™ä¸ªrepo, ä¼šä¸€ç›´æŠ¥ç¦æ­¢å¯†ç ç™»å½•é”™è¯¯.<br>ä½†ä¹Ÿ<mark>æ‰¾ä¸åˆ°ä¿®æ”¹&#x2F;åˆ é™¤è¯¥å¯†ç çš„ä½ç½®.</mark></p><p>æŸ¥äº†ä¸‹èµ„æ–™, ä¸åŒçš„æ“ä½œç³»ç»Ÿ, ç”šè‡³åŒæ ·æ“ä½œç³»ç»Ÿçš„ä¸åŒçš„ç‰ˆæœ¬, å­˜å‚¨æ–¹å¼éƒ½ä¸åŒ. è¿™é‡Œä»¥ <a href="https://stackoverflow.com/questions/42584934/where-is-my-remote-git-repository-password-stored-on-the-local-machine">MacOS Monterey 12.3.1ç‰ˆæœ¬</a> ä¸ºä¾‹:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalkerdeMacBook-Pro:~ davywalker$ <span class="token function">git</span> config credential.helperosxkeychain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹å‡ºæ¥æ˜¯ç”±keychainè¿›è¡Œçš„ç®¡ç†, åœ¨Macçš„ <code>Applications -&gt; Utilties -&gt; Keychain Access</code> </p><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207252101640.png"></p><ul><li>å¯ä»¥çœ‹åˆ°SourceTreeåº”ç”¨ä¿å­˜çš„GitHub Repoå¯†ç .</li><li>åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°IntelliJ IDEAä¿å­˜çš„GitHub Repoå¯†ç , é€šè¿‡æ˜¾ç¤ºrepoå¯†ç å‘ç°, è¿™ä¸ªå¯†ç å­—æ®µå…¶å®å°±æ˜¯ç­¾å‘ç»™Intellijçš„ PAT(Personal Access Token)</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç”±äº<font color='red'>æœ¬åœ°é…ç½®çš„remote repoæ˜¯HTTPSæ–¹å¼, å› æ­¤é€šè¿‡é…ç½®SSHå…ç™»æ–¹å¼å¿…ç„¶æ˜¯æ— æ•ˆçš„.</font> </p><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242202265.png"></p><h1 id="ç™»å½•å®‰å…¨æ€è€ƒ"><a href="#ç™»å½•å®‰å…¨æ€è€ƒ" class="headerlink" title="ç™»å½•å®‰å…¨æ€è€ƒ"></a>ç™»å½•å®‰å…¨æ€è€ƒ</h1><h2 id="ä¸ºå•¥ç¦æ­¢CLI-HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•"><a href="#ä¸ºå•¥ç¦æ­¢CLI-HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•" class="headerlink" title="ä¸ºå•¥ç¦æ­¢CLI HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•?"></a>ä¸ºå•¥ç¦æ­¢CLI HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•?</h2><p>åº”è¯¥æ˜¯æ‹…å¿ƒå¯†ç æ³„éœ².<br>ä½†ä¼šåœ¨å“ªç§æƒ…å†µä¸‹æ³„éœ²å¯†ç ?</p><ol><li>å­˜å‚¨è¿‡ç¨‹: ä¸ºäº†é˜²æ­¢æ¯æ¬¡pushéƒ½é‡å¤è¾“å…¥, git clientåº”è¯¥æŠŠç”¨æˆ·åå¯†ç å­˜å‚¨åˆ°æœ¬æœºæŸä¸ªä½ç½®äº†. </li><li>ä¼ è¾“è¿‡ç¨‹: HTTPSä¸­é—´äººæ”»å‡», å‘ç”Ÿæ¦‚ç‡å°±è¾ƒå°äº†<br>æ‰€ä»¥åº”è¯¥è¿˜æ˜¯å¯†ç å­˜å‚¨çš„é£é™©.<br>é€šè¿‡é¡µé¢ç™»å½•, æœ‰äº¤äº’æ–¹å¼å¯ä»¥å®ç°MFA, ä½†<mark>CLIæ–¹å¼æ— æ³•è¿›è¡Œäº¤äº’ä»è€Œå®ç°MFA.</mark><br>è¿™æ ·ä»è€Œå‡å¼±äº†å®‰å…¨æ€§.</li></ol><h2 id="ä¸ºå•¥é€šè¿‡ç”¨æˆ·å-Tokenæ–¹å¼ç™»å½•-å°±æ”¯æŒå‘¢"><a href="#ä¸ºå•¥é€šè¿‡ç”¨æˆ·å-Tokenæ–¹å¼ç™»å½•-å°±æ”¯æŒå‘¢" class="headerlink" title="ä¸ºå•¥é€šè¿‡ç”¨æˆ·å+Tokenæ–¹å¼ç™»å½•, å°±æ”¯æŒå‘¢"></a>ä¸ºå•¥é€šè¿‡ç”¨æˆ·å+Tokenæ–¹å¼ç™»å½•, å°±æ”¯æŒå‘¢</h2><h3 id="å‡ ç§ç±»å‹çš„Token"><a href="#å‡ ç§ç±»å‹çš„Token" class="headerlink" title="å‡ ç§ç±»å‹çš„Token"></a>å‡ ç§ç±»å‹çš„Token</h3><ul><li>å¯†ç : æ—¶é—´ç»´åº¦æ˜¯æ°¸ä¹…æœ‰æ•ˆ, ä¸å¯å¬å›. æƒé™èŒƒå›´æ˜¯æ— é™çš„(é™¤éå­è´¦å·). å¯èƒ½æ˜¯æœ‰è§„å¾‹çš„.</li><li>SecretKey: æ—¶é—´ç»´åº¦é€šå¸¸æ˜¯æ°¸ä¹…æœ‰æ•ˆ(ä½†æ”¯æŒè®¾å®šé•¿æœŸ), å¯ä»¥å¬å›. æƒé™èŒƒå›´æ˜¯æœ‰é™çš„. é€šå¸¸æ˜¯UUIDç­‰æ— è§„å¾‹çš„.</li><li>RefreshToken: æ—¶é—´ç»´åº¦æ˜¯è¾ƒé•¿ç»´åº¦(ä¾‹å¦‚å¯ä»¥60å¤©), å¯ä»¥å¬å›. æƒé™èŒƒå›´æ˜¯æœ‰é™çš„. é€šå¸¸æ˜¯UUIDç­‰æ— è§„å¾‹çš„.</li><li>AccessToken: æ—¶é—´ç»´åº¦æ˜¯è¾ƒçŸ­ç»´åº¦(ä¾‹å¦‚4ä¸ªå°æ—¶), å¯ä»¥å¬å›(ä½†ä¸€èˆ¬ä¸å¬å›, é€šè¿‡å¬å›RefreshTokenå®ç°). æƒé™èŒƒå›´æ˜¯ä¼˜å…ˆçš„. é€šå¸¸æ˜¯UUIDç­‰æ— è§„å¾‹çš„.</li></ul><h3 id="å‡ ç§ç™»å½•æ–¹å¼"><a href="#å‡ ç§ç™»å½•æ–¹å¼" class="headerlink" title="å‡ ç§ç™»å½•æ–¹å¼"></a>å‡ ç§ç™»å½•æ–¹å¼</h3><ul><li>æ–¹å¼1: åœ¨ç½‘é¡µç«¯, é€šå¸¸é€‰æ‹©å¯†ç æ–¹å¼ç™»å½•, ä½†éœ€è¦å¼€å¯MFAä»¥åŠ å›ºå®‰å…¨. ä»¥è¯¥æ–¹å¼ä½œä¸ºå®‰å…¨æ€§æœ€å¼º, æƒé™æœ€å¤§çš„æ–¹å¼. </li><li>æ–¹å¼2: åœ¨æœåŠ¡ç«¯SDKé‡Œ, é€šå¸¸é€‰æ‹©SecretKeyæ–¹å¼. SecretKeyå¦‚æœæ³„éœ², å¯ä»¥é€šè¿‡æ–¹å¼1ç™»å½•, ç„¶åæ’¤é”€SecretKeyçš„æœ‰æ•ˆæ€§, é‡æ–°ç­¾å‘æ–°çš„SecretKey. </li><li>æ–¹å¼3: åœ¨ç§»åŠ¨ç«¯SDKé‡Œ, é€šå¸¸ä¼šç­¾å‘ä¸€ä¸ªRefreshToken+AccessToken. æ¯æ¬¡AccessTokenè¿‡æœŸä¹‹å, é‡æ–°é€šè¿‡RefreshTokenè°ƒç”¨APIç”³è¯·æ–°çš„AccessToken.</li></ul><p>å› æ­¤åœ¨GitHub CLIæ–¹å¼ç™»å½•, å…¶å®å°±æ˜¯ä»æ–¹å¼1(ä½†ä¸å¸¦MFA)é™çº§åˆ°æ–¹æ¡ˆ2, ä¸€æ˜¯é™åˆ¶æƒé™èŒƒå›´, äºŒæ˜¯å¯ä»¥éšæ—¶æ’¤é”€. </p><h2 id="å…¶ä»–è§£å†³æ–¹æ¡ˆ"><a href="#å…¶ä»–è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–è§£å†³æ–¹æ¡ˆ"></a>å…¶ä»–è§£å†³æ–¹æ¡ˆ</h2><ul><li>ä¹Ÿå¯ä»¥å°†remote repoåˆ‡æ¢æˆ<a href="https://docs.github.com/en/get-started/getting-started-with-git/managing-remote-repositories#switching-remote-urls-from-https-to-ssh">SSHæ–¹å¼</a>, å¹¶é…ç½®SSHå…ç™»å®ç°.</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;åœ¨æœ¬åœ°CLIä¸­push githubä»£ç æ—¶, è¦æ±‚è¾“å…¥ç”¨æˆ·åå¯†ç , ä½†è¾“å…¥å¯†ç ä¹‹å, æç¤ºç¦æ­¢ä½¿ç”¨å¯†ç ç™»å½•.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®æç¤ºé…ç½®äº†åŠå¤©SSHå…ç™», ç»“æœå‘ç°å¹¶ä¸ç”Ÿæ•ˆ, pushæ—¶ä»ç„¶è®©è¾“å…¥è´¦å·åå¯†ç .&lt;/li&gt;
&lt;li&gt;åç»­æ ¹æ®æç¤º, åœ¨&lt;a href=&quot;https://github.com/settings/tokens&quot;&gt;GitHubé¡µé¢æ–°ç”³è¯·äº†Token&lt;/a&gt;, ç„¶åä½¿ç”¨ ç”¨æˆ·å+Token ç™»å½•å°±å¯ä»¥äº†.&lt;br&gt;ä»è€Œå¼•å‘äº†è¯¸å¤šç–‘é—®ä¸æ€è€ƒ.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;GitHubè®¿é—®å‡ ç§æ–¹å¼&quot;&gt;&lt;a href=&quot;#GitHubè®¿é—®å‡ ç§æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;GitHubè®¿é—®å‡ ç§æ–¹å¼&quot;&gt;&lt;/a&gt;GitHubè®¿é—®å‡ ç§æ–¹å¼&lt;/h1&gt;&lt;h2 id=&quot;æ–¹æ¡ˆ1-SSHæ–¹å¼&quot;&gt;&lt;a href=&quot;#æ–¹æ¡ˆ1-SSHæ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ¡ˆ1: SSHæ–¹å¼&quot;&gt;&lt;/a&gt;æ–¹æ¡ˆ1: SSHæ–¹å¼&lt;/h2&gt;&lt;h3 id=&quot;é…ç½®æ–¹å¼&quot;&gt;&lt;a href=&quot;#é…ç½®æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®æ–¹å¼&quot;&gt;&lt;/a&gt;é…ç½®æ–¹å¼&lt;/h3&gt;&lt;p&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242155452.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼, å¯ä»¥é€šè¿‡é…ç½®SSHå…ç™»å³å¯.&lt;/p&gt;
&lt;h3 id=&quot;å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey&quot;&gt;&lt;a href=&quot;#å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey?&quot;&gt;&lt;/a&gt;å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey?&lt;/h3&gt;&lt;p&gt;å¦‚æœåœ¨æœ¬åœ°, æ—¢éœ€è¦é…ç½®giteeçš„SSHå…ç™», åˆéœ€è¦é…ç½®githubçš„SSHå…ç™», æœ‰éœ€è¦é…ç½®å…¶ä»–Hostçš„SSHå…ç™», æ€ä¹ˆèƒ½è®©ä¸åŒçš„Hostä½¿ç”¨ä¸åŒçš„å…¬ç§é’¥å¯¹?&lt;/p&gt;</summary>
    
    
    
    
    <category term="distributed-system" scheme="https://davyjones2010.github.io/tags/distributed-system/"/>
    
    <category term="login" scheme="https://davyjones2010.github.io/tags/login/"/>
    
    <category term="token" scheme="https://davyjones2010.github.io/tags/token/"/>
    
  </entry>
  
  <entry>
    <title>ç”±ZKçš„SID/ZXIDä¸snowflakeç®—æ³•å¼•å‘çš„IDç”Ÿæˆç®—æ³•æ¢è®¨</title>
    <link href="https://davyjones2010.github.io/2022-07-11-zk-uuid-gen/"/>
    <id>https://davyjones2010.github.io/2022-07-11-zk-uuid-gen/</id>
    <published>2022-07-11T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‡ ç§ç”Ÿæˆç®—æ³•"><a href="#å‡ ç§ç”Ÿæˆç®—æ³•" class="headerlink" title="å‡ ç§ç”Ÿæˆç®—æ³•"></a>å‡ ç§ç”Ÿæˆç®—æ³•</h1><h2 id="zké‡Œçš„sidç”Ÿæˆç®—æ³•"><a href="#zké‡Œçš„sidç”Ÿæˆç®—æ³•" class="headerlink" title="zké‡Œçš„sidç”Ÿæˆç®—æ³•"></a>zké‡Œçš„sidç”Ÿæˆç®—æ³•</h2><h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><ul><li>ä¸€ä¸ªlongç±»å‹, å ç”¨64ä½</li><li>ç”±ZKæœåŠ¡ç«¯ç”Ÿæˆçš„.</li><li>å½“å®¢æˆ·ç«¯ä¸ZKæœåŠ¡ç«¯å»ºç«‹å¥½TCPè¿æ¥(æˆ–è€…è¯´åº”ç”¨å±‚è¿æ¥)ä¹‹å, ç”Ÿæˆ.</li></ul><h3 id="ç”Ÿæˆè§„åˆ™"><a href="#ç”Ÿæˆè§„åˆ™" class="headerlink" title="ç”Ÿæˆè§„åˆ™"></a>ç”Ÿæˆè§„åˆ™</h3><ol><li>è·å–å½“å‰æ—¶é—´(2013-10-04 21:59:42)çš„æ¯«ç§’è¡¨ç¤ºï¼š1380895182327 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š</li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122157745.png"></p><ol start="2"><li>å°†æ­¥éª¤1ä¸­çš„æ•°å€¼å·¦ç§»24ä½ï¼Œå¾—åˆ°ï¼š</li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122157302.png"></p><ol start="3"><li>å³ç§»8ä½ï¼š</li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158285.png"></p><ol start="4"><li>æ·»åŠ æœºå™¨æ ‡è¯†: SID. id è¡¨ç¤ºé…ç½®åœ¨myidæ–‡ä»¶ä¸­çš„å€¼ï¼Œé€šå¸¸æ˜¯æ•´æ•°1ã€2ã€3ç­‰,å‡è®¾idä¸º2ï¼š</li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158613.png"></p><ol start="5"><li>å°†æ­¥éª¤3å’Œæ­¥éª¤4å¾—åˆ°çš„ä¸¤ä¸ª64ä½è¡¨ç¤ºçš„æ•°å€¼è¿›è¡Œ<code>æˆ–</code>æ“ä½œï¼š</li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158687.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">initializeNextSessionId</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">long</span> nextSid<span class="token punctuation">;</span>    nextSid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">currentElapsedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span>    nextSid <span class="token operator">=</span> nextSid <span class="token operator">|</span> <span class="token punctuation">(</span>id <span class="token operator">&lt;&lt;</span> <span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextSid <span class="token operator">==</span> <span class="token class-name">EphemeralType</span><span class="token punctuation">.</span>CONTAINER_EPHEMERAL_OWNER<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token operator">++</span>nextSid<span class="token punctuation">;</span>  <span class="token comment">// this is an unlikely edge case, but check it just in case</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> nextSid<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯¦ç»†åˆ†æ"><a href="#è¯¦ç»†åˆ†æ" class="headerlink" title="è¯¦ç»†åˆ†æ"></a>è¯¦ç»†åˆ†æ</h3><p>{8ä½, å½“å‰ä¸»æœºçš„myid} {40ä½, æ¯«ç§’æ—¶é—´æˆ³} {16ä½, å•hosté€’å¢åºåˆ—å·}<br>ZKä¸»æœºå¯åŠ¨æ—¶, ä¼šæŠŠå‰ 48ä½åˆå§‹åŒ–å¥½, æ¥ä¸‹æ¥æ¯æ¬¡æœ‰clienté“¾æ¥åˆ°è¯¥host, åˆ™å16ä½è¿›è¡Œé€’å¢.</p><h3 id="çº¿ä¸Šæ ·ä¾‹"><a href="#çº¿ä¸Šæ ·ä¾‹" class="headerlink" title="çº¿ä¸Šæ ·ä¾‹"></a>çº¿ä¸Šæ ·ä¾‹</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158988.png"></p><p>ä¾‹å¦‚, sid &#x3D; 0x3 518ae13bc4 16e8 æœ¬è´¨ä¸Šèƒ½æ‹†åˆ†æˆ:</p><ul><li>å‰8ä½: 0x3, ä»£è¡¨å½“å‰myid&#x3D;3, æ˜¯æ•´ä¸ªZKé›†ç¾¤çš„ç¬¬3å°æœåŠ¡å™¨.</li><li>ä¸­é—´40ä½: 518ae13bc4, ä»£è¡¨åˆå§‹åŒ–æ—¶æ—¶é—´æˆ³. ç”±äºç§»ä½æ—¶æˆªæ–­äº†æœ€é«˜ä½1, å› æ­¤å®é™…çš„æ—¶é—´æˆ³æ˜¯ 1518ae13bc4, è½¬æˆ10è¿›åˆ¶1449733995460, æŒ‰ç…§æ¯«ç§’æ•°è½¬æˆæ—¶é—´æˆ³2015-12-10 15:53:15, å¯ä»¥çŸ¥é“è¯¥hostå¯åŠ¨æ˜¯åœ¨è¿™ä¸ªæ—¶é—´ç‚¹.</li><li>å16ä½: 16e8, è½¬æˆ10è¿›åˆ¶, 5864, ä»£è¡¨æ˜¯ç¬¬5864ä¸ªè¿æ¥</li></ul><h3 id="ç¢°æ’åˆ†æ"><a href="#ç¢°æ’åˆ†æ" class="headerlink" title="ç¢°æ’åˆ†æ"></a>ç¢°æ’åˆ†æ</h3><p>æ€è€ƒSIDäº§ç”Ÿè§„åˆ™, æ˜¯å¦æœ‰ç¢°æ’é£é™©?</p><ol><li>å‰8ä½ä»£è¡¨ä¸»æœºä½, æœ€å¤§æ”¯æŒ256ä¸ªä¸»æœº, å¦‚æœé›†ç¾¤æœ‰ä¸Šåƒå°æœåŠ¡å™¨, è¿™æ ·å¿…ç„¶ä¼šé‡å¤, ä½†è¿™æ ·ä¼šå¯¼è‡´ç¢°æ’ä¹ˆ? â€“&gt; ä¸å¤ªä¼š<ol><li>åªè¦èƒ½ä¿è¯å‰48ä½ä¸é‡å¤, å³å¯ä»¥ä¿è¯sidä¸ç¢°æ’. å› ä¸ºå16ä½æ˜¯å•hostç²’åº¦é€’å¢.</li></ol></li><li>å‰48ä½å¦‚ä½•ç¢°æ’?<ol><li>å³å‰8ä½ç›¸åŒçš„ä¸»æœº myid&#x3D;1 (äºŒè¿›åˆ¶ 00000001) ä¸ myid&#x3D;257 (100000001)</li><li>åœ¨åŒä¸€æ¯«ç§’åŒæ—¶å¯åŠ¨, ä»è€Œä¸­é—´40ä½ç›¸åŒ</li><li>è€Œåœ¨å®é™…å°è§„æ¨¡é›†ç¾¤æƒ…å†µä¸‹, åŸºæœ¬å¾ˆéš¾äº§ç”Ÿ.</li></ol></li><li>å•æœºä¸Š, å16ä½å¦‚æœæº¢å‡ºæ€ä¹ˆåŠ?<ol><li>å³å•æœºä¸Šclientåå¤åˆ›å»ºsession, è¶…è¿‡äº†2^16&#x3D;65535, å¿…ç„¶ä¼šé‡å¤!</li><li>ç»è¯•éªŒ, å‘ç°å½“å16ä½æ»¡äº†ä¹‹å, ä¼šå‘å‰è¾¹å€Ÿä½. ä¾‹å¦‚:<ol><li>å•æœºä¸Šä¹‹å‰çš„sid: 0x3 764c3db1d3 768e</li><li>åç»­é¢‘ç¹åˆ›å»ºsession, å16ä½æ»¡äº†, å˜æˆ 0x3 764c3db1d4 00e1</li></ol></li><li>çœ‹ä»£ç : æ— è„‘åœ°å¯¹sidåš+1æ“ä½œ. å³ä½¿è¿™æ ·, ä¹Ÿä¸å¤ªä¼šå¯¼è‡´ ä¸­é—´40ä½ç¢°æ’. (æœ‰è¿™ä¸ªå¯èƒ½, ä¾‹å¦‚å½“å‰sessioné¢‘ç¹åˆ›å»º, å˜æˆäº† 0x3 ffffffffff 768e, æ¥ä¸‹æ¥æœåŠ¡å™¨åœ¨ ffffffffff è¿™ä¸ªæ¯«ç§’ç‚¹å¯åŠ¨, ä½†å½“å‰sessionæœªå¤±æ•ˆ, é‡æ–°è¿æ¥ä¸Šå»äº†.  ä»è€Œsidä» 0x3 ffffffffff 0000å¼€å§‹é€’å¢, æœ‰å¯èƒ½é‡æ–°ç”Ÿæˆäº†ä¸€ä¸ª 0x3 ffffffffff 768e çš„sid)</li></ol></li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122159565.png"></p><h2 id="zké‡Œçš„zxidç”Ÿæˆç®—æ³•"><a href="#zké‡Œçš„zxidç”Ÿæˆç®—æ³•" class="headerlink" title="zké‡Œçš„zxidç”Ÿæˆç®—æ³•"></a>zké‡Œçš„zxidç”Ÿæˆç®—æ³•</h2><h3 id="zxidç»„æˆ"><a href="#zxidç»„æˆ" class="headerlink" title="zxidç»„æˆ"></a>zxidç»„æˆ</h3><blockquote><p>The zxid has two parts: the epoch and a counter. <br/><br>In our implementation the zxid is a 64-bit number. <br/><br>We use the high order 32-bits for the epoch and the low order 32-bits for the counter.</p></blockquote><p>64ä½çš„longç±»å‹, åŒ…å«ä¸¤éƒ¨åˆ†: å‰32ä½ä»£è¡¨epoch(å³é€‰ä¸¾æ¬¡æ•°); å32ä½ä»£è¡¨counter(å³è¯¥zké›†ç¾¤ä¸­çš„updateæ“ä½œçš„æ¬¡æ•°, åŸºæœ¬æ˜¯å•è°ƒé€’å¢çš„).<br>ä½†å®é™…è¿™æ ·è®¾è®¡æ˜¯æœ‰ç¼ºé™·çš„:</p><ul><li>åœ¨å®é™…åœºæ™¯ä¸­, quorumä¸€èˆ¬éƒ½æ˜¯åœ¨è¾ƒä¸ºç¨³å®šçš„å†…ç½‘ç¯å¢ƒä¸‹, ä¸å¤ªä¼šå› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´å‘ç”Ÿfailoveré€‰ä¸»åˆ‡æ¢; å› æ­¤epochä½¿ç”¨32ä½, æ”¯æŒ40äº¿æ¬¡é€‰ä¸¾, æ²¡å•¥å¿…è¦.</li><li>è€Œå®é™…counterå¢é•¿æ˜¯æ¯”è¾ƒè¿…çŒ›çš„, åœ¨æ”¯æŒ1000qpsçš„ç³»ç»Ÿä¸­, 50å¤©å·¦å³counterå°±ä¼šæº¢å‡º.</li><li>è€Œcounteræº¢å‡ºä¼šå¯¼è‡´å‘ç”Ÿä¸€æ¬¡å¼ºåˆ¶é€‰ä¸», ä»è€ŒæŠŠcounteræ¸…é›¶, æŠŠepoch+1;</li><li>è€Œåœ¨3.3.5ç‰ˆæœ¬ä¹‹å‰, counteræº¢å‡ºä¸ä¼šé€‰ä¸», å­˜åœ¨bug, å¯¼è‡´zké›†ç¾¤æ•´ä½“ä¸å¯ç”¨. <a href="https://issues.apache.org/jira/browse/ZOOKEEPER-1277">servers stop serving when lower 32bits of zxid roll over</a></li></ul><h3 id="zxidç”Ÿæˆ"><a href="#zxidç”Ÿæˆ" class="headerlink" title="zxidç”Ÿæˆ"></a>zxidç”Ÿæˆ</h3><ul><li>zxidå¿…ç„¶æ˜¯ç”±leaderç”Ÿæˆ, ä¿è¯å•è°ƒé€’å¢, ä¸èƒ½ç”±å®¢æˆ·ç«¯ç”Ÿæˆ.</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> epoch <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">long</span> counter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">long</span> zxid <span class="token operator">=</span> epoch <span class="token operator">&lt;&lt;</span> <span class="token number">32</span> <span class="token operator">|</span> counter<span class="token punctuation">;</span><span class="token comment">// æ–°çš„updateæ“ä½œ</span>zxid<span class="token operator">++</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="zxidä½¿ç”¨æƒ…å†µ"><a href="#zxidä½¿ç”¨æƒ…å†µ" class="headerlink" title="zxidä½¿ç”¨æƒ…å†µ"></a>zxidä½¿ç”¨æƒ…å†µ</h3><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è„šæœ¬åˆ¤æ–­å32ä½ä½¿ç”¨é‡, å¦‚æœç»“æœ&gt;0.8, ä»£è¡¨ä½¿ç”¨é‡å·²ç»è¶…è¿‡80%, ä»£è¡¨æœ‰é£é™©.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> srvr <span class="token operator">|</span> <span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">32188</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/Zxid/&#123;printf "%f\n", and(strtonum($NF),0xffffffff)/2^32&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Snowflake-IDç”Ÿæˆç®—æ³•"><a href="#Snowflake-IDç”Ÿæˆç®—æ³•" class="headerlink" title="Snowflake IDç”Ÿæˆç®—æ³•"></a>Snowflake IDç”Ÿæˆç®—æ³•</h2><h3 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122159430.png"></p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>41ä½æ—¶é—´æˆ³, æ ‡è¯†çš„æ—¶é—´èŒƒå›´æ˜¯?</li></ul><p>1970-01-01 08:00:00 ~ 2039-09-07 23:47:35</p><blockquote><p>41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª) å¾—åˆ°çš„å€¼ï¼Œè¿™é‡Œçš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ï¼ˆå¦‚ä¸‹é¢ç¨‹åºIdWorkerç±»çš„startTimeå±æ€§ï¼‰ã€‚41ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨69å¹´</p></blockquote><ul><li>10ä½æœºå™¨id, æ ‡è¯†çš„æœºå™¨æ•°é‡èŒƒå›´æ˜¯:</li></ul><p>1024 å°, 5ä½datacenterIdå’Œ 5ä½workerId</p><ul><li>12ä½åºåˆ—å·</li></ul><h3 id="å®é™…åœºæ™¯"><a href="#å®é™…åœºæ™¯" class="headerlink" title="å®é™…åœºæ™¯"></a>å®é™…åœºæ™¯</h3><p>RocketMQ, æ¶ˆæ¯IDæ˜¯ä½¿ç”¨snowflakeç®—æ³•ç”Ÿæˆ, æ˜¯ç”±å®¢æˆ·ç«¯äº§ç”Ÿ.</p><ul><li>å®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“è‡ªå·±çš„datacenterId?</li><li>å¯ä»¥é€šè¿‡é…ç½®, ä¹Ÿå¯ä»¥å¦‚ä¸‹, é€šè¿‡æœ¬æœºç½‘å¡çš„MACç”Ÿæˆ, å‚ç…§ï¼š<a href="https://github.com/dromara/hutool/blob/a9310c2d305acac617ca656ea6ffc3be6cc48a4c/hutool-core/src/main/java/cn/hutool/core/util/IdUtil.java#L240">IdUtil.java</a></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è·å–æ•°æ®ä¸­å¿ƒID&lt;br> * æ•°æ®ä¸­å¿ƒIDä¾èµ–äºæœ¬åœ°ç½‘å¡MACåœ°å€ã€‚ * &lt;p> * æ­¤ç®—æ³•æ¥è‡ªäºmybatis-plus#Sequence * &lt;/p> * * @param maxDatacenterId æœ€å¤§çš„ä¸­å¿ƒID * @return æ•°æ®ä¸­å¿ƒID * @since 5.7.3 */</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getDataCenterId</span><span class="token punctuation">(</span><span class="token keyword">long</span> maxDatacenterId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>maxDatacenterId <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"maxDatacenterId must be > 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>maxDatacenterId <span class="token operator">==</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        maxDatacenterId <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mac <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        mac <span class="token operator">=</span> <span class="token class-name">NetUtil</span><span class="token punctuation">.</span><span class="token function">getLocalHardwareAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UtilException</span> ignore<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// ignore</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> mac<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x000000FF</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> mac<span class="token punctuation">[</span>mac<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0x0000FF00</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> mac<span class="token punctuation">[</span>mac<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">6</span><span class="token punctuation">;</span>        id <span class="token operator">=</span> id <span class="token operator">%</span> <span class="token punctuation">(</span>maxDatacenterId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> id<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“è‡ªå·±çš„å·¥ä½œæœºå™¨ID? </li><li>æ ¹æ®è¿›ç¨‹PIDä¸datacenterIdç”Ÿæˆ, å‚ç…§ï¼š<a href="https://github.com/dromara/hutool/blob/a9310c2d305acac617ca656ea6ffc3be6cc48a4c/hutool-core/src/main/java/cn/hutool/core/util/IdUtil.java#L240">IdUtil.java</a></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è·å–æœºå™¨IDï¼Œä½¿ç”¨è¿›ç¨‹IDé…åˆæ•°æ®ä¸­å¿ƒIDç”Ÿæˆ&lt;br> * æœºå™¨ä¾èµ–äºæœ¬è¿›ç¨‹IDæˆ–è¿›ç¨‹åçš„Hashå€¼ã€‚ * * &lt;p> * æ­¤ç®—æ³•æ¥è‡ªäºmybatis-plus#Sequence * &lt;/p> * * @param datacenterId æ•°æ®ä¸­å¿ƒID * @param maxWorkerId  æœ€å¤§çš„æœºå™¨èŠ‚ç‚¹ID * @return ID * @since 5.7.3 */</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getWorkerId</span><span class="token punctuation">(</span><span class="token keyword">long</span> datacenterId<span class="token punctuation">,</span> <span class="token keyword">long</span> maxWorkerId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">StringBuilder</span> mpid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    mpid<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>datacenterId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        mpid<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">RuntimeUtil</span><span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UtilException</span> igonre<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ignore</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*     * MAC + PID çš„ hashcode è·å–16ä¸ªä½ä½     */</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>mpid<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>maxWorkerId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•"><a href="#awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•" class="headerlink" title="awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•"></a>awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•</h2><h3 id="æ–¹æ¡ˆ1-Base36"><a href="#æ–¹æ¡ˆ1-Base36" class="headerlink" title="æ–¹æ¡ˆ1: Base36"></a>æ–¹æ¡ˆ1: Base36</h3><p>ä»£ç å¦‚ä¸‹, ä¼˜ç‚¹æ˜¯ä¸éœ€è¦å ä½ç¬¦, å¯ä»¥ç›´æ¥ç”¨<code>ALPHABET</code>ç”šè‡³å¯ä»¥ä¿®æ”¹<code>ALPHABET</code>çš„é¡ºåºè¾¾åˆ°ç®€å•åŠ å¯†çš„æ•ˆæœ.</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Base36Test</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 26å°å†™+26å¤§å†™+10æ•°å­—=62</span>    <span class="token comment">//public static String ALPHABET = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";</span>    <span class="token comment">// 26å°å†™+10æ•°å­—=36</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> ALPHABET <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encoding</span><span class="token punctuation">(</span><span class="token keyword">long</span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"num must be greater than 0."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> num <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> num <span class="token operator">/=</span> <span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ALPHABET<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>num <span class="token operator">%</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">decoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"str must not be empty."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">long</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            result <span class="token operator">+=</span> ALPHABET<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> dcId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> izId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//int idx = (int)(Math.random() * 1024);</span>        <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>        encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span><span class="token number">1023</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>        encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–¹æ¡ˆ2-Base64"><a href="#æ–¹æ¡ˆ2-Base64" class="headerlink" title="æ–¹æ¡ˆ2: Base64"></a>æ–¹æ¡ˆ2: Base64</h3><p>ç¼ºç‚¹æ˜¯ä¼šæœ‰<code>=</code>å ä½ç¬¦.</p><h1 id="æ—¶é’Ÿå›æ‹¨é—®é¢˜"><a href="#æ—¶é’Ÿå›æ‹¨é—®é¢˜" class="headerlink" title="æ—¶é’Ÿå›æ‹¨é—®é¢˜"></a>æ—¶é’Ÿå›æ‹¨é—®é¢˜</h1><ul><li>zké‡Œçš„sidä¸å¤ªä¼šæœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜, æ˜¯å› ä¸ºæ—¶é—´æˆ³æ˜¯æœºå™¨å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„. é™¤éå›æ‹¨æ—¶é—´ç‰¹åˆ«é•¿, åˆšå¥½å›æ‹¨ä¹‹åæœºå™¨åˆé‡å¯äº†, æ‹¿åˆ°äº†ä¹‹å‰é‚£ä¸ªæ—¶é—´æˆ³. ä½†è€ƒè™‘åˆ°å®é™…åœºæ™¯, å®é™…ä¸å¤ªä¼šå‘ç”Ÿ.<ul><li>æœºå™¨é‡å¯ä¸ä¼šé‚£ä¹ˆé¢‘ç¹, åªä¼šåœ¨å¯åŠ¨æ—¶ç”Ÿæˆ</li><li>æ—¶é’Ÿå›æ‹¨, ä¸€èˆ¬éƒ½æ˜¯äºšç§’çº§åˆ«çš„å›æ‹¨</li></ul></li><li>rocketmqé‡Œsnowflake, ç”±äºæ˜¯å®¢æˆ·ç«¯æ¯æ¬¡ç”Ÿæˆæ—¶å®æ—¶è·å–çš„æ—¶é—´æˆ³, å› æ­¤å³ä½¿å›æ‹¨äº†å‡ æ¯«ç§’, åœ¨ç”ŸæˆIDé€Ÿåº¦éå¸¸å¿«çš„æƒ…å†µä¸‹, ä¹Ÿæœ‰å¯èƒ½é‡å¤. å¦‚ä½•è§£å†³?<ul><li>æ¯”è¾ƒæŒ«çš„æ–¹æ¡ˆ, å…³é—­ntp</li><li>æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆ: å½“å›æ‹¨æ—¶é—´å°äº15msï¼Œå°±ç­‰æ—¶é—´è¿½ä¸Šæ¥ä¹‹åç»§ç»­ç”Ÿæˆã€‚</li></ul><ol><li>æ›´å¥½çš„æ–¹æ¡ˆ, å½“æ—¶é—´å¤§äº15msæ—¶é—´æˆ‘ä»¬é€šè¿‡<strong>æ›´æ¢workid</strong>æ¥äº§ç”Ÿä¹‹å‰éƒ½æ²¡æœ‰äº§ç”Ÿè¿‡çš„æ¥è§£å†³å›æ‹¨é—®é¢˜ã€‚</li><li>æœ€å¥½çš„æ–¹æ¡ˆ: å¦‚ä¸‹ä¿®æ”¹ç®—æ³•, å¯ä»¥æ‰¾2bitä½ä½œä¸ºæ—¶é’Ÿå›æ‹¨ä½ï¼Œå‘ç°æœ‰æ—¶é’Ÿå›æ‹¨å°±å°†å›æ‹¨ä½åŠ 1ï¼Œè¾¾åˆ°æœ€å¤§ä½åå†ä»0å¼€å§‹è¿›è¡Œå¾ªç¯ã€‚</li></ol></li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122159865.png"></p><h1 id="æ–¹æ¡ˆæ¯”è¾ƒ"><a href="#æ–¹æ¡ˆæ¯”è¾ƒ" class="headerlink" title="æ–¹æ¡ˆæ¯”è¾ƒ"></a>æ–¹æ¡ˆæ¯”è¾ƒ</h1><ul><li><p>ç›¸åŒç‚¹: </p><ul><li>éƒ½ä½¿ç”¨longç±»å‹, å ç”¨64ä½</li><li>éƒ½å¸Œæœ›æ—¢èƒ½å°½é‡å‡å°‘ç¢°æ’, åˆèƒ½åæ˜ é€’å¢è¶‹åŠ¿</li><li>ç»„æˆç»“æ„éƒ½æ˜¯: <code>ä¸»æœºç¼–å·+æ—¶é—´æˆ³+é€’å¢ç¼–å·</code></li></ul></li><li><p>å·®å¼‚ç‚¹:</p><ul><li>æ—¶é—´æˆ³: <ul><li>sidæ—¶é—´æˆ³å ç”¨40ä½(å®Œæ•´çš„åº”è¯¥æ˜¯41ä½, ä½†é»˜è®¤æˆªæ–­äº†æœ€é«˜ä½1); è€Œsnowflakeæ—¶é—´æˆ³å ç”¨41ä½, ç›¸å¯¹æ—¶é—´èŒƒå›´æ˜¯79å¹´, ç»å¯¹æ—¶é—´åˆ°2039å¹´. </li><li>sidçš„æ—¶é—´æˆ³, æ˜¯zkä¸»æœºå¯åŠ¨èµ·æ¥çš„æ—¶é—´æˆ³, ä¹‹ååœ¨ä¸‹æ¬¡å¯åŠ¨ä¹‹å‰, å°±ä¸å†å˜åŒ–äº†.</li><li>snowflakeçš„æ—¶é—´æˆ³, æ˜¯clientç›¸å¯¹äºæŸä¸ªæ—¶é—´ç‚¹çš„ç›¸å¯¹æ—¶é—´; ä¸”æ˜¯ç”ŸæˆIDçš„å½“å‰æ—¶é—´, ä¸‹ä¸€ä¸ªæ¯«ç§’è¿™ä¸ªæ—¶é—´æˆ³ä¼šå˜åŒ–.</li></ul></li></ul></li><li><p>å…¶ä»–</p><ul><li>zkçš„ç®—æ³•, ä½†å•hostå¢æ•°é‡æ˜¯65535(å®é™…å¯ä»¥å€Ÿ40ä½, å³ä¸Šåƒäº¿, ä½†æœ‰ç¢°æ’é£é™©äº†), é€‚ç”¨äºé•¿è¿åœºæ™¯, å³sessionä¸ä¼šé¢‘ç¹åˆ›å»º, ä»è€Œå¯¼è‡´å16ä½é€’å¢é‚£ä¹ˆå¿«.</li><li>snowflakeç®—æ³•, æ”¯æŒå•æœºæ¯æ¯«ç§’äº§ç”Ÿ 2^12 &#x3D; 4096 ä¸ªID, é€‚ç”¨äºåˆ›å»ºIDéå¸¸é¢‘ç¹çš„åœºæ™¯.</li><li>å‡è®¾, ç”¨zkçš„ç®—æ³•æ¥ç”Ÿæˆsnowflakeçš„id:<ul><li>å¦‚æœè¿˜æ˜¯æœºå™¨å¯åŠ¨æ—¶ç”Ÿæˆæ—¶é—´æˆ³ä½, é‚£å•æœºåªèƒ½ç”Ÿæˆ 2^16 &#x3D; 65535 ä¸ªID, ä¹‹åå°±åªèƒ½å€Ÿæ—¶é—´æˆ³çš„ä½äº†, å¯èƒ½ä¼šé‡å¤äº†!</li></ul></li><li>å‡è®¾, ç”¨snowflakeæ¥ç”Ÿæˆzkçš„sid: <ul><li>è²Œä¼¼æ²¡å•¥é—®é¢˜.</li></ul></li></ul></li></ul><h1 id="å…¶ä»–æ€»ç»“"><a href="#å…¶ä»–æ€»ç»“" class="headerlink" title="å…¶ä»–æ€»ç»“"></a>å…¶ä»–æ€»ç»“</h1><ol><li>sid, snowflakeID æœ¬è´¨ä¸Šéƒ½æ˜¯åˆ†å¸ƒå¼IDç”Ÿæˆ, éœ€è¦ä¿éšœå‡ ç‚¹:<ol><li>å±€éƒ¨, å…¨å±€ å”¯ä¸€</li><li>è¶‹åŠ¿é€’å¢. (è¿™ç‚¹æ˜¯UUIDæ— æ³•è¾¾åˆ°çš„æ•ˆæœ, å› æ­¤ä¸ä½¿ç”¨UUIDGen)</li></ol></li></ol><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul><li><a href="https://www.cnblogs.com/haoxinyue/p/5208136.html">https://www.cnblogs.com/haoxinyue/p/5208136.html</a></li><li><a href="https://www.cnblogs.com/jiangxinlingdu/p/8440413.html">https://www.cnblogs.com/jiangxinlingdu/p/8440413.html</a></li><li><a href="https://xie.infoq.cn/article/ed9b31c014342fd469627d42d">https://xie.infoq.cn/article/ed9b31c014342fd469627d42d</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‡ ç§ç”Ÿæˆç®—æ³•&quot;&gt;&lt;a href=&quot;#å‡ ç§ç”Ÿæˆç®—æ³•&quot; class=&quot;headerlink&quot; title=&quot;å‡ ç§ç”Ÿæˆç®—æ³•&quot;&gt;&lt;/a&gt;å‡ ç§ç”Ÿæˆç®—æ³•&lt;/h1&gt;&lt;h2 id=&quot;zké‡Œçš„sidç”Ÿæˆç®—æ³•&quot;&gt;&lt;a href=&quot;#zké‡Œçš„sidç”Ÿæˆç®—æ³•&quot; class=&quot;headerlink&quot; title=&quot;zké‡Œçš„sidç”Ÿæˆç®—æ³•&quot;&gt;&lt;/a&gt;zké‡Œçš„sidç”Ÿæˆç®—æ³•&lt;/h2&gt;&lt;h3 id=&quot;ç±»å‹&quot;&gt;&lt;a href=&quot;#ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;ç±»å‹&quot;&gt;&lt;/a&gt;ç±»å‹&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªlongç±»å‹, å ç”¨64ä½&lt;/li&gt;
&lt;li&gt;ç”±ZKæœåŠ¡ç«¯ç”Ÿæˆçš„.&lt;/li&gt;
&lt;li&gt;å½“å®¢æˆ·ç«¯ä¸ZKæœåŠ¡ç«¯å»ºç«‹å¥½TCPè¿æ¥(æˆ–è€…è¯´åº”ç”¨å±‚è¿æ¥)ä¹‹å, ç”Ÿæˆ.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ç”Ÿæˆè§„åˆ™&quot;&gt;&lt;a href=&quot;#ç”Ÿæˆè§„åˆ™&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿæˆè§„åˆ™&quot;&gt;&lt;/a&gt;ç”Ÿæˆè§„åˆ™&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;è·å–å½“å‰æ—¶é—´(2013-10-04 21:59:42)çš„æ¯«ç§’è¡¨ç¤ºï¼š1380895182327 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122157745.png&quot;&gt;&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;å°†æ­¥éª¤1ä¸­çš„æ•°å€¼å·¦ç§»24ä½ï¼Œå¾—åˆ°ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122157302.png&quot;&gt;&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;å³ç§»8ä½ï¼š&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    
    <category term="zookeeper" scheme="https://davyjones2010.github.io/tags/zookeeper/"/>
    
    <category term="distributed-system" scheme="https://davyjones2010.github.io/tags/distributed-system/"/>
    
    <category term="uuid" scheme="https://davyjones2010.github.io/tags/uuid/"/>
    
    <category term="snowflake" scheme="https://davyjones2010.github.io/tags/snowflake/"/>
    
    <category term="sid" scheme="https://davyjones2010.github.io/tags/sid/"/>
    
  </entry>
  
  <entry>
    <title>Linuxç½‘ç»œä¹‹HTTP ProxyåŸç†ä¸å®ç°åˆ†æ</title>
    <link href="https://davyjones2010.github.io/2022-07-10-linux-network-http-proxy/"/>
    <id>https://davyjones2010.github.io/2022-07-10-linux-network-http-proxy/</id>
    <published>2022-07-10T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨ä½¿ç”¨apacheçš„HttpClientæ—¶(è·å–å…¶ä»–å¸¸ç”¨çš„httpclient), ç»å¸¸ä¼šå‘ç°åˆå§‹åŒ–æ—¶å¯ä»¥é…ç½®http proxy. ä½†æœ‰äº›ç–‘é—®:</p><ol><li>åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦ä½¿ç”¨http proxy?</li><li>å…·ä½“http proxyæ€ä¹ˆé…ç½®?</li><li>å…·ä½“http proxyçš„å®ç°åŸç†æ˜¯å•¥? åŒ…æ‹¬ httpClient å¦‚ä½•ä½¿ç”¨è¿™ä¸ªproxy? å…·ä½“çš„httpProxyæ€ä¹ˆå¤„ç†è¿™ç§åŒ…?</li></ol><h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>docker</li><li>ubuntu</li></ul><h2 id="http-proxy-æœåŠ¡ç«¯éƒ¨ç½²"><a href="#http-proxy-æœåŠ¡ç«¯éƒ¨ç½²" class="headerlink" title="http proxy æœåŠ¡ç«¯éƒ¨ç½²"></a>http proxy æœåŠ¡ç«¯éƒ¨ç½²</h2><p>Nginxé€šå¸¸æ˜¯ä½œä¸ºåå‘ä»£ç†, ä½†å…¶å®ä¹Ÿå¯ä»¥ä½œä¸ºæ­£å‘ä»£ç†ä½¿ç”¨:  <a href="https://github.com/reiz/nginx_proxy">nginx_proxy</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run -d -p <span class="token number">9999</span>:8888 -v <span class="token variable">$&#123;<span class="token environment constant">PWD</span>&#125;</span>/nginx_allowlist.conf:/usr/local/nginx/conf/nginx.conf reiz/nginx_proxy:0.0.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="http-proxy-å®¢æˆ·ç«¯é…ç½®"><a href="#http-proxy-å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="http proxy å®¢æˆ·ç«¯é…ç½®"></a>http proxy å®¢æˆ·ç«¯é…ç½®</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span><span class="token class-name">HostConfiguration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span><span class="token class-name">HttpClient</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span>methods<span class="token punctuation">.</span></span><span class="token class-name">GetMethod</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span>params<span class="token punctuation">.</span></span><span class="token class-name">HttpMethodParams</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpClientTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> ENCODING <span class="token operator">=</span> <span class="token string">"UTF-8"</span><span class="token punctuation">;</span>        <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://www.google.com"</span><span class="token punctuation">;</span>                <span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HostConfiguration</span> hostConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HostConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        hostConfiguration<span class="token punctuation">.</span><span class="token function">setProxy</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        client<span class="token punctuation">.</span><span class="token function">setHostConfiguration</span><span class="token punctuation">(</span>hostConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>        client<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>            <span class="token class-name">HttpMethodParams</span><span class="token punctuation">.</span>HTTP_CONTENT_CHARSET<span class="token punctuation">,</span> ENCODING<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">GetMethod</span> method <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetMethod</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> i <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">executeMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Code: "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">String</span> response <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getResponseBodyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ"><a href="#å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ" class="headerlink" title="å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ"></a>å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ</h2><p>ä¸é…ç½®proxy:</p><ul><li>client â€”http getâ€”&gt; <a href="http://www.google.com/">www.google.com</a></li></ul><p>é…ç½®äº†proxy:</p><ul><li>client â€” tcp â€”&gt; proxy â€” http get â€”&gt;  <a href="http://www.google.com/">www.google.com</a></li></ul><p>å¯ä»¥çœ‹åˆ°, client.executeMethodå®è´¨ä¸Šæ˜¯:</p><ol><li>clientå…ˆä¸proxyå»ºç«‹äº†TCPè¿æ¥.</li><li>ç„¶åå°†HTTPæŠ¥æ–‡, åŒ…æ‹¬ç›®æ ‡åŸŸå(å³GET <a href="http://www.google.com/">http://www.google.com</a>), ä½œä¸ºTCPçš„output streamä¼ ç»™proxy</li><li>proxyè§£ætcpæŠ¥æ–‡, è·å–åˆ°çœŸæ­£çš„ç›®æ ‡åŸŸå, æŸ¥æ‰¾DNSè·å–åˆ°google.comçš„ipåœ°å€.</li><li>proxyä¸google.comå»ºç«‹TCPè¿æ¥, å‘é€æŠ¥æ–‡bodyç­‰.</li></ol><p>è¿™ç§ä¹Ÿå«: relay, å³ä¸­ç»§.</p><h2 id="å®é™…è¿æ¥åˆ†æ"><a href="#å®é™…è¿æ¥åˆ†æ" class="headerlink" title="å®é™…è¿æ¥åˆ†æ"></a>å®é™…è¿æ¥åˆ†æ</h2><h3 id="hostä¸Šï¼Œ-LISTENäº†9999ç«¯å£"><a href="#hostä¸Šï¼Œ-LISTENäº†9999ç«¯å£" class="headerlink" title="hostä¸Šï¼Œ LISTENäº†9999ç«¯å£"></a>hostä¸Šï¼Œ LISTENäº†9999ç«¯å£</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/docker/nginx-forward-proxy$ <span class="token function">netstat</span> -natp <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token number">9999</span><span class="token punctuation">(</span>Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.<span class="token punctuation">)</span>tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:9999            <span class="token number">0.0</span>.0.0:*               LISTEN      -                   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®¹å™¨å†…éƒ¨ï¼Œ-LISTENäº†8888ç«¯å£"><a href="#å®¹å™¨å†…éƒ¨ï¼Œ-LISTENäº†8888ç«¯å£" class="headerlink" title="å®¹å™¨å†…éƒ¨ï¼Œ LISTENäº†8888ç«¯å£"></a>å®¹å™¨å†…éƒ¨ï¼Œ LISTENäº†8888ç«¯å£</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@84129a407795:/app<span class="token comment"># netstat -nat | fgrep 8888</span>tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8888            <span class="token number">0.0</span>.0.0:*               LISTEN     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å"><a href="#åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å" class="headerlink" title="åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å"></a>åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å</h3><ul><li><p>HOSTä¸Š Java è¿›ç¨‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads/Clash-Linux$ <span class="token function">netstat</span> -natp <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token number">9999</span><span class="token punctuation">(</span>Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.<span class="token punctuation">)</span>tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:9999            <span class="token number">0.0</span>.0.0:*               LISTEN      -                   tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:9999          <span class="token number">127.0</span>.0.1:42261         TIME_WAIT   -                   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®¹å™¨å†…éƒ¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@84129a407795:/app<span class="token comment"># netstat -nat | fgrep 8888</span>tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8888            <span class="token number">0.0</span>.0.0:*               LISTEN     tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.17</span>.0.4:8888         <span class="token number">172.17</span>.0.1:51960        TIME_WAIT  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><p>TODO:</p><ul><li>åœ¨è®¿é—®<code>http://www.google.com</code>æ—¶ï¼ŒJavaæµ‹è¯•ä»£ç æ­£å¸¸è¿”å›ç»“æœã€‚</li><li>åœ¨è®¿é—®<code>http://www.baidu.com</code>æ—¶ï¼Œ Javaä¼šå‡ºç°å¦‚ä¸‹å¼‚å¸¸ï¼Œç†è®ºä¸Šç”±äºä¸åœ¨nginxçš„ç™½åå•é‡Œåº”è¯¥è¢«blockçš„ï¼Œä½†ä¸ºå•¥ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Ÿ<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token operator">:</span> <span class="token class-name">Stream</span> closedat <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedInputStream</span><span class="token punctuation">.</span><span class="token function">getBufIfOpen</span><span class="token punctuation">(</span><span class="token class-name">BufferedInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">170</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">BufferedInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">336</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>WireLogInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">WireLogInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">69</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>ContentLengthInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ContentLengthInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">170</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>FilterInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">FilterInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">133</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>AutoCloseInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">AutoCloseInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">108</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>FilterInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">FilterInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>AutoCloseInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">AutoCloseInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">127</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>HttpMethodBase</span><span class="token punctuation">.</span><span class="token function">getResponseBody</span><span class="token punctuation">(</span><span class="token class-name">HttpMethodBase</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">690</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>HttpMethodBase</span><span class="token punctuation">.</span><span class="token function">getResponseBodyAsString</span><span class="token punctuation">(</span><span class="token class-name">HttpMethodBase</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">803</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>test<span class="token punctuation">.</span>javaweb<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>HttpClientProxyTest</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token class-name">HttpClientProxyTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h1 id="å†å›åˆ°å®è·µä¸­"><a href="#å†å›åˆ°å®è·µä¸­" class="headerlink" title="å†å›åˆ°å®è·µä¸­"></a>å†å›åˆ°å®è·µä¸­</h1><h2 id="å®è·µ1ï¼š-DNSåŠ«æŒ-æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå"><a href="#å®è·µ1ï¼š-DNSåŠ«æŒ-æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå" class="headerlink" title="å®è·µ1ï¼š DNSåŠ«æŒ+æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå"></a>å®è·µ1ï¼š DNSåŠ«æŒ+æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå</h2><p>é€šè¿‡DNSåŠ«æŒï¼Œå°†æ‰€æœ‰HTTPè¯·æ±‚éƒ½å®šä½åˆ°æ­£å‘ä»£ç†ä¸­ï¼Œåœ¨æ­£å‘ä»£ç†é‡Œè¿›è¡Œä»£ç†åŸŸåçš„é»‘ç™½åå•æ§åˆ¶ã€‚</p><ul><li>ç¼ºç‚¹ï¼š<ul><li>DNSåŠ«æŒå¯ä»¥è¢«æ‰‹åŠ¨ç¦ç”¨ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š<code>8.8.8.8</code>ç»•è¿‡DNSæœåŠ¡å™¨ï¼ˆå½“ç„¶å¦‚æœDNSè¯·æ±‚ç›´æ¥éƒ½è¢«åŠ«æŒï¼Œï¼‰ã€‚</li><li>åªé’ˆå¯¹HTTPè¯·æ±‚æœ‰æ•ˆï¼Œå¦‚æœçŸ¥é“ç›®æ ‡çš„IP, å¯ä»¥é€šè¿‡IPç›´è¿ä¸Šã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;åœ¨ä½¿ç”¨apacheçš„HttpClientæ—¶(è·å–å…¶ä»–å¸¸ç”¨çš„httpclient), ç»å¸¸ä¼šå‘ç°åˆå§‹åŒ–æ—¶å¯ä»¥é…ç½®http proxy. ä½†æœ‰äº›ç–‘é—®:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦ä½¿ç”¨http proxy?&lt;/li&gt;
&lt;li&gt;å…·ä½“http proxyæ€ä¹ˆé…ç½®?&lt;/li&gt;
&lt;li&gt;å…·ä½“http proxyçš„å®ç°åŸç†æ˜¯å•¥? åŒ…æ‹¬ httpClient å¦‚ä½•ä½¿ç”¨è¿™ä¸ªproxy? å…·ä½“çš„httpProxyæ€ä¹ˆå¤„ç†è¿™ç§åŒ…?&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;å®è·µ&quot;&gt;&lt;a href=&quot;#å®è·µ&quot; class=&quot;headerlink&quot; title=&quot;å®è·µ&quot;&gt;&lt;/a&gt;å®è·µ&lt;/h1&gt;&lt;h2 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ç¯å¢ƒ&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;docker&lt;/li&gt;
&lt;li&gt;ubuntu&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;http-proxy-æœåŠ¡ç«¯éƒ¨ç½²&quot;&gt;&lt;a href=&quot;#http-proxy-æœåŠ¡ç«¯éƒ¨ç½²&quot; class=&quot;headerlink&quot; title=&quot;http proxy æœåŠ¡ç«¯éƒ¨ç½²&quot;&gt;&lt;/a&gt;http proxy æœåŠ¡ç«¯éƒ¨ç½²&lt;/h2&gt;&lt;p&gt;Nginxé€šå¸¸æ˜¯ä½œä¸ºåå‘ä»£ç†, ä½†å…¶å®ä¹Ÿå¯ä»¥ä½œä¸ºæ­£å‘ä»£ç†ä½¿ç”¨:  &lt;a href=&quot;https://github.com/reiz/nginx_proxy&quot;&gt;nginx_proxy&lt;/a&gt;&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run -d -p &lt;span class=&quot;token number&quot;&gt;9999&lt;/span&gt;:8888 -v &lt;span class=&quot;token variable&quot;&gt;$&amp;#123;&lt;span class=&quot;token environment constant&quot;&gt;PWD&lt;/span&gt;&amp;#125;&lt;/span&gt;/nginx_allowlist.conf:/usr/local/nginx/conf/nginx.conf reiz/nginx_proxy:0.0.3&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;http-proxy-å®¢æˆ·ç«¯é…ç½®&quot;&gt;&lt;a href=&quot;#http-proxy-å®¢æˆ·ç«¯é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;http proxy å®¢æˆ·ç«¯é…ç½®&quot;&gt;&lt;/a&gt;http proxy å®¢æˆ·ç«¯é…ç½®&lt;/h2&gt;</summary>
    
    
    
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="iaas" scheme="https://davyjones2010.github.io/tags/iaas/"/>
    
    <category term="network" scheme="https://davyjones2010.github.io/tags/network/"/>
    
    <category term="cloud-computing" scheme="https://davyjones2010.github.io/tags/cloud-computing/"/>
    
    <category term="http-proxy" scheme="https://davyjones2010.github.io/tags/http-proxy/"/>
    
    <category term="proxy" scheme="https://davyjones2010.github.io/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡åˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€æœºè®¾è®¡ç¼ºé™·å¯¼è‡´çš„é—®é¢˜</title>
    <link href="https://davyjones2010.github.io/2022-07-06-state-machine-in-distributed-system/"/>
    <id>https://davyjones2010.github.io/2022-07-06-state-machine-in-distributed-system/</id>
    <published>2022-07-06T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><ul><li><p>ä¸ºæŸä¸ªå¯¹è±¡itemå»ºæ¨¡, æœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€å˜è¿, åœ¨æ•°æ®åº“ä¸­stateå­—æ®µè®°å½•:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072308671.png"></p></li><li><p>å…¶ä¸­processingè¿‡ç¨‹å¯èƒ½ä¼šæŒç»­æ—¶é—´è¾ƒä¹…, 10minå·¦å³</p></li><li><p>åœ¨æœåŠ¡ç«¯æŸä¸ªçº¿ç¨‹å“åº”è¯·æ±‚, è¯¥å¯¹è±¡å¤„äºprocessingè¿‡ç¨‹ä¸­æ—¶, æœåŠ¡å™¨å‘å¸ƒé‡å¯, å¯¼è‡´itemçŠ¶æ€ä¸€ç›´å¡åœ¨processing </p></li><li><p>è€ŒprocessingçŠ¶æ€, <strong>æœ¬èº«æ˜¯ä¸­é—´çŠ¶æ€, æ— æ³•è¿›è¡Œä»»ä½•äººè‚‰å¹²é¢„&#x2F;æ“ä½œ</strong>, ä»è€Œå¯¼è‡´åªèƒ½ä¸´æ—¶æäº¤æ•°æ®è®¢æ­£, å°†çŠ¶æ€å­—æ®µä¿®æ”¹å›â€initâ€, ç„¶åå†æ‰§è¡Œä¸€æ¬¡process.</p></li></ul><h1 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h1><p>ä»”ç»†æ€è€ƒäº†ä¸‹, å‘ç°è®¾è®¡çš„æ—¶å€™, æ ¹æœ¬åŸå› æ˜¯å¯¹äºä¸­é—´çŠ¶æ€æ²¡æœ‰åšå¥½å¤„ç†, å¦‚èƒŒæ™¯ä¸­ä»‹ç»çš„æœåŠ¡é‡å¯çš„å¤„ç†.<br>è€Œ<mark>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹, æœåŠ¡é‡å¯æ˜¯by designéœ€è¦è¢«æ¥å—çš„.</mark><br>è¿™é‡Œæ€è€ƒäº†ä¸‹å¯èƒ½çš„å‡ ç§å¤„ç†æ–¹å¼:</p><h2 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h2><ul><li>å¦‚ä½•åŒºåˆ†çŠ¶æ€æœºçš„ä¸­é—´çŠ¶æ€ä¸ç»ˆæ€? </li><li>ä¸€æ¡åŸåˆ™: <mark>ç»ˆæ€-&gt;ç»ˆæ€ä¹‹é—´, å¿…é¡»æ˜¯å¯ä»¥äººè‚‰æœ‰å…¥å£è§¦å‘çš„(è€Œä¸æ˜¯ç³»ç»Ÿè‡ªåŠ¨è§¦å‘çš„); å¿…é¡»æ˜¯å¯é‡å…¥çš„.</mark></li></ul><h2 id="æ–¹æ¡ˆ1-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€"><a href="#æ–¹æ¡ˆ1-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€" class="headerlink" title="æ–¹æ¡ˆ1: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€"></a>æ–¹æ¡ˆ1: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€</h2><ol><li><p>å°†processingä»çŠ¶æ€æœºä¸­åˆ é™¤æ‰, å¦‚ä¸‹: <br/><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072351350.png"></p></li><li><p>ä½¿ç”¨ åˆ†å¸ƒå¼é”&#x2F;dbå­—æ®µé” æ¥å®ç°æ’ä»–åŠŸèƒ½(å³itemåŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†, é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†ä¸€ä¸ªitemå¯¼è‡´æ­»é”&#x2F;é‡å¤è®¡ç®—ç­‰é—®é¢˜).</p><ol><li>åœ¨itemæ‰§è¡Œå‰, åŠ ä¸Šé”+é”è¶…æ—¶æ—¶é—´(å¦‚ä¾‹å­ä¸­çš„10min); å…¶ä»–çº¿ç¨‹è¦æ‰§è¡Œæ—¶, æ— æ³•æŠ¢åˆ°è¯¥itemçš„é”. </li><li>itemæ‰§è¡Œå®Œæˆä¹‹å, çŠ¶æ€ä¿®æ”¹ä¸ºfinishedä¹‹å, å†é‡Šæ”¾æ‰itemé”.</li><li>itemæ‰§è¡Œå¼‚å¸¸ä¸­æ–­(ä¾‹å¦‚æœåŠ¡å™¨é‡å¯, çº¿ç¨‹crashç­‰): ç­‰å¾…é”è¶…æ—¶. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li><li>itemæ‰§è¡Œå¤±è´¥: çº¿ç¨‹é‡Œcatchä½å¼‚å¸¸, ä¸»åŠ¨é‡Šæ”¾æ‰è¯¥itemé”. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li></ol></li><li><p>æˆ–è€…ä½¿ç”¨äº‹åŠ¡:(ä¸è¿‡æœ¬ä¾‹å­ä¸­ä¸é€‚åˆ, å› ä¸º10minå¤ªä¹…äº†, å…¶ä»–æ‰§è¡Œè€—æ—¶è¾ƒçŸ­30sä»¥å†…çš„å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ¡ˆ)  </p><ol><li>itemæ‰§è¡Œå‰å¼€å¯äº‹åŠ¡;</li><li>æ‰§è¡Œåä¿®æ”¹çŠ¶æ€ä¸ºfinished, commitäº‹åŠ¡.</li><li>itemæ‰§è¡Œå¼‚å¸¸ä¸­æ–­(ä¾‹å¦‚æœåŠ¡å™¨é‡å¯, çº¿ç¨‹crashç­‰): äº‹åŠ¡è‡ªåŠ¨å›æ»š. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li><li>itemæ‰§è¡Œå¤±è´¥: ä¸»åŠ¨å›æ»šäº‹åŠ¡. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li></ol></li></ol><h2 id="æ–¹æ¡ˆ2-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€"><a href="#æ–¹æ¡ˆ2-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€" class="headerlink" title="æ–¹æ¡ˆ2: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€"></a>æ–¹æ¡ˆ2: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€</h2><ol><li><p>éœ€è¦è®¾è®¡ä»processing-&gt;finished&#x2F;initçš„äººè‚‰è§¦å‘å…¥å£.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072354738.png"></p></li><li><p>å¦‚ä½•é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘è¯¥itemä»processing-&gt;finished&#x2F;initçš„å˜è¿? å‚è§æ–¹æ¡ˆ1ä¸­é”&#x2F;äº‹åŠ¡çš„æ–¹å¼</p></li></ol><h2 id="æ–¹æ¡ˆ3-ä¼˜é›…åœæœº"><a href="#æ–¹æ¡ˆ3-ä¼˜é›…åœæœº" class="headerlink" title="æ–¹æ¡ˆ3: ä¼˜é›…åœæœº"></a>æ–¹æ¡ˆ3: ä¼˜é›…åœæœº</h2><ol><li>åœ¨shutdown-hooké‡Œæ³¨å†Œäº‹ä»¶:<ol><li>å°†çŠ¶æ€æ”¹å›init. â€“&gt; required.</li><li>å°†workerçº¿ç¨‹interruptæ‰. â€“&gt; optional, å› ä¸ºå³ä½¿ä¸interrupt, è¿›ç¨‹åœæ­¢çº¿ç¨‹ä¹Ÿä¼šè¢«å›æ”¶.</li></ol></li><li>ä½†è¯¥æ–¹æ¡ˆæœ‰å¾ˆå¤§çš„ç¼ºé™·, å¦‚æœç›´æ¥<code>kill -9</code>, åˆ™shutdown-hookæ ¹æœ¬ä¸ä¼šæ‰§è¡Œ.</li></ol><h2 id="æœ€ç»ˆæ–¹æ¡ˆ"><a href="#æœ€ç»ˆæ–¹æ¡ˆ" class="headerlink" title="æœ€ç»ˆæ–¹æ¡ˆ"></a>æœ€ç»ˆæ–¹æ¡ˆ</h2><p>æœ€ç»ˆé‡‡ç”¨äº†æ–¹æ¡ˆ2, å› ä¸ºä»çŠ¶æ€æœºä¸­åˆ é™¤æ‰ä¸€ä¸ªç»ˆæ€, å¯¹ç°æœ‰ä»£ç æ”¹é€ é‡å¤ªå¤§äº†.</p><h1 id="å…¶ä»–æ€è€ƒ"><a href="#å…¶ä»–æ€è€ƒ" class="headerlink" title="å…¶ä»–æ€è€ƒ"></a>å…¶ä»–æ€è€ƒ</h1><ol><li>çŠ¶æ€æœºè®¾è®¡çš„æ—¶å€™, ä¸€å®šè¦æ…é‡è€ƒè™‘å“ªäº›æ˜¯ç»ˆæ€, å“ªäº›æ˜¯ä¸­é—´çŠ¶æ€. ä¸æ˜¯è¯´å› ä¸ºåœ¨æŸä¸ªçŠ¶æ€æŒç»­æ—¶é—´è¾ƒé•¿(å¦‚ä¾‹å­ä¸­çš„processing), å°±è¦ä½œä¸ºç»ˆæ€. </li><li>çŠ¶æ€æœºä¸­æ¯ä¸ªç»ˆæ€ä¹‹é—´, å¿…é¡»è€ƒè™‘å¯é‡å…¥æ€§; å¿…é¡»è¦ä¿è¯èƒ½äººè‚‰è§¦å‘ç»ˆæ€ä¹‹é—´çš„è½¬åŒ–. æœ¬æ–‡çš„ä¾‹å­å°±æ˜¯åé¢æ•™æ, itemå¡åœ¨processingè¿™ä¸ªç»ˆæ€, æ— æ³•è¿›è¡Œç¨‹åºä¸Šçš„ä»»ä½•æ“ä½œ.</li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ä¸ºæŸä¸ªå¯¹è±¡itemå»ºæ¨¡, æœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€å˜è¿, åœ¨æ•°æ®åº“ä¸­stateå­—æ®µè®°å½•:&lt;br&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072308671.png&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å…¶ä¸­processingè¿‡ç¨‹å¯èƒ½ä¼šæŒç»­æ—¶é—´è¾ƒä¹…, 10minå·¦å³&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;åœ¨æœåŠ¡ç«¯æŸä¸ªçº¿ç¨‹å“åº”è¯·æ±‚, è¯¥å¯¹è±¡å¤„äºprocessingè¿‡ç¨‹ä¸­æ—¶, æœåŠ¡å™¨å‘å¸ƒé‡å¯, å¯¼è‡´itemçŠ¶æ€ä¸€ç›´å¡åœ¨processing &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è€ŒprocessingçŠ¶æ€, &lt;strong&gt;æœ¬èº«æ˜¯ä¸­é—´çŠ¶æ€, æ— æ³•è¿›è¡Œä»»ä½•äººè‚‰å¹²é¢„&amp;#x2F;æ“ä½œ&lt;/strong&gt;, ä»è€Œå¯¼è‡´åªèƒ½ä¸´æ—¶æäº¤æ•°æ®è®¢æ­£, å°†çŠ¶æ€å­—æ®µä¿®æ”¹å›â€initâ€, ç„¶åå†æ‰§è¡Œä¸€æ¬¡process.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;æ–¹æ¡ˆ&lt;/h1&gt;&lt;p&gt;ä»”ç»†æ€è€ƒäº†ä¸‹, å‘ç°è®¾è®¡çš„æ—¶å€™, æ ¹æœ¬åŸå› æ˜¯å¯¹äºä¸­é—´çŠ¶æ€æ²¡æœ‰åšå¥½å¤„ç†, å¦‚èƒŒæ™¯ä¸­ä»‹ç»çš„æœåŠ¡é‡å¯çš„å¤„ç†.&lt;br&gt;è€Œ&lt;mark&gt;åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹, æœåŠ¡é‡å¯æ˜¯by designéœ€è¦è¢«æ¥å—çš„.&lt;/mark&gt;&lt;br&gt;è¿™é‡Œæ€è€ƒäº†ä¸‹å¯èƒ½çš„å‡ ç§å¤„ç†æ–¹å¼:&lt;/p&gt;
&lt;h2 id=&quot;åŸåˆ™&quot;&gt;&lt;a href=&quot;#åŸåˆ™&quot; class=&quot;headerlink&quot; title=&quot;åŸåˆ™&quot;&gt;&lt;/a&gt;åŸåˆ™&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å¦‚ä½•åŒºåˆ†çŠ¶æ€æœºçš„ä¸­é—´çŠ¶æ€ä¸ç»ˆæ€? &lt;/li&gt;
&lt;li&gt;ä¸€æ¡åŸåˆ™: &lt;mark&gt;ç»ˆæ€-&amp;gt;ç»ˆæ€ä¹‹é—´, å¿…é¡»æ˜¯å¯ä»¥äººè‚‰æœ‰å…¥å£è§¦å‘çš„(è€Œä¸æ˜¯ç³»ç»Ÿè‡ªåŠ¨è§¦å‘çš„); å¿…é¡»æ˜¯å¯é‡å…¥çš„.&lt;/mark&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ–¹æ¡ˆ1-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€&quot;&gt;&lt;a href=&quot;#æ–¹æ¡ˆ1-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ¡ˆ1: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€&quot;&gt;&lt;/a&gt;æ–¹æ¡ˆ1: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;å°†processingä»çŠ¶æ€æœºä¸­åˆ é™¤æ‰, å¦‚ä¸‹: &lt;br&gt;&lt;br&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072351350.png&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä½¿ç”¨ åˆ†å¸ƒå¼é”&amp;#x2F;dbå­—æ®µé” æ¥å®ç°æ’ä»–åŠŸèƒ½(å³itemåŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†, é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†ä¸€ä¸ªitemå¯¼è‡´æ­»é”&amp;#x2F;é‡å¤è®¡ç®—ç­‰é—®é¢˜).&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨itemæ‰§è¡Œå‰, åŠ ä¸Šé”+é”è¶…æ—¶æ—¶é—´(å¦‚ä¾‹å­ä¸­çš„10min); å…¶ä»–çº¿ç¨‹è¦æ‰§è¡Œæ—¶, æ— æ³•æŠ¢åˆ°è¯¥itemçš„é”. &lt;/li&gt;
&lt;li&gt;itemæ‰§è¡Œå®Œæˆä¹‹å, çŠ¶æ€ä¿®æ”¹ä¸ºfinishedä¹‹å, å†é‡Šæ”¾æ‰itemé”.&lt;/li&gt;
&lt;li&gt;itemæ‰§è¡Œå¼‚å¸¸ä¸­æ–­(ä¾‹å¦‚æœåŠ¡å™¨é‡å¯, çº¿ç¨‹crashç­‰): ç­‰å¾…é”è¶…æ—¶. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.&lt;/li&gt;
&lt;li&gt;itemæ‰§è¡Œå¤±è´¥: çº¿ç¨‹é‡Œcatchä½å¼‚å¸¸, ä¸»åŠ¨é‡Šæ”¾æ‰è¯¥itemé”. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æˆ–è€…ä½¿ç”¨äº‹åŠ¡:(ä¸è¿‡æœ¬ä¾‹å­ä¸­ä¸é€‚åˆ, å› ä¸º10minå¤ªä¹…äº†, å…¶ä»–æ‰§è¡Œè€—æ—¶è¾ƒçŸ­30sä»¥å†…çš„å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ¡ˆ)  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;itemæ‰§è¡Œå‰å¼€å¯äº‹åŠ¡;&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œåä¿®æ”¹çŠ¶æ€ä¸ºfinished, commitäº‹åŠ¡.&lt;/li&gt;
&lt;li&gt;itemæ‰§è¡Œå¼‚å¸¸ä¸­æ–­(ä¾‹å¦‚æœåŠ¡å™¨é‡å¯, çº¿ç¨‹crashç­‰): äº‹åŠ¡è‡ªåŠ¨å›æ»š. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.&lt;/li&gt;
&lt;li&gt;itemæ‰§è¡Œå¤±è´¥: ä¸»åŠ¨å›æ»šäº‹åŠ¡. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;æ–¹æ¡ˆ2-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€&quot;&gt;&lt;a href=&quot;#æ–¹æ¡ˆ2-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ¡ˆ2: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€&quot;&gt;&lt;/a&gt;æ–¹æ¡ˆ2: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;éœ€è¦è®¾è®¡ä»processing-&amp;gt;finished&amp;#x2F;initçš„äººè‚‰è§¦å‘å…¥å£.&lt;br&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072354738.png&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¦‚ä½•é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘è¯¥itemä»processing-&amp;gt;finished&amp;#x2F;initçš„å˜è¿? å‚è§æ–¹æ¡ˆ1ä¸­é”&amp;#x2F;äº‹åŠ¡çš„æ–¹å¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    
    <category term="learn-from-failure" scheme="https://davyjones2010.github.io/tags/learn-from-failure/"/>
    
    <category term="java" scheme="https://davyjones2010.github.io/tags/java/"/>
    
    <category term="good-design" scheme="https://davyjones2010.github.io/tags/good-design/"/>
    
    <category term="bad-design" scheme="https://davyjones2010.github.io/tags/bad-design/"/>
    
    <category term="state-machine" scheme="https://davyjones2010.github.io/tags/state-machine/"/>
    
    <category term="lock" scheme="https://davyjones2010.github.io/tags/lock/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›æœ‰æ„æ€çš„è®°å½•-4</title>
    <link href="https://davyjones2010.github.io/2022-07-03-random-snippets/"/>
    <id>https://davyjones2010.github.io/2022-07-03-random-snippets/</id>
    <published>2022-07-03T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<p>äº”çœ‹: çœ‹è¶‹åŠ¿, çœ‹å¸‚åœº, çœ‹å®¢æˆ·, çœ‹ç«äº‰, çœ‹è‡ªå·±.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;äº”çœ‹: çœ‹è¶‹åŠ¿, çœ‹å¸‚åœº, çœ‹å®¢æˆ·, çœ‹ç«äº‰, çœ‹è‡ªå·±.&lt;/p&gt;
</summary>
    
    
    
    
    <category term="soft-skills" scheme="https://davyjones2010.github.io/tags/soft-skills/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡Dubboåº”ç”¨æ€§èƒ½ä¼˜åŒ–</title>
    <link href="https://davyjones2010.github.io/2022-07-02-dubbo-app-perf-tunning/"/>
    <id>https://davyjones2010.github.io/2022-07-02-dubbo-app-perf-tunning/</id>
    <published>2022-07-02T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æ–°çš„åº”ç”¨ä»¥dubboæ¥å£å¯¹å¤–æš´éœ²è°ƒåº¦èƒ½åŠ›ã€‚<br>åœ¨ä¸Šçº¿å‰éœ€è¦æ•´ä½“å‹æµ‹ï¼Œç¡®è®¤ä¸‹ç³»ç»Ÿèƒ½åŠ›ä¸ç“¶é¢ˆã€‚</p><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>ç›®æ ‡QPS: 500+<br>ç›®æ ‡RT: 100ms-</p><h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042216549.png"></p><h2 id="åº”ç”¨æ¡†æ¶"><a href="#åº”ç”¨æ¡†æ¶" class="headerlink" title="åº”ç”¨æ¡†æ¶"></a>åº”ç”¨æ¡†æ¶</h2><ul><li>SpringBoot 2.5.6</li><li>Druid 1.1.22</li></ul><h2 id="æœºå™¨é…ç½®æ¸…å•"><a href="#æœºå™¨é…ç½®æ¸…å•" class="headerlink" title="æœºå™¨é…ç½®æ¸…å•"></a>æœºå™¨é…ç½®æ¸…å•</h2><ul><li>ECSè§„æ ¼ï¼š ecs.n4.2xlarge</li><li>2å°8C16G ç‹¬äº«å‹</li><li>CPU: 2.5 GHzä¸»é¢‘çš„Intel Â® Xeon Â®å¤„ç†å™¨</li><li>JDK 1.8</li><li>ç½‘ç»œï¼š 1.2Gbpsï¼Œå³è‡³å°‘æ”¯æŒ100MB&#x2F;sçš„å†…ç½‘å¸¦å®½</li></ul><h2 id="ä¸­é—´ä»¶é…ç½®æ¸…å•"><a href="#ä¸­é—´ä»¶é…ç½®æ¸…å•" class="headerlink" title="ä¸­é—´ä»¶é…ç½®æ¸…å•"></a>ä¸­é—´ä»¶é…ç½®æ¸…å•</h2><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><ul><li>è§„æ ¼ï¼š8C32GB</li><li>æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°é‡ï¼š30000</li><li>Hoståˆ°Redisçš„Pingå»¶æ—¶åœ¨1msä»¥å†…</li></ul><h3 id="DB-x2F-RDS"><a href="#DB-x2F-RDS" class="headerlink" title="DB&#x2F;RDS"></a>DB&#x2F;RDS</h3><ul><li>è§„æ ¼ï¼šmysql.x4.4xlarge.2 32C128GB</li><li>MySQL 5.7</li><li>æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°é‡ï¼š20000</li><li>Hoståˆ°DBçš„Pingå»¶æ—¶åœ¨1msä»¥å†…</li></ul><h1 id="å‹æµ‹è®°å½•"><a href="#å‹æµ‹è®°å½•" class="headerlink" title="å‹æµ‹è®°å½•"></a>å‹æµ‹è®°å½•</h1><h2 id="ç¬¬ä¸€è½®å‹æµ‹"><a href="#ç¬¬ä¸€è½®å‹æµ‹" class="headerlink" title="ç¬¬ä¸€è½®å‹æµ‹"></a>ç¬¬ä¸€è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ"><a href="#å‹æµ‹ç»“æœ" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul><li>å‹åˆ°140QPSæ—¶ï¼Œ RTå·²ç»é£™å‡åˆ°8s+ï¼›</li></ul><h3 id="å…¶ä»–æŒ‡æ ‡"><a href="#å…¶ä»–æŒ‡æ ‡" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul><li>cpu: å·²ç»åŸºæœ¬è·‘æ»¡äº†ï¼Œåˆ©ç”¨ç‡780+%ï¼›</li><li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li><li>ç½‘ç»œï¼š æ€»ä½“å…¥æµé‡åœ¨10Mbpsä»¥ä¸‹ï¼Œå‡ºæµé‡1Mbpsä»¥ä¸‹ï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li><li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li><li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li></ul><h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>æ ¹æ®åº”ç”¨æ—¥å¿—ï¼Œå‘ç°æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>Redisè®¿é—®<ul><li>å•æ¬¡schedule()è¯·æ±‚ï¼Œä¼šè¿ç»­ä¸²è¡Œè°ƒç”¨40+æ¬¡çš„redis getæ¥å£ã€‚</li><li>è¿™äº›ä¸²è¡Œçš„getè°ƒç”¨ï¼ŒåŠ èµ·æ¥å¹³å‡è€—æ—¶åœ¨6s+</li></ul></li><li>å…¶ä»–é—®é¢˜ï¼š<ul><li>apache.utilä¸­Pairç±»å‹åºåˆ—åŒ–é—®é¢˜</li></ul></li></ul><h3 id="Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ"><a href="#Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ" class="headerlink" title="Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ"></a>Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ</h3><h4 id="æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ"><a href="#æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ" class="headerlink" title="æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ"></a>æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ</h4><p>æŸ¥çœ‹äº†RedisæœåŠ¡ç«¯æ•´ä½“æ€§èƒ½æƒ…å†µï¼š</p><ul><li>å‡ºå£å¸¶å¯¬çˆ²100MBï¼Œç•¶æ™‚åªåˆ©ç”¨äº†10%å·¦å³</li><li>CPU Usage 14% å·¦å³</li><li>é€£æ¥æ•¸ï¼šæœ€å¤§æ”¯æŒ30000ï¼Œç•¶æ™‚åªæœ‰3å€‹ç©©å®šçš„é€£æ¥</li><li>QPS: é«˜å³¯æœŸQPSçˆ²6000ï¼Œè€Œå¯¦ä¾‹çš„maxçˆ²24wï¼Œä½¿ç”¨ç‡åƒ…çˆ²2.5%ï¼Œé é æ²’æœ‰é”åˆ°é™æµé–¾å€¼</li></ul><h4 id="æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ"><a href="#æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ" class="headerlink" title="æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ"></a>æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ</h4><ul><li>ç¶²çµ¡æµé‡ï¼š10MBå·¦å³ï¼Œé é æ²’æœ‰æ‰“æ»¿ã€‚</li><li>Load: å¾ˆä½ï¼Œ0.2ä»¥ä¸‹</li></ul><h4 id="å•é¡Œå®šä½"><a href="#å•é¡Œå®šä½" class="headerlink" title="å•é¡Œå®šä½"></a>å•é¡Œå®šä½</h4><p>åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œä¸€èˆ¬å°±åªèƒ½æ‡·ç–‘æ˜¯clienté€£æ¥å•é¡Œã€‚é¡ä¼¼HttpClientï¼Œå®¢æˆ¶ç«¯è«‹æ±‚éƒ½åœ¨æ’éšŠç­‰ç€ç²å–connectionã€‚</p><ul><li>æ–¹æ¡ˆ1ï¼š å¢å¤§é€£æ¥æ± é…ç½®ï¼Œå¢å¤§æœ€å¤§é€£æ¥æ•¸é‡ã€‚</li><li>æ–¹æ¡ˆ2ï¼š æ¸›å°‘è«‹æ±‚æ¬¡æ•¸</li></ul><h3 id="ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul><li>Redisä¼˜åŒ–ï¼š<ul><li>é‡‡ç”¨äº†æ–¹æ¡ˆ2ï¼š ä½¿ç”¨Redisçš„mgetï¼Œè€Œä¸æ˜¯å•ä¸ªgetã€‚ä»¥å‡å°‘ç½‘ç»œäº¤äº’</li><li>ä¸ºå•¥æ²¡é‡‡ç”¨æ–¹æ¡ˆ1ï¼Ÿ <blockquote><p>å› ä¸º SpringBoot 1.5.x ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨Jedisä½œä¸ºredis clientï¼Œæ¯”è¾ƒå¥½è°ƒæ•´connectionæ•°é‡ç­‰ã€‚<br/><br>ä½† SpringBoot 2.x ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨äº†Lettuceä½œä¸ºredis clientï¼Œæœ¬èº«åŸºäºNettyçš„å¼‚æ­¥IOæ–¹å¼å®ç°ï¼Œä¸Jedisä¸åŒï¼Œæœ¬èº«å°±æ”¯æŒå•ä¸ªè¿æ¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚<br>æ‰€ä»¥å®˜æ–¹ä¸å»ºè®®é…ç½®è¿æ¥æ± ã€‚</p></blockquote></li></ul></li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042214249.png"></p><ul><li>å…¶ä»–é—®é¢˜ä¼˜åŒ–<ul><li>è‡ªå·±é‡æ–°å®ç°äº†ä¸€ç‰ˆPairç±»å‹çš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–æ–¹å¼</li></ul></li></ul><h2 id="ç¬¬äºŒè½®å‹æµ‹"><a href="#ç¬¬äºŒè½®å‹æµ‹" class="headerlink" title="ç¬¬äºŒè½®å‹æµ‹"></a>ç¬¬äºŒè½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-1"><a href="#å‹æµ‹ç»“æœ-1" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul><li>åœ¨250QPSæ—¶ï¼ŒRTåŸºæœ¬ç¨³å®šåœ¨100msä»¥ä¸‹</li><li>å‹åˆ°300QPSæ—¶ï¼ŒRTçªç„¶é£™å‡åˆ°3s+</li><li>cpuåˆ©ç”¨ç‡è¾ƒä½</li><li>å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³</li><li>æ²¡æœ‰å‘ç”ŸGC</li></ul><h3 id="åŸå› åˆ†æ-1"><a href="#åŸå› åˆ†æ-1" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>æ ¹æ®æ—¥å¿—æ‰“ç‚¹ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°å½“æ—¶çš„ç“¶é¢ˆå°±åœ¨ram-clientè°ƒç”¨é‰´æƒæœåŠ¡é‰´æƒä¸Šã€‚</p><ul><li>RAMæ¥å£é—®é¢˜ï¼š</li></ul><h3 id="ä¼˜åŒ–æ–¹æ¡ˆ-1"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ-1" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul><li>RAM Clientä¼˜åŒ–ï¼š<ul><li>å¢å¤§clientçš„max-connectionsæ•°é‡ï¼Œå¢å¤§åˆ°300ã€‚</li></ul></li></ul><blockquote><p>è¿™é‡Œæœ‰ä¸ªæ’æ›²ï¼Œå½“å¢å¤§clientçš„max-connectionsæ•°é‡åˆ°300ä¹‹åï¼Œé‡æ–°è¿›è¡Œäº†ä¸€æ¬¡å‹æµ‹ï¼Œå‘ç°QPSå¹¶æ²¡æœ‰æå‡ï¼ŒRTçš„ç“¶é¢ˆä»ç„¶åœ¨è®¿é—®RAMä¸Šï¼ <br/><br>åç»­çœ‹äº†ram-clientçš„å‘å¸ƒè®°å½•ï¼Œå‘ç°å±äºram-clientçš„ä¸€ä¸ªbugã€‚<br/><br>ram-clientä½¿ç”¨äº†http-clientä½œä¸ºå†…éƒ¨å®ç°ã€‚<br/><br>å½“å‰ç‰ˆæœ¬ä¸­ï¼Œå¢å¤§max-connectionsæ•°é‡ï¼Œåªæ˜¯å¢å¤§äº†httpclientå…¨å±€æ”¯æŒçš„connectionæ•°é‡ï¼Œè€Œå•ä¸ªhostæ”¯æŒçš„connectionæ•°é‡ä»ç„¶æ˜¯é»˜è®¤å€¼ï¼Œå³8. <br/><br>ç”±äºè®¿é—®ramçš„endpointå°±æ˜¯å•ä¸ªhostï¼Œå› æ­¤ç›¸å½“äºè¯¥é…ç½®æ²¡æœ‰ç”Ÿæ•ˆï¼ <br/><br>åç»­å‡çº§äº†ram-clientç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬å®ç°é‡Œï¼Œå°†max-connectionså€¼åŒæ—¶èµ‹ç»™äº†max-connections-per-hostï¼Œå› æ­¤ç›¸å½“äºmax-connections-per-hostä¹Ÿè¢«è°ƒå¤§ä¸º300äº†<br/><br>å…³äºmax-connectionsä¸max-connections-per-hostå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼Œå‚è§ï¼š <a href="https://davyjones2010.github.io/2022-03-15-http-client-netty/">å¼‚æ­¥HttpClientä½¿ç”¨Nettyä½œä¸ºSocketChannelçš„Provider</a></p></blockquote><h2 id="ç¬¬ä¸‰è½®å‹æµ‹"><a href="#ç¬¬ä¸‰è½®å‹æµ‹" class="headerlink" title="ç¬¬ä¸‰è½®å‹æµ‹"></a>ç¬¬ä¸‰è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-2"><a href="#å‹æµ‹ç»“æœ-2" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul><li><p>200QPS, 80ms RT</p></li><li><p>300QPSï¼Œ2000ms RT</p></li><li><p>ç»“æœä¸ä¸Šè½®ç›¸æ¯”ï¼Œå¹¶æ²¡æœ‰æ˜¾è‘—æå‡ã€‚</p></li><li><p>æ ¹æ®æ—¥å¿—åˆ†æï¼Œramclientè€—æ—¶å·²ç»è¶‹äºå¹³ç¨³ï¼Œå¹³å‡10msä»¥ä¸‹ï¼Œè°ƒåº¦è€—æ—¶åˆä¸Šæ¥äº†ã€‚</p></li></ul><h3 id="å…¶ä»–æŒ‡æ ‡-1"><a href="#å…¶ä»–æŒ‡æ ‡-1" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul><li>cpu: åˆ©ç”¨ç‡è¾ƒé«˜ï¼Œ780%+</li><li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li><li>ç½‘ç»œï¼š æ€»ä½“æµé‡åœ¨10Mbpsï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li><li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li><li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li></ul><h3 id="åŸå› åˆ†æ-2"><a href="#åŸå› åˆ†æ-2" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042215103.png"><br>æ ¹æ®å½“æ—¶çš„çº¿ç¨‹å †æ ˆåˆ†æï¼Œå ç”¨CPUé‡æœ€å¤§çš„å°±æ˜¯8ä¸ªlettuceçº¿ç¨‹ï¼Œå‡ ä¹æŠŠCPUæ—¶é—´ç‰‡å æ»¡äº†ã€‚<br>åŒæ—¶æœç´¢äº†ç›¸å…³é—®é¢˜ ï¼Œå‘ç°<a href="https://gitter.im/lettuce-io/Lobby?at=5de8f93446397c721c8ed8ed">ä¸æ˜¯ä¸ªä¾‹</a>ã€‚<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042215636.png"></p><h3 id="ä¼˜åŒ–æ–¹æ¡ˆ-2"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ-2" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul><li>Redis:<ul><li>ä½¿ç”¨Jedisä½œä¸ºClientï¼Œå¹¶ä¸”è°ƒå¤§Jediså¯¹åº”çš„è¿æ¥æ± æ•°é‡</li></ul></li></ul><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.redis.client-type</span><span class="token punctuation">=</span><span class="token value attr-value">jedis</span><span class="token key attr-name">spring.redis.jedis.pool.max-active</span><span class="token punctuation">=</span><span class="token value attr-value">100</span><span class="token key attr-name">spring.redis.jedis.pool.max-idle</span><span class="token punctuation">=</span><span class="token value attr-value">16</span><span class="token key attr-name">spring.redis.jedis.pool.max-wait</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬å››è½®å‹æµ‹"><a href="#ç¬¬å››è½®å‹æµ‹" class="headerlink" title="ç¬¬å››è½®å‹æµ‹"></a>ç¬¬å››è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-3"><a href="#å‹æµ‹ç»“æœ-3" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul><li>300QPSï¼Œ100ms RT</li><li>350QPSï¼Œ200ms RT</li><li>400QPSï¼Œ2000ms RT</li></ul><h3 id="å…¶ä»–æŒ‡æ ‡-2"><a href="#å…¶ä»–æŒ‡æ ‡-2" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul><li>cpu: åˆ©ç”¨ç‡è¾ƒé«˜ï¼Œ780%+</li><li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li><li>ç½‘ç»œï¼š æ€»ä½“æµé‡åœ¨10Mbpsï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li><li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li><li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li></ul><h3 id="åŸå› åˆ†æ-3"><a href="#åŸå› åˆ†æ-3" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>æ‰“å°å‡ºäº†å½“æ—¶çš„çº¿ç¨‹æ ˆä¿¡æ¯ï¼Œè¿›è¡Œäº†è¯¦ç»†çš„åˆ†æå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>çº¿ç¨‹æ•°é‡</th></tr></thead><tbody><tr><td>ç²å–Druidé€£æ¥</td><td>442</td></tr><tr><td>æ­¸é‚„Druidé€£æ¥</td><td>164</td></tr><tr><td>æ¥­å‹™ç·šç¨‹ä¸­Bindæ“ä½œ</td><td>107</td></tr><tr><td>Log4jæ‰“å°</td><td>77</td></tr><tr><td>JedisåŸ·è¡Œ</td><td>2</td></tr></tbody></table><ul><li>å¤§éƒ¨åˆ†çº¿ç¨‹å¡åœ¨Druidæ•°æ®åº“è¿æ¥æ± å½’è¿˜è¿æ¥ã€è·å–è¿æ¥çš„æ¶é–é˜¶æ®µï¼ˆlock()ï¼‰</li><li>å°éƒ¨åˆ†çº¿ç¨‹ç”±äºbind()å¼‚æ­¥çº¿ç¨‹æ± é˜Ÿåˆ—æ»¡ï¼Œå¯¼è‡´å ç”¨äº†ä¸šåŠ¡çº¿ç¨‹</li><li>æœ€åä¸€éƒ¨åˆ†çº¿ç¨‹å¡ï¼ˆblockedï¼‰åœ¨log4jæ‰“å°æ—¥å¿—</li></ul><h4 id="Druidè¿æ¥æ± é—®é¢˜"><a href="#Druidè¿æ¥æ± é—®é¢˜" class="headerlink" title="Druidè¿æ¥æ± é—®é¢˜"></a>Druidè¿æ¥æ± é—®é¢˜</h4><p>èˆ‡ <a href="https://blog.csdn.net/beFocused/article/details/108533137">è®°ä¸€æ¬¡Dubboçº¿ç¨‹è€—å°½çš„é—®é¢˜-druidæ•°æ®åº“è¿æ¥æ± çªå‘æ€§èƒ½</a> æ–‡ä¸­çš„å•é¡Œä¸€æ¨¡ä¸€æ¨£ã€‚</p><h4 id="å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜"><a href="#å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜" class="headerlink" title="å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜"></a>å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜</h4><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042216269.png"></p><p>éšŠåˆ—é»˜èªé•·åº¦çˆ²200ï¼Œåœ¨200çš„é•·åº¦æ»¿äº†ä¹‹å¾Œï¼Œä½¿ç”¨çš„æ˜¯<code>ThreadPoolExecutor.CallerRunsPolicy</code>, å³ä¸å†åœ¨ç•°æ­¥ç·šç¨‹è£åŸ·è¡Œï¼Œè€Œæ˜¯åœ¨callerç·šç¨‹ä¸­åŸ·è¡Œã€‚<br>å¾è€Œå°è‡´æ¥­å‹™ç·šç¨‹å£“åŠ›é€²ä¸€æ­¥å¢å¤§ã€‚</p><h4 id="Log4jæ—¥å¿—é—®é¢˜"><a href="#Log4jæ—¥å¿—é—®é¢˜" class="headerlink" title="Log4jæ—¥å¿—é—®é¢˜"></a>Log4jæ—¥å¿—é—®é¢˜</h4><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042216085.png"><br>ä¹Ÿæ˜¯æ¯”è¼ƒç¶“å…¸çš„å•é¡Œï¼Œä½¿ç”¨Log2jçš„ç•°æ­¥loggerå³å¯è§£æ±ºã€‚</p><h3 id="ä¼˜åŒ–æ–¹æ¡ˆ-3"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ-3" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul><li><p>Druidä¼˜åŒ–ï¼š </p><ul><li>å¢å¤§è¿æ¥æ± ä¸­initialä¸maxçš„è¿æ¥æ•°é‡</li><li>ä½¿ç”¨éå…¬å¹³é”ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„å…¬å¹³é”ã€‚å…·ä½“å‚è§<a href="https://mp.weixin.qq.com/s/RaiU9_ioWHvomZLLKuSuGw">æœ‰èµçš„å‹æµ‹è®°å½•</a>ã€‚<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.datasource.druid.maxActive</span><span class="token punctuation">=</span><span class="token value attr-value">600</span><span class="token key attr-name">spring.datasource.druid.initialSize</span><span class="token punctuation">=</span><span class="token value attr-value">300</span><span class="token key attr-name">spring.datasource.druid.maxWait</span><span class="token punctuation">=</span><span class="token value attr-value">6000</span><span class="token key attr-name">spring.datasource.druid.minIdle</span><span class="token punctuation">=</span><span class="token value attr-value">300</span><span class="token key attr-name">spring.datasource.druid.poolPreparedStatements</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span class="token key attr-name">spring.datasource.druid.maxOpenPreparedStatements</span><span class="token punctuation">=</span><span class="token value attr-value">20</span><span class="token key attr-name">spring.datasource.druid.useUnfairLock</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>bindçº¿ç¨‹æ± ä¼˜åŒ–ï¼š</p><ul><li>å¢å¤§é˜Ÿåˆ—å¤§å°ï¼Œä»200å¢å¤§åˆ°20000</li></ul></li><li><p>log4jä¼˜åŒ–ï¼š</p><ul><li>ä½¿ç”¨log4j2çš„asyncLoggerã€‚</li></ul></li></ul><h2 id="ç¬¬äº”è½®å‹æµ‹"><a href="#ç¬¬äº”è½®å‹æµ‹" class="headerlink" title="ç¬¬äº”è½®å‹æµ‹"></a>ç¬¬äº”è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-4"><a href="#å‹æµ‹ç»“æœ-4" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul><li>åœ¨600QPSæ—¶ï¼ŒRTåŸºæœ¬ç¨³å®šåœ¨40msä»¥ä¸‹ã€‚</li><li>ç”±äºæ¯æ¬¡è°ƒç”¨æ¥å£ï¼Œéƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ramé‰´æƒæ¥å£ï¼Œramæ•´ä½“é™åˆ¶å•ä¸ªç§Ÿæˆ·éœ€è¦å°äº600qpsï¼›ä¹Ÿæ‹…å¿ƒæŠŠramæ¥å£æ‰“æŒ‚æˆ–è€…è¢«ramé™æµï¼Œå› æ­¤ä¸å†ç»§ç»­å‹æµ‹ã€‚</li><li>æŒ‰ç…§å…¶ä»–æŒ‡æ ‡æ¨æµ‹ï¼Œ<mark> ç†è®ºä¸Šå¯ä»¥æ‰“åˆ°1000QPS+ï¼Œå³å•æœº500QPS+ </mark></li><li>ç»ˆäºè¾¾æ ‡äº†ï¼~ æ’’èŠ±åº†ç¥~~~</li></ul><h3 id="å…¶ä»–æŒ‡æ ‡-3"><a href="#å…¶ä»–æŒ‡æ ‡-3" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul><li>cpu: åˆ©ç”¨ç‡è¾ƒä½ï¼Œ400%å·¦å³</li><li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li><li>ç½‘ç»œï¼š æ€»ä½“æµé‡åœ¨10Mbpsï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li><li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li><li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li></ul><h1 id="ä¼˜åŒ–æ€»ç»“"><a href="#ä¼˜åŒ–æ€»ç»“" class="headerlink" title="ä¼˜åŒ–æ€»ç»“"></a>ä¼˜åŒ–æ€»ç»“</h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;æ–°çš„åº”ç”¨ä»¥dubboæ¥å£å¯¹å¤–æš´éœ²è°ƒåº¦èƒ½åŠ›ã€‚&lt;br&gt;åœ¨ä¸Šçº¿å‰éœ€è¦æ•´ä½“å‹æµ‹ï¼Œç¡®è®¤ä¸‹ç³»ç»Ÿèƒ½åŠ›ä¸ç“¶é¢ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç›®æ ‡&quot;&gt;&lt;a href=&quot;#ç›®æ ‡&quot; class=&quot;headerlink&quot; title=&quot;ç›®æ ‡&quot;&gt;&lt;/a&gt;ç›®æ ‡&lt;/h2&gt;&lt;p&gt;ç›®æ ‡QPS: 500+&lt;br&gt;ç›®æ ‡RT: 100ms-&lt;/p&gt;
&lt;h2 id=&quot;æ•´ä½“æ¶æ„&quot;&gt;&lt;a href=&quot;#æ•´ä½“æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;æ•´ä½“æ¶æ„&quot;&gt;&lt;/a&gt;æ•´ä½“æ¶æ„&lt;/h2&gt;&lt;p&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042216549.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;åº”ç”¨æ¡†æ¶&quot;&gt;&lt;a href=&quot;#åº”ç”¨æ¡†æ¶&quot; class=&quot;headerlink&quot; title=&quot;åº”ç”¨æ¡†æ¶&quot;&gt;&lt;/a&gt;åº”ç”¨æ¡†æ¶&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;SpringBoot 2.5.6&lt;/li&gt;
&lt;li&gt;Druid 1.1.22&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æœºå™¨é…ç½®æ¸…å•&quot;&gt;&lt;a href=&quot;#æœºå™¨é…ç½®æ¸…å•&quot; class=&quot;headerlink&quot; title=&quot;æœºå™¨é…ç½®æ¸…å•&quot;&gt;&lt;/a&gt;æœºå™¨é…ç½®æ¸…å•&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ECSè§„æ ¼ï¼š ecs.n4.2xlarge&lt;/li&gt;
&lt;li&gt;2å°8C16G ç‹¬äº«å‹&lt;/li&gt;
&lt;li&gt;CPU: 2.5 GHzä¸»é¢‘çš„Intel Â® Xeon Â®å¤„ç†å™¨&lt;/li&gt;
&lt;li&gt;JDK 1.8&lt;/li&gt;
&lt;li&gt;ç½‘ç»œï¼š 1.2Gbpsï¼Œå³è‡³å°‘æ”¯æŒ100MB&amp;#x2F;sçš„å†…ç½‘å¸¦å®½&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
    <category term="java" scheme="https://davyjones2010.github.io/tags/java/"/>
    
    <category term="dubbo" scheme="https://davyjones2010.github.io/tags/dubbo/"/>
    
    <category term="perf-tunning" scheme="https://davyjones2010.github.io/tags/perf-tunning/"/>
    
    <category term="redis" scheme="https://davyjones2010.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Java&amp;JVM&amp;OQL å¸¸ç”¨å‘½ä»¤ä¸è„šæœ¬æ€»ç»“</title>
    <link href="https://davyjones2010.github.io/2022-07-01-java-jvm/"/>
    <id>https://davyjones2010.github.io/2022-07-01-java-jvm/</id>
    <published>2022-07-01T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java-amp-JVM"><a href="#Java-amp-JVM" class="headerlink" title="Java&amp;JVM"></a>Java&amp;JVM</h1><h2 id="æ‰“-HeapDump"><a href="#æ‰“-HeapDump" class="headerlink" title="æ‰“ HeapDump"></a>æ‰“ HeapDump</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jmap -dump:live,file<span class="token operator">=</span>heapdump.phrof <span class="token variable">$pid</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jmap -dump:live,file<span class="token operator">=</span>heapdump.phrof -F <span class="token variable">$pid</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<mark>å°½é‡ä¸è¦ä½¿ç”¨-Få‚æ•°ã€‚</mark> å› ä¸º-Fä½¿ç”¨çš„æ˜¯Linuxæ“ä½œç³»ç»Ÿå±‚é¢çš„å®ç°ï¼Œè€Œä¸æ˜¯JVMå±‚é¢çš„å®ç°ï¼Œä¼šå¯¼è‡´ æ‰“å°å †ä¿¡æ¯å¾ˆæ…¢ã€‚<br/><br>å¦‚æœæç¤ºç¬¬ä¸€ç§æ–¹å¼æ‰“å°ä¸å‡ºæ¥å †çš„ä¿¡æ¯ï¼Œéœ€è¦å¢åŠ -Fï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæ£€æŸ¥ä¸‹ï¼š</p><ol><li>Javaåº”ç”¨è¿›ç¨‹çš„user_nameæ˜¯å¦ä¸å½“å‰çš„user_nameç›¸åŒï¼Ÿ å¦‚æœä¸åŒï¼Œéœ€è¦åˆ‡æ¢ä¸ºåŒä¸€ä¸ªè´¦å·ã€‚</li><li>Javaåº”ç”¨è¿›ç¨‹çš„Javaè·¯å¾„æ˜¯å¦ä¸å½“å‰jmapå‘½ä»¤çš„è·¯å¾„ç›¸åŒï¼Ÿ å¦‚æœä¸åŒï¼Œéœ€è¦åˆ‡æ¢ä¸ºåŒä¸€ä¸ªè·¯å¾„ã€‚</li></ol></blockquote><h2 id="æ‰“-ThreadDump"><a href="#æ‰“-ThreadDump" class="headerlink" title="æ‰“ ThreadDump"></a>æ‰“ ThreadDump</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jstack <span class="token variable">$pid</span> <span class="token operator">></span> tmp.jstack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æ³¨æ„: å½“CPUåˆ©ç”¨ç‡é«˜æˆ–è€…æƒ³çœ‹ä¸‹çº¿ç¨‹å¡åœ¨å“ªé‡Œæ—¶ï¼Œ<mark>æœ€å¥½éš”å‡ ç§’å°±æ‰“ä¸€ä¸ªçº¿ç¨‹æ ˆï¼Œæ¯ä¸ªçº¿ç¨‹æ ˆéƒ½ä¿ç•™ä¸‹æ¥</mark> <br/><br>å¤šä¸ªçº¿ç¨‹æ ˆå¯¹æ¯”èµ·æ¥çœ‹ï¼Œä¼šæ›´èƒ½æ›´å¥½åœ°å‘ç°é—®é¢˜ã€‚</p></blockquote><h2 id="æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯"><a href="#æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯"></a>æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯</h2><p>éœ€è¦ä¸ThreadDumpä¸€èµ·ä½¿ç”¨ï¼Œæ‰èƒ½å®šä½åˆ°å…·ä½“æ˜¯Javaä¸­å“ªä¸ªçº¿ç¨‹ã€‚</p><ol><li>æŸ¥çœ‹æ¶ˆè€—cpuæ—¶é—´ç‰‡æœ€å¤šçš„è¿›ç¨‹å·<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// æŸ¥çœ‹ç¬æ—¶æ¶ˆè€—CPUï¼Œå€’åºæ’åˆ—<span class="token function">top</span> -o %CPU// æŸ¥çœ‹ç´¯è®¡æ¶ˆè€—CPUæ—¶é—´ç‰‡ï¼Œå€’åºæ’åˆ—<span class="token function">top</span> -o TIME+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">top</span> -o %CPU<span class="token function">top</span> - <span class="token number">21</span>:39:35 up <span class="token number">10</span>:52,  <span class="token number">1</span> user,  load average: <span class="token number">1.47</span>, <span class="token number">1.36</span>, <span class="token number">1.14</span>Tasks: <span class="token number">325</span> total,   <span class="token number">4</span> running, <span class="token number">320</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">1</span> zombie%Cpu0  <span class="token builtin class-name">:</span>  <span class="token number">8.2</span> us,  <span class="token number">4.1</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">87.4</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.3</span> si,  <span class="token number">0.0</span> st%Cpu1  <span class="token builtin class-name">:</span>  <span class="token number">7.5</span> us,  <span class="token number">3.8</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">88.7</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st%Cpu2  <span class="token builtin class-name">:</span> <span class="token number">11.6</span> us,  <span class="token number">2.7</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">85.4</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.3</span> si,  <span class="token number">0.0</span> st%Cpu3  <span class="token builtin class-name">:</span>  <span class="token number">8.4</span> us,  <span class="token number">3.0</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">88.6</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> stMiB Mem <span class="token builtin class-name">:</span>   <span class="token number">7823.4</span> total,    <span class="token number">172.0</span> free,   <span class="token number">5254.4</span> used,   <span class="token number">2397.0</span> buff/cacheMiB Swap:   <span class="token number">2048.0</span> total,    <span class="token number">252.2</span> free,   <span class="token number">1795.7</span> used.   <span class="token number">1107.3</span> avail Mem     PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                         <span class="token number">2318</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178536</span> <span class="token number">247920</span>  <span class="token number">52372</span> R  <span class="token number">12.5</span>   <span class="token number">3.1</span>  <span class="token number">24</span>:33.00 gnome-shell                                     <span class="token number">2099</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">1008428</span> <span class="token number">112204</span>  <span class="token number">78172</span> R  <span class="token number">11.2</span>   <span class="token number">1.4</span>  <span class="token number">23</span>:31.71 Xorg                                            <span class="token number">6521</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">868244</span>  <span class="token number">35580</span>  <span class="token number">23924</span> R   <span class="token number">5.9</span>   <span class="token number">0.4</span>   <span class="token number">0</span>:38.61 gnome-terminal-                                 <span class="token number">5308</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">6370752</span> <span class="token number">517952</span> <span class="token number">219108</span> S   <span class="token number">2.6</span>   <span class="token number">6.5</span>  <span class="token number">39</span>:38.79 firefox                                      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>æŸ¥çœ‹è¿›ç¨‹ä¸‹æ¶ˆè€—æ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹å·</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">top</span> -Hp <span class="token variable">$pid</span> -o %CPU<span class="token function">top</span> -Hp <span class="token variable">$pid</span> -o TIME+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">top</span> -Hp <span class="token number">2318</span><span class="token function">top</span> - <span class="token number">21</span>:42:00 up <span class="token number">10</span>:55,  <span class="token number">1</span> user,  load average: <span class="token number">1.08</span>, <span class="token number">1.38</span>, <span class="token number">1.19</span>Threads:  <span class="token number">15</span> total,   <span class="token number">0</span> running,  <span class="token number">15</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie%Cpu<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:  <span class="token number">5.7</span> us,  <span class="token number">1.9</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">92.3</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.1</span> si,  <span class="token number">0.0</span> stMiB Mem <span class="token builtin class-name">:</span>   <span class="token number">7823.4</span> total,    <span class="token number">158.1</span> free,   <span class="token number">5264.5</span> used,   <span class="token number">2400.9</span> buff/cacheMiB Swap:   <span class="token number">2048.0</span> total,    <span class="token number">250.8</span> free,   <span class="token number">1797.2</span> used.   <span class="token number">1092.3</span> avail Mem     PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                         <span class="token number">2318</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178588</span> <span class="token number">247724</span>  <span class="token number">52288</span> S   <span class="token number">5.7</span>   <span class="token number">3.1</span>  <span class="token number">24</span>:28.42 gnome-shell                                     <span class="token number">2331</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178588</span> <span class="token number">247724</span>  <span class="token number">52288</span> S   <span class="token number">0.0</span>   <span class="token number">3.1</span>   <span class="token number">0</span>:00.34 gmain                                           <span class="token number">2335</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178588</span> <span class="token number">247724</span>  <span class="token number">52288</span> S   <span class="token number">0.0</span>   <span class="token number">3.1</span>   <span class="token number">0</span>:11.10 gdbus                                        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å°†10è¿›åˆ¶è½¬æˆ16è¿›åˆ¶<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">printf</span> <span class="token string">'%x\n'</span> <span class="token environment constant">$PPID</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// <span class="token number">10</span>è¿›åˆ¶è½¬æˆ16è¿›åˆ¶davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token builtin class-name">printf</span> <span class="token string">'%x\n'</span> <span class="token number">2318</span>90e// <span class="token number">16</span>è¿›åˆ¶è½¬æˆ10è¿›åˆ¶davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token builtin class-name">printf</span> <span class="token string">'%d\n'</span> 0x90e<span class="token number">2318</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>æŸ¥çœ‹jstackä¸­å¯¹åº”çš„çº¿ç¨‹ä¿¡æ¯</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">fgrep</span> <span class="token string">"0x90e"</span> tmp.jstack -C <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æŸ¥çœ‹JVMé»˜è®¤HeapSize"><a href="#æŸ¥çœ‹JVMé»˜è®¤HeapSize" class="headerlink" title="æŸ¥çœ‹JVMé»˜è®¤HeapSize"></a>æŸ¥çœ‹JVMé»˜è®¤HeapSize</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -XX:+PrintFlagsFinal -version <span class="token operator">|</span> <span class="token function">fgrep</span> HeapSize// æŸ¥çœ‹java_home, class_pathç­‰é»˜è®¤é…ç½®ä¸ç³»ç»Ÿç¯å¢ƒå˜é‡java -XshowSettings:all<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚ä¸‹ï¼Œé»˜è®¤HeapSizeä¸º130023424&#x2F;1024&#x2F;1024&#x3D;124MB<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ java -XX:+PrintFlagsFinal -version <span class="token operator">|</span> <span class="token function">fgrep</span> HeapSize    uintx ErgoHeapSizeLimit                         <span class="token operator">=</span> <span class="token number">0</span>                                   <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>    uintx HeapSizePerGCThread                       <span class="token operator">=</span> <span class="token number">87241520</span>                            <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>    uintx InitialHeapSize                          :<span class="token operator">=</span> <span class="token number">130023424</span>                           <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>    uintx LargePageHeapSizeThreshold                <span class="token operator">=</span> <span class="token number">134217728</span>                           <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>    uintx MaxHeapSize                              :<span class="token operator">=</span> <span class="token number">2051014656</span>                          <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>openjdk version <span class="token string">"1.8.0_312"</span>OpenJDK Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_312-8u312-b07-0ubuntu1~20.04-b07<span class="token punctuation">)</span>OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.312</span>-b07, mixed mode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ java -XshowSettings:allVM settings:    Max. Heap Size <span class="token punctuation">(</span>Estimated<span class="token punctuation">)</span>: <span class="token number">1</span>.70G    Ergonomics Machine Class: server    Using VM: OpenJDK <span class="token number">64</span>-Bit Server VMProperty settings:    awt.toolkit <span class="token operator">=</span> sun.awt.X11.XToolkit    file.encoding <span class="token operator">=</span> UTF-8    file.encoding.pkg <span class="token operator">=</span> sun.io<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="OQL"><a href="#OQL" class="headerlink" title="OQL"></a>OQL</h1><ul><li><p><a href="https://wiki.eclipse.org/MemoryAnalyzer/OQL">å¦‚ä½•ä½¿ç”¨OQL</a></p></li><li><p>æŸ¥è¯¢æŸè§„æ ¼ç±»çš„å¯¹è±¡</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥è¯¢å¯¹è±¡æŸä¸ªå±æ€§(è¿™é‡Œåªèƒ½æ ¹æ®ç±», æŸ¥åˆ°è¯¥ç±»ä¸‹æ‰€æœ‰å¯¹è±¡çš„å±æ€§)</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>initd<span class="token punctuation">,</span> t<span class="token punctuation">.</span>initAsyn<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>publicCloud<span class="token punctuation">)</span><span class="token punctuation">,</span> namespace<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>regionId<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>useNuwa<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaConfigDns<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaCluster<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>rootPath<span class="token punctuation">)</span> <span class="token keyword">FROM</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥è¯¢å¯¹è±¡æŸä¸ªå±æ€§(å¦‚ä½•æ ¹æ®å¯¹è±¡ID, ç²¾ç¡®æŸ¥è¯¢åˆ°è¯¥å¯¹è±¡çš„æŸäº›å±æ€§?)</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>initd<span class="token punctuation">,</span> t<span class="token punctuation">.</span>initAsyn<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>publicCloud<span class="token punctuation">)</span><span class="token punctuation">,</span> namespace<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>regionId<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>useNuwa<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaConfigDns<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaCluster<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>rootPath<span class="token punctuation">)</span> <span class="token keyword">FROM</span> OBJECTS <span class="token number">0x7480633e0</span> t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ ¹æ®ç±»çš„hashåœ°å€, è·å–å¯¹åº”å®ä¾‹</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> instanceof <span class="token number">0x733ccc9f0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ ¹æ®å¯¹è±¡hashå€¼è·å–å¯¹è±¡ä¿¡æ¯</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span>  OBJECTS <span class="token number">0xdc2819e0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ ¹æ®æ¡ä»¶ç­›é€‰å‡ºå¯¹è±¡ä¿¡æ¯</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl t <span class="token keyword">where</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>hostType<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"ddh.ebmec3metest"</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl t <span class="token keyword">where</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"28745-27"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Java-amp-JVM&quot;&gt;&lt;a href=&quot;#Java-amp-JVM&quot; class=&quot;headerlink&quot; title=&quot;Java&amp;amp;JVM&quot;&gt;&lt;/a&gt;Java&amp;amp;JVM&lt;/h1&gt;&lt;h2 id=&quot;æ‰“-HeapDump&quot;&gt;&lt;a href=&quot;#æ‰“-HeapDump&quot; class=&quot;headerlink&quot; title=&quot;æ‰“ HeapDump&quot;&gt;&lt;/a&gt;æ‰“ HeapDump&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;jmap -dump:live,file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;heapdump.phrof &lt;span class=&quot;token variable&quot;&gt;$pid&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;jmap -dump:live,file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;heapdump.phrof -F &lt;span class=&quot;token variable&quot;&gt;$pid&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ&lt;mark&gt;å°½é‡ä¸è¦ä½¿ç”¨-Få‚æ•°ã€‚&lt;/mark&gt; å› ä¸º-Fä½¿ç”¨çš„æ˜¯Linuxæ“ä½œç³»ç»Ÿå±‚é¢çš„å®ç°ï¼Œè€Œä¸æ˜¯JVMå±‚é¢çš„å®ç°ï¼Œä¼šå¯¼è‡´ æ‰“å°å †ä¿¡æ¯å¾ˆæ…¢ã€‚&lt;br&gt;&lt;br&gt;å¦‚æœæç¤ºç¬¬ä¸€ç§æ–¹å¼æ‰“å°ä¸å‡ºæ¥å †çš„ä¿¡æ¯ï¼Œéœ€è¦å¢åŠ -Fï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæ£€æŸ¥ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Javaåº”ç”¨è¿›ç¨‹çš„user_nameæ˜¯å¦ä¸å½“å‰çš„user_nameç›¸åŒï¼Ÿ å¦‚æœä¸åŒï¼Œéœ€è¦åˆ‡æ¢ä¸ºåŒä¸€ä¸ªè´¦å·ã€‚&lt;/li&gt;
&lt;li&gt;Javaåº”ç”¨è¿›ç¨‹çš„Javaè·¯å¾„æ˜¯å¦ä¸å½“å‰jmapå‘½ä»¤çš„è·¯å¾„ç›¸åŒï¼Ÿ å¦‚æœä¸åŒï¼Œéœ€è¦åˆ‡æ¢ä¸ºåŒä¸€ä¸ªè·¯å¾„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æ‰“-ThreadDump&quot;&gt;&lt;a href=&quot;#æ‰“-ThreadDump&quot; class=&quot;headerlink&quot; title=&quot;æ‰“ ThreadDump&quot;&gt;&lt;/a&gt;æ‰“ ThreadDump&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;jstack &lt;span class=&quot;token variable&quot;&gt;$pid&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; tmp.jstack&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„: å½“CPUåˆ©ç”¨ç‡é«˜æˆ–è€…æƒ³çœ‹ä¸‹çº¿ç¨‹å¡åœ¨å“ªé‡Œæ—¶ï¼Œ&lt;mark&gt;æœ€å¥½éš”å‡ ç§’å°±æ‰“ä¸€ä¸ªçº¿ç¨‹æ ˆï¼Œæ¯ä¸ªçº¿ç¨‹æ ˆéƒ½ä¿ç•™ä¸‹æ¥&lt;/mark&gt; &lt;br&gt;&lt;br&gt;å¤šä¸ªçº¿ç¨‹æ ˆå¯¹æ¯”èµ·æ¥çœ‹ï¼Œä¼šæ›´èƒ½æ›´å¥½åœ°å‘ç°é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯&quot;&gt;&lt;/a&gt;æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯&lt;/h2&gt;</summary>
    
    
    
    
    <category term="code-snippets" scheme="https://davyjones2010.github.io/tags/code-snippets/"/>
    
    <category term="java" scheme="https://davyjones2010.github.io/tags/java/"/>
    
    <category term="jvm" scheme="https://davyjones2010.github.io/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>Linuxç½‘ç»œä¹‹åŸç†æ¢è®¨ä¸ç–‘é—®æ€»ç»“</title>
    <link href="https://davyjones2010.github.io/2022-06-29-linux-network-faq/"/>
    <id>https://davyjones2010.github.io/2022-06-29-linux-network-faq/</id>
    <published>2022-06-29T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><h2 id="ç½‘å¡æ··æ‚æ¨¡å¼"><a href="#ç½‘å¡æ··æ‚æ¨¡å¼" class="headerlink" title="ç½‘å¡æ··æ‚æ¨¡å¼"></a>ç½‘å¡æ··æ‚æ¨¡å¼</h2><ul><li><p>å•¥æ˜¯ç½‘å¡æ··æ‚æ¨¡å¼ï¼Ÿ</p></li><li><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ç½‘å¡æ”¶åˆ°äºŒå±‚å¸§ä¹‹åï¼Œä¼šæŸ¥çœ‹TargetMacæ˜¯å¦ä¸è‡ªèº«çš„Macåœ°å€ç›¸åŒï¼Œå¦‚æœä¸åŒï¼Œåˆ™ä¸¢å¼ƒè¯¥å¸§ã€‚</p></li><li><p>å¼€å¯äº†æ··æ‚æ¨¡å¼ä¹‹åï¼Œå³ä½¿MACåœ°å€ä¸åŒ¹é…ï¼Œä¹Ÿä¸ä¼šä¸¢å¼ƒã€‚è¿˜æ˜¯ä¼šè¿›å…¥TCP&#x2F;IPåè®®æ ˆå¤„ç†ã€‚</p></li><li><p>å•¥æ—¶å€™éœ€è¦å¼€å¯ï¼Ÿ</p></li><li><p>&#x2F;&#x2F; TODO:</p></li><li><p>å¦‚ä½•å¼€å¯ï¼Ÿ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// å¼€å¯æ··æ‚æ¨¡å¼<span class="token function">ifconfig</span> eth0 promisc// å–æ¶ˆæ··æ‚æ¨¡å¼<span class="token function">ifconfig</span> eth0 -promisc// å†…æ ¸åˆ¤æ–­ç½‘å¡æ˜¯å¦å¤„äºæ··æ‚æ¨¡å¼æ˜¯çœ‹å¦‚ä¸‹æ ‡è¯†ï¼Œå¦‚æœç½®ä½äº†0x100ï¼Œåˆ™å¤„äºæ··æ‚æ¨¡å¼<span class="token function">cat</span> /sys/class/net/eth0/flags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ˜¯å¦å¼€å¯äº†æ··æ‚æ¨¡å¼ï¼Œå°±èƒ½å—…æ¢å±€åŸŸç½‘ï¼ˆäºŒå±‚ç½‘ï¼‰å†…çš„æ‰€æœ‰æ•°æ®åŒ…äº†ï¼Ÿ</p></li><li><p>ä¸ä¸€å®šã€‚</p></li><li><p>é’ˆå¯¹äºŒå±‚å¦‚æœæ˜¯é›†çº¿å™¨æ¨¡å¼ï¼Œå¯ä»¥å—…æ¢åˆ°ã€‚</p></li><li><p>ä½†ç°åœ¨å¤§éƒ¨åˆ†äºŒå±‚éƒ½æ˜¯äº¤æ¢æœºæ¨¡å¼ã€‚å³äº¤æ¢æœºä¼šæ ¹æ®CAMè¡¨ï¼Œå¾€å¯¹åº”çš„ç«¯å£è½¬å‘ï¼Œä¸ä¼šæ— è„‘åœ°å…¨éƒ¨ç«¯å£éƒ½è½¬å‘ï¼Œå› æ­¤å—…æ¢ä¸åˆ°ã€‚</p></li><li><p>å¼€å¯æ··æ‚æ¨¡å¼çš„ä¾‹å­</p></li><li><p>å¦‚ä¸‹ï¼Œdocker0ç½‘æ¡¥å°±å¼€å¯äº†æ··æ‚æ¨¡å¼ã€‚</p></li><li><p>&#x2F;&#x2F; TODO: ä¸ºå•¥docker0ç½‘æ¡¥å¼€å¯æ··æ‚æ¨¡å¼ï¼Ÿå…·ä½“æ€ä¹ˆç”¨çš„ï¼Ÿ</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">cat</span> /sys/class/net/docker0/flags 0x1003<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«"><a href="#è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«" class="headerlink" title="è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«"></a>è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«</h2><h3 id="è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š"><a href="#è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š" class="headerlink" title="è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š"></a>è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š</h3><p>ä¸»è¦ç”¨æ¥è”é€šè¿ä¸ªä¸åŒçš„ç½‘æ®µï¼Œ<mark>åªä¿®æ”¹sourceMacä¸targetMacï¼Œä¸ä¿®æ”¹sourceIpä¸targetIp</mark></p><ol><li>æ ¹æ®ä¼ å…¥åŒ…æŒ‡å®šçš„targetIpï¼ˆä¼ å…¥åŒ…çš„MACåœ°å€æ˜¯è·¯ç”±å™¨å½“å‰ç½‘å¡çš„MACåœ°å€ï¼ŒIPåœ°å€æ˜¯çœŸæ­£çš„IPåœ°å€ï¼‰</li><li>æŸ¥è¯¢è‡ªèº«è·¯ç”±è¡¨ï¼ŒæŸ¥æ‰¾åˆ°æœ€è¿‘çš„ä¸‹ä¸€è·³çš„IPåœ°å€ã€‚<code>route -n</code></li><li>å†æ ¹æ®ä¸‹ä¸€è·³çš„IPåœ°å€ï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„MACåœ°å€ã€‚arpç¼“å­˜è¡¨</li><li>ä¿®æ”¹æ•°æ®åŒ…çš„targetMACåœ°å€ä¸ºä¸‹ä¸€è·³çš„MACåœ°å€ï¼ŒsourceMACä¸ºå½“å‰ç½‘å¡å‡ºå£çš„macåœ°å€</li><li>å°†æ•°æ®åŒ…ä»å¯¹åº”ç½‘å¡é€å‡ºå»ã€‚</li></ol><blockquote><p>è·¯ç”±å™¨çš„æ ¸å¿ƒæ˜¯è·¯ç”±è¡¨çš„ç»´æŠ¤ï¼Œèƒ½ç”Ÿæˆæœ€çŸ­æœ€ä¼˜è·¯å¾„ã€‚<br/><br>ä»sourceIpåˆ°targetIpçš„è·¯ç”±è·¯å¾„ï¼Œå¾ˆå¯èƒ½ä¸å›åŒ…ï¼Œå³ä»targetIpè¿”å›åˆ°sourceIpçš„è·¯ç”±è·¯å¾„ä¸ä¸€æ ·ã€‚<br>å–å†³äºå½“æ—¶çš„è·¯å¾„ä¸­è·¯ç”±å™¨çš„è·¯ç”±è¡¨æƒ…å†µã€‚</p></blockquote><h3 id="NATå·¥ä½œåŸç†ï¼š"><a href="#NATå·¥ä½œåŸç†ï¼š" class="headerlink" title="NATå·¥ä½œåŸç†ï¼š"></a>NATå·¥ä½œåŸç†ï¼š</h3><ul><li><p>åŸç†<br>éœ€è¦ä¿®æ”¹sourceMacä¸targetMacã€‚<br>åŒæ—¶å¦‚æœæ˜¯SNATï¼Œåˆ™è¿˜è¦ä¿®æ”¹sourceIpã€‚<br>å¦‚æœæ˜¯DNATï¼Œåˆ™è¿˜è¦ä¿®æ”¹targetIpã€‚</p></li><li><p>å®ç°æ–¹å¼:<br>é€šè¿‡iptableså¯ä»¥è®¾ç½®natè¡¨ã€‚<br>snatä½œç”¨åœ¨postroutingé˜¶æ®µï¼Œdnatä½œç”¨åœ¨preroutingé˜¶æ®µã€‚<br>å›åŒ…ç”±å†…æ ¸çš„conntrackæ¨¡å—è´Ÿè´£ï¼Œä¸å†ç”±iptablesè´Ÿè´£ã€‚<br>è¯¦ç»†å‚è§ <a href="https://davyjones2010.github.io/2022-06-23-linux-network-nat">NATä¹‹ç«¯å£æ˜ å°„(PAT)åŸç†æ€»ç»“&amp;å®è·µ</a></p></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç”±æ­¤å¯çŸ¥ï¼Œå®¶ç”¨çš„è·¯ç”±å™¨ï¼Œæ˜¯é™„å¸¦äº†SNATï¼ˆä¹Ÿå¯ä»¥é…ç½®DNATï¼‰åŠŸèƒ½çš„è·¯ç”±å™¨ã€‚</p><h2 id="ip-forwarding"><a href="#ip-forwarding" class="headerlink" title="ip_forwarding"></a>ip_forwarding</h2><h3 id="MACåœ°å€åŒ¹é…-ä½†IPåœ°å€ä¸åŒ¹é…"><a href="#MACåœ°å€åŒ¹é…-ä½†IPåœ°å€ä¸åŒ¹é…" class="headerlink" title="MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸åŒ¹é…"></a>MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸åŒ¹é…</h3><p>ç½‘å¡ä¼šä¸ä¼šæ”¶åˆ°MACåœ°å€ä¸å½“å‰ç½‘å¡MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸å½“å‰ç½‘å¡çš„IPä¸åŒ¹é…çš„IPåŒ…?<br>å…·ä½“å’‹å¤„ç†? ç›´æ¥ä¸¢å¼ƒ? è¿˜æ˜¯å¯ä»¥ä½¿ç”¨?</p><ul><li>ä¼šæ”¶åˆ°ã€‚</li><li>å¦‚æœå¼€å¯äº†ip_forwardingï¼Œåˆ™ä¼šè¿›å…¥FORWARD&#x2F;ROUTEé˜¶æ®µï¼ŒæŸ¥çœ‹æœ¬åœ° route è¡¨ï¼Œè¿›å…¥è·¯ç”±ä¸postroutingé˜¶æ®µï¼Œæ‰¾åˆ°å¯¹åº”çš„å‡ºå£ç½‘å¡ï¼Œå°†åŒ…è½¬å‘å‡ºå»ã€‚ä¸è·¯ç”±å™¨çš„åŠŸèƒ½å®Œå…¨ä¸€è‡´äº†ã€‚</li><li>å¦‚æœæœªå¼€å¯ip_forwardingï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥åŒ…ã€‚</li><li>æ‰€ä»¥ï¼ŒNATæ¨¡å¼ä¸‹ï¼Œå¿…é¡»è¦å¼€å¯ip_forwardingã€‚</li></ul><h3 id="iptableså·¥ä½œåŸç†å›¾"><a href="#iptableså·¥ä½œåŸç†å›¾" class="headerlink" title="iptableså·¥ä½œåŸç†å›¾"></a>iptableså·¥ä½œåŸç†å›¾</h3><p>æ­¤å›¾æ‘˜è‡ª <a href="https://wiki.archlinux.org/title/Iptables">Archlinux æ–‡æ¡£</a></p><pre class="line-numbers language-none"><code class="language-none">                               XXXXXXXXXXXXXXXXXX                             XXX     Network    XXX                               XXXXXXXXXXXXXXXXXX                                       +                                       |                                       v +-------------+              +------------------+ |table: filter| &lt;---+        | table: nat&#x2F;dnat  | |chain: INPUT |     |        | chain: PREROUTING| +-----+-------+     |        +--------+---------+       |             |                 |       v             |                 v [local process]     |           ****************          +--------------+       |             +---------+ Routing decision +------&gt; |table: filter |       v                         ****************          |chain: FORWARD|****************                                           +------+-------+Routing decision                                                  |****************                                                  |       |                                                          |       v                        ****************                  |+-------------+       +------&gt;  Routing decision  &lt;---------------+|table: nat   |       |         ****************|chain: OUTPUT|       |               ++-----+-------+       |               |      |               |               v      v               |      +-------------------++--------------+      |      | table: nat&#x2F;snat   ||table: filter | +----+      | chain: POSTROUTING||chain: OUTPUT |             +--------+----------++--------------+                      |                                      v                               XXXXXXXXXXXXXXXXXX                             XXX    Network     XXX                               XXXXXXXXXXXXXXXXXX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip-forwarding"><a href="#ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip-forwarding" class="headerlink" title="ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip_forwarding?"></a>ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip_forwarding?</h3><p>å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œhoståªæ˜¯æ‰®æ¼”åœ¨ç½‘ç»œä¸­çš„ä¸€å°ä¸»æœºçš„è§’è‰²ï¼Œæ ¹æœ¬ä¸éœ€è¦ip_forwardingçš„åŠŸèƒ½ã€‚</p><blockquote><p>A Linux machine acting as an ordinary host would not need to have IP forwarding enabled,<br>because it just generates and receives IP traffic for its own purposes</p></blockquote><h3 id="å¦‚ä½•å¼€å¯ip-forwarding"><a href="#å¦‚ä½•å¼€å¯ip-forwarding" class="headerlink" title="å¦‚ä½•å¼€å¯ip_forwarding?"></a>å¦‚ä½•å¼€å¯ip_forwarding?</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">></span> /proc/sys/net/ipv4/ip_forward<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‰€ä»¥å¼€å¯äº†ip_forwardingï¼Œç›¸å½“äºæœ¬æœºå°±å…·å¤‡ä¸€å°è·¯ç”±å™¨çš„èƒ½åŠ›äº†ã€‚<br/><br>å¦‚æœå†é€šè¿‡iptablesé…ç½®äº†ç›¸åº”çš„natè§„åˆ™ï¼Œå°±ç›¸å½“äºä¸€å°å®¶ç”¨çš„è·¯ç”±å™¨äº†ã€‚</p><h2 id="æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜"><a href="#æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜" class="headerlink" title="æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜"></a>æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜</h2><ul><li>å¦‚æœæœ¬æœºæœ‰ç§ç½‘ç½‘å¡virbr0, å…¬ç½‘ç½‘å¡en0, ä¸”å¼€å¯äº†virbr0ç½‘æ®µçš„SNATè§„åˆ™. åˆ™åœ¨æœ¬åœ°curlå…¬ç½‘åœ°å€, åˆ™curlçš„å‡ºå£ç½‘å¡æ˜¯å•¥? </li><li>æ˜¯é€šè¿‡virbr0, ç„¶åèµ°SNATåˆ°en0å‡ºå»ä¹ˆ?</li><li>è¿˜æ˜¯ç›´æ¥é€šè¿‡en0å‡ºå»?</li></ul><ol><li><p>curl æ”¯æŒæŒ‡å®šå‡ºå£ç½‘å¡å¦‚ä¸‹(å®é™…åªæ˜¯ä½¿ç”¨äº†å¯¹åº”ç½‘å¡çš„ipåœ°å€ä½œä¸ºSIP): å¦‚æœä¸æŒ‡å®š, åˆ™ä½¿ç”¨é»˜è®¤ç½‘å¡. </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// curlæŒ‡å®šç½‘å¡å‡ºå£<span class="token function">curl</span> --interface virbr0 http://www.baidu.com// macä¸ŠæŸ¥çœ‹é»˜è®¤ç½‘å¡: route -n get <span class="token number">0.0</span>.0.0 <span class="token operator">|</span> <span class="token function">grep</span> interface<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>The â€“interface options is used to figure determine what address on the system will be used as the source IP. <br/><br>It doesnâ€™t magically change anything about routing.</p></blockquote></li><li><p>å‚è§<a href="#iptables%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%9B%BE">iptableså·¥ä½œåŸç†å›¾</a>, å¯çŸ¥ä»curlå…¬ç½‘åœ°å€, å°±æ˜¯ä»local processå‡ºå», æ¥ä¸‹æ¥ä¼šèµ°route, å³æŸ¥çœ‹Hostçš„è·¯ç”±è¡¨, ç¡®å®šå‡ºå£ç½‘å¡ä¸ç½‘å…³ä¿¡æ¯.</p></li><li><p>æ¥ä¸‹æ¥è¿›å…¥postrouting(SNAT)é˜¶æ®µ, å¦‚æœé…ç½®æœ‰SNATè§„åˆ™, ä¸”åˆšå¥½å‘½ä¸­, åˆ™æ‰§è¡ŒSNAT.</p></li><li><p>æ‰€ä»¥ç»“è®ºæ˜¯å‡ºå£ç½‘å¡æ˜¯en0, è€Œä¸ä¼šç»è¿‡virbr0(å³ä½¿æŒ‡å®šäº†<code>--interface virbr0</code>).</p></li><li><p>æ˜¯å¦ä¼šSNAT, å–å†³äºæ˜¯å¦æŒ‡å®šäº†<code>--interface virbr0</code>, æŒ‡å®šäº†, åˆ™ä¼šèµ°SNAT; æœªæŒ‡å®š, åˆ™ä¸éœ€è¦èµ°SNAT.</p></li></ol><h2 id="æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜"><a href="#æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜" class="headerlink" title="æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜"></a>æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜</h2><ul><li>å¦‚æœæœ¬æœºæœ‰å¤šå—ç½‘å¡, åœ¨Javaä¸­å¦‚ä½•è·å–åˆ°è¿™äº›IPåœ°å€? </li><li>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨è·å–æœ¬æœºIPçš„æ–¹å¼å¦‚ä¸‹: <mark>å½“Hostå¤šå—ç½‘å¡æ—¶, ä¸å¥½å…¼å®¹, å­˜åœ¨ä¸¥é‡ç¼ºé™·, å°¤å…¶æ˜¯åœ¨çº¿ä¸ŠæœåŠ¡å™¨ç½‘å¡å †å åœºæ™¯ä¸‹!</mark></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">InetAddress</span> ip <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> hostname <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>è§£å†³æ–¹æ¡ˆ: </li><li>æ–¹æ¡ˆ1: ä½¿ç”¨ <code>NetworkInterface.getNetworkInterfaces()</code> æ¥å£, è·å–æ‰€æœ‰ç½‘å¡, ç„¶åé€ä¸ªè·å–IPä¿¡æ¯.</li><li>æ–¹æ¡ˆ2: è·å–æœ¬æœºçš„FQDN, ç„¶åä½¿ç”¨<code>InetAddress.getByName(FQDN)</code>æ¥è·å–ä¸»ç½‘å¡çš„IPä¿¡æ¯.<ul><li>æœ¬æœºçš„FQDNå¯ä»¥å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ.</li></ul></li><li>Ref: <a href="https://crunchify.com/how-to-get-server-ip-address-and-hostname-in-java/">How to get Server IP Address and Hostname in Java</a></li></ul><h2 id="IPéš§é“"><a href="#IPéš§é“" class="headerlink" title="IPéš§é“"></a>IPéš§é“</h2><h2 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h2><h3 id="LVS-v-s-iptables-x2F-netfilters"><a href="#LVS-v-s-iptables-x2F-netfilters" class="headerlink" title="LVS v.s. iptables&#x2F;netfilters"></a>LVS v.s. iptables&#x2F;netfilters</h3><p>æœ¬è´¨ä¸Š, ä¸¤ä¸ªéƒ½å¯ä»¥åšå››å±‚çš„DNAT, éƒ½æ˜¯å·¥ä½œåœ¨å†…æ ¸ç©ºé—´. </p><ul><li>LVS: æ›´ä¾§é‡äºLoadBalancing, å®ç°ä¸Šä½¿ç”¨hashæŸ¥è¡¨, è€Œä¸æ˜¯iptablesçš„é¡ºåºæŸ¥è¯¢. æ•ˆç‡æ›´é«˜. </li><li>iptables:</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042336674.png"></p><ul><li>å¯ä»¥çœ‹åˆ°, LVSæœ¬è´¨ä¸Šæ˜¯ä¸iptablesé…åˆä½¿ç”¨</li><li>å®¢æˆ·è®¿é—®è™šæ‹Ÿ IPï¼ˆVIPï¼‰æ—¶ï¼Œæ•°æ®åŒ…å…ˆåœ¨ä¸»æœºå†…æ ¸ç©ºé—´è¢« PREROUTING é“¾æ£€æµ‹ï¼Œæ ¹æ®æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€è¿›è¡Œè·¯ç”±åˆ¤æ–­ï¼Œè‹¥ç›®æ ‡åœ°å€æ˜¯æœ¬åœ°ï¼Œåˆ™äº¤ç”± INPUT é“¾è¿›è¡Œå¤„ç†ã€‚</li><li>IPVS å·¥ä½œäº INPUT é“¾ï¼Œå½“æ•°æ®åŒ…åˆ°è¾¾ INPUT é“¾æ—¶ï¼Œä¼šå…ˆç”± IPVS è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•é€‰å‡ºçœŸå®æœåŠ¡å™¨ IPã€‚</li><li>IPVS è½¬å‘æ¨¡å¼ä¸º NAT æ¨¡å¼æ—¶ï¼Œå°†æ•°æ®åŒ…ç”± FORWARD é“¾è¿›è¡Œå¤„ç†åç”± POST-ROUTING é“¾å‘é€ç»™çœŸå®æœåŠ¡å™¨ã€‚</li><li>IPVS è½¬å‘æ¨¡å¼ä¸ºé NAT æ¨¡å¼æ—¶ï¼Œåˆ™å°†æ•°æ®åŒ…ç”± POST-ROUTING é“¾å‘é€ç»™çœŸå®æœåŠ¡å™¨ã€‚</li></ul><h3 id="LVSçš„å‡ ç§æ¨¡å¼åˆ†æ"><a href="#LVSçš„å‡ ç§æ¨¡å¼åˆ†æ" class="headerlink" title="LVSçš„å‡ ç§æ¨¡å¼åˆ†æ"></a>LVSçš„å‡ ç§æ¨¡å¼åˆ†æ</h3><p><a href="https://blog.csdn.net/Splend520/article/details/104587149">linux LVSè´Ÿè½½å‡è¡¡åŸç† NAT DR TUN FULLNAT æ¨¡å¼</a></p><h4 id="LVS-NAT-â€“-gt-NAT-x2F-DNAT"><a href="#LVS-NAT-â€“-gt-NAT-x2F-DNAT" class="headerlink" title="LVS-NAT â€“&gt; NAT&#x2F;DNAT"></a>LVS-NAT â€“&gt; NAT&#x2F;DNAT</h4><p>æœ¬è´¨æ˜¯ç±»ä¼¼iptablesçš„ç«¯å£æ˜ å°„(PAT)â€“&gt; æ³¨æ„è¿™é‡Œå…¨ç¨‹æ²¡æœ‰DIPçš„å‚ä¸.</p><ul><li>LVSæœ¬èº«æœ‰ä¸¤ä¸ªIP, å¯¹å¤–æ˜¯VIP, å¯¹å†…æ˜¯DIP(Director IP)</li><li>Clientè¯·æ±‚: {CIP, VIP}</li><li>LVSæ˜ å°„: ä¿®æ”¹ç›®æ ‡IP, VIP-&gt;RIP, æ„å»ºæ–°çš„è¯·æ±‚: {CIP, RIP}</li><li>Serverå¤„ç†: å®Œæˆåå‘é€å›åŒ…, {RIP, CIP}; ç”±äºCIPä¸RIPä¸åœ¨åŒä¸€ä¸ªç½‘æ®µ, å› æ­¤å‘é€åˆ°ç½‘å…³(å³LVS)</li><li>LVSæ˜ å°„: ä¿®æ”¹æºIP, RIP-&gt;VIP, æ„å»ºæ–°çš„å“åº”: {VIP, CIP}</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207052223099.png"></p><ul><li>ç¼ºç‚¹: <ul><li>éœ€è¦RSä¸DSåœ¨åŒä¸€ä¸ªäºŒå±‚ç½‘ç»œé‡Œ, ä¸”éœ€è¦æŠŠDS&#x2F;DIPé…ç½®ä¸ºRSçš„ç½‘å…³.</li></ul></li><li>ä¼˜ç‚¹: <ul><li>&#x2F;&#x2F; TODO:</li></ul></li></ul><h4 id="LVS-NAT-â€“-gt-FullNAT"><a href="#LVS-NAT-â€“-gt-FullNAT" class="headerlink" title="LVS-NAT â€“&gt; FullNAT"></a>LVS-NAT â€“&gt; FullNAT</h4><ul><li>LVSæœ¬èº«æœ‰ä¸¤ä¸ªIP, å¯¹å¤–æ˜¯VIP, å¯¹å†…æ˜¯DIP(Director IP)</li><li>Clientè¯·æ±‚: {CIP, VIP}</li><li>LVSæ˜ å°„: ä¿®æ”¹ç›®æ ‡IP, VIP-&gt;RIP(RealServerIP); ä¿®æ”¹æºIP, CIP-&gt;DIP; æ„å»ºæ–°çš„è¯·æ±‚: {DIP, RIP}</li><li>RealServerå¤„ç†: å®Œæˆåå‘é€å›åŒ…, {RIP, DIP} (FullNATæ¨¡å¼, ä¸éœ€è¦LVSå¿…é¡»æ˜¯ç½‘å…³, åªè¦ä¸‰å±‚IPå¯è¾¾å³å¯)</li><li>LVSæ˜ å°„: ä¿®æ”¹æºIP, RIP-&gt;VIP; é€šè¿‡conntrackæŸ¥è¡¨, ä¿®æ”¹ç›®æ ‡IP, DIP-&gt;CIP; æ„å»ºæ–°çš„å“åº”: {VIP, CIP}</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207052218872.png"></p><ul><li><p>æ³¨æ„: LVS æœ¬èº«ä¸æ”¯æŒ FULLNAT æ¨¡å¼ï¼Œéœ€è¦é¢å¤–å¯¹å†…æ ¸æ‰“è¡¥ä¸åæ‰èƒ½ä½¿ç”¨ã€‚</p></li><li><p>ç¼ºç‚¹: </p><ul><li>ä¸ç®¡æ˜¯è¯·æ±‚æ•°æ®åŒ…è¿˜æ˜¯å“åº”æ•°æ®åŒ…ï¼Œéƒ½è¦ç»è¿‡è´Ÿè½½å‡è¡¡å™¨ã€‚ä½†æ˜¯å“åº”æ•°æ®åŒ…ä¸€èˆ¬è¦æ¯”è¯·æ±‚æ•°æ®åŒ…å¤§å¾ˆå¤šï¼Œè¿™å¯èƒ½ä¼šæˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆã€‚</li></ul></li><li><p>ä¼˜ç‚¹:</p><ul><li>å¦‚ä¸Šå›¾, RealServer(DIP)ä¸éœ€è¦è·ŸLVSåœ¨åŒä¸€ä¸ªç½‘æ®µ, åªè¦IPåŒ…(ä¸‰å±‚è·¯ç”±)å¯è¾¾, å°±èƒ½å®ŒæˆFullNAT</li></ul></li></ul><h4 id="LVS-DR"><a href="#LVS-DR" class="headerlink" title="LVS-DR"></a>LVS-DR</h4><h4 id="LVS-TUN"><a href="#LVS-TUN" class="headerlink" title="LVS-TUN"></a>LVS-TUN</h4><h4 id="å®é™…"><a href="#å®é™…" class="headerlink" title="å®é™…"></a>å®é™…</h4><ul><li><a href="https://help.aliyun.com/document_detail/27544.html">é˜¿é‡Œäº‘CLB</a>ä½¿ç”¨çš„æ˜¯å“ªç§æ¨¡å¼? NAT?<ul><li>å››å±‚é‡‡ç”¨å¼€æºè½¯ä»¶LVSï¼ˆLinux Virtual Serverï¼‰+ keepalivedçš„æ–¹å¼å®ç°è´Ÿè½½å‡è¡¡</li><li>LVSåº”è¯¥ä½¿ç”¨çš„æ˜¯NATæ¨¡å¼. ä½†å¦‚æœæ˜¯NATæ¨¡å¼, åˆ™å¿…é¡»æŠŠLVSä½œä¸ºECSçš„ç½‘å…³. &#x2F;&#x2F;TODO: å¾…éªŒè¯</li></ul></li></ul><h1 id="HTTP-ä»£ç†"><a href="#HTTP-ä»£ç†" class="headerlink" title="HTTP ä»£ç†"></a>HTTP ä»£ç†</h1><h1 id="ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€"><a href="#ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€" class="headerlink" title="ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€?"></a>ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€?</h1><ul><li>å‚è§: <a href="https://docs.microsoft.com/zh-cn/azure/virtual-network/ip-services/routing-preference-overview">å†·åœŸè±†è·¯ç”±&amp;çƒ­åœŸè±†è·¯ç”±</a></li><li>çƒ­åœŸè±†:<ul><li>å…¥å£æµé‡: å¦‚æœæ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·è®¿é—®æ‰˜ç®¡åœ¨èŠåŠ å“¥çš„ Azure èµ„æºï¼Œåˆ™æµé‡å°†é€šè¿‡å…¬å…± Internet ä¼ è¾“ï¼Œå¹¶è¿›å…¥èŠåŠ å“¥çš„ Microsoft å…¨çƒç½‘ç»œã€‚</li><li>å‡ºå£æµé‡: å‡ºå£æµé‡éµå¾ªç›¸åŒçš„åŸåˆ™ã€‚ æµé‡ä¼šåœ¨æ‰˜ç®¡æœåŠ¡çš„åŒä¸€åŒºåŸŸé€€å‡º Microsoft ç½‘ç»œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ¥è‡ª Azure èŠåŠ å“¥æœåŠ¡çš„æµé‡æœ€ç»ˆä¼ è¾“ç»™æ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·ï¼Œæµé‡å°†ç¦»å¼€èŠåŠ å“¥çš„ Microsoft ç½‘ç»œï¼Œå¹¶é€šè¿‡å…¬å…± Internet ä¼ è¾“ç»™æ–°åŠ å¡çš„ç”¨æˆ·ã€‚</li></ul></li><li>å†·åœŸè±†:<ul><li>å…¥å£æµé‡: å¦‚æœæ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·è®¿é—®æ‰˜ç®¡åœ¨ç¾å›½èŠåŠ å“¥çš„ Azure èµ„æºï¼Œåˆ™æµé‡å°†è¿›å…¥ä½äºæ–°åŠ å¡ Edge POP çš„ Microsoft å…¨çƒç½‘ç»œï¼Œå¹¶é€šè¿‡ Microsoft ç½‘ç»œä¼ è¾“åˆ°æ‰˜ç®¡åœ¨èŠåŠ å“¥çš„æœåŠ¡ã€‚</li><li>å‡ºå£æµé‡: å¦‚æœæ¥è‡ª Azure èŠåŠ å“¥çš„æµé‡æœ€ç»ˆä¼ è¾“ç»™æ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæµé‡å°±ä¼šé€šè¿‡ Microsoft ç½‘ç»œä»èŠåŠ å“¥ä¼ è¾“åˆ°æ–°åŠ å¡ï¼Œå¹¶é€€å‡ºä½äºæ–°åŠ å¡ Edge POP çš„ Microsoft ç½‘ç»œã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;h1 id=&quot;FAQ&quot;&gt;&lt;a href=&quot;#FAQ&quot; class=&quot;headerlink&quot; title=&quot;FAQ&quot;&gt;&lt;/a&gt;FAQ&lt;/h1&gt;&lt;h2 id=&quot;ç½‘å¡æ··æ‚æ¨¡å¼&quot;&gt;&lt;a href=&quot;#ç½‘å¡æ··æ‚æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;ç½‘å¡æ··æ‚æ¨¡å¼&quot;&gt;&lt;/a&gt;ç½‘å¡æ··æ‚æ¨¡å¼&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å•¥æ˜¯ç½‘å¡æ··æ‚æ¨¡å¼ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ç½‘å¡æ”¶åˆ°äºŒå±‚å¸§ä¹‹åï¼Œä¼šæŸ¥çœ‹TargetMacæ˜¯å¦ä¸è‡ªèº«çš„Macåœ°å€ç›¸åŒï¼Œå¦‚æœä¸åŒï¼Œåˆ™ä¸¢å¼ƒè¯¥å¸§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¼€å¯äº†æ··æ‚æ¨¡å¼ä¹‹åï¼Œå³ä½¿MACåœ°å€ä¸åŒ¹é…ï¼Œä¹Ÿä¸ä¼šä¸¢å¼ƒã€‚è¿˜æ˜¯ä¼šè¿›å…¥TCP&amp;#x2F;IPåè®®æ ˆå¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å•¥æ—¶å€™éœ€è¦å¼€å¯ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x2F;&amp;#x2F; TODO:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¦‚ä½•å¼€å¯ï¼Ÿ&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;// å¼€å¯æ··æ‚æ¨¡å¼
&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; eth0 promisc
// å–æ¶ˆæ··æ‚æ¨¡å¼
&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; eth0 -promisc
// å†…æ ¸åˆ¤æ–­ç½‘å¡æ˜¯å¦å¤„äºæ··æ‚æ¨¡å¼æ˜¯çœ‹å¦‚ä¸‹æ ‡è¯†ï¼Œå¦‚æœç½®ä½äº†0x100ï¼Œåˆ™å¤„äºæ··æ‚æ¨¡å¼
&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /sys/class/net/eth0/flags&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ˜¯å¦å¼€å¯äº†æ··æ‚æ¨¡å¼ï¼Œå°±èƒ½å—…æ¢å±€åŸŸç½‘ï¼ˆäºŒå±‚ç½‘ï¼‰å†…çš„æ‰€æœ‰æ•°æ®åŒ…äº†ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¸ä¸€å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é’ˆå¯¹äºŒå±‚å¦‚æœæ˜¯é›†çº¿å™¨æ¨¡å¼ï¼Œå¯ä»¥å—…æ¢åˆ°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä½†ç°åœ¨å¤§éƒ¨åˆ†äºŒå±‚éƒ½æ˜¯äº¤æ¢æœºæ¨¡å¼ã€‚å³äº¤æ¢æœºä¼šæ ¹æ®CAMè¡¨ï¼Œå¾€å¯¹åº”çš„ç«¯å£è½¬å‘ï¼Œä¸ä¼šæ— è„‘åœ°å…¨éƒ¨ç«¯å£éƒ½è½¬å‘ï¼Œå› æ­¤å—…æ¢ä¸åˆ°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¼€å¯æ··æ‚æ¨¡å¼çš„ä¾‹å­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¦‚ä¸‹ï¼Œdocker0ç½‘æ¡¥å°±å¼€å¯äº†æ··æ‚æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&amp;#x2F;&amp;#x2F; TODO: ä¸ºå•¥docker0ç½‘æ¡¥å¼€å¯æ··æ‚æ¨¡å¼ï¼Ÿå…·ä½“æ€ä¹ˆç”¨çš„ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /sys/class/net/docker0/flags 
0x1003&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«&quot;&gt;&lt;a href=&quot;#è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«&quot;&gt;&lt;/a&gt;è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«&lt;/h2&gt;&lt;h3 id=&quot;è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š&quot;&gt;&lt;a href=&quot;#è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š&quot;&gt;&lt;/a&gt;è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š&lt;/h3&gt;&lt;p&gt;ä¸»è¦ç”¨æ¥è”é€šè¿ä¸ªä¸åŒçš„ç½‘æ®µï¼Œ&lt;mark&gt;åªä¿®æ”¹sourceMacä¸targetMacï¼Œä¸ä¿®æ”¹sourceIpä¸targetIp&lt;/mark&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¹æ®ä¼ å…¥åŒ…æŒ‡å®šçš„targetIpï¼ˆä¼ å…¥åŒ…çš„MACåœ°å€æ˜¯è·¯ç”±å™¨å½“å‰ç½‘å¡çš„MACåœ°å€ï¼ŒIPåœ°å€æ˜¯çœŸæ­£çš„IPåœ°å€ï¼‰&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢è‡ªèº«è·¯ç”±è¡¨ï¼ŒæŸ¥æ‰¾åˆ°æœ€è¿‘çš„ä¸‹ä¸€è·³çš„IPåœ°å€ã€‚&lt;code&gt;route -n&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å†æ ¹æ®ä¸‹ä¸€è·³çš„IPåœ°å€ï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„MACåœ°å€ã€‚arpç¼“å­˜è¡¨&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹æ•°æ®åŒ…çš„targetMACåœ°å€ä¸ºä¸‹ä¸€è·³çš„MACåœ°å€ï¼ŒsourceMACä¸ºå½“å‰ç½‘å¡å‡ºå£çš„macåœ°å€&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®åŒ…ä»å¯¹åº”ç½‘å¡é€å‡ºå»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è·¯ç”±å™¨çš„æ ¸å¿ƒæ˜¯è·¯ç”±è¡¨çš„ç»´æŠ¤ï¼Œèƒ½ç”Ÿæˆæœ€çŸ­æœ€ä¼˜è·¯å¾„ã€‚&lt;br&gt;&lt;br&gt;ä»sourceIpåˆ°targetIpçš„è·¯ç”±è·¯å¾„ï¼Œå¾ˆå¯èƒ½ä¸å›åŒ…ï¼Œå³ä»targetIpè¿”å›åˆ°sourceIpçš„è·¯ç”±è·¯å¾„ä¸ä¸€æ ·ã€‚&lt;br&gt;å–å†³äºå½“æ—¶çš„è·¯å¾„ä¸­è·¯ç”±å™¨çš„è·¯ç”±è¡¨æƒ…å†µã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="iaas" scheme="https://davyjones2010.github.io/tags/iaas/"/>
    
    <category term="network" scheme="https://davyjones2010.github.io/tags/network/"/>
    
    <category term="cloud-computing" scheme="https://davyjones2010.github.io/tags/cloud-computing/"/>
    
    <category term="nat" scheme="https://davyjones2010.github.io/tags/nat/"/>
    
    <category term="pat" scheme="https://davyjones2010.github.io/tags/pat/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸ç”¨çš„Linuxå‘½ä»¤ä¹‹ç½‘ç»œç›¸å…³å‘½ä»¤</title>
    <link href="https://davyjones2010.github.io/2022-06-25-linux-network-scripts/"/>
    <id>https://davyjones2010.github.io/2022-06-25-linux-network-scripts/</id>
    <published>2022-06-25T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ARPåè®®"><a href="#ARPåè®®" class="headerlink" title="ARPåè®®"></a>ARPåè®®</h1><h2 id="æŸ¥çœ‹ARPç¼“å­˜è¡¨"><a href="#æŸ¥çœ‹ARPç¼“å­˜è¡¨" class="headerlink" title="æŸ¥çœ‹ARPç¼“å­˜è¡¨"></a>æŸ¥çœ‹ARPç¼“å­˜è¡¨</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/nat$ arp -vAddress                  HWtype  HWaddress           Flags Mask            Iface_gateway                 ether   c0:b4:7d:69:d6:c3   C                     wlp4s0<span class="token number">172.17</span>.0.3               ether   02:42:ac:11:00:03   C                     docker0<span class="token number">192.168</span>.3.2              ether   00:11:32:b2:b7:04   C                     wlp4s0<span class="token number">172.17</span>.0.2               ether   02:42:ac:11:00:02   C                     docker0Entries: <span class="token number">4</span>Skipped: <span class="token number">0</span>Found: <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜"><a href="#æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜" class="headerlink" title="æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜"></a>æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/nat$ arp -i wlp4s0Address                  HWtype  HWaddress           Flags Mask            Iface_gateway                 ether   c0:b4:7d:69:d6:c3   C                     wlp4s0<span class="token number">192.168</span>.3.2              ether   00:11:32:b2:b7:04   C                     wlp4s0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚æ•°è¯¦è§£"><a href="#å‚æ•°è¯¦è§£" class="headerlink" title="å‚æ•°è¯¦è§£"></a>å‚æ•°è¯¦è§£</h2><ul><li>flags:<ul><li>C: complete, each complete entry in the ARP cache will be marked with the C flag.</li><li>M: æ‰‹åŠ¨å¢åŠ çš„ï¼ŒPermanent entries are marked  with  M</li><li>P: TODO: ä¸å¤ªæ˜ç™½å…·ä½“å•¥æ„æ€ï¼Œpublished entries have the P flag.</li></ul></li></ul><h1 id="ç½‘æ¡¥"><a href="#ç½‘æ¡¥" class="headerlink" title="ç½‘æ¡¥"></a>ç½‘æ¡¥</h1><h2 id="æŸ¥çœ‹ç½‘æ¡¥"><a href="#æŸ¥çœ‹ç½‘æ¡¥" class="headerlink" title="æŸ¥çœ‹ç½‘æ¡¥"></a>æŸ¥çœ‹ç½‘æ¡¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ brctl showbridge namebridge <span class="token function">id</span>STP enabledinterfacesdocker0<span class="token number">8000</span>.0242cee53dddnoveth9aec769            vethe466b6bvirbr0<span class="token number">8000</span>.525400245c90<span class="token function">yes</span>virbr0-nic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸ¥çœ‹veth-pair"><a href="#æŸ¥çœ‹veth-pair" class="headerlink" title="æŸ¥çœ‹veth pair"></a>æŸ¥çœ‹veth pair</h2><p>å¦‚ä¸Šï¼Œå‘ç°<code>veth9aec769</code>ä¸<code>vethe466b6b</code>éƒ½æŒ‚åœ¨<code>docker0</code>ç½‘æ¡¥ä¸‹ã€‚<br>è¿™ä¸¤ä¸ªvethè®¾å¤‡éƒ½æ˜¯åœ¨hostä¸Šçš„ï¼Œé‚£ä¹ˆä¸¤ä¸ªvethè®¾å¤‡å¯¹åº”çš„pairï¼ˆåˆ†åˆ«åœ¨2ä¸ªdockerå®¹å™¨ä¸­ï¼‰åˆ†åˆ«æ˜¯å•¥ï¼Ÿ</p><ol><li>æŸ¥çœ‹hostä¸Švethè®¾å¤‡å¯¹åº”çš„dockerå®¹å™¨å†…vethè®¾å¤‡çš„ç¼–å·ï¼ˆå¦‚ä¸‹åˆ†åˆ«æ˜¯if23,if24ï¼‰</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">ip</span> a <span class="token operator">|</span> <span class="token function">fgrep</span> veth9aec769<span class="token number">24</span>: veth9aec769@if23: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">ip</span> a <span class="token operator">|</span> <span class="token function">fgrep</span> vethe466b6b<span class="token number">22</span>: vethe466b6b@if21: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>ç™»å½•dockerå®¹å™¨ä¸­æŸ¥çœ‹vethè®¾å¤‡ç¼–å·</li></ol><p>å¦‚ä¸‹å¯çŸ¥ï¼š</p><ul><li>d3f6cb3a496e å®¹å™¨çš„vethç¼–å·æ˜¯21ï¼Œä¸hostä¸Šif22ï¼Œå³vethe466b6bç»‘å®š</li><li>333a28ae8ea1 å®¹å™¨çš„vethç¼–å·æ˜¯23ï¼Œä¸hostä¸Šif24ï¼Œå³veth9aec769ç»‘å®š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/docker$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it d3f6cb3a496e /bin/sh -c <span class="token string">"ip a"</span><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo       valid_lft forever preferred_lft forever<span class="token number">21</span>: eth0@if22: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP     link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff    inet <span class="token number">172.17</span>.0.3/16 brd <span class="token number">172.17</span>.255.255 scope global eth0       valid_lft forever preferred_lft forever       davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/docker$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 333a28ae8ea1 /bin/sh -c <span class="token string">"ip a"</span><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo       valid_lft forever preferred_lft forever<span class="token number">23</span>: eth0@if24: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP     link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0       valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="CAMè¡¨ï¼ˆMAC-Learning-Tableï¼‰"><a href="#CAMè¡¨ï¼ˆMAC-Learning-Tableï¼‰" class="headerlink" title="CAMè¡¨ï¼ˆMAC Learning Tableï¼‰"></a>CAMè¡¨ï¼ˆMAC Learning Tableï¼‰</h1><p><a href="https://www.xmodulo.com/show-mac-learning-table-linux-bridge.html">How to show a MAC learning table of Linux bridge</a><br>å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°docker0ç½‘æ¡¥ï¼ˆè™šæ‹Ÿäº¤æ¢æœºï¼‰çš„CAMè¡¨ï¼Œå³mac addrå¯¹åº”çš„port no</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ brctl showmacs docker0port nomac addris local?ageing timer  <span class="token number">1</span><span class="token number">22</span>:2f:64:b8:78:af<span class="token function">yes</span>   <span class="token number">0.00</span>  <span class="token number">1</span><span class="token number">22</span>:2f:64:b8:78:af<span class="token function">yes</span>   <span class="token number">0.00</span>  <span class="token number">2</span><span class="token number">46</span>:de:b9:ed:19:0f<span class="token function">yes</span>   <span class="token number">0.00</span>  <span class="token number">2</span><span class="token number">46</span>:de:b9:ed:19:0f<span class="token function">yes</span>   <span class="token number">0.00</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h1><h2 id="æŸ¥çœ‹è·¯ç”±è¡¨"><a href="#æŸ¥çœ‹è·¯ç”±è¡¨" class="headerlink" title="æŸ¥çœ‹è·¯ç”±è¡¨"></a>æŸ¥çœ‹è·¯ç”±è¡¨</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/ $ routeKernel IP routing tableDestination     Gateway         Genmask         Flags Metric Ref    Use Ifacedefault         <span class="token number">172.17</span>.0.1      <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0<span class="token number">172.17</span>.0.0      *               <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿™æ˜¯dockerå®¹å™¨å†…éƒ¨çš„è·¯ç”±è¡¨ï¼š</li><li>ç¬¬äºŒæ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€172.17.0.0&#x2F;16çš„IPåŒ…ï¼Œéƒ½è¦é€šè¿‡eth0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;eth0ï¼‰ï¼Œä¸ç»è¿‡ç½‘å…³ï¼ˆGateway&#x3D;*ï¼‰,ç›´æ¥é€šè¿‡äºŒå±‚ç½‘ç»œå‘é€è¿‡å»ã€‚</li><li>ç¬¬ä¸€æ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€å…¶ä»–åœ°å€çš„IPåŒ…ï¼Œéƒ½è¦é€šè¿‡eth0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;eth0ï¼‰ï¼Œè¦å…ˆå‘ç»™ç½‘å…³172.17.0.1ï¼ˆGateway&#x3D;172.17.0.1ï¼‰</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ route -nKernel IP routing tableDestination     Gateway         Genmask         Flags Metric Ref    Use Iface<span class="token number">0.0</span>.0.0         <span class="token number">192.168</span>.3.1     <span class="token number">0.0</span>.0.0         UG    <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> docker0<span class="token number">192.168</span>.3.0     <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U     <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿™æ˜¯Hostçš„è·¯ç”±è¡¨ï¼š</li><li>ç¬¬äºŒæ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€172.17.0.0&#x2F;16çš„IPåŒ…ï¼Œéƒ½è¦ä»docker0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;docker0ï¼‰ï¼Œä¸ç»è¿‡ç½‘å…³ï¼ˆGateway&#x3D;0.0.0.0ï¼‰ï¼Œç›´æ¥é€šè¿‡äºŒå±‚ç½‘ç»œå‘é€è¿‡å»</li><li>ç¬¬ä¸‰æ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€192.168.3.0&#x2F;24çš„IPåŒ…ï¼Œéƒ½è¦ä»wlp4s0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;wlp4s0ï¼‰ï¼Œä¸ç»è¿‡ç½‘å…³ï¼ˆGateway&#x3D;0.0.0.0ï¼‰ï¼Œç›´æ¥é€šè¿‡äºŒå±‚ç½‘ç»œå‘é€è¿‡å»</li></ul><p>å› æ­¤ï¼š</p><ul><li>ä»ä¸»æœº <code>ping 172.17.0.2</code> å®¹å™¨ï¼Œå®é™…æ˜¯è¿›å…¥äº†docker0ç½‘æ¡¥ï¼Œå› æ­¤èƒ½pingé€šå®¹å™¨</li><li>ä»ä¸»æœº <code>ping 192.168.3.2</code> å³è¯¥ä¸»æœºå±€åŸŸç½‘å†…å…¶ä»–ä¸»æœºï¼Œå®é™…æ˜¯ä»wlp4s0ç½‘å¡ï¼ˆç‰©ç†ç½‘å¡ï¼‰å‡ºå»ã€‚</li></ul><h1 id="NAT-x2F-iptables"><a href="#NAT-x2F-iptables" class="headerlink" title="NAT&#x2F;iptables"></a>NAT&#x2F;iptables</h1><h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><h2 id="DNSç¼“å­˜"><a href="#DNSç¼“å­˜" class="headerlink" title="DNSç¼“å­˜"></a>DNSç¼“å­˜</h2><h3 id="Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"><a href="#Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜" class="headerlink" title="Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"></a>Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜</h3><h4 id="2016å¹´å‰"><a href="#2016å¹´å‰" class="headerlink" title="2016å¹´å‰"></a>2016å¹´å‰</h4><p><a href="https://unix.stackexchange.com/questions/28553/how-to-read-the-local-dns-cache-contents">By 2016, Prior to systemd, there was almost no OS-level DNS caching</a><br>unless nscd or dnsmasq was installed and running.<br>Even then, the DNS caching feature of nscd is disabled by default at least in Debian because itâ€™s broken.<br><a href="https://stackoverflow.com/questions/11020027/dns-caching-in-linux">The practical upshot is that your linux system very very probably does not do any OS-level DNS caching.</a></p><blockquote><p>If an end user using your software needs to have DNS caching </br><br>because the DNS query load is large enough to be a problem or the RTT to the external DNS server is long enough to be a problem, </br><br>they can install a caching DNS server such as Unbound on the same machine as your application,<br>configured to cache responses and forward misses to the regular DNS resolvers.</p></blockquote><h4 id="2016å¹´å"><a href="#2016å¹´å" class="headerlink" title="2016å¹´å"></a>2016å¹´å</h4><p><a href="https://www.freedesktop.org/software/systemd/man/systemd-resolved.service.html">After 2016, nowadays on systemd thereâ€™s a service to cache DNS, it could be enabled with systemctl enable systemd-resolved</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">service</span> systemd-resolved statussystemd-resolved.service - Network Name Resolution     Loaded: loaded <span class="token punctuation">(</span>/lib/systemd/system/systemd-resolved.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>     Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Sun <span class="token number">2022</span>-05-08 <span class="token number">16</span>:04:20 CST<span class="token punctuation">;</span> <span class="token number">1</span> months <span class="token number">18</span> days ago       Docs: man:systemd-resolved.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>             https://www.freedesktop.org/wiki/Software/systemd/resolved             https://www.freedesktop.org/wiki/Software/systemd/writing-network-configuration-managers             https://www.freedesktop.org/wiki/Software/systemd/writing-resolver-clients   Main PID: <span class="token number">603</span> <span class="token punctuation">(</span>systemd-resolve<span class="token punctuation">)</span>     Status: <span class="token string">"Processing requests..."</span>      Tasks: <span class="token number">1</span> <span class="token punctuation">(</span>limit: <span class="token number">9305</span><span class="token punctuation">)</span>     Memory: <span class="token number">2</span>.6M     CGroup: /system.slice/systemd-resolved.service             â””â”€603 /lib/systemd/systemd-resolved<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">cat</span> /etc/resolv.confnameserver <span class="token number">127.0</span>.0.53options edns0 trust-ad<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ resolvectl statusLink <span class="token number">3</span> <span class="token punctuation">(</span>wlp4s0<span class="token punctuation">)</span>      Current Scopes: DNS        DefaultRoute setting: <span class="token function">yes</span>               LLMNR setting: <span class="token function">yes</span>        MulticastDNS setting: no           DNSOverTLS setting: no               DNSSEC setting: no             DNSSEC supported: no           Current DNS Server: <span class="token number">192.168</span>.3.1         DNS Servers: <span class="token number">192.168</span>.3.1          DNS Domain: ~.         Link <span class="token number">6</span> <span class="token punctuation">(</span>docker0<span class="token punctuation">)</span>      Current Scopes: noneDefaultRoute setting: no         LLMNR setting: <span class="token function">yes</span> MulticastDNS setting: no    DNSOverTLS setting: no        DNSSEC setting: no      DNSSEC supported: no  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜"><a href="#Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜" class="headerlink" title="Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜"></a>Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chrome://net-internals/<span class="token comment">#dnschrome</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"><a href="#Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜" class="headerlink" title="Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"></a>Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">about:networking<span class="token comment">#dns</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="DNSåŸŸåè§£ææ’æŸ¥"><a href="#DNSåŸŸåè§£ææ’æŸ¥" class="headerlink" title="DNSåŸŸåè§£ææ’æŸ¥"></a>DNSåŸŸåè§£ææ’æŸ¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:/etc/systemd$ <span class="token function">dig</span> baidu.comdavywalker@davywalker-ThinkPad-X1-Carbon-4th:/etc/systemd$ <span class="token function">dig</span> baidu.com +trace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯"><a href="#æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯"></a>æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯</h1><p>åœ¨Linux&amp;MacOSä¸Šï¼Œtracerouteå‘½ä»¤é»˜è®¤ä½¿ç”¨UDPï¼Œè€ŒWindowsé»˜è®¤ä½¿ç”¨ICMPåè®®ã€‚ä½†å¯ä»¥ä½¿ç”¨<code>traceroute -I</code>æ¥å¼ºåˆ¶ä½¿ç”¨ICMPåè®®ã€‚<br><a href="https://serverfault.com/questions/374620/does-traceroute-use-udp-or-icmp-or-both">By default Windows tracert uses ICMP and both Mac OS X and Linux traceroute use UDP.</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">traceroute</span> <span class="token number">220.181</span>.38.148<span class="token function">traceroute</span> to <span class="token number">220.181</span>.38.148 <span class="token punctuation">(</span><span class="token number">220.181</span>.38.148<span class="token punctuation">)</span>, <span class="token number">30</span> hops max, <span class="token number">60</span> byte packets <span class="token number">1</span>  _gateway <span class="token punctuation">(</span><span class="token number">192.168</span>.3.1<span class="token punctuation">)</span>  <span class="token number">3.140</span> ms  <span class="token number">3.401</span> ms  <span class="token number">5.204</span> ms <span class="token number">2</span>  <span class="token number">122.233</span>.112.1 <span class="token punctuation">(</span><span class="token number">122.233</span>.112.1<span class="token punctuation">)</span>  <span class="token number">8.077</span> ms  <span class="token number">8.005</span> ms  <span class="token number">8.613</span> ms <span class="token number">3</span>  <span class="token number">61.164</span>.3.50 <span class="token punctuation">(</span><span class="token number">61.164</span>.3.50<span class="token punctuation">)</span>  <span class="token number">8.474</span> ms <span class="token number">61.164</span>.2.2 <span class="token punctuation">(</span><span class="token number">61.164</span>.2.2<span class="token punctuation">)</span>  <span class="token number">8.331</span> ms  <span class="token number">9.131</span> ms<span class="token number">30</span>  * * *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä½¿ç”¨ICMPåè®®è¿›è¡Œtraceroute</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">traceroute</span> -I <span class="token number">220.181</span>.38.148<span class="token function">traceroute</span> to <span class="token number">220.181</span>.38.148 <span class="token punctuation">(</span><span class="token number">220.181</span>.38.148<span class="token punctuation">)</span>, <span class="token number">30</span> hops max, <span class="token number">60</span> byte packets <span class="token number">1</span>  _gateway <span class="token punctuation">(</span><span class="token number">192.168</span>.3.1<span class="token punctuation">)</span>  <span class="token number">3.348</span> ms  <span class="token number">3.300</span> ms  <span class="token number">3.604</span> ms <span class="token number">2</span>  <span class="token number">122.233</span>.112.1 <span class="token punctuation">(</span><span class="token number">122.233</span>.112.1<span class="token punctuation">)</span>  <span class="token number">46.031</span> ms  <span class="token number">46.236</span> ms  <span class="token number">46.274</span> ms <span class="token number">3</span>  <span class="token number">61.164</span>.3.50 <span class="token punctuation">(</span><span class="token number">61.164</span>.3.50<span class="token punctuation">)</span>  <span class="token number">8.196</span> ms  <span class="token number">9.610</span> ms  <span class="token number">9.522</span> ms <span class="token number">4</span>  * <span class="token number">115.233</span>.18.13 <span class="token punctuation">(</span><span class="token number">115.233</span>.18.13<span class="token punctuation">)</span>  <span class="token number">10.761</span> ms * <span class="token number">5</span>  <span class="token number">202.97</span>.102.201 <span class="token punctuation">(</span><span class="token number">202.97</span>.102.201<span class="token punctuation">)</span>  <span class="token number">40.430</span> ms  <span class="token number">40.413</span> ms  <span class="token number">40.431</span> ms <span class="token number">6</span>  <span class="token number">36.110</span>.245.66 <span class="token punctuation">(</span><span class="token number">36.110</span>.245.66<span class="token punctuation">)</span>  <span class="token number">35.611</span> ms *  <span class="token number">34.008</span> ms <span class="token number">7</span>  * * * <span class="token number">8</span>  <span class="token number">220.181</span>.182.30 <span class="token punctuation">(</span><span class="token number">220.181</span>.182.30<span class="token punctuation">)</span>  <span class="token number">41.642</span> ms  <span class="token number">41.785</span> ms  <span class="token number">37.416</span> ms <span class="token number">9</span>  * * *<span class="token number">10</span>  * * *<span class="token number">11</span>  * * *<span class="token number">12</span>  <span class="token number">220.181</span>.38.148 <span class="token punctuation">(</span><span class="token number">220.181</span>.38.148<span class="token punctuation">)</span>  <span class="token number">40.385</span> ms  <span class="token number">40.757</span> ms  <span class="token number">40.478</span> ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ"><a href="#è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ" class="headerlink" title="è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ"></a>è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ</h2><p>ä¾‹å¦‚ï¼š<br>dockerå®¹å™¨å†…éƒ¨ 172.17.0.2ï¼Œè®¿é—®hostçš„ip (192.168.3.80)</p><ol><li><p>dockerå®¹å™¨å†…éƒ¨æœ‰ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œédockerå®¹å™¨ç½‘æ®µï¼Œéƒ½åˆ°docker0ç½‘æ¡¥ä¸Šï¼Œdocker0ç½‘æ¡¥IP 172.17.0.1</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Destination     Gateway         Genmask         Flags Metric Ref    Use Ifacedefault         <span class="token number">172.17</span>.0.1      <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>è¯·æ±‚åˆ°docker0ç½‘æ¡¥ 172.17.0.1 ä¹‹åï¼Œï¼ˆdocker0ç½‘æ¡¥æœ¬èº«å°±åœ¨Hostä¸Šï¼‰ï¼ŒæŸ¥çœ‹è·¯ç”±è¡¨ï¼Œä» wlp4s0 ç½‘å¡å‘å‡ºï¼ˆè¿™é‡Œå…·ä½“æ€ä¹ˆå‘å‡ºçš„ï¼Ÿï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:/etc/systemd$ route -nKernel IP routing tableDestination     Gateway         Genmask         Flags Metric Ref    Use Iface<span class="token number">0.0</span>.0.0         <span class="token number">192.168</span>.3.1     <span class="token number">0.0</span>.0.0         UG    <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> docker0<span class="token number">192.168</span>.3.0     <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U     <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="centoså¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€-å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨"><a href="#centoså¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€-å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨" class="headerlink" title="centoså¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€, å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨"></a>centoså¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€, å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨</h2><p>ä½¿ç”¨<code>VMware Fusion</code>å®‰è£…å¥½äº†<code>CentOS 7</code>è™šæ‹Ÿæœºä¹‹å, å‘ç°ç½‘ç»œæ€ä¹ˆéƒ½ä¸é€š.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ping</span> baidu.comping: baidu.com: Name or <span class="token function">service</span> not known$ <span class="token function">curl</span> baidu.comcurl: Could not resolve host: baidu.com<span class="token punctuation">;</span> Unknown error<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ’æŸ¥: </p><ol><li>æŸ¥çœ‹ç½‘å¡è¿æ¥çŠ¶æ€, å‘ç°ä»¥å¤ªç½‘å¡<code>ens33</code>ä¸ºæœªè¿æ¥<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> nmcli dDEVICE  TYPE      STATE         CONNECTIONens33   ethernet  disconnected  --lo      lookback  unmanaged     --<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>ä¿®æ”¹ç½‘å¡çŠ¶æ€<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33-- <span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>no<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li>é‡å¯ç½‘ç»œæœåŠ¡<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> /etc/init.d/network restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>éªŒè¯ç½‘å¡çŠ¶æ€<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> nmcli dDEVICE  TYPE      STATE         CONNECTIONens33   ethernet  connected     ens33lo      lookback  unmanaged     --<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>éªŒè¯ç½‘ç»œçŠ¶æ€: æˆåŠŸ<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ping</span> baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ARPåè®®&quot;&gt;&lt;a href=&quot;#ARPåè®®&quot; class=&quot;headerlink&quot; title=&quot;ARPåè®®&quot;&gt;&lt;/a&gt;ARPåè®®&lt;/h1&gt;&lt;h2 id=&quot;æŸ¥çœ‹ARPç¼“å­˜è¡¨&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹ARPç¼“å­˜è¡¨&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹ARPç¼“å­˜è¡¨&quot;&gt;&lt;/a&gt;æŸ¥çœ‹ARPç¼“å­˜è¡¨&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/nat$ arp -v
Address                  HWtype  HWaddress           Flags Mask            Iface
_gateway                 ether   c0:b4:7d:69:d6:c3   C                     wlp4s0
&lt;span class=&quot;token number&quot;&gt;172.17&lt;/span&gt;.0.3               ether   02:42:ac:11:00:03   C                     docker0
&lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.3.2              ether   00:11:32:b2:b7:04   C                     wlp4s0
&lt;span class=&quot;token number&quot;&gt;172.17&lt;/span&gt;.0.2               ether   02:42:ac:11:00:02   C                     docker0
Entries: &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;	Skipped: &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;	Found: &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜&quot;&gt;&lt;/a&gt;æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/nat$ arp -i wlp4s0
Address                  HWtype  HWaddress           Flags Mask            Iface
_gateway                 ether   c0:b4:7d:69:d6:c3   C                     wlp4s0
&lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.3.2              ether   00:11:32:b2:b7:04   C                     wlp4s0&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;å‚æ•°è¯¦è§£&quot;&gt;&lt;a href=&quot;#å‚æ•°è¯¦è§£&quot; class=&quot;headerlink&quot; title=&quot;å‚æ•°è¯¦è§£&quot;&gt;&lt;/a&gt;å‚æ•°è¯¦è§£&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;flags:&lt;ul&gt;
&lt;li&gt;C: complete, each complete entry in the ARP cache will be marked with the C flag.&lt;/li&gt;
&lt;li&gt;M: æ‰‹åŠ¨å¢åŠ çš„ï¼ŒPermanent entries are marked  with  M&lt;/li&gt;
&lt;li&gt;P: TODO: ä¸å¤ªæ˜ç™½å…·ä½“å•¥æ„æ€ï¼Œpublished entries have the P flag.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;ç½‘æ¡¥&quot;&gt;&lt;a href=&quot;#ç½‘æ¡¥&quot; class=&quot;headerlink&quot; title=&quot;ç½‘æ¡¥&quot;&gt;&lt;/a&gt;ç½‘æ¡¥&lt;/h1&gt;&lt;h2 id=&quot;æŸ¥çœ‹ç½‘æ¡¥&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹ç½‘æ¡¥&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹ç½‘æ¡¥&quot;&gt;&lt;/a&gt;æŸ¥çœ‹ç½‘æ¡¥&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ brctl show
bridge name	bridge &lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt;		STP enabled	interfaces
docker0		&lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt;.0242cee53ddd	no		veth9aec769
							            vethe466b6b
virbr0		&lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt;.525400245c90	&lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;		virbr0-nic&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;</summary>
    
    
    
    
    <category term="code-snippets" scheme="https://davyjones2010.github.io/tags/code-snippets/"/>
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="network" scheme="https://davyjones2010.github.io/tags/network/"/>
    
    <category term="nat" scheme="https://davyjones2010.github.io/tags/nat/"/>
    
    <category term="arp" scheme="https://davyjones2010.github.io/tags/arp/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡DubboæœåŠ¡è°ƒç”¨å¼‚å¸¸æ’æŸ¥</title>
    <link href="https://davyjones2010.github.io/2022-06-24-dubbo-invoke-error/"/>
    <id>https://davyjones2010.github.io/2022-06-24-dubbo-invoke-error/</id>
    <published>2022-06-24T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><ul><li>åº”ç”¨æ‹“æ‰‘: systemA â€”- dubbo è°ƒç”¨ â€”-&gt; systemB</li><li>systemBåº”ç”¨åœ¨å·²æœ‰çš„dubboæ¥å£ç±»é‡Œ, æ–°å¢åŠ äº†ä¸€ä¸ªæ–¹æ³•methodA.</li><li>systemAåœ¨è°ƒç”¨è¯¥methodAæ—¶, æŠ›é”™. é”™è¯¯ä¿¡æ¯å¦‚ä¸‹:</li></ul><h1 id="æ’æŸ¥æ­¥éª¤"><a href="#æ’æŸ¥æ­¥éª¤" class="headerlink" title="æ’æŸ¥æ­¥éª¤"></a>æ’æŸ¥æ­¥éª¤</h1><h2 id="0x00-æ’æŸ¥providerä¾§"><a href="#0x00-æ’æŸ¥providerä¾§" class="headerlink" title="0x00 æ’æŸ¥providerä¾§"></a>0x00 æ’æŸ¥providerä¾§</h2><p>ç¡®è®¤providerä¾§:</p><ol><li>æœåŠ¡æ˜¯å¦æ­£å¸¸å¯ä»¥æ‰§è¡Œ? &gt; é€šè¿‡telnet localhost, æ‰‹åŠ¨invokeç¡®å®šæ˜¯OKçš„.</li><li>æ¥å£ç±»&amp;æ¥å£æ–¹æ³•æ˜¯å¦æ­£å¸¸æ³¨å†Œåœ¨registryä¸Š? &gt; é€šè¿‡æŸ¥çœ‹dubbo registry, å‘ç°æ¥å£ç±»ä¸æ¥å£æ–¹æ³•æ˜¯æ­£å¸¸æ³¨å†Œçš„.</li></ol><h2 id="0x01-æ’æŸ¥consumerä¾§"><a href="#0x01-æ’æŸ¥consumerä¾§" class="headerlink" title="0x01 æ’æŸ¥consumerä¾§"></a>0x01 æ’æŸ¥consumerä¾§</h2><p>ç¡®è®¤consumerä¾§:</p><ol><li>æ˜¯å¦æ­£ç¡®ä¾èµ–åˆ°äº†provider?<ol><li>é€šè¿‡æŸ¥çœ‹ tcp ESTABLISHED è¿æ¥ç¡®å®šé•¿è¿æ¥å·²ç»å»ºç«‹.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122201347.png"></li><li>or æŸ¥çœ‹registryä¸‹å‘çš„ dubbo config æ–‡ä»¶?  â€“&gt; TODO: æš‚æ—¶æ²¡æ‰¾åˆ°, å¾…åˆ†æ.</li></ol></li><li>è¯·æ±‚æ˜¯å¦æ­£ç¡®è·¯ç”±åˆ°äº†providerçš„host?  &#x2F;&#x2F; ç”±äºsystemBæœ‰å¤šå¥—ç¯å¢ƒ, æ€€ç–‘æ˜¯è¯·æ±‚è·¯ç”±åˆ°äº†éç›®æ ‡ç¯å¢ƒ.<ol><li>åŠ¨æ€åˆ†æ: æŸ¥çœ‹ dubbo è¯·æ±‚æ—¥å¿— â€“&gt; æ²¡æ‰¾åˆ°, å¾…è¿›ä¸€æ­¥æŸ¥çœ‹.</li><li>é™æ€åˆ†æ: æŸ¥çœ‹ diamond é…ç½® + ç›¸å…³ä»£ç , æ˜¯ä¸æ˜¯è·¯ç”±ä»£ç æœ‰è¯¯?</li></ol></li></ol><h2 id="0x02-çœŸå®é”™è¯¯åŸå› "><a href="#0x02-çœŸå®é”™è¯¯åŸå› " class="headerlink" title="0x02 çœŸå®é”™è¯¯åŸå› "></a>0x02 çœŸå®é”™è¯¯åŸå› </h2><ul><li>providerä¾§ä¸consumerä¾§éƒ½æ²¡æœ‰é—®é¢˜, è·¯ç”±ä¹Ÿæ²¡æœ‰é—®é¢˜, ä½†ä¸ºå•¥ä¼šæŠ¥é”™?</li><li>æœ€ç»ˆåœ¨æŸä½åŒå­¦çš„æé†’ä¸‹, æŸ¥çœ‹äº†consumerä¾§çš„erroræ—¥å¿—, å‘ç°äº†è¯¦ç»†çš„é”™è¯¯å †æ ˆä¿¡æ¯å¦‚ä¸‹(åŸæ¥æ˜¯åºåˆ—åŒ–å¤±è´¥):</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122201975.png"></p><h2 id="0x03-åŸå› æ¢è®¨"><a href="#0x03-åŸå› æ¢è®¨" class="headerlink" title="0x03 åŸå› æ¢è®¨"></a>0x03 åŸå› æ¢è®¨</h2><h3 id="ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„"><a href="#ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„" class="headerlink" title="ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„?"></a>ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„?</h3><p>å› ä¸ºdubbo rpc, é»˜è®¤ä½¿ç”¨hessian2åºåˆ—åŒ–æ–¹å¼.<br><a href="https://blog.csdn.net/liyong1028826685/article/details/117308356">è€Œhessian2é’ˆå¯¹java Objectç±»å‹å‚æ•°, ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„Javaåºåˆ—åŒ–æ–¹å¼</a>.<br>è€ŒJavaåºåˆ—åŒ–åˆ™è¦æ±‚Objectå¿…é¡»<code>implements Serializable</code>æ¥å£.</p><h3 id="ä¸ºå•¥åœ¨æœ¬åœ°telnet-invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯"><a href="#ä¸ºå•¥åœ¨æœ¬åœ°telnet-invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯" class="headerlink" title="ä¸ºå•¥åœ¨æœ¬åœ°telnet invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯?"></a>ä¸ºå•¥åœ¨æœ¬åœ°telnet invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯?</h3><p>å› ä¸ºåœ¨æœ¬åœ°telnet invokeçš„æ—¶å€™, é»˜è®¤ä½¿ç”¨çš„æ˜¯JSONåºåˆ—åŒ–æ–¹å¼!</p><h3 id="å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼"><a href="#å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼?"></a>å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼?</h3><ol><li>æŸ¥çœ‹registry, å¦‚æœæ²¡æœ‰æŒ‡å®š, åˆ™æ˜¯é»˜è®¤çš„hessian2:</li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202268.png"></p><h3 id="å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼"><a href="#å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼" class="headerlink" title="å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼?"></a>å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼?</h3><p><a href="https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/">https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/</a><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202940.png"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>dubbo:protocol <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"dubbo-m"</span> <span class="token assign-left variable">threadpool</span><span class="token operator">=</span><span class="token string">"dubboThreadPool"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"dubbo"</span>  <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;pbs.dubbo.protocol.default.port&#125;</span>"</span>  <span class="token assign-left variable">threads</span><span class="token operator">=</span><span class="token string">"150"</span> <span class="token assign-left variable">serialization</span><span class="token operator">=</span><span class="token string">"json"</span> /<span class="token operator">></span><span class="token operator">&lt;</span>dubbo:protocol <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"dubbo-h"</span> <span class="token assign-left variable">threadpool</span><span class="token operator">=</span><span class="token string">"dubboThreadPool"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"dubbo"</span>  <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;pbs.dubbo.protocol.high.port&#125;</span>"</span>  <span class="token assign-left variable">threads</span><span class="token operator">=</span><span class="token string">"150"</span> <span class="token assign-left variable">serialization</span><span class="token operator">=</span><span class="token string">"fastjson"</span> /<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ”¶è·"><a href="#æ”¶è·" class="headerlink" title="æ”¶è·"></a>æ”¶è·</h1><h2 id="æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤"><a href="#æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤" class="headerlink" title="æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤"></a>æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤</h2><ol><li>æ’æŸ¥é—®é¢˜æ—¶, ä¼˜å…ˆåœ¨æŠ¥é”™çš„host(ä¸ç”¨ç®¡æ˜¯consumer&#x2F;provider)ä¸Š, æŸ¥çœ‹errorç­‰æ›´è¯¦ç»†çš„å †æ ˆæ—¥å¿—.</li></ol><h2 id="èµ°çš„ä¸€äº›å¼¯è·¯"><a href="#èµ°çš„ä¸€äº›å¼¯è·¯" class="headerlink" title="èµ°çš„ä¸€äº›å¼¯è·¯"></a>èµ°çš„ä¸€äº›å¼¯è·¯</h2><ol><li>providerä¾§æ’æŸ¥æ—¶, invoke æ–¹æ³•åç§°å†™é”™, å¯¼è‡´è¯¯ä»¥ä¸ºæ˜¯provideræ²¡æœ‰æŠŠæ–°çš„æ¥å£æ–¹æ³•æš´éœ²å‡ºå». è¯¯å¯¼äº†æ’æŸ¥æ–¹å‘. å¦‚ä¸‹:</li></ol><p>æ­£ç¡®çš„: <code>invoke com.xxx.xxx.XXXQueryService.queryHistory(&quot;&quot;)</code><br>é”™è¯¯çš„: <code>invoke com.xxx.xxx.XXXQueryService.describeHistory(&quot;&quot;)</code><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202508.png"><br><a href="#dubbo%E5%A6%82%E4%BD%95%E6%9F%A5%E5%88%B0%E6%9F%90%E5%8F%B0host%E4%B8%AD%E6%9F%90%E4%B8%AA%E6%8E%A5%E5%8F%A3%E6%8F%90%E4%BE%9B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95">å¦‚ä½•å¿«é€ŸæŸ¥çœ‹æŸä¸ªhostçš„æŸä¸ªinterfaceæœ‰æ²¡æœ‰æŠŠæŸä¸ªmethodæš´éœ²å‡ºå»</a></p><ol start="2"><li>consumerä¾§æ’æŸ¥æ—¶, ç”±äºsystemAçš„dubbo consoleçš„ç«¯å£ä¸systemBçš„dubbo console ç«¯å£ä¸ä¸€è‡´, ä¹ŸæŸ¥äº†åŠå¤©.<br><a href="#dubbo%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8Bconsole%E7%9A%84%E7%AB%AF%E5%8F%A3">å¦‚ä½•å¿«é€ŸæŸ¥åˆ°dubbo consoleç«¯å£å·?</a></li></ol><h2 id="Dubboæœ€ä½³å®è·µ"><a href="#Dubboæœ€ä½³å®è·µ" class="headerlink" title="Dubboæœ€ä½³å®è·µ"></a>Dubboæœ€ä½³å®è·µ</h2><h3 id="dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»"><a href="#dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»" class="headerlink" title="dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»"></a>dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»</h3><h4 id="éš”ç¦»åŸç†"><a href="#éš”ç¦»åŸç†" class="headerlink" title="éš”ç¦»åŸç†"></a>éš”ç¦»åŸç†</h4><p>å•ä¸ªhostå¯ä»¥å¼€å¯å¤šä¸ªdubboç«¯å£, æ¯ä¸ªç«¯å£ç”±ç‹¬ç«‹çš„çº¿ç¨‹æ± å¤„ç†, æŠŠsvcæŒ‰ç…§ç«¯å£è¿›è¡Œåˆ†ç»„.<br>å¯ä»¥é˜²æ­¢ä½ä¼˜å…ˆçº§æ¥å£å ç”¨çº¿ç¨‹å¯¼è‡´dubboçº¿ç¨‹æ± æ»¡, ä»è€Œå½±å“é«˜ä¼˜å…ˆçº§æ¥å£.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202434.png"></p><h4 id="éš”ç¦»é…ç½®æ ·ä¾‹"><a href="#éš”ç¦»é…ç½®æ ·ä¾‹" class="headerlink" title="éš”ç¦»é…ç½®æ ·ä¾‹"></a>éš”ç¦»é…ç½®æ ·ä¾‹</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>coreRegistry<span class="token punctuation">"</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.dubbo.registry.address&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment">&lt;!-- æ ¸å¿ƒæ¥å£ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-core<span class="token punctuation">"</span></span> <span class="token attr-name">threadpool</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubboThreadPool<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo<span class="token punctuation">"</span></span>  <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.dubbo.protocol.core.port&#125;<span class="token punctuation">"</span></span>  <span class="token attr-name">threads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment">&lt;!-- ä¸­ä¼˜å…ˆçº§æ¥å£çº¿ç¨‹æ± (é»˜è®¤ï¼Œä¸ºäº†æœ€å¤§ä¿æŒå…¼å®¹) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-m<span class="token punctuation">"</span></span> <span class="token attr-name">threadpool</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubboThreadPool<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo<span class="token punctuation">"</span></span>  <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.dubbo.protocol.default.port&#125;<span class="token punctuation">"</span></span>  <span class="token attr-name">threads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>150<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment">&lt;!-- é»˜è®¤providerä½¿ç”¨dubbo-m,http-dubboåè®® --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>provider</span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-m<span class="token punctuation">"</span></span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-sentinel.dubbo.provider.filter<span class="token punctuation">"</span></span> <span class="token attr-name">delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token comment">&lt;!-- ä½¿ç”¨dubbo-core --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxx.TestService<span class="token punctuation">"</span></span><span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-core<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.service.version&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>testService<span class="token punctuation">"</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!-- ä½¿ç”¨dubbo-core --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxx.SampleService<span class="token punctuation">"</span></span><span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-core<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.service.version&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sampleService<span class="token punctuation">"</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™"><a href="#dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™" class="headerlink" title="dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™"></a>dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™</h3><p>å¦‚ä¸Š, <code>pbs.dubbo.protocol.default.port=-1</code>é…ç½®é¡¹, æŒ‰ç…§dubboæ–‡æ¡£è¯´æ˜, åº”è¯¥æ˜¯éšæœºåˆ†é…ä¸€ä¸ªç«¯å£. ä½†å‘ç°systemBå®é™…å¯åŠ¨å, å´å¼€å¯äº† 20880 ç«¯å£. è¿™æ˜¯ä¸ºå•¥?</p><h4 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h4><p>æ ¹æ® <a href="https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/">https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/</a>  æ–‡æ¡£è¯´æ˜,  <code>åˆ†é…çš„ç«¯å£åœ¨åè®®ç¼ºçœç«¯å£çš„åŸºç¡€ä¸Šå¢é•¿</code><br>ä½†å®é™…è¯­ç„‰ä¸è¯¦, dubboåè®®é»˜è®¤ç«¯å£æ˜¯20880,  é‚£ä¹ˆå¦‚æœé…ç½® <code>port=-1</code>, åˆ™ç«¯å£æ˜¯ <code>20880</code> or <code>20881</code>??</p><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203219.png"></p><h4 id="æºä»£ç åˆ†æ"><a href="#æºä»£ç åˆ†æ" class="headerlink" title="æºä»£ç åˆ†æ"></a>æºä»£ç åˆ†æ</h4><p>æ ¸å¿ƒä»£ç : <code>com.alibaba.dubbo.config.ServiceConfig#doExportUrlsFor1Protocol</code>, å¯ä»¥å¾—çŸ¥æ˜¯ä» 20880 å¼€å§‹(åŒ…æ‹¬20880).<br>è¿™ä¹Ÿå°±è§£é‡Šäº†, ä¸ºå•¥ <code>pbs.dubbo.protocol.default.port=-1</code>é…ç½®é¡¹, å®é™…å¯¹åº”çš„å¼€å¯ç«¯å£å·æ˜¯ 20880 å•¦.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203404.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203097.png"></p><h3 id="dubboå¤šç«¯å£telnetåŸåˆ™"><a href="#dubboå¤šç«¯å£telnetåŸåˆ™" class="headerlink" title="dubboå¤šç«¯å£telnetåŸåˆ™"></a>dubboå¤šç«¯å£telnetåŸåˆ™</h3><p>å¦‚ä¸Š, æš´éœ²äº† 20880~20884 5ä¸ªç«¯å£, ç”¨äºçº¿ç¨‹æ± éš”ç¦».<br>å®é™…:</p><ol><li>æ¯ä¸ªç«¯å£, éƒ½æ˜¯å¯åŠ¨äº†ä¸€ä¸ªNettyServer<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203903.png"></li><li>å› æ­¤æ¯ä¸ªç«¯å£, éƒ½å¯ä»¥telnetä¸Šå».</li><li>telnetæ¯ä¸ªç«¯å£æ‰§è¡Œ ls åˆ—ä¸¾å‡ºæ¥æœ¬æœºæš´éœ²çš„dubboæœåŠ¡éƒ½æ˜¯ä¸€æ ·çš„(ä¼šæŠŠæ‰€æœ‰å…¶ä»–ç«¯å£æš´éœ²çš„æœåŠ¡ä¹Ÿéƒ½æšä¸¾å‡ºæ¥). ä¸ä¼šå› ä¸ºtelnet 20880, å°±åªåˆ—ä¸¾å‡ºæš´éœ²åœ¨20880ç«¯å£çš„æœåŠ¡. å‚è§: <code>com.alibaba.dubbo.rpc.protocol.dubbo.telnet.ListTelnetHandler</code><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122204305.png"></li></ol><h3 id="dubboç‰ˆæœ¬å·éš”ç¦»"><a href="#dubboç‰ˆæœ¬å·éš”ç¦»" class="headerlink" title="dubboç‰ˆæœ¬å·éš”ç¦»"></a>dubboç‰ˆæœ¬å·éš”ç¦»</h3><p>ç”¨æ¥åŒºåˆ†å¤šå¥—é¢„å‘ç¯å¢ƒ.<br>ä½†å®é™…çœ‹äº†ä¸‹, å¤šå¥—é¢„å‘ç¯å¢ƒproviderçš„ç‰ˆæœ¬å·éƒ½æ˜¯1.0.0, è€Œä¸æ˜¯é€šè¿‡ç‰ˆæœ¬å·æ¥è¿›è¡Œéš”ç¦»çš„. é‚£ä¹ˆconsumerå®é™…æ€ä¹ˆåšçš„è·¯ç”±?<br>&#x2F;&#x2F; TODO:  æ ¸å¿ƒä»£ç é™„å½•<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122204657.png"></p><h3 id="dubboåºåˆ—åŒ–"><a href="#dubboåºåˆ—åŒ–" class="headerlink" title="dubboåºåˆ—åŒ–"></a>dubboåºåˆ—åŒ–</h3><ul><li>ä½¿ç”¨consoleæ‰‹åŠ¨invoke, ç”¨çš„æ˜¯jsonåºåˆ—åŒ–.</li><li>è€ŒconsumerçœŸæ­£è°ƒç”¨æ—¶ç”¨çš„æ˜¯hessian2åºåˆ—åŒ–, å› æ­¤é’ˆå¯¹è¿™ç§åºåˆ—åŒ–å·®å¼‚å¯¼è‡´çš„é”™è¯¯é—®é¢˜, æ˜¯æ— æ³•éªŒè¯åˆ°çš„. éœ€è¦ç¼–ç æµ‹è¯•çš„æ—¶å€™æ³¨æ„.</li></ul><h3 id="dubbo-ls-x2F-invoke"><a href="#dubbo-ls-x2F-invoke" class="headerlink" title="dubbo ls&#x2F;invoke"></a>dubbo ls&#x2F;invoke</h3><p>å¦‚ä½•æŸ¥çœ‹å½“å‰hostä¸‹ä¾èµ–çš„æ‰€æœ‰dubboæœåŠ¡?</p><ol><li>é€šè¿‡telnet localhost xxxx è¿›å…¥dubboç®¡æ§é¡µé¢, æ‰§è¡Œ <code>ls</code>å‘½ä»¤, åªèƒ½åˆ—å‡ºè‡ªèº«ä½œä¸ºproviderå¯¹å¤–æš´éœ²çš„æ‰€æœ‰æœåŠ¡.</li><li>è€Œæ— æ³•åˆ—å‡ºè‡ªèº«hostä½œä¸ºconsumerä¾èµ–åˆ°çš„æ‰€æœ‰æœåŠ¡.  &#x2F;&#x2F; æŸ¥çœ‹äº†dubboæ–‡æ¡£, ç›®å‰æ²¡æœ‰åŠæ³•é€šè¿‡telnetæŸ¥çœ‹åˆ°.</li></ol><h3 id="dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•"><a href="#dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•" class="headerlink" title="dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•"></a>dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•</h3><h4 id="æ–¹æ¡ˆ1-telnetæŸ¥çœ‹"><a href="#æ–¹æ¡ˆ1-telnetæŸ¥çœ‹" class="headerlink" title="æ–¹æ¡ˆ1 telnetæŸ¥çœ‹"></a>æ–¹æ¡ˆ1 telnetæŸ¥çœ‹</h4><p><code>ls -l com.xxx.SampleService</code><br>telnet localhost  20880  telnet localhost  20881 telnet localhost  20882 éƒ½èƒ½ç™»ä¸Šå», å®é™…æ–¹æ³•åˆ—è¡¨ä¹Ÿç›¸åŒ.  å‚è§: <a href="#th8th">dubboå¤šç«¯å£telnetåŸåˆ™</a></p><h4 id="æ–¹æ¡ˆ2-registryæŸ¥çœ‹"><a href="#æ–¹æ¡ˆ2-registryæŸ¥çœ‹" class="headerlink" title="æ–¹æ¡ˆ2 registryæŸ¥çœ‹"></a>æ–¹æ¡ˆ2 registryæŸ¥çœ‹</h4><p>åœ¨registryä¸­æŸ¥è¯¢æ¥å£, é€‰å®šhostæŸ¥çœ‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122206622.png"></p><h3 id="dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£"><a href="#dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£" class="headerlink" title="dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£"></a>dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£</h3><h4 id="æ–¹æ¡ˆ1-é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#æ–¹æ¡ˆ1-é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="æ–¹æ¡ˆ1: é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶"></a>æ–¹æ¡ˆ1: é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶</h4><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122207808.png"></p><blockquote><p>è¿™ç§æ–¹å¼æœ€ç›´æ¥, ä¹Ÿæœ€æœ‰æ•ˆ. ç¼ºç‚¹æ˜¯ç´§æ€¥æ’æŸ¥é—®é¢˜æ—¶, å¦‚æœé…ç½®é¡¹ç»è¿‡äº†ä¸€å±‚æœ‰ä¸€å±‚çš„è‡ªåŠ¨æ›¿æ¢, ä¸ä¸€å®šèƒ½å¾ˆå¿«æ‰¾å‡ºå®é™…é…ç½®å€¼æ˜¯å•¥.</p></blockquote><h4 id="æ–¹æ¡ˆ2-é€šè¿‡æŸ¥çœ‹TCPè¿æ¥"><a href="#æ–¹æ¡ˆ2-é€šè¿‡æŸ¥çœ‹TCPè¿æ¥" class="headerlink" title="æ–¹æ¡ˆ2: é€šè¿‡æŸ¥çœ‹TCPè¿æ¥"></a>æ–¹æ¡ˆ2: é€šè¿‡æŸ¥çœ‹TCPè¿æ¥</h4><ol><li><p>æŸ¥çœ‹è¿›ç¨‹å·PID(æ³¨æ„çœ‹æ¸…æ¥šè¿›ç¨‹çš„USERæ˜¯ä¸æ˜¯å½“å‰ç”¨æˆ·)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;appName&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹è¿›ç¨‹å ç”¨çš„TCPåœ¨ListençŠ¶æ€çš„ç«¯å£(å¦‚æœä¸Šä¸€æ­¥è·å–åˆ°çš„PIDä¸æ˜¯å½“å‰ç”¨æˆ·çš„, åˆ™éœ€è¦suåˆ°PIDå¯¹åº”çš„ç”¨æˆ·, æˆ–è€…å¦‚ä¸‹ç”¨sudo)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">lsof</span> -i -P<span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;PID&#125;</span> <span class="token operator">|</span> <span class="token function">fgrep</span> LISTEN<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>çœ‹åˆ°å¦‚ä¸‹, ä¸€èˆ¬dubboç«¯å£å·æ˜¯ä»20880å¼€å§‹çš„(åŒ…æ‹¬20880)</p></li></ol><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122207567.png"></p><p>ä½†å¦‚æœåº”ç”¨é…ç½®çš„dubboç«¯å£å¾ˆå¥‡æ€ª, ä¸ç¬¦åˆæƒ¯ä¾‹, é‚£è¿™é‡Œå°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªç«¯å£æ¥telnetè¯•è¯•äº†.</p><blockquote><p>è¿™ç§æ–¹å¼ä¸ç®—éå¸¸ç›´æ¥, ä½†ä¼˜ç‚¹æ˜¯å¯ä»¥ä¸ç”¨å»ç¿»æ‰¾ä»£ç , ç¿»æ‰¾é…ç½®é¡¹. åœ¨ç«¯å£æ•°å¾ˆå°‘çš„æƒ…å†µä¸‹, ç®€å•æœ‰æ•ˆ.</p></blockquote><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul><li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Dubbo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%AE%9E%E6%88%98-%E5%AE%8C/16%20%20Dubbo%20Serialize%20%E5%B1%82%EF%BC%9A%E5%A4%9A%E7%A7%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AE%97%E6%B3%95%EF%BC%8C%E6%80%BB%E6%9C%89%E4%B8%80%E6%AC%BE%E9%80%82%E5%90%88%E4%BD%A0.md">Dubbo Serialize å±‚ï¼šå¤šç§åºåˆ—åŒ–ç®—æ³•ï¼Œæ€»æœ‰ä¸€æ¬¾é€‚åˆä½ </a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åº”ç”¨æ‹“æ‰‘: systemA â€”- dubbo è°ƒç”¨ â€”-&amp;gt; systemB&lt;/li&gt;
&lt;li&gt;systemBåº”ç”¨åœ¨å·²æœ‰çš„dubboæ¥å£ç±»é‡Œ, æ–°å¢åŠ äº†ä¸€ä¸ªæ–¹æ³•methodA.&lt;/li&gt;
&lt;li&gt;systemAåœ¨è°ƒç”¨è¯¥methodAæ—¶, æŠ›é”™. é”™è¯¯ä¿¡æ¯å¦‚ä¸‹:&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;æ’æŸ¥æ­¥éª¤&quot;&gt;&lt;a href=&quot;#æ’æŸ¥æ­¥éª¤&quot; class=&quot;headerlink&quot; title=&quot;æ’æŸ¥æ­¥éª¤&quot;&gt;&lt;/a&gt;æ’æŸ¥æ­¥éª¤&lt;/h1&gt;&lt;h2 id=&quot;0x00-æ’æŸ¥providerä¾§&quot;&gt;&lt;a href=&quot;#0x00-æ’æŸ¥providerä¾§&quot; class=&quot;headerlink&quot; title=&quot;0x00 æ’æŸ¥providerä¾§&quot;&gt;&lt;/a&gt;0x00 æ’æŸ¥providerä¾§&lt;/h2&gt;&lt;p&gt;ç¡®è®¤providerä¾§:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡æ˜¯å¦æ­£å¸¸å¯ä»¥æ‰§è¡Œ? &amp;gt; é€šè¿‡telnet localhost, æ‰‹åŠ¨invokeç¡®å®šæ˜¯OKçš„.&lt;/li&gt;
&lt;li&gt;æ¥å£ç±»&amp;amp;æ¥å£æ–¹æ³•æ˜¯å¦æ­£å¸¸æ³¨å†Œåœ¨registryä¸Š? &amp;gt; é€šè¿‡æŸ¥çœ‹dubbo registry, å‘ç°æ¥å£ç±»ä¸æ¥å£æ–¹æ³•æ˜¯æ­£å¸¸æ³¨å†Œçš„.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;0x01-æ’æŸ¥consumerä¾§&quot;&gt;&lt;a href=&quot;#0x01-æ’æŸ¥consumerä¾§&quot; class=&quot;headerlink&quot; title=&quot;0x01 æ’æŸ¥consumerä¾§&quot;&gt;&lt;/a&gt;0x01 æ’æŸ¥consumerä¾§&lt;/h2&gt;&lt;p&gt;ç¡®è®¤consumerä¾§:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ˜¯å¦æ­£ç¡®ä¾èµ–åˆ°äº†provider?&lt;ol&gt;
&lt;li&gt;é€šè¿‡æŸ¥çœ‹ tcp ESTABLISHED è¿æ¥ç¡®å®šé•¿è¿æ¥å·²ç»å»ºç«‹.&lt;br&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122201347.png&quot;&gt;&lt;/li&gt;
&lt;li&gt;or æŸ¥çœ‹registryä¸‹å‘çš„ dubbo config æ–‡ä»¶?  â€“&amp;gt; TODO: æš‚æ—¶æ²¡æ‰¾åˆ°, å¾…åˆ†æ.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;è¯·æ±‚æ˜¯å¦æ­£ç¡®è·¯ç”±åˆ°äº†providerçš„host?  &amp;#x2F;&amp;#x2F; ç”±äºsystemBæœ‰å¤šå¥—ç¯å¢ƒ, æ€€ç–‘æ˜¯è¯·æ±‚è·¯ç”±åˆ°äº†éç›®æ ‡ç¯å¢ƒ.&lt;ol&gt;
&lt;li&gt;åŠ¨æ€åˆ†æ: æŸ¥çœ‹ dubbo è¯·æ±‚æ—¥å¿— â€“&amp;gt; æ²¡æ‰¾åˆ°, å¾…è¿›ä¸€æ­¥æŸ¥çœ‹.&lt;/li&gt;
&lt;li&gt;é™æ€åˆ†æ: æŸ¥çœ‹ diamond é…ç½® + ç›¸å…³ä»£ç , æ˜¯ä¸æ˜¯è·¯ç”±ä»£ç æœ‰è¯¯?&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;0x02-çœŸå®é”™è¯¯åŸå› &quot;&gt;&lt;a href=&quot;#0x02-çœŸå®é”™è¯¯åŸå› &quot; class=&quot;headerlink&quot; title=&quot;0x02 çœŸå®é”™è¯¯åŸå› &quot;&gt;&lt;/a&gt;0x02 çœŸå®é”™è¯¯åŸå› &lt;/h2&gt;</summary>
    
    
    
    
    <category term="java" scheme="https://davyjones2010.github.io/tags/java/"/>
    
    <category term="dubbo" scheme="https://davyjones2010.github.io/tags/dubbo/"/>
    
  </entry>
  
  <entry>
    <title>NATä¹‹ç«¯å£æ˜ å°„(PAT)åŸç†æ€»ç»“&amp;å®è·µ</title>
    <link href="https://davyjones2010.github.io/2022-06-22-linux-network-nat/"/>
    <id>https://davyjones2010.github.io/2022-06-22-linux-network-nat/</id>
    <published>2022-06-22T16:00:00.000Z</published>
    <updated>2022-11-05T09:46:04.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ç»å¸¸åœ¨å®¶ç”¨è·¯ç”±å™¨ä¸­, çœ‹åˆ°æœ‰ç«¯å£æ˜ å°„(PAT)é€‰é¡¹, ä½†ä¸æ˜æ‰€ä»¥.<br>æœ€è¿‘åˆšå¥½åœ¨ç ”ç©¶NAT, çŸ¥é“äº†<mark>PATæœ¬è´¨æ˜¯NATçš„ä¸€ç§å®ç°æ–¹å¼, æ›´ç¡®åˆ‡åœ°è¯´æ˜¯DNATçš„ä¸€ç§å®ç°æ–¹å¼</mark>.<br>å› æ­¤å€Ÿæ­¤æœºä¼šå¥½å¥½ç ”ç©¶ä¸‹.</p><h1 id="DNATæ€»ç»“"><a href="#DNATæ€»ç»“" class="headerlink" title="DNATæ€»ç»“"></a>DNATæ€»ç»“</h1><h2 id="PATä½œç”¨æ¦‚è¿°"><a href="#PATä½œç”¨æ¦‚è¿°" class="headerlink" title="PATä½œç”¨æ¦‚è¿°"></a>PATä½œç”¨æ¦‚è¿°</h2><p>å®¶ç”¨è·¯ç”±å™¨ä¸­é…ç½®PAT, æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§<code>å†…ç½‘ç©¿é€</code>çš„å®ç°æ–¹å¼ï¼Œæˆ–è€…DNATçš„ä¸€ç§æ–¹å¼ã€‚<br>å³éœ€è¦æŠŠå®¶é‡Œå†…ç½‘æŸå°ä¸»æœºçš„æŸä¸ªæœåŠ¡, æš´éœ²åˆ°å…¬ç½‘ä¸Š, ä»¥ä¾¿èƒ½åœ¨å…¬ç½‘ç¯å¢ƒä¸‹è®¿é—®è¯¥æœåŠ¡.<br>ä¾‹å¦‚</p><ul><li>å®¶åº­å†…ç½‘ç½‘æ®µæ˜¯<code>192.168.3.0/24</code></li><li>å®¶ç”¨è·¯ç”±å™¨, ç”µä¿¡è¿è¥å•†åˆ†é…çš„å¯¹å¤–å…¬ç½‘IPæ˜¯<code>115.192.71.187</code></li><li>æŸå°ä¸»æœºIPæ˜¯<code>192.168.3.213</code>: <ul><li>æš´éœ²äº†8080çš„æŸä¸ªtomcatæœåŠ¡, æƒ³è¦æŠŠè¿™ä¸ªæœåŠ¡æš´éœ²åœ¨å…¬ç½‘ä¸Š, ä»¥ä¾¿å…¶ä»–äººèƒ½å¤Ÿè®¿é—®.</li><li>æš´éœ²äº†è¿œç¨‹æ¡Œé¢RDPç«¯å£æœåŠ¡, ä»¥ä¾¿åœ¨å…¬å¸æˆ–è€…å’–å•¡å…, èƒ½è®¿é—®åˆ°è¯¥è¿œç¨‹æ¡Œé¢.</li><li>ç­‰ç­‰</li></ul></li><li>æ­¤æ—¶å¯ä»¥åœ¨è·¯ç”±å™¨ä¸Šå¼€å¯ç«¯å£æ˜ å°„(PAT), å°†è·¯ç”±å™¨ä¸ŠæŸä¸ªç«¯å£(å¦‚8888)ä¸å†…ç½‘ä¸»æœºçš„ç«¯å£(å¦‚8080)å¦‚è¿›è¡Œæ˜ å°„, æ‰€æœ‰è®¿é—®{è·¯ç”±å™¨IP, 8888ç«¯å£}çš„è¯·æ±‚, å°±ä¼šè¢«è‡ªåŠ¨è·¯ç”±åˆ°{å†…ç½‘IP, 8080ç«¯å£}ä¸Š:</li></ul><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206232339615.png"></p><p>&#x2F;&#x2F; TODO: è¿™é‡ŒæŒ–ä¸ªå‘, å†…ç½‘ç©¿é€é™¤äº†PATå¤–, è¿˜æœ‰å…¶ä»–æ–¹æ¡ˆ, ä¾‹å¦‚ <code>èŠ±ç”Ÿå£³</code>, åè¾¹æ–°å¼€ç¯‡ç« è®²ä¸‹åŸç†.</p><h2 id="åŸç†æ¦‚è¿°"><a href="#åŸç†æ¦‚è¿°" class="headerlink" title="åŸç†æ¦‚è¿°"></a>åŸç†æ¦‚è¿°</h2><p>æœ¬è´¨ä¸Šæ˜¯å®¶ç”¨è·¯ç”±å™¨ä¿å­˜äº†è¿™ä¹ˆä¸€å¼ NATè¡¨:<br><code>&#123;publicIp, publicPort&#125;</code> â€”æ˜ å°„åˆ°â€”&gt; <code>&#123;localIp, localPort&#125;</code></p><h2 id="PATè·¯ç”±æµç¨‹"><a href="#PATè·¯ç”±æµç¨‹" class="headerlink" title="PATè·¯ç”±æµç¨‹"></a>PATè·¯ç”±æµç¨‹</h2><h3 id="0X00-å¤–éƒ¨ç”¨æˆ·-â€“-gt-è·¯ç”±å™¨"><a href="#0X00-å¤–éƒ¨ç”¨æˆ·-â€“-gt-è·¯ç”±å™¨" class="headerlink" title="0X00: å¤–éƒ¨ç”¨æˆ· â€“&gt; è·¯ç”±å™¨"></a>0X00: å¤–éƒ¨ç”¨æˆ· â€“&gt; è·¯ç”±å™¨</h3><ol><li>äºŒå±‚å¸§: <code>&#123;remoteMac, remoteIp, remotePort&#125;, &#123;publicMac, publicIp, publicPort&#125;</code></li></ol><h3 id="0X01-è·¯ç”±å™¨-â€“-gt-å†…ç½‘Server"><a href="#0X01-è·¯ç”±å™¨-â€“-gt-å†…ç½‘Server" class="headerlink" title="0X01: è·¯ç”±å™¨ â€“&gt; å†…ç½‘Server:"></a>0X01: è·¯ç”±å™¨ â€“&gt; å†…ç½‘Server:</h3><ol><li>ç›®æ ‡ publicMac &#x3D;&#x3D; routerâ€™s publicMacï¼Œç½‘å¡æ¥æ”¶ï¼Œè§£æä¸‰å±‚IPåŒ…</li><li>è¿›å…¥preroutingé˜¶æ®µï¼š(DNATä½œç”¨åœ¨prerouteé˜¶æ®µ)<ol><li>æŸ¥NATè¡¨ï¼ˆDNATæ¡ç›®ï¼‰: <code>&#123;publicIp, publicPort&#125;</code> â€“&gt; <code>&#123;localIp, localPort&#125;</code></li><li>ä¿®æ”¹ä¸‰å±‚IPåŒ… <code>&#123;remoteIp, remotePort&#125;</code> â€“&gt; <code>&#123;localIp, localPort&#125;</code></li></ol></li><li>ç”±äºæ­¤æ—¶targetIpæ˜¯ localIp, !&#x3D; publicIpï¼Œå› æ­¤ä¸ä¼šèµ°å…¥INPUTæµç¨‹ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šæŠŠæ•°æ®åŒ…äº¤ç»™ä¸Šå±‚åº”ç”¨ã€‚</li><li>è¿›å…¥FORWARD&#x2F;ROUTEé˜¶æ®µï¼š<ol><li>å¦‚æœæ²¡æœ‰å¼€å¯ip_forwardingï¼Œåˆ™æµç¨‹åˆ°æ­¤ç»“æŸã€‚ç›´æ¥æŠŠIPåŒ…ä¸¢å¼ƒæ‰ã€‚</li><li>æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œ<code>route -n</code>ï¼Œæ‰¾åˆ°å¾€localIpç½‘æ®µå‘é€æ•°æ®åŒ…ï¼Œåº”è¯¥ä½¿ç”¨çš„ç½‘å¡ä¸ç½‘å¡å¯¹åº”çš„Macåœ°å€ï¼ˆä¾‹å¦‚ gatewayMacï¼‰</li></ol></li><li>å°è£…äºŒå±‚å¸§<ol><li>å‘ARPå¹¿æ’­: whatâ€™s localIpâ€™s mac addr, tell publicMac</li><li>è·å–ARPç¼“å­˜è¡¨é¡¹: {localIp} â€“&gt; {localMac}</li><li>ä¿®æ”¹å¸§å†…å®¹ä¸º: <code>&#123;gatewayMac, remoteIp, remotePort&#125;, &#123;localMac, localIp, localPort&#125;</code></li></ol></li><li>é€šè¿‡å¯¹åº”çš„ç½‘å¡å‘å‡ºäºŒå±‚å¸§ã€‚</li></ol><p><img data-src="https://p.k8s.li/iptables.png"></p><h3 id="0X02-Serverç«¯å¤„ç†"><a href="#0X02-Serverç«¯å¤„ç†" class="headerlink" title="0X02: Serverç«¯å¤„ç†:"></a>0X02: Serverç«¯å¤„ç†:</h3><ol><li>æ¥æ”¶å¦‚ä¸‹IPå¸§<br><code>&#123;gatewayMac, remoteIp, remotePort&#125;, &#123;localMac, localIp, localPort&#125;</code></li><li>ç›®æ ‡ localMac &#x3D;&#x3D; Server localMac, ç½‘å¡æ¥æ”¶(æ— éœ€å¼€å¯æ··æ‚æ¨¡å¼), å¦åˆ™ä¸¢å¼ƒ</li><li>ç›®æ ‡ localIp &#x3D;&#x3D; Server localIp, TCP&#x2F;IPåè®®æ ˆæ¥æ”¶. <ol><li>æ˜¯å¦æœ‰å¯èƒ½IPä¸åŒ¹é…? å¦‚ä½•å¤„ç†? â€“&gt; æ˜¯å¦å¼€å¯äº†ip_forwardingï¼Ÿ å…·ä½“å‚è§</li></ol></li><li>serverç«¯å°†TCPæ•°æ®åŒ…è½¬ç»™å¯¹åº”åº”ç”¨å±‚ç¨‹åºå¤„ç†</li></ol><h3 id="0X03-Server-â€“å›åŒ…â€“-gt-è·¯ç”±å™¨"><a href="#0X03-Server-â€“å›åŒ…â€“-gt-è·¯ç”±å™¨" class="headerlink" title="0X03: Server â€“å›åŒ…â€“&gt; è·¯ç”±å™¨:"></a>0X03: Server â€“å›åŒ…â€“&gt; è·¯ç”±å™¨:</h3><ol><li>Serverå¤„ç†å®Œæ¯•, ç”Ÿæˆå›åŒ…, ç”±äºremoteIpä¸åœ¨ç½‘æ®µ:<br><code>&#123;localIp, localPort&#125;, &#123;remoteIp, remotePort&#125;</code></li><li>Serverå‘é€ARPå¹¿æ’­, æŸ¥æ‰¾é»˜è®¤ç½‘å…³(serverç«¯äº‹å…ˆé…ç½®å¥½äº†ç½‘å…³çš„IP)çš„MACåœ°å€ {gatewayIp} â€“&gt; {gatewayMac}</li><li>Serverå°è£…äºŒå±‚å¸§, å‘é€ç»™è·¯ç”±å™¨:<br><code>&#123;localMac, localIp, localPort&#125;, &#123;gatewayMac, remoteIp, remotePort&#125;</code></li></ol><h3 id="0X04-è·¯ç”±å™¨PATå¤„ç†å›åŒ…"><a href="#0X04-è·¯ç”±å™¨PATå¤„ç†å›åŒ…" class="headerlink" title="0X04: è·¯ç”±å™¨PATå¤„ç†å›åŒ…"></a>0X04: è·¯ç”±å™¨PATå¤„ç†å›åŒ…</h3><p>åç»æŸ¥è¯ï¼Œ<mark> é’ˆå¯¹å›åŒ…ï¼Œä¸ä¼šå†è¿‡iptables</mark>ï¼Œè¿›è¡Œå¦‚ä¸‹NATåå‘æŸ¥è¡¨äº†ã€‚<br>å®é™…çœ‹äº†ä¸‹ï¼Œç¡®å®æ²¡æœ‰åŒæ—¶åˆ›å»ºå‡ºå¦‚ä¸‹åå‘çš„iptablesè§„åˆ™ã€‚<br>è€Œæ˜¯<mark>ç”±kernelæ¨¡å—conntrackè¿›è¡Œç»´æŠ¤å®Œæˆ{mac, ip, port}çš„æ›¿æ¢ã€‚<mark></p><ol><li><del>æ”¶åˆ°äºŒå±‚å¸§:<br><code>&#123;localMac, localIp, localPort&#125;, &#123;gatewayMac, remoteIp, remotePort&#125;</code></del></li><li><del>åå‘æŸ¥æ‰¾NATè¡¨:<br><code>&#123;localIp, localPort&#125; --&gt; &#123;publicIp, publicPort&#125;</code></del></li><li><del>ä¿®æ”¹ä¸‰å±‚åŒ…(æ›¿æ¢æ‰localIp, localPort):<br><code>&#123;publicIp, publicPort&#125;, &#123;remoteIp, remotePort&#125;</code></del></li><li><del>äºŒå±‚å¸§ä¿®æ”¹(ä¿®æ”¹æ‰localMac, gatewayMac):<br><code>&#123;publicMac, publicIp, publicPort&#125;, &#123;remoteMac, remoteIp, remotePort&#125;</code></del></li></ol><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„:"></a>æ³¨æ„:</h3><p>è·¯ç”±å™¨æœ¬èº«æ˜¯æœ‰å¤šä¸ªç½‘å¡çš„, å†…ç½‘ä¸­æ˜¯ {gatewayMac, gatewayIp}, å¯¹åº”çš„å…¬ç½‘æ˜¯ {publicMac, publicIp}</p><h1 id="SNATæ€»ç»“"><a href="#SNATæ€»ç»“" class="headerlink" title="SNATæ€»ç»“"></a>SNATæ€»ç»“</h1><p>&#x2F;&#x2F; TODO: å¦‚ä½•ä½œç”¨åœ¨postroutingé˜¶æ®µï¼Ÿ</p><h1 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h1><p>æ ¸å¿ƒæ˜¯è·¯ç”±å™¨æ€ä¹ˆåˆ›å»ºNATè¡¨? ä½¿ç”¨iptablesä¹ˆ? æ€ä¹ˆæ“ä½œiptablesèƒ½å®ç°ç›¸åŒåŠŸèƒ½? </p><h1 id="å®è·µ-amp-éªŒè¯"><a href="#å®è·µ-amp-éªŒè¯" class="headerlink" title="å®è·µ&amp;éªŒè¯"></a>å®è·µ&amp;éªŒè¯</h1><p>&#x2F;&#x2F; TODO: </p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul><li><a href="https://blog.k8s.li/linux-net-and-iptables.html#%E5%85%B3%E7%B3%BB">Linux ç½‘ç»œå’Œ iptables è¿è¡ŒåŸç†</a></li></ul><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>æœ€è¿‘ç ”ç©¶å…³äºç½‘ç»œ, æœ‰ä¸€å †çš„æ¦‚å¿µ, ä¸€å †çš„å‘è¦å¡«, è¿™é‡Œå…ˆåˆ—å‡ºæ¥: </p><ul><li>å‡ å¼ è¡¨, ä½œç”¨æ˜¯å•¥? åˆ†åˆ«å¦‚ä½•æŸ¥çœ‹è¡¨é¡¹? <ul><li>camè¡¨</li><li>arpç¼“å­˜è¡¨</li><li>natè¡¨</li><li>dnsç¼“å­˜è¡¨</li></ul></li><li>å‡ ç§è®¾å¤‡: <ul><li>ä¸‰å±‚äº¤æ¢æœºä¸äºŒå±‚äº¤æ¢æœºåŒºåˆ«?</li><li>Linuxç½‘æ¡¥ä¸äº¤æ¢æœºæœ‰å•¥åŒºåˆ«?</li></ul></li><li>å‡ ä¸ªæŠ€æœ¯ç»†èŠ‚<ul><li>ç½‘å¡æ··æ‚æ¨¡å¼? å•¥æ—¶å€™ä¸‹å¼€å¯? åº”ç”¨åœºæ™¯æ˜¯å•¥?</li><li>ä¼šä¸ä¼šæ”¶åˆ°MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸åŒ¹é…çš„IPåŒ…? å…·ä½“å’‹å¤„ç†? ç›´æ¥ä¸¢å¼ƒ? è¿˜æ˜¯å¯ä»¥ä½¿ç”¨? </li><li>ip forwarding æ˜¯å•¥? ä¸ºå•¥NATæ¨¡å¼ä¸‹éœ€è¦å¼€å¯? ä¸ºå•¥ä¸é»˜è®¤å¼€å¯? </li><li>ipéš§é“çš„åŸç†æ˜¯å•¥? </li><li>lvsçš„å‡ ç§å·¥ä½œåŸç†å†ç ”ç©¶, å†å®è·µéªŒè¯</li><li>ç»„æ’­çš„åº”ç”¨åœºæ™¯æ˜¯å•¥? å¾ˆé‡è¦ä¹ˆ?</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;ç»å¸¸åœ¨å®¶ç”¨è·¯ç”±å™¨ä¸­, çœ‹åˆ°æœ‰ç«¯å£æ˜ å°„(PAT)é€‰é¡¹, ä½†ä¸æ˜æ‰€ä»¥.&lt;br&gt;æœ€è¿‘åˆšå¥½åœ¨ç ”ç©¶NAT, çŸ¥é“äº†&lt;mark&gt;PATæœ¬è´¨æ˜¯NATçš„ä¸€ç§å®ç°æ–¹å¼, æ›´ç¡®åˆ‡åœ°è¯´æ˜¯DNATçš„ä¸€ç§å®ç°æ–¹å¼&lt;/mark&gt;.&lt;br&gt;å› æ­¤å€Ÿæ­¤æœºä¼šå¥½å¥½ç ”ç©¶ä¸‹.&lt;/p&gt;
&lt;h1 id=&quot;DNATæ€»ç»“&quot;&gt;&lt;a href=&quot;#DNATæ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;DNATæ€»ç»“&quot;&gt;&lt;/a&gt;DNATæ€»ç»“&lt;/h1&gt;&lt;h2 id=&quot;PATä½œç”¨æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#PATä½œç”¨æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;PATä½œç”¨æ¦‚è¿°&quot;&gt;&lt;/a&gt;PATä½œç”¨æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;å®¶ç”¨è·¯ç”±å™¨ä¸­é…ç½®PAT, æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§&lt;code&gt;å†…ç½‘ç©¿é€&lt;/code&gt;çš„å®ç°æ–¹å¼ï¼Œæˆ–è€…DNATçš„ä¸€ç§æ–¹å¼ã€‚&lt;br&gt;å³éœ€è¦æŠŠå®¶é‡Œå†…ç½‘æŸå°ä¸»æœºçš„æŸä¸ªæœåŠ¡, æš´éœ²åˆ°å…¬ç½‘ä¸Š, ä»¥ä¾¿èƒ½åœ¨å…¬ç½‘ç¯å¢ƒä¸‹è®¿é—®è¯¥æœåŠ¡.&lt;br&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¶åº­å†…ç½‘ç½‘æ®µæ˜¯&lt;code&gt;192.168.3.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å®¶ç”¨è·¯ç”±å™¨, ç”µä¿¡è¿è¥å•†åˆ†é…çš„å¯¹å¤–å…¬ç½‘IPæ˜¯&lt;code&gt;115.192.71.187&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æŸå°ä¸»æœºIPæ˜¯&lt;code&gt;192.168.3.213&lt;/code&gt;: &lt;ul&gt;
&lt;li&gt;æš´éœ²äº†8080çš„æŸä¸ªtomcatæœåŠ¡, æƒ³è¦æŠŠè¿™ä¸ªæœåŠ¡æš´éœ²åœ¨å…¬ç½‘ä¸Š, ä»¥ä¾¿å…¶ä»–äººèƒ½å¤Ÿè®¿é—®.&lt;/li&gt;
&lt;li&gt;æš´éœ²äº†è¿œç¨‹æ¡Œé¢RDPç«¯å£æœåŠ¡, ä»¥ä¾¿åœ¨å…¬å¸æˆ–è€…å’–å•¡å…, èƒ½è®¿é—®åˆ°è¯¥è¿œç¨‹æ¡Œé¢.&lt;/li&gt;
&lt;li&gt;ç­‰ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶å¯ä»¥åœ¨è·¯ç”±å™¨ä¸Šå¼€å¯ç«¯å£æ˜ å°„(PAT), å°†è·¯ç”±å™¨ä¸ŠæŸä¸ªç«¯å£(å¦‚8888)ä¸å†…ç½‘ä¸»æœºçš„ç«¯å£(å¦‚8080)å¦‚è¿›è¡Œæ˜ å°„, æ‰€æœ‰è®¿é—®{è·¯ç”±å™¨IP, 8888ç«¯å£}çš„è¯·æ±‚, å°±ä¼šè¢«è‡ªåŠ¨è·¯ç”±åˆ°{å†…ç½‘IP, 8080ç«¯å£}ä¸Š:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&quot;https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206232339615.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x2F;&amp;#x2F; TODO: è¿™é‡ŒæŒ–ä¸ªå‘, å†…ç½‘ç©¿é€é™¤äº†PATå¤–, è¿˜æœ‰å…¶ä»–æ–¹æ¡ˆ, ä¾‹å¦‚ &lt;code&gt;èŠ±ç”Ÿå£³&lt;/code&gt;, åè¾¹æ–°å¼€ç¯‡ç« è®²ä¸‹åŸç†.&lt;/p&gt;
&lt;h2 id=&quot;åŸç†æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#åŸç†æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;åŸç†æ¦‚è¿°&quot;&gt;&lt;/a&gt;åŸç†æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;æœ¬è´¨ä¸Šæ˜¯å®¶ç”¨è·¯ç”±å™¨ä¿å­˜äº†è¿™ä¹ˆä¸€å¼ NATè¡¨:&lt;br&gt;&lt;code&gt;&amp;#123;publicIp, publicPort&amp;#125;&lt;/code&gt; â€”æ˜ å°„åˆ°â€”&amp;gt; &lt;code&gt;&amp;#123;localIp, localPort&amp;#125;&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="linux" scheme="https://davyjones2010.github.io/tags/linux/"/>
    
    <category term="iaas" scheme="https://davyjones2010.github.io/tags/iaas/"/>
    
    <category term="network" scheme="https://davyjones2010.github.io/tags/network/"/>
    
    <category term="cloud-computing" scheme="https://davyjones2010.github.io/tags/cloud-computing/"/>
    
    <category term="nat" scheme="https://davyjones2010.github.io/tags/nat/"/>
    
    <category term="pat" scheme="https://davyjones2010.github.io/tags/pat/"/>
    
  </entry>
  
</feed>
