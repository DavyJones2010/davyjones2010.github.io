<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2021 å¹´åº¦ä¹¦å•</title>
    <url>//2020-12-31-booklist-for-2021/</url>
    <content><![CDATA[<ul>
<li>&lt;å‘¼å…°æ²³ä¼ &gt; -done</li>
<li>&lt;ç‚¸è£‚å¿—&gt; -done</li>
<li>&lt;æˆ‘ä»¬å°æ¹¾è¿™äº›å¹´&gt; -done</li>
<li>&lt;è¡Œä¸ºç»æµå­¦&gt; -done</li>
<li>é‡æ¸© &lt;ä¸‰ä½“&gt; -done</li>
<li>&lt;çº¢æ˜Ÿç…§è€€ä¸­å›½&gt; -done</li>
<li>2021å¹´8æœˆ: é‡æ¸© &lt;è‹±é›„å¿—&gt; -done</li>
<li>2021å¹´10æœˆ: &lt;ç©¿è¶ŠåœŸæ˜Ÿç¯&gt; -done</li>
<li>2021å¹´11æœˆ: &lt;æ²™ä¸˜1&gt; &lt;æ²™ä¸˜2&gt; -done</li>
<li>é¸Ÿå“¥çš„Linuxç§æˆ¿èœ-åŸºç¡€ç¯‡ ç¬¬å››ç‰ˆ -done</li>
<li>&lt;SREï¼šGoogleè¿ç»´è§£å¯†&gt;</li>
<li>&lt;å›¾è§£å¯†ç æŠ€æœ¯&gt;</li>
<li>&lt;ç¨‹åºå‘˜å¿…å¤‡çš„æ€ç»´èƒ½åŠ›&gt;</li>
<li>&lt;å…¨å½©å›¾è¯´æ—¶é—´ç®€å²&gt; -20211210 done</li>
<li>&lt;k8sæƒå¨æŒ‡å—&gt; -done</li>
<li>&lt;é‡‘ç“¶æ¢…&gt; -æ— æ³•æ¬£èµ, æ— æ³•ç†è§£, å¼ƒå‘</li>
<li>&lt;æ˜æœé‚£äº›äº‹å„¿-1&gt; ~ &lt;æ˜æœé‚£äº›äº‹å„¿-4&gt; -done</li>
<li>&lt;ä¸ƒå‘¨ä¸ƒå¹¶å‘æ¨¡å‹&gt; ç¬¬ä¸€åˆ°ç¬¬ä¸‰ç« </li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>ä¹¦å•</category>
      </categories>
      <tags>
        <tag>books</tag>
        <tag>2021</tag>
      </tags>
  </entry>
  <entry>
    <title>golangå…¥é—¨ç¬”è®°ä¹‹åŸºç¡€è¯­æ³•</title>
    <url>//2021-08-31-golang-basic/</url>
    <content><![CDATA[<h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><p>å±€éƒ¨å˜é‡å•çº¯åœ°ç»™ a èµ‹å€¼ä¹Ÿæ˜¯ä¸å¤Ÿçš„ï¼Œè¿™ä¸ªå€¼å¿…é¡»è¢«ä½¿ç”¨, å¦åˆ™ä¼šç¼–è¯‘é”™è¯¯<br>å…¨å±€å˜é‡æ˜¯å…è®¸å£°æ˜ä½†ä¸ä½¿ç”¨</p>
<hr>
<h1 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h1><hr>
<h1 id="äº¤å‰ç¼–è¯‘"><a href="#äº¤å‰ç¼–è¯‘" class="headerlink" title="äº¤å‰ç¼–è¯‘"></a>äº¤å‰ç¼–è¯‘</h1><p>ç›®æ ‡æ˜¯linux64<br>GOOS&#x3D;linux GOARCH&#x3D;amd64 go build -o app.linux<br>ç›®æ ‡æ˜¯win64<br>GOOS&#x3D;windows GOARCH&#x3D;amd64 go build</p>
<hr>
<p>ç±»å‹çš„åˆ«å&amp;å®šä¹‰<br>&#x2F;&#x2F; å°†NewIntå®šä¹‰ä¸ºintç±»å‹<br>type NewInt int<br>&#x2F;&#x2F; å°†intå–ä¸€ä¸ªåˆ«åå«IntAlias<br>type IntAlias &#x3D; int</p>
<p>â€“ å£°æ˜æ•°ç»„<br>intArray :&#x3D; []int{1, 2, 3, 4}</p>
<p>æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œå› ä¸ºæ•°ç»„çš„é•¿åº¦éœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šã€‚</p>
<p>â€“ makeçš„ä½œç”¨:<br>slice1 :&#x3D; []int{1, 2, 3, 4, 5}<br>slice2 :&#x3D; []int{3, 3, 3}<br>slice3 :&#x3D; make([]int, 3)</p>
<p>copy(slice3, slice2)<br>copy(slice2, slice1)<br>copy(slice1, slice3)<br>fmt.Println(slice2)<br>fmt.Println(slice1)<br>fmt.Println(slice3)</p>
<p>åœ¨å¼•ç”¨æŸä¸ªåŒ…æ—¶ï¼Œå¦‚æœåªæ˜¯å¸Œæœ›æ‰§è¡ŒåŒ…åˆå§‹åŒ–çš„ init å‡½æ•°ï¼Œè€Œä¸ä½¿ç”¨åŒ…å†…éƒ¨çš„æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŒ¿åå¼•ç”¨æ ¼å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>import _ â€œfmtâ€<br>åŒ…åˆå§‹åŒ–çš„ init å‡½æ•°</p>
<hr>
<p>å¦‚ä½•å†™ut?</p>
<p>GOæ˜¯æ²¡æœ‰æ–¹æ³•é‡è½½çš„!<br><a href="https://www.zhihu.com/question/40661108">https://www.zhihu.com/question/40661108</a></p>
<hr>
<p>rune ç±»å‹:<br>&#x2F;&#x2F; rune is an alias for int32 and is equivalent to int32 in all ways. It is<br>&#x2F;&#x2F; used, by convention, to distinguish character values from integer values.<br>&#x2F;&#x2F;int32çš„åˆ«åï¼Œå‡ ä¹åœ¨æ‰€æœ‰æ–¹é¢ç­‰åŒäºint32<br>&#x2F;&#x2F;å®ƒç”¨æ¥åŒºåˆ†å­—ç¬¦å€¼å’Œæ•´æ•°å€¼</p>
<p>type rune &#x3D; int32</p>
<hr>
<p>å…³äº Go è¯­è¨€çš„ç±»ï¼ˆclassï¼‰<br>Go è¯­è¨€ä¸­æ²¡æœ‰â€œç±»â€çš„æ¦‚å¿µï¼Œä¹Ÿä¸æ”¯æŒâ€œç±»â€çš„ç»§æ‰¿ç­‰é¢å‘å¯¹è±¡çš„æ¦‚å¿µã€‚<br>Go è¯­è¨€çš„ç»“æ„ä½“ä¸â€œç±»â€éƒ½æ˜¯å¤åˆç»“æ„ä½“ï¼Œä½† Go è¯­è¨€ä¸­ç»“æ„ä½“çš„å†…åµŒé…åˆæ¥å£æ¯”é¢å‘å¯¹è±¡å…·æœ‰æ›´é«˜çš„æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚<br>Go è¯­è¨€ä¸ä»…è®¤ä¸ºç»“æ„ä½“èƒ½æ‹¥æœ‰æ–¹æ³•ï¼Œä¸”æ¯ç§è‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„æ–¹æ³•ã€‚</p>
<p><a href="http://c.biancheng.net/view/83.html">http://c.biancheng.net/view/83.html</a></p>
<hr>
<p>defer å…³é”®è¯<br>ç±»ä¼¼javaé‡Œçš„finally, ç”¨äºèµ„æºå®‰å…¨åœ°é‡Šæ”¾</p>
<pre class="line-numbers language-none"><code class="language-none">defer func() &#123;
  pc.workqueue.ShutDown()
  pc.deletequeue.ShutDown()
&#125;()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<ul>
<li><p>å¦‚ä½•å¿«é€Ÿèµ‹å€¼?<br>ä¾‹å¦‚: </p>
<pre class="line-numbers language-none"><code class="language-none">flavor, _ :&#x3D; cmd.Flags().GetString(&quot;flavor&quot;)
request.InstanceType &#x3D; flavor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ€ä¹ˆæ ·èƒ½å˜æˆä¸€è¡Œ? </p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; å¦‚ä¸‹æœ‰ç¼–è¯‘é”™è¯¯, æ€ä¹ˆæ¶ˆé™¤ç¼–è¯‘é”™è¯¯? 
request.InstanceType &#x3D; cmd.Flags().GetString(&quot;flavor&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

</li>
<li><p>å¦‚ä½•å¿«é€Ÿç»™ç»“æ„ä½“ä¸­éƒ¨åˆ†fieldèµ‹å€¼?<br>ä¾‹å¦‚: </p>
<pre class="line-numbers language-none"><code class="language-none">request :&#x3D; ecs.CreateRunInstancesRequest()
request.RegionId &#x3D; region
request.ZoneId &#x3D; zone
request.InstanceType &#x3D; flavor
request.InstanceChargeType &#x3D; payType<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ€æ ·æ‰èƒ½å¿«é€Ÿå˜æˆä¾‹å¦‚:</p>
<pre class="line-numbers language-none"><code class="language-none">request &#123;
    RegionId &#x3D; region
    ZoneId &#x3D; zone
    InstanceType &#x3D; flavor
    InstanceChargeType &#x3D; payType
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



</li>
<li></li>
</ul>
<hr>
<h1 id="æ„Ÿæ‚Ÿ-amp-åæ§½"><a href="#æ„Ÿæ‚Ÿ-amp-åæ§½" class="headerlink" title="æ„Ÿæ‚Ÿ&amp;åæ§½"></a>æ„Ÿæ‚Ÿ&amp;åæ§½</h1><ul>
<li>å‡½æ•°å¯ä»¥è¿”å›å¤šå€¼, å¤ªçˆ½å•¦, å¯ä»¥ç”¨åŒ¿åå˜é‡æ¥å±è”½ä¸éœ€è¦çš„å­—æ®µ, èŠ‚çœå†…å­˜</li>
<li>ä¸æ˜¾å¼å£°æ˜ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³», å®ç°å…³ç³», ä»£ç çœ‹èµ·æ¥å›°éš¾å¾ˆå¤š? æœ‰æ²¡æœ‰æ›´ç®€ä¾¿çš„æ–¹å¼?</li>
<li></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>golang-lib</tag>
      </tags>
  </entry>
  <entry>
    <title>k8såŸºç¡€æ¶æ„ç¬”è®°</title>
    <url>//2021-08-31-k8s-architect/</url>
    <content><![CDATA[<h2 id="åŸºç¡€åº”ç”¨ç»„ä»¶"><a href="#åŸºç¡€åº”ç”¨ç»„ä»¶" class="headerlink" title="åŸºç¡€åº”ç”¨ç»„ä»¶"></a>åŸºç¡€åº”ç”¨ç»„ä»¶</h2><ul>
<li>APIServer<ul>
<li>è®¤è¯</li>
<li>é‰´æƒ</li>
<li>å‡†å…¥æ§åˆ¶<ul>
<li>Quota</li>
</ul>
</li>
</ul>
</li>
<li>Scheduler</li>
<li>Kubelet</li>
<li>Etcd</li>
<li>Kube-Controller ManageråŒ…æ‹¬<ul>
<li>ReplicaSet Controller</li>
<li>CDRçš„Controller</li>
<li>AdmissionController </li>
<li>ç­‰</li>
</ul>
</li>
</ul>
<h2 id="èµ„æºåˆ†ä¸ºä¸¤ç±»"><a href="#èµ„æºåˆ†ä¸ºä¸¤ç±»" class="headerlink" title="èµ„æºåˆ†ä¸ºä¸¤ç±»"></a>èµ„æºåˆ†ä¸ºä¸¤ç±»</h2><ul>
<li>Cluster-scoped resources<ul>
<li>å¦‚node</li>
</ul>
</li>
<li>Namespace-scoped resources<ul>
<li>å¦‚pod</li>
</ul>
</li>
</ul>
<h2 id="åŸºç¡€æµç¨‹"><a href="#åŸºç¡€æµç¨‹" class="headerlink" title="åŸºç¡€æµç¨‹"></a>åŸºç¡€æµç¨‹</h2><p><img data-src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/what-happens-when-k8s.svg" alt="åŸºç¡€æµç¨‹"></p>
<h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><ul>
<li>workloads</li>
</ul>
<h2 id="åŸºç¡€ç»„ä»¶"><a href="#åŸºç¡€ç»„ä»¶" class="headerlink" title="åŸºç¡€ç»„ä»¶"></a>åŸºç¡€ç»„ä»¶</h2><ul>
<li>Node</li>
<li>Pod</li>
</ul>
<h2 id="Controlleræ§åˆ¶ç»„ä»¶"><a href="#Controlleræ§åˆ¶ç»„ä»¶" class="headerlink" title="Controlleræ§åˆ¶ç»„ä»¶"></a>Controlleræ§åˆ¶ç»„ä»¶</h2><ul>
<li>ReplicationController(å¼ƒç”¨) â€“&gt; ReplicaSet(ç±»ä¼¼ESS)</li>
<li>Deployment: åç«¯ç”¨ESS, åŒºåˆ«æ˜¯ä»€ä¹ˆ? </li>
<li>DaemonSet: Podç»„, éƒ¨ç½²åœ¨æ¯ä¸ªNodeä¸Š. æ–°åŠ å…¥Node, ä¼šè‡ªåŠ¨æ–°éƒ¨ç½²Pod. ä¸‹çº¿Node, ä¼šè‡ªåŠ¨åˆ é™¤Pod.</li>
<li>StatefulSets: </li>
<li>Job&amp;CronJob:</li>
</ul>
<h2 id="ç¼–æ’ç»„ä»¶"><a href="#ç¼–æ’ç»„ä»¶" class="headerlink" title="ç¼–æ’ç»„ä»¶"></a>ç¼–æ’ç»„ä»¶</h2><ul>
<li>Operator &#x3D; èµ„æº(CRD) + Controller</li>
</ul>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul>
<li>CDR</li>
<li>OAM</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>k8s-architect</tag>
      </tags>
  </entry>
  <entry>
    <title>K8Sè°ƒåº¦å™¨ç ”ç©¶</title>
    <url>//2021-09-03-kube-scheduler/</url>
    <content><![CDATA[<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="å…³äºkube-schedulerçš„èµ„æºè®°è´¦"><a href="#å…³äºkube-schedulerçš„èµ„æºè®°è´¦" class="headerlink" title="å…³äºkube-schedulerçš„èµ„æºè®°è´¦:"></a>å…³äºkube-schedulerçš„èµ„æºè®°è´¦:</h2><h3 id="ä»¥ä¸ºçš„è®°è´¦æµç¨‹"><a href="#ä»¥ä¸ºçš„è®°è´¦æµç¨‹" class="headerlink" title="ä»¥ä¸ºçš„è®°è´¦æµç¨‹:"></a>ä»¥ä¸ºçš„è®°è´¦æµç¨‹:</h3><ul>
<li>ç ”ç©¶kube-schedulerä»£ç , å…³äºnodeInfoé‡Œèµ„æºçš„è®°è´¦, æ€»æ˜¯æœ‰ä¸ªè¯¯è§£, ä»¥ä¸ºä¼šåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†: <ul>
<li>nodeä¸Šå…¨é‡èµ„æº(totalCpu, totalMem)</li>
<li>nodeä¸Šå·²ç»ç¡®å®šå ç”¨çš„èµ„æº(usedCpu, usedMem)</li>
<li>è°ƒåº¦å®Œæˆ, nodeä¸Šå¾…ç»‘å®šçš„èµ„æº(assumedCpu, assumedMem), å®é™…ç»‘å®šæˆåŠŸ&#x2F;å¤±è´¥æœªçŸ¥, åªæ˜¯forè°ƒåº¦ä½¿ç”¨:  <ul>
<li>å½“ç»‘å®šæˆåŠŸ, ä¼šæ”¶åˆ°äº‹ä»¶, å°†assumedCpu&#x2F;Memæ¸…ç†, å¹¶æŠŠassumedCpu&#x2F;Mem æ”¾åˆ°usedCpu&#x2F;usedMemé‡Œ</li>
<li>å½“ç»‘å®šå¤±è´¥, ä¼šæ”¶åˆ°äº‹ä»¶, å°†assumedCpu&#x2F;Memæ¸…ç†, ä¸å åŠ åˆ°usedCpu&#x2F;usedMemé‡Œ.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å®é™…çš„è®°è´¦æµç¨‹å‚ç…§æ–‡ç« -Node-allocatableèµ„æºçš„å«ä¹‰"><a href="#å®é™…çš„è®°è´¦æµç¨‹å‚ç…§æ–‡ç« -Node-allocatableèµ„æºçš„å«ä¹‰" class="headerlink" title="å®é™…çš„è®°è´¦æµç¨‹å‚ç…§æ–‡ç«  Node allocatableèµ„æºçš„å«ä¹‰"></a>å®é™…çš„è®°è´¦æµç¨‹å‚ç…§æ–‡ç«  <a href="https://www.mgasch.com/2017/10/sched-reconcile/">Node allocatableèµ„æºçš„å«ä¹‰</a></h3><ul>
<li>ä½†å®é™…ä¸Škube-scheduler, æŠŠnodeInfoåˆ†ä¸º2éƒ¨åˆ†:<ul>
<li>nodeä¸Šå…¨é‡èµ„æº(NodeInfo.Allocatable), æ³¨æ„ä¹‹å‰ç»å¸¸ä¼šææ··, ä»¥ä¸ºallocatable &#x3D; total - used; å®é™…ä¸Šallocatableä»£è¡¨total. å®é™…å‘ç°å…¶ä»–åŒå­¦ä¹Ÿæœ‰ç†è§£é”™çš„: <a href="https://github.com/kubernetes-sigs/kube-batch/issues/881">Allocatable Resources is calculated wrong</a></li>
<li>nodeä¸Šå·²ç»å ç”¨çš„èµ„æº(NodeInfo.Requested), åŒ…æ‹¬å¦‚ä¸‹2éƒ¨åˆ†: <ul>
<li>nodeä¸Šå·²ç»ç¡®å®šå ç”¨çš„èµ„æº</li>
<li>è°ƒåº¦å®Œæˆ, nodeä¸Šå¾…ç»‘å®šçš„èµ„æº(assumedCpu, assumedMem)</li>
</ul>
</li>
<li>å®é™…çš„å¯¹è´¦è¿‡ç¨‹: <ul>
<li>å½“è°ƒåº¦æˆåŠŸ, bindå‰, ä¼šç›´æ¥æŠŠpod.requestå åŠ åˆ°node.requestedé‡Œ.</li>
<li>bindæˆåŠŸ, (ä¿®æ”¹podçŠ¶æ€), node.requestedä¸å˜</li>
<li>bindå¤±è´¥, 1ç§’ä¸€æ¬¡çš„è½®è¯¢, æ›´æ–°podçŠ¶æ€, å°†podçš„èµ„æºå½’è¿˜å›node.requestedé‡Œ</li>
<li>kube-scheduleré‡å¯: ä¼š</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å¼•å‘çš„é—®é¢˜"><a href="#å¼•å‘çš„é—®é¢˜" class="headerlink" title="å¼•å‘çš„é—®é¢˜"></a>å¼•å‘çš„é—®é¢˜</h3><ul>
<li>kube-scheduleré‡å¯, ä¼šæ‰§è¡Œä¸€æ¬¡fullsync, cacheåŒæ­¥æ›´æ–°é‡ä¼šå¾ˆå¤§, è€—æ—¶å¯èƒ½ä¼šæ¯”è¾ƒä¹…, è¿™ä¸­é—´scheduleræ˜¯ä¸æä¾›æœåŠ¡çš„</li>
<li>å¦‚æœå¤šä¸ªscheduleråŒæ—¶å·¥ä½œ, ç”±äºä¸å…±äº«requestedResource, å¹¶å‘åœºæ™¯ä¸‹, å¯¼è‡´èµ„æºè¶…å–:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071215437.png"><ul>
<li>å½“å‰è§£å†³æ–¹æ¡ˆ:</li>
</ul>
</li>
</ul>
<h3 id="å¦‚ä½•æ”¹è¿›-x2F-ä½¿ç”¨å¤šä¸ªscheduler"><a href="#å¦‚ä½•æ”¹è¿›-x2F-ä½¿ç”¨å¤šä¸ªscheduler" class="headerlink" title="å¦‚ä½•æ”¹è¿›&#x2F;ä½¿ç”¨å¤šä¸ªscheduler"></a>å¦‚ä½•æ”¹è¿›&#x2F;ä½¿ç”¨å¤šä¸ªscheduler</h3><p>HOSSæ–¹æ¡ˆ: </p>
<h4 id="Part1-Job-dispatch"><a href="#Part1-Job-dispatch" class="headerlink" title="Part1: Job dispatch:"></a>Part1: Job dispatch:</h4><ol>
<li>instanceLevel load balancing: é˜²æ­¢æŸäº›scheduleréå¸¸ç¹å¿™, æŸäº›scheduleréå¸¸ç©ºé—².</li>
<li>dynamic scheduling policy: åŸºäºschedulerçš„æ ‡ç­¾, è¿›è¡Œè°ƒåº¦</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071215523.png"><br>æ–¹æ¡ˆæ€»ç»“: å³æ–°å¢scheduler-controlleræ¨¡å—, å¯¹å¤šä¸ªschedulerè¿›è¡Œè¿›ä¸€æ­¥è°ƒåº¦</p>
<h4 id="Part2-Conflict-resolution"><a href="#Part2-Conflict-resolution" class="headerlink" title="Part2: Conflict resolution:"></a>Part2: Conflict resolution:</h4><ol>
<li><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071216225.png"><br>æ–¹æ¡ˆæ€»ç»“: å³åœ¨api-serverå¢åŠ conflict-resolveræ¨¡å—, è¯†åˆ«bindingçš„request, è¿›è¡Œå†²çªæ ¡éªŒ, è¿›è¡Œfailfast.</li>
</ol>
<h4 id="HOSSä¸kube-schedulerçš„å¯¹æ¯”"><a href="#HOSSä¸kube-schedulerçš„å¯¹æ¯”" class="headerlink" title="HOSSä¸kube-schedulerçš„å¯¹æ¯”"></a>HOSSä¸kube-schedulerçš„å¯¹æ¯”</h4><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071216726.png"></p>
<h2 id="å…³äºk8sä¸­å¤§é¡µå†…å­˜èµ„æºç®¡ç†"><a href="#å…³äºk8sä¸­å¤§é¡µå†…å­˜èµ„æºç®¡ç†" class="headerlink" title="å…³äºk8sä¸­å¤§é¡µå†…å­˜èµ„æºç®¡ç†"></a>å…³äºk8sä¸­å¤§é¡µå†…å­˜èµ„æºç®¡ç†</h2><h3 id="é™åˆ¶æ¡ä»¶"><a href="#é™åˆ¶æ¡ä»¶" class="headerlink" title="é™åˆ¶æ¡ä»¶:"></a>é™åˆ¶æ¡ä»¶:</h3><ul>
<li>Nodes must pre-allocate huge pages in order for the node to report its huge page capacity. </li>
<li>A node can only pre-allocate huge pages for a single size.</li>
<li>Unlike CPU or memory, huge pages do not support over-commitment. (æ™®é€šk8sçš„memoryæ˜¯å¦‚ä½•over-commitçš„?)</li>
</ul>
<h3 id="å¦‚ä½•åœ¨nodeä¸Šå¼€å¯-amp-åˆ†é…å¤§é¡µå†…å­˜-å¹¶ä¸ŠæŠ¥åˆ°apiserver"><a href="#å¦‚ä½•åœ¨nodeä¸Šå¼€å¯-amp-åˆ†é…å¤§é¡µå†…å­˜-å¹¶ä¸ŠæŠ¥åˆ°apiserver" class="headerlink" title="å¦‚ä½•åœ¨nodeä¸Šå¼€å¯&amp;åˆ†é…å¤§é¡µå†…å­˜(å¹¶ä¸ŠæŠ¥åˆ°apiserver?)"></a>å¦‚ä½•åœ¨nodeä¸Šå¼€å¯&amp;åˆ†é…å¤§é¡µå†…å­˜(å¹¶ä¸ŠæŠ¥åˆ°apiserver?)</h3><ul>
<li>k8sä¸­, nodeä¸Šéœ€è¦å®ç°å®šä¹‰&amp;åˆ†é…å¥½å¤§é¡µå†…å­˜, å¦‚ä¸‹, æ³¨æ„ä¸‹è¾¹<code>bootloader</code>éƒ¨åˆ†: </li>
<li>åŒæ—¶è¦æ³¨æ„, å¯ä»¥åœ¨nodeè¿è¡Œæ—¶åˆ†é…å¤§é¡µå†…å­˜, ä¹Ÿå¯ä»¥åœ¨node bootæ—¶åˆ†é…. ä½†æœ€å¥½åœ¨bootæ—¶åˆ†é…, å› ä¸ºè¿è¡Œæ—¶å¯èƒ½ç”±äºå†…å­˜ç¢ç‰‡, æ— æ³•åˆ†é…å‡ºå¯¹åº”æ•°é‡çš„å¤§é¡µå†…å­˜.</li>
<li>å¦‚ä¸‹ä¾‹å­, åˆ†é…2Mçš„å¤§é¡µå†…å­˜, æ•°é‡æ˜¯50ä¸ª</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> tuned.openshift.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Tuned
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hugepages
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> openshift<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>node<span class="token punctuation">-</span>tuning<span class="token punctuation">-</span>operator
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">profile</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        [main]
        summary=Boot time configuration for hugepages
        include=openshift-node
        [bootloader]
        cmdline_openshift_node_hugepages=hugepagesz=2M hugepages=50 </span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> openshift<span class="token punctuation">-</span>node<span class="token punctuation">-</span>hugepages

  <span class="token key atrule">recommend</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">machineConfigLabels</span><span class="token punctuation">:</span>
        <span class="token key atrule">machineconfiguration.openshift.io/role</span><span class="token punctuation">:</span> <span class="token string">"worker-hp"</span>
      <span class="token key atrule">priority</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">profile</span><span class="token punctuation">:</span> openshift<span class="token punctuation">-</span>node<span class="token punctuation">-</span>hugepages<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å¦‚ä½•åœ¨podåˆ›å»ºæ—¶å£°æ˜ä½¿ç”¨å¤§é¡µå†…å­˜"><a href="#å¦‚ä½•åœ¨podåˆ›å»ºæ—¶å£°æ˜ä½¿ç”¨å¤§é¡µå†…å­˜" class="headerlink" title="å¦‚ä½•åœ¨podåˆ›å»ºæ—¶å£°æ˜ä½¿ç”¨å¤§é¡µå†…å­˜?"></a>å¦‚ä½•åœ¨podåˆ›å»ºæ—¶å£°æ˜ä½¿ç”¨å¤§é¡µå†…å­˜?</h3><p>k8sä¸­, podä½¿ç”¨æ˜¯é€šè¿‡volumesæ¥è¿›è¡Œå¤§é¡µå†…å­˜çš„Requests, å¦‚ä¸‹(ä¸‹è¾¹çš„æ˜¯å•ä¸ªnodeæ”¯æŒå¤šç§å¤§å°çš„å¤§é¡µå†…å­˜, ä½†å®é™…ä¸€èˆ¬ä¸€ä¸ªnodeåªä¼šæ”¯æŒä¸€ç§å¤§é¡µå†…å­˜å¤§å°): </p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> huge<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>example
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> example
    <span class="token key atrule">image</span><span class="token punctuation">:</span> fedora<span class="token punctuation">:</span>latest
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> sleep
    <span class="token punctuation">-</span> inf
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /hugepages<span class="token punctuation">-</span>2Mi
      <span class="token key atrule">name</span><span class="token punctuation">:</span> hugepage<span class="token punctuation">-</span>2mi
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /hugepages<span class="token punctuation">-</span>1Gi
      <span class="token key atrule">name</span><span class="token punctuation">:</span> hugepage<span class="token punctuation">-</span>1gi
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">limits</span><span class="token punctuation">:</span>
        <span class="token key atrule">hugepages-2Mi</span><span class="token punctuation">:</span> 100Mi
        <span class="token key atrule">hugepages-1Gi</span><span class="token punctuation">:</span> 2Gi
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> 100Mi
      <span class="token key atrule">requests</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> 100Mi
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> hugepage<span class="token punctuation">-</span>2mi
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span>
      <span class="token key atrule">medium</span><span class="token punctuation">:</span> HugePages<span class="token punctuation">-</span>2Mi
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> hugepage<span class="token punctuation">-</span>1gi
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span>
      <span class="token key atrule">medium</span><span class="token punctuation">:</span> HugePages<span class="token punctuation">-</span>1Gi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="podå®é™…æ˜¯å¦‚ä½•ä½¿ç”¨å¤§é¡µå†…å­˜çš„"><a href="#podå®é™…æ˜¯å¦‚ä½•ä½¿ç”¨å¤§é¡µå†…å­˜çš„" class="headerlink" title="podå®é™…æ˜¯å¦‚ä½•ä½¿ç”¨å¤§é¡µå†…å­˜çš„?"></a>podå®é™…æ˜¯å¦‚ä½•ä½¿ç”¨å¤§é¡µå†…å­˜çš„?</h3><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.mgasch.com/2017/10/sched-reconcile/">Node allocatableèµ„æºçš„å«ä¹‰</a></li>
<li><a href="https://www.youtube.com/watch?v=avORKrcyctM">Running Multiple Schedulers in Kubernetes by Xiaoning Ding, Huawei</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.5/html/scalability_and_performance/what-huge-pages-do-and-how-they-are-consumed">k8så¤§é¡µå†…å­˜åˆ†é…&amp;ä½¿ç”¨</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/performance_tuning_guide/sect-red_hat_enterprise_linux-performance_tuning_guide-configuring_transparent_huge_pages">linuxä¸Šå¦‚ä½•åˆ†é…å¤§é¡µå†…å­˜</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>scheduler</tag>
      </tags>
  </entry>
  <entry>
    <title>Jekyllæ­å»ºåšå®¢æ€»ç»“</title>
    <url>//2021-09-05-jekyll-site/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç»ˆäºä¸‹å®šå†³å¿ƒï¼ŒèŠ±ä¸€äº›äº‹ä»¶ï¼ŒæŠŠè‡ªå·±æ²‰æ·€ä¸æ€è€ƒï¼Œéƒ½ç”¨GitHubPagesä¿å­˜èµ·æ¥ã€‚</p>
<ul>
<li>ä¸€æ¥ï¼Œä½œä¸ºè‡ªå·±å¤‡å¿˜ï¼Œå¦‚æ­¤ä¹‹å¤šçš„çŸ¥è¯†ï¼Œå¦‚æœä¸åŠ ä»¥æ¢³ç†ï¼Œåœ¨è„‘æµ·é‡Œå§‹ç»ˆå°±æ˜¯åˆ†æ•£çš„ç‚¹ã€‚</li>
<li>äºŒæ¥ï¼Œæœ‰å¹¸åŒé“ä¸­äººçœ‹åˆ°ï¼ŒåŠ ä»¥æŒ‡æ­£ä¸è®¨è®ºï¼Œæ›´æ˜¯å¦™å“‰ï¼</li>
</ul>
<hr>
<h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><ul>
<li><p>å¯åŠ¨æœ¬åœ°æœåŠ¡</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bundle <span class="token builtin class-name">exec</span> jekyll serve --draft<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>ç¼–è¯‘ï¼Œç”Ÿæˆ_siteç›®å½•</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bundle <span class="token builtin class-name">exec</span> jekyll build<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>åœ¨Gemfileä¸­å¢åŠ äº†æ’ä»¶ä¹‹åï¼Œå®‰è£…æ’ä»¶</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bundle <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<hr>
<h1 id="ä½¿ç”¨çš„æ’ä»¶"><a href="#ä½¿ç”¨çš„æ’ä»¶" class="headerlink" title="ä½¿ç”¨çš„æ’ä»¶"></a>ä½¿ç”¨çš„æ’ä»¶</h1><ul>
<li><a href="https://beautifuljekyll.com/">Beautiful Jekyll</a>: beautiful-jekyllä¸»é¢˜</li>
<li><a href="https://github.com/allejo/jekyll-toc">jekyll-toc</a>ï¼šæ–¹ä¾¿å¢åŠ tocï¼Œè™½ç„¶æœ‰ç‚¹ä¸‘</li>
<li><a href="https://github.com/allejo/jekyll-anchor-headings">jekyll-anchor-headings</a>ï¼šæ–¹ä¾¿ç»™æ ‡é¢˜å¢åŠ anchoré“¾æ¥ï¼Œè™½ç„¶ä¹Ÿæœ‰ç‚¹ä¸‘ï¼ŒğŸ˜…</li>
<li><a href="http://www.fontawesome.com.cn/icons/list/">font-awesome</a>: æ— é¡»é‡æ–°å®‰è£…ï¼Œ é»˜è®¤beautiful-jekyllé‡ŒåŒ…å«äº†</li>
<li><a href="https://www.netlifycms.org/docs/add-to-your-site/#enable-identity-and-git-gateway">netlifycms</a>ï¼šä½¿ç”¨è¿™ä¸ªCMSç³»ç»Ÿï¼Œç›´æ¥åœ¨ç½‘é¡µå†™blogå¹¶å‘å¸ƒåˆ°gh-pagesé‡Œ</li>
</ul>
<hr>
<h1 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h1><h2 id="æ—¶åŒºé—®é¢˜å¯¼è‡´æ–‡ç« ä¸å¯è§"><a href="#æ—¶åŒºé—®é¢˜å¯¼è‡´æ–‡ç« ä¸å¯è§" class="headerlink" title="æ—¶åŒºé—®é¢˜å¯¼è‡´æ–‡ç« ä¸å¯è§"></a>æ—¶åŒºé—®é¢˜å¯¼è‡´æ–‡ç« ä¸å¯è§</h2><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>æ–°çš„åšå®¢æ–‡ç« å†™å¥½äº†ï¼Œå¹¶ä¸”çœ‹æ—¥å¿—ä¹Ÿè‡ªåŠ¨ç”Ÿæˆäº†ï¼Œä½†ï¼š</p>
<ol>
<li>åœ¨_siteç›®å½•ä¸‹çœ‹ä¸åˆ°ç”Ÿæˆçš„æ–‡ä»¶</li>
<li>æœ¬åœ°è°ƒè¯•ä¹Ÿçœ‹ä¸åˆ°æ–°å¢çš„æ–‡ä»¶</li>
<li>å¾€githubä¸Špushä¹‹åï¼Œè¿œç¨‹ç«™ç‚¹æ‰“å¼€å°±å¯ä»¥çœ‹åˆ°ã€‚</li>
</ol>
<p>ç›¸å…³æ—¥å¿—å¦‚ä¸‹ï¼Œæ€€ç–‘æ˜¯ç”±äºæ—¶é—´æˆ³çš„é—®é¢˜ã€‚å› ä¸ºPostçš„æ—¶é—´æˆ³æ˜¯2021-09-05ï¼Œä¸”æœ¬æœºå½“å‰æ—¶é—´ä¹Ÿæ˜¯2021-09-05ï¼Œä½†çœ‹å¦‚ä¸‹æœ¬åœ°æœåŠ¡å™¨å¯åŠ¨çš„æ—¶é—´æˆ³ï¼Œåº”è¯¥æ˜¯UTC+0çš„æ—¶åŒºï¼Œ<br>è¿˜æ˜¯åœ¨2021-09-04ã€‚Jekyllåº”è¯¥æœ‰è¿™ç§æ½œè§„åˆ™æˆ–è€…é™åˆ¶ï¼Œ<mark><font color=red>å¤§äºå½“å‰æ—¥æœŸçš„Posté»˜è®¤ä¸æ˜¾ç¤º</font></mark>ã€‚<br><img data-src="/../assets/img/site-generate-error.png" alt="site-generate-error.png"></p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚ä¸‹å›¾ï¼Œä¿®æ”¹<code>_config.yaml</code>æ–‡ä»¶ä¸­<code>timezone</code>é…ç½®å³å¯ï¼Œä¿®æ”¹æˆ<code>Asia/Shanghai</code><br><img data-src="/../assets/img/2021-09-05-jekyll-site-timezone-config-yaml.png" alt="2021-09-05-jekyll-site-timezone-config-yaml.png"></p>
<hr>
<h1 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h1><h2 id="åŒä¸€å¤©çš„æ–‡ç« ï¼Œå¦‚ä½•è¿›è¡Œå…ˆåæ’åºï¼Ÿ"><a href="#åŒä¸€å¤©çš„æ–‡ç« ï¼Œå¦‚ä½•è¿›è¡Œå…ˆåæ’åºï¼Ÿ" class="headerlink" title="åŒä¸€å¤©çš„æ–‡ç« ï¼Œå¦‚ä½•è¿›è¡Œå…ˆåæ’åºï¼Ÿ"></a>åŒä¸€å¤©çš„æ–‡ç« ï¼Œå¦‚ä½•è¿›è¡Œå…ˆåæ’åºï¼Ÿ</h2><hr>
<ul>
<li>ä½¿ç”¨front-matteré‡Œçš„dateå°±å¯ä»¥ï¼Œdateå¯ä»¥å…·ä½“åˆ°æ—¶ã€åˆ†ã€ç§’ã€‚ç²¾ç¡®åˆ°æ—¶åˆ†ç§’ï¼Œä¼šè‡ªåŠ¨æŒ‰ç…§æ—¶åˆ†ç§’æ’åºã€‚</li>
</ul>
<h2 id="å¦‚ä½•æŠŠåšå®¢è¿›è¡ŒArchiveï¼Ÿ"><a href="#å¦‚ä½•æŠŠåšå®¢è¿›è¡ŒArchiveï¼Ÿ" class="headerlink" title="å¦‚ä½•æŠŠåšå®¢è¿›è¡ŒArchiveï¼Ÿ"></a>å¦‚ä½•æŠŠåšå®¢è¿›è¡ŒArchiveï¼Ÿ</h2><hr>
<ul>
<li>å‚è§ï¼š <a href="https://stackoverflow.com/questions/18669143/how-to-group-posts-by-date-on-home-page-in-jekyll">How to group posts by date on home page in Jekyll?</a></li>
<li>æ—¥æœŸæ ¼å¼è¦ä¿®æ”¹ä¸‹ï¼Œæ—¥æœŸæ ¼å¼å‚è§ <a href="https://learn.cloudcannon.com/jekyll/date-formatting/">Date formatting</a>ï¼ŒæŒ‰ç…§æˆ‘ä¸ªäººä¹ æƒ¯ï¼Œä¿®æ”¹æˆï¼š<code>&#39;%Y-%m-%d&#39;</code></li>
</ul>
<h2 id="å¦‚ä½•æŠŠåšå®¢è¿›è¡Œä¸€çº§æ ‡é¢˜åˆ†ç±»ï¼Ÿ"><a href="#å¦‚ä½•æŠŠåšå®¢è¿›è¡Œä¸€çº§æ ‡é¢˜åˆ†ç±»ï¼Ÿ" class="headerlink" title="å¦‚ä½•æŠŠåšå®¢è¿›è¡Œä¸€çº§æ ‡é¢˜åˆ†ç±»ï¼Ÿ"></a>å¦‚ä½•æŠŠåšå®¢è¿›è¡Œä¸€çº§æ ‡é¢˜åˆ†ç±»ï¼Ÿ</h2><hr>
<h2 id="å¦‚ä½•ä¸ºanchorå¢åŠ å¯ç‚¹å‡»é“¾æ¥ï¼Ÿ"><a href="#å¦‚ä½•ä¸ºanchorå¢åŠ å¯ç‚¹å‡»é“¾æ¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¸ºanchorå¢åŠ å¯ç‚¹å‡»é“¾æ¥ï¼Ÿ"></a>å¦‚ä½•ä¸ºanchorå¢åŠ å¯ç‚¹å‡»é“¾æ¥ï¼Ÿ</h2><ul>
<li>ä½¿ç”¨ <a href="https://github.com/allejo/jekyll-anchor-headings">jekyll-anchor-headings</a> æ’ä»¶</li>
</ul>
<hr>
<h2 id="å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆfront-matterçš„dateï¼Ÿ"><a href="#å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆfront-matterçš„dateï¼Ÿ" class="headerlink" title="å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆfront-matterçš„dateï¼Ÿ"></a>å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆfront-matterçš„dateï¼Ÿ</h2><hr>
<h1 id="ä¸€äº›é…·ç‚«ä¼˜ç§€çš„ç½‘ç«™"><a href="#ä¸€äº›é…·ç‚«ä¼˜ç§€çš„ç½‘ç«™" class="headerlink" title="ä¸€äº›é…·ç‚«ä¼˜ç§€çš„ç½‘ç«™"></a>ä¸€äº›é…·ç‚«ä¼˜ç§€çš„ç½‘ç«™</h1><p><i class="fas fa-code"> <a href="https://lei1025.github.io/posts/">lei1025</a></i><br><i class="fas fa-code"> <a href="https://longqian.me/2017/02/12/jekyll-support-chinese/">https://longqian.me/2017/02/12/jekyll-support-chinese/</a> </i></p>
<hr>
<h1 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h1><ul>
<li>ç”ŸæˆTOCï¼ŒèŠ±å¤ªå¤šåŠŸå¤«äº†ï¼Œå¹¶ä¸”å³ä½¿åšå‡ºæ¥ï¼Œä¹Ÿä¸‘å‡ºå¤©é™…ï¼Œç¾¡æ…•åˆ«äººè¿™ç§æµ®åŠ¨çš„ï¼Œåç»­ç»è¿‡è°ƒç ”å‘ç°ï¼Œjekyllæ”¯æŒbootstrapï¼Œä½¿ç”¨bootstrapçš„é»˜è®¤å°±å¥½ã€‚</li>
<li>æ’å…¥å›¾ç‰‡ä¹Ÿä¸å¤ªæ–¹ä¾¿äº†ã€‚èƒ½è‡ªåŠ¨æŠŠå›¾ç‰‡æ”¾åœ¨å•ç‹¬folderä¸­ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡çš„idè¯¥å¤šå¥½</li>
<li>ä¸­æ–‡å­—ä½“å¤ªä¸‘äº†ï¼Œå¤§å°ä¹Ÿä¸åˆé€‚ï¼Œæ‰¾æ—¶é—´ä¿®æ”¹ä¸‹å­—ä½“ã€‚</li>
</ul>
<p>æ…¢æ…¢æ¥å§ï¼Œä¸€ç‚¹ç‚¹å»ºè®¾èµ·æ¥ã€‚</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>jekyll</tag>
      </tags>
  </entry>
  <entry>
    <title>æ˜æœé‚£äº›äº‹å„¿</title>
    <url>//2021-09-04-ming-dynasty/</url>
    <content><![CDATA[<h1 id="ç‰›äºº"><a href="#ç‰›äºº" class="headerlink" title="ç‰›äºº"></a>ç‰›äºº</h1><h2 id="ç‹å®ˆä»"><a href="#ç‹å®ˆä»" class="headerlink" title="ç‹å®ˆä»"></a>ç‹å®ˆä»</h2><blockquote>
<p>èº«åœ¨å¤œéƒå®¶ä¸‡é‡Œï¼Œäº”äº‘å¤©åŒ—æ˜¯ç¥å·ï¼</p>
<p>å¤©åœ°åœ£è´¤ä¹‹é“ï¼Œå¹¶éå­˜äºä¸‡ç‰©ï¼Œä¹Ÿæ— é¡»å­˜äºä¸‡ç‰©ï¼Œå¤©äººæœ¬æ˜¯ä¸€ä½“ï¼Œä½•æ—¶å¯åˆ†ï¼Ÿåˆä½•å¿…åˆ†ï¼Ÿ<br>éšå¿ƒè€ŒåŠ¨ï¼Œéšæ„è€Œè¡Œï¼Œä¸‡æ³•è‡ªç„¶ï¼Œä¾¿æ˜¯åœ£è´¤ä¹‹é“ã€‚å­˜å¤©ç†ï¼Œå»äººæ¬²ï¼Ÿå¤©ç†å³æ˜¯äººæ¬²ã€‚</p>
</blockquote>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>history</tag>
        <tag>ming-dynasty</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨¡æ‹Ÿç”µè·¯ç¬”è®°</title>
    <url>//2021-09-05-analog-circuit/</url>
    <content><![CDATA[<p>ç”µå­äºŒæç®¡ â€“&gt; æ™¶ä½“äºŒæç®¡</p>
<p>åŠåŠ å™¨ â€“&gt; å…¨åŠ å™¨</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>computer</tag>
        <tag>analog-circuit</tag>
      </tags>
  </entry>
  <entry>
    <title>golangå…¥é—¨ç¬”è®°ä¹‹å¸¸ç”¨åŸºç¡€åº“</title>
    <url>//2021-09-06-golang-common-lib/</url>
    <content><![CDATA[<p>go-http æ˜¯kube-scheduler healthz, metricsçš„å®ç°åŸºç¡€</p>
<p><a href="https://learnku.com/docs/build-web-application-with-golang/034-gos-http-package-detailed-solution/3171">go-http</a></p>
<hr>
<p>go-restful æ˜¯kube-apiserverçš„åŸºç¡€, åªç”¨åˆ°äº†å®ƒæœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œå³è·¯ç”±åŠŸèƒ½<br><a href="https://github.com/emicklei/go-restful">go-restful</a><br><a href="https://hackerain.me/2020/09/28/golang/go-restful-overview.html">go-restful-sample</a></p>
<hr>
<p>Semantic Versioning: å®ç°è¯­ä¹‰åŒ–ç‰ˆæœ¬æ¯”è¾ƒä¸ç®¡ç†, k8sä½¿ç”¨è¯¥åº“è¿›è¡Œç‰ˆæœ¬åˆ¤æ–­<br><a href="https://github.com/blang/semver">semver</a></p>
<hr>
<p>testify: ç”¨äºå•æµ‹<br><a href="http://github.com/stretchr/testify">testify</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>golang</tag>
        <tag>golang-lib</tag>
      </tags>
  </entry>
  <entry>
    <title>golangå…¥é—¨ç¬”è®°</title>
    <url>//2021-09-07-golang-cobra/</url>
    <content><![CDATA[<h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><ul>
<li><p>åˆ›å»ºç®€ç‰ˆçš„ECS CLI, å®ç°å®ä¾‹åˆ›å»ºç­‰åŸºç¡€æ“ä½œ</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">runInstances --region cn-beijing --zone cn-beijing-h --instanceType ecs.c5.large --payType spot --image xxx --vpc xxx --vsw xxx --sg xxx --count <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>åˆ›å»ºgoç‰ˆæœ¬ <a href="https://github.com/aliyun/alibabacloud-ecs-easy-sdk/tree/master/incubator-plugins/preemptive-instance-recommendation">Preemptive Instance Recommendation CLI</a></p>
</li>
<li><p>åˆ›å»º&amp;éƒ¨ç½²<a href="https://github.com/kube-aws/kube-spot-termination-notice-handler">spot-interruption-handler</a></p>
</li>
</ul>
<h1 id="cobra"><a href="#cobra" class="headerlink" title="cobra"></a>cobra</h1><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://www.qikqiak.com/post/create-cli-app-with-cobra/">åœ¨ Golang ä¸­ä½¿ç”¨ Cobra åˆ›å»º CLI åº”ç”¨</a></p>
<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><h3 id="åˆå§‹åŒ–cobra-CLIåº”ç”¨è„šæ‰‹æ¶"><a href="#åˆå§‹åŒ–cobra-CLIåº”ç”¨è„šæ‰‹æ¶" class="headerlink" title="åˆå§‹åŒ–cobra CLIåº”ç”¨è„šæ‰‹æ¶"></a>åˆå§‹åŒ–cobra CLIåº”ç”¨è„šæ‰‹æ¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cobra init --pkg-name spot-tool<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="ç¼–è¯‘äºŒè¿›åˆ¶"><a href="#ç¼–è¯‘äºŒè¿›åˆ¶" class="headerlink" title="ç¼–è¯‘äºŒè¿›åˆ¶"></a>ç¼–è¯‘äºŒè¿›åˆ¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go build -o spot-tool<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="å¢åŠ å­å‘½ä»¤"><a href="#å¢åŠ å­å‘½ä»¤" class="headerlink" title="å¢åŠ å­å‘½ä»¤"></a>å¢åŠ å­å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å¢åŠ å­å‘½ä»¤
cobra <span class="token function">add</span> runInstances<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ‰§è¡Œå­å‘½ä»¤ ./rootCmd subCmd params
./spot-tool runInstances <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span> <span class="token number">13</span> <span class="token number">14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="å¢åŠ å­™å‘½ä»¤"><a href="#å¢åŠ å­™å‘½ä»¤" class="headerlink" title="å¢åŠ å­™å‘½ä»¤"></a>å¢åŠ å­™å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å¢åŠ å­å‘½ä»¤
cobra <span class="token function">add</span> subRunInstances<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ä¿®æ”¹subRunIntances.goçš„init
rootCmd.AddCommand<span class="token punctuation">(</span>subRunInstancesCmd<span class="token punctuation">)</span> æ”¹æˆ
runInstancesCmd.AddCommand<span class="token punctuation">(</span>subRunInstancesCmd<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ‰§è¡Œå­™å‘½ä»¤
./spot-tool runInstances subRunIntances params<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h3 id="ä¸ºå‘½ä»¤å¢åŠ flag"><a href="#ä¸ºå‘½ä»¤å¢åŠ flag" class="headerlink" title="ä¸ºå‘½ä»¤å¢åŠ flag"></a>ä¸ºå‘½ä»¤å¢åŠ flag</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å­å‘½ä»¤initä¸­å¢åŠ æ ‡è¯† 
runInstancesCmd.Flags<span class="token punctuation">(</span><span class="token punctuation">)</span>.BoolP<span class="token punctuation">(</span><span class="token string">"float"</span>, <span class="token string">"f"</span>, false, <span class="token string">"Add Floating Numbers"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Run: func ä¸­å¢åŠ è¯†åˆ«è¯¥æ ‡è¯†çš„é€»è¾‘
fstatus, _ :<span class="token operator">=</span> cmd.Flags<span class="token punctuation">(</span><span class="token punctuation">)</span>.GetBool<span class="token punctuation">(</span><span class="token string">"float"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> fstatus <span class="token punctuation">&#123;</span>
    floatAdd<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    intAdd<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="k8sä¸­å¦‚ä½•ä½¿ç”¨cobra"><a href="#k8sä¸­å¦‚ä½•ä½¿ç”¨cobra" class="headerlink" title="k8sä¸­å¦‚ä½•ä½¿ç”¨cobra"></a>k8sä¸­å¦‚ä½•ä½¿ç”¨cobra</h3><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>golang</tag>
        <tag>cobra</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿ƒç†å­¦ä¹‹æœ¬æˆ‘ è‡ªæˆ‘ è¶…æˆ‘</title>
    <url>//2021-09-08-ego-super-ego/</url>
    <content><![CDATA[<p>æ€ªè¯è¡Œä¸ºå­¦æœ‰æ„Ÿ.</p>
<h1 id="æœ¬æˆ‘-Id"><a href="#æœ¬æˆ‘-Id" class="headerlink" title="æœ¬æˆ‘: Id"></a>æœ¬æˆ‘: Id</h1><p>æœ¬æˆ‘åªéµå¾ªä¸€ä¸ªåŸåˆ™â€”â€”å¿«æ¨‚åŸå‰‡ï¼ˆpleasure principleï¼‰<br>è€Œä¸é—œå¿ƒç¤¾æœƒçš„è¦å‰‡ï¼Œæ„ä¸ºè¿½æ±‚ä¸ªä½“çš„ç”Ÿç‰©æ€§éœ€æ±‚ï¼Œå¦‚é£Ÿç‰©çš„é¥±è¶³ä¸æ€§æ¬²çš„æ»¡è¶³ï¼Œä»¥åŠé¿å…ç—›è‹¦æˆ–ä¸æ„‰å¿«[7]ã€‚å®ƒä¸èƒ½å¿å—ä»»ä½•æŒ«æŠ˜ï¼Œå°±åƒä¸€å€‹è¢«æººæ„›çš„å°å­©å­ï¼Œæƒ³è¦ç”šéº½å°±è¦ç”šéº½[8]:88ã€‚å¼—æ´›ä¼Šå¾·è®¤ä¸ºï¼Œäº«ä¹åŸåˆ™çš„å½±å“æœ€å¤§åŒ–æ˜¯åœ¨äººçš„å©´å¹¼å„¿æ—¶æœŸï¼Œä¹Ÿæ˜¯æœ¬æˆ‘æ€æƒ³è¡¨ç°æœ€çªå‡ºçš„æ—¶å€™ã€‚æœ¬æˆ‘æ²’æœ‰å°éŒ¯åˆ¤æ–·åŠ›[9]ï¼Œä¹Ÿæ²¡æœ‰æƒ³è‡ªæˆ‘ç ´å£çš„æ…¾æœ›[10]ã€‚</p>
<hr>
<h1 id="è‡ªæˆ‘-Ego"><a href="#è‡ªæˆ‘-Ego" class="headerlink" title="è‡ªæˆ‘: Ego"></a>è‡ªæˆ‘: Ego</h1><p>è‡ªæˆ‘åœ¨è‡ªèº«å’Œå…¶ç’°å¢ƒä¸­é€²è¡Œèª¿ç¯€ï¼Œå¦‚å»¶é²äº«æ¨‚[14]ã€‚ä½›æ´›ä¼Šå¾·èªç‚ºè‡ªæˆ‘æ˜¯äººæ ¼çš„åŸ·è¡Œè€…ã€‚</p>
<p>æ„æ¶µï¼šå€‹äººçš„ç”Ÿç‰©æ¬²æœ›å’Œç¤¾æœƒè¦ç¯„ä¹‹é–“ç›¸äº’å”èª¿æŠ˜è¡·ï¼Œæ‰€è¡¨ç¾å‡ºä¾†çš„ã€Œè‡ªæˆ‘ã€ã€‚</p>
<hr>
<h1 id="è¶…æˆ‘-super-ego"><a href="#è¶…æˆ‘-super-ego" class="headerlink" title="è¶…æˆ‘: super-ego"></a>è¶…æˆ‘: super-ego</h1><p>äººæ ¼çµæ§‹ä¸­çš„ç®¡åˆ¶è€…ï¼Œç”±é“å¾·åŸå‰‡æ”¯é…ï¼Œæƒ³è¦å®Œç¾[17]ï¼Œå±¬æ–¼äººæ ¼çµæ§‹ä¸­çš„é“å¾·éƒ¨ä»½ã€‚<br>ä½›æ´›ä¼Šå¾·çš„å­¸èªªä¸­ï¼Œè¶…æˆ‘æ˜¯çˆ¶è¦ªå½¢è±¡èˆ‡æ–‡åŒ–è¦ç¯„çš„ç¬¦è™ŸåŒåŒ–ï¼Œç”±æ–¼å°å®¢é«”çš„è¡çªï¼Œè¶…æˆ‘å‚¾å‘æ–¼ç«™åœ¨ã€Œæœ¬æˆ‘ã€çš„åŸå§‹æ¸´æœ›çš„åå°ç«‹å ´[18]ï¼Œè€Œå°ã€Œè‡ªæˆ‘ã€å¸¶æœ‰ä¾µç•¥æ€§ã€‚è¶…æˆ‘ä»¥é“å¾·å¿ƒçš„å½¢å¼é‹ä½œ[19]ï¼Œç¶­æŒå€‹é«”çš„é“å¾·æ„Ÿã€è¿´é¿ç¦å¿Œï¼Œè€Œä»¤è‡ªæˆ‘å·¦å³ç‚ºé›£ã€‚è¶…æˆ‘çš„å½¢æˆç™¼ç”Ÿåœ¨æˆ€æ¯æƒ…çµçš„å´©è§£æ™‚æœŸ[20]ï¼Œæ˜¯ä¸€ç¨®å°çˆ¶è¦ªå½¢è±¡çš„å…§åŒ–èªåŒï¼Œç”±æ–¼å°ç”·å­©ç„¡æ³•æˆåŠŸåœ°ç¶­æŒæ¯è¦ªæˆç‚ºå…¶æ„›æˆ€çš„å®¢é«”ï¼Œå°çˆ¶è¦ªå¯èƒ½å°å…¶çš„é–¹å‰²å ±å¾©æˆ–æ‡²ç½°ç”¢ç”Ÿé˜‰å‰²æƒ…ç»“ï¼ˆcastration anxietyï¼‰ï¼Œé€²è€Œè½‰ç‚ºèªåŒçˆ¶è¦ªã€‚<br>æ„æ¶µï¼šå› æ‡‰ç¤¾æœƒæ–‡åŒ–çš„è¡Œç‚ºè¦ç¯„å’Œé“å¾·æœŸå¾…ï¼Œå½¢æˆã€Œè¶…æˆ‘ã€çš„å‹•åŠ›ã€‚</p>
<hr>
<p>æœ¬æˆ‘ã€è‡ªæˆ‘ã€è¶…æˆ‘æ§‹æˆäº†äººçš„å®Œæ•´çš„äººæ ¼ã€‚äººçš„ä¸€åˆ‡å¿ƒç†æ´»å‹•éƒ½å¯ä»¥å¾å®ƒå€‘ä¹‹é–“çš„è¯ç¹«ä¸­å¾—åˆ°åˆç†çš„è§£é‡‹ï¼Œè‡ªæˆ‘æ˜¯æ°¸ä¹…å­˜åœ¨çš„ï¼Œè€Œè¶…æˆ‘å’Œæœ¬æˆ‘åˆå¹¾ä¹æ˜¯æ°¸ä¹…å°ç«‹çš„ï¼Œç‚ºäº†å”èª¿æœ¬æˆ‘å’Œè¶…æˆ‘ä¹‹é–“çš„çŸ›ç›¾ï¼Œè‡ªæˆ‘éœ€è¦é€²è¡Œèª¿ç¯€[21]ã€‚è‹¥å€‹äººæ‰¿å—çš„ä¾†è‡ªæœ¬æˆ‘ã€è¶…æˆ‘å’Œå¤–ç•Œå£“åŠ›éå¤§è€Œç”¢ç”Ÿç„¦æ…®æ™‚ï¼Œè‡ªæˆ‘å°±æœƒå¹«åŠ©å•Ÿå‹•é˜²å¾¡æ©Ÿåˆ¶ï¼Œä¸¦ç¨±ç‚ºå¿ƒç†é˜²è¡›æ©Ÿåˆ¶æˆ–è‡ªæˆ‘é˜²è¡›æ©Ÿåˆ¶ã€‚é˜²å¾¡æ©Ÿåˆ¶æœ‰ï¼šå£“æŠ‘ã€å¦èªã€é€€è¡Œã€æŠµæ¶ˆã€æŠ•å°„ã€æ˜‡è¯ç­‰ç­‰ã€‚</p>
<p>æœ¬æˆ‘å°æ‡‰äº†äººè…¦ä¸­å¤®éƒ¨ä½ï¼Œè‡ªæˆ‘å°æ‡‰äº†å‰é¡è‘‰çš®è³ªï¼Œ è¶…æˆ‘å°æ‡‰äº†çœ¶é¡è‘‰çš®å±¤[22]ã€‚</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>psychology</tag>
        <tag>ego</tag>
        <tag>super-ego</tag>
      </tags>
  </entry>
  <entry>
    <title>kube-schedulerç¬”è®°ä¹‹äº²å’Œæ€§è°ƒåº¦</title>
    <url>//2021-09-08-kube-scheduler-affinity/</url>
    <content><![CDATA[<h2 id="ç»¼è¿°"><a href="#ç»¼è¿°" class="headerlink" title="ç»¼è¿°"></a>ç»¼è¿°</h2><p><a href="https://github.com/DavyJones2010/k8s-source-code-analysis/blob/master/core/scheduler/affinity.md">https://github.com/DavyJones2010/k8s-source-code-analysis/blob/master/core/scheduler/affinity.md</a></p>
<h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>åˆ†ä¸ºå¦‚ä¸‹å‡ ç§: </p>
<ul>
<li><p>NodeSelector</p>
</li>
<li><p>NodeAffinity</p>
<ul>
<li>preferredDuringSchedulingIgnoredDuringExecution: è½¯çº¦æŸ</li>
<li>requiredDuringSchedulingIgnoredDuringExecution: ç¡¬çº¦æŸ</li>
</ul>
</li>
<li><p>PodAffinity:</p>
<ul>
<li>preferredDuringSchedulingIgnoredDuringExecution: è½¯çº¦æŸ</li>
<li>requiredDuringSchedulingIgnoredDuringExecution: ç¡¬çº¦æŸ</li>
</ul>
</li>
<li><p>requiredDuringSchedulingIgnoredDuringExecution</p>
<ul>
<li><p>ä¸ NodeSelector æˆ–è€… LabelSelector æœ‰å•¥åŒºåˆ«? éƒ½æ˜¯ç¡¬çº¦æŸ, éƒ½ä¼šå¯¼è‡´Nodeè¢«ç­›é™¤æ‰</p>
<ul>
<li><p>åŒºåˆ«åœ¨äº: LabelSelector åªèƒ½åˆ¤æ–­ â€œa.label.equals(b.label)â€, è€ŒNodeSelectoræ”¯æŒå®Œæ•´çš„è¡¨è¾¾å¼, ä¾‹å¦‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
    <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
        <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> kubernetes.io/e2e<span class="token punctuation">-</span>az<span class="token punctuation">-</span>name
            <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
            <span class="token key atrule">values</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az1
            <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az2
      <span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">preference</span><span class="token punctuation">:</span>
          <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>key
            <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
            <span class="token key atrule">values</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
</li>
<li><p>â€œIgnoredDuringExecutionâ€éƒ¨åˆ†æ„å‘³ç€ï¼Œç±»ä¼¼äº <code>nodeSelector</code> çš„å·¥ä½œåŸç†ï¼Œå¦‚æœèŠ‚ç‚¹çš„æ ‡ç­¾åœ¨è¿è¡Œæ—¶å‘ç”Ÿå˜æ›´ï¼Œä»è€Œä¸å†æ»¡è¶³ pod ä¸Šçš„äº²å’Œè§„åˆ™ï¼Œé‚£ä¹ˆ pod å°†ä»ç„¶ç»§ç»­åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ä¹Ÿå°±æ˜¯onetimeçš„åŸåˆ™, åªä¼šåœ¨è°ƒåº¦æ—¶å…³æ³¨è¯¥æ ‡ç­¾, åç»­èŠ‚ç‚¹æ ‡ç­¾å˜åŒ–, ä¸ä¼šé‡è°ƒåº¦.</p>
</li>
</ul>
<h2 id="å®ç°ç ”ç©¶"><a href="#å®ç°ç ”ç©¶" class="headerlink" title="å®ç°ç ”ç©¶"></a>å®ç°ç ”ç©¶</h2><h3 id="NodeAffinity"><a href="#NodeAffinity" class="headerlink" title="NodeAffinity"></a>NodeAffinity</h3><p>ä»£ç æ ·ä¾‹</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
    <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
        <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> kubernetes.io/e2e<span class="token punctuation">-</span>az<span class="token punctuation">-</span>name
            <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
            <span class="token key atrule">values</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az1
            <span class="token punctuation">-</span> e2e<span class="token punctuation">-</span>az2
      <span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">preference</span><span class="token punctuation">:</span>
          <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>key
            <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
            <span class="token key atrule">values</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> another<span class="token punctuation">-</span>node<span class="token punctuation">-</span>label<span class="token punctuation">-</span>value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="RequiredDuringSchedulingIgnoredDuringExecution-ç¡¬çº¦æŸ"><a href="#RequiredDuringSchedulingIgnoredDuringExecution-ç¡¬çº¦æŸ" class="headerlink" title="RequiredDuringSchedulingIgnoredDuringExecution(ç¡¬çº¦æŸ)"></a>RequiredDuringSchedulingIgnoredDuringExecution(ç¡¬çº¦æŸ)</h4><p>åœ¨Filteré˜¶æ®µç”Ÿæ•ˆ</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go">pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>predicates<span class="token operator">/</span>predicates<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">848</span> podMatchesNodeSelectorAndAffinityTerms
<span class="token keyword">func</span> <span class="token function">podMatchesNodeSelectorAndAffinityTerms</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> node <span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// NodeSelector, ç­›é€‰Node</span>
  selector <span class="token operator">:=</span> labels<span class="token punctuation">.</span><span class="token function">SelectorFromSet</span><span class="token punctuation">(</span>pod<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>NodeSelector<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token operator">!</span>selector<span class="token punctuation">.</span><span class="token function">Matches</span><span class="token punctuation">(</span>labels<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>Labels<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">// NodeAffinity.requiredDuringSchedulingIgnoredDuringExecution, ç¡¬çº¦æŸ</span>
  <span class="token keyword">if</span> nodeAffinity<span class="token punctuation">.</span>RequiredDuringSchedulingIgnoredDuringExecution <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
			nodeSelectorTerms <span class="token operator">:=</span> nodeAffinity<span class="token punctuation">.</span>RequiredDuringSchedulingIgnoredDuringExecution<span class="token punctuation">.</span>NodeSelectorTerms
			nodeAffinityMatches <span class="token operator">=</span> nodeAffinityMatches <span class="token operator">&amp;&amp;</span> <span class="token function">nodeMatchesNodeSelectorTerms</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> nodeSelectorTerms<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="PreferredDuringSchedulingIgnoredDuringExecution-è½¯çº¦æŸ"><a href="#PreferredDuringSchedulingIgnoredDuringExecution-è½¯çº¦æŸ" class="headerlink" title="PreferredDuringSchedulingIgnoredDuringExecution(è½¯çº¦æŸ)"></a>PreferredDuringSchedulingIgnoredDuringExecution(è½¯çº¦æŸ)</h4><p>åœ¨Weighteré˜¶æ®µç”Ÿæ•ˆ</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go">pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>priorities<span class="token operator">/</span>node_affinity<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">34</span> CalculateNodeAffinityPriorityMap

<span class="token keyword">func</span> <span class="token function">CalculateNodeAffinityPriorityMap</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> meta <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> nodeInfo <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>NodeInfo<span class="token punctuation">)</span> <span class="token punctuation">(</span>schedulerapi<span class="token punctuation">.</span>HostPriority<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   node <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   affinity <span class="token operator">:=</span> pod<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Affinity

   <span class="token keyword">var</span> count <span class="token builtin">int32</span>

  <span class="token comment">// éå†æ‰€æœ‰Softçº¦æŸ</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> affinity<span class="token punctuation">.</span>NodeAffinity<span class="token punctuation">.</span>PreferredDuringSchedulingIgnoredDuringExecution <span class="token punctuation">&#123;</span>
    preferredSchedulingTerm <span class="token operator">:=</span> <span class="token operator">&amp;</span>affinity<span class="token punctuation">.</span>NodeAffinity<span class="token punctuation">.</span>PreferredDuringSchedulingIgnoredDuringExecution<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token comment">// æ ¹æ®è¡¨è¾¾å¼ç”ŸæˆSelector</span>
    nodeSelector<span class="token punctuation">,</span> err <span class="token operator">:=</span> v1helper<span class="token punctuation">.</span><span class="token function">NodeSelectorRequirementsAsSelector</span><span class="token punctuation">(</span>preferredSchedulingTerm<span class="token punctuation">.</span>Preference<span class="token punctuation">.</span>MatchExpressions<span class="token punctuation">)</span>
    <span class="token comment">// æ ¹æ®Selectorè®¡ç®—æƒé‡.</span>
    <span class="token keyword">if</span> nodeSelector<span class="token punctuation">.</span><span class="token function">Matches</span><span class="token punctuation">(</span>labels<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>Labels<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      count <span class="token operator">+=</span> preferredSchedulingTerm<span class="token punctuation">.</span>Weight
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

   <span class="token comment">// è¿”å›è®¡ç®—å¥½çš„æƒé‡</span>
   <span class="token keyword">return</span> schedulerapi<span class="token punctuation">.</span>HostPriority<span class="token punctuation">&#123;</span>
      Host<span class="token punctuation">:</span>  node<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
      Score<span class="token punctuation">:</span> <span class="token function">int</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="PodAffinity"><a href="#PodAffinity" class="headerlink" title="PodAffinity"></a>PodAffinity</h3><p>yamlæ ·ä¾‹</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> with<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>affinity
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>affinity<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> with<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>affinity
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
    <span class="token key atrule">podAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">labelSelector</span><span class="token punctuation">:</span>
          <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> app
            <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
            <span class="token key atrule">values</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> busybox<span class="token punctuation">-</span>pod
        <span class="token key atrule">topologyKey</span><span class="token punctuation">:</span> kubernetes.io/hostname
    <span class="token key atrule">podAntiAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">podAffinityTerm</span><span class="token punctuation">:</span>
          <span class="token key atrule">labelSelector</span><span class="token punctuation">:</span>
            <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> app
              <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
              <span class="token key atrule">values</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> node<span class="token punctuation">-</span>affinity<span class="token punctuation">-</span>pod
          <span class="token key atrule">topologyKey</span><span class="token punctuation">:</span> kubernetes.io/hostname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="RequiredDuringSchedulingIgnoredDuringExecution-ç¡¬çº¦æŸ-1"><a href="#RequiredDuringSchedulingIgnoredDuringExecution-ç¡¬çº¦æŸ-1" class="headerlink" title="RequiredDuringSchedulingIgnoredDuringExecution(ç¡¬çº¦æŸ)"></a>RequiredDuringSchedulingIgnoredDuringExecution(ç¡¬çº¦æŸ)</h4><ul>
<li>åœ¨filteré˜¶æ®µç”Ÿæ•ˆ</li>
</ul>
<p>å¦‚ä½•å®ç°çš„podAntiAffinity? èƒ½å¼ºä¿éšœä¹ˆ? </p>
<h3 id="Serviceäº²å’Œæ€§"><a href="#Serviceäº²å’Œæ€§" class="headerlink" title="Serviceäº²å’Œæ€§"></a>Serviceäº²å’Œæ€§</h3><p><em>ä¸€ä¸ªæœåŠ¡çš„ç¬¬ä¸€ä¸ªPodè¢«è°ƒåº¦åˆ°å¸¦æœ‰Label â€œregion&#x3D;fooâ€çš„Nodesï¼ˆèµ„æºé›†ç¾¤ï¼‰ä¸Šï¼Œ é‚£ä¹ˆå…¶æœåŠ¡åé¢çš„å…¶å®ƒPodéƒ½å°†è°ƒåº¦è‡³Label â€œregion&#x3D;fooâ€çš„Nodesã€‚</em></p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://www.qikqiak.com/post/understand-kubernetes-affinity/">https://www.qikqiak.com/post/understand-kubernetes-affinity/</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>scheduler</tag>
        <tag>kube-scheduler</tag>
      </tags>
  </entry>
  <entry>
    <title>kube-schedulerç¬”è®°ä¹‹SchedulerCacheç ”ç©¶</title>
    <url>//2021-09-08-kube-scheduler-cache/</url>
    <content><![CDATA[<h1 id="æºç è·¯å¾„"><a href="#æºç è·¯å¾„" class="headerlink" title="æºç è·¯å¾„"></a>æºç è·¯å¾„</h1><pre class="line-numbers language-none"><code class="language-none">kubernetes&#x2F;pkg&#x2F;scheduler&#x2F;internal&#x2F;cache&#x2F;cache.go<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="ç»“æ„è¯¦è§£"><a href="#ç»“æ„è¯¦è§£" class="headerlink" title="ç»“æ„è¯¦è§£"></a>ç»“æ„è¯¦è§£</h1><h2 id="SchedulerCache"><a href="#SchedulerCache" class="headerlink" title="SchedulerCache"></a>SchedulerCache</h2><h3 id="ç»“æ„ä»£ç "><a href="#ç»“æ„ä»£ç " class="headerlink" title="ç»“æ„ä»£ç "></a>ç»“æ„ä»£ç </h3><pre class="line-numbers language-none"><code class="language-none">type schedulerCache struct &#123;

	&#x2F;&#x2F; é”ä¿¡æ¯
	&#x2F;&#x2F; This mutex guards all fields within this cache struct.
	mu sync.RWMutex
	
	&#x2F;&#x2F; Podä¿¡æ¯(é‡è¦)
	&#x2F;&#x2F; a set of assumed pod keys.
	&#x2F;&#x2F; The key could further be used to get an entry in podStates.
	assumedPods map[string]bool
	&#x2F;&#x2F; a map from pod key to podState.
	podStates map[string]*podState
	
	&#x2F;&#x2F; Nodeä¿¡æ¯(é‡è¦)
	nodes     map[string]*nodeInfoListItem
	&#x2F;&#x2F; headNode points to the most recently updated NodeInfo in &quot;nodes&quot;. It is the
	&#x2F;&#x2F; head of the linked list.
	headNode *nodeInfoListItem
	nodeTree *NodeTree
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>æ˜¯è°ƒåº¦å†³ç­–çš„èµ„æºä¿¡æ¯æ ¸å¿ƒ. åŒ…æ‹¬å¦‚ä¸‹é‡è¦éƒ¨åˆ†:</p>
<ul>
<li>headNode *nodeInfoListItem: æŒ‡å‘nodeInfoé“¾è¡¨çš„å¤´éƒ¨æŒ‡é’ˆ</li>
<li>nodes map[string]*nodeInfoListItem: nodeInfoçš„ç»„åˆ, key: nodeName, value: nodeInfo</li>
<li>nodeTree *NodeTree: æŒ‰zoneæ‰“æ•£çš„nodeç»“æ„.</li>
</ul>
<h3 id="æ ¸å¿ƒæ“ä½œ"><a href="#æ ¸å¿ƒæ“ä½œ" class="headerlink" title="æ ¸å¿ƒæ“ä½œ"></a>æ ¸å¿ƒæ“ä½œ</h3><h4 id="AddNode"><a href="#AddNode" class="headerlink" title="AddNode"></a>AddNode</h4><pre class="line-numbers language-none"><code class="language-none">func (cache *schedulerCache) AddNode(node *v1.Node) error &#123;
	cache.mu.Lock()
	defer cache.mu.Unlock()

	n, ok :&#x3D; cache.nodes[node.Name]
	if !ok &#123;
		n &#x3D; newNodeInfoListItem(schedulernodeinfo.NewNodeInfo())
		cache.nodes[node.Name] &#x3D; n
	&#125; else &#123;
		cache.removeNodeImageStates(n.info.Node())
	&#125;
	cache.moveNodeInfoToHead(node.Name)

	cache.nodeTree.AddNode(node)
	cache.addNodeImageStates(node, n.info)
	return n.info.SetNode(node)
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>æŠŠ&lt;nodeName, nodeInfo&gt;æ”¾åˆ°nodesè¿™ä¸ªmapä¸­.</li>
<li>æŠŠå½“å‰node appendåˆ°nodeInfoListé“¾è¡¨çš„å¤´éƒ¨, å°†å¤´éƒ¨èŠ‚ç‚¹æŒ‡é’ˆæ”¹æˆå½“å‰node</li>
<li></li>
</ol>
<h4 id="RemoveNode"><a href="#RemoveNode" class="headerlink" title="RemoveNode"></a>RemoveNode</h4><p>ä¸AddNodeæ“ä½œç›¸å.</p>
<h4 id="UpdateNodeInfoSnapshot"><a href="#UpdateNodeInfoSnapshot" class="headerlink" title="UpdateNodeInfoSnapshot"></a>UpdateNodeInfoSnapshot</h4><p>åˆ›å»ºNodeInfoçš„å¿«ç…§, æ¯æ¬¡è°ƒåº¦å‰éƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•, æ­¤åè°ƒåº¦éƒ½ä¾èµ–è¯¥Snapshotè¿›è¡Œå†³ç­–. å…·ä½“å‚è§å¦å¤–ä¸€ç¯‡&lt;å¿«ç…§æœºåˆ¶&gt;</p>
<h2 id="NodeTree"><a href="#NodeTree" class="headerlink" title="NodeTree"></a>NodeTree</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><ul>
<li>æœ¬è´¨ä¸ŠNodeTreeæ˜¯ä¸ºäº†åœ¨è°ƒåº¦æ—¶, è®©Podèƒ½åœ¨ä¸åŒçš„zoneå†…ä¸åŒçš„Nodeä¸Šèƒ½å¤Ÿå°½é‡æ‰“æ•£.</li>
<li>ä½†å¦‚ä¸‹åˆ†æ, åœ¨è¿›å…¥è°ƒåº¦Filterä¹‹å‰å°±æŠŠNodeæ„å»ºæˆäº†æ ‘, ç„¶ååœ¨Filterçš„æ—¶å€™, é€ä¸ªä»NodeTree.next()æ¥pop nodeä¿¡æ¯. æœ‰å¦‚ä¸‹é—®é¢˜: <ul>
<li>ä¸šåŠ¡ä¸Š: <ul>
<li>é‚£ä¹ˆPodæ”¾åœ¨å“ªä¸ªNodeä¸Šä¸è¯·æ±‚é¡ºåºæœ‰å¾ˆå¤§å…³è”. å¾ˆå¯èƒ½Filteræ‰ä¹‹å, æ‰€æœ‰Podè¿˜æ˜¯èšåˆåœ¨åŒä¸€ä¸ªzoneä¸‹, ç”šè‡³åŒä¸€ä¸ªNodeä¸Š. ä¸ºå•¥ä¸åœ¨Filterä¹‹åå°†å‰©ä½™çš„Nodeç»„æˆNodeTreeå‘¢? </li>
<li>Weighterå¦‚ä½•è¿›è¡Œæ‰“åˆ†æ’åº? weighteræœºåˆ¶æ˜¯å¦å·²ç»å¤±æ•ˆ?</li>
</ul>
</li>
<li>æ€§èƒ½ä¸Š: <ul>
<li>æ‰€æœ‰Nodeéƒ½è¢«ç¼“å­˜èµ·æ¥, å†…å­˜å¼€é”€? </li>
<li>NodeTreeæ˜¯å¦‚ä½•ä¿è¯åŒæ­¥çš„?</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ç»“æ„ä»£ç -1"><a href="#ç»“æ„ä»£ç -1" class="headerlink" title="ç»“æ„ä»£ç "></a>ç»“æ„ä»£ç </h3><pre class="line-numbers language-none"><code class="language-none">type NodeTree struct &#123;
    tree      map[string]*nodeArray &#x2F;&#x2F; å­˜å‚¨zoneå’Œzoneä¸‹é¢çš„nodeä¿¡æ¯
    zones     []string              &#x2F;&#x2F; å­˜å‚¨zones
    zoneIndex int
    numNodes  int
    mu        sync.RWMutex
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">type nodeArray struct &#123;
    nodes     []string
    lastIndex int
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ç»“æ„åˆ†æ"><a href="#ç»“æ„åˆ†æ" class="headerlink" title="ç»“æ„åˆ†æ"></a>ç»“æ„åˆ†æ</h3><ul>
<li>tree map[string] *nodeArray: <ul>
<li>è´Ÿè´£å­˜å‚¨ä¸€ä¸ªzoneä¸‹é¢çš„æ‰€æœ‰nodeèŠ‚ç‚¹</li>
<li>key: zoneName</li>
<li>value: zoneä¸‹æ‰€æœ‰çš„nodeèŠ‚ç‚¹</li>
<li>nodeArray:<ul>
<li>nodes: è¯¥zoneä¸‹æ‰€æœ‰nodeçš„</li>
<li>lastIndex: è®°å½•å½“å‰zoneåˆ†é…åˆ°çš„èŠ‚ç‚¹ç´¢å¼•</li>
</ul>
</li>
</ul>
</li>
<li>zones: å°†è°ƒåº¦åŸŸä¸‹æ‰€æœ‰çš„zoneåç§°æ‰“å¹³æ”¾åœ¨zonesé‡Œ</li>
<li>zoneIndex: å½“å‰åˆ†é…åˆ°çš„zoneçš„ç´¢å¼•</li>
</ul>
<h3 id="å¦‚ä½•æ„å»ºNodeTree"><a href="#å¦‚ä½•æ„å»ºNodeTree" class="headerlink" title="å¦‚ä½•æ„å»ºNodeTree?"></a>å¦‚ä½•æ„å»ºNodeTree?</h3><ul>
<li>æ·»åŠ node: <ul>
<li>æ ¹æ®nodeå¯¹åº”çš„zone(å¦‚æœzoneä¸å­˜åœ¨, åˆ™æ–°å¢åŠ zone), ä»mapä¸­è·å–åˆ°nodeArray</li>
<li>å°†nodeæ·»åŠ åˆ°nodeArrayçš„é˜Ÿåˆ—ç»“å°¾</li>
</ul>
</li>
<li>åˆ é™¤node: <ul>
<li>æ ¹æ®nodeå¯¹åº”çš„zone, ä»mapä¸­è·å–åˆ°nodeArray</li>
<li>å°†nodeåˆ é™¤å, å°†é˜Ÿåˆ—é‡Œnodeä¹‹åå…¶ä»–èŠ‚ç‚¹å¾€å‰ç§»åŠ¨ä¸€ä½.</li>
<li>å¦‚æœnodeåˆ é™¤åzoneä¸ºç©ºäº†, é‚£ä¹ˆåŒæ—¶å°†è¯¥&lt;zoneName, nodeArray&gt;çš„kvä»mapä¸­åˆ é™¤æ‰.</li>
</ul>
</li>
</ul>
<h3 id="ä½•æ—¶æ„å»ºNodeTree"><a href="#ä½•æ—¶æ„å»ºNodeTree" class="headerlink" title="ä½•æ—¶æ„å»ºNodeTree?"></a>ä½•æ—¶æ„å»ºNodeTree?</h3><ul>
<li><p>ä½•æ—¶æ„å»ºtree?</p>
<ul>
<li>è°ƒåº¦å¼€å§‹, æ„å»ºæœ¬åœ°cacheçš„æ—¶å€™, å°±åŒæ—¶æŠŠç©ºçš„nodeTreeæ„å»ºå‡ºæ¥äº†</li>
</ul>
</li>
<li><p>ä½•æ—¶æ·»åŠ node?<br>  * </p>
</li>
<li><p>ä½•æ—¶åˆ é™¤node?<br>  * </p>
</li>
<li><p>è°ƒåº¦çš„æ—¶å€™, åº”è¯¥æ˜¯æŠŠæ‰€æœ‰nodeæ‰“å¹³äº†, é‚£ä¹ˆæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™ä¸ªnodeTreeå‘¢? </p>
</li>
<li><p>åˆ†é…nodeçš„æµç¨‹æ€æ ·?</p>
<ul>
<li>zoneIndexä¸nodeArrayåŒæ—¶å¢åŠ ,</li>
</ul>
</li>
</ul>
<h3 id="åˆ†é…Nodeæ‰“æ•£ç®—æ³•æ ·ä¾‹"><a href="#åˆ†é…Nodeæ‰“æ•£ç®—æ³•æ ·ä¾‹" class="headerlink" title="åˆ†é…Nodeæ‰“æ•£ç®—æ³•æ ·ä¾‹"></a>åˆ†é…Nodeæ‰“æ•£ç®—æ³•æ ·ä¾‹</h3><p><img data-src="https://imgedu.lagou.com/665f5d51ad30466ba0e9c365d4a7e8cb.jpg" alt="image.png"></p>
<ul>
<li>å¦‚ä¸‹ç»“æ„:</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&#123;ZoneA:[NodeA1, NodeA2, NodeA3], ZoneB:[NodeB1, NodeB2], ZoneC:[NodeC1, NodeC2, NodeC3, NodeC4]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<ul>
<li>ä¾æ¬¡next(), åˆ†é…é¡ºåº:</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">ZoneA.NodeA1,ZoneB.NodeB1,ZoneC.NodeC1,
ZoneA.NodeA2,ZoneB.NodeB2,ZoneC.NodeC2,
ZoneA.NodeA3,ZoneC.NodeC3,
ZoneC.NodeC4
-&gt; ResetExhausted(Zoneçš„Indexä¸Zoneå†…Nodeçš„Indexå…¨éƒ¨éƒ½è¢«é‡ç½®)
ZoneA.NodeA1,ZoneB.NodeB1,ZoneC.NodeC1,
ZoneA.NodeA2,ZoneB.NodeB2,ZoneC.NodeC2,
ZoneA.NodeA3,ZoneC.NodeC3,
ZoneC.NodeC4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="NodeInfoListItem"><a href="#NodeInfoListItem" class="headerlink" title="NodeInfoListItem"></a>NodeInfoListItem</h2><h3 id="ç»“æ„ä»£ç -2"><a href="#ç»“æ„ä»£ç -2" class="headerlink" title="ç»“æ„ä»£ç "></a>ç»“æ„ä»£ç </h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; nodeInfoListItem holds a NodeInfo pointer and acts as an item in a doubly
&#x2F;&#x2F; linked list. When a NodeInfo is updated, it goes to the head of the list.
&#x2F;&#x2F; The items closer to the head are the most recently updated items.
type nodeInfoListItem struct &#123;
	info *schedulernodeinfo.NodeInfo
	next *nodeInfoListItem
	prev *nodeInfoListItem
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ç»“æ„æ¦‚è¿°"><a href="#ç»“æ„æ¦‚è¿°" class="headerlink" title="ç»“æ„æ¦‚è¿°"></a>ç»“æ„æ¦‚è¿°</h3><p>æœ¬è´¨ä¸Š: æ˜¯ä¸€ä¸ªNodeInfoçš„åŒå‘é“¾è¡¨. (æ³¨æ„å¤´éƒ¨èŠ‚ç‚¹æ²¡æœ‰prev, å°¾éƒ¨èŠ‚ç‚¹æ²¡æœ‰next, æ‰€ä»¥å¹¶éç¯). ä¸€æ—¦NodeInfoæ›´æ–°&#x2F;æ·»åŠ , é‚£ä¹ˆè¯¥NodeInfoä¾¿è¢«æ”¾åˆ°é“¾è¡¨çš„å¤´éƒ¨. å¦‚ä¸‹ç»“æ„: </p>
<pre class="line-numbers language-none"><code class="language-none">+-------+           +--------+        +--------+
|  NodeA| +-------&gt; |   NodeB| +----&gt; |   NodeC|
|       |           |        |        |        |
+-+-----+ &lt;-------+ +--------+ &lt;----+ +--------+
  ^
  |
 Head<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç›®çš„æ˜¯: </p>
<p>å¦‚ä½•åšåˆ°: </p>
<ul>
<li>æ€æ ·ä¿è¯æ›´æ–°ä¹‹åå¿…ç„¶æ”¾åˆ°é“¾è¡¨å¤´éƒ¨: å‚åŠ AddNodeæ“ä½œè§£æ</li>
<li>è°ä¼šè§¦å‘NodeInfoçš„æ›´æ–°? </li>
<li>ä½•æ—¶å‡ºå‘NodeInfoçš„æ›´æ–°?</li>
</ul>
<p>ç‰ˆæœ¬å·æœºåˆ¶: </p>
<ul>
<li>cacheç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„ç‰ˆæœ¬å·(generation).</li>
<li>NodeInfoç»“æ„ä¸­, æ¯ä¸ªNodeInfoéƒ½æœ‰ä¸€ä¸ªgeneration, æ¯æ¬¡å¯¹é“¾è¡¨&#x2F;Nodeæœ¬èº«è¿›è¡Œæ“ä½œ, éƒ½ä¼šæŠŠNodeInfoæ”¾åˆ°é“¾è¡¨å¤´. åŒæ—¶NodeInfo.generation &#x3D; å…¨å±€çš„ç‰ˆæœ¬å·+1. </li>
<li>è¿™æ ·å°±ä¿è¯äº†é“¾è¡¨å¤´çš„generationè‚¯å®šæ˜¯æœ€å¤§çš„. å¹¶ä¸”é“¾è¡¨ä¸­ä»å¤´åˆ°å°¾, generationæ˜¯ä»é«˜åˆ°ä½ä¾æ¬¡é€’å‡çš„.</li>
</ul>
<h3 id="æ ¸å¿ƒæ“ä½œ-1"><a href="#æ ¸å¿ƒæ“ä½œ-1" class="headerlink" title="æ ¸å¿ƒæ“ä½œ"></a>æ ¸å¿ƒæ“ä½œ</h3><h4 id="AddNode-1"><a href="#AddNode-1" class="headerlink" title="AddNode"></a>AddNode</h4><p>çº¯é“¾è¡¨æ“ä½œ, æ¯”è¾ƒå®¹æ˜“ç†è§£. </p>
<ul>
<li>å°†å½“å‰Nodeæ”¾åˆ°NodeInfoé“¾è¡¨çš„å¤´éƒ¨</li>
<li>å°†å¤´éƒ¨æŒ‡é’ˆæŒ‡å‘å½“å‰Node</li>
<li>å°†å½“å‰Nodeçš„generation+1(æ¨æµ‹åº”è¯¥æ˜¯ å½“å‰nodeçš„generation&#x3D;ä¹‹å‰å¤´éƒ¨nodeçš„generation + 1), è¿™æ ·æ‰èƒ½ä¿è¯Nodeé“¾è¡¨çš„generationæ˜¯ä»é«˜åˆ°ä½è¿›è¡Œçš„æ’åˆ—.</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; moveNodeInfoToHead moves a NodeInfo to the head of &quot;cache.nodes&quot; doubly
&#x2F;&#x2F; linked list. The head is the most recently updated NodeInfo.
&#x2F;&#x2F; We assume cache lock is already acquired.
func (cache *schedulerCache) moveNodeInfoToHead(name string) &#123;
	ni, ok :&#x3D; cache.nodes[name]
	if !ok &#123;
		klog.Errorf(&quot;No NodeInfo with name %v found in the cache&quot;, name)
		return
	&#125;
	&#x2F;&#x2F; if the node info list item is already at the head, we are done.
	if ni &#x3D;&#x3D; cache.headNode &#123;
		return
	&#125;

	if ni.prev !&#x3D; nil &#123;
		ni.prev.next &#x3D; ni.next
	&#125;
	if ni.next !&#x3D; nil &#123;
		ni.next.prev &#x3D; ni.prev
	&#125;
	if cache.headNode !&#x3D; nil &#123;
		cache.headNode.prev &#x3D; ni
	&#125;
	ni.next &#x3D; cache.headNode
	ni.prev &#x3D; nil
	cache.headNode &#x3D; ni
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="RemoveNode-1"><a href="#RemoveNode-1" class="headerlink" title="RemoveNode"></a>RemoveNode</h4><p>æ˜¯AddNodeçš„åå‘æ“ä½œ. çº¯é“¾è¡¨æ“ä½œ. ä¸å†èµ˜è¿°. </p>
<ul>
<li>æ³¨æ„è¿™é‡Œcache.nodesçš„mapå¾ˆæœ‰ç”¨, èƒ½æ ¹æ®Nodeçš„Nameç›´æ¥æ‰¾åˆ°Nodeå¯¹è±¡. å¤æ‚åº¦O(1)</li>
<li>å¯¹æ¯”ä¸‹RemovePod, éœ€è¦ä»å¤´åˆ°å°¾éå†, å¤æ‚åº¦O(n)è¾ƒé«˜.</li>
</ul>
<h3 id="NodeInfo"><a href="#NodeInfo" class="headerlink" title="NodeInfo"></a>NodeInfo</h3><h4 id="ç»“æ„æ¦‚è¿°-1"><a href="#ç»“æ„æ¦‚è¿°-1" class="headerlink" title="ç»“æ„æ¦‚è¿°"></a>ç»“æ„æ¦‚è¿°</h4><p>ä»£è¡¨å•ä¸ªNodeèµ„æºä¿¡æ¯çš„æœ€æ ¸å¿ƒéƒ¨åˆ†.</p>
<h4 id="ç»“æ„ä»£ç -3"><a href="#ç»“æ„ä»£ç -3" class="headerlink" title="ç»“æ„ä»£ç "></a>ç»“æ„ä»£ç </h4><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; NodeInfo is node level aggregated information.
type NodeInfo struct &#123;
	&#x2F;&#x2F; Overall node information.
	node *v1.Node

	pods             []*v1.Pod
	podsWithAffinity []*v1.Pod
	usedPorts        HostPortInfo

	&#x2F;&#x2F; Total requested resource of all pods on this node.
	&#x2F;&#x2F; It includes assumed pods which scheduler sends binding to apiserver but
	&#x2F;&#x2F; didn&#39;t get it as scheduled yet.
	requestedResource *Resource
	nonzeroRequest    *Resource
	&#x2F;&#x2F; We store allocatedResources (which is Node.Status.Allocatable.*) explicitly
	&#x2F;&#x2F; as int64, to avoid conversions and accessing map.
	allocatableResource *Resource

	&#x2F;&#x2F; Cached taints of the node for faster lookup.
	taints    []v1.Taint
	taintsErr error

	&#x2F;&#x2F; imageStates holds the entry of an image if and only if this image is on the node. The entry can be used for
	&#x2F;&#x2F; checking an image&#39;s existence and advanced usage (e.g., image locality scheduling policy) based on the image
	&#x2F;&#x2F; state information.
	imageStates map[string]*ImageStateSummary

	&#x2F;&#x2F; TransientInfo holds the information pertaining to a scheduling cycle. This will be destructed at the end of
	&#x2F;&#x2F; scheduling cycle.
	&#x2F;&#x2F; TODO: @ravig. Remove this once we have a clear approach for message passing across predicates and priorities.
	TransientInfo *TransientSchedulerInfo

	&#x2F;&#x2F; Cached conditions of node for faster lookup.
	memoryPressureCondition v1.ConditionStatus
	diskPressureCondition   v1.ConditionStatus
	pidPressureCondition    v1.ConditionStatus

	&#x2F;&#x2F; Whenever NodeInfo changes, generation is bumped.
	&#x2F;&#x2F; This is used to avoid cloning it if the object didn&#39;t change.
	generation int64
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="ç»“æ„åˆ†æ-1"><a href="#ç»“æ„åˆ†æ-1" class="headerlink" title="ç»“æ„åˆ†æ"></a>ç»“æ„åˆ†æ</h4><ul>
<li><p>requestedResource *Resource: </p>
<ul>
<li>å·²ç»è°ƒåº¦åœ¨è¯¥Nodeä¸Šçš„èµ„æºæ€»å’Œ, åŒ…æ‹¬ä¸¤ç§çŠ¶æ€çš„Pod(å‚ç…§PodçŠ¶æ€å›¾)<ul>
<li>Assumed, ä½†æœªBinding. å³è¿™äº›Podéƒ½æ˜¯åœ¨waitForBindingQueueé‡Œ.</li>
<li>Added, å³å·²ç»BindToNode</li>
</ul>
</li>
<li>æ‰€ä»¥ç†è®ºä¸Šå­˜åœ¨è¿™ç§é—®é¢˜, å³å•ä¸ªNodeä¸Šå¤šä¸ªPodä¸€ç›´éƒ½waitForBinding, å¯¼è‡´è¯¥Nodeä¸Šèµ„æºä¸€ç›´è¢«å ç”¨æ— æ³•è¢«é‡Šæ”¾. (æ˜¯å¦æœ‰è¶…æ—¶æœºåˆ¶?)</li>
<li>å¦‚æœPodå·²ç»æ˜¯Binded&#x2F;AddedçŠ¶æ€, é‚£ä¹ˆä¼šä»requestResourceé‡Œåˆ é™¤æ‰ä¹ˆ? ä¸ä¼š.</li>
</ul>
</li>
<li><p>allocatableResource *Resource:</p>
<ul>
<li>è¯¥Nodeä¸Šæ€»èµ„æº. åº”è¯¥æ˜¯totalAmountçš„æ¦‚å¿µ.</li>
</ul>
</li>
<li><p>pods []*v1.Pod: è°ƒåº¦&#x2F;åˆ†é…åˆ°è¯¥Nodeçš„Podé˜Ÿåˆ—é›†åˆ.</p>
</li>
<li><p>podsWithAffinity []*v1.Pod: TODO: å¾…ç ”ç©¶</p>
</li>
<li><p>generation: æ ‡è¯†å½“å‰Nodeèµ„æºæ•°æ®çš„ç‰ˆæœ¬å·. æ¯æ¬¡AddPod, RemovePodæ“ä½œä¹‹å, éƒ½ä¼šæŠŠç‰ˆæœ¬å·+1</p>
</li>
<li><p>ç–‘é—®:</p>
<ul>
<li>è¯¥Nodeä¸Šæ€»èµ„æºæ˜¯å¤šå°‘(totalAmount)? allocatableResourceä¹ˆ?</li>
</ul>
</li>
</ul>
<h4 id="æ ¸å¿ƒæ“ä½œ-2"><a href="#æ ¸å¿ƒæ“ä½œ-2" class="headerlink" title="æ ¸å¿ƒæ“ä½œ"></a>æ ¸å¿ƒæ“ä½œ</h4><h5 id="AddPod"><a href="#AddPod" class="headerlink" title="AddPod"></a>AddPod</h5><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; AddPod adds pod information to this NodeInfo.
func (n *NodeInfo) AddPod(pod *v1.Pod) &#123;
	res, non0CPU, non0Mem :&#x3D; calculateResource(pod)
	n.requestedResource.MilliCPU +&#x3D; res.MilliCPU
	n.requestedResource.Memory +&#x3D; res.Memory
	n.requestedResource.EphemeralStorage +&#x3D; res.EphemeralStorage
	if n.requestedResource.ScalarResources &#x3D;&#x3D; nil &amp;&amp; len(res.ScalarResources) &gt; 0 &#123;
		n.requestedResource.ScalarResources &#x3D; map[v1.ResourceName]int64&#123;&#125;
	&#125;
	for rName, rQuant :&#x3D; range res.ScalarResources &#123;
		n.requestedResource.ScalarResources[rName] +&#x3D; rQuant
	&#125;
	n.nonzeroRequest.MilliCPU +&#x3D; non0CPU
	n.nonzeroRequest.Memory +&#x3D; non0Mem
	n.pods &#x3D; append(n.pods, pod)
	if hasPodAffinityConstraints(pod) &#123;
		n.podsWithAffinity &#x3D; append(n.podsWithAffinity, pod)
	&#125;

	&#x2F;&#x2F; Consume ports when pods added.
	n.UpdateUsedPorts(pod, true)

	n.generation &#x3D; nextGeneration()
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="æµç¨‹è¯´æ˜"><a href="#æµç¨‹è¯´æ˜" class="headerlink" title="æµç¨‹è¯´æ˜"></a>æµç¨‹è¯´æ˜</h6><ol>
<li>å°†Podè¯·æ±‚çš„èµ„æº(cpu, memç­‰)å åŠ åˆ°Nodeçš„requestedResourceé‡Œ.</li>
<li>NonzeroRequestä»£è¡¨å•¥æ„æ€? ç›®å‰æ²¡çœ‹æ˜ç™½</li>
<li>å°†Podæ”¾åˆ°Podé˜Ÿåˆ—å°¾éƒ¨.</li>
<li>å°†NodeInfoçš„ç‰ˆæœ¬å·+1</li>
</ol>
<h5 id="RemovePod"><a href="#RemovePod" class="headerlink" title="RemovePod"></a>RemovePod</h5><p>ä¸AddPodæ“ä½œå®Œå…¨ç›¸å. ä¸å†èµ˜è¿°. å°†NodeInfoçš„ç‰ˆæœ¬å·+1. </p>
<ul>
<li>è¿™é‡Œåæ§½ä¸‹, removeçš„æ—¶å€™, ç«Ÿç„¶æ˜¯å°†Podsçš„åˆ—è¡¨, ä»å¤´åˆ°å°¾éå†, å½“IDç­‰äºå½“å‰PodIDçš„æ—¶å€™, æ‰§è¡Œåˆ é™¤æ“ä½œ.</li>
</ul>
<h4 id="ç–‘é—®æ€»ç»“"><a href="#ç–‘é—®æ€»ç»“" class="headerlink" title="ç–‘é—®æ€»ç»“"></a>ç–‘é—®æ€»ç»“</h4><ol>
<li>åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡ŒAddPodæ“ä½œ? <ol>
<li>çœ‹èµ·æ¥æ˜¯åœ¨SchedulerCache.addPod, SchedulerCache.updatePod, SchedulerCache.assumePodçš„æ—¶å€™ä½¿ç”¨.</li>
<li>ä½†åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢? æ²¡æ‰¾åˆ°å…¥å£. åç»­ç»§ç»­çœ‹ä¸‹.</li>
</ol>
</li>
<li></li>
</ol>
<h1 id="Snapshotæœºåˆ¶"><a href="#Snapshotæœºåˆ¶" class="headerlink" title="Snapshotæœºåˆ¶"></a>Snapshotæœºåˆ¶</h1><h2 id="é‡ç‚¹"><a href="#é‡ç‚¹" class="headerlink" title="é‡ç‚¹"></a>é‡ç‚¹</h2><ol>
<li>æ‰“å¹³èŠ‚ç‚¹, æ·±æ‹·è´æœºåˆ¶</li>
<li>ç‰ˆæœ¬å·å¯¹æ¯”, å¢é‡æ›´æ–°æœºåˆ¶</li>
</ol>
<h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><h3 id="NodeInfoSnapshot"><a href="#NodeInfoSnapshot" class="headerlink" title="NodeInfoSnapshot"></a>NodeInfoSnapshot</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; NodeInfoSnapshot is a snapshot of cache NodeInfo. The scheduler takes a
&#x2F;&#x2F; snapshot at the beginning of each scheduling cycle and uses it for its
&#x2F;&#x2F; operations in that cycle.
type NodeInfoSnapshot struct &#123;
	NodeInfoMap map[string]*schedulernodeinfo.NodeInfo
	Generation  int64
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>NodeInfoMap: &lt;nodeName, NodeInfo&gt;,<ul>
<li>å³ä¸ºNodeNameåˆ°NodeInfoçš„ä¸€ä¸ªMap, æ˜¯ä»NodeInfoçš„é“¾è¡¨ä¸­å°†æ‰€æœ‰Nodeéƒ½æ·±æ‹·è´ä¸€ä»½, æ‰“å¹³äº†æ”¾åœ¨NodeInfoMapé‡Œ.</li>
<li>åŒæ—¶å¢åŠ äº†ç‰ˆæœ¬å·å¯¹æ¯”æœºåˆ¶, è¿™æ ·èƒ½ä¿è¯æ¯æ¬¡æ‰“snapshotæ—¶, éƒ½æ˜¯å¢é‡æ·±æ‹·è´&#x2F;æ›´æ–°, è€Œä¸æ˜¯å…¨é‡.</li>
</ul>
</li>
<li>Generation: å½“å‰Snapshotå¯¹åº”çš„æœ€æ–°ç‰ˆæœ¬å·, ç­‰äºæ‰“snapshotæ—¶, æ‰€æœ‰NodeInfoé‡Œçš„æœ€å¤§generationå€¼(å³é“¾è¡¨å¤´èŠ‚ç‚¹çš„generation).</li>
<li></li>
</ul>
<h2 id="é‡è¦æ“ä½œ"><a href="#é‡è¦æ“ä½œ" class="headerlink" title="é‡è¦æ“ä½œ"></a>é‡è¦æ“ä½œ</h2><p>scheduler_cacheä¸­çš„ä¸€ä¸ªæ–¹æ³•.</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; UpdateNodeInfoSnapshot takes a snapshot of cached NodeInfo map. This is called at
&#x2F;&#x2F; beginning of every scheduling cycle.
&#x2F;&#x2F; This function tracks generation number of NodeInfo and updates only the
&#x2F;&#x2F; entries of an existing snapshot that have changed after the snapshot was taken.
func (cache *schedulerCache) UpdateNodeInfoSnapshot(nodeSnapshot *NodeInfoSnapshot) error &#123;
	cache.mu.Lock()
	defer cache.mu.Unlock()
	balancedVolumesEnabled :&#x3D; utilfeature.DefaultFeatureGate.Enabled(features.BalanceAttachedNodeVolumes)

	&#x2F;&#x2F; Get the last generation of the the snapshot.
	snapshotGeneration :&#x3D; nodeSnapshot.Generation

	&#x2F;&#x2F; Start from the head of the NodeInfo doubly linked list and update snapshot
	&#x2F;&#x2F; of NodeInfos updated after the last snapshot.
	for node :&#x3D; cache.headNode; node !&#x3D; nil; node &#x3D; node.next &#123;
		if node.info.GetGeneration() &lt;&#x3D; snapshotGeneration &#123;
			&#x2F;&#x2F; all the nodes are updated before the existing snapshot. We are done.
			break
		&#125;
		if balancedVolumesEnabled &amp;&amp; node.info.TransientInfo !&#x3D; nil &#123;
			&#x2F;&#x2F; Transient scheduler info is reset here.
			node.info.TransientInfo.ResetTransientSchedulerInfo()
		&#125;
		if np :&#x3D; node.info.Node(); np !&#x3D; nil &#123;
			nodeSnapshot.NodeInfoMap[np.Name] &#x3D; node.info.Clone()
		&#125;
	&#125;
	&#x2F;&#x2F; Update the snapshot generation with the latest NodeInfo generation.
	if cache.headNode !&#x3D; nil &#123;
		nodeSnapshot.Generation &#x3D; cache.headNode.info.GetGeneration()
	&#125;

	if len(nodeSnapshot.NodeInfoMap) &gt; len(cache.nodes) &#123;
		for name :&#x3D; range nodeSnapshot.NodeInfoMap &#123;
			if _, ok :&#x3D; cache.nodes[name]; !ok &#123;
				delete(nodeSnapshot.NodeInfoMap, name)
			&#125;
		&#125;
	&#125;
	return nil
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ç”±äºCacheä¸­çš„Nodeæ˜¯ä¸ªåŒå‘é“¾è¡¨, ä¸”å¿…é¡»ä¿è¯é“¾è¡¨ä¸­æ‰€æœ‰Nodeçš„generationæ˜¯ä»é«˜åˆ°ä½æ’åºçš„.<ul>
<li>ä½†ç›®å‰çœ‹generationçš„æ›´æ–°æœºåˆ¶, generationä¸èƒ½ä¿è¯ä»é«˜åˆ°ä½æ’åº??</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>scheduler</tag>
        <tag>kube-scheduler</tag>
        <tag>kube-scheduler-cache</tag>
      </tags>
  </entry>
  <entry>
    <title>kube-schedulerç¬”è®°ä¹‹filter</title>
    <url>//2021-09-08-kube-scheduler-filter/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><ul>
<li>Predicates Policieså°±æ˜¯æä¾›ç»™Schedulerç”¨æ¥è¿‡æ»¤å‡ºæ»¡è¶³æ‰€å®šä¹‰æ¡ä»¶çš„Nodesï¼Œ<strong>å¹¶å‘çš„</strong>(æœ€å¤š16ä¸ªgoroutine)å¯¹æ¯ä¸ªNodeå¯åŠ¨æ‰€æœ‰Predicates Policiesçš„éå†Filterï¼Œçœ‹å…¶æ˜¯å¦éƒ½æ»¡è¶³é…ç½®çš„Predicates Policiesï¼Œè‹¥æœ‰ä¸€ä¸ªPolicyä¸æ»¡è¶³ï¼Œåˆ™ç›´æ¥è¢«æ·˜æ±°ã€‚</li>
</ul>
<h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// Filters the nodes to find the ones that fit based on the given predicate functions</span>
<span class="token comment">// Each node is passed through the predicate functions to determine if it is a fit</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>genericScheduler<span class="token punctuation">)</span> <span class="token function">findNodesThatFit</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> nodes <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> FailedPredicateMap<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> filtered <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node
	failedPredicateMap <span class="token operator">:=</span> FailedPredicateMap<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>predicates<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
		filtered <span class="token operator">=</span> nodes
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		allNodes <span class="token operator">:=</span> <span class="token function">int32</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">NodeTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NumNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		numNodesToFind <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">numFeasibleNodesToFind</span><span class="token punctuation">(</span>allNodes<span class="token punctuation">)</span>

		<span class="token comment">// Create filtered list with enough space to avoid growing it</span>
		<span class="token comment">// and allow assigning.</span>
		filtered <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> numNodesToFind<span class="token punctuation">)</span>
		errs <span class="token operator">:=</span> errors<span class="token punctuation">.</span>MessageCountMap<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
		<span class="token keyword">var</span> <span class="token punctuation">(</span>
			predicateResultLock sync<span class="token punctuation">.</span>Mutex
			filteredLen         <span class="token builtin">int32</span>
		<span class="token punctuation">)</span>

		ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithCancel</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token comment">// We can use the same metadata producer for all nodes.</span>
		meta <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">predicateMetaProducer</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">)</span>

		checkNode <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			nodeName <span class="token operator">:=</span> g<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">NodeTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			fits<span class="token punctuation">,</span> failedPredicates<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">podFitsOnNode</span><span class="token punctuation">(</span>
				pod<span class="token punctuation">,</span>
				meta<span class="token punctuation">,</span>
				g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span><span class="token punctuation">,</span>
				g<span class="token punctuation">.</span>predicates<span class="token punctuation">,</span>
				g<span class="token punctuation">.</span>schedulingQueue<span class="token punctuation">,</span>
				g<span class="token punctuation">.</span>alwaysCheckAllPredicates<span class="token punctuation">,</span>
			<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				predicateResultLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				errs<span class="token punctuation">[</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span>
				predicateResultLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">&#125;</span>
			<span class="token keyword">if</span> fits <span class="token punctuation">&#123;</span>
				length <span class="token operator">:=</span> atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>filteredLen<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> length <span class="token operator">></span> numNodesToFind <span class="token punctuation">&#123;</span>
					<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>filteredLen<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
					filtered<span class="token punctuation">[</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
				predicateResultLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				failedPredicateMap<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span> <span class="token operator">=</span> failedPredicates
				predicateResultLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>

		<span class="token comment">// Stops searching for more nodes once the configured number of feasible nodes</span>
		<span class="token comment">// are found.</span>
		workqueue<span class="token punctuation">.</span><span class="token function">ParallelizeUntil</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>allNodes<span class="token punctuation">)</span><span class="token punctuation">,</span> checkNode<span class="token punctuation">)</span>

		filtered <span class="token operator">=</span> filtered<span class="token punctuation">[</span><span class="token punctuation">:</span>filteredLen<span class="token punctuation">]</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>errs<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> FailedPredicateMap<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">CreateAggregateFromMessageCountMap</span><span class="token punctuation">(</span>errs<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>filtered<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>extenders<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> extender <span class="token operator">:=</span> <span class="token keyword">range</span> g<span class="token punctuation">.</span>extenders <span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> <span class="token operator">!</span>extender<span class="token punctuation">.</span><span class="token function">IsInterested</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">continue</span>
			<span class="token punctuation">&#125;</span>
			filteredList<span class="token punctuation">,</span> failedMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> extender<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> filtered<span class="token punctuation">,</span> g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">if</span> extender<span class="token punctuation">.</span><span class="token function">IsIgnorable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					klog<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">"Skipping extender %v as it returned error %v and has ignorable flag set"</span><span class="token punctuation">,</span>
						extender<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
					<span class="token keyword">continue</span>
				<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
					<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> FailedPredicateMap<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> err
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>

			<span class="token keyword">for</span> failedNodeName<span class="token punctuation">,</span> failedMsg <span class="token operator">:=</span> <span class="token keyword">range</span> failedMap <span class="token punctuation">&#123;</span>
				<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> found <span class="token operator">:=</span> failedPredicateMap<span class="token punctuation">[</span>failedNodeName<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">!</span>found <span class="token punctuation">&#123;</span>
					failedPredicateMap<span class="token punctuation">[</span>failedNodeName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>predicates<span class="token punctuation">.</span>PredicateFailureReason<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
				<span class="token punctuation">&#125;</span>
				failedPredicateMap<span class="token punctuation">[</span>failedNodeName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>failedPredicateMap<span class="token punctuation">[</span>failedNodeName<span class="token punctuation">]</span><span class="token punctuation">,</span> predicates<span class="token punctuation">.</span><span class="token function">NewFailureReason</span><span class="token punctuation">(</span>failedMsg<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
			filtered <span class="token operator">=</span> filteredList
			<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>filtered<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> filtered<span class="token punctuation">,</span> failedPredicateMap<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="PodFitsOnNode"><a href="#PodFitsOnNode" class="headerlink" title="PodFitsOnNode"></a>PodFitsOnNode</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">podFitsOnNode</span><span class="token punctuation">(</span>
	pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span>
	meta predicates<span class="token punctuation">.</span>PredicateMetadata<span class="token punctuation">,</span>
	info <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>NodeInfo<span class="token punctuation">,</span>
	predicateFuncs <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>predicates<span class="token punctuation">.</span>FitPredicate<span class="token punctuation">,</span>
	queue internalqueue<span class="token punctuation">.</span>SchedulingQueue<span class="token punctuation">,</span>
	alwaysCheckAllPredicates <span class="token builtin">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>predicates<span class="token punctuation">.</span>PredicateFailureReason<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> failedPredicates <span class="token punctuation">[</span><span class="token punctuation">]</span>predicates<span class="token punctuation">.</span>PredicateFailureReason

	podsAdded <span class="token operator">:=</span> <span class="token boolean">false</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		metaToUse <span class="token operator">:=</span> meta
		nodeInfoToUse <span class="token operator">:=</span> info
		<span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
			podsAdded<span class="token punctuation">,</span> metaToUse<span class="token punctuation">,</span> nodeInfoToUse <span class="token operator">=</span> <span class="token function">addNominatedPods</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> meta<span class="token punctuation">,</span> info<span class="token punctuation">,</span> queue<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token operator">!</span>podsAdded <span class="token operator">||</span> <span class="token function">len</span><span class="token punctuation">(</span>failedPredicates<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> predicateKey <span class="token operator">:=</span> <span class="token keyword">range</span> predicates<span class="token punctuation">.</span><span class="token function">Ordering</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">var</span> <span class="token punctuation">(</span>
				fit     <span class="token builtin">bool</span>
				reasons <span class="token punctuation">[</span><span class="token punctuation">]</span>predicates<span class="token punctuation">.</span>PredicateFailureReason
				err     <span class="token builtin">error</span>
			<span class="token punctuation">)</span>
			
			<span class="token keyword">if</span> predicate<span class="token punctuation">,</span> exist <span class="token operator">:=</span> predicateFuncs<span class="token punctuation">[</span>predicateKey<span class="token punctuation">]</span><span class="token punctuation">;</span> exist <span class="token punctuation">&#123;</span>
				fit<span class="token punctuation">,</span> reasons<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">predicate</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> metaToUse<span class="token punctuation">,</span> nodeInfoToUse<span class="token punctuation">)</span>
				<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
					<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>predicates<span class="token punctuation">.</span>PredicateFailureReason<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> err
				<span class="token punctuation">&#125;</span>

				<span class="token keyword">if</span> <span class="token operator">!</span>fit <span class="token punctuation">&#123;</span>
					<span class="token comment">// eCache is available and valid, and predicates result is unfit, record the fail reasons</span>
					failedPredicates <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>failedPredicates<span class="token punctuation">,</span> reasons<span class="token operator">...</span><span class="token punctuation">)</span>
					<span class="token comment">// if alwaysCheckAllPredicates is false, short circuit all predicates when one predicate fails.</span>
					<span class="token keyword">if</span> <span class="token operator">!</span>alwaysCheckAllPredicates <span class="token punctuation">&#123;</span>
						klog<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Infoln</span><span class="token punctuation">(</span><span class="token string">"since alwaysCheckAllPredicates has not been set, the predicate "</span> <span class="token operator">+</span>
							<span class="token string">"evaluation is short circuited and there are chances "</span> <span class="token operator">+</span>
							<span class="token string">"of other predicates failing as well."</span><span class="token punctuation">)</span>
						<span class="token keyword">break</span>
					<span class="token punctuation">&#125;</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>failedPredicates<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> failedPredicates<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="NominatedPods"><a href="#NominatedPods" class="headerlink" title="NominatedPods"></a>NominatedPods</h3><p>å½“enable PodPriority feature gateåï¼Œschedulerä¼šåœ¨é›†ç¾¤èµ„æºèµ„æºä¸è¶³æ—¶ä¸ºpreemptoræŠ¢å ä½ä¼˜å…ˆçº§çš„Podsï¼ˆæˆä¸ºvictimsï¼‰çš„èµ„æºï¼Œç„¶åpreemptorä¼šå†æ¬¡å…¥è°ƒåº¦é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸‹æ¬¡victimsçš„ä¼˜é›…ç»ˆæ­¢å¹¶è¿›è¡Œä¸‹ä¸€æ¬¡è°ƒåº¦ã€‚</p>
<p>ä¸ºäº†å°½é‡é¿å…ä»preemptoræŠ¢å èµ„æºåˆ°çœŸæ­£å†æ¬¡æ‰§è¡Œè°ƒåº¦è¿™ä¸ªæ—¶é—´æ®µçš„schedulerèƒ½æ„ŸçŸ¥åˆ°é‚£äº›èµ„æºå·²ç»è¢«æŠ¢å ï¼Œåœ¨schedulerè°ƒåº¦å…¶ä»–æ›´ä½ä¼˜å…ˆçº§çš„Podsæ—¶è€ƒè™‘è¿™äº›èµ„æºå·²ç»è¢«æŠ¢å ï¼Œå› æ­¤åœ¨æŠ¢å é˜¶æ®µï¼Œä¸ºç»™preemptorè®¾ç½®<code>pod.Status.NominatedNodeName</code>ï¼Œè¡¨ç¤ºåœ¨NominatedNodeNameä¸Šå‘ç”Ÿäº†æŠ¢å ï¼ŒpreemptoræœŸæœ›è°ƒåº¦åœ¨è¯¥nodeä¸Šã€‚</p>
<p>PriorityQueueä¸­ç¼“å­˜äº†æ¯ä¸ªnodeä¸Šçš„NominatedPodsï¼Œè¿™äº›NominatedPodsè¡¨ç¤ºå·²ç»è¢«è¯¥nodeæåçš„ï¼ŒæœŸæœ›è°ƒåº¦åœ¨è¯¥nodeä¸Šçš„ï¼Œä½†æ˜¯åˆè¿˜æ²¡æœ€ç»ˆæˆåŠŸè°ƒåº¦è¿‡æ¥çš„Podsã€‚</p>
<h3 id="CriticalPod-amp-NonCriticalPod"><a href="#CriticalPod-amp-NonCriticalPod" class="headerlink" title="CriticalPod&amp;NonCriticalPod"></a>CriticalPod&amp;NonCriticalPod</h3><p><a href="https://cloud.tencent.com/developer/article/1402111">https://cloud.tencent.com/developer/article/1402111</a></p>
<p>CriticalPod, ç”¨æ¥éƒ¨ç½²å…³é”®ç»„ä»¶, å¸Œæœ›èƒ½å¤Ÿ: </p>
<ol>
<li>è°ƒåº¦æ—¶, å³ä½¿èµ„æºä¸è¶³, ä»ç„¶èƒ½å¤Ÿè°ƒåº¦ä¸Šå». </li>
<li>ä¸èƒ½è¢«æŠ¢å </li>
</ol>
<h2 id="æ ¸å¿ƒæµç¨‹"><a href="#æ ¸å¿ƒæµç¨‹" class="headerlink" title="æ ¸å¿ƒæµç¨‹"></a>æ ¸å¿ƒæµç¨‹</h2><ol>
<li>æ ¹æ®NodeSize, ç¡®å®šFilterä¹‹åèƒ½å‚ä¸åç»­Weighterçš„Nodeä¸ªæ•°</li>
<li>g.cache.NodeTree().Next(): <ol>
<li>ä»cacheçš„NodeTreeä¸­ä¾æ¬¡è·å–NodeName, ä¾¿äºNodeæ‰“æ•£. </li>
<li>ä»snapshotçš„ä¸­æ ¹æ®NodeNameè·å–åˆ°Nodeå¯¹è±¡.</li>
</ol>
</li>
<li>podFitsOnNode(): åç»­è°ƒåº¦çš„</li>
<li></li>
</ol>
<pre class="line-numbers language-Go" data-language="Go"><code class="language-Go">var (
	predicatesOrdering &#x3D; []string&#123;CheckNodeConditionPred, CheckNodeUnschedulablePred,
		GeneralPred, HostNamePred, PodFitsHostPortsPred,
		MatchNodeSelectorPred, PodFitsResourcesPred, NoDiskConflictPred,
		PodToleratesNodeTaintsPred, PodToleratesNodeNoExecuteTaintsPred, CheckNodeLabelPresencePred,
		CheckServiceAffinityPred, MaxEBSVolumeCountPred, MaxGCEPDVolumeCountPred, MaxCSIVolumeCountPred,
		MaxAzureDiskVolumeCountPred, MaxCinderVolumeCountPred, CheckVolumeBindingPred, NoVolumeZoneConflictPred,
		CheckNodeMemoryPressurePred, CheckNodePIDPressurePred, CheckNodeDiskPressurePred, MatchInterPodAffinityPred&#125;
)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>











<h3 id="èµ„æºé‡Filter-x2F-Predicates"><a href="#èµ„æºé‡Filter-x2F-Predicates" class="headerlink" title="èµ„æºé‡Filter&#x2F;Predicates"></a>èµ„æºé‡Filter&#x2F;Predicates</h3><h4 id="NonCriticalPredicates"><a href="#NonCriticalPredicates" class="headerlink" title="NonCriticalPredicates"></a>NonCriticalPredicates</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>predicates<span class="token operator">/</span>predicates<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">1114</span> GeneralPredicates
pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>predicates<span class="token operator">/</span>predicates<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">1136</span> noncriticalPredicates
pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>predicates<span class="token operator">/</span>predicates<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">769</span> PodFitsResources

<span class="token keyword">func</span> <span class="token function">PodFitsResources</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> meta PredicateMetadata<span class="token punctuation">,</span> nodeInfo <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>NodeInfo<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>PredicateFailureReason<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	node <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">var</span> predicateFails <span class="token punctuation">[</span><span class="token punctuation">]</span>PredicateFailureReason
	allowedPodNumber <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">AllowedPodNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Podæ•°é‡æ ¡éªŒ</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>nodeInfo<span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> <span class="token operator">></span> allowedPodNumber <span class="token punctuation">&#123;</span>
		predicateFails <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">,</span> <span class="token function">NewInsufficientResourceError</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>ResourcePods<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>nodeInfo<span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>allowedPodNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">var</span> podRequest <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>Resource
	podRequest <span class="token operator">=</span> <span class="token function">GetResourceRequest</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span>
	allocatable <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">AllocatableResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// CPUé‡æ ¡éªŒ</span>
	<span class="token keyword">if</span> allocatable<span class="token punctuation">.</span>MilliCPU <span class="token operator">&lt;</span> podRequest<span class="token punctuation">.</span>MilliCPU<span class="token operator">+</span>nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MilliCPU <span class="token punctuation">&#123;</span>
		predicateFails <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">,</span> <span class="token function">NewInsufficientResourceError</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>ResourceCPU<span class="token punctuation">,</span> podRequest<span class="token punctuation">.</span>MilliCPU<span class="token punctuation">,</span> nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MilliCPU<span class="token punctuation">,</span> allocatable<span class="token punctuation">.</span>MilliCPU<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
  <span class="token comment">// MEMé‡æ ¡éªŒ</span>
	<span class="token keyword">if</span> allocatable<span class="token punctuation">.</span>Memory <span class="token operator">&lt;</span> podRequest<span class="token punctuation">.</span>Memory<span class="token operator">+</span>nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Memory <span class="token punctuation">&#123;</span>
		predicateFails <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">,</span> <span class="token function">NewInsufficientResourceError</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>ResourceMemory<span class="token punctuation">,</span> podRequest<span class="token punctuation">.</span>Memory<span class="token punctuation">,</span> nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Memory<span class="token punctuation">,</span> allocatable<span class="token punctuation">.</span>Memory<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> predicateFails<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="CriticalPredicates"><a href="#CriticalPredicates" class="headerlink" title="CriticalPredicates"></a>CriticalPredicates</h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>predicates<span class="token operator">/</span>predicates<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">1150</span> EssentialPredicates
<span class="token keyword">func</span> <span class="token function">EssentialPredicates</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> meta PredicateMetadata<span class="token punctuation">,</span> nodeInfo <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>NodeInfo<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>PredicateFailureReason<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> predicateFails <span class="token punctuation">[</span><span class="token punctuation">]</span>PredicateFailureReason
  <span class="token comment">// 1. PodFitsHostæ ¡éªŒ: (pod.Spec.NodeName == node.Name)</span>
	fit<span class="token punctuation">,</span> reasons<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">PodFitsHost</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> meta<span class="token punctuation">,</span> nodeInfo<span class="token punctuation">)</span>
  <span class="token comment">// 2. PodFitsHostPortsæ ¡éªŒ: ç«¯å£é‡æ˜¯å¦å……è¶³</span>
	fit<span class="token punctuation">,</span> reasons<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">PodFitsHostPorts</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> meta<span class="token punctuation">,</span> nodeInfo<span class="token punctuation">)</span>
  <span class="token comment">// 3. PodMatchNodeSelectoræ ¡éªŒ: </span>
	fit<span class="token punctuation">,</span> reasons<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">PodMatchNodeSelector</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> meta<span class="token punctuation">,</span> nodeInfo<span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> predicateFails<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="LabelåŒ¹é…"><a href="#LabelåŒ¹é…" class="headerlink" title="LabelåŒ¹é…"></a>LabelåŒ¹é…</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>predicates<span class="token operator">/</span>predicates<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">948</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>NodeLabelChecker<span class="token punctuation">)</span> <span class="token function">CheckNodeLabelPresence</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> meta PredicateMetadata<span class="token punctuation">,</span> nodeInfo <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>NodeInfo<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>PredicateFailureReason<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	node <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
	<span class="token keyword">var</span> exists <span class="token builtin">bool</span>
  <span class="token comment">// è·å–Nodeä¸Šçš„æ‰€æœ‰Label</span>
	nodeLabels <span class="token operator">:=</span> labels<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>Labels<span class="token punctuation">)</span>
  <span class="token comment">// éå†podè¯·æ±‚é‡Œçš„æ‰€æœ‰Label</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> label <span class="token operator">:=</span> <span class="token keyword">range</span> n<span class="token punctuation">.</span>labels <span class="token punctuation">&#123;</span>
    <span class="token comment">// å¦‚æœNodeçš„Labelæ²¡æœ‰åŒ…å«podè¯·æ±‚é‡Œçš„Label, é‚£ä¹ˆè¯æ˜è¯¥Nodeä¸åˆæ³•(ç¼ºå°‘å¯¹åº”çš„Label), åˆ™ç­›é™¤æ‰</span>
		exists <span class="token operator">=</span> nodeLabels<span class="token punctuation">.</span><span class="token function">Has</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>exists <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>n<span class="token punctuation">.</span>presence<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span>exists <span class="token operator">&amp;&amp;</span> n<span class="token punctuation">.</span>presence<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>PredicateFailureReason<span class="token punctuation">&#123;</span>ErrNodeLabelPresenceViolated<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://my.oschina.net/jxcdwangtao/blog/1818975">https://my.oschina.net/jxcdwangtao/blog/1818975</a></p>
<p><a href="https://my.oschina.net/jxcdwangtao/blog/826741">https://my.oschina.net/jxcdwangtao/blog/826741</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>scheduler</tag>
        <tag>kube-scheduler</tag>
      </tags>
  </entry>
  <entry>
    <title>kube-schedulerç¬”è®°</title>
    <url>//2021-09-08-kube-scheduler-overview/</url>
    <content><![CDATA[<h2 id="ä¸€è¨€æ¦‚ä¹‹"><a href="#ä¸€è¨€æ¦‚ä¹‹" class="headerlink" title="ä¸€è¨€æ¦‚ä¹‹"></a>ä¸€è¨€æ¦‚ä¹‹</h2><p>å°†PodSpec.NodeNameä¸ºç©ºçš„Podsé€ä¸ªåœ°ï¼Œç»è¿‡é¢„é€‰(Predicates)å’Œä¼˜é€‰(Priorities)ä¸¤ä¸ªæ­¥éª¤ï¼ŒæŒ‘é€‰æœ€åˆé€‚çš„Nodeä½œä¸ºè¯¥Podçš„Destinationã€‚</p>
<h2 id="æ¶æ„æ¦‚è¿°"><a href="#æ¶æ„æ¦‚è¿°" class="headerlink" title="æ¶æ„æ¦‚è¿°"></a>æ¶æ„æ¦‚è¿°</h2><ol>
<li>kube-schedulerä½œä¸ºkubernetes masterä¸Šä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æä¾›è°ƒåº¦æœåŠ¡ï¼Œé€šè¿‡â€“masteræŒ‡å®škube-api-serverçš„åœ°å€ï¼Œç”¨æ¥watch podå’Œnodeå’Œè°ƒç”¨api server bindæ¥å£å®Œæˆnodeå’Œpodçš„Bindæ“ä½œã€‚</li>
<li>kube-schedulerä¸­ç»´æŠ¤äº†ä¸€ä¸ªFIFOç±»å‹çš„PodQueue cacheï¼Œæ–°åˆ›å»ºçš„Podéƒ½ä¼šè¢«ConfigFactory watchåˆ°ï¼Œè¢«æ·»åŠ åˆ°è¯¥PodQueueä¸­ï¼Œæ¯æ¬¡è°ƒåº¦éƒ½ä»è¯¥PodQueueä¸­getNextPodä½œä¸ºå³å°†è°ƒåº¦çš„Podã€‚</li>
<li>è·å–åˆ°å¾…è°ƒåº¦çš„Podåï¼Œå°±æ‰§è¡ŒAlgorithmProvideré…ç½®Algorithmçš„Scheduleæ–¹æ³•è¿›è¡Œè°ƒåº¦ï¼Œæ•´ä¸ªè°ƒåº¦è¿‡ç¨‹åˆ†ä¸¤ä¸ªå…³é”®æ­¥éª¤ï¼šPredicateså’ŒPrioritiesï¼Œæœ€ç»ˆé€‰å‡ºä¸€ä¸ªæœ€é€‚åˆè¯¥Podå€Ÿå®¿çš„Nodeè¿”å›ã€‚</li>
<li>æ›´æ–°SchedulerCacheä¸­Podçš„çŠ¶æ€(AssumePod)ï¼Œæ ‡å¿—è¯¥Podä¸ºscheduledï¼Œå¹¶æ›´æ–°åˆ°å¯¹åº”çš„NodeInfoä¸­ã€‚</li>
<li>è°ƒç”¨api serverçš„Bindæ¥å£ï¼Œå®Œæˆnodeå’Œpodçš„Bindæ“ä½œï¼Œå¦‚æœBindå¤±è´¥ï¼Œä»SchedulerCacheä¸­åˆ é™¤ä¸Šä¸€æ­¥ä¸­å·²ç»Assumedçš„Podã€‚</li>
</ol>
<h2 id="é‡è¦ç–‘é—®"><a href="#é‡è¦ç–‘é—®" class="headerlink" title="é‡è¦ç–‘é—®"></a>é‡è¦ç–‘é—®</h2><ol>
<li>å¦‚ä½•å®ç°äº²å’Œæ€§&#x2F;åäº²å’Œæ€§è°ƒåº¦?<ol>
<li>å‚è§äº²å’Œæ€§è°ƒåº¦éƒ¨åˆ†</li>
</ol>
</li>
<li>å¦‚ä½•åšåˆ°Weighter?</li>
<li>NCå®é™…èµ„æºä¸Schedulerç¼“å­˜çš„èµ„æºä¸€è‡´æ€§å¦‚ä½•ä¿è¯?<ol>
<li>snapshotæœºåˆ¶, æ— æ³•ä¿è¯, åªæ˜¯åœ¨è°ƒåº¦å‰éƒ½æ‹¿è¯¥èµ„æº</li>
<li>åŒæ—¶å°†èµ„æºçš„æ“ä½œéƒ½åœ¨schedulerè¿›è¡Œæ”¶å£</li>
</ol>
</li>
<li>å¦‚æœå•ä¸ªPodè°ƒåº¦å¤±è´¥(æ— è®ºæ˜¯åœ¨Filter&amp;Weigheré˜¶æ®µ, è¿˜æ˜¯åœ¨assumeé˜¶æ®µ, è¿˜æ˜¯åœ¨Bindé˜¶æ®µ), è¿™ä¸ªPodä¹‹åè¿˜ä¼šè¢«é‡è¯•è°ƒåº¦ä¹ˆ? è¿˜æ˜¯è¯´ç›´æ¥å¤±è´¥? </li>
<li>æ˜¯å¦æœ‰ç±»ä¼¼ReservationåŠŸèƒ½å‘¢? </li>
<li>æŠ¢å å¼è°ƒåº¦æ˜¯å¦‚ä½•å®ç°çš„? <ol>
<li>å‚è§æŠ¢å å¼è°ƒåº¦éƒ¨åˆ†</li>
</ol>
</li>
<li>è°ƒåº¦å‘ç”Ÿæ—¶æœºæ˜¯æ€æ ·çš„? æ˜¯å¦æ”¯æŒçƒ­è¿ç§»? æ˜¯å¦æœ‰ç¦»çº¿è§„åˆ’? <ol>
<li>æ— çƒ­è¿ç§»éœ€æ±‚. </li>
<li>åªæœ‰ASIæœ‰ç¦»çº¿è§„åˆ’æƒ…å†µ.</li>
</ol>
</li>
</ol>
<h2 id="ç»“æ„åˆ†æ"><a href="#ç»“æ„åˆ†æ" class="headerlink" title="ç»“æ„åˆ†æ"></a>ç»“æ„åˆ†æ</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> genericScheduler <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	cache                    internalcache<span class="token punctuation">.</span>Cache
	schedulingQueue          internalqueue<span class="token punctuation">.</span>SchedulingQueue
	predicates               <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>predicates<span class="token punctuation">.</span>FitPredicate
	priorityMetaProducer     priorities<span class="token punctuation">.</span>PriorityMetadataProducer
	predicateMetaProducer    predicates<span class="token punctuation">.</span>PredicateMetadataProducer
	prioritizers             <span class="token punctuation">[</span><span class="token punctuation">]</span>priorities<span class="token punctuation">.</span>PriorityConfig
	pluginSet                pluginsv1alpha1<span class="token punctuation">.</span>PluginSet
	extenders                <span class="token punctuation">[</span><span class="token punctuation">]</span>algorithm<span class="token punctuation">.</span>SchedulerExtender
	lastNodeIndex            <span class="token builtin">uint64</span>
	alwaysCheckAllPredicates <span class="token builtin">bool</span>
	nodeInfoSnapshot         internalcache<span class="token punctuation">.</span>NodeInfoSnapshot
	volumeBinder             <span class="token operator">*</span>volumebinder<span class="token punctuation">.</span>VolumeBinder
	pvcLister                corelisters<span class="token punctuation">.</span>PersistentVolumeClaimLister
	pdbLister                algorithm<span class="token punctuation">.</span>PDBLister
	disablePreemption        <span class="token builtin">bool</span>
	percentageOfNodesToScore <span class="token builtin">int32</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>cache: è°ƒåº¦çš„cache</li>
<li>nodeInfoSnapshot: nodeçš„snapshot, è¯¦ç»†åˆ†æå‚è§â€Scheduler Cacheç ”ç©¶â€</li>
<li>schedulingQueue:  <ul>
<li>å‚è§: pkg&#x2F;scheduler&#x2F;internal&#x2F;queue&#x2F;scheduling_queue.go</li>
<li>æœ¬è´¨ä¸Šæ˜¯PriorityQueue, è¯¦ç»†åˆ†æå‚è§: â€œScheduler Queueç ”ç©¶â€</li>
</ul>
</li>
<li></li>
</ul>
<h2 id="å…³é”®æ“ä½œ"><a href="#å…³é”®æ“ä½œ" class="headerlink" title="å…³é”®æ“ä½œ"></a>å…³é”®æ“ä½œ</h2><h3 id="1-ScheduleOne"><a href="#1-ScheduleOne" class="headerlink" title="1. ScheduleOne"></a>1. ScheduleOne</h3><h4 id="1-1-ä»£ç "><a href="#1-1-ä»£ç " class="headerlink" title="1.1 ä»£ç "></a>1.1 ä»£ç </h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>scheduler<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">436</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>sched <span class="token operator">*</span>Scheduler<span class="token punctuation">)</span> <span class="token function">scheduleOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 1. ä»??è·å–åˆ°è¦è°ƒåº¦çš„Podä¿¡æ¯</span>
  pod <span class="token operator">:=</span> sched<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">NextPod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 2. æ‰§è¡Œè°ƒåº¦, æ‰¾åˆ°åˆé€‚çš„Node</span>
	scheduleResult<span class="token punctuation">,</span> err <span class="token operator">:=</span> sched<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span>

	<span class="token comment">// 3. æ‰§è¡ŒNodeèµ„æºæ‰£å‡</span>
  assumedPod <span class="token operator">:=</span> pod<span class="token punctuation">.</span><span class="token function">DeepCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	err <span class="token operator">=</span> sched<span class="token punctuation">.</span><span class="token function">assume</span><span class="token punctuation">(</span>assumedPod<span class="token punctuation">,</span> scheduleResult<span class="token punctuation">.</span>SuggestedHost<span class="token punctuation">)</span>

	<span class="token comment">// 4. æ‰§è¡ŒBindæµç¨‹</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// 4.1 æ‰§è¡Œprebind, å¦‚æœæ— æ³•bindé€šè¿‡, åˆ™å°†Nodeèµ„æºå½’è¿˜</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> pl <span class="token operator">:=</span> <span class="token keyword">range</span> plugins<span class="token punctuation">.</span><span class="token function">PrebindPlugins</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			approved<span class="token punctuation">,</span> err <span class="token operator">:=</span> pl<span class="token punctuation">.</span><span class="token function">Prebind</span><span class="token punctuation">(</span>plugins<span class="token punctuation">,</span> assumedPod<span class="token punctuation">,</span> scheduleResult<span class="token punctuation">.</span>SuggestedHost<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token operator">!</span>approved <span class="token punctuation">&#123;</span>
				forgetErr <span class="token operator">:=</span> sched<span class="token punctuation">.</span><span class="token function">Cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForgetPod</span><span class="token punctuation">(</span>assumedPod<span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token comment">// 4.2 æ‰§è¡Œbind, å¦‚æœæ— æ³•bindé€šè¿‡, æ­¤bindæ–¹æ³•é‡Œå°†Nodeèµ„æºå½’è¿˜</span>
		err <span class="token operator">:=</span> sched<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>assumedPod<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">.</span>Binding<span class="token punctuation">&#123;</span>
			ObjectMeta<span class="token punctuation">:</span> metav1<span class="token punctuation">.</span>ObjectMeta<span class="token punctuation">&#123;</span>Namespace<span class="token punctuation">:</span> assumedPod<span class="token punctuation">.</span>Namespace<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> assumedPod<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> UID<span class="token punctuation">:</span> assumedPod<span class="token punctuation">.</span>UID<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
			Target<span class="token punctuation">:</span> v1<span class="token punctuation">.</span>ObjectReference<span class="token punctuation">&#123;</span>
				Kind<span class="token punctuation">:</span> <span class="token string">"Node"</span><span class="token punctuation">,</span>
				Name<span class="token punctuation">:</span> scheduleResult<span class="token punctuation">.</span>SuggestedHost<span class="token punctuation">,</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="1-2-æ“ä½œè¯¦è§£"><a href="#1-2-æ“ä½œè¯¦è§£" class="headerlink" title="1.2 æ“ä½œè¯¦è§£"></a>1.2 æ“ä½œè¯¦è§£</h4><ul>
<li>æœ¬è´¨ä¸Šå°±åˆ†ä¸ºä¸Šè¾¹4æ­¥, æ¸…æ™°æ˜“æ‡‚.</li>
</ul>
<h3 id="2-Schedule"><a href="#2-Schedule" class="headerlink" title="2. Schedule"></a>2. Schedule</h3><h4 id="1-1-ä»£ç -1"><a href="#1-1-ä»£ç -1" class="headerlink" title="1.1 ä»£ç "></a>1.1 ä»£ç </h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">generic_scheduler<span class="token punctuation">.</span><span class="token keyword">go</span>

<span class="token comment">// Schedule tries to schedule the given pod to one of the nodes in the node list.</span>
<span class="token comment">// If it succeeds, it will return the name of the node.</span>
<span class="token comment">// If it fails, it will return a FitError error with reasons.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>genericScheduler<span class="token punctuation">)</span> <span class="token function">Schedule</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> nodeLister algorithm<span class="token punctuation">.</span>NodeLister<span class="token punctuation">)</span> <span class="token punctuation">(</span>result ScheduleResult<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

<span class="token comment">// 1. è·å–æœ€æ–°Nodeä¿¡æ¯</span>
	nodes<span class="token punctuation">,</span> err <span class="token operator">:=</span> nodeLister<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 2. ç”¨Nodeä¿¡æ¯æ›´æ–°åˆ°schedulerçš„ç¼“å­˜ä¸­, æ‰“ä¸ªå¿«ç…§</span>
  g<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. æ‰§è¡Œfilter</span>
	filteredNodes<span class="token punctuation">,</span> failedPredicateMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">findNodesThatFit</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> nodes<span class="token punctuation">)</span>
<span class="token comment">// 4. æ‰§è¡Œweighter</span>
	metaPrioritiesInterface <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">priorityMetaProducer</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">)</span>
	priorityList<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">PrioritizeNodes</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">,</span> metaPrioritiesInterface<span class="token punctuation">,</span> g<span class="token punctuation">.</span>prioritizers<span class="token punctuation">,</span> filteredNodes<span class="token punctuation">,</span> g<span class="token punctuation">.</span>extenders<span class="token punctuation">)</span>
<span class="token comment">// å¦‚æœç›¸åŒpriority, åˆ™æ ¹æ®roundrobinç®—æ³•ä»listä¸­è·å–éšæœºNC</span>
	host<span class="token punctuation">,</span> err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">selectHost</span><span class="token punctuation">(</span>priorityList<span class="token punctuation">)</span>
	<span class="token keyword">return</span> ScheduleResult<span class="token punctuation">&#123;</span>
		SuggestedHost<span class="token punctuation">:</span>  host<span class="token punctuation">,</span>
		EvaluatedNodes<span class="token punctuation">:</span> <span class="token function">len</span><span class="token punctuation">(</span>filteredNodes<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">len</span><span class="token punctuation">(</span>failedPredicateMap<span class="token punctuation">)</span><span class="token punctuation">,</span>
		FeasibleNodes<span class="token punctuation">:</span>  <span class="token function">len</span><span class="token punctuation">(</span>filteredNodes<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> err
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="1-2-æ“ä½œè¯¦è§£-1"><a href="#1-2-æ“ä½œè¯¦è§£-1" class="headerlink" title="1.2. æ“ä½œè¯¦è§£"></a>1.2. æ“ä½œè¯¦è§£</h4><ol>
<li>nodeLister.list? éœ€è¦æ•´ä½“çœ‹ä¸‹listæœºåˆ¶.</li>
<li>g.snapshot(): ç»™æ‰€æœ‰Nodeæ‰“ä¸€æ¬¡å¿«ç…§. å…·ä½“å‚è§Cache Snapshotæœºåˆ¶</li>
</ol>
<h3 id="2-findNodesThatFit"><a href="#2-findNodesThatFit" class="headerlink" title="2. findNodesThatFit"></a>2. findNodesThatFit</h3><h4 id="2-1-ä»£ç "><a href="#2-1-ä»£ç " class="headerlink" title="2.1 ä»£ç "></a>2.1 ä»£ç </h4><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>genericScheduler<span class="token punctuation">)</span> <span class="token function">findNodesThatFit</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> nodes <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> FailedPredicateMap<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  
	<span class="token keyword">var</span> filtered <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node

  <span class="token comment">// 1. æ ¹æ®æ‰€æœ‰Nodeä¸ªæ•°, ç¡®å®šæœ€ç»ˆFilterä¹‹åæœ€å¤§çš„Nodeä¸ªæ•°, ç¼©å°ä¹‹åWeighterçš„èŒƒå›´</span>
	allNodes <span class="token operator">:=</span> <span class="token function">int32</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">NodeTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NumNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	numNodesToFind <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">numFeasibleNodesToFind</span><span class="token punctuation">(</span>allNodes<span class="token punctuation">)</span>
	filtered <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Node<span class="token punctuation">,</span> numNodesToFind<span class="token punctuation">)</span>
	meta <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">predicateMetaProducer</span><span class="token punctuation">(</span>pod<span class="token punctuation">,</span> g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">)</span>

  <span class="token comment">// 2. æ ¹æ®NodeTreeç»“æ„, æ‰¾ä¸‹ä¸€ä¸ªNode, åˆ¤æ–­Nodeèµ„æºæ˜¯å¦èƒ½æ»¡è¶³Podèµ„æºè¯·æ±‚</span>
	checkNode <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		nodeName <span class="token operator">:=</span> g<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">NodeTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fits<span class="token punctuation">,</span> failedPredicates<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">podFitsOnNode</span><span class="token punctuation">(</span>
			pod<span class="token punctuation">,</span>
			meta<span class="token punctuation">,</span>
			g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span><span class="token punctuation">,</span>
			g<span class="token punctuation">.</span>predicates<span class="token punctuation">,</span>
			g<span class="token punctuation">.</span>schedulingQueue<span class="token punctuation">,</span>
			g<span class="token punctuation">.</span>alwaysCheckAllPredicates<span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
		<span class="token keyword">if</span> fits <span class="token punctuation">&#123;</span>
			length <span class="token operator">:=</span> atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>filteredLen<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> length <span class="token operator">></span> numNodesToFind <span class="token punctuation">&#123;</span>
				atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>filteredLen<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
				filtered<span class="token punctuation">[</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> g<span class="token punctuation">.</span>nodeInfoSnapshot<span class="token punctuation">.</span>NodeInfoMap<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

  <span class="token comment">// 3. ç±»ä¼¼Fork&amp;Join, å¯åŠ¨16ä¸ªåç¨‹å¹¶è¡Œè¿›è¡ŒFilter</span>
	workqueue<span class="token punctuation">.</span><span class="token function">ParallelizeUntil</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>allNodes<span class="token punctuation">)</span><span class="token punctuation">,</span> checkNode<span class="token punctuation">)</span>

	<span class="token keyword">return</span> filtered<span class="token punctuation">,</span> failedPredicateMap<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-1-æ“ä½œè¯¦è§£"><a href="#2-1-æ“ä½œè¯¦è§£" class="headerlink" title="2.1 æ“ä½œè¯¦è§£"></a>2.1 æ“ä½œè¯¦è§£</h4><ol>
<li>éå†Node, ä½¿ç”¨çš„æ˜¯NodeTree.next()æœºåˆ¶, è¿™æ ·å°±å¿…é¡»ä¿è¯NodeTree.next()æ˜¯çº¿ç¨‹å®‰å…¨çš„. K8Sé‡Œé‡‡ç”¨mutexä¿¡å·é‡æ¥ä¿éšœ</li>
<li>å…·ä½“NodeTreeçš„æœºåˆ¶, å‚è§å•ç‹¬æ–‡ç« .</li>
</ol>
<h3 id="3-PodFitsResources"><a href="#3-PodFitsResources" class="headerlink" title="3. PodFitsResources"></a>3. PodFitsResources</h3><h4 id="3-1-æ ¸å¿ƒä»£ç "><a href="#3-1-æ ¸å¿ƒä»£ç " class="headerlink" title="3.1 æ ¸å¿ƒä»£ç "></a>3.1 æ ¸å¿ƒä»£ç </h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">pkg<span class="token operator">/</span>scheduler<span class="token operator">/</span>algorithm<span class="token operator">/</span>predicates<span class="token operator">/</span>predicates<span class="token punctuation">.</span><span class="token keyword">go</span><span class="token punctuation">:</span><span class="token number">769</span>

<span class="token keyword">func</span> <span class="token function">PodFitsResources</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> meta PredicateMetadata<span class="token punctuation">,</span> nodeInfo <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>NodeInfo<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>PredicateFailureReason<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  node <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 1. æ£€æŸ¥æ˜¯å¦è¶…è¿‡NCä¸Šå…è®¸è°ƒåº¦çš„Podä¸ªæ•°ä¸Šé™</span>
	allowedPodNumber <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">AllowedPodNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>nodeInfo<span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> <span class="token operator">></span> allowedPodNumber <span class="token punctuation">&#123;</span>
		predicateFails <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">,</span> <span class="token function">NewInsufficientResourceError</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>ResourcePods<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>nodeInfo<span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>allowedPodNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

  <span class="token comment">// 2. è®¡ç®—å‡ºPodçš„èµ„æºè¯·æ±‚é‡</span>
	<span class="token keyword">var</span> podRequest <span class="token operator">*</span>schedulernodeinfo<span class="token punctuation">.</span>Resource
	podRequest <span class="token operator">=</span> <span class="token function">GetResourceRequest</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span>

	allocatable <span class="token operator">:=</span> nodeInfo<span class="token punctuation">.</span><span class="token function">AllocatableResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 3. åˆ¤æ–­Node.totalVcpu - podRequest.Vcpu - Node.usedVcpuæ˜¯å¦OK</span>
	<span class="token keyword">if</span> allocatable<span class="token punctuation">.</span>MilliCPU <span class="token operator">&lt;</span> podRequest<span class="token punctuation">.</span>MilliCPU<span class="token operator">+</span>nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MilliCPU <span class="token punctuation">&#123;</span>
		predicateFails <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">,</span> <span class="token function">NewInsufficientResourceError</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>ResourceCPU<span class="token punctuation">,</span> podRequest<span class="token punctuation">.</span>MilliCPU<span class="token punctuation">,</span> nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MilliCPU<span class="token punctuation">,</span> allocatable<span class="token punctuation">.</span>MilliCPU<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> allocatable<span class="token punctuation">.</span>Memory <span class="token operator">&lt;</span> podRequest<span class="token punctuation">.</span>Memory<span class="token operator">+</span>nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Memory <span class="token punctuation">&#123;</span>
		predicateFails <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">,</span> <span class="token function">NewInsufficientResourceError</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>ResourceMemory<span class="token punctuation">,</span> podRequest<span class="token punctuation">.</span>Memory<span class="token punctuation">,</span> nodeInfo<span class="token punctuation">.</span><span class="token function">RequestedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Memory<span class="token punctuation">,</span> allocatable<span class="token punctuation">.</span>Memory<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>predicateFails<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> predicateFails<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-2-æ“ä½œè¯¦è§£"><a href="#3-2-æ“ä½œè¯¦è§£" class="headerlink" title="3.2 æ“ä½œè¯¦è§£"></a>3.2 æ“ä½œè¯¦è§£</h4><ol>
<li>Nodeä¸Šé‡è¦çš„å‡ ä¸ªèµ„æºå­—æ®µ:<ol>
<li>nodeInfo.AllocatableResource(): ä»£è¡¨è¯¥Nodeä¸Šæ‰€æœ‰çš„CPUé‡. ä¸openstackçš„totalCpuç›¸åŒ</li>
<li>podRequest.MilliCPU: ä»£è¡¨è¯¥æ–°Podæ‰€éœ€æ±‚çš„CPUé‡. </li>
<li>nodeInfo.RequestedResource(): <ol>
<li>ä»£è¡¨å·²ç»è°ƒåº¦åˆ°è¯¥Nodeä¸ŠPodså·²ç»å ç”¨çš„èµ„æº. ä¸openstackçš„usedCpuç›¸åŒ</li>
<li>åŒ…å«äº†å·²ç»assumedçš„, ä½†è¿˜æ²¡æœ‰å®é™…bindåˆ°Nodeä¸Šçš„Podèµ„æº.</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="4-assume"><a href="#4-assume" class="headerlink" title="4. assume"></a>4. assume</h3><h4 id="4-1-æ ¸å¿ƒä»£ç "><a href="#4-1-æ ¸å¿ƒä»£ç " class="headerlink" title="4.1 æ ¸å¿ƒä»£ç "></a>4.1 æ ¸å¿ƒä»£ç </h4><pre class="line-numbers language-go" data-language="go"><code class="language-go">
<span class="token keyword">func</span> <span class="token punctuation">(</span>sched <span class="token operator">*</span>Scheduler<span class="token punctuation">)</span> <span class="token function">assume</span><span class="token punctuation">(</span>assumed <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> host <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	assumed<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>NodeName <span class="token operator">=</span> host
	sched<span class="token punctuation">.</span>config<span class="token punctuation">.</span>SchedulerCache<span class="token punctuation">.</span><span class="token function">AssumePod</span><span class="token punctuation">(</span>assumed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>cache <span class="token operator">*</span>schedulerCache<span class="token punctuation">)</span> <span class="token function">AssumePod</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	key<span class="token punctuation">,</span> err <span class="token operator">:=</span> schedulernodeinfo<span class="token punctuation">.</span><span class="token function">GetPodKey</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span>

	<span class="token comment">// podNameä¹‹å‰ä¸èƒ½åœ¨podStatesé‡Œ</span>
	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> cache<span class="token punctuation">.</span>podStates<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"pod %v is in the cache, so can't be assumed"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	cache<span class="token punctuation">.</span><span class="token function">addPod</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span>
	ps <span class="token operator">:=</span> <span class="token operator">&amp;</span>podState<span class="token punctuation">&#123;</span>
		pod<span class="token punctuation">:</span> pod<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	cache<span class="token punctuation">.</span>podStates<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> ps
	cache<span class="token punctuation">.</span>assumedPods<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>cache <span class="token operator">*</span>schedulerCache<span class="token punctuation">)</span> <span class="token function">addPod</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	n<span class="token punctuation">,</span> ok <span class="token operator">:=</span> cache<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>pod<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>NodeName<span class="token punctuation">]</span>	
  <span class="token comment">// è§ä¸‹æ–¹è¯¦è§£</span>
	n<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">AddPod</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span>
 <span class="token comment">// å°†Nodeç§»åŠ¨åˆ°åŒé“¾è¡¨çš„å¤´éƒ¨</span>
	cache<span class="token punctuation">.</span><span class="token function">moveNodeInfoToHead</span><span class="token punctuation">(</span>pod<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>NodeName<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>NodeInfo<span class="token punctuation">)</span> <span class="token function">AddPod</span><span class="token punctuation">(</span>pod <span class="token operator">*</span>v1<span class="token punctuation">.</span>Pod<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 1. è®¡ç®—Podæ‰€éœ€èµ„æº</span>
	res<span class="token punctuation">,</span> non0CPU<span class="token punctuation">,</span> non0Mem <span class="token operator">:=</span> <span class="token function">calculateResource</span><span class="token punctuation">(</span>pod<span class="token punctuation">)</span>
  <span class="token comment">// 2. å°†Podæ‰€éœ€èµ„æºå åŠ åˆ°Node.requestedResourceä¸Š</span>
	n<span class="token punctuation">.</span>requestedResource<span class="token punctuation">.</span>MilliCPU <span class="token operator">+=</span> res<span class="token punctuation">.</span>MilliCPU
	n<span class="token punctuation">.</span>requestedResource<span class="token punctuation">.</span>Memory <span class="token operator">+=</span> res<span class="token punctuation">.</span>Memory
  <span class="token comment">// 3. å°†Podå¾—åŠ åˆ°Node.podsåˆ—è¡¨ä¸Š</span>
	n<span class="token punctuation">.</span>pods <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>pods<span class="token punctuation">,</span> pod<span class="token punctuation">)</span>
  <span class="token comment">// 4. æ›´æ–°Node.generation</span>
	n<span class="token punctuation">.</span>generation <span class="token operator">=</span> <span class="token function">nextGeneration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¦‚ä¸‹é‡è¦æ“ä½œæ¬¡åº:</p>
<ul>
<li>å°†podæ”¾åˆ°cacheä¸­Nodeçš„pods[]åˆ—è¡¨ä¸­</li>
<li>å°†podéœ€æ±‚çš„èµ„æºé‡å åŠ åˆ°Nodeçš„requestedResourceä¸­(æ³¨æ„åœ¨è°ƒåº¦filterçš„æ—¶å€™, åˆ¤æ–­å·²ç»å ç”¨çš„èµ„æº, ç”¨çš„å°±æ˜¯è¿™ä¸ªå­—æ®µ).</li>
<li>æ›´æ–°Nodeçš„generation, å°†Nodeæ”¾åˆ°NodeåŒå‘é“¾è¡¨çš„å¤´éƒ¨(æ–¹ä¾¿æ‰“å¢é‡snapshot)</li>
</ul>
<p>ç–‘é—®&amp;å…³æ³¨ç‚¹:</p>
<ul>
<li>å¦‚ä½•é˜²æ­¢Nodeèµ„æºè¶…å–? å³å°†podæ”¾åˆ°Nodeçš„pods[]åˆ—è¡¨ä¸­çš„æ—¶å€™, Nodeæœ¬èº«èµ„æºå‘ç”Ÿäº†å˜åŒ–, å¯¼è‡´useResource&gt;totalResource?</li>
<li></li>
</ul>
<h3 id="5-bind"><a href="#5-bind" class="headerlink" title="5. bind"></a>5. bind</h3><h4 id="5-1-æ ¸å¿ƒä»£ç "><a href="#5-1-æ ¸å¿ƒä»£ç " class="headerlink" title="5.1 æ ¸å¿ƒä»£ç "></a>5.1 æ ¸å¿ƒä»£ç </h4><p>Bindingç»“æ„æ ¸å¿ƒ: </p>
<pre class="line-numbers language-Go" data-language="Go"><code class="language-Go">err :&#x3D; sched.bind(assumedPod, &amp;v1.Binding&#123;
   ObjectMeta: metav1.ObjectMeta&#123;Namespace: assumedPod.Namespace, Name: assumedPod.Name, UID: assumedPod.UID&#125;,
   Target: v1.ObjectReference&#123;
      Kind: &quot;Node&quot;,
      Name: scheduleResult.SuggestedHost,
   &#125;,
&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>bindé€»è¾‘æ ¸å¿ƒ:</p>
<pre class="line-numbers language-Go" data-language="Go"><code class="language-Go">func (sched *Scheduler) bind(assumed *v1.Pod, b *v1.Binding) error &#123;
  &#x2F;&#x2F; 1. è·å–Binder, å¹¶è°ƒç”¨RPCæ¥å£, è®©å¯¹åº”Nodeæ‰§è¡Œç»‘å®šPod
   err :&#x3D; sched.config.GetBinder(assumed).Bind(b)
   if err !&#x3D; nil &#123;
      sched.config.SchedulerCache.ForgetPod(assumed)
      return err
   &#125;
   return nil
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é€†å‘æµç¨‹: </p>
<pre class="line-numbers language-Go" data-language="Go"><code class="language-Go">func (cache *schedulerCache) ForgetPod(pod *v1.Pod) error &#123;
  &#x2F;&#x2F; 1. è·å–PodID
   key, err :&#x3D; schedulernodeinfo.GetPodKey(pod)

   currState, ok :&#x3D; cache.podStates[key]
   case ok &amp;&amp; cache.assumedPods[key]:
       &#x2F;&#x2F; 2. å°†podä»SchedulerCacheä¸­ç§»é™¤
      err :&#x3D; cache.removePod(pod)
      delete(cache.assumedPods, key)
      delete(cache.podStates, key)
   return nil
&#125;

func (cache *schedulerCache) removePod(pod *v1.Pod) error &#123;
  &#x2F;&#x2F; 1. æ‰¾åˆ°è¯¥Podè°ƒåº¦åˆ°çš„Node, ä»NodeInfoä¸­ç§»é™¤è¯¥Pod
	n, ok :&#x3D; cache.nodes[pod.Spec.NodeName]
  err :&#x3D; n.info.RemovePod(pod)
	if len(n.info.Pods()) &#x3D;&#x3D; 0 &amp;&amp; n.info.Node() &#x3D;&#x3D; nil &#123;
    &#x2F;&#x2F; 2. å°†ç©ºçš„Nodeä»é“¾è¡¨ä¸­ç§»é™¤
		cache.removeNodeInfoFromList(pod.Spec.NodeName)
	&#125; else &#123;
    &#x2F;&#x2F; 3. å°†Nodeæ”¾åˆ°åŒé“¾è¡¨å¤´éƒ¨
		cache.moveNodeInfoToHead(pod.Spec.NodeName)
	&#125;
	return nil
&#125;

func (n *NodeInfo) RemovePod(pod *v1.Pod) error &#123;
	k1, err :&#x3D; GetPodKey(pod)
	for i :&#x3D; range n.pods &#123;
		k2, err :&#x3D; GetPodKey(n.pods[i])
		if k1 &#x3D;&#x3D; k2 &#123;
			&#x2F;&#x2F; å°†Podä»Nodeçš„Podsåˆ—è¡¨ä¸­ç§»é™¤
			n.pods[i] &#x3D; n.pods[len(n.pods)-1]
			n.pods &#x3D; n.pods[:len(n.pods)-1]
			&#x2F;&#x2F; å½’è¿˜Nodeèµ„æº
			res, non0CPU, non0Mem :&#x3D; calculateResource(pod)
			n.requestedResource.MilliCPU -&#x3D; res.MilliCPU
			n.requestedResource.Memory -&#x3D; res.Memory
      &#x2F;&#x2F; æ›´æ–°Nodeç‰ˆæœ¬å·
			n.generation &#x3D; nextGeneration()
			return nil
		&#125;
	&#125;
	return fmt.Errorf(&quot;no corresponding pod %s in pods of node %s&quot;, pod.Name, n.node.Name)
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="5-2-æ“ä½œè¯¦è§£"><a href="#5-2-æ“ä½œè¯¦è§£" class="headerlink" title="5.2 æ“ä½œè¯¦è§£"></a>5.2 æ“ä½œè¯¦è§£</h4><ol>
<li>Bindingå¯¹è±¡: æœ¬è´¨ä¸Šæ˜¯{Pod.UID, Node.nodeName}, </li>
<li>æ‰§è¡Œç»‘å®šæµç¨‹: æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨RPC, å°†è¯¥Bindingå¯¹è±¡å‘é€åˆ°å¯¹åº”Nodeä¸Š, æ‰§è¡Œç»‘å®š<ol>
<li>æ­¤å¤„RPCæ¨¡å¼æ˜¯æ€æ ·çš„éœ€è¦ç¡®è®¤:  TODO<ol>
<li>Pub-Subæ¨¡å¼: schedulerå°†è¯·æ±‚å‘é€åˆ°, Nodeä¸Šagentç›‘å¬åˆ°è¯¥è¯·æ±‚, å‘ç°è‡ªèº«NodeIdä¸æ¶ˆæ¯ä¸­ç›¸åŒ, åˆ™æ‰§è¡Œbindè¿‡ç¨‹. </li>
<li>P2Pæ¨¡å¼: schedulerç›´æ¥å°†è¯·æ±‚å‘é€åˆ°å¯¹åº”Nodeä¸Š, æ‰§è¡Œ.</li>
</ol>
</li>
<li>æ­¤å¤„RPCæ˜¯åŒæ­¥è¿˜æ˜¯ä¸€éƒ¨éœ€è¦ç¡®è®¤: TODO<ol>
<li>åŒæ­¥: å½“å‰é€†å‘æµç¨‹å³å¯è¦†ç›–</li>
<li>å¼‚æ­¥: éœ€è¦å•ç‹¬æ³¨å†Œå›è°ƒ, åœ¨å“ªé‡Œ? æ€ä¹ˆæ‰§è¡Œ?</li>
</ol>
</li>
<li>å…·ä½“åˆ°Nodeä¸Š, kubeletæ‰§è¡Œçš„æ“ä½œæ˜¯æ€æ ·çš„, åŒæ ·éœ€è¦ç¡®è®¤. TODO</li>
</ol>
</li>
<li>é€†å‘æµç¨‹: æœ¬è´¨ä¸Šæ˜¯å°†Podèµ„æºå½’è¿˜ç»™Node.</li>
</ol>
<h2 id="è°ƒåº¦è¯·æ±‚å¯¹è±¡"><a href="#è°ƒåº¦è¯·æ±‚å¯¹è±¡" class="headerlink" title="è°ƒåº¦è¯·æ±‚å¯¹è±¡"></a>è°ƒåº¦è¯·æ±‚å¯¹è±¡</h2><p><a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/</a></p>
<pre class="line-numbers language-Go" data-language="Go"><code class="language-Go">type ResourceRequirements struct &#123;
	Limits ResourceList &#96;json:&quot;limits,omitempty&quot; protobuf:&quot;bytes,1,rep,name&#x3D;limits,casttype&#x3D;ResourceList,castkey&#x3D;ResourceName&quot;&#96;
	Requests ResourceList &#96;json:&quot;requests,omitempty&quot; protobuf:&quot;bytes,2,rep,name&#x3D;requests,casttype&#x3D;ResourceList,castkey&#x3D;ResourceName&quot;&#96;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>limits: ç»™kubeletsç”¨çš„, æŒ‡çš„æ˜¯è¿™ä¸ªPodèƒ½ä½¿ç”¨çš„æœ€å¤§èµ„æºé‡</li>
<li>requests: ç»™schedulerç”¨çš„, æŒ‡çš„æ˜¯è¿™ä¸ªPodæœ€å°éœ€æ±‚çš„èµ„æºé‡</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://my.oschina.net/jxcdwangtao/blog/824965">https://my.oschina.net/jxcdwangtao/blog/824965</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>scheduler</tag>
        <tag>kube-scheduler</tag>
      </tags>
  </entry>
  <entry>
    <title>kube-schedulerç¬”è®°ä¹‹Queueç ”ç©¶</title>
    <url>//2021-09-08-kube-scheduler-queue/</url>
    <content><![CDATA[<h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><pre class="line-numbers language-Go" data-language="Go"><code class="language-Go">type PriorityQueue struct &#123;

   &#x2F;&#x2F; backoffé˜Ÿåˆ—
   podBackoff *util.PodBackoff
   &#x2F;&#x2F; backoffé˜Ÿåˆ—, ä¸podBackoffåŒºåˆ«?
   podBackoffQ *util.Heap
  
   &#x2F;&#x2F; activeQ is heap structure that scheduler actively looks at to find pods to
   &#x2F;&#x2F; schedule. Head of heap is the highest priority pod.
   activeQ *util.Heap

   &#x2F;&#x2F; unschedulableé˜Ÿåˆ—
   unschedulableQ *UnschedulablePodsMap
  
   &#x2F;&#x2F; æŠ¢å å¼è°ƒåº¦æˆåŠŸå, å°†preemptoræ”¾åˆ°nominatedPodMapé‡Œ
   nominatedPods *nominatedPodMap
  
   &#x2F;&#x2F; å…¨å±€è°ƒåº¦å‘¨æœŸçš„é€’å¢åºå·ï¼Œå½“pod popçš„æ—¶å€™ä¼šé€’å¢
   schedulingCycle int64
   &#x2F;&#x2F; å½“æœªè°ƒåº¦çš„podé‡æ–°è¢«æ·»åŠ åˆ°activeQueueä¸­ä¼šä¿å­˜schedulingCycleåˆ°moveRequestCycleä¸­
   moveRequestCycle int64
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="æ ¸å¿ƒè§£è¯»"><a href="#æ ¸å¿ƒè§£è¯»" class="headerlink" title="æ ¸å¿ƒè§£è¯»"></a>æ ¸å¿ƒè§£è¯»</h2><ol>
<li>Heapç»“æ„, å³ä¸ºæœ€å¤§å †.</li>
<li>activeQ: å­˜å‚¨æ‰€æœ‰ç­‰å¾…è°ƒåº¦çš„Podçš„é˜Ÿåˆ—, æ ¹æ®pod.Spec.Priorityæ¥æ„å»ºæœ€å¤§å †</li>
<li>podBackoffQ: å­˜å‚¨åœ¨å¤šä¸ªschedulingCycleä¸­ä¾æ—§è°ƒåº¦å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œåˆ™ä¼šé€šè¿‡ä¹‹å‰è¯´çš„backOffæœºåˆ¶ï¼Œå»¶è¿Ÿç­‰å¾…è°ƒåº¦çš„æ—¶é—´. ä½†è¯¥backoffQæ˜¯çº¯çš„PodHeap, å¹¶æ²¡æœ‰å­˜å‚¨podçš„backOffçš„å…·ä½“ä¿¡æ¯</li>
<li>podBackoff: ç±»ä¼¼ä¸€ä¸ªè®°åˆ†æ¿, backoffçš„è®¡æ•°å™¨ï¼Œæœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ç­‰</li>
<li>unschedulableQ: æœ¬è´¨ä¸Šæ˜¯&lt;podName, podInfo&gt;çš„map, è€Œä¸æ˜¯ä¸€ä¸ªé˜Ÿåˆ—.</li>
</ol>
<h2 id="é‡ç‚¹ç–‘é—®"><a href="#é‡ç‚¹ç–‘é—®" class="headerlink" title="é‡ç‚¹ç–‘é—®"></a>é‡ç‚¹ç–‘é—®</h2><ol>
<li><p>åœ¨ä»€ä¹ˆæ—¶å€™Podè¢«åŠ å…¥åˆ°activeQä¸­? ä½•æ—¶åŠ å…¥podBackoffQä¸­? ä½•æ—¶åŠ å…¥unschedulableQä¸­? Podåœ¨è¿™å‡ ä¸ªQä¸­é—´æ˜¯å¦‚ä½•å˜åŒ–çš„?</p>
<ol>
<li></li>
</ol>
</li>
<li><p>podBackoffQæ˜¯æŒ‰ç…§ä»€ä¹ˆæ¥åˆ’åˆ†ä¼˜å…ˆçº§çš„?</p>
<ol>
<li>å¦‚æœä»ç„¶æ˜¯æŒ‰ç…§ä¼˜å…ˆçº§æ¥, å¦‚ä½•é˜²æ­¢é«˜ä¼˜å…ˆçº§Podåå¤æ‹‰èµ·, åå¤å¤±è´¥?</li>
<li>åº”è¯¥æ˜¯æŒ‰ç…§è°ƒåº¦å¤±è´¥æ¬¡æ•°? è¿˜æ˜¯è°ƒåº¦ç­‰å¾…æ—¶é•¿?</li>
<li>æ ¹æ®podsCompareBackoffCompleted, æŒ‰ç…§podBackoffTime, å³è°ƒåº¦å¤±è´¥æ¬¡æ•°. è°ƒåº¦ç­‰å¾…æ—¶é•¿ä¸è°ƒåº¦å¤±è´¥æ¬¡æ•°æœ‰ä¸€ä¸ªå‡½æ•°å…³ç³».<ol>
<li>å¦‚æœpodä»podBackoffQä¸­ç§»å…¥åˆ°activeQä¸­, æ¥ä¸‹æ¥è°ƒåº¦å¤±è´¥, é‡æ–°ç§»å…¥podBackoffQä¸­, æ­¤æ—¶podBackoffTimeä¼šé‡ç½®ä¹ˆ?</li>
</ol>
</li>
</ol>
</li>
<li><p>ä»unschedulableQä¸­ç§»å‡ºpodçš„ä¼˜å…ˆçº§æ˜¯æ€æ ·çš„?</p>
<ol>
<li></li>
</ol>
</li>
<li><p>Podè°ƒåº¦å¤±è´¥çš„ç»ˆæ­¢æ¡ä»¶æ˜¯ä»€ä¹ˆ? è¿˜æ˜¯è¯´æ²¡æœ‰ç»ˆæ­¢æ¡ä»¶? å§‹ç»ˆåœ¨å‡ ä¸ªQueueä¸­æ‰“è½¬?</p>
<ol>
<li>å¯¹çš„. é™¤éæ˜¾å¼è°ƒç”¨apiåˆ é™¤æ‰è¯¥Pod</li>
</ol>
</li>
<li><p>å„ä¸ªé˜Ÿåˆ—æœ‰å¤§å°é™åˆ¶ä¹ˆ? å¦‚ä½•é˜²æ­¢Podè¯·æ±‚ç§¯å‹è¿‡å¤šå¯¼è‡´Queue(å†…å­˜)æ»¡äº†?</p>
</li>
</ol>
<p><img data-src="https://bbsmax.ikafan.com/static/L3Byb3h5L2h0dHBzL2ltZzIwMTguY25ibG9ncy5jb20vYmxvZy8xNTA2NzI0LzIwMjAwMS8xNTA2NzI0LTIwMjAwMTEzMTEwMzU5Mzg1LTM2MDkzMzYzNS5wbmc=.jpg" alt="img"></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.shuzhiduo.com/A/rV576rRXJP/">https://www.shuzhiduo.com/A/rV576rRXJP/</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>scheduler</tag>
        <tag>kube-scheduler</tag>
        <tag>kube-scheduler-queue</tag>
      </tags>
  </entry>
  <entry>
    <title>ç²¾ç¥è®­ç»ƒä¸èº«ä½“è®­ç»ƒ</title>
    <url>//2021-09-08-physical-psychological/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨æ¨å¿µç¾¤çš„ç ”ç©¶é‡Œï¼Œ<br>æ¯›æ³½ä¸œåæ¥çš„ã€Šä½“è‚²ä¹‹ç ”ç©¶ã€‹å¼ºè°ƒçš„å°±æ˜¯ç²¾ç¥è®­ç»ƒä¸èº«ä½“è®­ç»ƒä¹‹é—´çš„å…³ç³»ï¼Œ<br>å¼ºè°ƒçš„æ˜¯å®è·µå¯¹å¿ƒçµæ”¹é€ çš„æ„ä¹‰ï¼Œè€Œä¸æ˜¯æ–°æ–‡åŒ–æ ¸å¿ƒï¼šä¼¦ç†çš„çªå‡ºä½œç”¨ï¼Œå®ƒå…·æœ‰ç‹¬ç‰¹çš„åœ°åŸŸåŒ–è®°å¿†ï¼Œ<br>è¿™ç§åœ°åŸŸè®°å¿†å¹¶éè‡ªæ¯›æ³½ä¸œå§‹ï¼Œæ›¾å›½è—©ã€è°­å—£åŒã€æ¨æ˜Œæµéƒ½åœ¨åšç±»ä¼¼çš„äº‹æƒ…ã€‚<br>æ¯›æ³½ä¸œè‡ªå·±éƒ½æ˜¯åœ¨1920å¹´äº²è‡ªå®è·µå¤±è´¥åæ‰æ‰“æ¶ˆäº†æ¹–å—è‡ªæ²»è¿™ä¸ªæƒ³æ³•ï¼Œæ›´ä½•å†µå…¶ä»–äººã€‚</p>
</blockquote>
<blockquote>
<p>ä»–æ‹’ç»çš„æ˜¯ç²¾è‹±åœˆå­æœ¬èº«ã€‚<br>ä»–æ‹’ç»çš„æ˜¯äººæ´»ç€å°±è¦å¾€ä¸Šçˆ¬çš„è¿™ç§äº‹æœ¬èº«ã€‚</p>
</blockquote>
<blockquote>
<p>éç¬¬å¼ºç­‹éª¨ä¹Ÿï¼Œåˆè¶³ä»¥å¢çŸ¥è¯†ã€‚è¿‘äººæœ‰è¨€æ›°ï¼šæ–‡æ˜å…¶ç²¾ç¥ï¼Œé‡è›®å…¶ä½“é­„ã€‚æ­¤è¨€æ˜¯ä¹Ÿã€‚æ¬²æ–‡æ˜å…¶ç²¾ç¥ï¼Œå…ˆè‡ªé‡è›®å…¶ä½“é­„ï¼›è‹Ÿé‡è›®å…¶ä½“é­„çŸ£ï¼Œåˆ™æ–‡æ˜ä¹‹ç²¾ç¥éšä¹‹ã€‚ <br><br>â€“ æ¯›æ³½ä¸œ &lt;ä½“è‚²ä¹‹ç ”ç©¶&gt;</p>
</blockquote>
<p>æ‰€ä»¥è¦æ³¨æ„åŠ å¼ºé”»ç‚¼èº«ä½“å“¦~</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>snippets</tag>
        <tag>physical</tag>
        <tag>psychological</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯—æ–‡æ‘˜å½•</title>
    <url>//2021-09-08-random-snippets/</url>
    <content><![CDATA[<hr>
<h1 id="æ•…ä¹¡"><a href="#æ•…ä¹¡" class="headerlink" title="æ•…ä¹¡"></a>æ•…ä¹¡</h1><blockquote>
<p>æˆ‘è¦è¿˜å®¶ <br/><br>æˆ‘è¦è½¬å›æ•…ä¹¡ï¼Œå¤´ä¸Šæ’æ»¡é²œèŠ± <br/><br>æˆ‘è¦åœ¨æ•…ä¹¡çš„å¤©ç©ºä¸‹ <br/><br>æ²‰é»˜å¯¡è¨€æˆ–å¤§å£°è°ˆå <br/><br>æˆ‘è¦å¤´ä¸Šæ’æ»¡æ•…ä¹¡çš„é²œèŠ± <br/><br>â€”â€”æµ·å­ ã€Šè¯—äººå¶èµ›å®ã€‹</p>
</blockquote>
<blockquote>
<p>å¸­æ…•è“‰è¯´ï¼Œæ•…ä¹¡çš„é¢è²Œæ˜¯ä¸€ç§æ¨¡ç³Šçš„æ€…æƒ˜ï¼Œä»¿ä½›é›¾é‡Œçš„æŒ¥æ‰‹åˆ«ç¦»ã€‚<br>é•¿ä¹…ä»¥æ¥ï¼Œå¡äº•æ°¸è¿œç† ç† ç”Ÿè¾‰çš„ç¯å…‰ç…§äº®ç€æˆ‘æ‰€æœ‰åŠªåŠ›çš„æ–¹å‘ã€‚å°¤å…¶æ˜¯åœ¨æ¯ä¸€ä¸ªå†œå¿™å­£èŠ‚çš„å¤œæ™šï¼Œæˆ‘èººåœ¨å°å­¦å—è¾¹æ‰“è°·åœºçš„éº¦ç§¸å›ä¸Šæ•°æ»¡å¤©çš„ç¹æ˜Ÿæ—¶ï¼Œå¯¹é¢å¡äº•è€€çœ¼çš„ç¯å…‰æç¤ºæˆ‘ï¼Œä»–ä»¬æ˜¯æ°¸è¿œä¸ç”¨é å•„é£Ÿæ³¥åœŸè€Œç”Ÿæ´»çš„ã€‚èƒ½å¤Ÿåƒä»–ä»¬ä¸€æ ·â€œä¹°ç€åƒâ€ï¼Œæ˜¯çˆ¶æ¯åœ¨æˆ‘èº«ä¸Šå€¾æ³¨çš„æ‰€æœ‰æœŸæœ›ã€‚</p>
</blockquote>
<hr>
<h1 id="è¯»ä¹¦ä¸åšäºº"><a href="#è¯»ä¹¦ä¸åšäºº" class="headerlink" title="è¯»ä¹¦ä¸åšäºº"></a>è¯»ä¹¦ä¸åšäºº</h1><blockquote>
<p>é»„å±±è°·è¯´ï¼šâ€œäººä¸è¯»ä¹¦ï¼Œåˆ™å°˜ä¿—ç”Ÿå…¶é—´ï¼Œç…§é•œåˆ™é¢ç›®å¯æ†ï¼Œå¯¹äººåˆ™è¯­è¨€æ— å‘³ã€‚â€<br>ç»†å‘³å…¶è¨€ï¼Œè§‰å¾—ä¼¼æœ‰é“ç†ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬æ‰€çœ‹åˆ°çš„äººï¼Œç¡®å®æ˜¯é¢ç›®å¯æ†è¯­è¨€æ— å‘³çš„å±…å¤šã€‚æˆ‘æ›¾æ€ç´¢ï¼Œå…¶ä¸­å› æœå…³ç³»å®‰åœ¨ï¼Ÿä½•ä»¥ä¸è¯»ä¹¦ä¾¿é¢ç›®å¯æ†è¯­è¨€æ— å‘³ï¼Ÿæˆ‘æƒ³ä¹Ÿè®¸æ˜¯å› ä¸ºè¯»ä¹¦ç­‰äºæ˜¯å°šå‹å¤äººï¼Œè€Œä¸”é‚£äº›å¤äººè‘—ä¹¦ç«‹è¯´å¿…å®šæ˜¯ä¸€æ—¶æ‰ä¿Šï¼Œä¸å¤äººæ¸¸ä¸çŸ¥ä¸è§‰å—å…¶ç†æŸ“ï¼Œç»ˆä¹ƒæ”¶æ”¹å˜æ°”è´¨ä¹‹åŠŸï¼Œå¢ƒç•Œæ—¢é«˜ï¼Œèƒ¸è¥Ÿæ—¢å¹¿ï¼Œè„¸ä¸Šè‡ªç„¶é€éœ²å‡ºä¸€è‚¡æ¸…é†‡çˆ½æœ—ä¹‹æ°”ï¼Œæ— ä»¥åä¹‹ï¼Œåä¹‹æ›°ä¹¦å·æ°”ã€‚åŒæ—¶åœ¨è°ˆåä¸Šä¹Ÿè‡ªç„¶é«˜è¿œä¸ä¿—ã€‚åè¿‡æ¥è¯´ï¼Œäººä¸è¯»ä¹¦ï¼Œåˆ™æ‰€ä¸ºä½•äº‹ï¼Œå¤§æ¦‚æ˜¯é™·èº«äºä¸–ç½‘å°˜åŠ³ï¼Œå›°å„äºåç¼°åˆ©é”ï¼Œäº”çƒ§å…­è”½ï¼Œè‹¦æ¼çƒ¦å¿ƒï¼Œè‡ªç„¶é¢ç›®å¯æ†ï¼Œç„‰èƒ½è¯­è¨€æœ‰å‘³ï¼Ÿ</p>
</blockquote>
<hr>
<h1 id="æ—…è¡Œ-amp-ä¸–ç•Œ"><a href="#æ—…è¡Œ-amp-ä¸–ç•Œ" class="headerlink" title="æ—…è¡Œ&amp;ä¸–ç•Œ"></a>æ—…è¡Œ&amp;ä¸–ç•Œ</h1><blockquote>
<p>ä½ èƒŒå•è¯æ—¶,é˜¿æ‹‰æ–¯åŠ çš„é³•é±¼æ­£è·ƒå‡ºæ°´é¢,ä½ ç®—æ•°å­¦æ—¶,å¤ªå¹³æ´‹å½¼å²¸çš„æµ·é¸¥æŒ¯ç¿…æ è¿‡åŸå¸‚ä¸Šç©º,ä½ æ™šè‡ªä¹ æ—¶,æå›¾ä¸­çš„å¤œç©ºæ•£æ¼«äº†äº”å½©æ–‘æ–“,ä½†æ˜¯å°‘å¹´ä½ åˆ«ç€æ€¥,åœ¨ä½ ä¸ºè‡ªå·±æœªæ¥è¸è¸å®å®åœ°åŠªåŠ›æ—¶,é‚£äº›ä½ æ„Ÿè§‰ä»æ¥ä¸ä¼šçœ‹åˆ°çš„æ™¯è‰²,é‚£äº›ä½ è§‰å¾—ç»ˆèº«ä¸ä¼šé‡åˆ°çš„äºº,æ­£ä¸€æ­¥æ­¥å‘ä½ èµ°æ¥ã€‚</p>
</blockquote>
<blockquote>
<p>å½“æˆ‘ä»¬ç«™åœ¨å±±é¡¶ï¼Œç™¾ä¸‡äº©æ¢¯ç”°å¦‚å·¨æµªèˆ¬æ¶Œå…¥çœ¼å¸˜æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šæ„•ç„¶è®°èµ·ï¼Œçœ‹ä¼¼å¹³é™çš„è¡¨è±¡ä¸‹æ·±è—çš„æƒŠæ¶›éª‡æµªã€‚æ­£å¦‚å“ˆå°¼æ¢¯ç”°è¢«ç§°ä¸ºâ€œå¤§åœ°çš„é›•åˆ»â€ä¸€æ ·ï¼Œæ³¢æ¾œå£®é˜”çš„å†å²ä¹Ÿé•Œåˆ»åœ¨è¿™ç‰‡åœŸåœ°ä¸Šã€‚</p>
</blockquote>
<hr>
<h1 id="æ—¶é—´"><a href="#æ—¶é—´" class="headerlink" title="æ—¶é—´"></a>æ—¶é—´</h1><blockquote>
<p>ç€‘å¸ƒçš„æ°´é€†æµè€Œä¸Šï¼Œè’²å…¬è‹±çš„ç§å­ä»è¿œå¤„é£˜å›ï¼Œå˜æˆä¼çš„æ¨¡æ ·ã€‚å¤ªé˜³ä»è¥¿è¾¹å‡èµ·ï¼Œè½å‘ä¸œæ–¹ã€‚å­å¼¹é€€å›æªè†›ï¼Œè¿åŠ¨å‘˜å›åˆ°èµ·è·‘çº¿ä¸Šï¼Œæˆ‘äº¤å›å½•å–é€šçŸ¥ä¹¦ï¼Œå¿˜äº†åå¹´å¯’çª—ã€‚å¨æˆ¿é‡Œé£˜æ¥é¥­èœçš„é¦™ï¼Œä½ æŠŠæˆ‘çš„å·å­ç­¾å¥½åå­—ï¼Œå…³æ‰ç”µè§†ï¼Œå¸®æˆ‘æŠŠä¹¦åŒ…èƒŒä¸Šã€‚ä½ è¿˜åœ¨æˆ‘èº«æ—ã€‚</p>
</blockquote>
<blockquote>
<p>â€œåˆ¹é‚£å’Œæ°¸æ’æœ‰ä»€ä¹ˆåŒºåˆ«?â€â€œå°±æ˜¯ä½ é—®æˆ‘è¿™å¥è¯çš„åˆ¹é‚£ï¼Œæˆ‘å·²ç»åœ¨è„‘æµ·é‡Œé™ªä½ åº¦è¿‡äº†æ— æ•°ä¸ªæ˜¥å¤ç§‹å†¬â€</p>
</blockquote>
<blockquote>
</blockquote>
<hr>
<blockquote>
<p>è‡ªå¹¼æ›¾æ”»ç»å²ï¼Œé•¿æˆäº¦æœ‰æƒè°‹ã€‚æ°å¦‚çŒ›è™å§è’ä¸˜ï¼Œæ½œä¼çˆªç‰™å¿å—ã€‚<br>ä¸å¹¸åˆºæ–‡åŒé¢Šï¼Œé‚£å ªé…åœ¨æ±Ÿå·ã€‚ä»–å¹´è‹¥å¾—æŠ¥å†¤ä»‡ï¼Œè¡€æŸ“æµ”é˜³æ±Ÿå£ã€‚</p>
</blockquote>
<hr>
<p>äº†ä¸èµ·çš„ç›–èŒ¨æ¯”</p>
<blockquote>
<p>â€œæ¯å½“ä½ æƒ³æ‰¹è¯„åˆ«äººçš„æ—¶å€™ï¼Œâ€ä»–å¯¹æˆ‘è¯´ï¼Œâ€œä¸€å®šè¦è®°å¾—å¹¶ä¸æ˜¯ä¸–ç•Œä¸Šæ¯ä¸ªäººéƒ½æ›¾æ‹¥æœ‰ä½ æ‰€æ‹¥æœ‰çš„ä¼˜åŠ¿ã€‚â€</p>
</blockquote>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>poems</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼ ä¹ å½• æ‘˜å½•</title>
    <url>//2021-09-08-wangyangming/</url>
    <content><![CDATA[<blockquote>
<p>æ— å–„æ— æ¶å¿ƒä¹‹ä½“ï¼Œæœ‰å–„æœ‰æ¶æ„ä¹‹åŠ¨ï¼ŒçŸ¥å–„çŸ¥æ¶æ˜¯è‰¯çŸ¥ï¼Œä¸ºå–„å»æ¶æ˜¯æ ¼ç‰©</p>
</blockquote>
<blockquote>
<p>çŸ¥è¡Œåˆä¸€</p>
</blockquote>
<p>{: .box-note} è‡ªå·±å¾ˆæ˜ç¡®çŸ¥é“è‡ªå·±çš„ç¼ºç‚¹, çŸ¥å§‹ç»ˆèµ°åœ¨è¡Œçš„å‰è¾¹, è¾ƒä¸ºå…³æ³¨åŸç†æ€§ç†è®ºè¡Œçš„çŸ¥è¯†, è€Œå®é™…è½åœ°çš„è¡ŒåŠ¨åŠ›è¾ƒå¼±. ä¸€å®šéœ€è¦åŠ å¼º </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>psychology</tag>
        <tag>wangyangming</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªç®€å•çš„Fork&amp;Joinæ¡†æ¶å®ç°</title>
    <url>//2021-10-08-simple-fork-join-framework/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨ä»£ç é‡Œ, ç»å¸¸éœ€è¦ç±»ä¼¼fork&amp;joinçš„æ–¹å¼æ¥å¹¶è¡Œå®Œæˆä¸€äº›è€—æ—¶çš„ä»»åŠ¡, å¹¶å°†ç»“æœèšåˆèµ·æ¥.<br>é€šå¸¸æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°:</p>
<h1 id="å¸¸ç”¨å®ç°æ–¹å¼"><a href="#å¸¸ç”¨å®ç°æ–¹å¼" class="headerlink" title="å¸¸ç”¨å®ç°æ–¹å¼"></a>å¸¸ç”¨å®ç°æ–¹å¼</h1><h2 id="countdown-latch"><a href="#countdown-latch" class="headerlink" title="countdown latch"></a>countdown latch</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">Splitter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">Lists</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BasicThreadFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CustomForkJoinService</span><span class="token punctuation">.</span><span class="token static">CORE_SIZE</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CustomForkJoinService</span><span class="token punctuation">.</span><span class="token static">POOL_NAME</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomForkJoinServiceTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">countDownLatchTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1. åˆ›å»ºçº¿ç¨‹æ± </span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>CORE_SIZE<span class="token punctuation">,</span> CORE_SIZE<span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BasicThreadFactory<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namingPattern</span><span class="token punctuation">(</span>POOL_NAME <span class="token operator">+</span> <span class="token string">"-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> validStrs <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newCopyOnWriteArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. åˆ›å»º&amp;æäº¤ä»»åŠ¡</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"hello-"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Task</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        validStrs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                    latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"countDownLatchTest finished. validStrs: %s cost: %d \n"</span><span class="token punctuation">,</span> validStrs<span class="token punctuation">,</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿™é‡Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"echo finished. cost: %d \n"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">Splitter</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">splitToList</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ä¼˜ç‚¹:<ul>
<li>å®ç°å¾ˆç®€å•</li>
<li>å¾ˆå®¹æ˜“å®ç°è¶…æ—¶æœºåˆ¶, é˜²æ­¢æœ¨æ¡¶æ•ˆåº”é€ æˆè¿‡å¤§å½±å“(å¦‚ä¸Šè¾¹ä¾‹å­, æœ€å¤§100sè¿”å›)</li>
</ul>
</li>
<li>ç¼ºç‚¹: <ul>
<li>å¿…é¡»ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å®¹å™¨æ¥ä¿å­˜æ¯ä¸ªä»»åŠ¡åˆ†ç‰‡çš„ç»“æœ(å¦‚ä¸Šè¾¹ä¾‹å­çš„CopyOnWriteArrayList), å¦‚æœä½¿ç”¨çº¿ç¨‹ä¸å®‰å…¨çš„å®¹å™¨ä¾‹å¦‚HashMap, ArrayList, å¾ˆå®¹æ˜“é€ æˆé—®é¢˜, æ‰€ä»¥ç¼–ç å¾ˆå®¹æ˜“è¸©å‘.<ul>
<li>ä¾‹å¦‚å¦‚æœä¸ä½¿ç”¨CopyOnWriteArrayList, è€Œä½¿ç”¨ArrayList, å¹¶å‘add, ä¼šé€ æˆ<a href="https://blogs.sap.com/2017/03/04/arraylist-in-multi-thread-context/">IndexOutOfBoundsException</a></li>
<li>ä¾‹å¦‚å¦‚æœä¸ä½¿ç”¨ConcurrentHashMap, è€Œä½¿ç”¨HashMap, å¹¶å‘add, ä¼šé€ æˆ<a href="https://www.pixelstech.net/article/1585457836-Why-accessing-Java-HashMap-may-cause-infinite-loop-in-concurrent-environment">InfinityLoop</a></li>
</ul>
</li>
<li>ç”±äºä½¿ç”¨äº†å…±äº«å®¹å™¨, åœ¨çº¿ç¨‹ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹, æ•ˆç‡å¿…ç„¶ä¼šå—åˆ°å½±å“</li>
<li>é€šå¸¸æ˜¯éœ€è¦åœ¨éœ€è¦å¤šçº¿ç¨‹çš„ç±»é‡Œæ¥ç®¡ç†çº¿ç¨‹æ± (ExecutorService), å› æ­¤é€ æˆçº¿ç¨‹æ± éåœ°é£çš„åœºæ™¯, ä¸å¥½å‡ ç§ç®¡ç†.</li>
</ul>
</li>
</ul>
<h2 id="future-get"><a href="#future-get" class="headerlink" title="future.get"></a>future.get</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Future</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">Splitter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">Lists</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BasicThreadFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CustomForkJoinService</span><span class="token punctuation">.</span><span class="token static">CORE_SIZE</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CustomForkJoinService</span><span class="token punctuation">.</span><span class="token static">POOL_NAME</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomForkJoinServiceTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">futureTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1. åˆ›å»ºçº¿ç¨‹æ± </span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>CORE_SIZE<span class="token punctuation">,</span> CORE_SIZE<span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BasicThreadFactory<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namingPattern</span><span class="token punctuation">(</span>POOL_NAME <span class="token operator">+</span> <span class="token string">"-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. åˆ›å»º&amp;æäº¤ä»»åŠ¡</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span><span class="token punctuation">></span></span> futures <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"hello-"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> submit <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Task</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            futures<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>submit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> future <span class="token operator">:</span> futures<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Boolean</span> aBoolean <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">+</span> aBoolean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"skipped."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"futureTest finished. cost: %d \n"</span><span class="token punctuation">,</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿™é‡Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"echo finished. cost: %d \n"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">Splitter</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">splitToList</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ä¼˜ç‚¹:<ul>
<li>å®ç°å¾ˆç®€å•å¿«æ·</li>
</ul>
</li>
<li>ç¼ºç‚¹:<ul>
<li>æ•ˆç‡ä¸å¦‚countdownlatchæ–¹å¼, ç”±äºæœ€ç»ˆç»“æœè¿˜æ˜¯ä¸²è¡Œé€šè¿‡future.getæ‹¿åˆ°çš„. å¦‚æœå‰è¾¹å‡ ä¸ªfuture.getè€—æ—¶å¾ˆä¹…(æˆ–è€…è¶…æ—¶), é‚£ä¹ˆå¾ˆå®¹æ˜“é€ æˆæ–¹æ³•ç“¶é¢ˆ. </li>
<li>ä¸å¤ªå®¹æ˜“å®ç°éƒ¨åˆ†æˆåŠŸ, è¿”å›éƒ¨åˆ†æˆåŠŸç»“æœ</li>
<li>è¿”å›ç»“æœéœ€è¦å°è£…: å¦‚ä¸Šè¾¹ä¾‹å­, å¾ˆéš¾çŸ¥é“å“ªä¸ªStringæ˜¯validçš„, å¿…é¡»å†å¯¹ç»“æœè¿›è¡Œä¸€å±‚å°è£…, è¿™æ ·å¢åŠ äº†å®ç°çš„å¤æ‚åº¦.</li>
</ul>
</li>
</ul>
<h2 id="javaåŸç”Ÿçš„fork-amp-joinæ¡†æ¶"><a href="#javaåŸç”Ÿçš„fork-amp-joinæ¡†æ¶" class="headerlink" title="javaåŸç”Ÿçš„fork&amp;joinæ¡†æ¶"></a>javaåŸç”Ÿçš„fork&amp;joinæ¡†æ¶</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// TODO: å¾…è¡¥å……</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="CompletionService"><a href="#CompletionService" class="headerlink" title="CompletionService"></a>CompletionService</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletionService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorCompletionService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Future</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">Splitter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">Lists</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BasicThreadFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CustomForkJoinService</span><span class="token punctuation">.</span><span class="token static">CORE_SIZE</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CustomForkJoinService</span><span class="token punctuation">.</span><span class="token static">POOL_NAME</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomForkJoinServiceTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completionServiceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1. åˆ›å»ºçº¿ç¨‹æ± </span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>CORE_SIZE<span class="token punctuation">,</span> CORE_SIZE<span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BasicThreadFactory<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namingPattern</span><span class="token punctuation">(</span>POOL_NAME <span class="token operator">+</span> <span class="token string">"-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletionService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> completionService <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">ExecutorCompletionService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. åˆ›å»º&amp;æäº¤ä»»åŠ¡</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"hello-"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            completionService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Task</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> take <span class="token operator">=</span> completionService<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Boolean</span> isValid <span class="token operator">=</span> take<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è¿™é‡Œä¸¢å¤±äº†ä¸Šä¸‹æ–‡, ä¸çŸ¥é“å½“å‰getåˆ°çš„æ˜¯forå“ªä¸ªStringçš„</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"isValid "</span> <span class="token operator">+</span> isValid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"completionServiceTest finished. cost: %d \n"</span><span class="token punctuation">,</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿™é‡Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"echo finished. cost: %d \n"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">Splitter</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">splitToList</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ä¼˜ç‚¹:<ul>
<li>æ•ˆç‡ä¸Šè¦æ¯”future.getæ•´ä½“å¥½å¾ˆå¤š: ç”±äº<code>CompletionService</code>å†…éƒ¨å®ç°, æ˜¯æŠŠç»“æœæ”¾å…¥ä¸€ä¸ªå…±äº«çš„queueä¸­, è€Œä¸æ˜¯ä¸²è¡Œåœ°é¡ºåºåœ°future.get</li>
</ul>
</li>
<li>ç¼ºç‚¹:<ul>
<li>ä»ç„¶éœ€è¦ç»´æŠ¤çº¿ç¨‹æ± <code>ExecutorService</code></li>
<li>ç”±äºæ‹¿åˆ°çš„ç»“æœæ˜¯ä¹±åºçš„, å› æ­¤ä¸å®¹æ˜“getåˆ°ä¸Šä¸‹æ–‡ä¿¡æ¯. å¦‚ä¸Šè¾¹ä¾‹å­, å¾ˆéš¾çŸ¥é“å“ªä¸ªStringæ˜¯validçš„. å¿…é¡»è¿›è¡Œä¸€å±‚å°è£…, è¿™æ ·å¢åŠ äº†å®ç°çš„å¤æ‚åº¦.</li>
</ul>
</li>
</ul>
<h2 id="å‡ ç§å®ç°æ–¹å¼æ€»ç»“"><a href="#å‡ ç§å®ç°æ–¹å¼æ€»ç»“" class="headerlink" title="å‡ ç§å®ç°æ–¹å¼æ€»ç»“"></a>å‡ ç§å®ç°æ–¹å¼æ€»ç»“</h2><p>ä½¿ç”¨èµ·æ¥éƒ½ä¸å¤ªä¼˜é›…: </p>
<ol>
<li>éœ€è¦è‡ªå·±ç®¡ç†çº¿ç¨‹æ± </li>
<li>éœ€è¦è‡ªå·±åšç»“æœçš„èšåˆ</li>
<li>éœ€è¦è‡ªå·±å¤„ç†å¼‚å¸¸æƒ…å†µç­‰</li>
</ol>
<p>å› æ­¤æˆ‘åŸºäº<code>CompletionService</code>çš„æ–¹å¼, å°è£…äº†ä¸€ä¸ªå°çš„Fork&amp;Joinæ¡†æ¶, æ¥æ»¡è¶³æ—¥å¸¸éœ€æ±‚.</p>
<h1 id="æ¡†æ¶å‚è€ƒä»£ç "><a href="#æ¡†æ¶å‚è€ƒä»£ç " class="headerlink" title="æ¡†æ¶å‚è€ƒä»£ç "></a>æ¡†æ¶å‚è€ƒä»£ç </h1><h2 id="æ ¸å¿ƒéƒ¨åˆ†"><a href="#æ ¸å¿ƒéƒ¨åˆ†" class="headerlink" title="æ ¸å¿ƒéƒ¨åˆ†"></a>æ ¸å¿ƒéƒ¨åˆ†</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletionService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorCompletionService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Future</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">Lists</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BasicThreadFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">DisposableBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * ä¸€ä¸ªç®€å•çš„Fork&amp;Joinæ¡†æ¶, ç”¨äºå°†æ‰¹é‡è¯·æ±‚åˆ†å¸ƒåˆ°å¤šä¸ªçº¿ç¨‹ä¸­, å¹¶ä¸”é€šè¿‡completionServiceé˜Ÿåˆ—æ‹¿åˆ°æ‰€æœ‰ç»“æœ
 *
 * @author kunlun.ykl
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token comment">//@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomForkJoinService</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">&#123;</span>

    <span class="token class-name">ExecutorService</span> executorService<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> CORE_SIZE <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> POOL_NAME <span class="token operator">=</span> <span class="token string">"CFJ"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomForkJoinResult</span><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">forkJoin</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomForkJoinCallable</span><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> callables<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"forkJoin start. request.size: %d \n"</span><span class="token punctuation">,</span> callables<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// hantingtodo: è¿™é‡Œå¯ä»¥å¢åŠ å®¹ç¾, å¦‚æœexecutorServiceåˆå§‹åŒ–å¤±è´¥, å¯ä»¥é™çº§ä¸ºä¸²è¡Œæ‰§è¡Œ</span>
        <span class="token class-name">CompletionService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomForkJoinResult</span><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> completionService <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">ExecutorCompletionService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// fork</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CustomForkJoinCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> callable <span class="token operator">:</span> callables<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            completionService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> callable<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// join</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomForkJoinResult</span><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> results <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> callables<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomForkJoinResult</span><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> take <span class="token operator">=</span> completionService<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">CustomForkJoinResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> take<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> result <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    results<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"invoke error."</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"forkJoin finished. request.size: %d result.size: %d cost: %d \n"</span><span class="token punctuation">,</span> callables<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            results<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> results<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> executorService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        executorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>CORE_SIZE<span class="token punctuation">,</span> CORE_SIZE<span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BasicThreadFactory<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namingPattern</span><span class="token punctuation">(</span>POOL_NAME <span class="token operator">+</span> <span class="token string">"-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Request-amp-Responseå¯¹è±¡å°è£…"><a href="#Request-amp-Responseå¯¹è±¡å°è£…" class="headerlink" title="Request&amp;Responseå¯¹è±¡å°è£…"></a>Request&amp;Responseå¯¹è±¡å°è£…</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ReflectionUtils</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomForkJoinCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Object</span> o<span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">;</span>
    <span class="token class-name">String</span> methodName<span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomForkJoinCallable</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">String</span> methodName<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>o <span class="token operator">=</span> o<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> params<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>methodName <span class="token operator">=</span> methodName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>paramTypes <span class="token operator">=</span> paramTypes<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomForkJoinResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CustomForkJoinResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomForkJoinResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Method</span> m <span class="token operator">=</span> <span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">findMethod</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> methodName<span class="token punctuation">,</span> paramTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span>
                    <span class="token string">"cannot find method: "</span> <span class="token operator">+</span> methodName <span class="token operator">+</span> <span class="token string">" for class: "</span> <span class="token operator">+</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">V</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">V</span><span class="token punctuation">)</span><span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>o<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span>success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span>rawResponse <span class="token operator">=</span> v<span class="token punctuation">;</span>
            result<span class="token punctuation">.</span>params <span class="token operator">=</span> params<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"invoke error. o: %s methodName: %s params: %s \n"</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                methodName<span class="token punctuation">,</span>
                JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span>success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomForkJoinResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">V</span> rawResponse<span class="token punctuation">;</span>

    <span class="token comment">// ä»£è¡¨æœ¬æ¬¡fork&amp;joinè°ƒç”¨æ˜¯å¦æˆåŠŸ</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> success<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å®ç°ç»†èŠ‚è¯´æ˜"><a href="#å®ç°ç»†èŠ‚è¯´æ˜" class="headerlink" title="å®ç°ç»†èŠ‚è¯´æ˜"></a>å®ç°ç»†èŠ‚è¯´æ˜</h2><p>ä¹‹æ‰€ä»¥å°è£…<code>CustomForkJoinResult</code>å¯¹è±¡, æ˜¯ç”±äºæˆ‘ä»¬é€šå¸¸Fork&amp;Joinä½¿ç”¨æ—¶, ä¸ä»…è¦æ„ŸçŸ¥å®é™…invokeçš„ç»“æœ, å¾ˆå¤šæ—¶å€™ä¹Ÿéœ€è¦æ„ŸçŸ¥åˆ°ä¼ å…¥çš„å‚æ•°.<br>å› æ­¤å°†<code>Object[] params</code>æ”¾å…¥åˆ°<code>CustomForkJoinResult</code>é‡Œ, ä½œä¸ºæˆå‘˜å˜é‡, ä½œä¸º<strong>æ–¹æ³•è°ƒç”¨çš„ä¸Šä¸‹æ–‡</strong>.<br>ä¾‹å¦‚åˆ¤æ–­ä¸€ä¸ªStringæ˜¯å¦æœ‰æ•ˆ, æ ¸å¿ƒçš„invokeæ–¹æ³•ç­¾åå¦‚ä¸‹: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å½“Fork&amp;Joinæ¡†æ¶ä¼ å…¥ä¸€å †çš„Stringæ—¶, å¦‚æœç›´æ¥å°†ç»“æœèšåˆ.<br>ç”±äºç»“æœæ˜¯ä¹±åºæ‹¿åˆ°çš„, é‚£ä¹ˆæ‹¿åˆ°çš„æ˜¯ä¸€å †çš„â€booleanâ€å€¼, æˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“å“ªä¸ªStringå¯¹åº”å“ªä¸ªboolean.<br>ä¹Ÿå°±ä¸çŸ¥é“å“ªä¸ªStringæ˜¯æœ‰æ•ˆçš„, å“ªä¸ªStringæ˜¯æ— æ•ˆçš„äº†. (å…·ä½“å¯ä»¥å‚è§ä¸‹è¾¹çš„æµ‹è¯•ä»£ç )</p>
<h1 id="æµ‹è¯•éªŒè¯"><a href="#æµ‹è¯•éªŒè¯" class="headerlink" title="æµ‹è¯•éªŒè¯"></a>æµ‹è¯•éªŒè¯</h1><h2 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">davyjones2010<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">Splitter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">Lists</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomForkJoinServiceTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forkJoinTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CustomForkJoinService</span> forkJoinService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomForkJoinService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        forkJoinService<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomForkJoinCallable</span><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span><span class="token punctuation">></span></span> callables <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Task</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CustomForkJoinCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> callable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomForkJoinCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">"isValid"</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"hello-"</span> <span class="token operator">+</span> i<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            callables<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>callable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CustomForkJoinResult</span><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span><span class="token punctuation">></span></span> results <span class="token operator">=</span> forkJoinService<span class="token punctuation">.</span><span class="token function">forkJoin</span><span class="token punctuation">(</span>callables<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"forkJoin finished. callables.size: %d results.size: %d cost: %d \n"</span><span class="token punctuation">,</span> callables<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            results<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CustomForkJoinResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> result <span class="token operator">:</span> results<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s isValid: %b \n"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>rawResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿™é‡Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"echo finished. cost: %d \n"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">Splitter</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">splitToList</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="æµ‹è¯•ç»“æœåˆ†æ"><a href="#æµ‹è¯•ç»“æœåˆ†æ" class="headerlink" title="æµ‹è¯•ç»“æœåˆ†æ"></a>æµ‹è¯•ç»“æœåˆ†æ</h2><pre class="line-numbers language-none"><code class="language-none">forkJoin start. request.size: 40 
echo finished. cost: 29 
echo finished. cost: 35 
echo finished. cost: 124  
...(ä¸ºäº†ç®€ä¾¿çœç•¥æ‰äº†)
echo finished. cost: 629 
echo finished. cost: 680 
echo finished. cost: 893 
echo finished. cost: 961 
echo finished. cost: 968 
forkJoin finished. request.size: 40 result.size: 40 cost: 1231 
forkJoin finished. callables.size: 40 results.size: 40 cost: 1238 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°, å¹³å‡å•æ¬¡æ‰§è¡Œçš„æœŸæœ›æ˜¯500mså·¦å³, å¦‚æœä¸²è¡Œ, è€—æ—¶åº”è¯¥åœ¨ 500ms * 40 &#x3D;20s å·¦å³.<br>ä½†ä½¿ç”¨Fork&amp;Joinæ¡†æ¶, æœ€ç»ˆè€—æ—¶æ˜¯1så·¦å³</p>
<h1 id="ä½¿ç”¨é™åˆ¶-amp-æ”¹è¿›ç‚¹"><a href="#ä½¿ç”¨é™åˆ¶-amp-æ”¹è¿›ç‚¹" class="headerlink" title="ä½¿ç”¨é™åˆ¶&amp;æ”¹è¿›ç‚¹"></a>ä½¿ç”¨é™åˆ¶&amp;æ”¹è¿›ç‚¹</h1><ul>
<li>æœ¨æ¡¶æ•ˆåº”:<ul>
<li>å¦‚æœæŸä¸ªä»»åŠ¡åˆ†ç‰‡æ‰§è¡Œå¾ˆä¹…, ä¾‹å¦‚è€—æ—¶å¦‚: 1, 2, 1, 2, 100, é‚£ä¹ˆæœ€ç»ˆçš„Fork&amp;Joinè€—æ—¶è‚¯å®šæ˜¯100ms+;</li>
<li>ä¼˜åŒ–ç‚¹: å¯ä»¥å¢åŠ æ•´ä½“çš„è¶…æ—¶æ—¶é—´, ä¸¢å¼ƒæ‰è¶…æ—¶çš„ä»»åŠ¡. ä»¥æœŸå¾…éƒ¨åˆ†çš„è¿”å›.</li>
</ul>
</li>
<li>çº¿ç¨‹æ± : <ul>
<li>è¿™é‡Œçº¿ç¨‹æ± åªæ˜¯ç®€å•åœ°ä½¿ç”¨äº†é»˜è®¤çš„çº¿ç¨‹æ± </li>
<li>å¯ä»¥ä½¿ç”¨å¸¦ç›‘æ§èƒ½åŠ›çš„çº¿ç¨‹æ± , å¢åŠ ä¾‹å¦‚æ´»è·ƒçº¿ç¨‹æ•°, ä»»åŠ¡é˜Ÿåˆ—å †ç§¯æƒ…å†µç­‰<br>ä¸è¿‡æ•´ä½“æ¥è¯´, åŸºæœ¬å¤Ÿç”¨äº†, å¯ä»¥æ— æŸæ›¿æ¢æ‰ä¹‹å‰ä½¿ç”¨countdownlatchç­‰ä¸å¤ªä¼˜é›…çš„åšæ³•.</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>concurrent</tag>
      </tags>
  </entry>
  <entry>
    <title>2021å¹´10æœˆç¬¬ä¸‰å‘¨</title>
    <url>//2021-10-17-weekend-summary/</url>
    <content><![CDATA[<p>é—²é€‚çš„å‘¨æœ«, è¯»å®Œäº†ç§‘å¹»å°è¯´: &lt;ç©¿è¶ŠåœŸæ˜Ÿç¯&gt;, ä¸»è¦è®²çš„æ˜¯æœªæ¥ä¸–ç•Œçš„ä¸€ä¸ªå¯ŒäºŒä»£åœ¨è¿½é€å½—æ˜Ÿå›¾ä¸­, ç”±äºæœºæ¢°æ•…éšœå¯¼è‡´é£èˆ¹åç¦»é¢„å®šå··é“, è¢«é—è½åœ¨åœŸæ˜Ÿç¯.<br>åœ¨ç»å¢ƒä¸­åŠªåŠ›æ±‚ç”Ÿ, æœ€ååœ¨AIçš„å¸®åŠ©ä¸‹, å—è‹¦å—éš¾, è‰°éš¾åº¦è¿‡ä¸€å¹´, æœ€ç»ˆè¿”å›åœ°çƒçš„æ•…äº‹.<br>ä¸ªäººæ„Ÿè§‰æ¯”è¾ƒå¹³æ·¡ä¸€èˆ¬, ä¹å–„å¯é™ˆ. æ²¡æœ‰ç‰¹åˆ«ç‘°ä¸½çš„æƒ³è±¡. ä»æ–‡ç¬”çš„ä¼˜ç¾, ç§‘å¹»çš„ç¡¬æ ¸ç¨‹åº¦, æƒ³è±¡çš„å®å¤§ç­‰æ–¹é¢, è·Ÿ&lt;ä¸‰ä½“&gt;æ¯”èµ·æ¥, å·®çš„å¤ªå¤šäº†.</p>
<p>çœ‹äº† &lt;æ®·ç‘—å°èš&gt; ä¹‹ &lt;å‰&amp;åèµ¤å£èµ‹&gt; , å¬ç€è’‹å‹‹è€å¸ˆä¸ç„¦ä¸èºçš„å¯Œæœ‰ç£æ€§çš„å£°éŸ³, å¨“å¨“é“æ¥. æ‰çœŸæ­£ä½“ä¼šåˆ°è¿™ç¯‡æ–‡ç« æ˜¯å¦‚æ­¤ä¹‹ç¾, ä¸ºä½•ä¼šè¿™æ ·ç¾.<br>ä¾‹å¦‚æ‘˜æŠ„å¦‚ä¸‹: </p>
<blockquote>
<p>ä¸œå¡çš„ç”±æ¥ <br/><br>æˆ‘è§‰å¾—éšç¼˜å¯èƒ½æ˜¯ç”Ÿå‘½é‡Œé¢æœ€å¥½çš„éƒ¨åˆ†<br>å› ä¸ºä½ ä¸è®¡è¾ƒäº†, å› ä¸º è½¼ è¿™ä¸ªå­—å¯¹ä»–æ¥è®², æœ¬æ¥æ˜¯ä¸€ä¸ªå¾ˆå¾—æ„çš„å­—. ä¸œå¡è¿™ä¸ªå­—åè€Œå¾ˆéšç¼˜. ä½ åˆ°ä¸œè¾¹çš„å¡åœ°äº†, ä½ å°±å«è‡ªå·±ä¸œå¡. æˆ‘æƒ³é‚£ä¸ªéšç¼˜å˜æˆä»–çš„å¿«ä¹.</p>
</blockquote>
<blockquote>
<p>æœˆå‡ºäºä¸œå±±ä¹‹ä¸Š. <br/><br>æˆ‘å¸¸å¸¸ç”¨èµ¤å£èµ‹åœ¨è§‚å¯Ÿæˆ‘è‡ªå·±ç”Ÿæ´»çš„å‘¨é­ç¯å¢ƒ. ç‰¹åˆ«æ˜¯åˆ°æœˆåœ†çš„æ™šä¸Š.<br>æ‰€ä»¥ä½ å¯ä»¥æƒ³è±¡åˆ°, ä¸€åƒå¹´ä»¥å‰è‹ä¸œå¡åœ¨ç”Ÿå‘½é‡Œé¢è¿½å¯»çš„ä¸œè¥¿, æˆ‘ä»¬ä»Šå¤©ä¸€æ ·å¯ä»¥ç¢°åˆ°, ä»–å¹¶ä¸é¥è¿œ.</p>
</blockquote>
<blockquote>
<p>æ‰£èˆ·è€Œæ­Œä¹‹ <br/><br>å¾ˆæœ‰ä¸€ç§å§¿æ€ä¸Šçš„ç¾<br>å¦‚æœæˆ‘ä»Šå¤©å”±æ­Œ, å¾ˆæ­£ç»çš„å”±æ­Œ, è·Ÿæˆ‘èººåœ¨èˆ¹è¾¹, æ‰£ç€é‚£ä¸ªèˆ¹èˆ·å”±æ­Œ, æ„Ÿè§‰æ˜¯ä¸å¤ªä¸€æ ·çš„, å› ä¸ºè¿™é‡Œé¢æœ‰ä¸€ç§èŠ‚å¥æ„Ÿ.<br>æˆ‘è§‰å¾—äººç”Ÿä¸€å®šè¦æ‰¾åˆ°è¿™ç§å¿«ä¹. è¿™ç§å¿«ä¹æ˜¯ä½ å¿½ç„¶è§‰å¾—ä½ æ”¾æ¾äº†. ä½ åœ¨äººç”Ÿä¸Šæ²¡æœ‰ä»€ä¹ˆä¸œè¥¿è¦è®¡è¾ƒ, ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸œè¥¿è¦åšä½œ.</p>
</blockquote>
<p>å¦‚æœåœ¨å­¦æ ¡å¦‚æœè€å¸ˆèƒ½è¿™æ ·è§£æ, é‚£å¯èƒ½å±‚æ¬¡å°±åˆä¸ä¸€æ ·äº†. è¿˜å¥½ä¸ç®—æ™š, æˆ‘ä»¬äººç”Ÿæ¯•ç«Ÿè¿˜æœ‰é‚£ä¹ˆé•¿å‘¢.</p>
<p>æå‰è¿‡äº†è‡ªå·±31å²ç”Ÿæ—¥, å·²ç»è¸å…¥32ä¸ªå¹´å¤´äº†, å›æƒ³èµ·æ¥æœ‰ç§æç„¶è‹¥æ¢¦çš„ä¸çœŸå®æ„Ÿ. æ„Ÿè§‰è‡ªå·±ä»ç„¶æ˜¯ä¸ªå°‘å¹´, ä»ç„¶èµ¤è„šåœ¨æ•…ä¹¡çš„å¤©ç©ºä¸‹å¥”è·‘, åœ¨é‡‘é»„çš„éº¦ç”°é‡Œå¤§å£°è°ˆå.<br>æƒ³èµ·äº†è‹è½¼çš„&lt;å¯’é£Ÿå¸–&gt;ä¸­æ‰€è¨€: </p>
<blockquote>
<p>é—‡ä¸­å·è´Ÿå»ï¼Œå¤œåŠçœŸæœ‰åŠ›ã€‚ <br/><br>ä½•æ®Šç—…å°‘å¹´ï¼Œç—…èµ·å¤´å·²ç™½ã€‚</p>
</blockquote>
<p>ç©äº†ç©&lt;å¦‚é¾™0&gt; &lt;ç»å¯¹ç»æœ›å°‘å¥³&gt;, åªç©äº†ç‰‡åˆ», å´ä¸æ€ä¹ˆèƒ½æèµ·å…´è¶£. å¯èƒ½æ˜¯ä¸Šäº†å¹´çºªå§. </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>weekend</tag>
        <tag>diary</tag>
        <tag>books</tag>
      </tags>
  </entry>
  <entry>
    <title>2021å¹´10æœˆç¬¬å››å‘¨</title>
    <url>//2021-10-23-weekend-summary/</url>
    <content><![CDATA[<p>å‘¨æœ«, æ·±ç§‹, å¤©å¯’, æ±Ÿå—, æ¸…å†·. å› æ„Ÿå†’è€Œç•¥å¾®å‘çƒ§, å’³å—½æ®‹ç—…çš„ä¸¤å¤©. åœ¨ç—…æ¦»ä¸Š, çªç„¶æƒ³èµ·æœç”«åœ¨&lt;ç™»é«˜&gt;ä¸­æ‰€è¨€:</p>
<blockquote>
<p>æ— è¾¹è½æœ¨è§è§ä¸‹ï¼Œä¸å°½é•¿æ±Ÿæ»šæ»šæ¥ã€‚<br>ä¸‡é‡Œæ‚²ç§‹å¸¸ä½œå®¢ï¼Œç™¾å¹´å¤šç—…ç‹¬ç™»å°ã€‚</p>
</blockquote>
<p>å¦‚æ­¤çš„åº”æ™¯, å¼•å‘å¼ºçƒˆçš„å†…å¿ƒå…±é¸£.<br>ä»¿ä½›ç§‹å­£å°±åº”è¯¥å±äºæœç”«, æ¯•ç«Ÿå†™äº†å¦‚æ­¤ä¹‹å¤šæ‚²ç§‹ä¹‹è¯—;<br>ä¼¤ç—…ä¹Ÿåº”è¯¥å±äºè¿™ä½æ‚²è‹¦çš„è¯—äºº, æ¯•ç«Ÿä¸æ˜¯åœ¨ç”Ÿç—…, å°±æ˜¯åœ¨ç”Ÿç—…çš„è·¯ä¸Š.</p>
<blockquote>
<p>äº²æœ‹æ— ä¸€å­—, è€ç—…æœ‰å­¤èˆŸ  â€”&lt;ç™»å²³é˜³æ¥¼&gt;</p>
</blockquote>
<p>æƒ³åˆ°æ­¤çœ¼å‰ä¸ç¦æµ®ç°ä¸€ä¸ªçœ‰å¤´ç´§çš±çš„ç©·é…¸å€’éœ‰é¬¼å½¢è±¡, å”‰å£°å¹æ°”, è‡ªæ€¨è‡ªè‰¾, åŠç€ä¹¦è¢‹, ä¸è§‰è‹¦ç¬‘, èå°”.</p>
<hr>
<p>å‘¨å…­æ™šä¸Šçœ‹äº†&lt;å…«è§’äº­è¿·é›¾&gt;, è¿·é›¾å‰§åœºå‡ºå“, æœ¬æ¥ä¿æœ‰ä¸€ä¸æœŸå¾…, ç»“æœåªçœ‹äº†ä¸‰å››é›†ä¾¿å…´è‡´å¯¥å¯¥, é‚å†³å®šå¼ƒå‰§. </p>
<p>ä¸€æ˜¯é€‰è§’ç»å¯¹æ˜¯æœ€å¤§è´¥ç¬”, æ ¹æœ¬æƒ³ä¸åˆ°â€ååŠ¨è¡—åŠé‚»é‡Œçš„å¤§ç¾å¥³â€ç«Ÿç„¶æ˜¯è¡¨æƒ…åƒµç¡¬, çœ‰å¤´ç´§çš±, æŠ«å¤´æ•£å‘, è‹¦å¤§ä»‡æ·±, å®¹è²Œå¹³åº¸ä¹‹çŠ¶. å®åœ¨æ˜¯éš¾ä»¥ç¼ºä¹å…±é¸£. å¯èƒ½æ˜¯å¸¦èµ„è¿›ç»„å§.<br>å¦å¤–å®åœ¨æ˜¯çœ‹ä¸å‡ºæ¥ç„ç æ˜¯æœ‰ä»€ä¹ˆæ ·çš„é­…åŠ›, èƒ½è®©è€æ¿è¯´å‡º â€œåªè¦ä½ ä¸€å¥è¯, æˆ‘ä¾¿è·Ÿå¥¹ç¦»å©šâ€ è¿™å¥è¯. åŸé…ä»èº«ææ ·è²Œ, æ²¡çœ‹å‡ºæ¥é‚£ç‚¹å„¿æ¯”å¥¹å·®çš„. </p>
<p>äºŒæ˜¯è§’è‰²å¡‘é€ ä¸åˆæƒ…ç†, æ²¡æœ‰ä¸€ä¸ªæ­£å¸¸äºº. ä¸æ˜¯åœ¨çˆ†å‘, å°±æ˜¯åœ¨çˆ†å‘çš„è·¯ä¸Š, æ‹§å·´çº ç»“, æ²¡æœ‰ä¸€ç‚¹æ­£å¸¸äººçš„ç†æ™º. å¤§å“¥ç„æ¢æ˜¯ä¸ªå› ä¸ºå¦¹å¦¹è¢«æ€å¯¼è‡´å¯¹å¥³å„¿ç—…æ€å…³çˆ±çš„PTSDæ‚£è€…,<br>äºŒå§å› ä¸ºç”Ÿä¸å‡ºå­©å­å¯¼è‡´å‡ ä¹ç¥ç»ç—…, åŒèƒèƒå¦¹å¦¹ç„ç æ˜¯18å¹´éƒ½è·Ÿå®¶é‡Œäººæ–­ç»è”ç³»çš„ç»æƒ…é¬¼. å¦ˆå¦ˆæ˜¯ä¸ªç³Šæ¶‚é¬¼, å¥³å„¿æ˜¯ä¸ªæ™ºå•†ä¸ºè´Ÿçš„å›é€†é¬¼, è­¦å¯Ÿæ˜¯ä¸ªæ— èƒ½çš„æ‹–å»¶é¬¼, è€å¸ˆæ˜¯ä¸ªæœ‰è·Ÿè¸ªç™–å¥½çš„å˜æ€é¬¼â€¦ç­‰ç­‰ä¸ä¸€è€Œè¶³.<br>ä¸‰æ˜¯æ•´ä½“æ°”æ°›å¤ªå‹æŠ‘, è‹¦å¤§ä»‡æ·±, å‰§æƒ…æ¨è¿›èŠ‚å¥å¤ªæ…¢. è§‚ä¼—ä»¿ä½›ä¹Ÿè¢«ä¸€åŒæµ¸æ²¡åœ¨æ°´ä¸­, éš¾ä»¥å‘¼å¸.   </p>
<p>è¾£çœ¼ç›è¾£çœ¼ç›, ç½¢äº†ç½¢äº†.<br>çœ‹äº†è™å—…ä¸Šå®‰åˆ©&lt;æ²™ä¸˜&gt;çš„æ–‡ç« , æœ‰ç‚¹å¿ƒåŠ¨, ä¸‹è½½æ¥åŸè‘—, ç—…åºŠä¸Šå®‰å¿ƒè¯»ä¸€è¯», æ´—æ´—çœ¼å§. </p>
<p>P.S. æ­åŸæ¡‚èŠ±å¼€äº†, ç”±äºæ°”å€™åŸå› , æ¯”å¾€å¹´éƒ½è¦æ™šä¸€äº›. æ»¡åŸéƒ½æ°¤æ°²åœ¨æ¡‚èŠ±çš„é¦™å‘³ä¸­, å®¶ä¸­æ‰“å¼€çª—æˆ·, èŠ±é¦™ä¾¿éšé£æ½œå…¥, ä»¤äººå¿ƒæ—·ç¥æ€¡. ç»™ç—…æ¦»ä¸Šçš„äººä¸€ä¸ä¸å®‰æ…°.<br>å°åŒºä¸­éšå¤„æ¼«æ­¥, é‡‘æ¡‚å±…å¤š, ä¸¹æ¡‚è™½å°‘ä½†æ›´ä¸ºåˆ«è‡´, è¿˜æœ‰äº›ç”±äºä¹‹å‰å¼‚å˜çš„æ°”æ¸©å¯¼è‡´è¯¯å¼€çš„æ¨±èŠ±.</p>
<blockquote>
<p>æ±Ÿå—å¿†<br/><br>æœ€å¿†æ˜¯æ­å·<br/><br>å±±å¯ºæœˆä¸­å¯»æ¡‚å­<br/><br>éƒ¡äº­æ•ä¸Šçœ‹æ½®å¤´<br/><br>ä½•æ—¥æ›´é‡æ¸¸<br/><br>&lt;å¿†æ±Ÿå—&gt; ç™½å±…æ˜“</p>
</blockquote>
<p>P.S.2 </p>
<blockquote>
<p>å®å¯é£Ÿæ— è‚‰ï¼Œä¸å¯å±…æ— ç«¹ã€‚<br/><br>æ— è‚‰ä»¤äººç˜¦ï¼Œæ— ç«¹ä»¤äººä¿—ã€‚<br/><br>äººç˜¦å°šå¯è‚¥ï¼Œå£«ä¿—ä¸å¯åŒ»ã€‚<br/><br>æ—äººç¬‘æ­¤è¨€ï¼Œä¼¼é«˜è¿˜ä¼¼ç—´ã€‚<br/><br>è‹¥å¯¹æ­¤å›ä»å¤§åš¼ï¼Œä¸–é—´é‚£æœ‰æ‰¬å·é¹¤ï¼Ÿ<br/><br>&lt;æ–¼æ½œåƒ§ç»¿ç­ è½©&gt; è‹è½¼</p>
</blockquote>
<p>æ‰çŸ¥é“ä¸œå¡çš„è¿™é¦–è¯—, å°±æ˜¯åœ¨å‡ºä»»æ­å·é€šåˆ¤æ—¶, ä»å¯Œé˜³ æ–°ç™» å–é“æµ®äº‘å²­, è¿›å…¥æ–¼æ½œå¿å¢ƒâ€è§†æ”¿â€æ—¶å†™çš„.<br>æ–¼æ½œåƒ§æ…§è§‰åœ¨æ–¼æ½œå¿å—äºŒé‡Œçš„ä¸°å›½ä¹¡å¯‚ç…§å¯ºå‡ºå®¶ã€‚å¯ºå†…æœ‰ç»¿ç­ è½©ï¼Œä»¥ç«¹ç‚¹ç¼€ç¯å¢ƒï¼Œååˆ†å¹½é›…ã€‚è‹è½¼ä¸åƒ§æ…§è§‰æ¸¸ç»¿ç­ è½©æ—¶ï¼Œå†™ä¸‹äº†è¿™é¦–ã€Šæ–¼æ½œåƒ§ç»¿ç­ è½©ã€‹ã€‚<br>å…·ä½“ä½ç½®åº”è¯¥æ˜¯ç°åœ¨æ­å·å¸‚ä¸´å®‰åŒºæ–¼æ½œé•‡é™„è¿‘.<br>æœ‰æ—¶é—´å¯ä»¥å»æ‰¾ä¸€æ‰¾. </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>weekend</tag>
        <tag>diary</tag>
        <tag>books</tag>
      </tags>
  </entry>
  <entry>
    <title>2021å¹´10æœˆç¬¬äº”å‘¨</title>
    <url>//2021-10-30-weekend-summary/</url>
    <content><![CDATA[<p>ç¬¬ä¸€æ¬¡å®Œæ•´åœ°å‚åŠ äº†ä¸€æ¬¡ä»£ç å¤§èµ›, å³é˜¿é‡Œäº‘ä¸¾åŠçš„ <a href="https://code83.ide.aliyun.com/billboard">83è¡Œä»£ç </a>.<br>æ•´ä½“æ²¡æœ‰ç‰¹åˆ«æŠ•å…¥, æ‰€ä»¥æœ€ç»ˆæˆç»©ä¹Ÿä¸ç®—ç‰¹åˆ«å¥½. </p>
<hr>
<p>ç¬¬äºŒé¢˜: ä¸€çœ‹é¢˜ç›®å°±æƒ³åˆ°ä½¿ç”¨TrieTree, ä½†æ•´ä½“ä¼˜åŒ–æ€è·¯è·ŸPerfå·¥å…·æ²¡æœ‰ç‰¹åˆ«å¥½. æœ€ä¸»è¦æ˜¯å†…å­˜å ç”¨ä¼˜åŒ–ç»•äº†åœˆå­, æœ€ç»ˆä¹Ÿæ²¡æœ‰èµ°å‡ºæ¥. ä¸ªäººå¯¹æœ€ç»ˆç»“æœä¸æ˜¯ç‰¹åˆ«æ»¡æ„.</p>
<ul>
<li>å…·ä½“å®ç°åœ¨è¿™é‡Œ: <a href="https://github.com/DavyJones2010/2021-code83-round2.git">round2</a></li>
<li>Update 20211114: ç»è¿‡èµ›é¢˜è¯¦è§£ä¸åç»­åæ€, æ€è€ƒé—®é¢˜å‡ºåœ¨å¦‚ä¸‹åœ°æ–¹:<ul>
<li>ç”±äºæŠ½è±¡å‡ºäº†Nodeå¯¹è±¡, ä»è€Œæ¯ä¸ªå­—ç¬¦èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªå¯¹è±¡, è€Œ<ul>
<li><a href="https://www.jianshu.com/p/1ca4b72d50f1">Javaä¸­ç©ºå¯¹è±¡å ç”¨è‡³å°‘16Byte</a></li>
<li><a href="https://www.jianshu.com/p/1ca4b72d50f1">Javaä¸­å¼•ç”¨å ç”¨è‡³å°‘å ç”¨4Byte</a></li>
</ul>
</li>
<li>æ‰€ä»¥è™½ç„¶å®é™…Nodeå¯¹è±¡ä¸­åªæœ‰ä¸€ä¸ªchar&#x2F;byte, ä½†å®é™…å ç”¨ç©ºé—´è‡³å°‘æ˜¯ 16B+1B </li>
<li>æ‰€ä»¥å®˜æ–¹ç»™å‡ºçš„ä¼˜åŒ–æ–¹æ¡ˆæ˜¯: <ul>
<li>å‡å°‘Nodeå¯¹è±¡æ•°é‡:<ul>
<li>ä½¿ç”¨ <a href="https://www.cs.usfca.edu/~galles/visualization/RadixTree.html">RadixTree</a> <img data-src="/../_assets/2021-10-31-weekend-summary/radix-tree.png" alt="radix-tree.png"></li>
<li>ä½¿ç”¨æ•°ç»„ç­‰æ–¹å¼, ä¸ç”Ÿäº§å¯¹è±¡</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>ç¬¬ä¸‰é¢˜: åŸºæœ¬é¢å‘å¯¹è±¡çš„é‡æ„å®Œå…¨æ²¡é—®é¢˜. ä½†æ­£ç¡®ç‡ä¸€ç›´åœ¨50åˆ†. å§‹ç»ˆæƒ³ä¸åˆ°å“ªé‡Œçš„é€»è¾‘å‡ºé”™äº†.<br>ä¸»è¦ä¸€æ–¹é¢åŸå› å¯ä»¥å½’ç»“äºé¢˜ç›®æè¿°è¿‡äºå«ç³Š, æ„Ÿè§‰æˆäº†é˜…è¯»ç†è§£. ç­‰å¾…æœ€ç»ˆç»“æœå…¬å¸ƒå†çœ‹ä¸‹å§.</p>
<ul>
<li>å…·ä½“å®ç°åœ¨è¿™é‡Œ: <a href="https://github.com/DavyJones2010/2021-code83-round3.git">round3</a></li>
<li>Update 20211114: ç»è¿‡èµ›é¢˜è¯¦è§£ä¸è‡ªæˆ‘åæ€, ç»ˆäºæŸ¥æ˜äº†åŸå› :<ul>
<li>ä¸æ­£ç¡®ç­”æ¡ˆå¯¹æ¯”, å‘ç°æˆ‘æäº¤çš„ä»£ç é€»è¾‘æ˜¯æ²¡æœ‰é”™çš„!</li>
<li>ä½†ç”±äºé¢˜ç›®é‡Œæ²¡æœ‰è¯´æ¸…æ¥šåˆ°åº•æ€ä¹ˆè¯„åˆ¤ç»“æœ, ä¸ªäººä»¥ä¸ºæ˜¯é€šè¿‡sysoutç­‰æ–¹å¼, ä½†å®é™…æ¨æµ‹åº”è¯¥æ˜¯å°†æ„é€ å‡½æ•°ä¸­çš„itemséƒ½åœ¨å¤–éƒ¨é‡æ–°å¾ªç¯ä¸€éæŸ¥çœ‹.</li>
<li>ç”±äºæˆ‘çš„å®ç°é‡Œ, æ–°newå‡ºäº†æ–°çš„items, å®Œå…¨æ²¡æœ‰ä½¿ç”¨å¤–éƒ¨ä¼ å…¥çš„. æ‰€ä»¥è¯„åˆ¤ç»“æœä¸€ç›´æ˜¯é”™è¯¯. åç»­æŒ‰ç…§å®˜æ–¹çš„æ„å›¾ä¿®æ”¹äº†ä¸‹, å°±OKäº†.</li>
<li>è¿™ä¸ªçœŸæ˜¯å‘çˆ¹!!!<br><img data-src="/../_assets/2021-10-31-weekend-summary/round3.png" alt="img.png"></li>
</ul>
</li>
</ul>
<hr>
<p>ç¬¬å››é¢˜: æ—¶é—´æ¯”è¾ƒç´§å¼ , ä½†åŸºæœ¬æ€è·¯è¿˜OK. BugåŸºæœ¬ä¹Ÿä¿®å¤äº†. </p>
<pre class="line-numbers language-none"><code class="language-none">1. SpringSecurityç¦ç”¨æ‰CSRFæ ¡éªŒ
2. addUseræ—¶, ä½¿ç”¨çš„adminè´¦å·çš„å¯†ç æœ‰è¯¯, ä½¿ç”¨äº†åŸºç¡€çš„BaseAuthenticationæ–¹å¼, è´¦å·&amp;å¯†ç æ˜¯ç”¨base64ç¼–ç çš„. ä¿®å¤æ‰åˆå§‹åŒ–æ—¶çš„adminå¯†ç å³å¯. 
3. æƒé™è®¾ç½®ä¹Ÿæœ‰ç‚¹é—®é¢˜. å¾ˆç®€å•å°±ä¿®å¤äº†. 
4. æ ¹æ®åè®®ååºåˆ—åŒ–ä¸ºStringæ—¶, ä¸èƒ½æŠŠç¼–ç æ–¹å¼æ”¾åœ¨ThreadLocalé‡Œ. 
5. DataBufferè½¬åŒ–ä¸ºbyte[]æ˜¯, ç»†èŠ‚å¤„ç†çš„ä¸å¤ªå¥½. <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸è¿‡æœ€ç»ˆç®—æ˜¯æŠŠä¹±ç é—®é¢˜ä¹Ÿéƒ½ä¿®å¤äº†. åœ¨è¿™ä¸ªè¿‡ç¨‹æŸ¥æ¼è¡¥ç¼º, å‘ç°ä¸ªäººå¯¹DataBufferä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰, æ‰¾æœºä¼šæ¶è¡¥ä¸€æ³¢.</p>
<hr>
<p>æ€»ç»“, æ•´ä½“è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©çš„, ä¸ªäººä¹ŸçœŸåˆ‡æ„Ÿå—åˆ°äº†å…¶ä¸­çš„è¿·èŒ«ç´§å¼ ä¸ä¹è¶£, ä¹Ÿå¾—åˆ°äº†ä¸€äº›æŠ€æœ¯ä¸Šçš„è¿›æ­¥. </p>
<p>æœ€ç»ˆè™½ç„¶åªé›†é½äº†8ä¸ªçº¿ç´¢, ä½†åŸºæœ¬æ»¡è¶³é¢„æœŸ, å¯ä»¥å¦ä¸€ä¸ªé™é‡ç‰ˆçš„å…¬ä»”å“‡å’”å’”.</p>
<p>æ€»ä½“æ¥è¯´ä½œä¸ºä¸€ä¸ªå·¥ä½œå¤šå¹´çš„è€å¸æœº, è¢«è¿™ä¹ˆå¤šåè¾ˆæˆç»©ç”©åœ¨åè¾¹, çœŸæ˜¯å¿ƒæœ‰ä¸ç”˜, åç”Ÿå¯ç•, ç»§ç»­åŠªåŠ›!</p>
<p>åç»­æœ‰è¿™ç§æ´»åŠ¨, è¿˜è¦ç»§ç»­å‚ä¸, ç®€ç›´æ˜¯å°æŠ•å…¥, å¤§å›æŠ¥, å…¶ä¹æ— ç©·~</p>
<hr>
<p>å¦å¤–, é™„åŠ ä¸€ä¸ªç½‘ç«™, å¯ä»¥åœ¨çº¿çœ‹åˆ°æ•°æ®ç»“æ„çš„ç”Ÿæˆé€»è¾‘, ååˆ†æ–¹ä¾¿: <a href="https://www.cs.usfca.edu/~galles/visualization/">Data Structure Visualizations</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>weekend</tag>
        <tag>diary</tag>
        <tag>books</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡ç”±äºMDC.putå¼•å‘çš„NPE</title>
    <url>//2021-11-03-java-mdc-put-npe/</url>
    <content><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>æµ‹è¯•çš„æ—¶å€™, å‘ç°ä»£ç æŸå¤„æŠ›å‡ºäº†NPE:<br>æ ¹æ®å †æ ˆä¿¡æ¯å‘ç°åœ¨å¦‚ä¸‹åœ°æ–¹æŠ›å‡º.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071137212.png"><br>è¿½è¸ªå®ç°, çŸ¥é“MDC.putåº•å±‚æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨çš„java.util.Hashtable.put</p>
<h1 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h1><h2 id="å‡ ç§HashMapæ¯”è¾ƒ"><a href="#å‡ ç§HashMapæ¯”è¾ƒ" class="headerlink" title="å‡ ç§HashMapæ¯”è¾ƒ"></a>å‡ ç§HashMapæ¯”è¾ƒ</h2><p>åŸºäºå½“å‰jdk1.8çš„å®ç°, æ¯”è¾ƒå¦‚ä¸‹:</p>
<table>
<thead>
<tr>
<th>æ“ä½œ\å®ç°</th>
<th>java.util.HashMap</th>
<th>java.util.concurrent.ConcurrentHashMap</th>
<th>java.util.Hashtable</th>
</tr>
</thead>
<tbody><tr>
<td>put(null, value)</td>
<td>OK</td>
<td></td>
<td></td>
</tr>
<tr>
<td>å¯ä»¥é€šè¿‡get(null)è·å–åˆ°value</td>
<td>NPE</td>
<td>NPE</td>
<td></td>
</tr>
<tr>
<td>put(key, null)</td>
<td>OK</td>
<td></td>
<td></td>
</tr>
<tr>
<td>å¯ä»¥é€šè¿‡get(key)è·å–åˆ°null</td>
<td>NPE</td>
<td>NPE</td>
<td></td>
</tr>
<tr>
<td>get(null)</td>
<td>OK</td>
<td>NPE</td>
<td>NPE</td>
</tr>
<tr>
<td>remove(null)</td>
<td>OK</td>
<td>NPE</td>
<td>NPE</td>
</tr>
</tbody></table>
<h2 id="MDC-amp-NDCæ¯”è¾ƒ"><a href="#MDC-amp-NDCæ¯”è¾ƒ" class="headerlink" title="MDC&amp;NDCæ¯”è¾ƒ"></a>MDC&amp;NDCæ¯”è¾ƒ</h2><ul>
<li>MDCåº•å±‚: put&#x2F;get&#x2F;remove ç›´æ¥è°ƒç”¨çš„hashtableçš„æ–¹æ³•, ä¸è®ºæ˜¯<ul>
<li>org.apache.log4j.MDC</li>
<li>è¿˜æ˜¯ org.slf4j.MDC, åº•å±‚ç”¨çš„è¿˜æ˜¯org.apache.log4j.MDC</li>
</ul>
</li>
<li>NDCåº•å±‚: push&#x2F;pop&#x2F;peek çš„æ—¶å€™, ä½¿ç”¨äº† DiagnosticContext å°è£… + java.util.Stack , æ‰€ä»¥è¦å®‰å…¨å¾ˆå¤š</li>
</ul>
<table>
<thead>
<tr>
<th>æ“ä½œ\å®ç°</th>
<th>MDC</th>
<th>NDC</th>
</tr>
</thead>
<tbody><tr>
<td>MDC.put(null, value)</td>
<td>NPE</td>
<td></td>
</tr>
<tr>
<td>MDC.put(key, null)</td>
<td>NPE</td>
<td></td>
</tr>
<tr>
<td>MDC.get(null)</td>
<td>IllegalArgumentException</td>
<td></td>
</tr>
<tr>
<td>MDC.remove(null)</td>
<td>IllegalArgumentException</td>
<td></td>
</tr>
<tr>
<td>NDC.push(null)</td>
<td></td>
<td>OK</td>
</tr>
<tr>
<td>NDC.pop()</td>
<td></td>
<td>å¯ä»¥popå‡ºnull</td>
</tr>
<tr>
<td>NDC.peek()</td>
<td></td>
<td>å¯ä»¥peekå‡ºnull</td>
</tr>
</tbody></table>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul>
<li>å¿…é¡»è¦åæ§½ä¸‹apacheçš„MDCå®ç°, ç†è®ºä¸Š<ul>
<li>MDCé‡Œåšä¸ªNPEé˜²å¾¡, å…¶å®å®Œå…¨æ²¡æœ‰é—®é¢˜, ç¬¦åˆä¸šåŠ¡é¢„æœŸ.</li>
<li>åº•å±‚ä½¿ç”¨ConcurrentHashMap, ä»¥æé«˜æ€§èƒ½.</li>
</ul>
</li>
<li>ç®—æ˜¯è¸©å‘äº†, ä»¥åä½¿ç”¨MDC&#x2F;ConcurrentHashMap&#x2F;Hashtableçš„æ—¶å€™åƒä¸‡æ³¨æ„NPE!</li>
<li>å°½é‡èƒ½ç”¨NDCå°±ç”¨NDCå§</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>mdc</tag>
        <tag>npe</tag>
      </tags>
  </entry>
  <entry>
    <title>macåˆå§‹åŒ–é…ç½®</title>
    <url>//2021-11-06-mac-init/</url>
    <content><![CDATA[<h1 id="å¿…è£…è½¯ä»¶"><a href="#å¿…è£…è½¯ä»¶" class="headerlink" title="å¿…è£…è½¯ä»¶"></a>å¿…è£…è½¯ä»¶</h1><ul>
<li>TotalFinder</li>
<li>Alfred</li>
<li>Maven</li>
<li>Git</li>
<li>Protobuf</li>
<li>SourceTree</li>
<li>IntelliJ IDEA</li>
<li>Docker</li>
<li>ClashX</li>
<li>PlistEdit Pro</li>
<li>HomeBrew</li>
<li>XMind</li>
<li>Gliffy Diagrams</li>
<li>Sublime</li>
<li>ç©ºæ°”æ—¥å†</li>
<li>iShot</li>
<li>Timeout</li>
<li><a href="https://picgo.github.io/PicGo-Doc/en/guide/#picgo-is-here">PicGo</a> å›¾åºŠè½¯ä»¶, Blogå¿…å¤‡</li>
</ul>
<h2 id="HomeBrewå®‰è£…é…ç½®"><a href="#HomeBrewå®‰è£…é…ç½®" class="headerlink" title="HomeBrewå®‰è£…é…ç½®"></a>HomeBrewå®‰è£…é…ç½®</h2><h3 id="å®‰è£…è„šæœ¬"><a href="#å®‰è£…è„šæœ¬" class="headerlink" title="å®‰è£…è„šæœ¬"></a>å®‰è£…è„šæœ¬</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/bash -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh<span class="token variable">)</span></span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="ä¿®æ”¹æºç«™"><a href="#ä¿®æ”¹æºç«™" class="headerlink" title="ä¿®æ”¹æºç«™"></a>ä¿®æ”¹æºç«™</h3><p>ä¸­æ–‡å®‰è£…æ•™ç¨‹ï¼ˆå»ºè®®æ”¶è—ï¼‰ï¼š<a href="https://brew.idayer.com/">https://brew.idayer.com/</a><br>å¦‚æœä½ æƒ³æ¢æºï¼Œå¯ä»¥ä½¿ç”¨é•œåƒåŠ©æ‰‹ï¼š<a href="https://brew.idayer.com/guide/change-source/">https://brew.idayer.com/guide/change-source/</a></p>
<h1 id="å¿…è¦é…ç½®"><a href="#å¿…è¦é…ç½®" class="headerlink" title="å¿…è¦é…ç½®"></a>å¿…è¦é…ç½®</h1><h3 id="å…³é—­SIPå®‰å…¨è®¾ç½®"><a href="#å…³é—­SIPå®‰å…¨è®¾ç½®" class="headerlink" title="å…³é—­SIPå®‰å…¨è®¾ç½®"></a>å…³é—­SIPå®‰å…¨è®¾ç½®</h3><p>1ã€é‡å¯ Macï¼ŒæŒ‰ä½ Command+R é”®ç›´åˆ° Apple logo å‡ºç°ï¼Œè¿›å…¥ Recovery Mode</p>
<p>2ã€ç‚¹å‡» Utilities &gt; Terminalã€‚ï¼ˆæˆ‘çš„æ˜¯ä¸­æ–‡ç‰ˆçš„ï¼Œçœ‹å›¾å·¦ä¸Šè§’ï¼Œå®ç”¨å·¥å…· &gt; ç»ˆç«¯ï¼‰</p>
<p>3ã€åœ¨ Terminal ä¸­è¾“å…¥ csrutil disableï¼Œä¹‹åå›è½¦</p>
<p>4ã€é‡å¯ Mac<br>ï¼ˆè¿™æ · SIP å®‰å…¨è®¾ç½®å°±å·²ç»è¢«å…³é—­äº†ï¼Œå¦‚æœæƒ³é‡æ–°å¼€å¯è¯¥å®‰å…¨è®¾ç½®ï¼Œé‡å¤ä¸Šé¢æ­¥éª¤ï¼Œåœ¨ç¬¬ä¸‰æ­¥ä¸­å°†å‘½ä»¤æ›´æ¢ä¸º csrutil enableã€‚ï¼‰</p>
<h3 id="åˆ é™¤é»˜è®¤è‹±æ–‡è¾“å…¥æ³•"><a href="#åˆ é™¤é»˜è®¤è‹±æ–‡è¾“å…¥æ³•" class="headerlink" title="åˆ é™¤é»˜è®¤è‹±æ–‡è¾“å…¥æ³•"></a>åˆ é™¤é»˜è®¤è‹±æ–‡è¾“å…¥æ³•</h3><ol>
<li>å…³é—­SIP</li>
<li>ä½¿ç”¨PlistEdit Pro ç¼–è¾‘ <code>~/Library/Preferences/com.apple.HIToolbox.plist</code></li>
<li>åˆ é™¤ ABCçš„é€‰é¡¹(æˆ–è€…U.S): <img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302191145532.png"></li>
<li>å†æ¬¡é‡å¯ç”µè„‘</li>
</ol>
<h4 id="å‚ç…§"><a href="#å‚ç…§" class="headerlink" title="å‚ç…§"></a>å‚ç…§</h4><p><a href="https://blog.csdn.net/fgx_123456/article/details/87815697">å®Œç¾åˆ é™¤Mac Osè‡ªå¸¦è¾“å…¥æ³•</a></p>
<h3 id="ä½¿ç”¨bash-æ›¿æ¢æ‰é»˜è®¤çš„zsh"><a href="#ä½¿ç”¨bash-æ›¿æ¢æ‰é»˜è®¤çš„zsh" class="headerlink" title="ä½¿ç”¨bash, æ›¿æ¢æ‰é»˜è®¤çš„zsh"></a>ä½¿ç”¨bash, æ›¿æ¢æ‰é»˜è®¤çš„zsh</h3><h4 id="å…¨å±€è´¦å·"><a href="#å…¨å±€è´¦å·" class="headerlink" title="å…¨å±€è´¦å·"></a>å…¨å±€è´¦å·</h4><p>å‚è€ƒ: <a href="https://support.apple.com/zh-cn/guide/terminal/trml113/2.11/mac/11.0">åœ¨ Mac ä¸Šçš„â€œç»ˆç«¯â€ä¸­æ›´æ”¹é»˜è®¤ shell</a></p>
<h4 id="iterm"><a href="#iterm" class="headerlink" title="iterm"></a>iterm</h4><p><code>iTerm2-&gt;Preferences-&gt;Profiles-&gt;Command</code><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302191145530.png"></p>
<h3 id="å»é™¤æ‰zshçƒ¦äººçš„æç¤º"><a href="#å»é™¤æ‰zshçƒ¦äººçš„æç¤º" class="headerlink" title="å»é™¤æ‰zshçƒ¦äººçš„æç¤º"></a>å»é™¤æ‰zshçƒ¦äººçš„æç¤º</h3><h4 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">The default interactive shell is now zsh.
To update your account to use zsh, please run <span class="token variable"><span class="token variable">`</span>chsh -s /bin/zsh<span class="token variable">`</span></span><span class="token builtin class-name">.</span>
For <span class="token function">more</span> details, please visit https://support.apple.com/kb/HT208050.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> ~/.bash_profile
<span class="token builtin class-name">export</span> <span class="token assign-left variable">BASH_SILENCE_DEPRECATION_WARNING</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="å‚è§"><a href="#å‚è§" class="headerlink" title="å‚è§"></a>å‚è§</h4><p><a href="https://apple.stackexchange.com/questions/371997/suppressing-the-default-interactive-shell-is-now-zsh-message-in-macos-catalina">Suppressing â€œThe default interactive shell is now zshâ€ message in macOS Catalina</a></p>
<h3 id="å¼€å¯è§¦æ‘¸æ¿è½»ç‚¹ç¡®è®¤"><a href="#å¼€å¯è§¦æ‘¸æ¿è½»ç‚¹ç¡®è®¤" class="headerlink" title="å¼€å¯è§¦æ‘¸æ¿è½»ç‚¹ç¡®è®¤"></a>å¼€å¯è§¦æ‘¸æ¿è½»ç‚¹ç¡®è®¤</h3><p>ç»å¸¸éœ€è¦åœ¨è§¦æ‘¸æ¿ä¸Šç‚¹å‡»ä¹‹ç±»çš„, é»˜è®¤æ˜¯éœ€è¦æŒ‰ä¸‹å», æ‰ç®—æ˜¯ç‚¹å‡»æŒ‰é’®, ä½†è¿™æ ·å¤ªè´¹åŠ²å„¿.</p>
<h3 id="å¼€å¯tabåˆ‡æ¢å¯¹è¯æ¡†é€‰é¡¹"><a href="#å¼€å¯tabåˆ‡æ¢å¯¹è¯æ¡†é€‰é¡¹" class="headerlink" title="å¼€å¯tabåˆ‡æ¢å¯¹è¯æ¡†é€‰é¡¹"></a>å¼€å¯tabåˆ‡æ¢å¯¹è¯æ¡†é€‰é¡¹</h3><h1 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h1><h2 id="githubè¿æ¥ä¸ä¸Š"><a href="#githubè¿æ¥ä¸ä¸Š" class="headerlink" title="githubè¿æ¥ä¸ä¸Š"></a>githubè¿æ¥ä¸ä¸Š</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">fatal: unable to access <span class="token string">'https://github.com/DavyJones2010/davyjones2010.github.io.git/'</span><span class="token builtin class-name">:</span> Failed to connect to github.com port <span class="token number">443</span>: Operation timed out<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æˆ–è€…</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SSL_ERROR_SYSCALL <span class="token keyword">in</span> connection to github.com:443<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ ¹æœ¬åŸå› æ˜¯æœ¬åœ°å¯ç”¨äº†VPN(ClashX), ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®gitçš„proxyå³å¯: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config --global http.proxy <span class="token number">127.0</span>.0.1:7890
<span class="token function">git</span> config --global https.proxy <span class="token number">127.0</span>.0.1:7890<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>é…ç½®å¥½ä¹‹å, é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config --global http.proxy
<span class="token function">git</span> config --global https.proxy <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åˆ é™¤é…ç½®: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config --global --unset http.proxy
<span class="token function">git</span> config --global --unset https.proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å‚è€ƒ <a href="https://blog.csdn.net/qq_37555071/article/details/114260533">OpenSSL SSL_connect: Connection was reset in connection to github.com:443</a></p>
<h2 id="iTerm2é…ç½®-Option-â†-Option-â†’-æŒ‰å•è¯å¿«é€Ÿç§»åŠ¨"><a href="#iTerm2é…ç½®-Option-â†-Option-â†’-æŒ‰å•è¯å¿«é€Ÿç§»åŠ¨" class="headerlink" title="iTerm2é…ç½® Option+â† Option+â†’ æŒ‰å•è¯å¿«é€Ÿç§»åŠ¨"></a>iTerm2é…ç½® Option+â† Option+â†’ æŒ‰å•è¯å¿«é€Ÿç§»åŠ¨</h2><p>è·¯å¾„: iTerm2-&gt;Preferences-&gt;Profiles-&gt;Keys-&gt;Key Mappings</p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302191205207.png"></p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302191146635.png"></p>
<p>å‚è€ƒ <a href="https://blog.csdn.net/skyyws/article/details/78480132">Macä¸‹iTerm2å…‰æ ‡æŒ‰ç…§å•è¯å¿«é€Ÿç§»åŠ¨è®¾ç½®</a></p>
<h2 id="iTerm2å¿«é€Ÿåˆ†å±"><a href="#iTerm2å¿«é€Ÿåˆ†å±" class="headerlink" title="iTerm2å¿«é€Ÿåˆ†å±"></a>iTerm2å¿«é€Ÿåˆ†å±</h2><ul>
<li><code>âŒ˜ + N</code> for a new window</li>
<li><code>âŒ˜ + T</code> for a new tab</li>
<li><code>âŒ˜ + D</code> to split my pane vertically</li>
<li><code>âŒ˜ + â‡§ + D</code> to split it horizontally</li>
<li>åŒæ—¶éœ€è¦ä¿æŒæ–°æ‹†åˆ†å‡ºçš„çª—å£ç›®å½•ä¸å½“å‰æ–‡ä»¶ç›®å½•ä¿æŒä¸€è‡´: <a href="https://apple.stackexchange.com/questions/337377/iterm2-split-vertically-with-current-profile-with-same-working-directory">iterm2-split-vertically-with-current-profile-with-same-working-directory</a></li>
</ul>
<h2 id="iTerm2åˆ†å±å¯¼èˆª"><a href="#iTerm2åˆ†å±å¯¼èˆª" class="headerlink" title="iTerm2åˆ†å±å¯¼èˆª"></a>iTerm2åˆ†å±å¯¼èˆª</h2><ul>
<li><strong>cmd-opt-arrow</strong> è¿›è¡Œåˆ†å±å¯¼èˆª</li>
<li><strong>cmd-1&#x2F;2&#x2F;3</strong> æˆ–è€… <strong>cmd-arrow</strong> è¿›è¡ŒTabå¯¼èˆª</li>
</ul>
<h2 id="gité…ç½®SSHKeyè®¿é—®"><a href="#gité…ç½®SSHKeyè®¿é—®" class="headerlink" title="gité…ç½®SSHKeyè®¿é—®"></a>gité…ç½®SSHKeyè®¿é—®</h2><p>å‚è§<a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">Connect with SSH</a></p>
<h2 id="Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ"><a href="#Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ" class="headerlink" title="Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ"></a>Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ</h2><p>Copy From <a href="https://zhuanlan.zhihu.com/p/71998219">å°†mavenæºæ”¹ä¸ºå›½å†…é˜¿é‡Œäº‘é•œåƒ</a></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/SETTINGS/1.0.0<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/SETTINGS/1.0.0
                      http://maven.apache.org/xsd/settings-1.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localRepository</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interactiveMode</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>usePluginRegistry</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>offline</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginGroups</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servers</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>é˜¿é‡Œäº‘å…¬å…±ä»“åº“<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>repo1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>central repo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://repo1.maven.org/maven2/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>apache snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>é˜¿é‡Œäº‘é˜¿å¸•å¥‡ä»“åº“<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/apache-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>proxies</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeProfiles</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">></span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">></span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>releases</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>releases</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>MavenCentral<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://repo1.maven.org/maven2/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmavenApache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/apache-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">></span></span>             
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="å¸¸ç”¨å‘½ä»¤-x2F-æ“ä½œ"><a href="#å¸¸ç”¨å‘½ä»¤-x2F-æ“ä½œ" class="headerlink" title="å¸¸ç”¨å‘½ä»¤&#x2F;æ“ä½œ"></a>å¸¸ç”¨å‘½ä»¤&#x2F;æ“ä½œ</h1><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><ul>
<li><p>MACæ€ä¹ˆé‡ç½®SMC&#x2F;NVRAM&#x2F;PRAM</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Option+Command+P+R<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>å¼€æœºé€‰æ‹©å¯åŠ¨ç£ç›˜</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æŒ‰ä½ option é”®<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>é‡è£…ç³»ç»Ÿ</p>
<ul>
<li>å®‰è£…ä¸ä½ ç”µè„‘å…¼å®¹çš„ macOS æœ€æ–°ç‰ˆæœ¬ï¼šOption-Command-Rã€‚ </li>
<li>é‡æ–°å®‰è£…ä½ ç”µè„‘åŸå§‹ç‰ˆæœ¬çš„ macOSï¼ˆåŒ…æ‹¬å¯ç”¨çš„æ›´æ–°ï¼‰ï¼šOption-Shift-Command-Rã€‚ </li>
<li>é‡æ–°å®‰è£…å½“å‰ç‰ˆæœ¬çš„ macOSï¼šCommand-Rã€‚</li>
</ul>
</li>
</ul>
<h2 id="ç¡¬ä»¶æ€§èƒ½ç›¸å…³"><a href="#ç¡¬ä»¶æ€§èƒ½ç›¸å…³" class="headerlink" title="ç¡¬ä»¶æ€§èƒ½ç›¸å…³"></a>ç¡¬ä»¶æ€§èƒ½ç›¸å…³</h2><ul>
<li><p>æŸ¥çœ‹CPUå‹å·</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sysctl machdep.cpu.brand_string
machdep.cpu.brand_string: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> M-5Y71 CPU @ <span class="token number">1</span>.20GHz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹ç‰©ç†å†…å­˜å¤§å°</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> sysctl -n hw.memsize
<span class="token number">8589934592</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>åŠ å¿«TimeMachineå¤‡ä»½çš„é€Ÿåº¦</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">sudo</span> sysctl debug.lowpri_throttle_enabled<span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h1 id="å¸¸ç”¨é“¾æ¥-amp-å·¥å…·"><a href="#å¸¸ç”¨é“¾æ¥-amp-å·¥å…·" class="headerlink" title="å¸¸ç”¨é“¾æ¥&amp;å·¥å…·"></a>å¸¸ç”¨é“¾æ¥&amp;å·¥å…·</h1><ul>
<li>æŸ¥è¯¢MacOS æ”¯æŒçš„Macå‹å·: <a href="https://eshop.macsales.com/guides/Mac_OS_X_Compatibility">MacOS Compatibility Guide by Mac Model</a></li>
<li>æŸ¥è¯¢Mac SNå·ç å¯¹åº”çš„ç¡¬ä»¶è¯¦ç»†ä¿¡æ¯: <a href="https://appleserialnumberinfo.com/Desktop/index.php">Apple Serial Number Info</a></li>
<li>ä¸ºè€æ—§Macå®‰è£…æ–°çš„ MacOS ç³»ç»Ÿ: <a href="https://dortania.github.io/OpenCore-Legacy-Patcher/">OpenCore Legacy Patcher</a></li>
<li>MacOSå„ä¸ªç‰ˆæœ¬å®˜æ–¹ä¸‹è½½åœ°å€: <a href="https://support.apple.com/zh-cn/HT211683">å¦‚ä½•ä¸‹è½½å’Œå®‰è£… macOS - å®˜æ–¹ Apple æ”¯æŒ (ä¸­å›½)</a></li>
<li>å¦‚ä½•åˆ›å»ºMacOSç£ç›˜é•œåƒ(æ–¹ä¾¿éšæ—¶é‡è£…ç³»ç»Ÿ): <a href="https://support.apple.com/zh-cn/HT201372">åˆ›å»ºå¯å¼•å¯¼çš„ macOS å®‰è£…å™¨ - å®˜æ–¹ Apple æ”¯æŒ (ä¸­å›½)</a></li>
</ul>
<h1 id="æ–°Macåˆå§‹åŒ–æ–¹å¼"><a href="#æ–°Macåˆå§‹åŒ–æ–¹å¼" class="headerlink" title="æ–°Macåˆå§‹åŒ–æ–¹å¼"></a>æ–°Macåˆå§‹åŒ–æ–¹å¼</h1><p>æ–°çš„Macåˆå§‹åŒ–, æŒ‰ç…§ä¸Šè¾¹è¿™äº›æ­¥éª¤ä¸€ä¸ªä¸€ä¸ªæ¥, ç¡®å®éœ€è¦èŠ±è´¹ä¸å°‘æ—¶é—´.<br>å°¤å…¶æ˜¯è‡ªå·±å–œæ¬¢æŠ˜è…¾ç”µè„‘, è¿™æ ·å¯¼è‡´çš„é—®é¢˜å°±æ›´ä¸¥é‡äº†.<br>å› æ­¤è°ƒç ”äº†ä¸‹åˆå§‹åŒ–çš„æ–¹å¼: </p>
<h2 id="TimeMachine-æ–¹å¼"><a href="#TimeMachine-æ–¹å¼" class="headerlink" title="TimeMachine æ–¹å¼"></a>TimeMachine æ–¹å¼</h2><ol>
<li>ä¼˜ç‚¹: éå¸¸æ–¹ä¾¿é è°±, åŸºæœ¬å¯ä»¥ 1:1 æ— æŸåœ°è¿›è¡Œè¿ç§»</li>
<li>ç¼ºç‚¹: <ol>
<li>éœ€è¦å•ç‹¬æå—ç¡¬ç›˜ç”¨æ¥ä½œä¸ºTimeMachineçš„å¤‡ä»½ç›˜. ä½†ç°åœ¨ç¡¬ç›˜ä»·æ ¼ä¹Ÿä¾¿å®œ, å› æ­¤é—®é¢˜å€’ä¹Ÿä¸å¤§.</li>
<li>åªæ”¯æŒä½ç‰ˆæœ¬çš„TimeMachineè¿ç§»åˆ°åŒç‰ˆæœ¬æˆ–è€…é«˜ç‰ˆæœ¬çš„MacOSä¸Š.</li>
</ol>
</li>
</ol>
<p>è¿™ä¸ªé—®é¢˜å°±æ¯”è¾ƒä¸¥é‡. ç°åœ¨è‡ªå·±çš„TimeMachineæ˜¯åŸºäºMontereyæ¥æ„å»º, ä½†æ–°æ·˜æ¥çš„15æ¬¾MacBook12å¯¸, åªèƒ½æ”¯æŒåˆ°BigSurçš„MacOS.<br>å› æ­¤åªèƒ½ä½¿ç”¨ <a href="https://dortania.github.io/OpenCore-Legacy-Patcher/">OpenCore Legacy Patcher</a> æ¥å¼ºåˆ¶å‡çº§ç³»ç»Ÿåˆ°Monterey; ä½†æ€§èƒ½æ˜¯å¦å—å½±å“å°±éš¾è¯´äº†.</p>
<h2 id="Dotfile-æ–¹å¼"><a href="#Dotfile-æ–¹å¼" class="headerlink" title="Dotfile æ–¹å¼"></a>Dotfile æ–¹å¼</h2><ol>
<li>ä¼˜ç‚¹:<ol>
<li>github æ‰˜ç®¡, æ— éœ€å•ç‹¬ç¡¬ç›˜.</li>
<li>ç‰ˆæœ¬å…¼å®¹æ€§è¾ƒå¥½.</li>
</ol>
</li>
<li>ç¼ºç‚¹:<ol>
<li>éœ€è¦é•¿æœŸç»´æŠ¤, æ–°å¢åŠ å•¥é…ç½®æˆ–è€…è½¯ä»¶, éƒ½éœ€è¦è®°å¾—æ›´æ–°Dotfile. </li>
<li>ä¸åŒMacç‰ˆæœ¬çš„å…¼å®¹æ€§ä¹Ÿéœ€è¦è€ƒè™‘.</li>
</ol>
</li>
</ol>
<p>è‡ªå·±æš‚æ—¶é€‰ç”¨çš„æ˜¯TimeMachineæ–¹å¼, è¿˜ç®—é è°±. </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>mac</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºåˆ†è¾¨ç‡çš„å¸¸è¯†</title>
    <url>//2021-11-06-resolution/</url>
    <content><![CDATA[<h2 id="å¸¸è§åˆ†è¾¨ç‡"><a href="#å¸¸è§åˆ†è¾¨ç‡" class="headerlink" title="å¸¸è§åˆ†è¾¨ç‡"></a>å¸¸è§åˆ†è¾¨ç‡</h2><ul>
<li>480P: 720*480</li>
<li>720P: 1280x720</li>
<li>1080P: 1920x1080</li>
<li>2K: 2560x1440</li>
<li>4K:</li>
<li>15å¯¸MacBookPro 2015Mid Retinaå±: 2880 Ã— 1800</li>
</ul>
<h2 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h2><ul>
<li>å­—æ¯Pä»£è¡¨: Progressive Scan, å³é€è¡Œæ‰«æ</li>
<li>480Pä»£è¡¨:</li>
</ul>
<h2 id="å¸¸è§åˆ·æ–°ç‡"><a href="#å¸¸è§åˆ·æ–°ç‡" class="headerlink" title="å¸¸è§åˆ·æ–°ç‡"></a>å¸¸è§åˆ·æ–°ç‡</h2><ul>
<li>30Hz</li>
<li>60Hz</li>
<li></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>common-sense</tag>
        <tag>resolution</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡mysql unique indexæœªç”Ÿæ•ˆåŸå› æ’æŸ¥</title>
    <url>//2021-11-08-mysql-unique-index-not-working/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯æè¿°"><a href="#èƒŒæ™¯æè¿°" class="headerlink" title="èƒŒæ™¯æè¿°"></a>èƒŒæ™¯æè¿°</h1><p>å¦‚ä¸‹SQL: serial_numberé»˜è®¤å¯ç©º, ä¸”ä¸ºunique keyçš„ä¸€éƒ¨åˆ†:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>inventory<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>stockid<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>productid<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>factor1<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>factor2<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>factor3<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>factor4<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>factor5<span class="token punctuation">`</span></span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>factor6<span class="token punctuation">`</span></span> <span class="token keyword">enum</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'NEW'</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>quantity<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>stamp<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>serial_number<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>stockid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>serial_number<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>serial_number<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>productid_2<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>productid<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>factor1<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>factor2<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>factor3<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>factor4<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>factor5<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>factor6<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>serial_number<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>productid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>productid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>factor1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>factor1<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>factor2<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>factor2<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>factor3<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>factor3<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> inventory <span class="token punctuation">(</span> productid<span class="token punctuation">,</span> factor1<span class="token punctuation">,</span> factor2<span class="token punctuation">,</span> factor3<span class="token punctuation">,</span> factor4<span class="token punctuation">,</span> factor5<span class="token punctuation">,</span> factor6<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">242332</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'V67'</span><span class="token punctuation">,</span><span class="token number">3.30</span><span class="token punctuation">,</span><span class="token string">'NEW'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> inventory <span class="token punctuation">(</span> productid<span class="token punctuation">,</span> factor1<span class="token punctuation">,</span> factor2<span class="token punctuation">,</span> factor3<span class="token punctuation">,</span> factor4<span class="token punctuation">,</span> factor5<span class="token punctuation">,</span> factor6<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">242332</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'V67'</span><span class="token punctuation">,</span><span class="token number">3.30</span><span class="token punctuation">,</span><span class="token string">'NEW'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">ON</span> <span class="token keyword">DUPLICATE</span> <span class="token keyword">KEY</span> <span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">`</span>quantity<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token operator">+</span> quantity<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>é¢„æœŸç»“æœ: å½“æ‰§è¡Œç¬¬äºŒæ¡insertçš„æ—¶å€™, åº”è¯¥ä¼šè·Ÿç¬¬ä¸€æ¡duplicate, ä»è€Œæ‰§è¡Œæ›´æ–°æ“ä½œ.</li>
<li>å®é™…ç»“æœ: å½“æ‰§è¡Œç¬¬äºŒæ¡insertçš„æ—¶å€™, æ²¡æœ‰è·Ÿç¬¬ä¸€æ¡duplicate, ä¹Ÿæ‰§è¡Œäº†æ’å…¥æ“ä½œ. ä»è€Œå‡ºç°äº†ä¸¤æ¡ç›¸åŒçš„ç»“æœå¦‚ä¸‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071138358.png"></li>
</ul>
<h1 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h1><p>ä¸Šgoogleä¸ŠæŒ‰ç…§å…³é”®è¯æœäº†ä¸‹, å‘ç°å¾ˆå¤šäººå·²ç»è¸©è¿‡ç±»ä¼¼çš„å‘:<br><a href="https://stackoverflow.com/questions/22156301/mysql-unique-key-not-working">https://stackoverflow.com/questions/22156301/mysql-unique-key-not-working</a></p>
<blockquote>
<p>Mysql allows multiple NULLs in an unique constraint.</p>
<p>In your serial_number column replace NULL with a value and the constraint is triggered,see:<br><a href="http://sqlfiddle.com/#!2/9dbd19/1">http://sqlfiddle.com/#!2/9dbd19/1</a></p>
<p>a UNIQUE index permits multiple NULL values for columns that can contain NULL</p>
</blockquote>
<h1 id="ä¿®æ”¹æ–¹æ¡ˆ"><a href="#ä¿®æ”¹æ–¹æ¡ˆ" class="headerlink" title="ä¿®æ”¹æ–¹æ¡ˆ"></a>ä¿®æ”¹æ–¹æ¡ˆ</h1><p>ä¿®æ”¹ddlå¦‚ä¸‹:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token identifier"><span class="token punctuation">`</span>serial_number<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h1><ul>
<li>æ–¹æ¡ˆ1: ç»„æˆunique keyçš„å­—æ®µ, å°½é‡ä¸å…è®¸ä¸ºç©º,  æœ€å¥½è®¾ç½®ä¸º: NOT NULL DEFAULT â€˜â€™</li>
<li>æ–¹æ¡ˆ2: å¦‚æœæ— æ³•ä¿®æ”¹ddl, é‚£ä¹ˆæœ€å¥½åœ¨ä»£ç é‡Œåšå…¼å®¹, æŠŠnullå€¼åšä¸ªé»˜è®¤å€¼æ˜ å°„, å¡«å……è¿›å».</li>
</ul>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>åœ¨çº¿æ‰§è¡Œddl, dmlè¯Šæ–­çš„ç³»ç»Ÿ,  å¯ä»¥</p>
<ol>
<li>é€‰æ‹©ä¸åŒdbç±»å‹&amp;ç‰ˆæœ¬, æ–¹ä¾¿é‡ç°é—®é¢˜</li>
<li>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</li>
<li>åˆ†äº«è¯Šæ–­çš„æ°¸ä¹…é“¾æ¥, æ–¹ä¾¿ä»–äººæ’æŸ¥:<br><a href="http://sqlfiddle.com/">http://sqlfiddle.com/</a></li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>mysql</tag>
        <tag>index</tag>
        <tag>insert-on-duplicate</tag>
      </tags>
  </entry>
  <entry>
    <title>GFSè®ºæ–‡ç¬”è®°ä¸æ€è€ƒ</title>
    <url>//2021-11-13-GFS-thesis/</url>
    <content><![CDATA[<p>ç¬”è®°:</p>
<ul>
<li>é¢å‘çš„æ‰¹å¤„ç†, å› æ­¤æ›´åŠ å…³æ³¨èŠ‚ç‚¹é—´çš„å¸¦å®½ç¨³å®šæ€§, è€Œä¸æ˜¯ä½å»¶æ—¶.</li>
</ul>
<p>ä¸€äº›æ€è€ƒ:</p>
<ul>
<li><p>æ“ä½œç³»ç»Ÿçš„åŸºæœ¬å…ƒç´ :</p>
<ul>
<li>å¤„ç†æœºç®¡ç†: å¯¹ä¸­å¤®å¤„ç†æœºè¿›è¡Œä½¿ç”¨å’Œåˆ†é…çš„ç®¡ç†?? è¿™ä¸ªå…·ä½“æŒ‡çš„æ˜¯å•¥? ä¸ä½œä¸šç®¡ç†æœ‰å•¥åŒºåˆ«?</li>
<li>æ–‡ä»¶ç®¡ç†: å¯¹æ–‡ä»¶çš„å­˜æ”¾ã€æ£€ç´¢ã€æ›´æ–°ã€å…±äº«å’Œä¿æŠ¤è¿›è¡Œç®¡ç†ï¼Œä¸ºç”¨æˆ·æä¾›æ–¹ä¾¿æœ‰æ•ˆçš„æ–‡ä»¶ä½¿ç”¨æ–¹æ³•. æ–‡ä»¶ç³»ç»Ÿ</li>
<li>å†…å­˜ç®¡ç†: ç”¨æŸç§æ•°æ®ç»“æ„tè®°å½•ä¸»å­˜çš„ä½¿ç”¨æƒ…å†µï¼ŒæŒ‰ç…§ä¸€å®šçš„ç­–ç•¥å¯¹å­˜å‚¨å™¨è¿›è¡Œåˆ†é…å’Œä¿æŠ¤</li>
<li>è®¾å¤‡ç®¡ç†: ç®¡ç†å„ç±»å¤–å›´è®¾å¤‡ï¼ŒåŒ…æ‹¬ä¸­æ–­å¤„ç†ï¼Œè¾“å…¥è¾“å‡ºç¨‹åºè®¾è®¡ï¼Œè®¾å¤‡çš„é©±åŠ¨ï¼Œå¤–å›´è®¾å¤‡çš„åˆ†é…</li>
<li>ä»»åŠ¡è°ƒåº¦&#x2F;ä½œä¸šç®¡ç†: ä¸ºç”¨æˆ·æä¾›â€ä½œä¸šæ§åˆ¶è¯­è¨€â€â€å‘½ä»¤è¯­è¨€â€,æŒ‰ä¸€å®šç­–ç•¥å¯¹ä½œä¸šè¿›è¡Œè°ƒåº¦,æ§åˆ¶.</li>
</ul>
</li>
<li><p>åˆ†å¸ƒå¼çš„æ“ä½œç³»ç»Ÿéœ€è¦å“ªäº›å…ƒç´ ?</p>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿ: GFS&#x2F;HDFS</li>
<li>èµ„æº&amp;ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ: Yarn</li>
</ul>
</li>
<li><p>ä¸€äº›å­˜å‚¨è®¾å¤‡</p>
<ul>
<li>å—å­˜å‚¨<ul>
<li>awsçš„ebs</li>
</ul>
</li>
<li>æ–‡ä»¶å­˜å‚¨<ul>
<li>OSS</li>
<li>NAS??</li>
</ul>
</li>
</ul>
</li>
<li><p>æ–‡ä»¶ç³»ç»Ÿä¸å­˜å‚¨è®¾å¤‡æ˜¯å•¥å…³ç³»?</p>
</li>
<li><p>ä»€ä¹ˆæ˜¯POSIXæ¥å£? ä¸ºå•¥</p>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>books</tag>
        <tag>2021</tag>
        <tag>GFS</tag>
        <tag>Google</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡Java Lambdaè½¬Listä¸ºMapæ—¶ Duplicate keyå¼‚å¸¸</title>
    <url>//2021-11-15-java-lambda-list-to-map/</url>
    <content><![CDATA[<h1 id="é”™è¯¯å †æ ˆ"><a href="#é”™è¯¯å †æ ˆ" class="headerlink" title="é”™è¯¯å †æ ˆ"></a>é”™è¯¯å †æ ˆ</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalStateException</span><span class="token operator">:</span> <span class="token class-name">Duplicate</span> key <span class="token number">21</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>Collectors</span><span class="token punctuation">.</span>lambda$throwingMerger$<span class="token function">0</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">133</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1254</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>Collectors</span><span class="token punctuation">.</span>lambda$toMap$<span class="token function">58</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1320</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>ReduceOps</span>$<span class="token number">3</span>ReducingSink<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ReduceOps</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ArrayList</span>$<span class="token class-name">ArrayListSpliterator</span><span class="token punctuation">.</span><span class="token function">forEachRemaining</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1382</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>AbstractPipeline</span><span class="token punctuation">.</span><span class="token function">copyInto</span><span class="token punctuation">(</span><span class="token class-name">AbstractPipeline</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">481</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>AbstractPipeline</span><span class="token punctuation">.</span><span class="token function">wrapAndCopyInto</span><span class="token punctuation">(</span><span class="token class-name">AbstractPipeline</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">471</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>ReduceOps</span>$<span class="token class-name">ReduceOp</span><span class="token punctuation">.</span><span class="token function">evaluateSequential</span><span class="token punctuation">(</span><span class="token class-name">ReduceOps</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">708</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>AbstractPipeline</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">AbstractPipeline</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">234</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span>ReferencePipeline</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">ReferencePipeline</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">499</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>cjf<span class="token punctuation">.</span>java<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>jdk8<span class="token punctuation">.</span></span>StreamTest</span><span class="token punctuation">.</span><span class="token function">testStreamMap_duplicateKey</span><span class="token punctuation">(</span><span class="token class-name">StreamTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">90</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">NativeMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>FrameworkMethod</span>$<span class="token number">1.</span><span class="token function">runReflectiveCall</span><span class="token punctuation">(</span><span class="token class-name">FrameworkMethod</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>ReflectiveCallable</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ReflectiveCallable</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>FrameworkMethod</span><span class="token punctuation">.</span><span class="token function">invokeExplosively</span><span class="token punctuation">(</span><span class="token class-name">FrameworkMethod</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>statements<span class="token punctuation">.</span></span>InvokeMethod</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">InvokeMethod</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>ParentRunner</span><span class="token punctuation">.</span><span class="token function">runLeaf</span><span class="token punctuation">(</span><span class="token class-name">ParentRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">325</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>BlockJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token function">runChild</span><span class="token punctuation">(</span><span class="token class-name">BlockJUnit4ClassRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">78</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>BlockJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token function">runChild</span><span class="token punctuation">(</span><span class="token class-name">BlockJUnit4ClassRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">57</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>ParentRunner</span>$<span class="token number">3.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ParentRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">290</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>ParentRunner</span>$<span class="token number">1.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token class-name">ParentRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>ParentRunner</span><span class="token punctuation">.</span><span class="token function">runChildren</span><span class="token punctuation">(</span><span class="token class-name">ParentRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">288</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>ParentRunner</span><span class="token punctuation">.</span>access$<span class="token function">000</span><span class="token punctuation">(</span><span class="token class-name">ParentRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">58</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>ParentRunner</span>$<span class="token number">2.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">ParentRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">268</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span></span>ParentRunner</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ParentRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">363</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span>JUnitCore</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">JUnitCore</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">137</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span>JUnit4IdeaTestRunner</span><span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span><span class="token class-name">JUnit4IdeaTestRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">68</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span>IdeaTestRunner</span>$<span class="token class-name">Repeater</span><span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span><span class="token class-name">IdeaTestRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span>JUnitStarter</span><span class="token punctuation">.</span><span class="token function">prepareStreamsAndStart</span><span class="token punctuation">(</span><span class="token class-name">JUnitStarter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">230</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span>JUnitStarter</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">JUnitStarter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">58</span><span class="token punctuation">)</span>
<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">255</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="é”™è¯¯ä»£ç "><a href="#é”™è¯¯ä»£ç " class="headerlink" title="é”™è¯¯ä»£ç "></a>é”™è¯¯ä»£ç </h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Instance</span><span class="token punctuation">></span></span> instanceMap <span class="token operator">=</span> instances<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Instance</span><span class="token operator">::</span><span class="token function">getInstanceId</span><span class="token punctuation">,</span> e <span class="token operator">-></span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="FIX"><a href="#FIX" class="headerlink" title="FIX"></a>FIX</h1><p>éœ€è¦å¢åŠ mergeFunction()å¤„ç†æ–¹æ³•, å³ Collectors.toMap()ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°.</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Instance</span><span class="token punctuation">></span></span> instanceMap <span class="token operator">=</span> instances<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Instance</span><span class="token operator">::</span><span class="token function">getInstanceId</span><span class="token punctuation">,</span> e <span class="token operator">-></span> e<span class="token punctuation">,</span> <span class="token punctuation">(</span>k1<span class="token punctuation">,</span> k2<span class="token punctuation">)</span> <span class="token operator">-></span> k2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><p><a href="https://blog.csdn.net/blueheart20/article/details/106326548/">https://blog.csdn.net/blueheart20/article/details/106326548/</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>lambda</tag>
      </tags>
  </entry>
  <entry>
    <title>é¸Ÿå“¥çš„Linuxç§æˆ¿èœç¬”è®°</title>
    <url>//2021-11-18-Linux-Basic/</url>
    <content><![CDATA[<h1 id="è®¾å¤‡ä¸åœ¨Linuxä¸­æ–‡ä»¶å"><a href="#è®¾å¤‡ä¸åœ¨Linuxä¸­æ–‡ä»¶å" class="headerlink" title="è®¾å¤‡ä¸åœ¨Linuxä¸­æ–‡ä»¶å"></a>è®¾å¤‡ä¸åœ¨Linuxä¸­æ–‡ä»¶å</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>books</tag>
        <tag>2021</tag>
        <tag>GFS</tag>
        <tag>Google</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºGPUå°è£…ä¸æ•£çƒ­æ–¹å¼çš„ç¬”è®°</title>
    <url>//2021-11-18-gpu-heat-dissipation/</url>
    <content><![CDATA[<h1 id="GPUæ•£çƒ­æ–¹å¼"><a href="#GPUæ•£çƒ­æ–¹å¼" class="headerlink" title="GPUæ•£çƒ­æ–¹å¼"></a>GPUæ•£çƒ­æ–¹å¼</h1><h2 id="è¢«åŠ¨æ•£çƒ­"><a href="#è¢«åŠ¨æ•£çƒ­" class="headerlink" title="è¢«åŠ¨æ•£çƒ­"></a>è¢«åŠ¨æ•£çƒ­</h2><ul>
<li><p>1997å¹´, NVIDIA Riva 128æ˜¾å¡</p>
<ul>
<li>æ€§èƒ½è¾ƒä½, å‘çƒ­è¾ƒä½, è‡ªç„¶æ•£çƒ­</li>
</ul>
</li>
<li><p>1998å¹´, NVIDIA Riva TNTæ˜¾å¡</p>
<ul>
<li>æ€§èƒ½åŠŸè€—æå‡, é“åˆ¶æ•£çƒ­ç‰‡, çº¯è¢«åŠ¨æ•£çƒ­<br><img data-src="/_assets/2021-11-19-gpu-heat-dissipation/img_1.png" alt="img_1.png"></li>
<li>é“ç‰‡å·¥è‰º<ul>
<li>æŒ¤é“å·¥è‰º: ä¸€å¤§ç‰‡é“å—é«˜æ¸©æŒ¤å‹å¡‘å‹</li>
<li>é“¸é€ å·¥è‰º</li>
<li>é“²é½¿å·¥è‰º</li>
<li>åˆ‡å‰Šå·¥è‰º</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ä¸»åŠ¨æ•£çƒ­-é³ç‰‡-é£æ‰‡"><a href="#ä¸»åŠ¨æ•£çƒ­-é³ç‰‡-é£æ‰‡" class="headerlink" title="ä¸»åŠ¨æ•£çƒ­: é³ç‰‡+é£æ‰‡"></a>ä¸»åŠ¨æ•£çƒ­: é³ç‰‡+é£æ‰‡</h2><ul>
<li>1999å¹´, NVIDIA GeForce 256<ul>
<li>æ­£å¼æå‡ºäº†GPUæ¦‚å¿µ</li>
<li>é³ç‰‡ + 4å˜ç±³é£æ‰‡, ä¸»åŠ¨æ•£çƒ­</li>
</ul>
</li>
</ul>
<h2 id="ä¸»åŠ¨æ•£çƒ­-çƒ­ç®¡-é³ç‰‡-é£æ‰‡"><a href="#ä¸»åŠ¨æ•£çƒ­-çƒ­ç®¡-é³ç‰‡-é£æ‰‡" class="headerlink" title="ä¸»åŠ¨æ•£çƒ­: çƒ­ç®¡+é³ç‰‡+é£æ‰‡"></a>ä¸»åŠ¨æ•£çƒ­: çƒ­ç®¡+é³ç‰‡+é£æ‰‡</h2><p><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_3.png" alt="img_3.png"></p>
<h3 id="çƒ­ç®¡-HEAT-PIPE"><a href="#çƒ­ç®¡-HEAT-PIPE" class="headerlink" title="çƒ­ç®¡(HEAT PIPE)"></a>çƒ­ç®¡(HEAT PIPE)</h3><h4 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h4><ul>
<li>ä¸­ç©ºçš„é“œç®¡</li>
<li>å†…éƒ¨å¡«å……ç›¸å˜å†·å´æ¶²</li>
<li>ç®¡å­å†…éƒ¨æ˜¯çƒ§ç»“å£, ä¾¿äºæ¶²ä½“è’¸å‘, åˆ°å†·åŒºå†·å‡é€šè¿‡æ¯›ç»†ç°è±¡è¿”å›çƒ­åŒº</li>
<li>ä¸»æµçš„çƒ­ç®¡è§„æ ¼æ˜¯6mm æˆ– 8mm<ul>
<li>çƒ­æ‰¿è½½èƒ½åŠ›ç›¸å·®å°†è¿‘ä¸€å€<br><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_4.png" alt="img_4.png"></li>
</ul>
</li>
</ul>
<h4 id="çƒ­ç®¡æ•°é‡"><a href="#çƒ­ç®¡æ•°é‡" class="headerlink" title="çƒ­ç®¡æ•°é‡"></a>çƒ­ç®¡æ•°é‡</h4><ul>
<li>é€šå¸¸è¶Šå¤šè¶Šå¥½, ä½†æ˜¯æœ‰è¾¹é™…æ•ˆåº”</li>
</ul>
<h3 id="é³ç‰‡"><a href="#é³ç‰‡" class="headerlink" title="é³ç‰‡"></a>é³ç‰‡</h3><ul>
<li>çƒ­ç®¡ä¸é³ç‰‡æ¥è§¦æ–¹å¼: <ul>
<li>æ–¹å¼1: ç©¿Finå·¥è‰º<ul>
<li>çƒ­ç®¡ç›´æ¥æ’å…¥é³ç‰‡å†…</li>
<li>ä½†é•¿æ—¶é—´ä½¿ç”¨, ç”±äºé³ç‰‡ä¸çƒ­ç®¡çƒ­èƒ€å†·ç¼©ç¨‹åº¦ä¸åŒå¯¼è‡´ä¸­é—´æœ‰ç¼éš™, ä»è€Œå½±å“æ•£çƒ­æ•ˆæœ</li>
<li>å·¥è‰ºç®€å•, æˆæœ¬è¾ƒä½, è‰¯å“ç‡é«˜</li>
</ul>
</li>
<li>æ–¹å¼2: å›æµç„Šå·¥è‰º<ul>
<li>ç›´æ¥ç”¨é‡‘å±ç„Šæ–™æŠŠçƒ­ç®¡ä¸é³ç‰‡ç„Šæ¥èµ·æ¥<br><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_5.png" alt="img_5.png"></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="çƒ­ç®¡-amp-GPUæ ¸å¿ƒæ¥è§¦æ–¹æ¡ˆ"><a href="#çƒ­ç®¡-amp-GPUæ ¸å¿ƒæ¥è§¦æ–¹æ¡ˆ" class="headerlink" title="çƒ­ç®¡&amp;GPUæ ¸å¿ƒæ¥è§¦æ–¹æ¡ˆ"></a>çƒ­ç®¡&amp;GPUæ ¸å¿ƒæ¥è§¦æ–¹æ¡ˆ</h3><ul>
<li>çƒ­ç®¡ç›´è§¦æ–¹æ¡ˆ: <ul>
<li>é—®é¢˜1: é•¿æ—¶é—´çƒ­èƒ€å†·ç¼©ä¼šå¯¼è‡´ç©ºè…”, ä»è€Œå½±å“æ•£çƒ­</li>
<li>é—®é¢˜2: çƒ­ç®¡å£æ‰“ç£¨, å¯¼è‡´ä½¿ç”¨å¯¿å‘½å˜çŸ­<br><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_6.png" alt="img_6.png"></li>
</ul>
</li>
<li>é“œåº•æ–¹æ¡ˆ:<ul>
<li>ä¾¿äºå°†çƒ­é‡å‡æ‘Šåˆ°å„ä¸ªçƒ­ç®¡ä¸Š<br><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_7.png" alt="img_7.png"></li>
</ul>
</li>
<li>å‡çƒ­æ¿æ–¹æ¡ˆ: <ul>
<li>æ¿çŠ¶çš„çƒ­ç®¡, å†…éƒ¨ä¹Ÿæ˜¯æ¶²ä½“è’¸å‘, æ°”ä½“å†·å‡ä¼ é€’çƒ­é‡</li>
</ul>
</li>
</ul>
<h3 id="é£æ‰‡"><a href="#é£æ‰‡" class="headerlink" title="é£æ‰‡"></a>é£æ‰‡</h3><h4 id="ä¸‹å‹å¼æ˜¾å¡"><a href="#ä¸‹å‹å¼æ˜¾å¡" class="headerlink" title="ä¸‹å‹å¼æ˜¾å¡"></a>ä¸‹å‹å¼æ˜¾å¡</h4><ul>
<li>å·¥ä½œæ–¹å¼<ul>
<li>é£æ‰‡é¢å¸é£</li>
<li>å››å‘¨å‡ºé£</li>
</ul>
</li>
<li>ä¼˜ç‚¹:<ul>
<li>å®‰é™</li>
</ul>
</li>
<li>ç¼ºç‚¹:<ul>
<li>ä¾èµ–æœºç®±é€šé£<br><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_8.png" alt="img_8.png"></li>
</ul>
</li>
</ul>
<h4 id="æ¶¡è½®å¼æ˜¾å¡"><a href="#æ¶¡è½®å¼æ˜¾å¡" class="headerlink" title="æ¶¡è½®å¼æ˜¾å¡"></a>æ¶¡è½®å¼æ˜¾å¡</h4><ul>
<li>ç¼ºç‚¹:<ul>
<li>è½¬é€Ÿåé«˜, å™ªéŸ³åå¤§</li>
</ul>
</li>
</ul>
<h2 id="æ°´å†·"><a href="#æ°´å†·" class="headerlink" title="æ°´å†·"></a>æ°´å†·</h2><ul>
<li><p>ç”±äºGPUé€šå¸¸éƒ½æ¯”CPUé¢ç§¯è¦å¤§, å› æ­¤æ°´å†·å¯¹äºGPUç›¸æ¯”å¯¹äºCPUæ¥è¯´, æå‡æ•ˆæœæ›´åŠ æ˜æ˜¾.<br><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_9.png" alt="img_9.png"></p>
</li>
<li><p>è‹±ä¼Ÿè¾¾æ˜¾å¡éƒ½è‡ªå¸¦äº†GPU Boost, è‡ªåŠ¨è¶…é¢‘æœºåˆ¶</p>
<ul>
<li>å‡ºå‚1700MHzçš„æ˜¾å¡, å¾€å¾€è·‘åœ¨æ¥è¿‘2000MHzé¢‘ç‡ä¸Š</li>
<li>åŠŸè€—, ç”µå‹, æ¸©åº¦</li>
<li>æ›´å¥½çš„æ•£çƒ­, èƒ½è®©GPU Boostç»´æŒå¾—æ›´åŠ ç¨³å®š<br><img data-src="/../_assets/2021-11-19-gpu-heat-dissipation/img_10.png" alt="img_10.png"></li>
</ul>
</li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.zhihu.com/zvideo/1433777767221071872">å…¨ç½‘æœ€è¯¦ç»†æ˜¾å¡æ•£çƒ­å·¥ä½œåŸç†ç§‘æ™®</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>common-sense</tag>
        <tag>throughput</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºå¸¸ç”¨æ¥å£æ ‡å‡†ä¸é€Ÿåº¦çš„å¸¸è¯†</title>
    <url>//2021-11-18-throughput/</url>
    <content><![CDATA[<h1 id="å¸¸è§æ¥å£åè®®é€Ÿåº¦"><a href="#å¸¸è§æ¥å£åè®®é€Ÿåº¦" class="headerlink" title="å¸¸è§æ¥å£åè®®é€Ÿåº¦"></a>å¸¸è§æ¥å£åè®®é€Ÿåº¦</h1><hr>
<h2 id="å†…å­˜æ¥å£"><a href="#å†…å­˜æ¥å£" class="headerlink" title="å†…å­˜æ¥å£"></a>å†…å­˜æ¥å£</h2><h3 id="DDR-x2F-DIMM"><a href="#DDR-x2F-DIMM" class="headerlink" title="DDR&#x2F;DIMM"></a>DDR&#x2F;DIMM</h3><ul>
<li>å†…å­˜çš„æ ‡å‡†æ¥å£.</li>
<li>DDRä¸DIMMåŒºåˆ«:<ul>
<li>DIMMæ˜¯æŒ‡é’ˆè„šæ’æ§½, ä¹Ÿå°±æ˜¯ç‰©ç†ç»“æ„æ–¹é¢çš„åˆ†ç±»</li>
<li>è€ŒSDRAMå’ŒDDRéƒ½æ˜¯å†…éƒ¨æŠ€æœ¯æ–¹é¢çš„åˆ†ç±»</li>
</ul>
</li>
</ul>
<h4 id="Spec"><a href="#Spec" class="headerlink" title="Spec"></a>Spec</h4><table>
<thead>
<tr>
<th>SDRAM&#x2F;DDR</th>
<th>å‹è™Ÿ</th>
<th>è³‡æ–™å¯¬åº¦(bit)</th>
<th>å…§éƒ¨æ™‚è„ˆ(MHz)</th>
<th>é »ç‡é€Ÿåº¦</th>
<th>é »å¯¬(é »ç‡xå¯¬åº¦)</th>
</tr>
</thead>
<tbody><tr>
<td>DDR</td>
<td>DDR-266</td>
<td>64</td>
<td>133</td>
<td>266</td>
<td>2.1GBytes&#x2F;sec</td>
</tr>
<tr>
<td>DDR</td>
<td>DDR-400</td>
<td>64</td>
<td>200</td>
<td>400</td>
<td>3.2GBytes&#x2F;sec</td>
</tr>
<tr>
<td>DDR</td>
<td>DDR2-800</td>
<td>64</td>
<td>200</td>
<td>800</td>
<td>6.4GBytes&#x2F;sec</td>
</tr>
<tr>
<td>DDR</td>
<td>DDR3-1600</td>
<td>64</td>
<td>200</td>
<td>1600</td>
<td>12.8GBytes&#x2F;sec</td>
</tr>
<tr>
<td>DDR</td>
<td>DDR4-2133</td>
<td>64</td>
<td>200</td>
<td>2133</td>
<td>17.0GBytes&#x2F;sec</td>
</tr>
<tr>
<td>DDR</td>
<td>DDR4-2400</td>
<td>64</td>
<td>200</td>
<td>2400</td>
<td>19.2GBytes&#x2F;sec</td>
</tr>
<tr>
<td>DDR</td>
<td>DDR4-2666</td>
<td>64</td>
<td>200</td>
<td>2666</td>
<td>21.3GBytes&#x2F;sec</td>
</tr>
<tr>
<td>DDR</td>
<td>DDR4-3200</td>
<td>64</td>
<td>200</td>
<td>3200</td>
<td>25.6GBytes&#x2F;sec</td>
</tr>
</tbody></table>
<p>update 2022-10-9 23:03:35: å½“å‰DDR5å·²ç»å¼€å§‹é€æ­¥é“ºè´§äº†, å¯ä»¥çŸ¥é“æœªæ¥ä¸¤ä¸‰å¹´DDR5ä¼šæˆä¸ºä¸»æµ.</p>
<h4 id="DIMMæ¥å£å›¾ç‰‡"><a href="#DIMMæ¥å£å›¾ç‰‡" class="headerlink" title="DIMMæ¥å£å›¾ç‰‡"></a>DIMMæ¥å£å›¾ç‰‡</h4><p><img data-src="/../_assets/2021-11-19-throughput/2021-11-19-throughput-dimm.png" alt="2021-11-19-throughput-dimm.png.png"></p>
<h4 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h4><ul>
<li>by 2021å¹´, DDR4æ˜¯ä¸»æµ, 2021å¹´9æœˆ, SK Hynixå‡ºäº§ç¬¬ä¸€æ‰¹DDR5å†…å­˜</li>
<li>DDR2-800çš„é€Ÿåº¦åŸºæœ¬ä¸Šè·ŸHDMI 2.1é€Ÿåº¦å·®ä¸å¤šäº†. æœç„¶æ•´ä½“è¿˜æ˜¯DDRé€Ÿåº¦æœ€å¿«</li>
</ul>
<h2 id="æ€»çº¿æ¥å£DMI"><a href="#æ€»çº¿æ¥å£DMI" class="headerlink" title="æ€»çº¿æ¥å£DMI"></a>æ€»çº¿æ¥å£DMI</h2><h2 id="ç½‘ç»œæ¥å£"><a href="#ç½‘ç»œæ¥å£" class="headerlink" title="ç½‘ç»œæ¥å£"></a>ç½‘ç»œæ¥å£</h2><h3 id="RJ45"><a href="#RJ45" class="headerlink" title="RJ45"></a>RJ45</h3><h3 id="å…‰çº¤"><a href="#å…‰çº¤" class="headerlink" title="å…‰çº¤"></a>å…‰çº¤</h3><ul>
<li>ç™¾å…†(100Mbps, å³10MB&#x2F;s), æ˜¯å½“å‰(2022å¹´)å®¶ç”¨çš„ä¸»æµ, æ˜¯ SATA 1.0 æ ‡ç§°é€Ÿåº¦çš„1&#x2F;10;</li>
<li>åƒå…†(1Gbps, å³100MB&#x2F;s), æ˜¯å½“å‰(2022å¹´)æœåŠ¡å™¨è™šæ‹Ÿæœºçš„ä¸»æµ, å¤§çº¦ç­‰äº SATA 1.0 çš„æ ‡ç§°é€Ÿåº¦(æ‰€ä»¥åœ¨äº‘ä¸Šè·‘æ»¡å¸¦å®½æ—¶, ç£ç›˜å¤§æ¦‚ç‡ä¸ä¼šæˆä¸ºç“¶é¢ˆ);</li>
<li>ä¸‡å…†(10Gbps, å³1GB&#x2F;s), æ˜¯å½“å‰(2022å¹´)ç‰©ç†æœåŠ¡å™¨çš„ä¸»æµ, å·²ç»å¤§äºçš„ SATA 3.0 çš„æ ‡ç§°é€Ÿåº¦. æ­¤æ—¶ç£ç›˜å¯èƒ½æˆä¸ºç“¶é¢ˆ;</li>
<li>25G(25Gbps, å³2.5GB&#x2F;s), å½“å‰(2022å¹´)ç‰©ç†æœåŠ¡å™¨é€æ­¥åœ¨æ™®åŠ, åŸºæœ¬ç­‰äº DDR1 çš„æ ‡ç§°é€Ÿåº¦, æ˜¯å½“å‰(by 2022å¹´)ä¸»æµçš„DDR4æ ‡ç§°é€Ÿåº¦çš„1&#x2F;10;</li>
<li>50G(50Gbps, å³5GB&#x2F;s), å½“å‰(2022å¹´)ç‰©ç†æœåŠ¡å™¨çš„å‰æ²¿(å°šæœªä¸Šé‡), åŸºæœ¬ç­‰äº DDR2 çš„æ ‡ç§°é€Ÿåº¦</li>
</ul>
<h2 id="ç¡¬ç›˜æ¥å£"><a href="#ç¡¬ç›˜æ¥å£" class="headerlink" title="ç¡¬ç›˜æ¥å£"></a>ç¡¬ç›˜æ¥å£</h2><h3 id="SATA"><a href="#SATA" class="headerlink" title="SATA"></a>SATA</h3><p>ä¸€èˆ¬è€çš„HDDç¡¬ç›˜(2021å¹´), éƒ½ç”¨SATAæ¥å£: </p>
<h4 id="Spec-1"><a href="#Spec-1" class="headerlink" title="Spec"></a>Spec</h4><table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>é »å¯¬ (Gbit&#x2F;s)</th>
<th>é€Ÿåº¦ (MByte&#x2F;s)</th>
</tr>
</thead>
<tbody><tr>
<td>SATA 1.0</td>
<td>1.5</td>
<td>150</td>
</tr>
<tr>
<td>SATA 2.0</td>
<td>3</td>
<td>300</td>
</tr>
<tr>
<td>SATA 3.0</td>
<td>6</td>
<td>600</td>
</tr>
</tbody></table>
<h4 id="æ ·ä¾‹"><a href="#æ ·ä¾‹" class="headerlink" title="æ ·ä¾‹"></a>æ ·ä¾‹</h4><p>è‡ªå·±ç»„è£…ç”µè„‘æ—¶å•ç‹¬å®‰è£…äº†ä¸ªSATAç¡¬ç›˜. </p>
<ul>
<li>åˆ†ä¸ºæ•°æ®çº¿&amp;ä¾›ç”µçº¿. æ•°æ®çº¿7é’ˆ</li>
<li>éœ€è¦å•ç‹¬ä¾›ç”µ</li>
<li>ä¸ä¹‹å¯¹æ¯”çš„æ˜¯PCIE M.2æ¥å£, å¯ä»¥ç”¨æ¥å¯¹æ¥SSDç¡¬ç›˜, ç±»ä¼¼äºä¸€ä¸ªå£é¦™ç³–æ’åœ¨ä¸»æ¿ä¸Š, æ— éœ€å•ç‹¬ä¾›ç”µ, æ•´ä½“é›†æˆåº¦æ›´é«˜.</li>
<li>ä¸ªäººå®é™…ä½¿ç”¨ä¸‹æ¥, SATA 3.0 è¯»å–é€Ÿåº¦å¤§æ¦‚åªèƒ½åˆ°150MB&#x2F;så·¦å³(è¿œæ²¡æœ‰è¾¾åˆ°æ ‡ç§°é€Ÿåº¦); ä¸ä¹‹å¯¹æ¯”çš„æ˜¯M.2 SSD è¯»å–é€Ÿåº¦åˆ°600MB&#x2F;s(ä¹Ÿæ²¡æœ‰è¾¾åˆ°æ ‡ç§°é€Ÿåº¦)</li>
</ul>
<h4 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h4><p><img data-src="/../_assets/2021-11-19-throughput/2021-11-19-throughput-sata.png" alt="2021-11-19-throughput-sata.png"></p>
<h3 id="PCIE-x2F-M-2æ¥å£"><a href="#PCIE-x2F-M-2æ¥å£" class="headerlink" title="PCIE&#x2F;M.2æ¥å£"></a>PCIE&#x2F;M.2æ¥å£</h3><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>æ—¢æ˜¯é€šé“ï¼Œä¹Ÿæ˜¯æ¥å£</li>
</ul>
<p>ä¸€èˆ¬æ–°çš„SSDç¡¬ç›˜(2021å¹´), æ˜¾å¡ç­‰, éƒ½ç”¨PCIEæ¥å£:</p>
<ul>
<li>PCI-Eä½“ç§¯å¤ªå¤§</li>
<li>M.2æ¥å£å¯ä»¥ç†è§£ä¸ºå°±æ˜¯PCI-Eæ¥å£ï¼Œåªæ˜¯æ¢äº†ä¸ªå½¢çŠ¶è€Œå·²(ä½†èµ°çš„é€šé“æ˜¯PCIEé€šé“)</li>
<li>PCI-Eæ¥å£ç›®å‰æœ€å¤§çš„ä½œç”¨å°±æ˜¯æ’æ˜¾å¡ï¼Œé™¤äº†æ˜¾å¡è¿˜æœ‰æ— çº¿ç½‘å¡ï¼Œä¸‡å…†æœ‰çº¿ç½‘å¡è¿™äº›é«˜å¸¦å®½è®¾å¤‡</li>
<li>PCI-Eæ¥å£ä¹Ÿå¯ä»¥è½¬æ¥æˆå¾ˆå¤šæ¥å£ï¼Œæ¯”å¦‚USB3.0ï¼ŒType-cï¼Œé›·ç”µ3ï¼Œåˆæˆ–è€…U.2ï¼ŒM.2</li>
<li>å½“å‰(2021å¹´12æœˆ)ä¸»æµçš„æ˜¯PCIE3</li>
</ul>
<h4 id="Spec-2"><a href="#Spec-2" class="headerlink" title="Spec"></a>Spec</h4><table>
<thead>
<tr>
<th>è¦æ ¼</th>
<th>1xé »å¯¬</th>
<th>16xé »å¯¬</th>
</tr>
</thead>
<tbody><tr>
<td>PCIe</td>
<td>1.0</td>
<td>250MByte&#x2F;s</td>
</tr>
<tr>
<td>PCIe</td>
<td>2.0</td>
<td>500MByte&#x2F;s</td>
</tr>
<tr>
<td>PCIe</td>
<td>3.0</td>
<td>~1GByte&#x2F;s</td>
</tr>
<tr>
<td>PCIe</td>
<td>4.0</td>
<td>~2GByte&#x2F;s</td>
</tr>
</tbody></table>
<h4 id="å›¾ç‰‡-1"><a href="#å›¾ç‰‡-1" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h4><p><img data-src="/../_assets/2021-11-19-throughput/2021-11-19-throughput-pcie.png" alt="2021-11-19-throughput-pcie.png"></p>
<h2 id="å¤–è®¾"><a href="#å¤–è®¾" class="headerlink" title="å¤–è®¾"></a>å¤–è®¾</h2><h3 id="USB"><a href="#USB" class="headerlink" title="USB"></a>USB</h3><p>Uç›˜ç­‰</p>
<h4 id="Spec-3"><a href="#Spec-3" class="headerlink" title="Spec"></a>Spec</h4><table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>é »å¯¬ (Gbit&#x2F;s)</th>
<th>é€Ÿåº¦ (MByte&#x2F;s)</th>
</tr>
</thead>
<tbody><tr>
<td>USB 1.0</td>
<td>12</td>
<td>1.5</td>
</tr>
<tr>
<td>USB 2.0</td>
<td>480</td>
<td>60</td>
</tr>
<tr>
<td>USB 3.0</td>
<td>5G</td>
<td>500</td>
</tr>
<tr>
<td>USB 3.1</td>
<td>10G</td>
<td>1000</td>
</tr>
</tbody></table>
<h4 id="å›¾ç‰‡-2"><a href="#å›¾ç‰‡-2" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h4><h3 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h3><h2 id="è§†é¢‘æ¥å£"><a href="#è§†é¢‘æ¥å£" class="headerlink" title="è§†é¢‘æ¥å£"></a>è§†é¢‘æ¥å£</h2><h3 id="VGA"><a href="#VGA" class="headerlink" title="VGA"></a>VGA</h3><p>æ¨¡æ‹Ÿä¿¡å·</p>
<h3 id="DP-DisplayPort"><a href="#DP-DisplayPort" class="headerlink" title="DP(DisplayPort)"></a>DP(DisplayPort)</h3><h3 id="é›·ç”µ-ThunderBolt"><a href="#é›·ç”µ-ThunderBolt" class="headerlink" title="é›·ç”µ(ThunderBolt)"></a>é›·ç”µ(ThunderBolt)</h3><h4 id="Spec-4"><a href="#Spec-4" class="headerlink" title="Spec"></a>Spec</h4><table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>é »å¯¬ (Gbit&#x2F;s)</th>
<th>é€Ÿåº¦ (MByte&#x2F;s)</th>
</tr>
</thead>
<tbody><tr>
<td>Thunderbolt 1</td>
<td>10000bps</td>
<td>1.25GB</td>
</tr>
<tr>
<td>Thunderbolt 2</td>
<td>20000bps</td>
<td>2.5GB</td>
</tr>
</tbody></table>
<h4 id="å›¾ç‰‡-3"><a href="#å›¾ç‰‡-3" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h4><p><img data-src="/../_assets/2021-11-19-throughput/2021-11-19-throughput-thunderbolt.png" alt="2021-11-19-throughput-thunderbolt.png"></p>
<h3 id="HDMI"><a href="#HDMI" class="headerlink" title="HDMI"></a>HDMI</h3><h4 id="Spec-5"><a href="#Spec-5" class="headerlink" title="Spec"></a>Spec</h4><ul>
<li>2.1 æ ‡å‡†: 48Gbps â€“&gt; 6GB</li>
<li>2.0 æ ‡å‡†: 18Gbps â€“&gt; 2.25GB<br><img data-src="/../_assets/2021-11-19-throughput/2021-11-19-throughput-hdmi.png" alt="2021-11-19-throughput-hdmi.png"></li>
</ul>
<h4 id="å›¾ç‰‡-4"><a href="#å›¾ç‰‡-4" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h4><h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><h2 id="HDMIä¼ è¾“åˆ†æ"><a href="#HDMIä¼ è¾“åˆ†æ" class="headerlink" title="HDMIä¼ è¾“åˆ†æ"></a>HDMIä¼ è¾“åˆ†æ</h2><hr>
<ul>
<li>å•ä¸ªåƒç´ ç‚¹å ç”¨ç©ºé—´<ul>
<li>é»‘ç™½äºŒå€¼å›¾åƒ, ä¸€ä¸ªåƒç´ åªéœ€è¦1bit</li>
<li>256ç§çŠ¶æ€çš„ç°åº¦å›¾åƒ, éœ€è¦8bit, æˆä¸ºâ€çœŸå½©è‰²â€, ç§°ä¸ºè‰²æ·±(Color Depth), è‰²æ·±çš„ä½æ•°è¶Šé«˜ï¼Œè¶Šèƒ½ç»†è…»è¯ é‡Šè‰²å½©çš„è‰²é˜¶å˜åŒ–ã€‚ </li>
<li>ç”±äºå±å¹•å•ä¸ªè‰²å—æ˜¯ç”±RGBç»„æˆ, å› æ­¤ 8*3&#x3D;24bit</li>
<li>å› æ­¤è‰²å½©æ•°é‡: 2^24&#x3D;1670ä¸‡è‰²<br><img data-src="/../_assets/2021-11-19-throughput/2021-11-19-throughput-pixel.png" alt="img.png"></li>
</ul>
</li>
</ul>
<p>é€‰è´­æ˜¾ç¤ºè®¾å¤‡æ—¶ï¼Œä¼šç»å¸¸çœ‹è§6bitã€8bitã€10bitç­‰.<br>å½“å‰(2021å¹´)ä¸»æµçš„æ˜¯8bit</p>
<hr>
<p>ä»¥4Kæ¸…æ™°åº¦, FPS 120Hz, æ¸¸æˆä¸ºä¾‹, éœ€è¦ä¼ è¾“çš„å¸¦å®½æ˜¯æ€æ ·çš„?</p>
<ul>
<li>4096<em>2160</em>24*120 &#x3D; 25,480,396,800 bps &#x3D;23.73 Gbps å³HDMI 2.0ä¸å¤Ÿ</li>
</ul>
<h2 id="MacBook-Proåˆ†æ"><a href="#MacBook-Proåˆ†æ" class="headerlink" title="MacBook Proåˆ†æ"></a>MacBook Proåˆ†æ</h2><hr>
<p>è‡ªå·±ä½¿ç”¨çš„ç”µè„‘ </p>
<ul>
<li>MacBook Pro (Retina, 15-inch, Mid 2015), <ul>
<li>256GBçš„SSDç¡¬ç›˜, æ¥å£ä½¿ç”¨çš„SATA</li>
<li>å†…ç½®é”®ç›˜, è§¦æ‘¸æ¿, ä½¿ç”¨USB 3.0</li>
<li>2å—1600MHzçš„DDR3 å†…å­˜</li>
<li>2ä¸ªThunderBolt 2.0æ¥å£</li>
</ul>
</li>
<li>MacBook Pro (Retina, 16-inch, Mid 2020), ä½¿ç”¨çš„æ˜¯256GBçš„SSDç¡¬ç›˜, æ¥å£ä½¿ç”¨çš„Nvme</li>
</ul>
<h2 id="Z390æ€»çº¿æ ·ä¾‹åˆ†æ"><a href="#Z390æ€»çº¿æ ·ä¾‹åˆ†æ" class="headerlink" title="Z390æ€»çº¿æ ·ä¾‹åˆ†æ"></a>Z390æ€»çº¿æ ·ä¾‹åˆ†æ</h2><p><img data-src="/../_assets/2021-11-19-throughput/2021-11-19-throughput-intel-z390.png" alt="2021-11-19-throughput-intel-z390.png"></p>
<ul>
<li>CPUç›´è¿ä¸€æ¡PCIE 3.0*16, å¯ä»¥æ’å…¥æ˜¾å¡&#x2F;SSD</li>
<li>CPUç›´è¿2666MHzçš„4ä¸ªDDR4 DIMMæ’æ§½</li>
<li>CPUç›´è¿3ä¸ªç‹¬ç«‹çš„HDMI&#x2F;DPæ¥å£, å…·ä½“æ ‡å‡†? é€Ÿç‡?</li>
<li>CPUé€šè¿‡DMI 3.0è¿æ¥åˆ°å—æ¡¥èŠ¯ç‰‡ç»„(Intel Z390 Chipset), <ul>
<li>å—æ¡¥èŠ¯ç‰‡ç»„ä¹Ÿå« PCHèŠ¯ç‰‡</li>
<li>é€šè¿‡å—æ¡¥è¿æ¥ PCIE3.0*24</li>
<li>SATAæ¥å£</li>
<li>USBæ¥å£</li>
<li>Optane Memoryå­˜å‚¨</li>
<li>å£°å¡</li>
<li>æ— çº¿ç½‘å¡</li>
<li>PCIEå­˜å‚¨è®¾å¤‡</li>
<li>è“ç‰™</li>
<li>PCIEåƒå…†ç½‘å¡</li>
</ul>
</li>
<li>æ‰€ä»¥æœ‰æ—¶å€™æ˜¾å¡è™½ç„¶æ’å…¥äº†PCIEæ’æ§½, éœ€è¦åˆ†æ¸…æ¥š, æ˜¯ç›´è¿CPUçš„PCIEè¿˜æ˜¯èµ°å—æ¡¥ç»•é“çš„PCIE</li>
<li>é›·ç”µ3ï¼ŒM.2ï¼ŒU.2ç›®å‰éƒ½æ— æ³•çªç ´X4å¸¦å®½ï¼Œå°±æ˜¯è¢«è¿™ä¸ªDMIç‰™ç­¾æ€»çº¿é™åˆ¶äº†</li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.jianshu.com/p/1fc8c9926ac1">å„ç§é€šä¿¡æ¥å£é€Ÿç‡</a></li>
<li><a href="https://www.zhihu.com/collection/212284966">PCI-Eé€šé“æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿä»–æ˜¯å¹²å•¥çš„ï¼Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/38984035">CPUæ€»çº¿è¿›åŒ–</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>common-sense</tag>
        <tag>throughput</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„Gitå‘½ä»¤</title>
    <url>//2021-11-22-git/</url>
    <content><![CDATA[<h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><ul>
<li>HEAD: é»˜è®¤æ˜¯æœ¬åœ°å·²commitçš„æœ€æ–°commit_id</li>
<li>origion&#x2F;master: é»˜è®¤æ˜¯è¿œç¨‹å·²pushçš„æœ€æ–°commit_id</li>
</ul>
<h1 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h1><h2 id="æœ¬åœ°åˆ†æ”¯"><a href="#æœ¬åœ°åˆ†æ”¯" class="headerlink" title="æœ¬åœ°åˆ†æ”¯:"></a>æœ¬åœ°åˆ†æ”¯:</h2><h3 id="æ–°å»º"><a href="#æ–°å»º" class="headerlink" title="æ–°å»º:"></a>æ–°å»º:</h3><ul>
<li>è¿œç¨‹ä¸å­˜åœ¨: git branch ${branch_name}</li>
<li>è¿œç¨‹å­˜åœ¨: git checkout -b ${branch_name} origin&#x2F;${branch_name}</li>
</ul>
<h3 id="åˆ‡æ¢"><a href="#åˆ‡æ¢" class="headerlink" title="åˆ‡æ¢:"></a>åˆ‡æ¢:</h3><ul>
<li>git checkout ${branch_name}</li>
</ul>
<h3 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹:"></a>æŸ¥çœ‹:</h3><ul>
<li>åˆ—å‡ºæœ¬åœ°æ‰€æœ‰åˆ†æ”¯: git branch</li>
<li>åˆ—å‡ºå½“å‰åˆ†æ”¯: git branch ä¼šåœ¨å½“å‰åˆ†æ”¯å‰åŠ æ˜Ÿå·.</li>
</ul>
<h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹:"></a>ä¿®æ”¹:</h3><h3 id="åˆ é™¤-éœ€è¦åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯-ä¸èƒ½åœ¨å½“å‰åˆ†æ”¯ä¸‹åˆ é™¤å½“å‰åˆ†æ”¯"><a href="#åˆ é™¤-éœ€è¦åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯-ä¸èƒ½åœ¨å½“å‰åˆ†æ”¯ä¸‹åˆ é™¤å½“å‰åˆ†æ”¯" class="headerlink" title="åˆ é™¤:(éœ€è¦åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯, ä¸èƒ½åœ¨å½“å‰åˆ†æ”¯ä¸‹åˆ é™¤å½“å‰åˆ†æ”¯)"></a>åˆ é™¤:(éœ€è¦åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯, ä¸èƒ½åœ¨å½“å‰åˆ†æ”¯ä¸‹åˆ é™¤å½“å‰åˆ†æ”¯)</h3><ul>
<li>æœªè·Ÿè¸ªè¿œç¨‹åˆ†æ”¯: git branch -d ${branch_name}</li>
<li>å·²è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯:</li>
</ul>
<ol>
<li>git branch -d ${branch_name} &#x2F;&#x2F;åˆ é™¤æœ¬åœ°åˆ†æ”¯</li>
<li>git push origin â€“delete ${branch_name} &#x2F;&#x2F;åˆ é™¤è¿œç¨‹åˆ†æ”¯</li>
</ol>
<h2 id="è¿œç¨‹åˆ†æ”¯"><a href="#è¿œç¨‹åˆ†æ”¯" class="headerlink" title="è¿œç¨‹åˆ†æ”¯:"></a>è¿œç¨‹åˆ†æ”¯:</h2><h3 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€:"></a>æ¨é€:</h3><ul>
<li>è¿œç¨‹åˆ†æ”¯ä¸å­˜åœ¨(åˆ™æ–°å»º): git push origin ${branch_name}</li>
<li>è¿œç¨‹åˆ†æ”¯å­˜åœ¨: git push</li>
</ul>
<h3 id="æ–°å»º-1"><a href="#æ–°å»º-1" class="headerlink" title="æ–°å»º:"></a>æ–°å»º:</h3><h3 id="æŸ¥çœ‹-1"><a href="#æŸ¥çœ‹-1" class="headerlink" title="æŸ¥çœ‹:"></a>æŸ¥çœ‹:</h3><ul>
<li>è¿œç¨‹ä»“åº“å…·ä½“åœ°å€: git remote -v</li>
<li>è¿œç¨‹åˆ†æ”¯åˆ—è¡¨: git branch -a; git branch -r</li>
</ul>
<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><ul>
<li>ä»…åˆ é™¤è¿œç¨‹åˆ†æ”¯:</li>
</ul>
<ol>
<li>git branch -d -r origin&#x2F;${branch_name}</li>
<li>git push origin :${branch_name}</li>
</ol>
<ul>
<li>åˆ é™¤æœ¬åœ°+è¿œç¨‹:</li>
</ul>
<ol>
<li>git branch -d ${branch_name} &#x2F;&#x2F;åˆ é™¤æœ¬åœ°åˆ†æ”¯</li>
<li>git push origin â€“delete ${branch_name} &#x2F;&#x2F;åˆ é™¤è¿œç¨‹åˆ†æ”¯</li>
</ol>
<h2 id="æœ¬åœ°-amp-è¿œç¨‹å…³è”å…³ç³»"><a href="#æœ¬åœ°-amp-è¿œç¨‹å…³è”å…³ç³»" class="headerlink" title="æœ¬åœ°&amp;è¿œç¨‹å…³è”å…³ç³»:"></a>æœ¬åœ°&amp;è¿œç¨‹å…³è”å…³ç³»:</h2><h3 id="æŸ¥çœ‹-2"><a href="#æŸ¥çœ‹-2" class="headerlink" title="æŸ¥çœ‹:"></a>æŸ¥çœ‹:</h3><p>git branch -vv</p>
<h3 id="æ·»åŠ ç»‘å®š"><a href="#æ·»åŠ ç»‘å®š" class="headerlink" title="æ·»åŠ ç»‘å®š:"></a>æ·»åŠ ç»‘å®š:</h3><ul>
<li>è¿œç¨‹åˆ†æ”¯å·²å­˜åœ¨:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch --set-upstream <span class="token variable">$&#123;branch_name&#125;</span> origin/<span class="token variable">$&#123;branch_name&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>è¿œç¨‹åˆ†æ”¯æœªå­˜åœ¨:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> push -u origin <span class="token variable">$&#123;branch_name&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="åˆ é™¤-1"><a href="#åˆ é™¤-1" class="headerlink" title="åˆ é™¤:"></a>åˆ é™¤:</h3><ul>
<li>ä»…åˆ é™¤ç»‘å®šå…³ç³», æœ¬åœ°ä¸è¿œç¨‹åˆ†æ”¯éƒ½ä¸åˆ é™¤: git branch â€“unset-upstream</li>
<li>ä»…åˆ é™¤è¿œç¨‹åˆ†æ”¯: git branch -d -r origin&#x2F;${remote_branch}</li>
</ul>
<h1 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h1><h2 id="æŸ¥çœ‹-3"><a href="#æŸ¥çœ‹-3" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h2><ul>
<li>å½“å‰åˆ†æ”¯: git log</li>
<li>æŒ‡å®šåˆ†æ”¯: git log ${branch_name}</li>
</ul>
<h1 id="å˜æ›´"><a href="#å˜æ›´" class="headerlink" title="å˜æ›´"></a>å˜æ›´</h1><h2 id="æœªstageçš„å˜æ›´"><a href="#æœªstageçš„å˜æ›´" class="headerlink" title="æœªstageçš„å˜æ›´:"></a>æœªstageçš„å˜æ›´:</h2><ul>
<li>æ·»åŠ è‡³stage: git add</li>
<li>æ·»åŠ è‡³stash: git stash save â€œcommentsâ€</li>
<li>æŸ¥çœ‹diffå…·ä½“å†…å®¹: git diff</li>
<li>ä¸¢å¼ƒ(è¦†ç›–æœ¬åœ°å˜æ›´): git checkout .</li>
<li>åˆ é™¤æœ¬åœ°(æœªåŠ å…¥.gitigonreçš„æ–‡ä»¶): git clean -f</li>
<li>åˆ é™¤æœ¬åœ°ç›®å½•: git clean -fd</li>
<li>åˆ é™¤æœ¬åœ°(å·²ç»åŠ å…¥.gitigonreçš„æ–‡ä»¶): git clean -fX</li>
</ul>
<h2 id="å·²stage-æœªcommitçš„å˜æ›´"><a href="#å·²stage-æœªcommitçš„å˜æ›´" class="headerlink" title="å·²stage, æœªcommitçš„å˜æ›´:"></a>å·²stage, æœªcommitçš„å˜æ›´:</h2><ul>
<li>æ·»åŠ è‡³æœ¬åœ°repo: git commit -m â€œcommentsâ€</li>
<li>æŸ¥çœ‹diffå…·ä½“å†…å®¹: git diff HEAD</li>
<li>ä¸¢å¼ƒ<ul>
<li>å˜æ›´å†…å®¹é€€å›è‡³unstage: git reset HEAD .</li>
<li>å˜æ›´å†…å®¹é€€å›è‡³å½»åº•ä¸¢å¼ƒ: git reset â€“hard HEAD .</li>
</ul>
</li>
</ul>
<h2 id="å·²commit-æœªpushçš„å˜æ›´"><a href="#å·²commit-æœªpushçš„å˜æ›´" class="headerlink" title="å·²commit, æœªpushçš„å˜æ›´:"></a>å·²commit, æœªpushçš„å˜æ›´:</h2><ul>
<li>push: git push</li>
<li>æŸ¥çœ‹diffå…·ä½“å†…å®¹:<ul>
<li>git log &#x2F;&#x2F; æ‹¿åˆ°commit_id</li>
<li>git diff origin&#x2F;master commit_id</li>
</ul>
</li>
<li>ä¸¢å¼ƒ:<ul>
<li>å˜æ›´å†…å®¹é€€å›è‡³unstage: git reset commit_id</li>
<li>å˜æ›´å†…å®¹é€€å›è‡³å½»åº•ä¸¢å¼ƒ:  git reset â€“hard commit_id</li>
</ul>
</li>
</ul>
<h2 id="å·²pushçš„å˜æ›´"><a href="#å·²pushçš„å˜æ›´" class="headerlink" title="å·²pushçš„å˜æ›´:"></a>å·²pushçš„å˜æ›´:</h2><ul>
<li>æŸ¥çœ‹diffå…·ä½“å†…å®¹: git diff commit_a commit_b æˆ–è€… git show commit_no</li>
<li>ä¸¢å¼ƒ:</li>
</ul>
<h2 id="stashçš„è¯¦ç»†å˜æ›´ä¿¡æ¯"><a href="#stashçš„è¯¦ç»†å˜æ›´ä¿¡æ¯" class="headerlink" title="stashçš„è¯¦ç»†å˜æ›´ä¿¡æ¯"></a>stashçš„è¯¦ç»†å˜æ›´ä¿¡æ¯</h2><ul>
<li>æŸ¥çœ‹stashåˆ—è¡¨: git stash list</li>
<li>å°†stashçš„å†…å®¹è¿›è¡Œunstage: git pop stash_id</li>
<li>æŸ¥çœ‹stashå…·ä½“å†…å®¹(è€Œä¸popå‡ºæ¥):  git stash show -p stash_id</li>
</ul>
<h2 id="å°†stashå†…å®¹åˆ é™¤"><a href="#å°†stashå†…å®¹åˆ é™¤" class="headerlink" title="å°†stashå†…å®¹åˆ é™¤"></a>å°†stashå†…å®¹åˆ é™¤</h2><p>git stash drop stash_id</p>
<h1 id="é—®é¢˜æ’æŸ¥-amp-ä¿®å¤"><a href="#é—®é¢˜æ’æŸ¥-amp-ä¿®å¤" class="headerlink" title="é—®é¢˜æ’æŸ¥&amp;ä¿®å¤"></a>é—®é¢˜æ’æŸ¥&amp;ä¿®å¤</h1><h2 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">LibreSSL SSL_connect: SSL_ERROR_SYSCALL <span class="token keyword">in</span> connection to github.com:443<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config --global --unset http.proxy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h1 id="å¸¸ç”¨æŠ€å·§"><a href="#å¸¸ç”¨æŠ€å·§" class="headerlink" title="å¸¸ç”¨æŠ€å·§"></a>å¸¸ç”¨æŠ€å·§</h1><ul>
<li>å‹ç¼©commit</li>
<li>resolve conflicts</li>
<li>cherry-pick</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„Linuxå‘½ä»¤</title>
    <url>//2021-11-22-linux-scripts/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><h1 id="å¸¸ç”¨Linuxå‘½ä»¤"><a href="#å¸¸ç”¨Linuxå‘½ä»¤" class="headerlink" title="å¸¸ç”¨Linuxå‘½ä»¤"></a>å¸¸ç”¨Linuxå‘½ä»¤</h1><h2 id="æ–‡æœ¬å¤„ç†"><a href="#æ–‡æœ¬å¤„ç†" class="headerlink" title="æ–‡æœ¬å¤„ç†"></a>æ–‡æœ¬å¤„ç†</h2><ul>
<li>æ–‡ä»¶æŒ‰å›ºå®šè¡Œæ•°åˆ‡åˆ†</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">split</span> -l <span class="token number">20</span> cn-hangzhou.csv cn-hangzhou-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>é—®é¢˜æ˜¯: ç”Ÿæˆçš„æ–‡ä»¶éƒ½æ˜¯æ²¡æœ‰åç¼€åçš„, å¦‚ä¸‹å¯ä»¥ä½¿ç”¨xargs, ç»Ÿä¸€å¢åŠ åç¼€å, å¦‚ä¸‹ï¼š</p>
<ul>
<li>mac:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">split</span> -l <span class="token number">20</span> cn-hangzhou.csv cn-hangzhou- <span class="token operator">&amp;&amp;</span> <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> cn-hangzhou- <span class="token operator">|</span> <span class="token function">xargs</span> -n1 -I<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token function">mv</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>linux:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">split</span> -l <span class="token number">20</span> cn-hangzhou.csv cn-hangzhou- <span class="token operator">&amp;&amp;</span> <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> cn-hangzhou- <span class="token operator">|</span> <span class="token function">xargs</span> -n1 -i<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token function">mv</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æ–‡ä»¶æŒ‰ç…§æŸåˆ—è¿›è¡Œæ’åº</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sort</span> -n -k <span class="token number">1</span> -t , sample.csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æ–‡ä»¶æŸ¥çœ‹æŸåˆ—å»é‡æ•°æ®</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F<span class="token string">','</span> <span class="token string">'&#123;print $1&#125;'</span> sample.csv <span class="token operator">|</span> <span class="token function">sort</span> -n <span class="token operator">|</span> <span class="token function">uniq</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>è®¡ç®—æ–‡ä»¶ä¸­ç›¸åŒçš„è¡Œæ•°é‡, å¹¶æŒ‰ç…§æ•°é‡å€’åºæ’åˆ—:</li>
</ul>
<p>todo: </p>
<ul>
<li><p>grepæ­£åˆ™è¡¨è¾¾å¼<br>grepæ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦é›†ï¼ˆåŸºæœ¬é›†ï¼‰<br>^é”šå®šè¡Œçš„å¼€å§‹ å¦‚ï¼šâ€™^grepâ€™åŒ¹é…æ‰€æœ‰ä»¥grepå¼€å¤´çš„è¡Œã€‚<br>$é”šå®šè¡Œçš„ç»“æŸ å¦‚ï¼šâ€™grep$â€™åŒ¹é…æ‰€æœ‰ä»¥grepç»“å°¾çš„è¡Œã€‚</p>
</li>
<li><p>JSONå¤„ç†</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jq<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>è®¡ç®—æ–‡ä»¶md5å€¼</li>
</ul>
<ul>
<li><p>Linux: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">md5sum a.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Mac: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">md5 a.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<ul>
<li>åˆ›å»ºç©ºçš„å¤§æ–‡ä»¶(å…¨è¢«0å æ®çš„æ–‡ä»¶, è€Œéæ‰“æ´)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">fallocate -l 50M /data/web/www/html/b.zip
<span class="token comment">## -l: æŒ‡å®šæ–‡ä»¶çš„é•¿åº¦</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="ç›®å½•ç®¡ç†"><a href="#ç›®å½•ç®¡ç†" class="headerlink" title="ç›®å½•ç®¡ç†"></a>ç›®å½•ç®¡ç†</h2><ul>
<li>æŸ¥çœ‹ç›®å½•å¤§å°</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">du</span> -h --max-depth<span class="token operator">=</span><span class="token number">1</span> /home/admin/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶å¤§å°</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">du</span> -sh * <span class="token operator">|</span> <span class="token function">sort</span> -nr <span class="token operator">|</span> <span class="token function">head</span>
<span class="token function">du</span> -sh * <span class="token operator">|</span> <span class="token function">sort</span> -nr <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token string">"G"</span> <span class="token operator">|</span> <span class="token function">head</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h2><h3 id="top"><a href="#top" class="headerlink" title="top"></a>top</h3><h4 id="è¿›ç¨‹æ’åº"><a href="#è¿›ç¨‹æ’åº" class="headerlink" title="è¿›ç¨‹æ’åº"></a>è¿›ç¨‹æ’åº</h4><ul>
<li>ä»¥ CPU å ç”¨ç‡å¤§å°çš„é¡ºåºæ’åˆ—è¿›ç¨‹åˆ—è¡¨ <ul>
<li>topè¿›å…¥ä¹‹åï¼Œ æŒ‰P </li>
<li>æˆ–è€… <code>top -o %CPU</code></li>
</ul>
</li>
<li>ä»¥å†…å­˜å ç”¨ç‡å¤§å°çš„é¡ºåºæ’åˆ—è¿›ç¨‹åˆ—è¡¨<ul>
<li>topè¿›å…¥ä¹‹åï¼ŒæŒ‰M </li>
<li>æˆ–è€… <code>top -o %MEM</code></li>
</ul>
</li>
<li>ä»¥æ€»å…±æ¶ˆè€—çš„CPUæ—¶é—´ç‰‡æ’åº<ul>
<li>topè¿›å…¥ä¹‹åï¼ŒæŒ‰T </li>
<li><code>top -o +TIME</code></li>
</ul>
</li>
<li>å•ç‹¬æŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„CPUæ¶ˆè€—æƒ…å†µ<br><code>top -p $PID</code></li>
</ul>
<h4 id="çº¿ç¨‹æ’åº"><a href="#çº¿ç¨‹æ’åº" class="headerlink" title="çº¿ç¨‹æ’åº"></a>çº¿ç¨‹æ’åº</h4><ul>
<li>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä¸‹å„ä¸ªçº¿ç¨‹CPUå ç”¨æƒ…å†µï¼Œå€’åºæ’åˆ—<ul>
<li><code>top -Hp $&#123;pid&#125; -o %CPU</code></li>
</ul>
</li>
<li>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä¸‹å„ä¸ªçº¿ç¨‹å†…å­˜å ç”¨æƒ…å†µï¼Œå€’åºæ’åˆ—<ul>
<li><code>top -Hp $&#123;pid&#125; -o %MEM</code></li>
</ul>
</li>
<li>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä¸‹å„ä¸ªçº¿ç¨‹CPUæ—¶é—´ç‰‡å ç”¨æƒ…å†µï¼Œå€’åºæ’åˆ—<ul>
<li><code>top -Hp $&#123;pid&#125; -o +TIME</code></li>
</ul>
</li>
</ul>
<h3 id="centOS-yumæºè·¯å¾„"><a href="#centOS-yumæºè·¯å¾„" class="headerlink" title="centOS yumæºè·¯å¾„"></a>centOS yumæºè·¯å¾„</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/etc/yum.repos.d/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="è¿›ç¨‹-amp-ç½‘ç»œç®¡ç†"><a href="#è¿›ç¨‹-amp-ç½‘ç»œç®¡ç†" class="headerlink" title="è¿›ç¨‹&amp;ç½‘ç»œç®¡ç†"></a>è¿›ç¨‹&amp;ç½‘ç»œç®¡ç†</h2><ul>
<li>æŸ¥çœ‹ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨äº†</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">lsof</span> -i:<span class="token variable">$&#123;port&#125;</span>
<span class="token function">netstat</span> -natp <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;port&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>æ ¹æ®è¿›ç¨‹å·, æŸ¥çœ‹è¿›ç¨‹å ç”¨äº†å“ªäº›tcpç«¯å£</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">netstat</span> -natp <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;pid&#125;</span>
<span class="token function">sudo</span> <span class="token function">lsof</span> -i -P <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;pid&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;pid&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="ç”¨æˆ·ç®¡ç†"><a href="#ç”¨æˆ·ç®¡ç†" class="headerlink" title="ç”¨æˆ·ç®¡ç†"></a>ç”¨æˆ·ç®¡ç†</h2><ul>
<li>é”å®šç”¨æˆ·:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">passwd</span> -l username<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦è¢«é”å®š:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">passwd</span> -S username
<span class="token function">sudo</span> <span class="token function">passwd</span> --status interlive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>æˆ–è€…çœ‹ä¸‹å¯†ç å‰è¾¹æ˜¯å¦æœ‰ â€œ!!â€ æ ‡è®°, å¦‚æœæœ‰, åˆ™è¯æ˜è¢«æ ‡è®°äº†</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">fgrep</span> <span class="token string">"interlive"</span> /etc/shadow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="ç»‘æ ¸"><a href="#ç»‘æ ¸" class="headerlink" title="ç»‘æ ¸"></a>ç»‘æ ¸</h2><ul>
<li>æŸ¥çœ‹è¿›ç¨‹ç»‘æ ¸æƒ…å†µ</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">taskset -p <span class="token variable">$PID</span>
taskset -cp <span class="token variable">$PID</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads/Clash-Linux$ taskset -p <span class="token number">20697</span>
pid <span class="token number">20697</span><span class="token string">'s current affinity mask: f
davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads/Clash-Linux$ taskset -cp 20697
pid 20697'</span>s current affinity list: <span class="token number">0</span>-3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>æ‰§è¡Œè¿›ç¨‹ç»‘æ ¸æ“ä½œ</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">taskset -p COREMASK PID<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h1 id="ç£ç›˜æ“ä½œ"><a href="#ç£ç›˜æ“ä½œ" class="headerlink" title="ç£ç›˜æ“ä½œ"></a>ç£ç›˜æ“ä½œ</h1><h2 id="æŸ¥çœ‹å—è®¾å¤‡-åŒ…æ‹¬å·²åˆ†åŒºä¸æœªåˆ†åŒºçš„"><a href="#æŸ¥çœ‹å—è®¾å¤‡-åŒ…æ‹¬å·²åˆ†åŒºä¸æœªåˆ†åŒºçš„" class="headerlink" title="æŸ¥çœ‹å—è®¾å¤‡(åŒ…æ‹¬å·²åˆ†åŒºä¸æœªåˆ†åŒºçš„)"></a>æŸ¥çœ‹å—è®¾å¤‡(åŒ…æ‹¬å·²åˆ†åŒºä¸æœªåˆ†åŒºçš„)</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@OpenWrt:~<span class="token comment"># lsblk</span>
NAME          MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
nvme0n1       <span class="token number">259</span>:0    <span class="token number">0</span> <span class="token number">465</span>.8G  <span class="token number">0</span> disk
â”œâ”€nvme0n1p1   <span class="token number">259</span>:1    <span class="token number">0</span>    16M  <span class="token number">0</span> part /boot
â”‚                                       /boot
â”œâ”€nvme0n1p2   <span class="token number">259</span>:2    <span class="token number">0</span>   500M  <span class="token number">0</span> part /rom
â”œâ”€nvme0n1p3   <span class="token number">259</span>:3    <span class="token number">0</span>   128G  <span class="token number">0</span> part /overlay
â”œâ”€nvme0n1p4   <span class="token number">259</span>:4    <span class="token number">0</span>   128G  <span class="token number">0</span> part /mnt/nvme0n1p4
â”œâ”€nvme0n1p5   <span class="token number">259</span>:5    <span class="token number">0</span>   128G  <span class="token number">0</span> part /mnt/nvme0n1p5
â”œâ”€nvme0n1p6   <span class="token number">259</span>:6    <span class="token number">0</span>  <span class="token number">81</span>.3G  <span class="token number">0</span> part /mnt/nvme0n1p6
â””â”€nvme0n1p128 <span class="token number">259</span>:7    <span class="token number">0</span>   239K  <span class="token number">0</span> part<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æŸ¥çœ‹åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹"><a href="#æŸ¥çœ‹åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹" class="headerlink" title="æŸ¥çœ‹åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹"></a>æŸ¥çœ‹åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@OpenWrt:~<span class="token comment"># parted -l</span>
Model: WD Blue SN570 500GB SSD <span class="token punctuation">(</span>nvme<span class="token punctuation">)</span>
Disk /dev/nvme0n1: 500GB
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name  Flags
<span class="token number">128</span>     <span class="token number">17</span>.4kB  262kB   245kB                      bios_grub
 <span class="token number">1</span>      262kB   <span class="token number">17</span>.0MB  <span class="token number">16</span>.8MB  fat16              legacy_boot
 <span class="token number">2</span>      <span class="token number">17</span>.0MB  541MB   524MB
 <span class="token number">3</span>      542MB   138GB   137GB   ext4
 <span class="token number">4</span>      138GB   275GB   137GB   ext4
 <span class="token number">5</span>      275GB   413GB   137GB   ext4
 <span class="token number">6</span>      413GB   500GB   <span class="token number">87</span>.2GB  ext4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ä¸ºå—è®¾å¤‡åˆ†åŒº"><a href="#ä¸ºå—è®¾å¤‡åˆ†åŒº" class="headerlink" title="ä¸ºå—è®¾å¤‡åˆ†åŒº"></a>ä¸ºå—è®¾å¤‡åˆ†åŒº</h2><h2 id="ä¸ºåˆ†åŒºæ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿç±»å‹"><a href="#ä¸ºåˆ†åŒºæ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿç±»å‹" class="headerlink" title="ä¸ºåˆ†åŒºæ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿç±»å‹"></a>ä¸ºåˆ†åŒºæ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿç±»å‹</h2><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="æŸ¥çœ‹centosç‰ˆæœ¬"><a href="#æŸ¥çœ‹centosç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹centosç‰ˆæœ¬"></a>æŸ¥çœ‹centosç‰ˆæœ¬</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rpm --query centos-release</span>
centos-release-7-9.2009.0.el7.centos.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="æŸ¥çœ‹Linuxå†…æ ¸ç‰ˆæœ¬"><a href="#æŸ¥çœ‹Linuxå†…æ ¸ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹Linuxå†…æ ¸ç‰ˆæœ¬"></a>æŸ¥çœ‹Linuxå†…æ ¸ç‰ˆæœ¬</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># uname -a</span>
Linux localhost.localdomain <span class="token number">3.10</span>.0-1160.el7.x86_64 <span class="token comment">#1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>æ— ç”¨çš„çŸ¥è¯†åˆå¢åŠ äº†</title>
    <url>//2021-11-22-random-snippets/</url>
    <content><![CDATA[<p>CPUèŠ¯ç‰‡ä¸­vendor_id:</p>
<ul>
<li><code>intel --&gt; Genuine Intel</code></li>
<li><code>amd --&gt; Authentic AMD</code></li>
</ul>
<p>å“ˆå“ˆ, ä¸ºå•¥éƒ½åŠ ä¸ªâ€çœŸå®çš„â€å‘¢? ç”Ÿæ€•åˆ«äººä¼ªé€ ä¹ˆ?</p>
<hr>
<ul>
<li>ä¸ºå•¥ Java çš„ HeapDump æ–‡ä»¶åç¼€æ˜¯<code>hprof</code>, ä¾‹å¦‚<code>20230914-tmp.hprof</code>?</li>
<li>ä»£è¡¨<code>Heap Profiling</code>, å³å †å†…å­˜åˆ†æ. ä¹Ÿæ˜¯å¾ˆæ—©ä»¥å‰JDKæä¾›çš„å·¥å…·: <a href="https://www.cnblogs.com/linhaohong/archive/2012/07/12/2588657.html">HPROF: ä¸€ä¸ªHeap&#x2F;CPU Profilingå·¥å…·</a></li>
</ul>
<hr>
<ul>
<li>K8sä¸­å„ç§shimç»„ä»¶, å…·ä½“ä¸ºå•¥å« shim ?</li>
<li>ç›´è¯‘è¿‡æ¥æ˜¯<code>å«ç‰‡</code>, è¿™æ˜¯ä»€ä¹ˆé¬¼? å¾ˆéš¾ç†è§£. å…¶å®æœ¬è´¨å°±æ˜¯Adaptor. å½“ç„¶ä¹Ÿæœ‰äººä¹Ÿæœ‰ç±»ä¼¼çš„åæ§½, å¥½å¥½åœ°å«adaptorå¾ˆéš¾ä¹ˆ? <a href="https://hackernoon.com/design-patterns-wtf-is-a-shim-la1h338v">Design Patterns: WTF is a Shim?</a></li>
</ul>
<hr>
<ul>
<li>åˆ°åº•åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹è¯¥ç”¨<code>java.util.LinkedList</code>? å…·ä½“è°ç”¨äº†?</li>
<li>å·§äº†, LinkedListçš„ä½œè€…<code>Joshua Bloch</code>ä¹Ÿæœ‰åŒæ ·çš„å›°æƒ‘. åŸºæœ¬ç»“è®º, å°±æ˜¯å­¦ä¹ æ€è·¯å¯ä»¥, ä½†åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å°±å°½é‡ä¸è¦ç”¨å•¦.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202309142358549.png"></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>tech-for-fun</tag>
      </tags>
  </entry>
  <entry>
    <title>æ²™ä¸˜ ç¬”è®°</title>
    <url>//2021-12-12-Dune/</url>
    <content><![CDATA[<hr>
<blockquote>
<p>ä»–è½¬è¿‡èº«, æ²¿ç€è¿‡é“å¤§æ­¥èµ°å›å¤§å…, è„‘æµ·ä¸­çš„è®°å¿†ç¿»è…¾èµ·æ¥, å°±åƒä¸€ä¸ªä¸ªæ²¡ç‰™çš„è€å¤ªå©†åœ¨å” å” å¨å¨åœ°è¿°è¯´.<br>ä»–æƒ³èµ·äº†å®½é˜”çš„æ°´åŸŸ, èµ·ä¼çš„æ³¢æµª, æƒ³èµ·äº†æ»¡çœ¼é’è‰è€Œä¸æ˜¯é»„æ²™çš„æ—¥å­, æƒ³èµ·äº†è‰³é˜³é«˜ç…§çš„å¤å­£, è¿™ç§æ—¥å­å·²ç»åƒé£æš´ä¸­çš„è½å¶ä¸€æ ·è¿…çŒ›åœ°ç¦»ä»–è€Œå»äº†.</p>
</blockquote>
<hr>
<blockquote>
<p>ç”Ÿå‘½ä¼šå°†ç‹‚æš´çš„åºŸç‰©å˜æˆä¼˜é›…çš„çµåŠ¨ä¹‹ç‰©, ä»–æƒ³, è¿™å°±æ˜¯æ²™æ¼ å¯¹æˆ‘ä»¬çš„æ•™è¯².<br>ç°å®çš„è¿™ç§æ”¹å˜å¸¸å¸¸è®©ä»–ç ç›®ç»“èˆŒ.<br>ä»–å¾ˆæƒ³è½¬èº«å¯¹ç€æŒ¤åœ¨ç©´åœ°å…¥å£å¤„çš„åŠ©æ‰‹ä»¬å¤§å£°å«å–Š:<br>å¦‚æœä½ ä»¬ä¸€å®šè¦å´‡æ‹œæŸç§ä¸œè¥¿çš„è¯, å°±å´‡æ‹œç”Ÿå‘½å§<br>â€“ æ‰€æœ‰ç”Ÿå‘½, å“ªæ€•æ˜¯æœ€ä½è´±çš„ç”Ÿå‘½! ç”Ÿå‘½çš„ç¾å¥½å±äºæˆ‘ä»¬å…¨ä½“!</p>
</blockquote>
<hr>
<blockquote>
<p>æœ‰é‚£ä¹ˆä¸€ä¼šå„¿ï¼Œä»–ä»»å‡­è‡ªå·±çš„æ€ç»ªè‡ªç”±é£˜è¡ã€‚<br>ä»–æƒ³èµ·ä»–å¸¦ç€å­©ææ—¶å€™çš„ä¿ç½—åˆ°å¡æ‹‰ä¸¹æµ·æ»¨å¸‚åœºçš„é‚£ä¸€å¤©ã€‚<br>å¤ªé˜³ç…§åœ¨æ°´é¢ä¸Šï¼Œå‘å‡ºè€€çœ¼çš„å…‰èŠ’ã€‚<br>å¤§æµ·ä¸°é¥¶çš„äº§å“é™é™åœ°æ‘†åœ¨é‚£å„¿å‡ºå”®ã€‚<br>è‰¾è¾¾è·è¿˜è®°èµ·äº†ç»å¸¸ä¸ºä»–ä»¬å¼¹å¥å·´å˜ç´çš„å“¥å°¼Â·å“ˆè±å…‹ï¼Œé‚£äº›æ¬¢ç¬‘ï¼Œé‚£äº›å¿«ä¹æ—¶å…‰ã€‚<br>éŸ³ä¹çš„æ—‹å¾‹åœ¨ä»–çš„è„‘æµ·ä¸­è·³è·ƒï¼Œåƒå’’è¯­ä¸€èˆ¬ï¼Œå¼•é¢†ç€ä»–çš„æ„è¯†ï¼Œèµ°è¿›å¿«ä¹çš„å›å¿†ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p>ä¸€ç¬é—´ï¼Œè‰¾è¾¾è·è§¦åˆ°äº†é¢„çŸ¥å¹»è±¡ï¼Œçœ‹åˆ°æœªæ¥çš„äººä»¬ç”¨è°ˆè®ºå¤§æµ·çš„å£æ°”è°ˆè®ºä¿ç½—ã€‚<br>ä»–ä¸€ç”Ÿè’™å°˜ï¼Œåœ¨æ²™åœŸä¸­å¥”èµ°ï¼Œä½†æ°´ä¸€ç›´ä¼´éšç€ä»–ã€‚<br>â€œä»–çš„è‚‰ä½“æ²‰æ²¡äº†ï¼Œâ€äººä»¬ä¼šè¯´ï¼Œâ€œå¯ä»–å´æ¸¸äº†ä¸Šæ¥ã€‚â€</p>
</blockquote>
<hr>
<blockquote>
<p>è‰¾è¾¾è·æŠŠè‡ªå·±çš„å˜´å”‡æŒ¨åˆ°å¥¹çš„å¤´å‘ä¸Šã€‚â€œæ±‚æ±‚ä½ ï¼Œåˆ«éš¾è¿‡äº†ã€‚â€ä»–ä½å£°è¯´ï¼Œ<br>æ„Ÿåˆ°å¥¹çš„æ‚²å“€å’Œè‡ªå·±çš„æ··åˆåœ¨ä¸€èµ·ï¼Œåƒä¸¤æ¡å°æºªèå…¥äº†åŒä¸€ä¸ªæ°´æ± ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p>ä»–æ„Ÿè§‰è‡ªå·±æ˜¯åœ¨æ—¶é—´çš„æµ·æ´‹ä¸­å†²æµªï¼Œæ—¶è€Œè·Œè¿›æµªè°·ï¼Œæ—¶è€Œéª‘ä¸Šæµªå°–ï¼Œ<br>ä¸æ­¤åŒæ—¶ï¼Œå‘¨å›´çš„å…¶ä»–æ³¢æµªæ­¤èµ·å½¼ä¼ï¼Œå®ƒä»¬è¡¨é¢è½½ç€çš„ä¸œè¥¿ä¹Ÿæ—¶éšæ—¶ç°ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p>å®ªæ³•æ˜¯é¼“åŠ¨èµ·æ¥çš„ç¤¾ä¼šæƒåŠ›ï¼Œæ²¡æœ‰ä»»ä½•é“å¾·å’Œè‰¯å¿ƒã€‚<br>å®ƒå¯ä»¥æ‘§æ¯ç¤¾ä¼šçš„å„ä¸ªé˜¶å±‚ï¼Œæ— æƒ…åœ°æŠ¹æ€æ‰€æœ‰å°Šä¸¥å’Œä¸ªæ€§ã€‚å®ƒæ²¡æœ‰ç¨³å®šçš„æ ‡å‡†ï¼Œä¹Ÿä¸å—ä»»ä½•é™åˆ¶ã€‚<br>ä¸æ­¤ç›¸æ¯”ï¼Œæˆ‘åˆ™æ˜¯æœ‰é™åˆ¶çš„ã€‚ä¸ºäº†ç»™æˆ‘çš„äººæ°‘æä¾›ç»å¯¹çš„ä¿æŠ¤ï¼Œæˆ‘ç¦æ­¢é¢å¸ƒå®ªæ³•ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p>â€œå•Šï¼Œæ³•å¾‹ã€‚â€ä»–è¯´ã€‚ä»–èµ°åˆ°çª—å‰ï¼Œæ‹‰å¼€å¸·å¹”ï¼Œå¥½åƒèƒ½çœ‹è§å¤–é¢ä¼¼çš„ï¼Œ<br>â€œä»€ä¹ˆæ˜¯æ³•å¾‹ï¼Ÿæ§åˆ¶å—ï¼Ÿæ³•å¾‹è¿‡æ»¤äº†æ··ä¹±ï¼Œæ»¤ä¸‹æ¥çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿç¥¥å’Œï¼Ÿæ³•å¾‹æ—¢æ˜¯æˆ‘ä»¬çš„æœ€é«˜ç†æƒ³ï¼Œåˆæ˜¯æˆ‘ä»¬æœ€æ ¹æœ¬çš„å¤©æ€§ã€‚<br>æ³•å¾‹ç»ä¸èµ·ç»†çœ‹ï¼Œè®¤çœŸç¢ç£¨çš„è¯ï¼Œä½ ä¼šå‘ç°å®ƒåªä¸è¿‡æ˜¯ä¸€å¥—ç†æ€§åŒ–çš„é˜é‡Šã€åˆæ³•çš„è¯¡è¾©ã€ä¸€äº›æ–¹ä¾¿äººä»¬è¿ç”¨çš„å…ˆä¾‹ã€‚<br>å¯¹ï¼Œè¿˜æœ‰ç¥¥å’Œï¼Œä½†é‚£ä¸è¿‡æ˜¯æ­»äº¡çš„ä»£åè¯è€Œå·²ã€‚â€</p>
</blockquote>
<hr>
<blockquote>
<p>å¥¹æ›¾ç»™ä»–å¼•è¿°äº†ä¸€æ®µè´å°¼Â·æ°ç‘Ÿé‡Œç‰¹è°šè¯­ï¼š<br>â€œå½“å®—æ•™ä¸æ”¿æ²»åŒä¹˜ä¸€è¾†é©¬è½¦æ—¶ï¼Œé©¾è½¦äººä¼šè§‰å¾—æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿å¯ä»¥é˜»æŒ¡ä»–ä»¬ã€‚ä»–ä»¬ä¼šä¸€è·¯ç‹‚å¥”ï¼Œé€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼ŒæŠŠä¸€åˆ‡æ€æƒ³éšœç¢éƒ½æŠ›åˆ°ä¸€è¾¹ã€‚<br>ä»–ä»¬ä¼šæŠŠä¸€åˆ‡å±æœºæ„è¯†æŠ›è¯¸è„‘åï¼Œå¿˜è®°å‰é¢çš„æ‚¬å´–å¹¶ä¸ä¼šä¸»åŠ¨æé†’é—­èµ·çœ¼ç›ç›²ç›®ç‹‚å¥”çš„äººã€‚<br>ä»–ä»¬ä¸æ‡‚å¾—æ‚¬å´–å‹’é©¬ï¼Œç›´åˆ°ä¸ºæ—¶å·²æ™šã€‚â€</p>
</blockquote>
<hr>
<blockquote>
<p>å¥¹åªç«™äº†çŸ­çŸ­çš„ä¸€åˆ»ï¼Œä¸€ç¬è€Œå·²ï¼Œå°±åƒå¥¹è‡ªå·±çš„ç”Ÿå‘½ä¸æ—¶é—´æœ¬èº«ç›¸æ¯”é‚£æ ·ä¸å€¼ä¸€æã€‚<br>ä½†å°±åœ¨è¿™ä¸€ç¬ï¼Œå¥¹è§‰å¾—è¿è¿™é¢—æ˜Ÿçƒéƒ½å¿«è¢«ç‹‚é£å¹èµ°äº†ï¼Œå’Œç‹‚é£æŒŸå¸¦çš„å…¶ä»–ä¸€åˆ‡ä¸€æ ·ï¼Œå˜æˆå®‡å®™çš„å°˜åŸƒã€‚</p>
</blockquote>
<hr>
<blockquote>
<p>ä½†ä»–æ¸æ¸æ„è¯†åˆ°ï¼Œä¸ç•™ä¸‹ä»»ä½•ç—•è¿¹åœ°æ­»å»ï¼Œæˆ–è®¸æ˜¯ä¸€ç§éš¾å¾—çš„ç¤¼é‡â€”â€”æ²¡æœ‰å°¸éª¸ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ•´ä¸ªæ˜Ÿçƒå°±æ˜¯ä»–çš„å¢“åœ°ã€‚</p>
</blockquote>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>books</tag>
        <tag>2021</tag>
        <tag>sci-fi</tag>
      </tags>
  </entry>
  <entry>
    <title>Java NIOç–‘é—®ä¸æ€»ç»“</title>
    <url>//2021-12-17-java-nio/</url>
    <content><![CDATA[<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> dst <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> read <span class="token operator">=</span> clientChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> read<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    clientChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>dst<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
clientChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>è¿™é‡Œ <code>-1==read</code> ä¸ <code>dst.hasRemaining()</code> æœ‰å•¥åŒºåˆ«? ä¸Šè¿°ä¸¤ç§åˆ¤æ–­æ–¹å¼æœ‰å•¥å·®å¼‚? </p>
</li>
<li><p>ä»€ä¹ˆæ—¶å€™ <code>0 == read</code> ?</p>
</li>
<li><p>case1: å¦‚æœclientChannelåˆšå¥½1024ä¸ªå­—èŠ‚:</p>
<ul>
<li>æ‰€ä»¥ç¬¬ä¸€æ¬¡read, ç»“æœè‚¯å®šä¸æ˜¯-1, è€Œæ˜¯1024, å³å®é™…è¯»å–çš„å­—èŠ‚æ•°, æ­¤æ—¶ä¼šè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯, clientChannel.read(dst); å˜ä¸ºâ€case3â€</li>
<li>æ­¤æ—¶dst.hasRemaining() &#x3D;&#x3D; false</li>
</ul>
</li>
<li><p>case2: å¦‚æœclientChannelå¯è¯»çš„&lt;1024ä¸ªå­—èŠ‚(ä¾‹å¦‚128ä¸ªå­—èŠ‚): </p>
<ul>
<li>æ‰€ä»¥ç¬¬ä¸€æ¬¡read, ç»“æœä¹Ÿä¸æ˜¯-1, è€Œæ˜¯1024, å³å®é™…è¯»å–çš„å­—èŠ‚æ•°(128), æ­¤æ—¶ä¼šè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯, clientChannel.read(dst); å˜ä¸ºâ€case3â€</li>
<li>æ­¤æ—¶dst.hasRemaining() &#x3D;&#x3D; true</li>
</ul>
</li>
<li><p>case3: å¦‚æœclientChannelå¯è¯»çš„0ä¸ªå­—èŠ‚: </p>
<ul>
<li>æ‰€ä»¥ç¬¬ä¸€æ¬¡read, ç»“æœæ˜¯-1</li>
<li>æ­¤æ—¶dst.hasRemaining() &#x3D;&#x3D; true<br>æ‰€ä»¥, ç»¼ä¸Šcase, dst.hasRemaining() ä¸ -1&#x3D;&#x3D;read() åŸºæœ¬ä¸€è‡´. ä½†åœ¨case2åœºæ™¯ä¸‹, ä¼šå°‘ä¸€æ¬¡å¾ªç¯.<br>ä¸è¿‡ä¸€èˆ¬çš„åº”ç”¨å±‚åè®®, ä¼šåœ¨è¯·æ±‚å¤´é‡Œæ ‡æ˜æœ¬æ¬¡è¯·æ±‚çš„å­—èŠ‚æ•°, å…¸å‹çš„ä¾‹å¦‚ZK, æ‰€ä»¥ä¸å¤ªéœ€è¦æŒ‰ç…§ä¸Šè¾¹è¿™ç§æ–¹å¼.</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>java</tag>
        <tag>nio</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPåè®®ä¸­TIME_WAITç–‘é—®ä¸æ€è€ƒ</title>
    <url>//2021-12-17-tcp-time-wait/</url>
    <content><![CDATA[<hr>
<p>ç–‘é—®: ä»ä¸‹å›¾å¯ä»¥çœ‹å‡º, å®¢æˆ·ç«¯å¯èƒ½ä¼šæ˜¯TIME_WAITçŠ¶æ€. ä½†å¦‚æœæ˜¯æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­çš„å‘¢? æœåŠ¡ç«¯å¯èƒ½ä¼šæ˜¯TIME_WAITçŠ¶æ€ä¹ˆ?<br><img data-src="/../_assets/2021-12-18-tcp-time-wait/tcp.png" alt="img.png"></p>
<p>ç­”æ¡ˆ: æ˜¯å¯èƒ½çš„. æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­, é‚£ä¹ˆå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹, ä¸Šå›¾ä¸­å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯å°±è¦ç¿»è½¬ä¸‹äº†. </p>
<hr>
<p>ç–‘é—®: ä¸ºå•¥TIME_WAITè¦æŒç»­2MSL?</p>
<ul>
<li>MSL: æœ€å¤§åˆ†æ®µç”Ÿå­˜æœŸ, æŒ‡æ˜TCPæŠ¥æ–‡åœ¨Internetä¸Šæœ€é•¿ç”Ÿå­˜æ—¶é—´ï¼Œæ¯ä¸ªå…·ä½“çš„TCPå®ç°éƒ½å¿…é¡»é€‰æ‹©ä¸€ä¸ªç¡®å®šçš„MSLå€¼ã€‚</li>
</ul>
<p>TIME_WAITçŠ¶æ€å¿…é¡»è¦æœ‰ä¸€å®šçš„æŒç»­æ—¶é—´ï¼Œæ‰€ä»¥TIME_WAITä¹Ÿè¢«ç§°ä¸º2MSLç­‰å¾…çŠ¶æ€ï¼Œä¸€èˆ¬æŒç»­æ—¶é—´åœ¨1åˆ†é’Ÿåˆ°4åˆ†é’Ÿä¹‹é—´ã€‚<br>RFC793å®šä¹‰äº†MSLä¸º2åˆ†é’Ÿï¼ŒLinuxè®¾ç½®æˆäº†30s</p>
<p>ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š<br>1ã€æˆ‘ä»¬æ²¡æœ‰ä»»ä½•æœºåˆ¶ä¿è¯æœ€åçš„ä¸€ä¸ªACKèƒ½å¤Ÿæ­£å¸¸é€è¾¾, TIME_WAITç¡®ä¿æœ‰è¶³å¤Ÿçš„æ—¶é—´è®©å¯¹ç«¯æ”¶åˆ°äº†ACKï¼Œ<br>    * å¦‚æœè¢«åŠ¨å…³é—­çš„é‚£æ–¹æ²¡æœ‰æ”¶åˆ°ACKï¼Œå°±ä¼šè§¦å‘è¢«åŠ¨ç«¯é‡å‘Finï¼Œ<br>    * ä»ä¸Šå›¾æŸ¥çœ‹, ACKåˆ°æœåŠ¡ç«¯1ä¸ªMSL, æœåŠ¡ç«¯å¦‚æœåœ¨MSLé‡Œæ²¡æ”¶åˆ°ACK, åˆ™ä¼šé‡å‘FIN, FINåˆ°è¾¾å®¢æˆ·ç«¯.<br>    * ä¸Šè¾¹ACK + FIN è€—æ—¶, æ­£å¥½2ä¸ªMSLï¼›<br>2ã€æœ‰è¶³å¤Ÿçš„æ—¶é—´è®©è¿™ä¸ªè¿æ¥ä¸ä¼šè·Ÿåé¢çš„è¿æ¥æ··åœ¨ä¸€èµ·ï¼ˆå¦‚æœè¿æ¥è¢«é‡ç”¨äº†ï¼Œé‚£ä¹ˆè¿™äº›å»¶è¿Ÿæ”¶åˆ°çš„åŒ…å°±æœ‰å¯èƒ½ä¼šè·Ÿæ–°è¿æ¥æ··åœ¨ä¸€èµ·ï¼‰ã€‚<br>    * </p>
<p>æˆ‘ä»¬ç»å¸¸å°±ä¼šåœ¨æœåŠ¡å™¨ä¸Šå‘ç°æœ‰å¾ˆå¤šçš„wait_timeoutï¼Œç‰¹åˆ«å¸¸è§çš„å°±æ˜¯httpæœåŠ¡å™¨ï¼Œä»ä¸Šé¢çš„æè¿°æ¥çœ‹ï¼Œè¿™ä¸ªçŠ¶æ€åº”è¯¥æ˜¯ä¸»åŠ¨å…³é—­çš„ä¸€æ–¹ï¼Œæ‰ä¼šæœ‰çš„çŠ¶æ€ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆæœåŠ¡å™¨ç«¯ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥å‘¢ï¼Ÿä¸åº”è¯¥æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€å—ï¼Ÿ</p>
<p>æ®è¯´ï¼Œå…¶å®åœ¨æœ€åˆçš„httpåè®®ï¼ŒæœåŠ¡å™¨åœ¨å‘é€å®Œå®¢æˆ·ç«¯éœ€è¦çš„å†…å®¹åï¼Œå°±ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå› ä¸ºå½“æ—¶çš„å®¢æˆ·ç«¯ï¼Œéœ€è¦ç­‰å¾…æ‰€æœ‰æ•ˆæœæ¸²æŸ“å®Œæ¯•ï¼Œæ‰ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œä¸ºäº†ç…§é¡¾å½“æ—¶æ€§èƒ½ä½ä¸‹çš„æœåŠ¡å™¨ï¼Œæ›´å¥½çš„æœåŠ¡å…¶ä»–å®¢æˆ·ï¼Œæ‰åœ¨åè®®ä¸­è¿™æ ·è§„å®šï¼Œè¯´åˆ°åº•å°±æ˜¯httpåè®®å¤ªè€äº†ï¼Œæ‰€ä»¥Googleæ‰ä¼šæ¨ä»–çš„SPDYåè®®ã€‚</p>
<hr>
<p>ç–‘é—®: å®é™…ä¸Š, æˆ‘ä»¬çœ‹åˆ°ç»å¸¸æœåŠ¡ç«¯ä¼šå¤„äºCLOSE_WAITçŠ¶æ€, ç†è®ºä¸ŠCLOSE_WAITåº”è¯¥æŒç»­æ—¶é—´å¾ˆçŸ­, ä¸ºå•¥ä¼šç»å¸¸å¤„äºè¿™ä¸ªçŠ¶æ€?<br>è§£é‡Š: å‡ºç°å¤§é‡close_waitçš„ç°è±¡ï¼Œä¸»è¦åŸå› æ˜¯æŸç§æƒ…å†µä¸‹å¯¹æ–¹å…³é—­äº†socketé“¾æ¥ï¼Œä½†æ˜¯æˆ‘æ–¹å¿™ä¸è¯»æˆ–è€…å†™ï¼Œæ²¡æœ‰å…³é—­è¿æ¥ã€‚<br>    å°±æ˜¯è¯´CLOSE_WAITæ—¶, æœåŠ¡ç«¯è¿˜æœ‰æ•°æ®è¦å†™ç»™å®¢æˆ·ç«¯, æ‰€ä»¥æ²¡æœ‰ç»™å®¢æˆ·ç«¯å‘FIN<br>    ä»£ç éœ€è¦åˆ¤æ–­socketï¼Œä¸€æ—¦è¯»åˆ°0ï¼Œæ–­å¼€è¿æ¥ï¼Œreadè¿”å›è´Ÿï¼Œæ£€æŸ¥ä¸€ä¸‹errnoï¼Œå¦‚æœä¸æ˜¯AGAINï¼Œå°±æ–­å¼€è¿æ¥ã€‚</p>
<hr>
<p>ç–‘é—®: å¯ä»¥ä»ä¸Šå›¾çœ‹å‡º, å¦‚æœå®¢æˆ·ç«¯åœ¨TIME_WAITå†…é‡å‘äº†ä¸€æ¬¡ACK, ä½†ACKè¿˜æ˜¯æ²¡æœ‰è¢«æœåŠ¡ç«¯æ”¶åˆ°, é‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šåœ¨LAST_ACKçŠ¶æ€. å…·ä½“LAST_ACKä¼šæŒç»­å¤šä¹…?<br>è§£é‡Š: LAST_ACK-&gt;CLOSEä¸é è¶…æ—¶. åŠ å…¥æœåŠ¡ç«¯å‘é€äº†FINä¹‹å, ç­‰å¾…LAST_ACK.<br>ä½†å®¢æˆ·ç«¯å›å¤çš„ACKä¸¢å¤±äº†, åœ¨MSLé‡Œ, æœåŠ¡ç«¯é‡æ–°å‘é€äº†FIN, å®¢æˆ·ç«¯æ”¶åˆ°ä¹‹å, é‡æ–°å‘é€ACK, æ­¤æ—¶ACKé‡æ–°ä¸¢å¤±.<br>å®¢æˆ·ç«¯ç”±äº2MSLåˆ°æœŸ, å› æ­¤å˜ä¸ºCLOSEDçŠ¶æ€;<br>æœåŠ¡ç«¯é‡æ–°å‘é€FIN, ç”±äºå®¢æˆ·ç«¯å·²ç»å¤„äºCLOSEDçŠ¶æ€, å› æ­¤è¿æ¥ä¸¢å¤±, å®¢æˆ·ç«¯å›å¤RST, Bæ”¶åˆ°RSTè¿›å…¥CLOSEDçŠ¶æ€.</p>
<hr>
<p>ç–‘é—®: æœ‰å•¥æœ€ä½³å®è·µ?<br>é«˜å¹¶å‘TCPæœåŠ¡å™¨ä¸­è¿›è¡Œä¸»åŠ¨å…³é—­çš„ä¸€æ–¹æœ€å¥½æ˜¯å®¢æˆ·ç«¯ï¼š</p>
<ul>
<li>å› ä¸ºå¯¹äºé«˜å¹¶å‘æœåŠ¡å™¨æ¥è¯´æ–‡ä»¶æè¿°ç¬¦èµ„æºæ˜¯å¾ˆé‡è¦çš„èµ„æºï¼Œ</li>
<li>å¦‚æœå¯¹äºæ¯ä¸€ä¸ªè¿æ¥éƒ½è¦ç»å†TIME_WAITè¿™ä¸ª2MSLçš„æ—¶é•¿ï¼ŒåŠ¿å¿…é€ æˆèµ„æºä¸èƒ½ç«‹é©¬å¤ç”¨çš„æµªè´¹ã€‚</li>
<li>è™½ç„¶å¯¹äºå®¢æˆ·ç«¯æ¥è¯´TIME_WAITçŠ¶æ€ä¼šå ç”¨ç«¯å£å’Œå¥æŸ„èµ„æºï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸€èˆ¬å¾ˆå°‘æœ‰å¹¶å‘èµ„æºé™åˆ¶ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯æ‰§è¡Œä¸»åŠ¨å…³é—­æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚</li>
</ul>
<p>æœåŠ¡å™¨ç«¯ç¨‹åºæœ€å¥½å¯ç”¨SO_REUSEADDRé€‰é¡¹ï¼š</p>
<ul>
<li>æˆ‘ä»¬æƒ³è¿™æ ·åšä¸€ç§æƒ…å†µï¼Œå¦‚æœç”Ÿäº§ç¯å¢ƒä¸­æœåŠ¡ç«¯ç¨‹åºç”±äºæŸç§é”™è¯¯æ“ä½œå…³é—­äº†ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯è¦ç«‹é©¬é‡å¯æœåŠ¡ç¨‹åºï¼Œ</li>
<li>ä½†æ˜¯TIME_WAITè¿˜åœ¨å ç”¨ç€è¿™äº›åœ°å€ç«¯å£èµ„æºè®©ä½ çš„æœåŠ¡èµ·ä¸æ¥ï¼Œé‚£ä½ ç€ä¸ç€æ€¥ã€‚</li>
<li>SOREUSEADDRè¿™ä¸ªé€‰é¡¹æ­£æ˜¯å…è®¸åœ°å€ç«¯å£çš„é‡å¤ç»‘å®šã€‚</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>tcp</tag>
        <tag>timewait</tag>
      </tags>
  </entry>
  <entry>
    <title>ZkClientæºç é˜…è¯»ä¸ç–‘é—®æ€»ç»“</title>
    <url>//2021-12-17-zk-client/</url>
    <content><![CDATA[<ol>
<li>åœ¨clientç«¯ä½¿ç”¨NIOæ„ä¹‰&#x2F;ä¼˜ç‚¹, ç›¸æ¯”äºä¼ ç»Ÿçš„BIOæ˜¯å•¥?<ol>
<li><a href="https://blog.csdn.net/cenwenchu79/article/details/4586939">https://blog.csdn.net/cenwenchu79/article/details/4586939</a></li>
<li>å°¤å…¶æ˜¯åœ¨clientéœ€è¦è¿æ¥æµ·é‡çš„æœåŠ¡ç«¯æ—¶, ä¾‹å¦‚çˆ¬è™«, æˆ–è€…æµ·é‡ç‰©ç†æœºé›†ç¾¤çš„ç®¡æ§æœåŠ¡ç­‰, å‚è§<a href="https://davyjones2010.github.io/2022-03-15-http-client-netty/">å¼‚æ­¥HttpClientä½¿ç”¨Nettyä½œä¸ºSocketChannelçš„Provider</a></li>
</ol>
</li>
<li>clienté‡è¿æœºåˆ¶æ˜¯æ€æ ·çš„?<ol>
<li>clientæ˜¯å¦‚ä½•åˆ¤å®šè¿æ¥æ–­å¼€çš„?</li>
<li>å‡ ä¸ªé‡è¦å‚æ•°æ˜¯æ€æ ·çš„?<ol>
<li>å·²ç»å»ºç«‹çš„è¿æ¥, è¶…æ—¶æ—¶é—´æ˜¯å¤šä¹…, åˆ™è®¤ä¸ºæ˜¯è¿æ¥æ–­å¼€äº†?</li>
<li>æœªå»ºç«‹çš„è¿æ¥, å»ºè¿è¶…è¿‡å¤šä¹…åˆ™è®¤ä¸ºæ— æ³•å»ºç«‹è¿æ¥, ä»è€Œæ–°é€‰æ‹©å…¶ä»–zk host?</li>
</ol>
</li>
<li>åç¾¿çš„é‡è¿æœºåˆ¶?</li>
<li>curatorçš„é‡è¿æœºåˆ¶?</li>
<li>shuffleæœºåˆ¶!!!</li>
</ol>
</li>
</ol>
<p>org.apache.zookeeper.ClientCnxn.SendThread#onConnected</p>
<p>readTimeout &#x3D; negotiatedSessionTimeout * 2 &#x2F; 3;<br>connectTimeout &#x3D; negotiatedSessionTimeout &#x2F; hostProvider.size();</p>
<p>ä¸ºå•¥åœ¨è¿æ¥å»ºç«‹çš„æœ€å, è¦queueä¸€ä¸ªNoneçš„Event?<br>eventThread.queueEvent(new WatchedEvent(<br>Watcher.Event.EventType.None,<br>eventState, null));</p>
<p>priming-packet å¯åŠ¨packet</p>
<p>WatchedEvent é‡Œä¸¤ä¸ªé‡è¦çš„å±æ€§:</p>
<ol>
<li><p>Watcher.Event.EventType<br>None (-1),<br>NodeCreated (1),<br>NodeDeleted (2),<br>NodeDataChanged (3),<br>NodeChildrenChanged (4);</p>
</li>
<li><p>KeeperState<br>case   -1: return KeeperState.Unknown;<br>case    0: return KeeperState.Disconnected;<br>case    1: return KeeperState.NoSyncConnected;<br>case    3: return KeeperState.SyncConnected;<br>case    4: return KeeperState.AuthFailed;<br>case    5: return KeeperState.ConnectedReadOnly;<br>case    6: return KeeperState.SaslAuthenticated;<br>case -112: return KeeperState.Expired;</p>
</li>
</ol>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>Authæœºåˆ¶&amp;æµç¨‹</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>selectionKeyå…³é”®:</p>
<ol>
<li>å¾€selectoré‡Œæ³¨å†Œäº‹ä»¶, sockKey.interestOps(SelectionKey.OP_READ | SelectionKey.OP_WRITE);<ol>
<li>å¹‚ç­‰çš„. å³å¯ä»¥é‡å¤æ³¨å†Œå¤šæ¬¡.</li>
<li>æŒç»­ç”Ÿæ•ˆçš„: å³åŠ å…¥æ³¨å†Œä¸€æ¬¡ sockKey.interestOps(SelectionKey.OP_READ | SelectionKey.OP_WRITE);<ol>
<li>åç»­ä»»æ„æ—¶åˆ»ç½‘å¡é‡Œæœ‰æ•°æ®å¯è¯», selector.selectedKeys() éƒ½ä¼šè¿”å› SelectionKey, ä¸ä¼šselectä¸€æ¬¡ä¹‹åå°±å…³æ‰è¯¥interestäº†</li>
<li>ä»»æ„æ—¶åˆ»ç½‘å¡å†™é˜Ÿåˆ—å¯å†™, selector.selectedKeys() éƒ½ä¼šè¿”å› SelectionKey, ä¸ä¼šwriteä¸€æ¬¡ä¹‹åå³å…³æ‰äº†</li>
</ol>
</li>
<li>æ‰€ä»¥å½“æ²¡æœ‰æ•°æ®è¦å†™æ—¶, éœ€è¦å»æ‰OP_WRITEçš„interest, å¦åˆ™ä¼šåœ¨SendThreadé‡Œæ­»å¾ªç¯.</li>
</ol>
</li>
<li>å…¶ä»–:<ol>
<li>Selector, Channel, SelectionKey ä¸‰è€…å¯¹è±¡æ˜¯å•¥å…³ç³»?</li>
<li>ä¸‰è€…çš„çº¿ç¨‹å®‰å…¨æƒ…å†µ?</li>
</ol>
</li>
</ol>
<p>&#x2F;&#x2F; TODO: å¾…å®éªŒéªŒè¯</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>ä¸‰ä¸ªé‡è¦çš„QUEUE:</p>
<ol>
<li>outgoingQueue(LinkedList):<ol>
<li>ç”Ÿäº§è€…: å®¢æˆ·çº¿ç¨‹; æ³¨å†Œ&#x2F;æ‰§è¡Œæ“ä½œ, ä¼šå°è£…æˆpacket, æ”¾åˆ°outgoingQueueä¸­.</li>
<li>æ¶ˆè´¹è€…: SendThread; å°†outgoingQueueä¸­packetåºåˆ—åŒ–, æ‰§è¡Œç½‘ç»œIO, å‘é€ç»™zookeeperServer</li>
<li>å…¶ä»–: ç”Ÿäº§è€…å¯ä»¥é€šè¿‡ packet.finished+packet.wait(); é˜»å¡ç­‰å¾…æœåŠ¡ç«¯è¿”å›ç»“æœ</li>
</ol>
</li>
<li>pendingQueue(LinkedList):<ol>
<li>ç”Ÿäº§è€…: SendThread; å½“å°†packetå·²ç»å®Œå…¨å‘é€ç»™æœåŠ¡ç«¯ä¹‹å, ä¼šæŠŠpacketä»outgoingQueueä¸­ç§»é™¤, æ”¾åˆ°pendingQueueä¸­</li>
<li>æ¶ˆè´¹è€…: SendThread; å½“æ”¶åˆ°æœåŠ¡ç«¯çš„reply, æ ¹æ®(xid+ä¸¥æ ¼é¡ºåº)åŒ¹é…åˆ°å¯¹åº”çš„packetä¹‹å, ä¼šæŠŠè¯¥packetä»pendingQueueä¸­ç§»é™¤, åŒæ—¶:</li>
</ol>
</li>
<li>waitingEvents(LinkedBlockingQueue):</li>
</ol>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>SendThread æœºåˆ¶:</p>
<p>ä¸ºæŸä¸ªè·¯å¾„æ³¨å†Œwatcherè¿‡ç¨‹<br>â€” UserThreadå‘èµ·: ç”Ÿæˆpacketå¯¹è±¡</p>
<ol>
<li>UserThread: zk.exists(path,new Watcher() {xxx});</li>
<li>UserThread: å°†{path, watcherå¯¹è±¡} å°è£…æˆpacketæ”¾åˆ° outgoingQueue</li>
<li>UserThread: è°ƒç”¨selector.wakeup(); å¼•å‘SendThreadè§£é™¤é˜»å¡</li>
<li>UserThread: é™·å…¥é˜»å¡, å¾ªç¯ç­‰å¾…packet.finishedå®Œæˆ<br>synchronized (packet) {<br>while (!packet.finished) {<br>packet.wait();<br>}<br>}</li>
</ol>
<p>â€” SendThreadæ³¨å†ŒSelector:</p>
<ol>
<li>SendThread: ä¹‹å‰é˜»å¡åœ¨selector.select(waitTimeOut); ç”±äºä¸Šä¸€æ­¥, UserThreadè°ƒç”¨äº†selector.wakeup(), å¯¼è‡´è§£é™¤é˜»å¡</li>
<li>SendThread: selector.selectedKeys(); ç”±äºæœåŠ¡ç«¯è¿˜æ²¡æœ‰è¿”å›æ•°æ®, å³å®¢æˆ·ç«¯ç¼“å†²åŒºæ— æ•°æ®, æ‰€ä»¥ä¸ºç©º.</li>
<li>SendThread: æ¥ä¸‹æ¥æŸ¥çœ‹outgoingQueueéç©º, å› æ­¤åœ¨Selectoré‡Œæ³¨å†Œ SelectionKey.OP_WRITE äº‹ä»¶ sockKey.interestOps(i | SelectionKey.OP_WRITE);</li>
</ol>
<p>â€” SendThreadæ‰§è¡ŒI&#x2F;O Write: enrich packet.request</p>
<ol>
<li>SendThread: é‡æ–°è¿›å…¥å¾ªç¯, selector.selectedKeys(); ç”±äºæ­¤æ—¶æ“ä½œç³»ç»Ÿå†™ç¼“å†²åŒºreadyForWrite(å³å†™ç¼“å†²åŒºæœªæº¢å‡º), å› æ­¤(k.readyOps() &amp;  SelectionKey.OP_WRITE &#x3D;&#x3D; SelectionKey.OP_WRITE)</li>
<li>SendThread: å°†{path, watcherå¯¹è±¡}åºåˆ—åŒ–, åºåˆ—åŒ–çš„å…³é”®ä¿¡æ¯:<ol>
<li>xid: å¦‚æœpacketé‡Œæ²¡æœ‰, ä¼šåœ¨è¿™ä¸ªæ—¶å€™ä»ClientCnxné‡Œæ‹¿å‡ºæ¥è®¾ç½®ç»™packet<ol>
<li>è¿™é‡Œxidä¸ºper clientçš„, å…¨å±€é€’å¢çš„ID</li>
<li>ä¸sessionIdæ˜¯ä¸åŒçš„.</li>
</ol>
</li>
<li>path:</li>
<li>watch: true&#x2F;false, è®©æœåŠ¡ç«¯çŸ¥é“æ˜¯å¦éœ€è¦watch, å³è¯¥è·¯å¾„æœ‰å˜åŒ–æ—¶, æ˜¯å¦éœ€è¦é€šçŸ¥å¯¹åº”çš„xid</li>
<li>åŒ…å­—èŠ‚é•¿åº¦ int, å ç”¨4ä¸ªå­—èŠ‚: this.bb.putInt(this.bb.capacity() - 4);</li>
</ol>
</li>
<li>SendThread: SocketChannel.write(packet.bb); æ‰§è¡Œç½‘ç»œIO</li>
<li>SendThread: å†™åŒ…å®Œæˆ(å…·ä½“å¤§åŒ…æ‹†è§£è¿‡ç¨‹å‚åŠ ä¸‹è¾¹), å°†packetæ”¾å…¥åˆ°pendingQueueä¸­</li>
</ol>
<p>â€” æœåŠ¡ç«¯æ‰§è¡Œå®Œæˆ, è¿”å›åŒ…ç»™å®¢æˆ·ç«¯, æ•°æ®å·²ç»å†™å…¥å®¢æˆ·ç«¯ç½‘å¡ç¼“å†²åŒº</p>
<p>â€” SendThreadæ‰§è¡ŒI&#x2F;O Read: enrich packet.response</p>
<ol>
<li>SendThread: é‡æ–°è¿›å…¥å¾ªç¯, selector.selectedKeys(); ç”±äºæ­¤æ—¶å®¢æˆ·ç«¯ç½‘å¡è¯»ç¼“å†²åŒºæœ‰æ•°æ®, å› æ­¤(k.readyOps() &amp;  SelectionKey.OP_READ &#x3D;&#x3D; SelectionKey.OP_READ)</li>
<li>SendThread: readResponse()<ol>
<li>ååºåˆ—åŒ–ReplyHeader<ol>
<li>ReplyHeaderé‡è¦å­—æ®µ:<ol>
<li>xid</li>
<li>zxid</li>
</ol>
</li>
<li>ä»pendingQueueä¸­å–å‡ºç¬¬ä¸€ä¸ªpacket</li>
<li>åˆ¤æ–­packet.xid æ˜¯å¦ç­‰äº replyHead.xid</li>
</ol>
</li>
<li>å¦‚æœreplyHeaderåŒ¹é…ä¸Špacket, åˆ™å°†ååºåˆ—åŒ–responseBody; è®¾ç½®ä¸º packet.response; è‡³æ­¤responseè¯»å–å¤„ç†å®Œæ¯•</li>
<li>æ•´ä¸ªpacketå®Œæ•´äº†, æ—¢åŒ…å«äº†requestä¿¡æ¯, åˆåŒ…å«äº†reponseä¿¡æ¯</li>
<li>å…·ä½“å¦‚ä½•å¤„ç†å¤§çš„åŒ…çš„è¯»å–(æ‹†åŒ…é—®é¢˜), åè¾¹è¯¦ç»†ä»‹ç».</li>
</ol>
</li>
<li>SendThread: å¾€Map&lt;String, Set<Watcher>&gt;é‡Œæ³¨å†Œwatcher, keyæ˜¯clientPath<ol>
<li>p.watchRegistration.register(p.replyHeader.getErr());</li>
<li>watches.put(clientPath, watchers);</li>
</ol>
</li>
<li>SendThread: ç”±äºpacketçš„callbackä¸ºnull, å› æ­¤<ol>
<li>p.finished &#x3D; true;</li>
<li>p.notifyAll();</li>
<li>ç»ˆäºåˆ°è¿™é‡Œäº†, UserThreadæ”¶åˆ°notifyAllçš„æ¶ˆæ¯, ä»blockä¸­å”¤é†’.</li>
</ol>
</li>
<li>SendThread: IO Readæµç¨‹ç»“æŸ. é‡æ–°æ–°ä¸€è½®çš„selectæµç¨‹</li>
</ol>
<p>â€” watcheræ€ä¹ˆæ¼äº†? å…·ä½“æ€ä¹ˆwatchçš„å‘¢? å‚è§ä¸‹è¾¹  Watcheræµç¨‹ ç« èŠ‚</p>
<p>(å…·ä½“æ˜¯æ€ä¹ˆæ‰¾åˆ°å†™æ—¶å€™å¯¹åº”çš„packetå‘¢? æ ¹æ®å•¥ä½œä¸ºindex? )</p>
<ul>
<li>æ ¹æ®ä¸¥æ ¼çš„ FIFOé¡ºåº+xid</li>
<li>å³ç¬¬ä¸€ä¸ªå‘å‡ºå»çš„packet, å¿…ç„¶ä¼šç¬¬ä¸€ä¸ªæ”¶åˆ°reply. è¿™é‡Œæœ‰ç‚¹ä¸å¯æ€è®®: å¦‚æœç½‘ç»œåŒ…å»¶æ—¶, å¯¼è‡´åˆ°è¾¾å®¢æˆ·ç«¯çš„æ—¶å€™ä¹±åºæ€ä¹ˆåŠ?</li>
<li>åŒæ—¶æ ¹æ®xidè¿›è¡ŒåŒ¹é…æ ¡éªŒ.</li>
</ul>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>SendThread å¦‚ä½•å¤„ç†å¤§åŒ…å†™é—®é¢˜: (æ‹†åŒ…é—®é¢˜)<br>å…·ä½“ä»£ç åœ¨è¿™é‡Œ: org.apache.zookeeper.ClientCnxnSocketNIO#doIO<br>å¤§è‡´æµç¨‹:</p>
<ol>
<li><p>é¦–å…ˆä»outgoingQueueä¸­è·å–åˆ°packet (æ³¨æ„æ­¤æ—¶ä¸ä¼šæŠŠpacketä»outgoingQuqueä¸­åˆ é™¤)</p>
</li>
<li><p>åºåˆ—åŒ–packet, æ”¾åˆ°packet.bbå­—æ®µä¸­, ä¼šåœ¨å¼€å¤´4ä¸ªå­—èŠ‚è¡¨æ˜åŒ…å†…å®¹é•¿åº¦</p>
</li>
<li><p>socketChannel.write(packet.bb)</p>
</li>
<li><p>åˆ¤æ–­bb.hasRemaining(); å¦‚æœä¸ºtrue, åˆ™è¯´æ˜å•æ¬¡å†™å…¥æ²¡å†™å®Œ.</p>
</li>
<li><p>é‡æ–°å¾€Selectoré‡Œæ³¨å†Œå†™éœ€æ±‚: sockKey.interestOps(i | SelectionKey.OP_WRITE);</p>
</li>
<li><p>å†æ¬¡è¿›å…¥sendThreadå¾ªç¯</p>
</li>
<li><p>ç”±äºä¸Šä¸€æ­¥packetä»ç„¶åœ¨outgoingQueueä¸­æ²¡è¢«åˆ é™¤, å› æ­¤è·å–åˆ°äº†åˆšæ‰çš„packet</p>
</li>
<li><p>ç”±äºå·²ç»åºåˆ—åŒ–è¿‡, å³ packet.bbå­—æ®µéç©º, å› æ­¤ä¸éœ€è¦é‡æ–°åºåˆ—åŒ–.</p>
</li>
<li><p>ç»§ç»­åœ¨ä¹‹å‰çš„bb indexå¤„å¾€åæ‰§è¡Œç½‘ç»œIO: socketChannel.write(packet.bb)</p>
</li>
<li><p>åˆ¤æ–­bb.hasRemaining(); å¦‚æœä¸ºtrue, åˆ™å¾ªç¯ 6~10 æ­¥éª¤</p>
</li>
<li><p>bb.hasRemaining() ä¸ºfalse; åˆ™è¯´æ˜è¯¥åŒ…å†™å®Œæˆ.</p>
</li>
<li><p>å°†è¯¥åŒ…ä»outgoingQueueä¸­åˆ é™¤</p>
</li>
<li><p>å°†è¯¥åŒ…æ”¾åˆ°pendingQueueä¸­</p>
</li>
<li><p>å¦‚æœoutgoingQueueä¸ºç©º, åˆ™ä¸å†æ³¨å†ŒSelectionKey.OP_WRITE äº‹ä»¶</p>
</li>
</ol>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>SendThread å¦‚ä½•å¤„ç†å¤§åŒ…è¯»é—®é¢˜: (é»åŒ…é—®é¢˜)</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>ByteBuffer &amp; SocketChannel çš„åˆå¹¶ç”¨æ³•:<br>ByteBuffer bb &#x3D; xxx;  &#x2F;&#x2F; å‡è®¾1024B<br>SocketChannel.write(bb); &#x2F;&#x2F; è¿™é‡Œå¦‚æœå•æ¬¡åªå†™å‡ºäº†1B, é‚£ä¹ˆæ˜¯å¦ä¼šç§»åŠ¨bbçš„cursor?<br>bb.hasRemaining(); &#x2F;&#x2F; è¿™é‡Œæ˜¯å¦ä¸ºtrue?</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>å¿ƒè·³æœºåˆ¶:</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”</p>
<p>Zkçš„watchæœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„?</p>
<p>ZKWatchManager é‡Œä¸‰ä¸ªé‡è¦çš„watcherMap:<br>dataWatches<br>existWatches: æ‰€æœ‰æ ¡éªŒexistsçš„watcheréƒ½æ”¾åœ¨è¿™é‡Œ, key: clientPath<br>childWatches:<br>defaultWatcher: new ZooKeeper()æ—¶åœ¨æ„é€ æ–¹æ³•é‡Œä¼ å…¥çš„. å¯ä»¥ç”¨æ¥è®¢é˜…zkçŠ¶æ€å˜åŒ–, ä¹Ÿå¯ä»¥è®¢é˜…zk nodeå˜åŒ–</p>
<p>ä½œç”¨åˆ†åˆ«æ˜¯å•¥?<br>å¦‚ä½•å¤„ç†è·¯å¾„çº§è”é—®é¢˜?<br>ä¾‹å¦‚åœ¨&#x2F;rootè·¯å¾„ä¸Šæ³¨å†Œäº†äº‹ä»¶,  åŒæ—¶&#x2F;root&#x2F;dir èŠ‚ç‚¹æ˜¯å­˜åœ¨çš„, åè¾¹å®é™…å¢åŠ äº† &#x2F;root&#x2F;dir&#x2F;a èŠ‚ç‚¹; é‚£ä¹ˆ&#x2F;rootèŠ‚ç‚¹ä¸Šæ³¨å†Œwatcherä¼šæ”¶åˆ°äº‹ä»¶ä¹ˆ?</p>
<ol>
<li>æ‰€æœ‰çš„watcheréƒ½æ˜¯åœ¨EventThreadçº¿ç¨‹é‡Œ, processEvent()æ–¹æ³•é‡Œ, ä¸²è¡Œæ‰§è¡Œçš„.<br>é€šè¿‡LinkedBlockingQueue.take()ä¸€ä¸ªä¸€ä¸ªä¸²è¡Œæ‰§è¡Œ.<br>æ‰€ä»¥éœ€è¦é¿å…åœ¨æ³¨å†Œçš„watcher.processæ–¹æ³•é‡Œæ‰§è¡Œè¿‡é‡çš„æ“ä½œ. å¦åˆ™ä¼šå¯¼è‡´æ•´ä¸ªwatcheræœºåˆ¶å»¶æ—¶.</li>
</ol>
<p>Watcheræµç¨‹</p>
<ol>
<li>SendThread: æœåŠ¡ç«¯nodeæœ‰å˜åŒ–, å‘é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯, å®¢æˆ·ç«¯ç½‘å¡ä¸­æ•°æ®readyForRead, å› æ­¤select()è¿”å›</li>
<li>SendThread: ååºåˆ—åŒ–æ¶ˆæ¯å¤´; æ ¹æ®æ¶ˆæ¯å¤´replyHeader.xid &#x3D;&#x3D; -1 åˆ¤å®šæ˜¯watchEvent, è€Œä¸æ˜¯æ™®é€špacketçš„response.</li>
<li>SendThread: ååºåˆ—åŒ–æ¶ˆæ¯ä½“; WatcherEvent ç»“æ„, é‡è¦å­—æ®µ:<ol>
<li>Path: å³å‘ç”Ÿå˜åŒ–çš„nodeè·¯å¾„</li>
<li>KeeperState: zkçŠ¶æ€å˜åŒ–æƒ…å†µ</li>
<li>EventType: zk nodeå˜åŒ–æƒ…å†µ, ä¾‹å¦‚nodeæ•°æ®æ›´æ–°, noe</li>
</ol>
</li>
<li>SendThread: materialize() æ‰¾åˆ°è¯¥eventå¯¹åº”çš„watcher<ol>
<li>ä»watchRegistrationé‡Œ, æ ¹æ®clientPath, mapé‡Œè·å–åˆ°å¯¹åº”çš„watchers</li>
<li>Removeæ‰è·¯å¾„å¯¹åº”çš„è¿™ä¸ªwatcher</li>
</ol>
</li>
<li>SendThread: æŠŠWatcherSetEventPair{event, watchers} ç»„åˆåŠ åˆ°EventThreadçš„waitingEvents queueä¸­.<br>æ‰€ä»¥å½“æŸä¸ªè·¯å¾„ä¸Šçš„äº‹ä»¶è¿›å…¥åˆ°watcher.processä¹‹å, è¯¥watcherå…¶å®æ˜¯å·²ç»è¢«removeæ‰äº†. å¦‚æœæœ‰æŒç»­watchçš„éœ€æ±‚, è¿˜éœ€è¦é‡æ–°æ³¨å†Œ.</li>
</ol>
<p>EventThreadå¤„ç†æµç¨‹:<br>6. EventThread: æ— é™å¾ªç¯, ä»waitingEventsä¸­takeä¸€ä¸ªEvent<br>7. EventThread: è·å–å¯¹åº”çš„WatcherSetEventPair<br>    1. ä»WatcherSetEventPairä¸­è·å–åˆ°watchers,<br>    2. å¾ªç¯éå†æ‰§è¡Œ, watcher.process(event)</p>
<p>&#x2F;&#x2F; todo: EventThread processEventé‡Œå¦å¤–ä¸€ä¸ªåˆ†æ”¯, Packetç›¸å…³æ˜¯æ€ä¹ˆå‘ç”Ÿ, æ€ä¹ˆå¤„ç†çš„?</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>watcheræœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹æ€§ï¼š</p>
<p>1ã€ä¸€æ¬¡æ€§ï¼šwatchäº‹ä»¶æ˜¯ä¸€æ¬¡æ€§è§¦å‘çš„ï¼Œå¦‚æœæƒ³å†æ¬¡ç›‘æ§æ•°æ®ï¼Œå¿…é¡»é‡æ–°è®¾ç½®ç›‘æ§</p>
<p>2ã€å®¢æˆ·ç«¯ä¸²è¡Œæ‰§è¡Œï¼šå®¢æˆ·ç«¯Watcherå›è°ƒè¿‡ç¨‹æ˜¯ä¸€ä¸ªä¸²è¡ŒåŒæ­¥çš„è¿‡ç¨‹ï¼Œè¿™ä¸ºæˆ‘ä»¬ä¿è¯äº†é¡ºåºã€‚</p>
<p>3ã€è½»é‡çš„ï¼šWatchedEventæ˜¯zkæ•´ä¸ªWatcheré€šçŸ¥æœºåˆ¶çš„æœ€å°é€šçŸ¥å•å…ƒï¼Œåªæœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼šé€šçŸ¥çŠ¶æ€ã€æ—¶é—´ç±»å‹ã€èŠ‚ç‚¹è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Œæ˜¯éœ€è¦å®¢æˆ·ç«¯è‡ªå·±å»æŸ¥è¯¢çš„ã€‚</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>3ã€å¯ä»¥ç”¨existsæ–¹æ³•ï¼šexists(path,true)æ¥æ·»åŠ watchäº‹ä»¶ï¼Œå½“ä¸‹æ¬¡æ“ä½œpathä¼šå‡ºå‘watchäº‹ä»¶</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>    zk.exists(path,true);//ç»™pathæ·»åŠ watchäº‹ä»¶

    zk.writeData(path,&quot;newValue&quot;);//è§¦å‘watchäº‹ä»¶ EventType-&gt;nodeDataChenage



    zk.exists(path,true);//ç»™pathæ·»åŠ watchäº‹ä»¶

    zk.create(path,&quot;newValue&quot;,Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);//è§¦å‘watchäº‹ä»¶ EventType-&gt;nodeCreated



    zk.exists(path,true);//ç»™pathæ·»åŠ watchäº‹ä»¶

    zk.delete(path,-1);//è§¦å‘watchäº‹ä»¶ EventType-&gt;nodeDeleted
</code></pre>
<p>4ã€getChildren(path,neeWatch) &#x2F;&#x2F;ç»™pathæ·»åŠ watchäº‹ä»¶ï¼Œç›‘æ§å­èŠ‚ç‚¹å˜åŒ–</p>
<pre><code>    å¦‚æœpathæ–°å¢æˆ–è€…åˆ é™¤èŠ‚ç‚¹ä¼šè§¦å‘watchäº‹ä»¶ EventType-&gt;nodechildrenChanged
</code></pre>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>å¦‚æœå®¢æˆ·ç«¯å¯åŠ¨å¤šä¸ªzk, new ZooKeeper(), å¯¹è±¡ç»“æ„æ˜¯æ€æ ·çš„? å“ªäº›æ˜¯çº¿ç¨‹å…±ç”¨çš„? å“ªäº›æ˜¯çº¿ç¨‹ç§æœ‰çš„? å“ªäº›æ˜¯çº¿ç¨‹å®‰å…¨çš„?</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”</p>
<p>Etcd ä¸ ZK åŒºåˆ«?</p>
<p>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€”<br>â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” â€” </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>java</tag>
        <tag>nio</tag>
        <tag>zk-client</tag>
        <tag>zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>2022 å¹´åº¦ä¹¦å•</title>
    <url>//2021-12-31-booklist-for-2022/</url>
    <content><![CDATA[<h1 id="BookList"><a href="#BookList" class="headerlink" title="BookList"></a>BookList</h1><hr>
<h2 id="å¿…è¯»"><a href="#å¿…è¯»" class="headerlink" title="å¿…è¯»"></a>å¿…è¯»</h2><ul>
<li><a href="https://book.douban.com/subject/25897245/">Nettyæƒå¨æŒ‡å—</a> -20220315 done</li>
<li><a href="https://book.douban.com/subject/30244461/">è§„æ¨¡ï¼šå¤æ‚ä¸–ç•Œçš„ç®€å•æ³•åˆ™</a> -20220724 done</li>
<li>Google 4ç¯‡è®ºæ–‡å¤ä¹  GFS MapReduce BigTable Dapper</li>
<li><a href="https://book.douban.com/subject/26643785/">æ·±åº¦æ¢ç´¢åµŒå…¥å¼æ“ä½œç³»ç»Ÿï¼šä»é›¶å¼€å§‹è®¾è®¡ã€æ¶æ„å’Œå¼€å‘</a></li>
<li><a href="https://book.douban.com/subject/10750155/">æ•°å­¦ä¹‹ç¾</a> -done</li>
<li><a href="https://book.douban.com/subject/33429491/">æ˜†ä»‘</a> -20221228 done</li>
<li><a href="https://edu.51cto.com/center/course/lesson/index?id=118666">å¼€æºè™šæ‹ŸåŒ–KVMå…¥é—¨ï¼ˆKVMæ¶æ„+KVMåŸºæœ¬ç®¡ç†ï¼‰è§†é¢‘è¯¾ç¨‹</a></li>
<li><a href="https://book.douban.com/subject/25985021/">äººç±»ç®€å²</a> -20220215 done</li>
<li><a href="https://book.douban.com/subject/3998926/">ç³»ç»Ÿåˆ†æå¸ˆè€ƒè¯•å…¨ç¨‹æŒ‡å¯¼</a></li>
<li><a href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E5%B8%88%E6%95%99%E7%A8%8B/8182174">ç³»ç»Ÿåˆ†æå¸ˆæ•™ç¨‹</a></li>
<li><a href="https://book.douban.com/subject/3229243/">Linuxå†…æ ¸å®Œå…¨å‰–æ</a></li>
<li><a href="https://abseil.io/resources/swe_at_google.2.pdf">Software Engineering at Google</a></li>
<li><a href="https://yeasy.gitbook.io/docker_practice/underly/arch">Dockerä»å…¥é—¨åˆ°å®è·µ</a> -20220328 done</li>
<li><a href="http://product.dangdang.com/25336322.html">æ·±åº¦æ€è€ƒï¼š ä¸æ–­é€¼è¿‘é—®é¢˜çš„æœ¬è´¨</a> -20220504 done</li>
<li><a href="https://book.douban.com/subject/26943161/">æœªæ¥ç®€å²</a></li>
<li><a href="https://book.douban.com/subject/30259720/">ä»Šæ—¥ç®€å²</a> -20230131 done</li>
<li><a href="https://book.douban.com/subject/3596861/">ä»äº§å“åˆ°æœåŠ¡:ä¼ä¸šå‘æœåŠ¡ç»æµè½¬å‹æŒ‡å—</a></li>
<li><a href="https://book.douban.com/subject/35424872/">æ·±å…¥å‰–æKubernetes</a> -20220612 done</li>
<li><a href="https://book.douban.com/subject/30348776/">ç­šè·¯è“ç¼•-ä¸–çºªå·¥ç¨‹å†³ç­–å»ºè®¾è®°è¿°</a> -20220820 done</li>
<li><a href="https://book.douban.com/subject/1062991/">åŒ—äº¬æ³•æºå¯º</a> -20220717 done</li>
<li><a href="https://book.douban.com/subject/1322455/">é¥è¿œçš„æ•‘ä¸–ä¸»</a> -20220725 done</li>
<li><a href="https://book.douban.com/subject/1322455/">å¤©å¹•çº¢å°˜</a> -20220806 done</li>
<li><a href="https://book.douban.com/subject/30155731/">ç®—æ³•ä¹‹ç¾</a> -20221206 done</li>
<li><a href="https://book.douban.com/subject/11530329/">30å¤©è‡ªåˆ¶æ“ä½œç³»ç»Ÿ</a></li>
<li><a href="https://book.douban.com/subject/27091064/">äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µâ€”â€”ä»å•ä½“åˆ°æœåŠ¡åŒ–æ¶æ„æ¼”è¿›</a></li>
<li><a href="https://book.douban.com/subject/27032786/">å¤©å±€</a> -20220818 done</li>
<li><a href="https://book.douban.com/subject/1578545/">èƒŒå›</a> -20220821 done</li>
<li><a href="https://book.douban.com/subject/20257955/">ä¸°ä¹³è‚¥è‡€</a> -20220909 done</li>
<li><a href="https://book.douban.com/subject/26745030/">é™Œç”Ÿå¥³äººçš„æ¥ä¿¡</a> -20221022 done </li>
<li><a href="https://book.douban.com/subject/26641288/">1984</a> -20221023 done </li>
<li><a href="https://book.douban.com/subject/35100567/">ä¹åŠ›é©¬æ‰ç½—çš„é›ª</a> -20221024 done </li>
<li><a href="https://book.douban.com/subject/35026475/">å±±æœˆè®°</a> </li>
<li><a href="https://book.douban.com/subject/35669245/">ä¹¾éš†: æ”¿æ²», çˆ±æƒ…ä¸æ€§æ ¼</a> -20221029 done</li>
<li><a href="https://book.douban.com/subject/26768309/">æŸ¥ä»¤åå­—è¡—84å·</a> -20221031 done</li>
<li><a href="https://zhuanlan.zhihu.com/p/479978458">The Basic Principles of Computers for Everyone</a> -20221111 done</li>
<li><a href="https://book.douban.com/subject/35731316/">æ–‡ä»¶ç³»ç»ŸæŠ€æœ¯å†…å¹•</a> <a href="https://www.bilibili.com/video/av889477532/">Bç«™è§†é¢‘</a></li>
</ul>
<h2 id="é€‰è¯»"><a href="#é€‰è¯»" class="headerlink" title="é€‰è¯»"></a>é€‰è¯»</h2><ul>
<li><a href="https://book.douban.com/subject/35922722/">æ·±å…¥ç†è§£Linuxç½‘ç»œï¼š ä¿®ç‚¼åº•å±‚å†…åŠŸï¼ŒæŒæ¡é«˜æ€§èƒ½åŸç†</a></li>
</ul>
<h1 id="ReadList"><a href="#ReadList" class="headerlink" title="ReadList"></a>ReadList</h1><hr>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1587433">æœ‰èµ Bond åˆ†å¸ƒå¼é”</a></li>
<li><a href="https://www.cl.cam.ac.uk/research/srg/netos/camsas/blog/2016-03-09-scheduler-architectures.html">scheduler-architectures</a></li>
<li><a href="https://blog.paessler.com/disabling-icmp-and-snmp-wont-increase-security-but-will-impact-network-monitoring">ICMP</a></li>
<li><a href="https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html">ç¾å›¢çš„Thread Monitoræ–¹æ¡ˆ</a></li>
<li><a href="https://www.infoq.cn/article/xkJNoczVDHARLkKjvDOm">æ·±åº¦æ­ç§˜é˜¿é‡Œäº‘ Serverless Kubernetes</a></li>
<li><a href="https://manybutfinite.com/post/what-does-an-idle-cpu-do/">site for curious people</a></li>
<li><a href="https://plantegg.github.io/2021/07/19/CPU%E6%80%A7%E8%83%BD%E5%92%8CCACHE/">CPUæ€§èƒ½å’ŒCACHE</a></li>
<li><a href="https://www.realworldtech.com/transistor-count-flawed-metric/">Transistor Count: A Flawed Metric</a></li>
</ul>
<h1 id="MovieList"><a href="#MovieList" class="headerlink" title="MovieList"></a>MovieList</h1><hr>
<ul>
<li><a href="https://movie.douban.com/subject/35207856/">äººä¸–é—´</a></li>
<li><a href="https://movie.douban.com/subject/26766214/">é£èµ·é™‡è¥¿</a></li>
<li><a href="https://movie.douban.com/subject/26889177/">å¼‚ç‰©å¿—</a></li>
<li><a href="https://movie.douban.com/subject/2210001/">å¤§æ˜ç‹æœ: 1566</a></li>
<li>Yes, Minister</li>
<li>Yes, Prime Minister</li>
<li><a href="https://movie.douban.com/subject/30314848/">ç¬æ¯å…¨å®‡å®™</a></li>
<li><a href="https://movie.douban.com/subject/35436582/?ivk_sa=1024320u">çˆ±ï¼Œæ­»äº¡å’Œæœºå™¨äºº ç¬¬ä¸‰å­£</a></li>
<li><a href="https://movie.douban.com/subject/26564735/">æ­¦åºšçºª</a></li>
<li><a href="https://movie.douban.com/subject/35231822/">æ¢¦åå½•</a></li>
<li><a href="https://book.douban.com/subject/35494904/">å±±æµ·æƒ…</a></li>
<li><a href="https://book.douban.com/subject/34864748/">å¹³å‡¡å²æœˆ</a></li>
<li><a href="https://movie.douban.com/subject/2347485/">å¤©é“</a></li>
<li><a href="https://movie.douban.com/subject/35118256/">èµ›åšæœ‹å…‹ï¼šè¾¹ç¼˜è¡Œè€…</a></li>
<li><a href="https://movie.douban.com/subject/1424406/">æ˜Ÿé™…ç‰›ä»”</a></li>
<li><a href="https://movie.douban.com/subject/30198955/">è¾¹ç¼˜ä¸–ç•Œ</a></li>
<li><a href="https://movie.douban.com/subject/30285826/">é£éªšå¾‹å¸ˆ-ç¬¬äº”å­£</a></li>
<li><a href="https://movie.douban.com/subject/10748120/">çœŸæ¢-ç¬¬ä¸€å­£</a></li>
<li><a href="https://movie.douban.com/subject/26637615/">çŒé­”äºº-ç¬¬ä¸€å­£ã€ç¬¬äºŒå­£</a></li>
<li><a href="https://movie.douban.com/subject/35314632/?_dtcc=1">é»‘æš—è£è€€</a></li>
<li><a href="https://movie.douban.com/subject/35300122/">å¼¥ç•™ä¹‹å›½çš„çˆ±ä¸½ä¸ç¬¬äºŒå­£</a></li>
<li><a href="https://movie.douban.com/subject/35725021/">ä¸€äººä¹‹ä¸‹ç¬¬äº”å­£</a></li>
</ul>
<h1 id="Games"><a href="#Games" class="headerlink" title="Games"></a>Games</h1><hr>
<ul>
<li><a href="https://zh.wikipedia.org/zh-sg/%E7%91%AA%E5%88%A9%E6%AD%90%E8%88%87%E8%B7%AF%E6%98%93%E5%90%89RPG4_%E5%A4%A2%E5%A2%83%E5%86%92%E9%9A%AA">é©¬åŠ›æ¬§ä¸è·¯æ˜“å‰RPG4 æ¢¦å¢ƒå†’é™©</a></li>
<li><a href="https://www.douban.com/game/25890885/">é€†è½¬è£åˆ¤123</a></li>
<li><a href="https://www.douban.com/game/26382626/">ç«å½±å¿è€…ï¼šç©¶æå¿è€…é£æš´4</a></li>
<li><a href="https://www.douban.com/game/25931998/">èµ›åšæœ‹å…‹2077</a></li>
<li><a href="https://www.douban.com/game/27185974/">å¯¹é©¬å²›ä¹‹é­‚</a></li>
<li><a href="https://www.douban.com/game/10744839/">æš´é›¨</a></li>
</ul>
<h1 id="Certificates"><a href="#Certificates" class="headerlink" title="Certificates"></a>Certificates</h1><hr>
<ul>
<li><a href="https://ke.qq.com/webcourse/index.html#cid=3200525&term_id=103327984&taid=10932152060401165&vid=5285890803968219215">CCNA</a></li>
<li>CKA</li>
<li>IELTS</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>ä¹¦å•</category>
      </categories>
      <tags>
        <tag>books</tag>
        <tag>2022</tag>
      </tags>
  </entry>
  <entry>
    <title>2021 å¹´åº¦æ€»ç»“</title>
    <url>//2021-12-31-summary-for-2021/</url>
    <content><![CDATA[<p>2021å¹´é©¬ä¸Šå°±è¦è¿‡å»äº†, æ˜¯æ—¶å€™å›é¡¾ä¸€å¹´çš„å¾—å¤±, å±•æœ›ä¸‹æœªæ¥äº†:</p>
<h1 id="0x00-å·¥ä½œæ€»ç»“"><a href="#0x00-å·¥ä½œæ€»ç»“" class="headerlink" title="0x00 å·¥ä½œæ€»ç»“"></a>0x00 å·¥ä½œæ€»ç»“</h1><p>ä¸€ä¸ªå­—: â€œç¨³â€</p>
<ul>
<li><p>ç¨³å®šæ€§ä¸Šè¯†åˆ«åˆ°äº†å¾ˆå¤šé£é™©, perf tunning ç­‰, åšçš„è¿˜ä¸é”™. å…¨å¹´æ— æ•…éšœ.<br>ä½†â€ç¨³â€å¦ä¸€æ–¹é¢, ä¹Ÿä»£è¡¨ç€æ²¡æœ‰æƒŠå–œ, æ²¡æœ‰çªç ´. è¿™ä¹Ÿæ˜¯å¾ˆå¤´ç–¼çš„ç‚¹, åªèƒ½å®ˆç€è‡ªå·±çš„ä¸€äº©ä¸‰åˆ†åœ°, æ‰¾ä¸åˆ°çªç ´çš„æ–¹å‘.<br>ä¸ªäººè®¤ä¸ºç“¶é¢ˆå¯èƒ½å¹¶ä¸åœ¨æŠ€æœ¯ä¾§. </p>
</li>
<li><p>ä¸èƒ½å¦„è‡ªè²è–„: å¯¹æ¯”å‹å•†(aws), ç›¸ä¼¼çš„é—®é¢˜å…¶å®ä¹Ÿä¸€ç›´éƒ½å­˜åœ¨, åšçš„å¯èƒ½è¿˜æ²¡æœ‰æˆ‘ä»¬å¥½.</p>
</li>
<li><p>ä½†ä¹Ÿä¸èƒ½å¦„è‡ªå°Šå¤§: æ¯•ç«Ÿè§„æ¨¡æ¯”æˆ‘ä»¬å¤§é‚£ä¹ˆå¤š, ä¸äºŒæ–¹äº§å“èåˆå¾—ä¹Ÿå¾ˆå¥½, ä¸æˆ‘ä»¬ç®€ç›´æ˜¯å¤©å£¤ä¹‹åˆ«.<br>ä¸è¿‡æŠ€æœ¯ä¸Šä¸šåŠ¡ä¸Šç¡®å®æœ‰ä¸€äº›ä¸é”™çš„åˆ›æ–°ç‚¹, ä¸“åˆ©è¦å¼€å§‹ç”³è¯·èµ·æ¥. </p>
</li>
<li><p>é™¤æ­¤ä¹‹å¤–, æŠ€æœ¯ä¸Šä¹Ÿå‘ç°å¹¶è§£å†³äº†ä¸€äº›æœ‰æ„æ€çš„é—®é¢˜. åè¾¹éœ€è¦é™†ç»­æ•´ç†ä¸‹.</p>
</li>
</ul>
<h1 id="0x01-å­¦ä¹ æˆé•¿æ€»ç»“"><a href="#0x01-å­¦ä¹ æˆé•¿æ€»ç»“" class="headerlink" title="0x01 å­¦ä¹ æˆé•¿æ€»ç»“"></a>0x01 å­¦ä¹ æˆé•¿æ€»ç»“</h1><p>ä¸€ä¸ªå­—: â€œæ‚â€,</p>
<ul>
<li>â€œæ‚â€, ç»ä¸æ˜¯ä¸€ä¸ªå¥½è¯. ä»£è¡¨ç€å•¥éƒ½æ„Ÿå…´è¶£, å•¥çŸ¥é“ä¸€ç‚¹å„¿, ä½†å•¥éƒ½ä¸ç²¾é€š. ä»ä¹¦å•é‡Œå°±å¯ä»¥çœ‹å‡ºæ¥.</li>
</ul>
<h2 id="æŠ€æœ¯ä¸Š"><a href="#æŠ€æœ¯ä¸Š" class="headerlink" title="æŠ€æœ¯ä¸Š"></a>æŠ€æœ¯ä¸Š</h2><ul>
<li>è¿™ç‚¹å¯¼è‡´çœŸçš„å¾ˆæ…Œ. æ‹…å¿ƒåè¾¹ä¸€äº‹æ— æˆ. ä¸è¿‡æ‚å½’æ‚, ä¹Ÿè¿˜æ˜¯æ€»ç»“ä¸‹å§: </li>
<li>ç ”ç©¶äº† <a href="https://github.com/DavyJones2010/kubernetes/tree/feature/20210830_code_review">kube-scheduler</a> &amp; vkçš„æºä»£ç ä¸å®ç°åŸç†, åŸºæœ¬ä¹Ÿç®—æ˜¯æŠŠè¿™äº›ä»£ç ç¿»äº†ä¸ªåº•å„¿æœå¤©äº†. <ul>
<li>åŸç†ç ”ç©¶æ–¹é¢: ä½†æ•´ä½“å¯¹k8sçš„å…·ä½“å†…éƒ¨å®ç°ç»†èŠ‚(ç»†èŠ‚å¤ªå¤šå•¦), ä»¥åŠæ‰©å±•æ–¹å¼ç­‰.</li>
<li>åŠ¨æ‰‹å®è·µæ–¹é¢: å¯¹äºk8sæ•´ä½“çš„ä½¿ç”¨è¿ç»´, å®é™…è¿ç»´ç»éªŒå¤ªå°‘.</li>
<li>è¯­è¨€å±‚é¢: å¯¹äºgoä»ç„¶ä¸èƒ½è¯´å¾ˆç†Ÿç»ƒåœ°ä½¿ç”¨, åªèƒ½è¯´èƒ½çœ‹æ‡‚ä»£ç äº†. è¿™ç‚¹ä¹Ÿéœ€è¦åŠ å¼º.</li>
</ul>
</li>
<li>äº†è§£äº†: æ¨¡æ‹Ÿç”µè·¯, æ•°å­—ç”µè·¯, ä»¥åŠåº•å±‚é—¨ç”µè·¯çš„æ„æˆ, é—¨ç”µè·¯å¦‚ä½•æ„æˆåŠ æ³•å™¨. æ„Ÿè°¢ <a href="https://www.bilibili.com/video/BV1wi4y157D3">ELEå®éªŒå®¤</a> æ»¡è¶³äº†è‡ªå·±æå¤§çš„å¥½å¥‡å¿ƒ.</li>
<li>äº†è§£äº†: CPUçš„ç”Ÿäº§, ç°ä»£è®¡ç®—æœºçš„æ¶æ„. çœŸå¿ƒæ„Ÿè°¢ <a href="https://zhuanlan.zhihu.com/p/35786702">è€ç‹¼</a> <ul>
<li>ä»è€Œæ˜ç¡®çŸ¥é“äº†å„ç§cpuçš„å‚æ•°, ä¹ŸåŸºæœ¬èƒ½çœ‹æ‡‚ intel cpu çš„æ¶æ„å›¾äº†</li>
<li>ä»è€Œå¯¹numa nodeæœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†.</li>
<li>ç­‰ç­‰å¾ˆå¤šå¾ˆå¤šçš„ç–‘é—®(ä¾‹å¦‚ä¸ºå•¥ç°åœ¨éƒ½ç”¨ä¸²å£, å¹¶å£é€Ÿåº¦ä¸æ˜¯æ›´å¿«ä¹ˆ? å†…å­˜çš„é€šé“æ˜¯å•¥æ„æ€? å¤šæ ¸æ˜¯å•¥æ„æ€? è¶…çº¿ç¨‹æ˜¯å•¥æ„æ€? ), å¯¹å¾ˆå¤šæŒ‡æ ‡(ä¾‹å¦‚æ™¶ä½“ç®¡æ•°é‡, cachelineå¤§å°, å·¥è‰º)æœ‰äº†å®šé‡çš„è®¤è¯†.</li>
</ul>
</li>
<li>äº†è§£äº†: å„ç§è®¡ç®—æœºæ¥å£å‚æ•°æŒ‡æ ‡, ä»¥åŠæ‚ ä¹…çš„å‘å±•å†å².</li>
<li>ç”±äºå¯¹æ“ä½œç³»ç»Ÿç¡¬ä»¶çš„æ›´æ·±ä¸€å±‚ç†è§£, ä»è€Œæ›´åŠ èƒ½ç†è§£Java NIOçš„ç¼–ç¨‹æ¨¡å‹.</li>
<li>æ·±å…¥ç ”ç©¶äº†zkclientçš„è¿æ¥ä»¥åŠä¼ è¾“æœºåˆ¶.</li>
</ul>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul>
<li>å¯¹å†å²ä¹ŸèŒç”Ÿäº†æå¤§çš„å…´è¶£. å› ä¸ºçœ‹å†å², å°±æ˜¯åœ¨çœ‹ç°åœ¨, å°±æ˜¯åœ¨çœ‹æœªæ¥. <ul>
<li>&lt;æ˜æœé‚£äº›äº‹å„¿&gt; </li>
<li>è¢è…¾é£</li>
<li>&lt;å¤§æ˜ç‹æœ1566&gt;</li>
</ul>
</li>
</ul>
<blockquote>
<p>â€œå¤å¤©è¿‡å®Œäº†ï¼Œå¥½åƒä»€ä¹ˆäº‹ä¹Ÿæ²¡æœ‰åšã€‚â€ ã€€ã€€</p>
<p>â€œæ˜¯å•Šï¼Œæˆ‘ä»¬å°±åªæ˜¯è·‘æ¥è·‘å»ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰åšã€‚â€</p>
<p>-ã€Šè“è‰²å¤§é—¨ã€‹</p>
</blockquote>
<h1 id="0x02-ç”Ÿæ´»æ€»ç»“"><a href="#0x02-ç”Ÿæ´»æ€»ç»“" class="headerlink" title="0x02 ç”Ÿæ´»æ€»ç»“"></a>0x02 ç”Ÿæ´»æ€»ç»“</h1><p>ä¸€ä¸ªå­—: â€œå–œâ€</p>
<ul>
<li>æ„å¤–çš„æƒŠå–œå¾ˆå¤š. </li>
<li>å…¶ä¸€, è€å©†ç»ˆäºæ€€å­•äº†, æƒ³åˆ°å³å°†æ‹¥æœ‰è‡ªå·±çš„baby, å¿ƒé‡Œå°±ä¼šæœ‰ä¸€ç§å–œæ‚¦, ä½†åŒæ—¶ä¹Ÿå¤šäº†ä¸€ä»½è´£ä»»æ„Ÿ. ä¸ºäººçˆ¶, äº¦ä¸ºäººè¡¨. æ—¶åˆ»ç£ä¿ƒæˆ‘å˜æˆæ›´ä¼˜ç§€çš„è‡ªå·±.</li>
<li>å…¶äºŒ, ç»ˆäºæ˜å¹´6æœˆä»½å…¬å¸è¦æ¬åˆ°å®¶é™„è¿‘äº†. ç»ˆäºå¯ä»¥ç»“æŸä¸ºæœŸä¸¤å¹´çš„å‘¨æœ«å¤«å¦»ç”Ÿæ´»äº†, åˆ°æ—¶å€™å­©å­åº”è¯¥ä¹Ÿå¿«è¯ç”Ÿäº†.</li>
</ul>
<h1 id="0x03-æ€»ä½“åæ€-amp-å›é¡¾"><a href="#0x03-æ€»ä½“åæ€-amp-å›é¡¾" class="headerlink" title="0x03 æ€»ä½“åæ€&amp;å›é¡¾"></a>0x03 æ€»ä½“åæ€&amp;å›é¡¾</h1><p>æ€»ä½“æ¥è¯´ä»Šå¹´çš„æ€æƒ³æˆç†Ÿå¾ˆå¤š, å†™ä»£ç åšä¸šåŠ¡ç ”ç©¶æŠ€æœ¯, ä¹Ÿæ›´åŠ æœ‰æ–¹æ³•è®º:  </p>
<ul>
<li>æŠ€æœ¯æ–¹æ¡ˆçš„è®¾è®¡æ›´åŠ å®Œå–„: <ul>
<li>èƒ½å……åˆ†è€ƒè™‘åˆ°é—®é¢˜çš„å¤æ‚æ€§ä¸æ½œåœ¨çš„å‘, ä»¥åŠå¯èƒ½çš„è§£å†³æ–¹æ¡ˆä»¥åŠä¼˜å…ˆçº§. è€Œä¸æ˜¯ä¸€è¿‡æ¥éœ€æ±‚æ²¡è€ƒè™‘åˆ°å°±å¼€å§‹ç¼–ç , ä¸Šçº¿ä¹‹å, å‘ç°å‡ºç°äº†é—®é¢˜è€Œæ‰‹å¿™è„šä¹±åœ°è¿›è¡Œæ‰“è¡¥ä¸ä¿®å¤.</li>
</ul>
</li>
<li>è®¤çŸ¥æå‡: <ul>
<li>å¯¹äºâ€é‡è¦ä½†ä¸ç´§æ€¥â€çš„äº‹æƒ…, æŠ›å¼ƒäº†è¿‡å»æ²¡åŠ¨åŠ›åš, æƒ³ç£¨æ´‹å·¥, é åˆ«äººç»™deadlineçš„æƒ³æ³•. èƒ½å……åˆ†è®¤è¯†åˆ°è¿™äº›äº‹æƒ…çš„é‡è¦æ€§å¿…è¦æ€§. å“ªæ€•æ²¡äººè‚¯å®š, ä½†åªè¦æ˜¯é‡è¦çš„, è¯¥åšçš„è¿˜æ˜¯ä¼šåšæŒåšä¸‹å».</li>
</ul>
</li>
<li>æ›´åŠ ç§¯æä¹è§‚äº†.<ul>
<li>æ›´èƒ½â€â€<br>æœ‰æ—¶å€™åšæŠ€æœ¯è·Ÿä¸šåŠ¡, å°±æ˜¯è¦æœ‰ä¸€ç§åšå®ˆ. </li>
<li>åšæŒç›¸ä¿¡è‡ªå·±åšçš„äº‹æƒ…æ˜¯æœ‰ä»·å€¼çš„, å¹¶èƒ½ç¡®å®åˆ›é€ ä»·å€¼.</li>
<li>ç”¨å‡†ç¡®æ— è¯¯çš„æ•°å­—, è¯´æœé‚£äº›è´¨ç–‘çš„äºº, è¿™äº›äº‹æƒ…çš„ä»·å€¼.</li>
</ul>
</li>
</ul>
<h1 id="0x04-å·¥ä½œè§„åˆ’"><a href="#0x04-å·¥ä½œè§„åˆ’" class="headerlink" title="0x04 å·¥ä½œè§„åˆ’"></a>0x04 å·¥ä½œè§„åˆ’</h1><ul>
<li>æŠŠä»·æ ¼ç­–ç•¥åˆç†è‡ªåŠ¨åˆ¶å®šå®Œæˆ. </li>
<li>ä¸€å®šè¦åœ¨å®¹å™¨è°ƒåº¦å±‚é¢æœ‰æ‰€çªç ´. æ— è®ºæ˜¯å®¢æˆ·ç«¯, è¿˜æ˜¯æœåŠ¡ç«¯.<ul>
<li>æœ¬èº«è‡ªå·±æ˜¯åœ¨åšè°ƒåº¦, æ‰€ä»¥æ·±åˆ»åœ°ç†è§£, è°ƒåº¦æ˜¯æœ‰å¾ˆå¤šäº‹æƒ…è¦è§£å†³çš„. </li>
<li>ç«‹ä¸‹ä¸€ä¸ªflag, æ˜å¹´ä¸€å®šè¦æˆä¸ºkube-schedulerçš„committer!!!</li>
</ul>
</li>
</ul>
<h1 id="0x05-å­¦ä¹ è§„åˆ’"><a href="#0x05-å­¦ä¹ è§„åˆ’" class="headerlink" title="0x05 å­¦ä¹ è§„åˆ’"></a>0x05 å­¦ä¹ è§„åˆ’</h1><p>è¿™é‡Œé™åˆ¶ä¸‹è‡ªå·±æ˜å¹´çš„èŒƒå›´å§, çœå¾—åˆ°æ—¶å€™åˆæ˜¯æ‚ä¹±æ— ç« , ä¸€äº‹æ— æˆ:  </p>
<ul>
<li>å‘ä¸‹é’»ç ”: ä»ç„¶éœ€è¦åœ¨ç¡¬ä»¶å±‚é¢, åœ¨æ“ä½œç³»ç»Ÿåº•å±‚, åœ¨æ±‡ç¼–è¯­è¨€, Cè¯­è¨€å±‚é¢æ·±å…¥äº†è§£å­¦ä¹ . <ul>
<li>ä»¥ä¹¦å•é‡Œ: &lt;æ·±åº¦æ¢ç´¢åµŒå…¥å¼æ“ä½œç³»ç»Ÿï¼šä»é›¶å¼€å§‹è®¾è®¡ã€æ¶æ„å’Œå¼€å‘&gt; ä¸ºç´¢å¼•</li>
</ul>
</li>
<li>ä»¥Java NIOä¸ºå¥‘æœºåŸºç¡€:<ul>
<li>å‘ä¸‹, æŠŠåº•å±‚Cçš„å®ç°, æ“ä½œç³»ç»Ÿå±‚é¢çš„å®ç°ç ”ç©¶ä¸‹.</li>
<li>å‘ä¸Š, æŠŠNettyå†æ·±å…¥ç ”ç©¶ä¸‹å§. å†™å‡ºæ¥ä¸€ä¸ªé«˜æ€§èƒ½nio server&#x2F;client, ç»å¯¹ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ….</li>
<li>å‘ä¸Š, æŠŠAsyncHttpClientä¹Ÿç ”ç©¶ä¸‹å§, æ·±å…¥ç†è§£è¿™é‡Œçš„http connection poolåˆ°åº•æ˜¯å•¥? </li>
<li>å‘ä¸Š, æŠŠCuratorçš„é‡è¿æœºåˆ¶ç ”ç©¶ä¸‹, åŒæ—¶ä¸è‡ªå·±ç›´æ¥é€šè¿‡zkClientåš, ä¼˜ç¼ºç‚¹æ·±å…¥ç ”ç©¶æ¯”è¾ƒä¸‹.</li>
</ul>
</li>
<li>æœ€å¥½åŒæ—¶èƒ½æŠŠsr-iovè¿™äº›è™šæ‹ŸåŒ–æŠ€æœ¯ä¹Ÿç ”ç©¶äº†è§£ä¸‹</li>
</ul>
<h1 id="0x06-ç”Ÿæ´»è§„åˆ’"><a href="#0x06-ç”Ÿæ´»è§„åˆ’" class="headerlink" title="0x06 ç”Ÿæ´»è§„åˆ’"></a>0x06 ç”Ÿæ´»è§„åˆ’</h1><ul>
<li>èŠ±æ›´å¤šæ—¶é—´åœ¨é”»ç‚¼ä¸Š, ä¸è®ºæ˜¯æ¸¸æ³³, åˆ’èˆ¹, è¿˜æ˜¯ä¹’ä¹“çƒ. åŸ¹å…»ä¸€ä¸ªè¿åŠ¨çš„çˆ±å¥½å§.</li>
<li>èº«æç®¡ç†: ä¸€å®šè¦å‡è‚¥, å†ä¹Ÿå¿å—ä¸äº†è‡ªå·±æ²¹è…»çš„æ ·å­äº†. ä»Šå¹´å·²ç»æˆ’æ–­äº†åƒå¤œå®µçš„æ¶ä¹ , æœ‰äº†ä¸€ä¸ªå¥½çš„å¼€å§‹, æ˜å¹´ç»§ç»­åŠ æ²¹, ä½“æ£€ä¸€å®šè¦æœ‰ä¸ªå¥½ç»“æœ!</li>
<li>æ˜¯æ—¶å€™é‡æ‹¾èµ·å‰ä»–äº†.</li>
<li>æ›´åŠ è®¤çœŸåœ°å¯¹å¾…ç”Ÿæ´», åšå®¢é•¿æœŸè®¤çœŸåœ°ç»´æŠ¤èµ·æ¥.</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>å¹´åº¦æ€»ç»“</category>
      </categories>
      <tags>
        <tag>2021</tag>
        <tag>year-in-review</tag>
      </tags>
  </entry>
  <entry>
    <title>Nettyæƒå¨æŒ‡å—ç¬”è®°</title>
    <url>//2022-01-03-netty/</url>
    <content><![CDATA[<h2 id="TCPé»åŒ…æ‹†åŒ…é—®é¢˜"><a href="#TCPé»åŒ…æ‹†åŒ…é—®é¢˜" class="headerlink" title="TCPé»åŒ…æ‹†åŒ…é—®é¢˜"></a>TCPé»åŒ…æ‹†åŒ…é—®é¢˜</h2><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>é»åŒ…:<br>    1. ä¸€æ¬¡ä»ç¼“å†²åŒº, è¯»å–åˆ°äº†å¤šä¸ªå®Œæ•´æ•°æ®åŒ…, éœ€è¦å°†è¿™å‡ ä¸ªæ•°æ®åŒ…åˆ†åˆ«è§£æ.<br>æ‹†åŒ…:<br>    1. ä¸€æ¬¡ä»ç¼“å†²åŒº, è¯»åˆ°äº†ä¸€ä¸ªæ•°æ®åŒ…çš„éƒ¨åˆ†(å¯èƒ½ç”±äºæœåŠ¡ç«¯TCPæ¥æ”¶æ»‘çª—éå¸¸å°), éœ€è¦å¤šæ¬¡è¯»å–æ‰èƒ½æ„å»ºå®Œæ•´çš„æ•°æ®åŒ…<br>é»åŒ…+æ‹†åŒ…:<br>    1. ä¸€æ¬¡ä»ç¼“å†²åŒº, è¯»å–åˆ°ä¸€ä¸ªæ•°æ®åŒ…+å¦ä¸€ä¸ªæ•°æ®åŒ…çš„éƒ¨åˆ†</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ol>
<li>æ¶ˆæ¯å®šé•¿, ä¾‹å¦‚æ¯ä¸ªæŠ¥æ–‡å¤§å°å›ºå®šxxä¸ªå­—èŠ‚, å¦‚æœä¸å¤Ÿ, åˆ™ç”¨ç©ºæ ¼è¡¥å……<ol>
<li>FixedLengthFrameDecoder</li>
</ol>
</li>
<li>åœ¨åŒ…å°¾è®¾å®šåˆ†éš”ç¬¦: ä¾‹å¦‚FTPåè®®ç”¨å›è½¦+æ¢è¡Œåˆ†éš”<ol>
<li>LineBasedFrameDecoder</li>
<li>DelimiterBasedFrameDecoder</li>
</ol>
</li>
<li>æ¶ˆæ¯è®¾ç½®ä¸ºæ¶ˆæ¯å¤´+æ¶ˆæ¯ä½“: æ¶ˆæ¯å¤´ä¸­ç”¨int32å­—æ®µä»£è¡¨æ¶ˆæ¯çš„æ€»é•¿åº¦</li>
<li>æ›´å¤æ‚çš„åº”ç”¨å±‚åè®®</li>
</ol>
<h3 id="LineBasedFrameDecoderåŸç†"><a href="#LineBasedFrameDecoderåŸç†" class="headerlink" title="LineBasedFrameDecoderåŸç†"></a>LineBasedFrameDecoderåŸç†</h3><p>&#x2F;&#x2F; todo</p>
<h2 id="Nettyç¼–è§£ç "><a href="#Nettyç¼–è§£ç " class="headerlink" title="Nettyç¼–è§£ç "></a>Nettyç¼–è§£ç </h2><h3 id="ç°æœ‰åºåˆ—åŒ–æ–¹æ¡ˆ"><a href="#ç°æœ‰åºåˆ—åŒ–æ–¹æ¡ˆ" class="headerlink" title="ç°æœ‰åºåˆ—åŒ–æ–¹æ¡ˆ"></a>ç°æœ‰åºåˆ—åŒ–æ–¹æ¡ˆ</h3><h4 id="Javaé»˜è®¤åºåˆ—åŒ–"><a href="#Javaé»˜è®¤åºåˆ—åŒ–" class="headerlink" title="Javaé»˜è®¤åºåˆ—åŒ–"></a>Javaé»˜è®¤åºåˆ—åŒ–</h4><p>ç¼ºç‚¹:</p>
<ul>
<li>æ— æ³•è·¨è¯­è¨€</li>
<li>åºåˆ—åŒ–åç æµå¤ªå¤§</li>
<li>åºåˆ—åŒ–æ€§èƒ½å¤ªå·®<br>å‡ ä¹æ²¡æœ‰ä¸»æµçš„RPCé‡‡ç”¨</li>
</ul>
<h4 id="Protobuf"><a href="#Protobuf" class="headerlink" title="Protobuf"></a>Protobuf</h4><ul>
<li>è¯­è¨€æ— å…³, å¹³å°æ— å…³, æ‰©å±•æ€§å¥½</li>
<li>æ€§èƒ½å¥½</li>
</ul>
<h4 id="XML-x2F-Json"><a href="#XML-x2F-Json" class="headerlink" title="XML&#x2F;Json"></a>XML&#x2F;Json</h4><p>è§£ææ—¶é—´å¼€é”€, ç©ºé—´å¼€é”€éƒ½å¤ªå¤§; ä¸é€‚åˆåšé«˜æ€§èƒ½çš„é€šä¿¡åè®®</p>
<h3 id="Nettyä¸­å¯¹Javaåºåˆ—åŒ–æ”¯æŒ"><a href="#Nettyä¸­å¯¹Javaåºåˆ—åŒ–æ”¯æŒ" class="headerlink" title="Nettyä¸­å¯¹Javaåºåˆ—åŒ–æ”¯æŒ"></a>Nettyä¸­å¯¹Javaåºåˆ—åŒ–æ”¯æŒ</h3><p>ObjectEncoder<br>ObjectDecoder</p>
<h3 id="Nettyä¸­å¯¹Protobufåºåˆ—åŒ–æ”¯æŒ"><a href="#Nettyä¸­å¯¹Protobufåºåˆ—åŒ–æ”¯æŒ" class="headerlink" title="Nettyä¸­å¯¹Protobufåºåˆ—åŒ–æ”¯æŒ"></a>Nettyä¸­å¯¹Protobufåºåˆ—åŒ–æ”¯æŒ</h3><p>ProtobufVarint32FrameDecoder: ç”¨äºåŠåŒ…å¤„ç†<br>ProtobufDecoder: ä»…è´Ÿè´£è§£ç , ä¸æ”¯æŒè¯»åŠåŒ…, å› æ­¤éœ€è¦ä½¿ç”¨: ProtobufVarint32FrameDecoder<br>ProtobufVarint32LengthFieldPrepender<br>ProtobufEncoder</p>
<h2 id="Netty-HTTPåè®®å¼€å‘"><a href="#Netty-HTTPåè®®å¼€å‘" class="headerlink" title="Netty HTTPåè®®å¼€å‘"></a>Netty HTTPåè®®å¼€å‘</h2><h3 id="é“¾è·¯å…³é—­åœºæ™¯"><a href="#é“¾è·¯å…³é—­åœºæ™¯" class="headerlink" title="é“¾è·¯å…³é—­åœºæ™¯"></a>é“¾è·¯å…³é—­åœºæ™¯</h3><ul>
<li>å¯¹æ–¹å®•æœºæˆ–è€…é‡å¯, ä¼šä¸»åŠ¨å…³é—­é“¾è·¯:<ul>
<li>å¦ä¸€æ–¹ä¼šè¯»å–åˆ°æ“ä½œç³»ç»Ÿå±‚çš„é€šçŸ¥ä¿¡å·, å¾—çŸ¥å¯¹æ–¹RESTé“¾è·¯, éœ€è¦å…³é—­è¿æ¥, é‡Šæ”¾è‡ªèº«çš„å¥æŸ„èµ„æº.</li>
<li>æ˜¯å¦æœ‰ä¸»åŠ¨åœæœº, ä¼˜é›…å…³é—­ ç±»ä¼¼ kill -3 ?</li>
</ul>
</li>
<li>æ¶ˆæ¯è¯»å†™è¿‡ç¨‹, å‘ç”Ÿäº†IOå¼‚å¸¸, éœ€è¦ä¸»åŠ¨å…³é—­</li>
<li>å¿ƒè·³è¯»å†™è¿‡ç¨‹, å‘ç”Ÿäº†IOå¼‚å¸¸, éœ€è¦ä¸»åŠ¨å…³é—­</li>
<li>å¿ƒè·³è¶…æ—¶, éœ€è¦ä¸»åŠ¨å…³é—­</li>
<li>ç¼–è§£ç ç­‰ä¸å¯æ¢å¤é”™è¯¯æ—¶, éœ€è¦ä¸»åŠ¨å…³é—­</li>
</ul>
<h3 id="å¯é æ€§è®¾è®¡"><a href="#å¯é æ€§è®¾è®¡" class="headerlink" title="å¯é æ€§è®¾è®¡"></a>å¯é æ€§è®¾è®¡</h3><h4 id="å¿ƒè·³æœºåˆ¶"><a href="#å¿ƒè·³æœºåˆ¶" class="headerlink" title="å¿ƒè·³æœºåˆ¶"></a>å¿ƒè·³æœºåˆ¶</h4><ul>
<li><p>ç½‘ç»œç©ºé—²æŒç»­æ—¶é—´è¾¾åˆ°T(è¿ç»­å‘¨æœŸTæ²¡æœ‰è¯»å†™æ¶ˆæ¯)æ—¶, å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€Pingå¿ƒè·³ç»™æœåŠ¡ç«¯(è¿™ä¸ªä¸zkClientæœºåˆ¶å¾ˆç›¸ä¼¼)</p>
</li>
<li><p>å¦‚æœåœ¨ä¸‹ä¸€ä¸ªå‘¨æœŸTåˆ°æ¥æ—¶, å®¢æˆ·ç«¯æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹å‘é€çš„Pongå¿ƒè·³åº”ç­”æ¶ˆæ¯, æˆ–è€…è¯»å–åˆ°æœåŠ¡ç«¯å‘é€çš„å…¶ä»–ä¸šåŠ¡æ¶ˆæ¯, åˆ™å¿ƒè·³å¤±è´¥è®¡æ•°å™¨+1</p>
</li>
<li><p>æ¯å½“å®¢æˆ·ç«¯æ¥å—åˆ°æœåŠ¡ç«¯çš„ä¸šåŠ¡æ¶ˆæ¯æˆ–è€…Pongåº”ç­”æ¶ˆæ¯, åˆ™å°†å¿ƒè·³å¤±è´¥è®¡æ•°å™¨æ¸…é›¶.</p>
</li>
<li><p>å½“è¿ç»­Næ¬¡æ²¡æœ‰æ¥å—åˆ°æœåŠ¡ç«¯çš„Pongæ¶ˆæ¯æˆ–è€…ä¸šåŠ¡æ¶ˆæ¯, åˆ™ä¸»åŠ¨å…³é—­é“¾è·¯. é—´éš”INTERVALä¹‹å, å‘èµ·é‡è¿æ“ä½œ.</p>
</li>
<li><p>æœåŠ¡ç«¯ç½‘ç»œç©ºé—²æŒç»­æ—¶é—´è¾¾åˆ°Tå, æœåŠ¡ç«¯å¿ƒè·³å¤±è´¥è®¡æ•°å™¨+1; åªè¦æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„Pingæ¶ˆæ¯æˆ–è€…å…¶ä»–ä¸šåŠ¡æ¶ˆæ¯, è®¡æ•°å™¨æ¸…é›¶</p>
</li>
<li><p>æœåŠ¡ç«¯è¿ç»­Næ¬¡æ²¡æœ‰æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„Pingæ¶ˆæ¯æˆ–è€…å…¶ä»–ä¸šåŠ¡æ¶ˆæ¯, åˆ™å…³é—­é“¾è·¯, é‡Šæ”¾èµ„æº, ç­‰å¾…å®¢æˆ·ç«¯é‡è¿(è¿™ç‚¹ä¸å®¢æˆ·ç«¯æœºåˆ¶ä¸åŒ).</p>
</li>
<li><p>éœ€è¦é˜²æ­¢: ç”±äºä¸€æ–¹çŸ­æ—¶é—´å†…ç¹å¿™æ²¡æœ‰åŠæ—¶è¿”å›åº”ç­”æ¶ˆæ¯å¯¼è‡´çš„è¯¯åˆ¤, æ‰€ä»¥éœ€è¦è¿ç»­Nä¸ªå¿ƒè·³æ£€æµ‹éƒ½å¤±è´¥, æ‰èƒ½è®¤å®šé“¾è·¯å·²ç»æ–­è¿, éœ€è¦å…³é—­å¹¶é‡å»º.</p>
</li>
<li><p>å¦‚æœè¯»å†™å¿ƒè·³å‘ç”ŸIOå¼‚å¸¸, è¯´æ˜é“¾è·¯å·²ç»ä¸­æ–­, æ­¤æ—¶å°±ç«‹åˆ»å…³é—­é“¾è·¯:</p>
<ul>
<li>å¦‚æœå®¢æˆ·ç«¯, åˆ™éœ€è¦é‡æ–°å‘èµ·è¿æ¥.</li>
<li>å¦‚æœæ˜¯æœåŠ¡ç«¯, åˆ™éœ€è¦æ¸…ç©ºç¼“å­˜çš„åŠåŒ…ä¿¡æ¯, ç­‰å¾…å®¢æˆ·ç«¯é‡è¿.</li>
</ul>
</li>
</ul>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å¦‚ä¸‹ä»£è¡¨å•¥æ„æ€:</span>
<span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>lenght<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ ¹æ®æ“ä½œç³»ç»Ÿè·å–æ¢è¡Œç¬¦, ä¾‹å¦‚Linuxä¸‹æ˜¯\n, Windowsä¸‹æ˜¯\r\n(\rå›è½¦, å³æŠŠæ‰“å­—æœºé’ˆå¤´æ”¾åˆ°è¡Œé¦–; \næ¢è¡Œ, å³æŠŠçº¸å‘ä¸‹ç§»åŠ¨ä¸€è¡Œ), Macä¸‹æ˜¯\r</span>
<span class="token comment">// Unix/Macç³»ç»Ÿä¸‹çš„æ–‡ä»¶åœ¨Windowsé‡Œæ‰“å¼€çš„è¯ï¼Œæ‰€æœ‰æ–‡å­—ä¼šå˜æˆä¸€è¡Œ; </span>
<span class="token comment">// è€ŒWindowsé‡Œçš„æ–‡ä»¶åœ¨Unix/Macä¸‹æ‰“å¼€çš„è¯ï¼Œåœ¨æ¯è¡Œçš„ç»“å°¾å¯èƒ½ä¼šå¤šå‡ºä¸€ä¸ª^Mç¬¦å·</span>
<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"line.separator"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="Javaåº”ç”¨ä¸­å¸¸ç”¨4ç§è·¨èŠ‚ç‚¹é€šä¿¡æ–¹æ¡ˆ"><a href="#Javaåº”ç”¨ä¸­å¸¸ç”¨4ç§è·¨èŠ‚ç‚¹é€šä¿¡æ–¹æ¡ˆ" class="headerlink" title="Javaåº”ç”¨ä¸­å¸¸ç”¨4ç§è·¨èŠ‚ç‚¹é€šä¿¡æ–¹æ¡ˆ"></a>Javaåº”ç”¨ä¸­å¸¸ç”¨4ç§è·¨èŠ‚ç‚¹é€šä¿¡æ–¹æ¡ˆ</h2><ul>
<li>RMI</li>
<li>Socket + Javaåºåˆ—åŒ–</li>
<li>å¼€æºRPCæ¡†æ¶, dubbo, thrift, avro</li>
<li>å…¬æœ‰åè®®: HTTP+XML, RESTful + JSON æˆ–è€… WebService</li>
</ul>
<h2 id="Javaè·¨èŠ‚ç‚¹é€šä¿¡ç§æœ‰åè®®"><a href="#Javaè·¨èŠ‚ç‚¹é€šä¿¡ç§æœ‰åè®®" class="headerlink" title="Javaè·¨èŠ‚ç‚¹é€šä¿¡ç§æœ‰åè®®"></a>Javaè·¨èŠ‚ç‚¹é€šä¿¡ç§æœ‰åè®®</h2><ul>
<li>è¯·æ±‚å“åº”æ¶ˆæ¯ç¼–è§£ç å®šä¹‰</li>
<li>æ§åˆ¶å’Œç®¡ç†ç±»æŒ‡ä»¤<ul>
<li>é“¾è·¯å»ºç«‹çš„æ¡æ‰‹è¯·æ±‚å’Œå“åº”æ¶ˆæ¯</li>
<li>é“¾è·¯æ£€æµ‹çš„å¿ƒè·³æ¶ˆæ¯</li>
</ul>
</li>
</ul>
<h2 id="UpStream-amp-DownStreamçš„ç†è§£"><a href="#UpStream-amp-DownStreamçš„ç†è§£" class="headerlink" title="UpStream&amp;DownStreamçš„ç†è§£"></a>UpStream&amp;DownStreamçš„ç†è§£</h2><ul>
<li><a href="https://blog.csdn.net/hills/article/details/46766665">å¯¹NettyæœåŠ¡ç«¯çš„ UpStreamå’ŒDownStreamçš„æµ…è¯†</a></li>
<li><a href="https://stackoverflow.com/questions/9374284/how-does-upstream-and-downstream-handlers-work-in-netty">9374284&#x2F;how-does-upstream-and-downstream-handlers-work-in-netty</a></li>
</ul>
<ul>
<li>UpStreamHandler, å³æ¶ˆæ¯æ˜¯ä»TCP&#x2F;IPåè®®æ ˆçš„ä¸‹å±‚å¾€ä¸Šå±‚ä¼ è¾“, å³ä» ç‰©ç†å±‚(ç½‘å¡) -&gt; ä¼ è¾“å±‚(TCP) -&gt; åº”ç”¨å±‚(Nettyä»£ç å¤„ç†), å³Inbound</li>
<li>DownStreamHandler, å³æ¶ˆæ¯æ˜¯ä»TCP&#x2F;IPåè®®æ ˆçš„ä¸Šå±‚å¾€ä¸‹å±‚ä¼ è¾“, å³ä» åº”ç”¨å±‚(Nettyä»£ç å¤„ç†) -&gt; ä¼ è¾“å±‚(TCP) -&gt; ç‰©ç†å±‚(ç½‘å¡), å³Outbound</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071208885.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071206397.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071207489.png"></p>
<h2 id="ChannelHandlerçº¿ç¨‹å®‰å…¨çš„ç†è§£"><a href="#ChannelHandlerçº¿ç¨‹å®‰å…¨çš„ç†è§£" class="headerlink" title="ChannelHandlerçº¿ç¨‹å®‰å…¨çš„ç†è§£"></a>ChannelHandlerçº¿ç¨‹å®‰å…¨çš„ç†è§£</h2><ul>
<li><a href="https://netty.io/3.8/guide/#architecture.8.5">Do I need to synchronize my handler code given that events can happen at the same time?</a></li>
</ul>
<p>å‰æ: OneHandler per Channel</p>
<ul>
<li>UpStreamHandleræ˜¯ä¸å¿…æ‹…å¿ƒçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜çš„:<ul>
<li>å•ä¸ªTimeServerHandlerå†…éƒ¨, ä¸å¿…æ‹…å¿ƒi++å…±äº«å¯¼è‡´çš„é—®é¢˜. </li>
<li>ä¸¤ä¸ªTimeServerHandlerä¼šä¸²è¡Œæ‰§è¡Œ.</li>
</ul>
</li>
</ul>
<blockquote>
<p>ChannelUpstreamHandler will be invoked sequentially by the same thread</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// socketChannel.pipeline().addLast(new TimeServerHandler()).addLast(new TimeServerHandler());</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">TimeServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">channelActive</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>- </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>books</tag>
        <tag>2022</tag>
        <tag>Netty</tag>
        <tag>Java</tag>
        <tag>Nio</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡ç”±äºä½¿ç”¨jetty-monitorå¯¼è‡´çš„å†…å­˜æ³„éœ²é—®é¢˜</title>
    <url>//2022-01-31-jetty-monitor-oom-bug/</url>
    <content><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>jetty-monitor</tag>
        <tag>jetty oom</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡Mavenä¼ é€’ä¾èµ–å¤±æ•ˆé—®é¢˜æ’æŸ¥</title>
    <url>//2022-02-01-maven-deps-failure/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨test-scheduleré¡¹ç›®ä¸­, ä»£ç æŒ‰ç…§mavenæ¨¡å—(module)ç»„ç»‡, å¦‚ä¸‹:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">- test-scheduler
---- shared-common
---- resource-manage
---- persistence<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­<br>resource-manageæ¨¡å—åœ¨pomä¸­ä¾èµ–äº†shared-commonæ¨¡å—</p>
<h1 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h1><h2 id="é”™è¯¯ä¿¡æ¯æ˜¯æ€æ ·çš„"><a href="#é”™è¯¯ä¿¡æ¯æ˜¯æ€æ ·çš„" class="headerlink" title="é”™è¯¯ä¿¡æ¯æ˜¯æ€æ ·çš„?"></a>é”™è¯¯ä¿¡æ¯æ˜¯æ€æ ·çš„?</h2><p>åœ¨è¿è¡Œresource-manageæ¨¡å—çš„utæ—¶, æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NoClassDefFoundError</span><span class="token operator">:</span> com<span class="token operator">/</span>xxx<span class="token operator">/</span>xxx<span class="token operator">/</span>manager<span class="token operator">/</span><span class="token class-name">ManagerListener</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>MetaPushConsumer</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">MetaPushConsumer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">338</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span></span>CommonMetaPushConsumer</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">CommonMetaPushConsumer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">NativeMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">invokeCustomInitMethod</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1930</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">invokeInitMethods</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1872</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">initializeBean</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1800</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">42</span> more
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassNotFoundException</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>manager<span class="token punctuation">.</span></span>ManagerListener</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URLClassLoader</span><span class="token punctuation">.</span><span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">URLClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">382</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">418</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Launcher</span>$<span class="token class-name">AppClassLoader</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">Launcher</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">355</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">351</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">51</span> more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ä¸¢å¤±çš„ç±»æ˜¯åœ¨å“ªé‡Œçš„"><a href="#ä¸¢å¤±çš„ç±»æ˜¯åœ¨å“ªé‡Œçš„" class="headerlink" title="ä¸¢å¤±çš„ç±»æ˜¯åœ¨å“ªé‡Œçš„?"></a>ä¸¢å¤±çš„ç±»æ˜¯åœ¨å“ªé‡Œçš„?</h2><p>ç»åˆ†æ, com.xxx.xxx.manager.ManagerListener ç±»æ˜¯åœ¨å¦‚ä¸‹GAVä¸­å¼•å…¥:<br><dependency><br><groupId>com.xxx.xxx</groupId><br><artifactId>diamond-client</artifactId><br><version>3.9.2</version><br></dependency></p>
<h2 id="ç†è®ºä¸Šä¼ é€’ä¾èµ–æ˜¯æ€æ ·çš„"><a href="#ç†è®ºä¸Šä¼ é€’ä¾èµ–æ˜¯æ€æ ·çš„" class="headerlink" title="ç†è®ºä¸Šä¼ é€’ä¾èµ–æ˜¯æ€æ ·çš„?"></a>ç†è®ºä¸Šä¼ é€’ä¾èµ–æ˜¯æ€æ ·çš„?</h2><p>ç»åˆ†æ, diamond-client æ˜¯ç”± shared-common æ¨¡å—ç›´æ¥ä¾èµ–çš„.<br>ç”±äºmavenæœ‰ä¼ é€’ä¾èµ–çš„ç‰¹æ€§, å› æ­¤ä¾èµ–å›¾å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">resource-manage --ä¾èµ–--&gt; shared-common --ä¾èµ–--&gt; diamond-client<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å› æ­¤resource-manageåº”è¯¥ä¾èµ–åˆ°äº†diamond-client, ä½†å®é™…åœ¨intellijé‡ŒæŸ¥çœ‹ä¾èµ–å›¾, å‘ç°å¹¶æ²¡æœ‰ä¼ é€’ä¾èµ–è¿›æ¥!</p>
<h2 id="ä¸ºä»€ä¹ˆä¼ é€’ä¾èµ–æ²¡æœ‰ç”Ÿæ•ˆ"><a href="#ä¸ºä»€ä¹ˆä¼ é€’ä¾èµ–æ²¡æœ‰ç”Ÿæ•ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼ é€’ä¾èµ–æ²¡æœ‰ç”Ÿæ•ˆ?"></a>ä¸ºä»€ä¹ˆä¼ é€’ä¾èµ–æ²¡æœ‰ç”Ÿæ•ˆ?</h2><p>ç»åˆ†æå‘ç°, åœ¨ test-scheduler çš„pomé‡Œ, å¯¹ shared-common çš„ä¾èµ–è¿›è¡Œäº†è£å‰ª, å°† diamond-client exclude å‡ºå»äº†.</p>
<p>è€Œ resource-manage ç­‰æ¨¡å—, éƒ½æ˜¯ç»§æ‰¿äº† test-scheduler çš„çˆ¶pom. å› æ­¤resource-manangeå£°æ˜ä¾èµ–äº†å…¨é‡çš„ shared-common æ¨¡å—å¦‚ä¸‹:</p>
<p>ä½†å®é™…ç”Ÿæ•ˆçš„ä»æ˜¯ test-scheduler pomä¸­å£°æ˜çš„ shared-common ä¾èµ–, å³æ’é™¤æ‰äº† diamond-client ä¾èµ–.</p>
<h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p>è‡³æ­¤è§£å†³é—®é¢˜å°±å¾ˆç®€å•äº†. åœ¨ test-scheduler çš„pomä¸­, å¯¹ shared-common ä¾èµ–çš„å£°æ˜, åˆ é™¤æ‰å¦‚ä¸‹ç‰‡æ®µå³å¯:<br><exclusion><br><artifactId>diamond-client</artifactId><br><groupId>com.xxx.diamond</groupId><br></exclusion><br>è¿™æ ·å°±è§£å†³é—®é¢˜äº†</p>
<h1 id="æ‰©å±•ç ”ç©¶"><a href="#æ‰©å±•ç ”ç©¶" class="headerlink" title="æ‰©å±•ç ”ç©¶"></a>æ‰©å±•ç ”ç©¶</h1><h2 id="ä¼ é€’ä¾èµ–å¤±æ•ˆçš„å…¶ä»–åœºæ™¯"><a href="#ä¼ é€’ä¾èµ–å¤±æ•ˆçš„å…¶ä»–åœºæ™¯" class="headerlink" title="ä¼ é€’ä¾èµ–å¤±æ•ˆçš„å…¶ä»–åœºæ™¯"></a>ä¼ é€’ä¾èµ–å¤±æ•ˆçš„å…¶ä»–åœºæ™¯</h2><h3 id="scopeé—®é¢˜"><a href="#scopeé—®é¢˜" class="headerlink" title="scopeé—®é¢˜"></a>scopeé—®é¢˜</h3><ol>
<li>ç”±äºæœ¬é—®é¢˜ä¸­æ˜¯åœ¨UTè¿è¡Œæ—¶å‘ç”Ÿçš„CNFE(ClassNotFoundException), å› æ­¤åŸºæœ¬å¯ä»¥æ’é™¤ç”±äºscopeçš„åŸå› . </li>
<li>ä½†å¦‚æœæ˜¯åœ¨è¿è¡Œæ—¶å‘ç”Ÿäº†CNFE, åˆ™éœ€è¦çœ‹ä¸‹æ˜¯å¦ä½¿ç”¨äº†<scope>test&#x2F;provided&#x2F;system</scope>ç­‰æ ‡ç­¾</li>
</ol>
<h3 id="optionalé—®é¢˜"><a href="#optionalé—®é¢˜" class="headerlink" title="optionalé—®é¢˜"></a>optionalé—®é¢˜</h3><ul>
<li><p>å¦‚æœoptionalä¸ºfalse, åˆ™ä»£è¡¨å¼•ç”¨è¯¥pomçš„é¡¹ç›®, ä¸ä¼šé—´æ¥ä¾èµ–åˆ°è¯¥GAV</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>net.biancheng.www<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>X<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!--è®¾ç½®å¯é€‰ä¾èµ–  --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>å…³äº optional å…ƒç´ åŠå¯é€‰ä¾èµ–è¯´æ˜å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<ol>
<li>å¯é€‰ä¾èµ–ç”¨æ¥æ§åˆ¶å½“å‰ä¾èµ–æ˜¯å¦å‘ä¸‹ä¼ é€’æˆä¸ºé—´æ¥ä¾èµ–ï¼›</li>
<li>optional é»˜è®¤å€¼ä¸º falseï¼Œè¡¨ç¤ºå¯ä»¥å‘ä¸‹ä¼ é€’ç§°ä¸ºé—´æ¥ä¾èµ–ï¼›</li>
<li>è‹¥ optional å…ƒç´ å–å€¼ä¸º trueï¼Œåˆ™è¡¨ç¤ºå½“å‰ä¾èµ–ä¸èƒ½å‘ä¸‹ä¼ é€’æˆä¸ºé—´æ¥ä¾èµ–ã€‚</li>
<li>ä»…é€‚ç”¨äº é¡¹ç›®çš„å•çº¯ä¾èµ–å…³ç³»ï¼Œä¸é€‚åˆ çˆ¶å­å·¥ç¨‹ã€‚å‡è®¾Aå·¥ç¨‹æ˜¯ parentï¼Œé‚£ä¹ˆAå·¥ç¨‹å³ä¾¿åŠ ä¸Šäº† optinalï¼Œå­é¡¹ç›®ä¹Ÿå°†ç»§æ‰¿çˆ¶å·¥ç¨‹çš„æ‰€æœ‰ä¾èµ–å…³ç³»ã€‚</li>
</ol>
<ul>
<li>åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹, ä¼šæŠŠ<optional>true</optional>è®¾ç½®ä¸ºtrue?<br>å‡è®¾ä¸€ä¸ªå…³äºæ•°æ®åº“æŒä¹…åŒ–çš„é¡¹ç›®(Project C), ä¸ºäº†é€‚é…æ›´å¤šç±»å‹çš„æ•°æ®åº“æŒä¹…åŒ–è®¾è®¡ï¼Œæ¯”å¦‚ Mysql æŒä¹…åŒ–è®¾è®¡(Project A) å’Œ Oracle æŒä¹…åŒ–è®¾è®¡(Project B)ï¼Œ</li>
<li>å½“æˆ‘ä»¬çš„é¡¹ç›®(Project D) è¦ç”¨çš„ Project C çš„æŒä¹…åŒ–è®¾è®¡ï¼Œä¸å¯èƒ½æ—¢å¼•å…¥ mysql é©±åŠ¨åˆå¼•å…¥ oracle é©±åŠ¨å§ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ˜¾å¼æŒ‡å®šä¸€ä¸ªï¼Œå°±æ˜¯è¿™ä¸ªé“ç†äº†</li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.cnblogs.com/cy0628/p/15034450.html#:~:text=Maven%20%E7%9A%84%E4%BE%9D%E8%B5%96%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6,%E4%B8%8A%E7%AE%80%E5%8C%96POM%20%E7%9A%84%E9%85%8D%E7%BD%AE%E3%80%82">Mavenä¾èµ–ä¼ é€’,æ’é™¤ä¾èµ–å’Œå¯é€‰ä¾èµ–</a></li>
<li><a href="https://juejin.cn/post/6844903987322290189">Maven optionalå…³é”®å­—é€å½»å›¾è§£</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>maven</tag>
        <tag>transitive dependency</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot+Mavenå¤šæ¨¡å—é¡¹ç›®æµ‹è¯•æœ€ä½³å®è·µ</title>
    <url>//2022-02-13-maven-multi-module-test/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>é¡¹ç›®ä¸­ä¸ºäº†æ•´ä½“ä»£ç çš„é«˜å†…èšä¸å¯ç§»æ¤æ€§, æŒ‰ç…§maven-moduleçš„æ–¹å¼å¯¹ä»£ç è¿›è¡Œäº†æ‹†åˆ†, æ ·ä¾‹å¦‚ä¸‹: </p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> root<span class="token punctuation">-</span>module
  <span class="token punctuation">-</span> shared<span class="token punctuation">-</span>common<span class="token punctuation">-</span>module
  <span class="token punctuation">-</span> middleware<span class="token punctuation">-</span>module
    <span class="token punctuation">-</span> cache<span class="token punctuation">-</span>module
      <span class="token punctuation">-</span> cache<span class="token punctuation">-</span>api
      <span class="token punctuation">-</span> cache<span class="token punctuation">-</span>local<span class="token punctuation">-</span>impl
      <span class="token punctuation">-</span> cache<span class="token punctuation">-</span>redis<span class="token punctuation">-</span>impl
    <span class="token punctuation">-</span> persistence<span class="token punctuation">-</span>module
      <span class="token punctuation">-</span> persistence<span class="token punctuation">-</span>api
      <span class="token punctuation">-</span> persistence<span class="token punctuation">-</span>mysql
      <span class="token punctuation">-</span> persistence<span class="token punctuation">-</span>oracle
  <span class="token punctuation">-</span> biz<span class="token punctuation">-</span>module
    <span class="token punctuation">-</span> controller<span class="token punctuation">-</span>module
    <span class="token punctuation">-</span> service<span class="token punctuation">-</span>module<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="åŸºæœ¬è§„èŒƒ"><a href="#åŸºæœ¬è§„èŒƒ" class="headerlink" title="åŸºæœ¬è§„èŒƒ"></a>åŸºæœ¬è§„èŒƒ</h1><h2 id="root-module-pomæ–‡ä»¶æœ‰ä¸¤ä¸ªä½œç”¨"><a href="#root-module-pomæ–‡ä»¶æœ‰ä¸¤ä¸ªä½œç”¨" class="headerlink" title="root-module pomæ–‡ä»¶æœ‰ä¸¤ä¸ªä½œç”¨:"></a>root-module pomæ–‡ä»¶æœ‰ä¸¤ä¸ªä½œç”¨:</h2><ol>
<li>ä½œä¸ºparent module, ç®¡ç†å„ä¸ªå­æ¨¡å—, ä¾¿äºresolveè‡ªèº«å„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³». å¦‚ä¸‹, biz_moduleä¾èµ–(GAV)middleware-module + shared-common-module; middleware-moduleä¾èµ–(GAV)shared-common-module:</li>
</ol>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>shared-common-module<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>middleware-module<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>biz-module<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>ä½œä¸ºparent pom, ç»Ÿä¸€ç®¡ç†å„ä¸ªå­æ¨¡å—çš„Mavenä¾èµ–, åŒæ—¶é»˜è®¤å¼•å…¥é€šç”¨çš„mavenä¾èµ–(ä¾‹å¦‚apache-commons, guavaç­‰), è€Œæ— éœ€å­æ¨¡å—é‡å¤å¼•å…¥.</li>
</ol>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="å­æ¨¡å—ä¹‹é—´ä¾èµ–å…³ç³»"><a href="#å­æ¨¡å—ä¹‹é—´ä¾èµ–å…³ç³»" class="headerlink" title="å­æ¨¡å—ä¹‹é—´ä¾èµ–å…³ç³»"></a>å­æ¨¡å—ä¹‹é—´ä¾èµ–å…³ç³»</h2><p>ä¾èµ–å…³ç³»å¦‚ä¸‹: </p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">controller<span class="token punctuation">-</span>module <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> service<span class="token punctuation">-</span>module <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> cache<span class="token punctuation">-</span>api                              <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> shared<span class="token punctuation">-</span>common
                                     <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> cache<span class="token punctuation">-</span>redis<span class="token punctuation">-</span>impl/cache<span class="token punctuation">-</span>local<span class="token punctuation">-</span>impl      <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> shared<span class="token punctuation">-</span>common
                                     <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> persistence<span class="token punctuation">-</span>api                        <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> shared<span class="token punctuation">-</span>common
                                     <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> persistence<span class="token punctuation">-</span>mysql                      <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> shared<span class="token punctuation">-</span>common<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="é—®é¢˜è¯´æ˜"><a href="#é—®é¢˜è¯´æ˜" class="headerlink" title="é—®é¢˜è¯´æ˜"></a>é—®é¢˜è¯´æ˜</h1><p>ä¸Šè¿°å¤šæ¨¡å—å¯¼è‡´çš„é—®é¢˜, åœ¨SpringBootåœºæ™¯ä¸‹, ç”±äºé»˜è®¤çš„Applicationæ˜¯æ”¾åœ¨æœ€å¤–å±‚çš„controller-module.<br>æ ¹æ®ä¾èµ–å…³ç³», middleware-module, shared-common-moduleç­‰æ— æ³•ä¾èµ–controller-module(å¦åˆ™ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–)<br>æ‰€ä»¥ç”±äºæ‰¾ä¸åˆ°Applicationå…¥å£, æ— æ³•byæ¨¡å—åœ°å¯åŠ¨springå®¹å™¨, è¿›è¡Œé›†æˆæµ‹è¯•.</p>
<h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><ol>
<li>æ¯ä¸ªæ¨¡å—èƒ½åšåˆ°é«˜å†…èš, å³æ¨¡å—ç›¸å…³çš„é…ç½®é¡¹éƒ½æ”¾åœ¨æ¨¡å—å†…éƒ¨. ä¾‹å¦‚ <ol>
<li>persistence-mysqlç›¸å…³çš„datasourceçš„é…ç½®, æ”¾åœ¨persistence-mysqlæ¨¡å—çš„resources&#x2F;xxx.propertiesé‡Œ</li>
<li>cache-redis-implç›¸å…³çš„redisé…ç½®, æ”¾åœ¨cache-redis-implæ¨¡å—çš„resources&#x2F;xxx.propertiesé‡Œ</li>
</ol>
</li>
<li>å„ä¸ªæ¨¡å—çš„æµ‹è¯•æ€&#x2F;è¿è¡Œæ€é…ç½®é¡¹æ˜¯è‡ªè¯´æ˜çš„, èƒ½ä¾¿äºä¾èµ–æ–¹è¿›è¡Œé›†æˆæµ‹è¯•, è€Œæ— éœ€ä¾èµ–æ–¹å†é‡æ–°é…ç½®ä¸€ä»½. ä¾‹å¦‚: <ol>
<li>service-moduleä¾èµ–äº† persistence-mysql , cache-redis-impl ä¸¤ä¸ªæ¨¡å—, service-moduleéœ€è¦åœ¨UTé‡Œå¯åŠ¨Springå®¹å™¨, æµ‹è¯•å…·ä½“serviceæ–¹æ³•. </li>
<li>æ— éœ€æŠŠ persistence-mysqlé‡Œçš„æµ‹è¯•datasourceé…ç½®, cache-redis-implé‡Œçš„æµ‹è¯•redisé…ç½®éƒ½åœ¨è‡ªå·±çš„ application.properties é‡Œå†™ä¸€ä»½. </li>
<li>å¯ä»¥ç›´æ¥å¼•å…¥å¯¹åº”æ¨¡å—æä¾›çš„æµ‹è¯•properties.</li>
<li>å¦‚æœå¯ä»¥å®ç°, å°¤å…¶æ˜¯åœ¨æ¨¡å—ä¾èµ–å±‚æ¬¡å¾ˆæ·±å¾ˆå¤æ‚çš„æ—¶å€™, ä½¿ç”¨ç®€ä¾¿æ€§ä¼šæ›´å¥½. ä¾‹å¦‚ controller-module å±‚æµ‹è¯•, åªéœ€è¦é…ç½®controllerå±‚è‡ªå·±çš„é…ç½®å°±å¥½, æ— éœ€å…³å¿ƒåˆ°åº•ä¾èµ–åˆ°çš„æ˜¯å“ªäº›module, è¿™äº›moduleé‡Œåˆ°åº•éœ€è¦å“ªäº›é…ç½®é¡¹.</li>
</ol>
</li>
<li>èƒ½å¤Ÿbyæ¨¡å—&#x2F;åˆ†å±‚åœ°å¯åŠ¨Springå®¹å™¨è¿›è¡Œæµ‹è¯•<ol>
<li>æ–¹æ¡ˆ1: JMockit<ul>
<li>é€šå¸¸çš„ä¸€ç§åšæ³•æ˜¯ä½¿ç”¨JMockIt, ä½†å¸¦æ¥çš„é—®é¢˜æ˜¯, ä¾‹å¦‚è¦æµ‹è¯•çš„æ–¹æ³•å†…éƒ¨å®ç°æ˜¯è°ƒç”¨æŸä¸ªOpenAPI, å¯èƒ½ä¸€å¼€å§‹å¹¶ä¸çŸ¥é“ç»“æœçš„ç»“æ„æ˜¯æ€æ ·çš„(å°¤å…¶æ˜¯åœ¨apiæ–‡æ¡£ç¼ºå¤±æˆ–è€…ä¸å…¨çš„æƒ…å†µä¸‹), ä¹Ÿä¸æ¸…æ¥šæ€§èƒ½æ€æ ·. </li>
<li>è¿™æ ·utçš„å‡†ç¡®åº¦ä¸å¯é æ€§ä»¥åŠåç»­æ€§èƒ½å‹æµ‹çš„èƒ½åŠ›éƒ½ä¸å…·å¤‡.</li>
</ul>
</li>
<li>æ–¹æ¡ˆ2: å‚è§æœ¬æ–‡åç»­.</li>
</ol>
</li>
</ol>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><h2 id="ä¸€-é€šç”¨èƒ½åŠ›æ”¾åˆ°shared-commoné‡Œ"><a href="#ä¸€-é€šç”¨èƒ½åŠ›æ”¾åˆ°shared-commoné‡Œ" class="headerlink" title="ä¸€: é€šç”¨èƒ½åŠ›æ”¾åˆ°shared-commoné‡Œ"></a>ä¸€: é€šç”¨èƒ½åŠ›æ”¾åˆ°shared-commoné‡Œ</h2><p>å°¤å…¶æ˜¯log4j.xmlç­‰é…ç½®, ç”±äºå„ä¸ªæ¨¡å—éƒ½éœ€è¦, å› æ­¤éœ€è¦æ”¾å…¥åˆ°share-commoné‡Œ.  </p>
<h2 id="äºŒ-æ¨¡å—åŒ–çš„é…ç½®èƒ½åŠ›"><a href="#äºŒ-æ¨¡å—åŒ–çš„é…ç½®èƒ½åŠ›" class="headerlink" title="äºŒ: æ¨¡å—åŒ–çš„é…ç½®èƒ½åŠ›"></a>äºŒ: æ¨¡å—åŒ–çš„é…ç½®èƒ½åŠ›</h2><h3 id="ç¬¬ä¸€æ­¥-æ¨¡å—é…ç½®æ–‡ä»¶æŒ‰ç…§-é€šç”¨-æµ‹è¯•-x2F-ç”Ÿäº§-x2F-ç­‰ç¯å¢ƒç›¸å…³-ä¸¤ç±»è¿›è¡Œæ‹†åˆ†"><a href="#ç¬¬ä¸€æ­¥-æ¨¡å—é…ç½®æ–‡ä»¶æŒ‰ç…§-é€šç”¨-æµ‹è¯•-x2F-ç”Ÿäº§-x2F-ç­‰ç¯å¢ƒç›¸å…³-ä¸¤ç±»è¿›è¡Œæ‹†åˆ†" class="headerlink" title="ç¬¬ä¸€æ­¥: æ¨¡å—é…ç½®æ–‡ä»¶æŒ‰ç…§ é€šç”¨+æµ‹è¯•&#x2F;ç”Ÿäº§&#x2F;ç­‰ç¯å¢ƒç›¸å…³ ä¸¤ç±»è¿›è¡Œæ‹†åˆ†"></a>ç¬¬ä¸€æ­¥: æ¨¡å—é…ç½®æ–‡ä»¶æŒ‰ç…§ é€šç”¨+æµ‹è¯•&#x2F;ç”Ÿäº§&#x2F;ç­‰ç¯å¢ƒç›¸å…³ ä¸¤ç±»è¿›è¡Œæ‹†åˆ†</h3><p>ä¾‹å¦‚persistence-mysqlæ¨¡å—çš„é…ç½®é¡¹æ‹†åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ª: </p>
<ul>
<li>persistence-mysql-common.properties â€“&gt; common, ç¯å¢ƒæ— å…³çš„é…ç½®, å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">spring.datasource.driver.driver-class-name&#x3D;com.mysql.jdbc.Driver
spring.datasource.driver.type&#x3D;com.xxx.druid.pool.DruidDataSource
spring.datasource.driver.maxActive&#x3D;300
spring.datasource.driver.initialSize&#x3D;20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>persistence-mysql-test.properties â€“&gt; for ut , å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.datasource.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://xxx:3306/test?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true</span>
<span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">usr</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">pwd</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>persistence-mysql-dev.properties  â€“&gt; for dev env</li>
<li>persistence-mysql-prod.properties â€“&gt; for prod env</li>
</ul>
<p>æ³¨æ„:<br>è¿™äº›<code>*.properties</code>æ–‡ä»¶ä¸€å®šéƒ½è¦æ”¾åœ¨ src&#x2F;main&#x2F;resources&#x2F; ç›®å½•ä¸‹, æ³¨æ„å°¤å…¶ä¸èƒ½æŠŠ  persistence-mysql-test.properties æ”¾åˆ° src&#x2F;test&#x2F;resources&#x2F; ç›®å½•ä¸‹.<br>å› ä¸ºå¦‚æœæ”¾åˆ° src&#x2F;test&#x2F;resources&#x2F; ä¸‹, è™½ç„¶å½“å‰æ¨¡å—è‡ªèº«çš„UTèƒ½åŠ è½½åˆ° <code>persistence-mysql-test.properties</code> æ–‡ä»¶<br>ä½†å…¶ä»–ä¾èµ–åˆ°è¯¥æ¨¡å—çš„UTå°±æ— æ³•åŠ è½½åˆ° <code>persistence-mysql-test.properties</code> æ–‡ä»¶äº†.</p>
<h3 id="ç¬¬äºŒæ­¥-ä½¿ç”¨-spring-profiles-active-å¯¹-common-envç›¸å…³çš„é…ç½®æ–‡ä»¶-è¿›è¡ŒåŠ è½½"><a href="#ç¬¬äºŒæ­¥-ä½¿ç”¨-spring-profiles-active-å¯¹-common-envç›¸å…³çš„é…ç½®æ–‡ä»¶-è¿›è¡ŒåŠ è½½" class="headerlink" title="ç¬¬äºŒæ­¥: ä½¿ç”¨ spring.profiles.active å¯¹ common + envç›¸å…³çš„é…ç½®æ–‡ä»¶ è¿›è¡ŒåŠ è½½"></a>ç¬¬äºŒæ­¥: ä½¿ç”¨ spring.profiles.active å¯¹ common + envç›¸å…³çš„é…ç½®æ–‡ä»¶ è¿›è¡ŒåŠ è½½</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"classpath:persistence-mysql-common.properties"</span><span class="token punctuation">,</span> <span class="token string">"classpath:persistence-mysql-$&#123;spring.profiles.active&#125;.properties"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceConfig</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ç¬¬ä¸‰æ­¥-é…ç½®-spring-profiles-active-ç¯å¢ƒå˜é‡"><a href="#ç¬¬ä¸‰æ­¥-é…ç½®-spring-profiles-active-ç¯å¢ƒå˜é‡" class="headerlink" title="ç¬¬ä¸‰æ­¥: é…ç½® spring.profiles.active ç¯å¢ƒå˜é‡"></a>ç¬¬ä¸‰æ­¥: é…ç½® spring.profiles.active ç¯å¢ƒå˜é‡</h3><ul>
<li><p>æ–¹æ¡ˆ1: åœ¨UTä»£ç é‡Œæ˜¾å¼è®¾ç½®ç¯å¢ƒå˜é‡</p>
</li>
<li><p>æ–¹æ¡ˆ2: é€šè¿‡springbootçš„é»˜è®¤æœºåˆ¶è®¾ç½®ç¯å¢ƒå˜é‡:<br>åœ¨å¯¹åº”æ¨¡å—çš„ <code>src/test/resources/</code> ç›®å½•ä¸‹æ–°å»º <code>application.properties</code> æ–‡ä»¶, å†…å®¹å¦‚ä¸‹:  </p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token value attr-value">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>UTå¯åŠ¨æ—¶ä¼šä¼˜å…ˆåŠ è½½ <code>src/test/resources/application.properties</code> æ–‡ä»¶, è¿™æ ·å°±æŠŠç¯å¢ƒå˜é‡è®¾ç½®å¥½äº†.</p>
</li>
</ul>
<h3 id="ç¬¬å››æ­¥-UT"><a href="#ç¬¬å››æ­¥-UT" class="headerlink" title="ç¬¬å››æ­¥: UT"></a>ç¬¬å››æ­¥: UT</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@ActiveProfiles</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultServiceTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">DefaultService</span> ds<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ä¸‰-æ¨¡å—åŒ–çš„Springå®¹å™¨æµ‹è¯•èƒ½åŠ›"><a href="#ä¸‰-æ¨¡å—åŒ–çš„Springå®¹å™¨æµ‹è¯•èƒ½åŠ›" class="headerlink" title="ä¸‰: æ¨¡å—åŒ–çš„Springå®¹å™¨æµ‹è¯•èƒ½åŠ›"></a>ä¸‰: æ¨¡å—åŒ–çš„Springå®¹å™¨æµ‹è¯•èƒ½åŠ›</h2><p>ç”±äºå„ä¸ªæ¨¡å—æ²¡æœ‰Application.javaç±»çš„å…¥å£, è€ŒSpringBootTestéœ€è¦æœ‰ä¸ªApplicationå…¥å£.<br>å› æ­¤å½“å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯ åœ¨å„ä¸ªæ¨¡å—çš„<code>src/test/java</code>ä»£ç é‡Œ, éƒ½åŠ å…¥TestApplication.javaæ–‡ä»¶, ä½œä¸ºæµ‹è¯•çš„contextå…¥å£: </p>
<ol>
<li>åœ¨çˆ¶åŒ…è·¯å¾„ä¸‹åˆ›å»ºè¯¥ç±», åˆ™æ— éœ€æŒ‡å®šå…¥å£ç±», springbooté»˜è®¤ä¼šä» DefaultServiceTestæµ‹è¯•ç±»çš„åŒ…è·¯å¾„, å‘ä¸ŠæŸ¥æ‰¾.</li>
<li>åœ¨å…„å¼Ÿè·¯å¾„ä¸‹è®¾ç½®è¯¥ç±», åˆ™éœ€è¦æŒ‡å®šè¯¥å…¥å£ç±»åç§°å¦‚ä¸‹: <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">TestApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ActiveProfiles</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultServiceTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">DefaultService</span> ds<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h1 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h1><p>å…¶å®æ•´ä½“ä¸SpringBootçš„åˆ†å±‚æµ‹è¯•æ€è·¯å¾ˆåƒ.</p>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>maven</tag>
        <tag>springboot</tag>
        <tag>maven-module</tag>
        <tag>maven test</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›æ—¥å¸¸è¸©çš„å°å‘ç¬”è®°</title>
    <url>//2022-02-22-java-minor-bugs/</url>
    <content><![CDATA[<h1 id="Java-SPIæœºåˆ¶æœªç”Ÿæ•ˆ-ServiceLoaderè·å–ä¸åˆ°å®ç°ç±»"><a href="#Java-SPIæœºåˆ¶æœªç”Ÿæ•ˆ-ServiceLoaderè·å–ä¸åˆ°å®ç°ç±»" class="headerlink" title="Java SPIæœºåˆ¶æœªç”Ÿæ•ˆ, ServiceLoaderè·å–ä¸åˆ°å®ç°ç±»"></a>Java SPIæœºåˆ¶æœªç”Ÿæ•ˆ, ServiceLoaderè·å–ä¸åˆ°å®ç°ç±»</h1><hr>
<p>æœ€ç»ˆå®šä½åˆ°åŸå› , æ˜¯å› ä¸ºæ¥å£å®ç°çš„æ–‡ä»¶éœ€è¦æ”¾åœ¨ <code>main/resources/META-INF/services/MyInterface</code> ä¸­<br>è€Œå®é™…æ–‡ä»¶æ”¾åˆ°äº†: <code>main/resources/META-INF.services/MyInterface</code> ä¸­äº†.</p>
<p>è¿™é‡Œæ¯”è¾ƒå‘çš„ä¸€ç‚¹æ˜¯, åœ¨IntelliJ IDEAä¸­, ä¼šé»˜è®¤flatten package, å³å°†ç›®å½•è·¯å¾„å±‚çº§ç”¨<code>.</code>è¿æ¥, å› æ­¤<br><code>main/resources/META-INF/services/MyInterface</code> ä¸ <code>main/resources/META-INF.services/MyInterface</code><br>ä¸¤ä¸ªç›®å½•çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„, å¦‚ä¸‹(æ ¹æœ¬åˆ†ä¸æ¸…æ¥šåˆ°åº•æ˜¯æ–‡ä»¶å¤¹åå­—å«<code>codecontest.bloomfilter</code>è¿˜æ˜¯æ–‡ä»¶å¤¹æ˜¯<code>codecontest/bloomfilter</code>):<br><img data-src="/../_assets/2022-02-23-java-minor-bugs/2022-02-23-java-minor-bugs-idea-path.png" alt="2022-02-23-java-minor-bugs-idea-path.png"></p>
<p>éšä¾¿æœäº†ä¸‹, å‘ç°å¤§å®¶è¸©åŒæ ·å‘çš„ä¹Ÿä¸å°‘, ç›®å‰çœ‹è²Œä¼¼æ²¡æœ‰å¥½çš„åŠæ³•é¿å…, è®°ä½æœ‰è¿™ä¸ªå‘, åç»­å¼•ä»¥ä¸ºæˆ’å§!</p>
<ul>
<li><a href="https://blog.csdn.net/tszxlzc/article/details/65938891">intellij ideaåŒ…è·¯å¾„å’Œæ–‡ä»¶å¤¹ç›®å½•çš„å‘</a></li>
</ul>
<h1 id="Java-SPIæœºåˆ¶åˆ›å»ºçš„å®ä¾‹æ— æ³•è¢«SpringContextç®¡ç†é—®é¢˜"><a href="#Java-SPIæœºåˆ¶åˆ›å»ºçš„å®ä¾‹æ— æ³•è¢«SpringContextç®¡ç†é—®é¢˜" class="headerlink" title="Java SPIæœºåˆ¶åˆ›å»ºçš„å®ä¾‹æ— æ³•è¢«SpringContextç®¡ç†é—®é¢˜"></a>Java SPIæœºåˆ¶åˆ›å»ºçš„å®ä¾‹æ— æ³•è¢«SpringContextç®¡ç†é—®é¢˜</h1><hr>
<h2 id="é—®é¢˜ä»£ç æ ·ä¾‹"><a href="#é—®é¢˜ä»£ç æ ·ä¾‹" class="headerlink" title="é—®é¢˜ä»£ç æ ·ä¾‹:"></a>é—®é¢˜ä»£ç æ ·ä¾‹:</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * åŠ è½½å®ç°
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServiceLoader</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyInterface</span><span class="token punctuation">></span></span> interfaces <span class="token operator">=</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">MyInterface</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MyInterface</span> anInterface <span class="token operator">:</span> interfaces<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            anInterface<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * å®ç°ç±»
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MyService</span> myService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        myService<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>å‘ç°åœ¨<code>MyImpl#sayHello</code>ä¼šæŠ›å‡ºNPE, å³<code>myService</code>å¯¹è±¡ä¸ºnull.<br>å¾ˆæ˜¾è€Œæ˜“è§, å› ä¸º <code>MyImpl</code> å®ä¾‹æ˜¯ä»ServiceLoaderä¸­newå‡ºæ¥çš„, è€Œä¸æ˜¯ç”±Springå®¹å™¨åˆ›å»ºçš„, å› æ­¤è‡ªèº«å°±è„±ç¦»äº†SpringContextçš„ç®¡ç†.<br>å› æ­¤<code>@Component</code>è¿™ä¸ªannotationæœ¬è´¨æ˜¯ä¸ç”Ÿæ•ˆçš„, <code>myService</code> ä¹Ÿä¸ä¼šè¢«Springè‡ªåŠ¨æ³¨å…¥è¿›å». </p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ–¹æ¡ˆ1-æ‰‹åŠ¨æ³¨å…¥"><a href="#æ–¹æ¡ˆ1-æ‰‹åŠ¨æ³¨å…¥" class="headerlink" title="æ–¹æ¡ˆ1: æ‰‹åŠ¨æ³¨å…¥"></a>æ–¹æ¡ˆ1: æ‰‹åŠ¨æ³¨å…¥</h3><p>æ‰‹åŠ¨è·å–Context, æ‰‹åŠ¨æ³¨å…¥: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * å®ç°ç±»
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// SpringBeanToolä»£ç å‚è§ https://www.jianshu.com/p/7fc4358b4e36</span>
    <span class="token class-name">MyService</span> myService <span class="token operator">=</span> <span class="token class-name">SpringBeanTool</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">MyService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        myService<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æ–¹æ¡ˆ1çš„é—®é¢˜æ€è€ƒ"><a href="#æ–¹æ¡ˆ1çš„é—®é¢˜æ€è€ƒ" class="headerlink" title="æ–¹æ¡ˆ1çš„é—®é¢˜æ€è€ƒ:"></a>æ–¹æ¡ˆ1çš„é—®é¢˜æ€è€ƒ:</h3><p>ä½†ä¸€ä¸ªç–‘é—®æ˜¯å¦‚æœMyImplç±»ä¸­<code>myService</code>å±æ€§çš„åˆå§‹åŒ–æ—©äºSpringContextçš„åˆå§‹åŒ–<br>é‚£ä¹ˆ <code>SpringBeanTool.getBean(MyService.class);</code> å¿…ç„¶è¿”å›çš„æ˜¯null(å› ä¸ºSpringContextå°šæœªåˆå§‹åŒ–å®Œæˆ).<br>å®é™…è¿è¡Œæµ‹è¯•, å‘ç°ä¸ä¼šè¿”å›null. é‚£ä¹ˆå®é™…çš„å…ˆåé¡ºåºæ˜¯æ€æ ·çš„? æ˜¯å¦æœ‰å¯èƒ½è¿”å›null?</p>
<h3 id="æ–¹æ¡ˆ2-ä½¿ç”¨SpringBootçš„SPI"><a href="#æ–¹æ¡ˆ2-ä½¿ç”¨SpringBootçš„SPI" class="headerlink" title="æ–¹æ¡ˆ2: ä½¿ç”¨SpringBootçš„SPI??"></a>æ–¹æ¡ˆ2: ä½¿ç”¨SpringBootçš„SPI??</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// TODO: è¿™ä¸ªå…ˆç•™ä¸ªå‘, å¾…åç»­ç ”ç©¶. </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h2><ul>
<li><a href="https://www.jianshu.com/p/7fc4358b4e36">Spring Boot è·å–ä¸Šä¸‹æ–‡ç¯å¢ƒ</a></li>
<li><a href="https://juejin.cn/post/6844903890173837326">springboot-starterä¸­çš„SPI æœºåˆ¶</a></li>
</ul>
<h1 id="åº•å±‚cacheä»Tairåˆ‡æ¢åˆ°Redisé‡åˆ°çš„å‘"><a href="#åº•å±‚cacheä»Tairåˆ‡æ¢åˆ°Redisé‡åˆ°çš„å‘" class="headerlink" title="åº•å±‚cacheä»Tairåˆ‡æ¢åˆ°Redisé‡åˆ°çš„å‘"></a>åº•å±‚cacheä»Tairåˆ‡æ¢åˆ°Redisé‡åˆ°çš„å‘</h1><hr>
<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.12.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.12.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Jacksonåºåˆ—åŒ–æ–¹å¼-é’ˆå¯¹åŒ¿åå†…éƒ¨ç±»-å¯ä»¥åºåˆ—åŒ–æˆåŠŸ-ä½†æ˜¯ååºåˆ—åŒ–å¤±è´¥"><a href="#Jacksonåºåˆ—åŒ–æ–¹å¼-é’ˆå¯¹åŒ¿åå†…éƒ¨ç±»-å¯ä»¥åºåˆ—åŒ–æˆåŠŸ-ä½†æ˜¯ååºåˆ—åŒ–å¤±è´¥" class="headerlink" title="Jacksonåºåˆ—åŒ–æ–¹å¼, é’ˆå¯¹åŒ¿åå†…éƒ¨ç±», å¯ä»¥åºåˆ—åŒ–æˆåŠŸ, ä½†æ˜¯ååºåˆ—åŒ–å¤±è´¥"></a>Jacksonåºåˆ—åŒ–æ–¹å¼, é’ˆå¯¹åŒ¿åå†…éƒ¨ç±», å¯ä»¥åºåˆ—åŒ–æˆåŠŸ, ä½†æ˜¯ååºåˆ—åŒ–å¤±è´¥</h2><p>æœ¬è´¨ä¸Šæ˜¯ç”±äº <code>@Cachable</code> é»˜è®¤ä½¿ç”¨äº†Jacksonåºåˆ—åŒ–æ–¹å¼, ä¼šé»˜è®¤æŠŠç±»å‹ä¿¡æ¯æ”¾åˆ°jsoné‡Œ, è€Œcacheä¸­çš„å¯¹è±¡æ˜¯åŒ¿åå†…éƒ¨ç±», ä»è€Œååºåˆ—åŒ–å¤±è´¥.</p>
<blockquote>
<p>å†…éƒ¨ç±»å®ä¾‹éœ€è¦å…¶å¤–éƒ¨ç±»å®ä¾‹å¯¹è±¡æ¥è¿›è¡Œå®ä¾‹åŒ–ï¼Œè€ŒJacksonåœ¨ååºåˆ—åŒ–æ—¶æ— æ³•åˆ›å»ºå…¶å¤–éƒ¨ç±»å®ä¾‹å¯¹è±¡</p>
</blockquote>
<h2 id="Jacksonåºåˆ—åŒ–æ–¹å¼-é’ˆå¯¹java-lang-Longç±»å‹-å¯ä»¥åºåˆ—åŒ–æˆåŠŸ-ä½†æ˜¯ååºåˆ—åŒ–å‡ºæ¥å°±å˜æˆäº†Integerç±»å‹-ä»è€Œå¼•å‘CCE"><a href="#Jacksonåºåˆ—åŒ–æ–¹å¼-é’ˆå¯¹java-lang-Longç±»å‹-å¯ä»¥åºåˆ—åŒ–æˆåŠŸ-ä½†æ˜¯ååºåˆ—åŒ–å‡ºæ¥å°±å˜æˆäº†Integerç±»å‹-ä»è€Œå¼•å‘CCE" class="headerlink" title="Jacksonåºåˆ—åŒ–æ–¹å¼, é’ˆå¯¹java.lang.Longç±»å‹, å¯ä»¥åºåˆ—åŒ–æˆåŠŸ, ä½†æ˜¯ååºåˆ—åŒ–å‡ºæ¥å°±å˜æˆäº†Integerç±»å‹, ä»è€Œå¼•å‘CCE"></a>Jacksonåºåˆ—åŒ–æ–¹å¼, é’ˆå¯¹java.lang.Longç±»å‹, å¯ä»¥åºåˆ—åŒ–æˆåŠŸ, ä½†æ˜¯ååºåˆ—åŒ–å‡ºæ¥å°±å˜æˆäº†Integerç±»å‹, ä»è€Œå¼•å‘CCE</h2><ul>
<li>ä»£ç æ ·ä¾‹å¦‚ä¸‹, SpringCacheæ¡†æ¶é»˜è®¤ä½¿ç”¨äº†æ— ç±»å‹çš„ååºåˆ—åŒ–å½¢å¼.</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JacksonSerializeTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GenericJackson2JsonRedisSerializer</span> serializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åŸå§‹æ˜¯Longç±»å‹</span>
        <span class="token class-name">Long</span> str <span class="token operator">=</span> <span class="token number">123L</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> serialize <span class="token operator">=</span> serializer<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> deserialize <span class="token operator">=</span> serializer<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>serialize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Jacksonååºåˆ—åŒ–ä¹‹å, ä¸¢å¤±äº†ç±»å‹ä¿¡æ¯, è¢«é»˜è®¤ä¸ºäº†Integerç±»å‹</span>
        <span class="token function">assertTrue</span><span class="token punctuation">(</span>deserialize <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Integer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertFalse</span><span class="token punctuation">(</span>deserialize <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Long</span> deserialize1 <span class="token operator">=</span> serializer<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>serialize<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Jacksonååºåˆ—åŒ–æ—¶æŒ‡å®šäº†ç±»å‹ä¿¡æ¯, åˆ™ä¼šæŒ‰ç…§ç±»å‹æ¥</span>
        <span class="token function">assertTrue</span><span class="token punctuation">(</span>deserialize1 <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æ‰©å±•æ€è€ƒ"><a href="#æ‰©å±•æ€è€ƒ" class="headerlink" title="æ‰©å±•æ€è€ƒ"></a>æ‰©å±•æ€è€ƒ</h2><p>å¦‚æœä½¿ç”¨FastJsonè¿›è¡Œåºåˆ—åŒ–&#x2F;ååºåˆ—, JSONé‡Œè¾¹åŒæ ·ä¸åŒ…å«ç±»å‹ä¿¡æ¯, é’ˆå¯¹åŒ¿åå†…éƒ¨ç±», é’ˆå¯¹Longç±»å‹, æ€ä¹ˆé˜²æ­¢ä¸Šè¿°é—®é¢˜?</p>
<h3 id="FastJson-AnonymousInnerClass"><a href="#FastJson-AnonymousInnerClass" class="headerlink" title="FastJson AnonymousInnerClass"></a>FastJson AnonymousInnerClass</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JacksonSerializeTest2</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jacksonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GenericJackson2JsonRedisSerializer</span> serializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åŸå§‹æ˜¯AnonymousInnerClass</span>
        <span class="token class-name">MyClass</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> serialize <span class="token operator">=</span> serializer<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åºåˆ—åŒ–çš„JSONé‡Œ, åŒ…å«äº†ç±»çš„ä¿¡æ¯</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"&#123;\"@class\":\"edu.xmu.test.javax.jackson.JacksonSerializeTest2$1\",\"name\":\"Hello\"&#125;"</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>serialize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¸‹è¾¹ååºåˆ—ä»£ç æŠ›å‡ºå¼‚å¸¸, Cannot deserialize Class edu.xmu.test.javax.jackson.JacksonSerializeTest2$1 (of type</span>
        <span class="token comment">// local/anonymous) as a Bean</span>
        serializer<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>serialize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fastjsonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åŸå§‹æ˜¯AnonymousInnerClass</span>
        <span class="token class-name">MyClass</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token comment">//String s = JSON.toJSONString(c, new SerializerFeature[] &#123;SerializerFeature.WriteClassName&#125;);</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> parse <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parse<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"JSONObject"</span><span class="token punctuation">,</span> parse<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyClass</span> c2 <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">MyClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fastjsonTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åŸå§‹æ˜¯AnonymousInnerClass</span>
        <span class="token class-name">MyClass</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SerializerFeature</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteClassName</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"&#123;\"@type\":\"edu.xmu.test.javax.jackson.JacksonSerializeTest2$3\",\"name\":\"Hello\"&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”±äºåºåˆ—åŒ–çš„sé‡Œè¾¹åŒ…å«äº†ç±»å‹ä¿¡æ¯, ä¸‹è¾¹ä¼šæŠ¥é”™, ä¿¡æ¯å¦‚ä¸‹:</span>
        <span class="token comment">/*
         * com.alibaba.fastjson.JSONException: default constructor not found. class edu.xmu.test.javax.jackson
         * .JacksonSerializeTest2$3
         */</span>
        <span class="token class-name">Object</span> parse <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="FastJson-Long"><a href="#FastJson-Long" class="headerlink" title="FastJson Long"></a>FastJson Long</h3><p>ä»£ç æ ·ä¾‹å¦‚ä¸‹, ååºåˆ—åŒ–æ—¶éœ€è¦æä¾›ç±»å‹ä¿¡æ¯.</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fastJsonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Long</span> str <span class="token operator">=</span> <span class="token number">123L</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> str2 <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// FastJsonååºåˆ—åŒ–æ—¶æŒ‡å®šäº†ç±»å‹ä¿¡æ¯, åˆ™ä¼šæŒ‰ç…§ç±»å‹æ¥</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>str <span class="token keyword">instanceof</span> <span class="token class-name">Long</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Object</span> parse <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// FastJsonååºåˆ—åŒ–ä¹‹å, ä¸¢å¤±äº†ç±»å‹ä¿¡æ¯, è¢«é»˜è®¤ä¸ºäº†Integerç±»å‹</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>parse <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Integer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertFalse</span><span class="token punctuation">(</span>parse <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="Refs-1"><a href="#Refs-1" class="headerlink" title="Refs"></a>Refs</h2><ul>
<li><a href="https://juejin.cn/post/6844904170403659784">ä¸€æ¬¡ååºåˆ—åŒ–å†…éƒ¨ç±»å¯¼è‡´çš„é—®é¢˜æ’æŸ¥è¿‡ç¨‹</a></li>
</ul>
<h1 id="k8s-java-clienté‡åˆ°çš„joda-timeåºåˆ—åŒ–é—®é¢˜"><a href="#k8s-java-clienté‡åˆ°çš„joda-timeåºåˆ—åŒ–é—®é¢˜" class="headerlink" title="k8s java clienté‡åˆ°çš„joda.timeåºåˆ—åŒ–é—®é¢˜"></a>k8s java clienté‡åˆ°çš„joda.timeåºåˆ—åŒ–é—®é¢˜</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸¤ä¸ªç³»ç»Ÿé—´é€šè¿‡dubboè¿›è¡ŒRPCè°ƒç”¨, éƒ½å¼•ç”¨äº†k8s-java-client, dubboæ¥å£è¯´æ˜å¦‚ä¸‹:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>client<span class="token punctuation">.</span>openapi<span class="token punctuation">.</span>models<span class="token punctuation">.</span></span><span class="token class-name">V1Pod</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">K8sService</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token class-name">V1Pod</span> podSpec<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h2><ul>
<li>ä½¿ç”¨çš„k8s-java-clientç‰ˆæœ¬å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.kubernetes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>client-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>10.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="é”™è¯¯ä¿¡æ¯"><a href="#é”™è¯¯ä¿¡æ¯" class="headerlink" title="é”™è¯¯ä¿¡æ¯"></a>é”™è¯¯ä¿¡æ¯</h2><ol>
<li>åœºæ™¯1, ç³»ç»Ÿè°ƒç”¨</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimeException</span><span class="token operator">:</span> <span class="token class-name">Serialized</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>client<span class="token punctuation">.</span>openapi<span class="token punctuation">.</span>models<span class="token punctuation">.</span></span>V1Pod</span> must implement <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>åœºæ™¯2, åœ¨provideræœºå™¨ä¸Š, ç™»å½•dubboæ§åˆ¶å°, æ‰‹åŠ¨invoke, é”™è¯¯ä¿¡æ¯å¦‚ä¸‹:</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Failed</span> <span class="token keyword">to</span> <span class="token namespace">invoke</span> method normalizeCpuMem<span class="token punctuation">,</span> cause<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimeException</span><span class="token operator">:</span> <span class="token class-name">Failed</span> <span class="token keyword">to</span> <span class="token namespace">set</span> pojo <span class="token class-name">V1ObjectMeta</span> property deletionTimestamp value <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">28</span>T18<span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">24.000</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token function">00</span><span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cause<span class="token operator">:</span> argument type mismatch
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimeException</span><span class="token operator">:</span> <span class="token class-name">Failed</span> <span class="token keyword">to</span> <span class="token namespace">set</span> pojo <span class="token class-name">V1ObjectMeta</span> property deletionTimestamp value <span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">28</span>T18<span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">24.000</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token function">00</span><span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cause<span class="token operator">:</span> argument type mismatch
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>PojoUtils</span><span class="token punctuation">.</span><span class="token function">realize0</span><span class="token punctuation">(</span><span class="token class-name">PojoUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">450</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>PojoUtils</span><span class="token punctuation">.</span><span class="token function">realize0</span><span class="token punctuation">(</span><span class="token class-name">PojoUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">445</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>PojoUtils</span><span class="token punctuation">.</span><span class="token function">realize0</span><span class="token punctuation">(</span><span class="token class-name">PojoUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">372</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>PojoUtils</span><span class="token punctuation">.</span><span class="token function">realize0</span><span class="token punctuation">(</span><span class="token class-name">PojoUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">445</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>PojoUtils</span><span class="token punctuation">.</span><span class="token function">realize0</span><span class="token punctuation">(</span><span class="token class-name">PojoUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">445</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>PojoUtils</span><span class="token punctuation">.</span><span class="token function">realize</span><span class="token punctuation">(</span><span class="token class-name">PojoUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>PojoUtils</span><span class="token punctuation">.</span><span class="token function">realize</span><span class="token punctuation">(</span><span class="token class-name">PojoUtils</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">79</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>telnet<span class="token punctuation">.</span></span>InvokeTelnetHandler</span><span class="token punctuation">.</span><span class="token function">telnet</span><span class="token punctuation">(</span><span class="token class-name">InvokeTelnetHandler</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>telnet<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>TelnetHandlerAdapter</span><span class="token punctuation">.</span><span class="token function">telnet</span><span class="token punctuation">(</span><span class="token class-name">TelnetHandlerAdapter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">54</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="åŸå› åˆ†æ-1"><a href="#åŸå› åˆ†æ-1" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>è‡³æ­¤, å¯ä»¥åŸºæœ¬çŸ¥é“æ˜¯ç”±äºåºåˆ—åŒ–é—®é¢˜å¯¼è‡´. å°¤å…¶æ˜¯ <code>V1ObjectMeta</code> é‡Œçš„ <code>deletionTimestamp</code> å­—æ®µ, æ˜¯ <code>org.joda.time.DateTime</code> ç±»å‹.<br>ç»æœç´¢å¾—çŸ¥, å·²ç»æœ‰äººåœ¨dubboç¤¾åŒºæå‡ºè¿™ä¸ªé—®é¢˜: <a href="https://github.com/apache/dubbo/issues/9676">ä½¿ç”¨hessian2æ— æ³•ååºåˆ—åŒ–jodatime</a><br>ä½†è¯¥bugä»ç„¶å¤„äºOpençŠ¶æ€.</p>
<h2 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å½“å‰ä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆæ˜¯: </p>
<ol>
<li>ç¬¬ä¸€æ­¥: ä¿®æ”¹æ¥å£ç­¾åå¦‚ä¸‹, ä½¿ç”¨åºåˆ—åŒ–åçš„JsonString.</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">K8sService</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token class-name">String</span> podSpec<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>ç¬¬äºŒæ­¥: Provider&amp;Consumeréƒ½ä½¿ç”¨åŒæ ·çš„<code>toJson(V1Pod)</code>é€»è¾‘.<br>å‚è§å¼€æºå®ç°: <a href="https://github.com/gkopff/gson-jodatime-serialisers">gson-jodatime-serialisers</a></li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>mdc</tag>
        <tag>npe</tag>
      </tags>
  </entry>
  <entry>
    <title>RAMçš„åŸºç¡€æ¦‚å¿µä¸å®è·µ</title>
    <url>//2022-02-28-aliyun-ram-openapi/</url>
    <content><![CDATA[<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="é‡è¦æ¦‚å¿µ"><a href="#é‡è¦æ¦‚å¿µ" class="headerlink" title="é‡è¦æ¦‚å¿µ:"></a>é‡è¦æ¦‚å¿µ:</h2><p>RAMç”¨æˆ·:</p>
<ul>
<li>ä¸»è´¦å·</li>
<li>å­è´¦å·</li>
</ul>
<p>ç”¨æˆ·ç»„: </p>
<ul>
<li>ä¸ä¼ ç»ŸRBACé‡Œçš„è§’è‰²å¯¹åº”.</li>
</ul>
<p>RAMè§’è‰²: </p>
<ul>
<li>RAMé‡Œçš„è§’è‰²ä¸æ™®é€šRBACé‡Œçš„è§’è‰²æ˜¯ä¸ä¸€æ ·çš„, è¿™é‡Œçš„è§’è‰²ç›¸å½“äºæ˜¯ä¸€ä¸ªè™šæ‹Ÿå®ä½“(è™šæ‹Ÿç”¨æˆ·), æ²¡æœ‰ak&#x2F;sk, å› æ­¤ä¸èƒ½è¢«ç›´æ¥ä½¿ç”¨. </li>
<li>ä½†å¯ä»¥è¢«ramç”¨æˆ·(å­è´¦å·æˆ–ä¸»è´¦å·æˆ–è€…äº‘äº§å“äº‘æœåŠ¡ç­‰)æ‰®æ¼”(assume), ä¸€æ—¦æ‰®æ¼”å®Œæˆ, å³å¯æ‹¥æœ‰è¯¥è§’è‰²ä¸Šçš„æ‰€æœ‰æƒé™.</li>
</ul>
<h2 id="é‡è¦å±æ€§"><a href="#é‡è¦å±æ€§" class="headerlink" title="é‡è¦å±æ€§"></a>é‡è¦å±æ€§</h2><ul>
<li>æƒé™ç®¡ç†: ç”¨æ¥è®¾ç½®è¯¥è§’è‰²æ‹¥æœ‰å“ªäº›æƒé™.</li>
<li>ä¿¡ä»»ç­–ç•¥ç®¡ç†: ç”¨æ¥ç®¡ç†å“ªäº›RAMç”¨æˆ·&#x2F;æœåŠ¡èƒ½å¤Ÿæ‰®æ¼”(assume)è¯¥è§’è‰²</li>
</ul>
<h2 id="è§’è‰²åˆ†ç±»"><a href="#è§’è‰²åˆ†ç±»" class="headerlink" title="è§’è‰²åˆ†ç±»"></a>è§’è‰²åˆ†ç±»</h2><h3 id="æ™®é€šè§’è‰²"><a href="#æ™®é€šè§’è‰²" class="headerlink" title="æ™®é€šè§’è‰²"></a>æ™®é€šè§’è‰²</h3><ul>
<li>ç”¨æˆ·å¯ä»¥è‡ªå·±åˆ›å»ºè§’è‰², å¹¶è®¾ç½®â€ä¿¡ä»»ç­–ç•¥ç®¡ç†â€</li>
<li>ä¹Ÿå¯ä»¥ç”±ç”¨æˆ·å¼€é€šäº‘æœåŠ¡æ—¶, æˆæƒäº‘æœåŠ¡æ¥ä¸ºç”¨æˆ·åˆ›å»ºè¯¥è§’è‰², å¹¶æŠŠäº‘æœåŠ¡åŠ å…¥åˆ°â€ä¿¡ä»»ç­–ç•¥â€é‡Œ. ä»è€Œäº‘æœåŠ¡å¯ä»¥æ‰®æ¼”è¯¥è§’è‰².</li>
</ul>
<h3 id="SLR-ServiceLinkedRole-æœåŠ¡å…³è”è§’è‰²"><a href="#SLR-ServiceLinkedRole-æœåŠ¡å…³è”è§’è‰²" class="headerlink" title="SLR(ServiceLinkedRole, æœåŠ¡å…³è”è§’è‰²)"></a>SLR(ServiceLinkedRole, æœåŠ¡å…³è”è§’è‰²)</h3><p>ç›¸å½“äºæ™®é€šè§’è‰²çš„å‡çº§ç‰ˆ, ä¸»è¦æ˜¯ç»™äº‘æœåŠ¡ä½¿ç”¨.<br>ä¸æ™®é€šè§’è‰²çš„åŒºåˆ«æ˜¯: SLRä¸€æ—¦åˆ›å»ºæˆåŠŸ, ç”¨æˆ·ä¸èƒ½å†æ·»åŠ &#x2F;ä¿®æ”¹SLRçš„ â€œæƒé™ç®¡ç†â€ ä»¥åŠ â€œä¿¡ä»»ç­–ç•¥ç®¡ç†â€. åªèƒ½åˆ é™¤.<br>ä¼˜ç‚¹æ˜¯é˜²æ­¢ç”¨æˆ·è¯¯ä¿®æ”¹æƒé™&#x2F;ä¿¡ä»»ç­–ç•¥, å¯¼è‡´äº‘æœåŠ¡æ— æ³•æ­£å¸¸æ‰®æ¼”, æä¾›æœåŠ¡.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042218061.png"></p>
<h1 id="åŸºæœ¬APIä½¿ç”¨"><a href="#åŸºæœ¬APIä½¿ç”¨" class="headerlink" title="åŸºæœ¬APIä½¿ç”¨"></a>åŸºæœ¬APIä½¿ç”¨</h1><h2 id="æ–¹å¼1-ç›´æ¥ä½¿ç”¨AK-x2F-SK"><a href="#æ–¹å¼1-ç›´æ¥ä½¿ç”¨AK-x2F-SK" class="headerlink" title="æ–¹å¼1: ç›´æ¥ä½¿ç”¨AK&#x2F;SK"></a>æ–¹å¼1: ç›´æ¥ä½¿ç”¨AK&#x2F;SK</h2><h3 id="ä½¿ç”¨æ ·ä¾‹"><a href="#ä½¿ç”¨æ ·ä¾‹" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹:"></a>ä½¿ç”¨æ ·ä¾‹:</h3><ul>
<li>ä½¿ç”¨ä¸»è´¦å·çš„AK&#x2F;SK</li>
<li>ä½¿ç”¨å­è´¦å·çš„AK&#x2F;SK</li>
</ul>
<pre class="mermaid">sequenceDiagram
      participant UserServer
      participant AliyunPop
      UserServer->>UserServer: Stores(AK/SK)
   UserServer->>UserServer: PrepareRequest(AK/SK)
   UserServer ->> +AliyunPop: RunInstances(AK, Sign)
   AliyunPop->>AliyunPop: checkSign(AK, Sign)
   AliyunPop -->> -UserServer: OK</pre>

<h3 id="é€‚ç”¨åœºæ™¯åˆ†æ"><a href="#é€‚ç”¨åœºæ™¯åˆ†æ" class="headerlink" title="é€‚ç”¨åœºæ™¯åˆ†æ"></a>é€‚ç”¨åœºæ™¯åˆ†æ</h3><p>ç›´æ¥ç”¨ak&#x2F;sk, æ˜¯éå¸¸å¸¸è§çš„æ–¹æ¡ˆ. ä½†å¸¦æ¥çš„é—®é¢˜: </p>
<ol>
<li>SKæ³„éœ²å®‰å…¨é—®é¢˜: ç”±äºSKæ˜¯ä¸å˜çš„, å› æ­¤å¦‚æœSKæ³„éœ², ç›¸å½“äºå¯†ç æ³„éœ², å³æ°¸ä¹…åœ°æ‹¥æœ‰äº†è¯¥è´¦å·æ‰€æœ‰çš„æƒé™.</li>
<li>SKæ°¸ä¹…æœ‰æ•ˆé—®é¢˜: ä¸»è´¦å·çš„SKæ˜¯æ°¸ä¹…æœ‰æ•ˆçš„, æ— æ³•ç±»ä¼¼stsTokenä¸€æ ·è®¾ç½®æœ‰æ•ˆæœŸ, åˆ°æœŸä¹‹åéœ€è¦é‡æ–°ç»­æœŸ.</li>
</ol>
<h2 id="æ–¹å¼2-æ‰®æ¼”RAMè§’è‰²-ä½¿ç”¨RAMè§’è‰²çš„STSToken"><a href="#æ–¹å¼2-æ‰®æ¼”RAMè§’è‰²-ä½¿ç”¨RAMè§’è‰²çš„STSToken" class="headerlink" title="æ–¹å¼2: æ‰®æ¼”RAMè§’è‰², ä½¿ç”¨RAMè§’è‰²çš„STSToken"></a>æ–¹å¼2: æ‰®æ¼”RAMè§’è‰², ä½¿ç”¨RAMè§’è‰²çš„STSToken</h2><h3 id="ä½¿ç”¨æ ·ä¾‹-1"><a href="#ä½¿ç”¨æ ·ä¾‹-1" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h3><pre class="mermaid">sequenceDiagram
      participant UserServer
      participant AliyunPop
   par assumeRole
      UserServer->>UserServer: Stores(AK/SK)
   UserServer->>UserServer: PrepareRequest(AK/SK)
   UserServer ->> +AliyunPop: AssumeRole(AK, Sign)
   AliyunPop->>AliyunPop: checkSign(AK, Sign)
   AliyunPop -->> -UserServer: (stsAK, stsSK, stsToken, Expiration)
   UserServer ->> UserServer: store(stsAK, stsSK, Expiration)
   end

   par runInstances
   UserServer->>UserServer: checkExpiration(stsAK, stsSK, Expiration)
   UserServer->>UserServer: PrepareRequest(stsAK, stsSK, stsToken)
   UserServer ->> +AliyunPop: RunInstances(stsAK, Sign)
   AliyunPop->>AliyunPop: checkSign(stsAK, Sign)
   AliyunPop -->> -UserServer: OK
   end</pre>

<h3 id="ä½¿ç”¨åœºæ™¯åˆ†æ"><a href="#ä½¿ç”¨åœºæ™¯åˆ†æ" class="headerlink" title="ä½¿ç”¨åœºæ™¯åˆ†æ"></a>ä½¿ç”¨åœºæ™¯åˆ†æ</h3><p>ç”±äºstsTokenæœ‰æ•ˆæœŸç”¨æˆ·æ˜¯å¯ä»¥è®¾ç½®çš„, å› æ­¤é£é™©æœ‰é™.</p>
<h2 id="æ–¹å¼3-å†…éƒ¨è°ƒç”¨ä½¿ç”¨innerAPI"><a href="#æ–¹å¼3-å†…éƒ¨è°ƒç”¨ä½¿ç”¨innerAPI" class="headerlink" title="æ–¹å¼3: å†…éƒ¨è°ƒç”¨ä½¿ç”¨innerAPI"></a>æ–¹å¼3: å†…éƒ¨è°ƒç”¨ä½¿ç”¨innerAPI</h2><h3 id="ä½¿ç”¨åœºæ™¯åˆ†æ-1"><a href="#ä½¿ç”¨åœºæ™¯åˆ†æ-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯åˆ†æ"></a>ä½¿ç”¨åœºæ™¯åˆ†æ</h3><p>ä¸ºäºŒæ–¹&#x2F;äº‘äº§å“é¢å‘ä¸€ä¸ªæˆä¿¡çš„AK&#x2F;SK, åœ¨è°ƒç”¨APIæ—¶, å¯ä»¥ä¼ å…¥ (ak, sk, realUserId) æ¥ä»£ç†ç”¨æˆ·æ‰§è¡Œæ“ä½œ</p>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>å®‰å…¨è¦æ±‚é«˜: <ul>
<li>é“¾è·¯å®‰å…¨éœ€è¦ä¿éšœ: ä¸€å®šè¦ä¿éšœAPIé“¾è·¯æ˜¯èµ°çš„å®‰å…¨é“¾è·¯æˆ–è€…å†…ç½‘é€šé“, ä¸è¦å¼€æ”¾åœ¨å…¬ç½‘.</li>
<li>äº‘äº§å“ak&#x2F;skéœ€è¦ä¿éšœ: ä¸è¦æ”¾åœ¨å®¢æˆ·ç«¯, ä¸€å®šè¦æ”¾åœ¨æœåŠ¡ç«¯. APIåªèƒ½<code>æœåŠ¡ç«¯-æœåŠ¡ç«¯</code>è°ƒç”¨</li>
</ul>
</li>
<li>æµæ§æ–¹å¼: éœ€è¦æŒ‰ç…§&lt;api, realUserId, channel&gt;ä¸ºç²’åº¦è¿›è¡Œæµæ§.<ul>
<li>å¦‚æœæŒ‰ç…§&lt;api, äº‘äº§å“UID&gt;è¿›è¡Œæµæ§, äº‘äº§å“å¦‚æœä»£ç†çš„realUserIdæ•°é‡å¢åŠ , ä¼šå¾ˆå®¹æ˜“åˆ°è¾¾é™æµç“¶é¢ˆ. </li>
<li>å¦‚æœæŒ‰ç…§&lt;api, realUserId&gt;è¿›è¡Œæµæ§, åœ¨äº‘äº§å“é”™è¯¯è°ƒç”¨é‡å¾ˆå¤§æ—¶, ä¼šå¯¼è‡´å½±å“ç”¨æˆ·æ­£å¸¸çš„apiè°ƒç”¨</li>
</ul>
</li>
</ul>
<h1 id="å…¶ä»–æ€è€ƒ"><a href="#å…¶ä»–æ€è€ƒ" class="headerlink" title="å…¶ä»–æ€è€ƒ"></a>å…¶ä»–æ€è€ƒ</h1><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><ol>
<li>ä¸€å®šè¦ç”¨å­è´¦å·çš„ak&#x2F;sk, ä¸èƒ½ç”¨ä¸»è´¦å·. å­è´¦å·ak&#x2F;skæ³„éœ², å¯ä»¥é€šè¿‡ä¸»è´¦å·è¿›è¡Œç¦ç”¨ç­‰. ä¸€æ—¦ä¸»è´¦å·skæ³„éœ², å°±å½»åº•æ²¡æœ‰äº†é˜²çº¿.</li>
<li>ä½œä¸ºç¬¬ä¸‰æ–¹æœåŠ¡å¼€å‘è€…, ä¸€å®šè¦ä½¿ç”¨SLRæ¥è¯·æ±‚è¿›è¡Œæˆæƒ, è€Œä¸èƒ½ç›´æ¥ç´¢è¦ç”¨æˆ·çš„ak&#x2F;sk, æˆ–è€…è¯·æ±‚ç”¨æˆ·æ·»åŠ å­è´¦å·ä¹‹ç±».</li>
</ol>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://next.api.aliyun.com/document/Rds/2014-08-15/CreateServiceLinkedRole">CreateServiceLinkedRole</a></li>
<li><a href="https://developer.aliyun.com/ask/213942?spm=5176.21213303.J_6704733920.26.5c103eda7AvbNH&scm=20140722.S_community@@%E9%97%AE%E7%AD%94@@213942._.ID_community@@%E9%97%AE%E7%AD%94@@213942-RL_sts%20token-LOC_main-OR_ser-V_2-P0_6">Java SDKï¼šä½¿ç”¨STS Tokenè¿›è¡Œè®¿é—®</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>ram</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot+MyBatisä½¿ç”¨XMLé…ç½®æ–¹æ¡ˆ</title>
    <url>//2022-03-03-springboot-mybatis-xml/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>é¡¹ç›®ä»£ç ä¹‹å‰æ˜¯åŸºäºibatis, è€Œä¸”SQLè¯­å¥æ˜¯åŸºäºsqlmap.xmlæ–‡ä»¶çš„.<br>ç°åœ¨å‡çº§åˆ°mybatis 3.4.2, ä½†mybatisçš„é»˜è®¤æ–¹æ¡ˆæ˜¯åŸºäºannotationçš„.<br>ä¸ªäººéå¸¸ä¸ä¹ æƒ¯annotationçš„æ–¹å¼, æ¯æ¬¡æ’æŸ¥é—®é¢˜æ‹¼æ¥SQL, ä»¥åŠåç»­ä¿®æ”¹SQL, æå…¶éº»çƒ¦, ä¸ç›´è§‚.<br>å› æ­¤æƒ³è¦ä½¿ç”¨xmlçš„æ–¹å¼é…ç½®. åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¸©äº†å¾ˆå¤šå‘, ç°åœ¨è®°å½•ä¸‹æ¥.</p>
<h1 id="annotation-sqlçš„é—®é¢˜"><a href="#annotation-sqlçš„é—®é¢˜" class="headerlink" title="annotation sqlçš„é—®é¢˜"></a>annotation sqlçš„é—®é¢˜</h1><p>æ— è®ºæ˜¯ä¸‹è¾¹çš„æ–¹å¼1, è¿˜æ˜¯æ–¹å¼2, SQLå­—ç¬¦ä¸²éƒ½ä¼šè‡ªåŠ¨æ¢è¡Œ, ç„¶åç”¨<code>+</code>ä»¥åŠ<code>&quot;</code>ç­‰ç¬¦å·è¿æ¥. </p>
<ol>
<li>ä»è€Œå¦‚æœçº¿ä¸Šå‡ºç°é—®é¢˜, éœ€è¦æ‰‹åŠ¨é‡å»ºSQLæ—¶, å¾ˆéš¾ç›´æ¥æ‹·è´å‡ºæ¥æ›¿æ¢å‚æ•°æ‰¾åˆ°ç›®æ ‡SQL. å°¤å…¶æ˜¯åœ¨SQLé•¿åº¦å¾ˆé•¿, ä»è€Œè¢«æ¢è¡Œæˆä¸ºNè¡Œåœºæ™¯ä¸‹, é‡å»ºSQLç®€ç›´å°±æ˜¯ç¾éš¾:</li>
<li>å¦å¤–ä¿®æ”¹SQL, ä¹Ÿéå¸¸ä¸æ–¹ä¾¿, ä¸ç›´è§‚.</li>
</ol>
<h2 id="æ–¹å¼1-SQLç›´æ¥åœ¨annotationä¸Š"><a href="#æ–¹å¼1-SQLç›´æ¥åœ¨annotationä¸Š" class="headerlink" title="æ–¹å¼1: SQLç›´æ¥åœ¨annotationä¸Š"></a>æ–¹å¼1: SQLç›´æ¥åœ¨annotationä¸Š</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDAO</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO user(userName,userAge,userAddress) VALUES(#&#123;userName&#125;,"</span>
            <span class="token operator">+</span> <span class="token string">"#&#123;userAge&#125;,#&#123;userAddress&#125;)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addNewUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æ–¹å¼2-SQLå•ç‹¬ç”¨Stringå®šä¹‰"><a href="#æ–¹å¼2-SQLå•ç‹¬ç”¨Stringå®šä¹‰" class="headerlink" title="æ–¹å¼2: SQLå•ç‹¬ç”¨Stringå®šä¹‰"></a>æ–¹å¼2: SQLå•ç‹¬ç”¨Stringå®šä¹‰</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDAO</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> addNewUserSql <span class="token operator">=</span> 
            <span class="token string">"INSERT INTO user(userName,userAge,userAddress) VALUES(#&#123;userName&#125;,"</span>
            <span class="token operator">+</span> <span class="token string">"#&#123;userAge&#125;,#&#123;userAddress&#125;)"</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span>addNewUserSql<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addNewUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="xml-sqlçš„ä¼˜åŠ¿"><a href="#xml-sqlçš„ä¼˜åŠ¿" class="headerlink" title="xml sqlçš„ä¼˜åŠ¿"></a>xml sqlçš„ä¼˜åŠ¿</h1><p>ç”±äºsqlæ˜¯æ”¾åœ¨xmlé‡Œ, å› æ­¤: </p>
<ol>
<li>é‡å»ºSQLæ—¶, å¯ä»¥ç›´æ¥æŠŠSQLæ‹·è´å‡ºæ¥, äººè‚‰æ›¿æ¢å‚æ•°å³å¯.</li>
<li>ä¿®æ”¹SQLæ—¶, æ˜“è¯»æ€§è¦å¥½å¾ˆå¤š.</li>
<li>å¦å¤–ä¸€ä¸ªä¼˜åŠ¿, <a href="http://www.mybatis.cn/archives/695.html">XMLæ–‡ä»¶çš„SQLç‰‡æ®µçš„å¤ç”¨æä¸ºå¥½ç”¨</a>.</li>
</ol>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
    <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edu.xmu.mybatis.somemapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        SELECT id
        FROM `user`
        WHERE user_name = #&#123;userName&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="xml-sqlçš„é…ç½®"><a href="#xml-sqlçš„é…ç½®" class="headerlink" title="xml sqlçš„é…ç½®"></a>xml sqlçš„é…ç½®</h1><h2 id="ç¬¬ä¸€æ­¥-mapper-interfaceå®šä¹‰"><a href="#ç¬¬ä¸€æ­¥-mapper-interfaceå®šä¹‰" class="headerlink" title="ç¬¬ä¸€æ­¥: mapper interfaceå®šä¹‰"></a>ç¬¬ä¸€æ­¥: mapper interfaceå®šä¹‰</h2><ul>
<li>æ³¨æ„ä¸€å®šè¦ä½¿ç”¨ <code>@Repository</code> æ³¨é‡Š <code>UserMapper</code>, å¦åˆ™è¯¥Mapperæ— æ³•è¢«Springå®¹å™¨ç®¡ç†</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>somemapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * SQLMapæ–‡ä»¶å‚è§: &#123;@linkplain UserMapper.xml&#125;
 *
 * @author kunlun.ykl
 */</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * æ ¹æ®userNameè·å–userId
     *
     * @param userName
     * @return
     */</span>
    <span class="token class-name">Integer</span> <span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ç¬¬äºŒæ­¥-mapper-xmlæ–‡ä»¶"><a href="#ç¬¬äºŒæ­¥-mapper-xmlæ–‡ä»¶" class="headerlink" title="ç¬¬äºŒæ­¥: mapper xmlæ–‡ä»¶"></a>ç¬¬äºŒæ­¥: mapper xmlæ–‡ä»¶</h2><ul>
<li>æ³¨æ„mapperæ–‡ä»¶ä¸€å®šè¦æ”¾åœ¨ <code>src/main/resources/edu/xmu/mybatis/somemapper/</code> ç›®å½•ä¸‹</li>
<li>ä¸”mapperæ–‡ä»¶åä¸€å®šè¦ä¸interfaceçš„åç§°ä¸€æ ·, å³æœ¬ä¾‹ä¸­ <code>UserMapper.xml</code></li>
</ul>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
    <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edu.xmu.mybatis.somemapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        SELECT id
        FROM `user`
        WHERE user_name = #&#123;userName&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>springboot</tag>
        <tag>mybatis</tag>
        <tag>xml</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼‚æ­¥HttpClientä½¿ç”¨Nettyä½œä¸ºSocketChannelçš„Provider</title>
    <url>//2022-03-14-http-client-netty/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>com<span class="token punctuation">.</span>ning<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>async<span class="token operator">-</span>http<span class="token operator">-</span>client<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">1.9</span><span class="token number">.40</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>io<span class="token punctuation">.</span>netty<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>netty<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">3.10</span><span class="token number">.6</span><span class="token punctuation">.</span>Final<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="AsyncHttpClient-é‡è¦å‚æ•°ä¸ä½¿ç”¨æŒ‡å—"><a href="#AsyncHttpClient-é‡è¦å‚æ•°ä¸ä½¿ç”¨æŒ‡å—" class="headerlink" title="AsyncHttpClient é‡è¦å‚æ•°ä¸ä½¿ç”¨æŒ‡å—"></a>AsyncHttpClient é‡è¦å‚æ•°ä¸ä½¿ç”¨æŒ‡å—</h1><h2 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">allowPoolingConnections<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="ä½¿ç”¨æŒ‡å—"><a href="#ä½¿ç”¨æŒ‡å—" class="headerlink" title="ä½¿ç”¨æŒ‡å—"></a>ä½¿ç”¨æŒ‡å—</h2><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="IOçº¿ç¨‹æ± æœ€å¥½ä¸è¦ç”¨CachedThreadPoolâ€“-gt-æ­¤å¤„å­˜ç–‘-æš‚æ—¶æ— æ³•å¤ç°ä»»åŠ¡è¢«Rejectedåœºæ™¯"><a href="#IOçº¿ç¨‹æ± æœ€å¥½ä¸è¦ç”¨CachedThreadPoolâ€“-gt-æ­¤å¤„å­˜ç–‘-æš‚æ—¶æ— æ³•å¤ç°ä»»åŠ¡è¢«Rejectedåœºæ™¯" class="headerlink" title="IOçº¿ç¨‹æ± æœ€å¥½ä¸è¦ç”¨CachedThreadPoolâ€“&gt;æ­¤å¤„å­˜ç–‘, æš‚æ—¶æ— æ³•å¤ç°ä»»åŠ¡è¢«Rejectedåœºæ™¯"></a>IOçº¿ç¨‹æ± æœ€å¥½ä¸è¦ç”¨CachedThreadPoolâ€“&gt;æ­¤å¤„å­˜ç–‘, æš‚æ—¶æ— æ³•å¤ç°ä»»åŠ¡è¢«Rejectedåœºæ™¯</h3><ul>
<li>å¦‚ä¸‹æ ·ä¾‹, ioThreadçº¿ç¨‹æ± åªæœ‰10, å¹¶å‘çš„è¯·æ±‚æœ‰100, ç”±äº<code>Executors.newCachedThreadPool</code>å†…éƒ¨ä½¿ç”¨<code>SynchronousQueue</code>, ä»è€Œå¯¼è‡´çªå‘çš„è¯·æ±‚ä¼šè¢«Rejectæ‰.</li>
<li>å¦‚æœè¦ç”¨ä¹Ÿè¦è¯„ä¼°å¥½å®¹é‡, sizeä¸€å®šè¦å¤§äº, é˜²æ­¢Rejectè¯·æ±‚??</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> ioThreadPool<span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultThreadFactory</span><span class="token punctuation">(</span>workerThreadPoolName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">setExecutorService</span><span class="token punctuation">(</span>ioThreadPool<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// boss</span>
        <span class="token class-name">String</span> bossThreadPoolName<span class="token operator">=</span><span class="token string">"AsyncHttpClient-Dispatcher"</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> bossThreadPool<span class="token operator">=</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultThreadFactory</span><span class="token punctuation">(</span>bossThreadPoolName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">NioClientSocketChannelFactory</span> socketChannelFactory<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NioClientSocketChannelFactory</span><span class="token punctuation">(</span>
        bossThreadPool<span class="token punctuation">,</span>ioThreadPool<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"http://www.baidu.com/"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">doAsyncGet</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="å•ç‹¬å®šä¹‰Workerçº¿ç¨‹æ± -ä¸IOçº¿ç¨‹æ± åˆ†å¼€"><a href="#å•ç‹¬å®šä¹‰Workerçº¿ç¨‹æ± -ä¸IOçº¿ç¨‹æ± åˆ†å¼€" class="headerlink" title="å•ç‹¬å®šä¹‰Workerçº¿ç¨‹æ± , ä¸IOçº¿ç¨‹æ± åˆ†å¼€"></a>å•ç‹¬å®šä¹‰Workerçº¿ç¨‹æ± , ä¸IOçº¿ç¨‹æ± åˆ†å¼€</h3><p>å¦‚ä¸‹, åœ¨<code>onCompleted()</code>é‡Œæ‰§è¡Œæ—¶, æœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨IOçº¿ç¨‹é‡Œæ‰§è¡Œ, æ­¤æ—¶TCPè¿æ¥ä»ç„¶æ˜¯ESTABLISHEDçŠ¶æ€.<br>åªæœ‰å½“<code>onCompleted()</code>æ–¹æ³•æ‰§è¡Œå®Œæˆ, åº•å±‚çš„TCPè¿æ¥æ‰ä¼šæˆ–è€…æ”¾å›è¿æ¥æ± ä¸­(allowPoolingConnections&#x3D;true, ä»¥ä¾¿å…¶ä»–è¯·æ±‚å¤ç”¨), æˆ–è€…å…³é—­(allowPoolingConnections&#x3D;false)<br>å¦‚æœåœ¨<code>onCompleted()</code>é‡Œæ‰§è¡Œå¾ˆè€—æ—¶çš„æ“ä½œ, å°±ä¼š</p>
<ol>
<li>å ç”¨ç€TCPè¿æ¥æ— æ³•å¤ç”¨&#x2F;å…³é—­, é€ æˆèµ„æºæµªè´¹.</li>
<li>å ç”¨IOçº¿ç¨‹, å¯¼è‡´å…¶ä»–IOä»»åŠ¡ç­‰å¾….<br>ç”±äºæ­¤æ—¶http responseå·²ç»å®Œå…¨è¯»å–å®Œæ¯•, å› æ­¤å¯ä»¥å°†responseä¸¢è¿›workerçº¿ç¨‹æ± ä¸­, æ‰§è¡Œè€—æ—¶çš„ä¸šåŠ¡æ“ä½œ. ä»è€ŒæŠŠTCPè¿æ¥å¤ç”¨&#x2F;å…³é—­.<br>å¦‚ä¸‹æ ·ä¾‹, å¯¼è‡´100ä¸ªTCPè¿æ¥ä¸€ç›´å¤„äºESTABLISHEDçŠ¶æ€</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CommonCallback</span> <span class="token keyword">extends</span> <span class="token class-name">AsyncCompletionHandler</span> <span class="token punctuation">&#123;</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">onCompleted</span><span class="token punctuation">(</span><span class="token class-name">Response</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTimeInMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ­¤æ—¶TCPè¿æ¥ä»ç„¶æ˜¯ESTABLISHEDçŠ¶æ€</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042218576.png"></p>
<h3 id="å½“è®¾ç½®äº†maxConnectionsPerHostæ—¶-allowPoolingConnectionsæœ€å¥½è®¾ç½®ä¸ºtrue-å¹¶ä¸”è¯·æ±‚æœ€å¥½ä¸è¦ç¬æ—¶å¹¶å‘"><a href="#å½“è®¾ç½®äº†maxConnectionsPerHostæ—¶-allowPoolingConnectionsæœ€å¥½è®¾ç½®ä¸ºtrue-å¹¶ä¸”è¯·æ±‚æœ€å¥½ä¸è¦ç¬æ—¶å¹¶å‘" class="headerlink" title="å½“è®¾ç½®äº†maxConnectionsPerHostæ—¶, allowPoolingConnectionsæœ€å¥½è®¾ç½®ä¸ºtrue, å¹¶ä¸”è¯·æ±‚æœ€å¥½ä¸è¦ç¬æ—¶å¹¶å‘"></a>å½“è®¾ç½®äº†maxConnectionsPerHostæ—¶, allowPoolingConnectionsæœ€å¥½è®¾ç½®ä¸ºtrue, å¹¶ä¸”è¯·æ±‚æœ€å¥½ä¸è¦ç¬æ—¶å¹¶å‘</h3><p>å¦åˆ™å¦‚ä¸‹ä¾‹å­, è¯·æ±‚å°±ä¸ä¼šæ’é˜Ÿäº†, TCPè¿æ¥ä¹Ÿæ— æ³•é‡ç”¨, ç›´æ¥è¿›å…¥äº†Handlerçš„<code>onThrowable()</code>æ–¹æ³•é‡Œ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">doAsyncGet</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿™é‡Œæœ€å¥½æ ¹æ®å¹³å‡å¤„ç†æ—¶é•¿, è®¾ç½®ä¸€ä¸ªsleepæ—¶é•¿, ä¾¿äºTCPè¿æ¥å›æ”¶å›æ± å­é‡Œ, ä»è€Œä¸è¶…è¿‡maxConnectionsPerHosté˜ˆå€¼</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="AsyncHttpClient-å‚æ•°é€‚ç”¨åœºæ™¯"><a href="#AsyncHttpClient-å‚æ•°é€‚ç”¨åœºæ™¯" class="headerlink" title="AsyncHttpClient å‚æ•°é€‚ç”¨åœºæ™¯"></a>AsyncHttpClient å‚æ•°é€‚ç”¨åœºæ™¯</h1><h2 id="åœºæ™¯1-ä¸è¾ƒå°‘æ•°é‡çš„Server-é€šä¿¡é¢‘ç¹æˆ–è€…æœ‰å¤§é‡æ•°æ®è¦ä¼ è¾“-éœ€è¦ç»´æŒTCPé•¿è¿æ¥"><a href="#åœºæ™¯1-ä¸è¾ƒå°‘æ•°é‡çš„Server-é€šä¿¡é¢‘ç¹æˆ–è€…æœ‰å¤§é‡æ•°æ®è¦ä¼ è¾“-éœ€è¦ç»´æŒTCPé•¿è¿æ¥" class="headerlink" title="åœºæ™¯1: ä¸è¾ƒå°‘æ•°é‡çš„Server, é€šä¿¡é¢‘ç¹æˆ–è€…æœ‰å¤§é‡æ•°æ®è¦ä¼ è¾“, éœ€è¦ç»´æŒTCPé•¿è¿æ¥"></a>åœºæ™¯1: ä¸è¾ƒå°‘æ•°é‡çš„Server, é€šä¿¡é¢‘ç¹æˆ–è€…æœ‰å¤§é‡æ•°æ®è¦ä¼ è¾“, éœ€è¦ç»´æŒTCPé•¿è¿æ¥</h2><ul>
<li>æœ¬è´¨ä¸Šæ¥è¯´å°±æ˜¯<ul>
<li>å½“å»ºç«‹&#x2F;ç»´æŒTCPè¿æ¥çš„æˆæœ¬é«˜äºä¼ è¾“æˆæœ¬æ—¶, å¯ä»¥é€‰æ‹©é•¿è¿. ä¸è®ºæ˜¯TCPé•¿è¿æ¥, è¿˜æ˜¯HttpClientåŸºäºTCPçš„è¿æ¥å¤ç”¨.</li>
<li>éœ€è¦æœåŠ¡ç«¯éœ€è¦ä¸å®šæœŸå‘å®¢æˆ·ç«¯æ¨é€æ•°æ®.</li>
</ul>
</li>
<li>å®é™…åœºæ™¯: <ul>
<li>å¤§æ–‡ä»¶çš„ä¸‹è½½(åŸºäºHTTP&#x2F;TCPåè®®)</li>
<li>HTTP&#x2F;1.1, å³è®¿é—®æŸä¸ªç½‘ç«™æ—¶, çŸ­æ—¶é—´å†…éœ€è¦å¾€è¯¥Hostå‘é€Nå¤šHTTPè¯·æ±‚.</li>
<li>K8S Watchæœºåˆ¶, ä½¿ç”¨çš„æ˜¯HTTP Streamingæœºåˆ¶æˆ–è€…WebSocketæœºåˆ¶, æœ¬è´¨ä¸Šè¿˜æ˜¯TCPé•¿è¿æ¥.</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">allowPoolingConnections <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
pooledConnectionIdleTimeout <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// è®¾å®šæ± å­é‡Œç©ºé—²TCPè¿æ¥çš„ä¿æŒæ—¶é—´, å¤§äºè¯¥æ—¶é•¿, åˆ™TCPè¿æ¥è¢«å…³é—­, ä»è¿æ¥æ± ä¸­ç§»é™¤</span>
<span class="token comment">// maxConnectionsPerHost = 100; // è®¾å®šå¾€æ¯ä¸ªHOSTçš„æœ€å¤§å¯ä»¥è¿æ¥æ•°é‡, å¤§äºè¯¥è¿æ¥çš„è¯·æ±‚, ä¼šè¿›å…¥åˆ°Handlerçš„onThrowableé‡Œ (è¿™é‡ŒHOSTæ˜¯&#123;HOST_IP, PORT&#125; è¿˜æ˜¯ HOST_IP? å¾…éªŒè¯)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="åœºæ™¯2-ä¸è¾ƒå¤šæ•°é‡çš„Server-æ¯ä¸ªServerä¼ è¾“è¾ƒå°‘çš„æ•°æ®-å¯ä»¥ä¸ç”¨è¿æ¥å¤ç”¨-ä½¿ç”¨TCPçŸ­è¿æ¥"><a href="#åœºæ™¯2-ä¸è¾ƒå¤šæ•°é‡çš„Server-æ¯ä¸ªServerä¼ è¾“è¾ƒå°‘çš„æ•°æ®-å¯ä»¥ä¸ç”¨è¿æ¥å¤ç”¨-ä½¿ç”¨TCPçŸ­è¿æ¥" class="headerlink" title="åœºæ™¯2: ä¸è¾ƒå¤šæ•°é‡çš„Server, æ¯ä¸ªServerä¼ è¾“è¾ƒå°‘çš„æ•°æ®, å¯ä»¥ä¸ç”¨è¿æ¥å¤ç”¨, ä½¿ç”¨TCPçŸ­è¿æ¥"></a>åœºæ™¯2: ä¸è¾ƒå¤šæ•°é‡çš„Server, æ¯ä¸ªServerä¼ è¾“è¾ƒå°‘çš„æ•°æ®, å¯ä»¥ä¸ç”¨è¿æ¥å¤ç”¨, ä½¿ç”¨TCPçŸ­è¿æ¥</h2><ul>
<li>å®é™…åœºæ™¯: <ul>
<li>çˆ¬è™«, éœ€è¦çˆ¬å–Nå¤šä¸ªServerçš„æ ‡é¢˜&#x2F;æ¦‚è¦ä¿¡æ¯, æ„æˆç½‘ç«™åœ°å›¾, æ¯ä¸ªServer&#x2F;Hostçš„å†…å®¹é‡è¾ƒå°‘. (å½“ç„¶å¦‚æœæ˜¯å•ä¸ªServeræœ‰Nå¤šå†…å®¹è¦çˆ¬å–, ä¹Ÿå¯ä»¥ä½¿ç”¨é•¿è¿æ¥)</li>
</ul>
</li>
<li>å®é™…å‚æ•°:</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">allowPoolingConnections <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// æ²¡å¿…è¦æŠŠTCPè¿æ¥æ”¾è¿›æ± å­é‡Œ, å› ä¸ºåç»­çŸ­æœŸå¤§æ¦‚ç‡å°±ä¸ä¼šå†è·Ÿè¯¥Hostå»ºç«‹TCPè¿æ¥</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="AsyncHttpClient-amp-Netty"><a href="#AsyncHttpClient-amp-Netty" class="headerlink" title="AsyncHttpClient &amp; Netty"></a>AsyncHttpClient &amp; Netty</h1><h1 id="AsyncHttpClient-amp-å…¶ä»–Provider"><a href="#AsyncHttpClient-amp-å…¶ä»–Provider" class="headerlink" title="AsyncHttpClient &amp; å…¶ä»–Provider"></a>AsyncHttpClient &amp; å…¶ä»–Provider</h1><h2 id="AsyncHttpClient-amp-JDK"><a href="#AsyncHttpClient-amp-JDK" class="headerlink" title="AsyncHttpClient &amp; JDK"></a>AsyncHttpClient &amp; JDK</h2><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li>è¯¦ç»†çš„æµ‹è¯•æ ·ä¾‹: <a href="https://gitee.com/null_894_2517/test-core/blob/d504b14564ef7d6e2ee4a2b3a8379f62cdf894ee/src/test/java/edu/xmu/test/javaweb/httpclient/HttpAsyncClientTest.java">HttpAsyncClientTest.java</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>httpclient</tag>
        <tag>asynchttpclient</tag>
        <tag>netty</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerçš„ä¸€äº›æ€»ç»“</title>
    <url>//2022-03-18-docker-summary/</url>
    <content><![CDATA[<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li><p>åœ¨Linuxä¸Šçš„Docker, æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨äº†</p>
<ol>
<li><code>cgroups</code>: æœ¬è´¨ä¸Šæ˜¯Linuxå†…æ ¸æä¾›çš„èµ„æºQuotaçº¦æŸæœºåˆ¶, åŒ…æ‹¬cpu&#x2F;mem&#x2F;ioç­‰</li>
<li><code>namespace</code>: <a href="https://yeasy.gitbook.io/docker_practice/underly/namespace">å‘½åç©ºé—´</a>, åŒ…æ‹¬pid, net, ipc, mnt(æ–‡ä»¶ç›®å½•root), uts, user(å³username, groupç­‰)  </li>
<li><code>UnionFS</code>: æ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚</li>
<li>æ“ä½œç³»ç»Ÿç­‰, æœ¬è´¨æ˜¯å…±äº«å†…æ ¸, æ‰€ä»¥ä¸éœ€è¦æ“ä½œç³»ç»Ÿè¿›è¡Œè™šæ‹ŸåŒ–. å¯ä»¥è®¤ä¸ºæ¯ä¸ªDockerå®¹å™¨åªæ˜¯ä¸€ä¸ªå¾ˆè½»é‡çš„æ–‡ä»¶ç›®å½•&amp;èµ„æºéš”ç¦»</li>
<li>åªèƒ½åˆ›å»ºlinuxç±»docker</li>
<li>æ¯ä¸ªDockerå®¹å™¨, åœ¨Linuxä¸Šå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹. ä½†å¦‚æœDockerå®¹å™¨å†…éƒ¨, æœ¬èº«å¯åŠ¨äº†å¤šä¸ªè¿›ç¨‹, ä¾‹å¦‚Nginxå®¹å™¨å¯åŠ¨3ä¸ªè¿›ç¨‹, é‚£ä¹ˆåœ¨Hostä¸Šè¡¨ç°ä¸ºå•¥?<blockquote>
<p>It is generally recommended that you separate areas of concern by using one service per container.<br>That service may fork into multiple processes (for example, Apache web server starts multiple worker processes).<br>Itâ€™s ok to have multiple processes, but to get the most benefit out of Docker, avoid one container being responsible for multiple aspects of your overall application.<br>You can connect multiple containers using user-defined networks and shared volumes.</p>
</blockquote>
</li>
</ol>
</li>
<li><p>åœ¨Macä¸Šçš„Docker </p>
<ol>
<li>åŒæ ·ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯xhyveæˆ–è€…virtualboxæ¥å®ç°, ä¸å…±äº«mac oså†…æ ¸ã€‚update 2022, macä¸Šçš„Dockerä½¿ç”¨ <a href="https://github.com/moby/hyperkit">hyperkit VM</a> ä½œä¸ºæ ¸å¿ƒç»„ä»¶.</li>
<li>åªèƒ½åˆ›å»ºlinuxç±»dockerï¼Œä¸èƒ½åˆ›å»ºMac OSXçš„docker. update 2022, <a href="https://github.com/sickcodes/Docker-OSX">Docker-OSX</a> é¡¹ç›®å¯ä»¥äº†. ä½†æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä½¿ç”¨äº†KVMè™šæ‹Ÿæœº.</li>
</ol>
</li>
<li><p>Windowsçš„Docker</p>
<ol>
<li>ä¸èƒ½åœ¨Linuxæœºå™¨ä¸Šä½¿ç”¨windowsçš„dockeré•œåƒ. å‚è§: <a href="https://stackoverflow.com/questions/42158596/can-windows-containers-be-hosted-on-linux">can-windows-containers-be-hosted-on-linux</a><ol>
<li>å› ä¸ºdockeråœ¨Linuxä¸Šæœ¬è´¨æ˜¯ä½¿ç”¨äº†Linux HostOSçš„ <code>cgroups</code> <code>namespace</code> ç­‰. è€ŒWindows</li>
</ol>
</li>
<li>å¯ä»¥åœ¨Windowsæœºå™¨ä¸Šä½¿ç”¨Linuxçš„dockeré•œåƒ, ä¾‹å¦‚å¯ä»¥åˆ›å»º<code>alpine</code> <code>busybox</code> ç­‰<ol>
<li>å› ä¸ºæœ¬è´¨ä¸Šæ˜¯åœ¨Windowsæœºå™¨ä¸Šåˆ›å»ºäº†ä¸€ä¸ªLinuxçš„è™šæ‹Ÿæœº, è€ŒLinuxçš„Dockerå…¨éƒ½æ˜¯åŸºäºè¯¥è™šæ‹Ÿæœºçš„.</li>
</ol>
</li>
</ol>
</li>
<li><p>Running&#x2F;Stoppedçš„å®¹å™¨, å…¶é•œåƒæ˜¯ä¸èƒ½è¢«åˆ é™¤çš„(é™¤éå¼ºåˆ¶åˆ é™¤). å¯åŠ¨å®¹å™¨çš„æ—¶å€™, éœ€è¦é‡æ–°ä½¿ç”¨é•œåƒä½œä¸ºæ¨¡æ¿.</p>
</li>
<li><p>Docker vs. VM</p>
<blockquote>
<p>å‰å°æ‰§è¡Œå’Œåå°æ‰§è¡Œçš„é—®é¢˜ï¼š<br>Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œï¼Œè€Œä¸æ˜¯åƒè™šæ‹Ÿæœºã€ç‰©ç†æœºé‡Œé¢é‚£æ ·ï¼Œç”¨ start &#x2F; systemctl å»å¯åŠ¨åå°æœåŠ¡ï¼Œå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚<br>æ¯”å¦‚ï¼šå¦‚æœæˆ‘ä»¬å°†CMD å†™æˆè¿™æ ·ï¼š<br>CMD service nginx start<br>ç„¶åä¼šå‘ç°å®¹å™¨æ‰§è¡Œåå°±ç«‹åˆ»é€€å‡ºäº†ï¼Œç”šè‡³åœ¨å®¹å™¨å†…ä½¿ç”¨systemctl å‘½ä»¤ç»“æœå´å‘ç°æ ¹æœ¬æ‰§è¡Œä¸äº†ã€‚è¿™å°±æ˜¯å› ä¸ºæ²¡æœ‰ææ˜ç™½å‰å°ã€åå°çš„æ¦‚å¿µï¼Œæ²¡æœ‰åŒºåˆ†å®¹å™¨å’Œè™šæ‹Ÿæœºçš„å·®å¼‚ï¼Œä¾æ—§åœ¨ä»¥ä¼ ç»Ÿè™šæ‹Ÿæœºçš„è§’åº¦å»ç†è§£å®¹å™¨<br>å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚<br>è€Œä½¿ç”¨ service nginx start å‘½ä»¤ï¼Œåˆ™æ˜¯å¸Œæœ› start æ¥å·²åå°å®ˆæŠ¤è¿›ç¨‹å½¢å¼å¯åŠ¨nginxæœåŠ¡ã€‚è€Œ CMD service nginx start ä¼šè¢«ç†è§£ä¸º CMD [â€œshâ€, â€œ-câ€, â€œservice nginx startâ€]ï¼Œå› æ­¤ä¸»è¿›ç¨‹å®é™…ä¸Šæ˜¯shï¼Œ é‚£ä¹ˆå½“service nginx start å‘½ä»¤ç»“æŸåï¼Œsh ä¹Ÿå°±ç»“æŸäº†ï¼Œ sh ä½œä¸ºä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œè‡ªç„¶å°±ä¼šä»¤å®¹å™¨é€€å‡ºã€‚<br>æ­£ç¡®çš„åšæ³•æ˜¯ç›´æ¥æ‰§è¡Œ nginx å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚ä»¥å‰å°å½¢å¼ã€‚å¦‚ï¼š<br>CMD [â€œnginxâ€, â€œ-gâ€,â€ daemon off;â€]</p>
</blockquote>
</li>
</ol>
<h1 id="ç–‘é—®ä¸æ€è€ƒ"><a href="#ç–‘é—®ä¸æ€è€ƒ" class="headerlink" title="ç–‘é—®ä¸æ€è€ƒ"></a>ç–‘é—®ä¸æ€è€ƒ</h1><ol>
<li>Dockerå®¹å™¨ä¸­çš„å¤šä¸ªè¿›ç¨‹, <a href="">åœ¨Hostä¸Šçœ‹èµ·æ¥æ˜¯æ€æ ·çš„</a>? </li>
<li>Dockeré•œåƒåœ¨Hostä¸Šå­˜æ”¾çš„è·¯å¾„æ˜¯å“ªé‡Œ?<ol>
<li>MacOS: <code>~/Library/Containers/com.docker.docker/Data/vms/0/</code></li>
</ol>
</li>
<li>Dockerå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€æ ·çš„? ä¸ºå•¥Stopä¹‹åè¿˜éœ€è¦Removeæ‰? å¦‚æœä¸Remove, ä¼šæ€æ ·?</li>
<li>è¯¥é€‰ç”¨å“ªä¸ª&#x2F;å“ªç§é•œåƒä½œä¸ºåŸºç¡€ç³»ç»Ÿé•œåƒ? å‚è§: <a href="http://crunchtools.com/comparison-linux-container-images/">comparison-linux-container-images</a></li>
</ol>
<h1 id="æ·±å…¥æœºåˆ¶æ¢è®¨ä¸ç ”ç©¶"><a href="#æ·±å…¥æœºåˆ¶æ¢è®¨ä¸ç ”ç©¶" class="headerlink" title="æ·±å…¥æœºåˆ¶æ¢è®¨ä¸ç ”ç©¶"></a>æ·±å…¥æœºåˆ¶æ¢è®¨ä¸ç ”ç©¶</h1><h2 id="é•œåƒCacheæœºåˆ¶"><a href="#é•œåƒCacheæœºåˆ¶" class="headerlink" title="é•œåƒCacheæœºåˆ¶"></a>é•œåƒCacheæœºåˆ¶</h2><p>çœ‹äº†Dockerå®˜æ–¹æ–‡æ¡£å…³äº <a href="https://docs.docker.com/get-started/09_image_best/#layer-caching">layer-caching</a> çš„ä»‹ç», ä¸å¤ªç†è§£å…·ä½“æ€ä¹ˆåˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨ç¼“å­˜.<br>è¿˜å¥½ <a href="http://open.daocloud.io/docker-build-de-cache-ji-zhi/">docker build çš„ cache æœºåˆ¶</a> æ–‡ç« å¾ˆæ¸…æ™°åœ°è§£é‡Šäº†è¿™ä¸ªç–‘é—®. è¿™é‡Œè‡ªå·±æ€»ç»“ä¸‹: </p>
<h3 id="åŸå§‹çš„Dockerfileå¦‚ä¸‹"><a href="#åŸå§‹çš„Dockerfileå¦‚ä¸‹" class="headerlink" title="åŸå§‹çš„Dockerfileå¦‚ä¸‹"></a>åŸå§‹çš„Dockerfileå¦‚ä¸‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM node:12-alpine
<span class="token comment"># Adding build tools to make yarn install work on Apple silicon / arm64 machines</span>
WORKDIR /app
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
RUN <span class="token function">yarn</span> <span class="token function">install</span> --production
CMD <span class="token punctuation">[</span><span class="token string">"node"</span>, <span class="token string">"src/index.js"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å­˜åœ¨çš„é—®é¢˜:</p>
<ol>
<li>ç”±äºç¬¬äºŒå±‚æ˜¯ <code>COPY . .</code> å› æ­¤æ ¹æ®å¦‚ä¸‹åŸåˆ™<blockquote>
<p>åˆ¤æ–­ ADD å‘½ä»¤æˆ–è€… COPY å‘½ä»¤åç´§æ¥çš„æ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåˆ™æˆä¸ºæ˜¯å¦å»¶ç”¨ cache çš„é‡è¦ä¾æ®ã€‚<br>Docker é‡‡å–çš„ç­–ç•¥æ˜¯ï¼šè·å– Dockerfile ä¸‹å†…å®¹ï¼ˆåŒ…æ‹¬æ–‡ä»¶çš„éƒ¨åˆ† inode ä¿¡æ¯ï¼‰ï¼Œ<br>è®¡ç®—å‡ºä¸€ä¸ªå”¯ä¸€çš„ hash å€¼ï¼Œè‹¥ hash å€¼æœªå‘ç”Ÿå˜åŒ–ï¼Œåˆ™å¯ä»¥è®¤ä¸ºæ–‡ä»¶å†…å®¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ cache æœºåˆ¶ï¼›åä¹‹äº¦ç„¶ã€‚</p>
</blockquote>
</li>
<li>å³ä½¿æˆ‘ä»¬åªä¿®æ”¹äº†åº”ç”¨çš„æŸä¸ªstatic&#x2F;jsæ–‡ä»¶, æ²¡æœ‰ä¿®æ”¹nodeçš„ä¾èµ–(å³package.json), ç¬¬äºŒå±‚<code>COPY . .</code>æ˜¯ä¸ä¼šå‘½ä¸­ç¼“å­˜çš„</li>
<li>å› æ­¤æ ¹æ®å¦‚ä¸‹åŸåˆ™,ç¬¬ä¸‰å±‚<code>RUN yarn install --production</code>ä¹Ÿä¸ä¼šå‘½ä¸­ç¼“å­˜, éœ€è¦é‡æ–°è¿›è¡Œä¾èµ–çš„å®‰è£…, ä»è€Œæ„å»ºå‡ºæ–°çš„é•œåƒå±‚æ¬¡(Image Layer), è€Œè¿™ä¸ªæ˜¯å¾ˆè€—æ—¶çš„æ“ä½œ.<blockquote>
<p>Once a layer changes, all downstream layers have to be recreated as well</p>
</blockquote>
</li>
</ol>
<h3 id="æ”¹è¿›çš„Dockerfileå¦‚ä¸‹"><a href="#æ”¹è¿›çš„Dockerfileå¦‚ä¸‹" class="headerlink" title="æ”¹è¿›çš„Dockerfileå¦‚ä¸‹:"></a>æ”¹è¿›çš„Dockerfileå¦‚ä¸‹:</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM node:12-alpine
WORKDIR /app
COPY package.json yarn.lock ./
RUN <span class="token function">yarn</span> <span class="token function">install</span> --production
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
CMD <span class="token punctuation">[</span><span class="token string">"node"</span>, <span class="token string">"src/index.js"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¥½å¤„åˆ†æ: </p>
<ol>
<li>å¦‚æœ<code>package.json</code>æ–‡ä»¶ä¿®æ”¹, é‚£ä¹ˆç”±äºæ–‡ä»¶hashå€¼å˜åŒ–, å› æ­¤ç¬¬äºŒå±‚<code>COPY package.json yarn.lock ./</code>å¿…ç„¶å¤±æ•ˆ, ä»è€Œç¬¬ä¸‰å±‚ä¹Ÿå¤±æ•ˆ, è¿›å…¥è€—æ—¶çš„<code>yarn install</code>é˜¶æ®µ, ç¬¦åˆé¢„æœŸ.</li>
<li>å¦‚æœ<code>package.json</code>æ–‡ä»¶æœªä¿®æ”¹, åªæ˜¯ä¿®æ”¹äº†åº”ç”¨çš„æŸä¸ªstatic&#x2F;jsæ–‡ä»¶, é‚£ä¹ˆç¬¬äºŒå±‚<code>COPY package.json yarn.lock ./</code>å¿…ç„¶ä¸ä¼šå¤±æ•ˆ, ä»è€Œç¬¬ä¸‰å±‚ä¹Ÿä¸ä¼šå¤±æ•ˆ, ä»è€Œè·³è¿‡äº†è€—æ—¶çš„<code>yarn install</code>é˜¶æ®µ, æœ€å¤§åŒ–åœ°åˆ©ç”¨äº†ç¼“å­˜.</li>
</ol>
<h3 id="RUN-å‘½ä»¤å­˜åœ¨å¤–éƒ¨ä¾èµ–"><a href="#RUN-å‘½ä»¤å­˜åœ¨å¤–éƒ¨ä¾èµ–" class="headerlink" title="RUN å‘½ä»¤å­˜åœ¨å¤–éƒ¨ä¾èµ–"></a>RUN å‘½ä»¤å­˜åœ¨å¤–éƒ¨ä¾èµ–</h3><p>å¦‚æœRUNå‘½ä»¤å­˜åœ¨å¤–éƒ¨ä¾èµ–, å¦‚<br><code>RUN apt-get update</code><br><code>RUN git clone -q https://github.com/docker-in-practice/todo.git</code><br>ç­‰.<br>é‚£ä¹ˆéšç€æ—¶é—´çš„æ¨ç§», </p>
<ul>
<li>ä¸€å¹´çš„ apt-get update å’Œä¸€å¹´åçš„ apt-get update, ç”±äºè½¯ä»¶æºè½¯ä»¶çš„æ›´æ–°, ä»è€Œå¯¼è‡´äº§ç”Ÿçš„é•œåƒç†è®ºä¸Šåº”è¯¥ä¸åŒ. </li>
<li><code>todo.git</code>ä»£ç åº“è¿›è¡Œäº†æ›´æ–°push<br>å¦‚æœç»§ç»­ä½¿ç”¨ cache æœºåˆ¶, å°†å­˜åœ¨ä¸æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„æƒ…å†µ.<br>åœ¨è¿™ç§æƒ…å†µä¸‹, åœ¨æ„å»ºé•œåƒæ—¶å¯ä»¥å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜, è¿™æ ·æ¯å±‚æ„å»ºæ—¶å‡ä¸ä½¿ç”¨ç¼“å­˜:  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> build --no-cache -t getting-started <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h2 id="å¤šé˜¶æ®µæ„å»º"><a href="#å¤šé˜¶æ®µæ„å»º" class="headerlink" title="å¤šé˜¶æ®µæ„å»º"></a><a href="https://yeasy.gitbook.io/docker_practice/image/multistage-builds">å¤šé˜¶æ®µæ„å»º</a></h2><p>Dockerfile å¤šé˜¶æ®µæ„å»º</p>
<h2 id="é•œåƒæ„å»ºç¼“å­˜åˆ©ç”¨çš„æœ€ä½³å®è·µ"><a href="#é•œåƒæ„å»ºç¼“å­˜åˆ©ç”¨çš„æœ€ä½³å®è·µ" class="headerlink" title="é•œåƒæ„å»ºç¼“å­˜åˆ©ç”¨çš„æœ€ä½³å®è·µ"></a>é•œåƒæ„å»ºç¼“å­˜åˆ©ç”¨çš„æœ€ä½³å®è·µ</h2><ul>
<li><p>åº”è¯¥å°†æ›´å¤šé™æ€çš„å®‰è£…&amp;é…ç½®å‘½ä»¤å°½å¯èƒ½åœ°æ”¾åœ¨ Dockerfile çš„è¾ƒå‰ä½ç½®, å¦‚: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM node:12-alpine
WORKDIR /app
COPY package.json yarn.lock ./
RUN <span class="token function">yarn</span> <span class="token function">install</span> --production
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
CMD <span class="token punctuation">[</span><span class="token string">"node"</span>, <span class="token string">"src/index.js"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><a href="https://www.cnblogs.com/yanjieli/p/10246117.html">å°½é‡å°†RUNå‘½ä»¤åœ¨ä¸€è¡Œä¸­æ‰§è¡Œ</a>ä»¥å‡å°‘é•œåƒçš„å±‚æ¬¡, å¦‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM centos
<span class="token comment">#RUN yum install -y gcc make cmake</span>
<span class="token comment">#RUN wget -O redis.tar.gz "http://download.redis.io/releases/redis-3.2.5.tar.gz" </span>
<span class="token comment">#RUN mkdir -p /usr/src/redis</span>
<span class="token comment">#RUN tar xf redis.tar.gz -C /usr/src/redis --stript-components=1</span>
<span class="token comment">#RUN cd /usr/src/redis</span>
<span class="token comment">#RUN make</span>
<span class="token comment">#RUN make install</span>
<span class="token comment">#æ›¿æ¢æˆä¸€è¡Œ:</span>
RUN yum <span class="token function">install</span> -y gcc <span class="token function">make</span> cmake <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O redis.tar.gz <span class="token string">"http://download.redis.io/releases/redi s-3.2.5.tar.gz"</span>  <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p /usr/src/redis <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> xf redis.tar.gz -C /usr/src/redis --stript-components<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> /usr/src/redis <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>å°½å¯èƒ½çš„ä½¿ç”¨ COPYï¼Œå› ä¸º COPY çš„è¯­ä¹‰å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯å¤åˆ¶æ–‡ä»¶è€Œå·²ï¼Œè€Œ ADD åˆ™åŒ…å«äº†æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œå…¶è¡Œä¸ºä¹Ÿä¸ä¸€å®šå¾ˆæ¸…æ™°ã€‚</p>
<blockquote>
<p>æ¯”å¦‚ &lt;æºè·¯å¾„&gt; å¯ä»¥æ˜¯ä¸€ä¸ª URLï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒDocker å¼•æ“ä¼šè¯•å›¾å»ä¸‹è½½è¿™ä¸ªé“¾æ¥çš„æ–‡ä»¶æ”¾åˆ° &lt;ç›®æ ‡è·¯å¾„&gt; å»ã€‚<br>ä¸‹è½½åçš„æ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®ä¸º 600ï¼Œå¦‚æœè¿™å¹¶ä¸æ˜¯æƒ³è¦çš„æƒé™ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å¢åŠ é¢å¤–çš„ä¸€å±‚ RUN è¿›è¡Œæƒé™è°ƒæ•´ï¼Œ<br>å¦å¤–ï¼Œå¦‚æœä¸‹è½½çš„æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œéœ€è¦è§£å‹ç¼©ï¼Œä¹Ÿä¸€æ ·è¿˜éœ€è¦é¢å¤–çš„ä¸€å±‚ RUN æŒ‡ä»¤è¿›è¡Œè§£å‹ç¼©ã€‚<br>æ‰€ä»¥ä¸å¦‚ç›´æ¥ä½¿ç”¨ RUN æŒ‡ä»¤ï¼Œç„¶åä½¿ç”¨ wget æˆ–è€… curl å·¥å…·ä¸‹è½½ï¼Œå¤„ç†æƒé™ã€è§£å‹ç¼©ã€ç„¶åæ¸…ç†æ— ç”¨æ–‡ä»¶æ›´åˆç†ã€‚<br>å› æ­¤ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®å¹¶ä¸å®ç”¨ï¼Œè€Œä¸”ä¸æ¨èä½¿ç”¨ã€‚</p>
</blockquote>
</li>
<li><p>å°½å¯èƒ½ä½¿ç”¨<a href="https://yeasy.gitbook.io/docker_practice/image/multistage-builds">å¤šé˜¶æ®µæ„å»º</a></p>
</li>
<li><p>å°½å¯èƒ½å‡å°‘é•œåƒå±‚æ¬¡</p>
</li>
<li><p><a href="https://yeasy.gitbook.io/docker_practice/image/commit#shen-yong-docker-commit">æ…ç”¨ docker commit</a>, å¦åˆ™ä¼šå½¢æˆé»‘ç®±é•œåƒ</p>
</li>
</ul>
<h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><h2 id="å®¹å™¨ç”Ÿå‘½å‘¨æœŸ"><a href="#å®¹å™¨ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å®¹å™¨ç”Ÿå‘½å‘¨æœŸ"></a>å®¹å™¨ç”Ÿå‘½å‘¨æœŸ</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122132089.png"></p>
<h2 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h2><ul>
<li><p>ä½¿ç”¨é•œåƒåˆ›å»ºå®¹å™¨, v: æŒ‚è½½volume</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> create -p <span class="token number">3000</span>:3000 --name <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span> <span class="token operator">&lt;</span>the-image-id<span class="token operator">></span>
<span class="token function">docker</span> create -p <span class="token number">3000</span>:3000 -v <span class="token operator">&lt;</span>the-volume-id<span class="token operator">></span>:<span class="token operator">&lt;</span>mount-point<span class="token operator">></span> --name <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span> <span class="token operator">&lt;</span>the-image-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span>
CONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                       NAMES
d2c016a1e2ab   getting-started          <span class="token string">"docker-entrypoint.sâ€¦"</span>   <span class="token number">2</span> minutes ago   Up <span class="token number">2</span> minutes   <span class="token number">0.0</span>.0.0:3000-<span class="token operator">></span><span class="token number">3000</span>/tcp, :::3000-<span class="token operator">></span><span class="token number">3000</span>/tcp   confident_bouman<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨(åŒ…æ‹¬Stopped)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span> -a
<span class="token function">docker</span> container <span class="token function">ls</span> -a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹å®¹å™¨Commandå®Œæ•´åˆ—è¡¨</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span> --no-trunc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹å®¹å™¨è¯¦æƒ…</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> inspect <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>ç™»å½•å®¹å™¨<ul>
<li>-i, â€“interactive ä¿æŒSTDINæ‰“å¼€ï¼Œå³ä½¿æ²¡æœ‰è¿æ¥</li>
<li>-t, â€“tty åˆ†é…ä¸€ä¸ªpseudo-TTY</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span> /bin/sh
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span> /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<ul>
<li>å¯åŠ¨å®¹å™¨</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> start <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<ul>
<li>ä½¿ç”¨é•œåƒåˆ›å»º&amp;å¯åŠ¨å®¹å™¨<ul>
<li>-d - run the container in detached mode (in the background)</li>
<li>-p 80:80 - map port 80 of the host to port 80 in the container</li>
<li>-t Allocate a pseudo-TTY</li>
<li>-i interactive mode</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run -dp <span class="token number">3000</span>:3000 <span class="token operator">&lt;</span>the-image-id<span class="token operator">></span>
<span class="token function">docker</span> run -it busybox<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>åœæ­¢å®¹å™¨</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> stop <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>åˆ é™¤å®¹å™¨</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">rm</span> <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>ä½¿ç”¨å®¹å™¨åˆ›å»ºå¿«ç…§&#x2F;é•œåƒ</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> commit <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span> <span class="token operator">&lt;</span>the-image-id<span class="token operator">></span>
<span class="token function">docker</span> commit <span class="token operator">&lt;</span>the-container-id<span class="token operator">></span> <span class="token operator">&lt;</span>your-docker-namespace<span class="token operator">></span>/<span class="token operator">&lt;</span>the-image-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>ä¸ºä»€ä¹ˆä¸èƒ½åœ¨startå®¹å™¨æ—¶, ä¿®æ”¹port binding?</li>
</ul>
<p>å¦‚ä¸Šæ‰€è¿°, å®¹å™¨ä¸Hostçš„port binding, åªèƒ½åœ¨æ„å»ºé•œåƒæ—¶(create, run)æŒ‡å®š, ä¸ºå•¥ä¸èƒ½åœ¨å®¹å™¨stopä¹‹å, é‡æ–°startçš„æ—¶å€™ä¿®æ”¹å‘¢?<br>ä¾‹å¦‚ nginx çš„æœ¬åœ°é•œåƒ, åˆ›å»ºæ—¶ -p 80:80 (å³æŠŠå®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„80ç«¯å£), åˆ›å»ºå‡ºnginx-1å®¹å™¨, å‘ç°ç”±äºä¸»æœºçš„80ç«¯å£å·²ç»è¢«å ç”¨, å› æ­¤å®¹å™¨å¯åŠ¨å¤±è´¥. å°†nginx-1å®¹å™¨åœæ­¢ä¹‹å, æƒ³è¦ä¿®æ”¹æˆ -p 8080:80, å´å‘ç°docker startå‘½ä»¤æ ¹æœ¬æ²¡æ³•æŒ‡å®šport binding.</p>
<p>åˆå­¦è€…ä¼°è®¡éƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®, çœ‹<a href="https://forums.docker.com/t/solved-edit-container-details-ports-and-restarts-etc/64699">å®˜æ–¹è®ºå›ä¹Ÿæœ‰æ— æ•°äººé—®è¿‡è¿™ä¸ªé—®é¢˜</a>. è¿™ä¸ªå°±æ˜¯è™šæ‹Ÿæœºæ€ç»´ä¸å®¹å™¨æ€ç»´çš„å·®å¼‚å•¦. </p>
<blockquote>
<p>å› ä¸ºdockeré»˜è®¤å®¹å™¨æ˜¯æ— çŠ¶æ€çš„. å› æ­¤å¯åŠ¨çš„å…³é”®é…ç½®éƒ½å·²ç»å›ºåŒ–åœ¨é•œåƒé‡Œäº†. å‡è®¾å¯ä»¥åœ¨å¯åŠ¨æ—¶ä¿®æ”¹port binding, å‡è®¾å®¹å™¨å´©æºƒ, æˆ–è€…å¢åŠ å‰¯æœ¬æ•°é‡, åœ¨æ–°çš„hostä¸Šä½¿ç”¨é•œåƒé‡æ–°åˆ›å»ºæ–°çš„å®¹å™¨æ—¶, è¯¥ä½¿ç”¨ -p 8080:80 è¿˜æ˜¯è¯¥ä½¿ç”¨ -p 80:80 å‘¢? </p>
</blockquote>
<ul>
<li><strong>çœŸçš„æ²¡åŠæ³•åœ¨startæ—¶ä¿®æ”¹ä¹ˆ?</strong> å®é™…æ˜¯å¯ä»¥çš„. æ ¹æ®stackoverflowçš„å»ºè®®, æœ‰å‡ ä¸ªæ–¹æ¡ˆ:</li>
</ul>
<ol>
<li>hackæ–¹å¼: <a href="https://forums.docker.com/t/solved-edit-container-details-ports-and-restarts-etc/64699">ports and restarts</a> æœ¬è´¨æ˜¯ä¿®æ”¹è¯¥å®¹å™¨åœ¨hostä¸Šçš„é…ç½®æ–‡ä»¶, è€Œä¸ä¿®æ”¹é•œåƒ. ä½†éå¸¸ä¸å»ºè®®è¿™ä¹ˆåš! ç†ç”±å¦‚ä¸Š.</li>
<li>ä¿®æ”¹é•œåƒæ–¹å¼: æŠŠå˜æ›´commitåˆ°é•œåƒé‡Œ(ä¸æ¨è, é€ æˆé»‘ç®±é•œåƒ), æˆ–è€…é‡æ–°æ„å»ºæ–°çš„é•œåƒ(æ¨è, æ‰€æœ‰é…ç½®éƒ½æ˜ç¡®åœ¨dockerfileé‡Œ), ä½¿ç”¨æ–°é•œåƒé‡å»ºå®¹å™¨.<br>å»ºè®®ä½¿ç”¨æ–¹å¼2.</li>
</ol>
<h2 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h2><ul>
<li><p>é€šè¿‡æºæ–‡ä»¶Dockerfileæ„å»ºé•œåƒ</p>
<ul>
<li>-t: tag image</li>
<li>. : tells that Docker should look for the Dockerfile in the current directory<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> build -t getting-started <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
<li><p>æŸ¥çœ‹é•œåƒåˆ—è¡¨</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> image <span class="token function">ls</span>
REPOSITORY               TAG       IMAGE ID       CREATED       SIZE
getting-started          latest    79b4eb26b9f4   <span class="token number">4</span> hours ago   404MB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>æŠŠé•œåƒpushåˆ°hub</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> tag <span class="token operator">&lt;</span>the-image-id<span class="token operator">></span> <span class="token operator">&lt;</span>your-docker-namespace<span class="token operator">></span>/<span class="token operator">&lt;</span>the-image-id<span class="token operator">></span>
<span class="token function">docker</span> push <span class="token operator">&lt;</span>your-docker-namespace<span class="token operator">></span>/<span class="token operator">&lt;</span>the-image-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>åˆ é™¤é•œåƒ</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> rmi <span class="token operator">&lt;</span>the-image-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<ul>
<li><p>é€šè¿‡æºæ–‡ä»¶Dockerfileæ„å»ºé•œåƒ</p>
</li>
<li><p>æ£€æŸ¥é•œåƒå†…å®¹</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> inspect <span class="token operator">&lt;</span>the-image-id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹é•œåƒç»§æ‰¿å…³ç³»</li>
<li>æŸ¥çœ‹é•œåƒå†å²ç‰ˆæœ¬</li>
</ul>
<h2 id="volume"><a href="#volume" class="headerlink" title="volume"></a>volume</h2><ul>
<li><p>åˆ›å»º</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> volume create <span class="token operator">&lt;</span>volume-name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹åˆ—è¡¨</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> volume <span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹è¯¦æƒ… </p>
<ul>
<li>Mountpoint: ä»£è¡¨åœ¨Hostä¸Šçš„å®é™…è·¯å¾„, ä½†å®é™…åœ¨macä¸Šç”±äºæ˜¯è™šæ‹Ÿæœº, å› æ­¤å¹¶ä¸å‡†ç¡®<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> volume inspect <span class="token operator">&lt;</span>volume-name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<h2 id="Dockerfileæ–‡ä»¶"><a href="#Dockerfileæ–‡ä»¶" class="headerlink" title="Dockerfileæ–‡ä»¶"></a>Dockerfileæ–‡ä»¶</h2><h3 id="execæ¨¡å¼ä¸shellæ¨¡å¼"><a href="#execæ¨¡å¼ä¸shellæ¨¡å¼" class="headerlink" title="execæ¨¡å¼ä¸shellæ¨¡å¼"></a>execæ¨¡å¼ä¸shellæ¨¡å¼</h3><ul>
<li>execæ¨¡å¼: å®¹å™¨ä¸­çš„ä»»åŠ¡è¿›ç¨‹å°±æ˜¯å®¹å™¨å†…çš„1å·è¿›ç¨‹, å¦‚ä¸‹çœ‹åˆ°çš„1å·è¿›ç¨‹æ˜¯top<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
CMD <span class="token punctuation">[</span><span class="token string">"top"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071217750.png"><br>exec æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯ä¸ä¼šé€šè¿‡ shell æ‰§è¡Œç›¸å…³çš„å‘½ä»¤ï¼Œæ‰€ä»¥åƒ $HOME è¿™æ ·çš„ç¯å¢ƒå˜é‡æ˜¯å–ä¸åˆ°çš„ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
CMD <span class="token punctuation">[</span><span class="token string">"echo"</span>, <span class="token string">"<span class="token environment constant">$HOME</span>"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¯ä»¥ä¿®æ”¹æˆ: (è¿™æ ·æœ¬è´¨ä¸Šbashè¿›ç¨‹å°±æ˜¯1å·è¿›ç¨‹äº†, è·Ÿshellæ¨¡å¼ä¸€æ ·äº†)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
CMD <span class="token punctuation">[</span><span class="token string">"sh"</span>, <span class="token string">"-c"</span>, <span class="token string">"echo <span class="token environment constant">$HOME</span>"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>shellæ¨¡å¼: å®¹å™¨ä¸­çš„1å·è¿›ç¨‹æ˜¯bashè¿›ç¨‹<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
CMD <span class="token function">top</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
æœ¬è´¨ä¸Šæ˜¯ç¿»è¯‘æˆäº†: <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
CMD <span class="token punctuation">[</span><span class="token string">"sh"</span>, <span class="token string">"-c"</span>, <span class="token string">"top"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071217114.png"></li>
</ul>
<h3 id="CMDæ¨¡å¼ä¸ENTRYPOINTæ¨¡å¼"><a href="#CMDæ¨¡å¼ä¸ENTRYPOINTæ¨¡å¼" class="headerlink" title="CMDæ¨¡å¼ä¸ENTRYPOINTæ¨¡å¼"></a>CMDæ¨¡å¼ä¸ENTRYPOINTæ¨¡å¼</h3><h4 id="CMDæ¨¡å¼"><a href="#CMDæ¨¡å¼" class="headerlink" title="CMDæ¨¡å¼"></a>CMDæ¨¡å¼</h4><p>CMD æŒ‡ä»¤çš„ç›®çš„æ˜¯ï¼šä¸ºå®¹å™¨æä¾›é»˜è®¤çš„æ‰§è¡Œå‘½ä»¤ã€‚<br>CMD æŒ‡ä»¤æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œ</p>
<ol>
<li>ä¸º ENTRYPOINT æä¾›é»˜è®¤çš„å‚æ•°ï¼š</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CMD <span class="token punctuation">[</span><span class="token string">"param1"</span>,<span class="token string">"param2"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>exec æ¨¡å¼</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CMD <span class="token punctuation">[</span><span class="token string">"executable"</span>,<span class="token string">"param1"</span>,<span class="token string">"param2"</span><span class="token punctuation">]</span>    // è¿™æ˜¯ <span class="token builtin class-name">exec</span> æ¨¡å¼çš„å†™æ³•, æ³¨æ„éœ€è¦ä½¿ç”¨åŒå¼•å·<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li>shell æ¨¡å¼ï¼š</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CMD <span class="token builtin class-name">command</span> param1 param2                  // è¿™æ˜¯ shell æ¨¡å¼çš„å†™æ³•<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="ENTRYPOINTæ¨¡å¼"><a href="#ENTRYPOINTæ¨¡å¼" class="headerlink" title="ENTRYPOINTæ¨¡å¼"></a>ENTRYPOINTæ¨¡å¼</h4><p>ENTRYPOINT æŒ‡ä»¤æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼: </p>
<ul>
<li>exec æ¨¡å¼</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"executable"</span>, <span class="token string">"param1"</span>, <span class="token string">"param2"</span><span class="token punctuation">]</span>   // è¿™æ˜¯ <span class="token builtin class-name">exec</span> æ¨¡å¼çš„å†™æ³•, æ³¨æ„éœ€è¦ä½¿ç”¨åŒå¼•å·<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>shell æ¨¡å¼</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ENTRYPOINT <span class="token builtin class-name">command</span> param1 param2                   // è¿™æ˜¯ shell æ¨¡å¼çš„å†™æ³•<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>æŒ‡å®š ENTRYPOINT  æŒ‡ä»¤ä¸º exec æ¨¡å¼æ—¶ï¼Œå‘½ä»¤è¡Œä¸ŠæŒ‡å®šçš„å‚æ•°ä¼šä½œä¸ºå‚æ•°æ·»åŠ åˆ° ENTRYPOINT æŒ‡å®šå‘½ä»¤çš„å‚æ•°åˆ—è¡¨ä¸­</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
ENTRYPOINT <span class="token punctuation">[</span> <span class="token string">"top"</span>, <span class="token string">"-b"</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run --rm test1 -c
// æœ€ç»ˆç»“æœæ˜¯ <span class="token function">top</span> -b -c, å³-cè¢«appendä¸ºäº†æ–°çš„å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>ç”± CMD æŒ‡ä»¤æŒ‡å®šé»˜è®¤çš„å¯é€‰å‚æ•°</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
ENTRYPOINT <span class="token punctuation">[</span> <span class="token string">"top"</span>, <span class="token string">"-b"</span> <span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span> <span class="token string">"-c"</span> <span class="token punctuation">]</span> // é»˜è®¤å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run --rm test1
// æœ€ç»ˆç»“æœæ˜¯ <span class="token function">top</span> -b -c, å³-cè¢«appendä¸ºäº†æ–°çš„å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
ENTRYPOINT <span class="token punctuation">[</span> <span class="token string">"top"</span>, <span class="token string">"-b"</span> <span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span> <span class="token string">"-c"</span> <span class="token punctuation">]</span> // é»˜è®¤å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run --rm test1 -n <span class="token number">1</span>
// æœ€ç»ˆç»“æœæ˜¯ <span class="token function">top</span> -b -n <span class="token number">1</span>, å³ç”±CMDä¸­æŒ‡å®šçš„é»˜è®¤å‚æ•°è¢«å‘½ä»¤è¡Œä¸­çš„å‚æ•°æ›¿æ¢æ‰äº†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>æŒ‡å®š ENTRYPOINT  æŒ‡ä»¤ä¸º shell æ¨¡å¼æ—¶ï¼Œä¼šå®Œå…¨å¿½ç•¥å‘½ä»¤è¡Œå‚æ•°</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
ENTRYPOINT <span class="token builtin class-name">echo</span> <span class="token environment constant">$HOME</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run --rm test1 <span class="token function">ls</span>
// <span class="token function">ls</span> å‘½ä»¤æ²¡æœ‰æ‰§è¡Œ, è¢«å¿½ç•¥æ‰äº†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>è¦†ç›–é»˜è®¤çš„ ENTRYPOINT æŒ‡ä»¤</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM alpine
ENTRYPOINT <span class="token builtin class-name">echo</span> <span class="token environment constant">$HOME</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run --rm --entrypoint <span class="token function">ls</span> test1
// lsæ‰§è¡Œäº†, è¦†ç›–æ‰äº†åŸå§‹dockerfileä¸­çš„entrypoint<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å¯¹äº CMD å’Œ ENTRYPOINT çš„è®¾è®¡è€Œè¨€ï¼Œå¤šæ•°æƒ…å†µä¸‹å®ƒä»¬åº”è¯¥æ˜¯å•ç‹¬ä½¿ç”¨çš„ã€‚å½“ç„¶ï¼Œæœ‰ä¸€ä¸ªä¾‹å¤–æ˜¯ CMD ä¸º ENTRYPOINT æä¾›é»˜è®¤çš„å¯é€‰å‚æ•°ã€‚<br>æˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ€»ç»“å‡ºä¸‹é¢å‡ æ¡è§„å¾‹ï¼š<br>â€¢ å¦‚æœ ENTRYPOINT ä½¿ç”¨äº† shell æ¨¡å¼ï¼ŒCMD æŒ‡ä»¤ä¼šè¢«å¿½ç•¥ã€‚<br>â€¢ å¦‚æœ ENTRYPOINT ä½¿ç”¨äº† exec æ¨¡å¼ï¼ŒCMD æŒ‡å®šçš„å†…å®¹è¢«è¿½åŠ ä¸º ENTRYPOINT æŒ‡å®šå‘½ä»¤çš„å‚æ•°ã€‚<br>â€¢ å¦‚æœ ENTRYPOINT ä½¿ç”¨äº† exec æ¨¡å¼ï¼ŒCMD ä¹Ÿåº”è¯¥ä½¿ç”¨ exec æ¨¡å¼ã€‚</p>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.jianshu.com/p/052e3d5792ee">å®¹å™¨æ ¸å¿ƒ:cgroups</a></li>
<li><a href="https://yeasy.gitbook.io/docker_practice/underly/ufs">Docker-ä»å…¥é—¨åˆ°å®è·µ</a></li>
<li><a href="https://moelove.info/2021/03/14/%E4%B8%87%E5%AD%97%E9%95%BF%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/">ä¸‡å­—é•¿æ–‡ï¼šå½»åº•ææ‡‚å®¹å™¨é•œåƒæ„å»º</a></li>
<li><a href="https://www.cnblogs.com/sparkdev/p/8461576.html">Dockerfile ä¸­çš„ CMD ä¸ ENTRYPOINT</a></li>
<li><a href="https://segmentfault.com/a/1190000016137548">https://segmentfault.com/a/1190000016137548</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>docker</tag>
        <tag>container</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›æœ‰æ„æ€çš„è®°å½•-3</title>
    <url>//2022-03-24-random-snippets/</url>
    <content><![CDATA[<h1 id="å¦‚ä½•æŸ¥çœ‹æœ¬æœºçš„å…¬ç½‘IP"><a href="#å¦‚ä½•æŸ¥çœ‹æœ¬æœºçš„å…¬ç½‘IP" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹æœ¬æœºçš„å…¬ç½‘IP"></a>å¦‚ä½•æŸ¥çœ‹æœ¬æœºçš„å…¬ç½‘IP</h1><h2 id="å‘½ä»¤è¡Œ"><a href="#å‘½ä»¤è¡Œ" class="headerlink" title="å‘½ä»¤è¡Œ"></a>å‘½ä»¤è¡Œ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> myip.ipip.net
<span class="token function">curl</span> cip.cc
<span class="token function">curl</span> ip.sb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="é¡µé¢"><a href="#é¡µé¢" class="headerlink" title="é¡µé¢"></a>é¡µé¢</h2><p><a href="https://www.ipip.net/">https://www.ipip.net/</a><br><a href="https://ip.taobao.com/ipSearch">https://ip.taobao.com/ipSearch</a></p>
<h1 id="sh-c-æ˜¯å•¥æ„æ€"><a href="#sh-c-æ˜¯å•¥æ„æ€" class="headerlink" title="sh -c æ˜¯å•¥æ„æ€?"></a>sh -c æ˜¯å•¥æ„æ€?</h1><p>åœ¨Dockerä¸­ç»å¸¸çœ‹åˆ°</p>
<ol>
<li>å¯åŠ¨å‘½ä»¤ <code>sh -c &quot;ls -ltrh&quot;</code> å¦‚ä¸‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071203655.png"></li>
<li>Dockerfileå¦‚ä¸‹:<br><code>-c</code>: string, å‘½ä»¤ä»-cåçš„å­—ç¬¦ä¸²è¯»å–<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071204728.png"></li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>net-tools</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨ç”Ÿæ€çš„ä¸€äº›ç ”ç©¶ä¸å¯¹æ¯”</title>
    <url>//2022-03-27-container-ecosystem/</url>
    <content><![CDATA[<h1 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h1><table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>é˜¿é‡Œäº‘äº‘äº§å“</th>
<th>awsäº‘äº§å“</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>å®¹å™¨æœåŠ¡</td>
<td>ECI(Elastic Container Instance)</td>
<td>ECS(Elastic Container Service)</td>
<td>æä¾›å•çº¯çš„å®¹å™¨æœåŠ¡, ä¸æ¶‰åŠå®¹å™¨çš„ç¼–æ’ç­‰</td>
</tr>
<tr>
<td>K8Sé›†ç¾¤ç®¡æ§æœåŠ¡</td>
<td><a href="https://www.aliyun.com/product/kubernetes">Dedicated ACK</a></td>
<td>EKS</td>
<td>å¯ä»¥åŸºäºå„è‡ªçš„è™šæ‹Ÿæœºå®ä¾‹, ä½œä¸ºNode, åœ¨Nodeä¹‹ä¸Šç”Ÿäº§Pod</td>
</tr>
<tr>
<td>Serverless</td>
<td><a href="https://www.aliyun.com/product/cs/ask">ASK</a></td>
<td>Fargate</td>
<td>åœ¨å®¢æˆ·ä¾§çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªVirtualKubelet, kube-systemç©ºé—´ä¸‹çš„ç®¡æ§ç»„ä»¶ä¹Ÿéƒ½æ˜¯ä¸å¯è§çš„</td>
</tr>
<tr>
<td>å‡½æ•°è®¡ç®—æœåŠ¡</td>
<td>Lambda</td>
<td>Function Compute</td>
<td></td>
</tr>
<tr>
<td>æ··åˆäº‘æ‰©å®¹æ–¹æ¡ˆ(è™šæ‹Ÿæœº)</td>
<td>ACK Anywhere</td>
<td>EKS Anywhere</td>
<td>æœ¬è´¨éƒ½æ˜¯é€šè¿‡å¯ä»¥æ‰©å±•ä½¿ç”¨äº‘ä¸Šè™šæ‹Ÿæœºä½œä¸ºNode</td>
</tr>
<tr>
<td>æ··åˆäº‘æ‰©å®¹æ–¹æ¡ˆ(å®¹å™¨)</td>
<td>Virtual Kubelet</td>
<td>Virtual Kubelet</td>
<td>æœ¬è´¨éƒ½æ˜¯é€šè¿‡VirtualKubeleté›†æˆåœ¨ç°æœ‰k8sé›†ç¾¤ä¸­</td>
</tr>
</tbody></table>
<h1 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h1><h2 id="å¸¸è§çš„å‡ ç§æ–¹å¼"><a href="#å¸¸è§çš„å‡ ç§æ–¹å¼" class="headerlink" title="å¸¸è§çš„å‡ ç§æ–¹å¼"></a>å¸¸è§çš„å‡ ç§æ–¹å¼</h2><ol>
<li>å¤šç§Ÿæˆ·å…¨æ‰˜ç®¡æ–¹å¼(Serverless)</li>
</ol>
<ul>
<li>ä¾‹å¦‚: æ­å»ºäº†ä¸€ä¸ªç»Ÿä¸€çš„redis&#x2F;HBaseé›†ç¾¤, ä¸ºä¸åŒç§Ÿæˆ·è®¾å®šä¸åŒçš„namespace, quotaç­‰</li>
<li>ä¼˜åŠ¿: ç”¨æˆ·ä¾§æ¥å…¥ç®€å•æ–¹ä¾¿, ä½†å®šåˆ¶åŒ–çš„éœ€æ±‚æ»¡è¶³åº¦ä¸å“åº”åº¦å¯èƒ½ä¸ä¼šå¾ˆå¥½. </li>
<li>ç¼ºç‚¹: ç³»ç»Ÿä¾§è¿ç»´å¤æ‚èƒ½åŠ›è¦æ±‚è¾ƒé«˜, æ¨ªå‘æ‰©å±•èƒ½åŠ›æœ‰å¯èƒ½æˆä¸ºç“¶é¢ˆ.</li>
<li>è®¡è´¹æ–¹å¼: ä¸€èˆ¬éƒ½æ˜¯æŒ‰é‡è®¡è´¹, ä¾‹å¦‚å­˜å‚¨çš„ä½¿ç”¨é‡, APIçš„è°ƒç”¨é‡ç­‰</li>
<li>å…¸å‹ä¾‹å­: <ul>
<li>å¤§æ•°æ®åœºæ™¯: <ul>
<li><a href="https://help.aliyun.com/document_detail/27800.html">MaxCompute</a></li>
<li><a href="https://help.aliyun.com/document_detail/187556.html">Lindorm Serverlesså‹</a></li>
</ul>
</li>
<li>å®¹å™¨åœºæ™¯: <a href="https://www.aliyun.com/product/cs/ask">ASK</a>, æ§åˆ¶å¹³é¢çš„ç»„ä»¶æ˜¯å¤šç§Ÿæˆ·å…±äº«çš„.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>å¤šç§Ÿæˆ·åŠæ‰˜ç®¡æ–¹å¼(Hosted)</li>
</ol>
<ul>
<li>ä¾‹å¦‚: åœ¨é˜¿é‡Œäº‘ä¸Šè´­ä¹°RDS, é€‰å¥½è§„æ ¼ä¹‹å, RDSå°±åˆ›å»ºå¥½äº†, ç›´æ¥æ‹¿åˆ°urlå°±èƒ½jdbcè¿æ¥ä¸Šå»äº†.</li>
<li>ä¼˜åŠ¿: æ­å»ºæˆæœ¬ä½, äº‘äº§å“ä¼šæä¾›å„ç§å·¥å…·æ–¹ä¾¿è¿ç»´. ä¾‹å¦‚SQLå®¡è®¡å·¥å…·, ç™½å±åŒ–çš„æ…¢SQLæŸ¥è¯¢ä¸ä¼˜åŒ–å·¥å…·ç­‰.</li>
<li>ç¼ºç‚¹: ä»ç„¶éœ€è¦ç”¨æˆ·æ„ŸçŸ¥å®ä¾‹çš„å­˜åœ¨, éœ€è¦éƒ¨åˆ†ä»‹å…¥è¿ç»´(ä¾‹å¦‚å®ä¾‹å®•æœºçš„æ•°æ®å¤‡ä»½æ¢å¤ç­‰).</li>
<li>å…¸å‹ä¾‹å­: <ul>
<li>æ•°æ®åº“åœºæ™¯: <a href="https://www.aliyun.com/product/rds/mysql">rds</a></li>
<li>å¤§æ•°æ®åœºæ™¯: <a href="https://help.aliyun.com/document_detail/187556.html">Lindorm æ™®é€šå‹</a></li>
<li>å®¹å™¨åœºæ™¯: <a href="https://www.aliyun.com/product/kubernetes">ack</a></li>
</ul>
</li>
</ul>
<ol start="3">
<li>å•ç”¨æˆ·å®Œå…¨è‡ªå»ºæ–¹å¼(SelfManaged)</li>
</ol>
<ul>
<li>ä¾‹å¦‚: è‡ªå·±åŸºäº2ä¸ªECS, æ¯ä¸ªä¸Šè¾¹éƒ½å®‰è£…äº†mysql, æ­å»ºäº†ä¸€ä¸ªä¸»å¤‡çš„mysqlé›†ç¾¤.</li>
<li>ä¼˜åŠ¿: ç”¨æˆ·ä¾§å¯ç®¡æ§åº¦æé«˜</li>
<li>ç¼ºç‚¹: è‡ªå»ºåˆæœŸä¸åç»­æˆæœ¬é«˜, è¿ç»´æˆæœ¬æé«˜</li>
<li>å…¸å‹ä¾‹å­: <ul>
<li>åŸºäºZKçš„jaråŒ…æ„å»ºzké›†ç¾¤</li>
<li>åŸºäºCDHåˆ›å»ºHadoopé›†ç¾¤</li>
<li>ç­‰</li>
</ul>
</li>
</ul>
<p>ä¸ªäººç†è§£, æ‰€æœ‰èƒ½è‡ªå»ºçš„æœåŠ¡éƒ½å¯ä»¥ä»¥ <code>å¤šç§Ÿæˆ·åŠæ‰˜ç®¡</code>, <code>å¤šç§Ÿæˆ·å…¨æ‰˜ç®¡</code> æ–¹å¼è¿›è¡Œ. ä½†å‰ææ˜¯è¦åšå¥½: </p>
<ol>
<li>ACLé‰´æƒç­‰å®‰å…¨å‡†å…¥æœºåˆ¶</li>
<li>å¤šç§Ÿæˆ·çš„éš”ç¦»: æ•°æ®, æœåŠ¡QoS, ç­‰</li>
<li>ç»Ÿä¸€è¿ç»´ä¸ç‰ˆæœ¬å‡çº§æ–¹æ¡ˆ</li>
<li>å‘¨è¾¹ç³»ç»Ÿçš„æ”¯æ’‘:<ol>
<li>ç®¡æ§</li>
<li>è®¡é‡è®¡è´¹</li>
</ol>
</li>
</ol>
<p>ä¾‹å¦‚:</p>
<ul>
<li>è‡ªå»ºZKé›†ç¾¤, æ˜¯å¦å¯ä»¥æ”¹é€ åæ”¯æŒå¤šç§Ÿæˆ·çš„æ¥å…¥, æ¯ä¸ªç”¨æˆ·æ‹¿åˆ°å±äºè‡ªå·±çš„zkåœ°å€, é€šè¿‡zkclientè¿æ¥ä¸Šå»?</li>
</ul>
<h2 id="è‡ªå»ºK8Sé›†ç¾¤ä¸äº‘ä¸Šæ‰˜ç®¡K8Sé›†ç¾¤-ä¾‹å¦‚ACK-æœ‰å•¥åŒºåˆ«"><a href="#è‡ªå»ºK8Sé›†ç¾¤ä¸äº‘ä¸Šæ‰˜ç®¡K8Sé›†ç¾¤-ä¾‹å¦‚ACK-æœ‰å•¥åŒºåˆ«" class="headerlink" title="è‡ªå»ºK8Sé›†ç¾¤ä¸äº‘ä¸Šæ‰˜ç®¡K8Sé›†ç¾¤(ä¾‹å¦‚ACK)æœ‰å•¥åŒºåˆ«?"></a>è‡ªå»ºK8Sé›†ç¾¤ä¸äº‘ä¸Šæ‰˜ç®¡K8Sé›†ç¾¤(ä¾‹å¦‚ACK)æœ‰å•¥åŒºåˆ«?</h2><p>è€Œ è‡ªå»ºçš„k8sé›†ç¾¤ ä¸ äº‘ä¸Šæ‰˜ç®¡çš„k8sé›†ç¾¤, æ­£å¦‚åŒ å¤šç§Ÿæˆ·åŠæ‰˜ç®¡ ä¸ å•ç”¨æˆ·å®Œå…¨è‡ªå»º</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>container</tag>
        <tag>aliyun</tag>
        <tag>aws</tag>
      </tags>
  </entry>
  <entry>
    <title>k8s statefulsetçš„ç ”ç©¶ä¸å®è·µ</title>
    <url>//2022-03-27-k8s-stateful-set/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¸€ç›´å¾ˆæ„Ÿå…´è¶£, k8sé’ˆå¯¹statefulset, æ˜¯å¦‚ä½•æ”¯æŒçš„? </p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><h3 id="ç½‘ç»œç‰¹æ€§"><a href="#ç½‘ç»œç‰¹æ€§" class="headerlink" title="ç½‘ç»œç‰¹æ€§"></a>ç½‘ç»œç‰¹æ€§</h3><p>ä¾èµ–HeadlessService, æ¥ä¸ºæ¯ä¸ªPodåˆ†é…:</p>
<ul>
<li>ä¸€ä¸ªç¨³å®šçš„, æœ‰åºçš„hostname, hostnameå‘½åè§„åˆ™: ${StatefulSetName}-${idx}, ${idx}ä»0å¼€å§‹</li>
<li>ä¸€æ¡Aè®°å½•, ä» ${hostname}.default.svc.cluster.local åˆ°podIpçš„DNSè§£æ</li>
<li>å¦‚æœæ˜¯éHeadlessService, åˆ™ä¼šç”Ÿæˆä¸€æ¡ ${SvcName}.default.svc.cluster.local åˆ° clusterIp çš„DNSè§£æè®°å½•</li>
</ul>
<p>è¿™æ ·å°±ä¿è¯äº†Podé”€æ¯é‡å»ºä¹‹å: </p>
<ul>
<li>è™½ç„¶podIpå˜åŒ–äº†, ä½†hostnameèƒ½è·Ÿä¹‹å‰ä¿æŒä¸€è‡´</li>
<li>Aè®°å½•ä¼šè‡ªåŠ¨æ›´æ–°, è¿™æ ·k8sé›†ç¾¤å†…éƒ¨å…¶ä»–podé€šè¿‡ ${hostname}.default.svc.cluster.local ä»ç„¶èƒ½å¤Ÿè®¿é—®åˆ°è¯¥pod</li>
</ul>
<h3 id="å­˜å‚¨ç‰¹æ€§"><a href="#å­˜å‚¨ç‰¹æ€§" class="headerlink" title="å­˜å‚¨ç‰¹æ€§:"></a>å­˜å‚¨ç‰¹æ€§:</h3><p>æ˜¯statefulsetçš„ç‰¹æ€§:     </p>
<ul>
<li>ä¸ºæ¯ä¸ªpodåˆ›å»ºå•ç‹¬çš„pvc, å‘½åè§„åˆ™ ${PvcName}-${StatefulSetName}-${idx}, å¹¶ç»‘å®šå•ç‹¬çš„pv, è€Œä¸æ˜¯åƒdeploymentä¸ºæ‰€æœ‰podåˆ›å»º(ä¸€ä¸ª?è¿˜æ˜¯å¤šä¸ª?pvc)å¹¶ç»‘å®šåŒä¸€ä»½pv</li>
<li>podé”€æ¯é‡å»ºä¹‹å, ç”±äºhostnameç¨³å®š, æ‰€ä»¥è¿˜èƒ½å…³è”åˆ°ä¹‹å‰çš„pv</li>
</ul>
<h3 id="å…¶ä»–é¡ºåºåŒ–çš„éƒ¨ç½²ç‰¹æ€§"><a href="#å…¶ä»–é¡ºåºåŒ–çš„éƒ¨ç½²ç‰¹æ€§" class="headerlink" title="å…¶ä»–é¡ºåºåŒ–çš„éƒ¨ç½²ç‰¹æ€§:"></a>å…¶ä»–é¡ºåºåŒ–çš„éƒ¨ç½²ç‰¹æ€§:</h3><ul>
<li>Ordered Pod Creation: Podåˆ›å»ºæ˜¯æœ‰åºçš„, å³pod-0å…ˆåˆ›å»º, åªæœ‰pod-0æˆåŠŸå, pod-1æ‰ä¼šåˆ›å»º</li>
<li>scale-downæ—¶, ä¼šæŒ‰ç…§indexå€’åºåˆ é™¤pod</li>
<li>æ»šåŠ¨å‡çº§(Rolling Update)æ—¶, ä¼šæŒ‰ç…§indexå€’åºåˆ é™¤&amp;é‡å»ºpod</li>
</ul>
<h2 id="statefulsetçš„è®¾è®¡åŸç†æ¨¡å‹"><a href="#statefulsetçš„è®¾è®¡åŸç†æ¨¡å‹" class="headerlink" title="statefulsetçš„è®¾è®¡åŸç†æ¨¡å‹"></a>statefulsetçš„è®¾è®¡åŸç†æ¨¡å‹</h2><ul>
<li>æ‹“æ‰‘çŠ¶æ€: åº”ç”¨çš„å¤šä¸ªå®ä¾‹ä¹‹é—´ä¸æ˜¯å®Œå…¨å¯¹ç­‰çš„å…³ç³», è¿™ä¸ªåº”ç”¨å®ä¾‹çš„å¯åŠ¨å¿…é¡»æŒ‰ç…§æŸäº›é¡ºåºå¯åŠ¨. æ¯”å¦‚åº”ç”¨çš„ä¸»èŠ‚ç‚¹Aè¦å…ˆäºä»èŠ‚ç‚¹Bå¯åŠ¨. è€Œå¦‚æœä½ æŠŠAå’ŒBä¸¤ä¸ªPodåˆ é™¤æ‰, ä»–ä»¬å†æ¬¡è¢«åˆ›å»ºå‡ºæ¥æ˜¯ä¹Ÿå¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªé¡ºåºæ‰è¡Œ. å¹¶ä¸”, æ–°åˆ›å»ºå‡ºæ¥çš„Pod, å¿…é¡»å’ŒåŸæ¥çš„Podçš„ç½‘ç»œæ ‡è¯†ä¸€æ ·, è¿™æ ·åŸå…ˆçš„è®¿é—®è€…æ‰èƒ½ä½¿ç”¨åŒæ ·çš„æ–¹æ³•, è®¿é—®åˆ°è¿™ä¸ªæ–°çš„Pod.</li>
<li>å­˜å‚¨çŠ¶æ€: åº”ç”¨çš„å¤šä¸ªå®ä¾‹åˆ†åˆ«ç»‘å®šäº†ä¸åŒçš„å­˜å‚¨æ•°æ®. å¯¹äºè¿™äº›åº”ç”¨å®ä¾‹æ¥è¯´, Pod Aç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ•°æ®, å’Œéš”äº†ååˆ†é’Ÿä¹‹åå†æ¬¡è¯»å–åˆ°çš„æ•°æ®, åº”è¯¥æ˜¯åŒä¸€ä»½, å“ªæ€•åœ¨æ­¤æœŸé—´Pod Aè¢«é‡æ–°åˆ›å»ºè¿‡. ä¸€ä¸ªæ•°æ®åº“åº”ç”¨çš„å¤šä¸ªå­˜å‚¨å®ä¾‹.</li>
</ul>
<h1 id="ZK-on-K8S"><a href="#ZK-on-K8S" class="headerlink" title="ZK on K8S"></a>ZK on K8S</h1><h2 id="èƒŒæ™¯-1"><a href="#èƒŒæ™¯-1" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸ºå•¥ <a href="https://kubernetes.io/docs/tutorials/stateful-application/zookeeper/">zookeeper</a> é€šè¿‡k8sçš„statefulsetåˆ›å»ºzkæœåŠ¡, çœ‹yamlæ–‡ä»¶é‡Œ,</p>
<ol>
<li>æ²¡æœ‰åˆ›å»ºmyidæ–‡ä»¶</li>
<li>æ²¡æœ‰åœ¨confé‡Œé…ç½® server.$i&#x3D;$NAME-$((i-1)).$DOMAIN:$SERVER_PORT:$ELECTION_PORT è¿™ç§</li>
</ol>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åŸå› : å› ä¸ºå¯åŠ¨zkçš„è„šæœ¬æ˜¯start-zookeeper, ä¸æ˜¯start.sh<br>æ‰€ä»¥æ˜¯å› ä¸ºdockeré•œåƒé‡Œè¾¹å¯¹zkè¿›è¡Œäº†å°è£…, å¯¹k8sç¯å¢ƒå˜é‡è¿›è¡Œäº†é€‚é…. å…·ä½“æŸ¥çœ‹è„šæœ¬:<br><a href="https://github.com/kow3ns/kubernetes-zookeeper/blob/master/docker/scripts/start-zookeeper">start-zookeeper</a></p>
<h3 id="å¦‚ä½•ç”Ÿæˆmyidæ–‡ä»¶"><a href="#å¦‚ä½•ç”Ÿæˆmyidæ–‡ä»¶" class="headerlink" title="å¦‚ä½•ç”Ÿæˆmyidæ–‡ä»¶?"></a>å¦‚ä½•ç”Ÿæˆmyidæ–‡ä»¶?</h3><ul>
<li>ä¾èµ–statefulsetçš„hostnameå…¨å±€æœ‰åºä¸”ä¿æŒç¨³å®šçš„ç‰¹æ€§</li>
<li>åœ¨podå†…éƒ¨æ‰§è¡Œâ€hostnameâ€å‘½ä»¤, è¯»å–hostname, å‚è§ä¸Šè¾¹hostnameå‘½åè§„åˆ™, è¯»å–åˆ°${idx}å€¼, myid&#x3D;${idx}+1</li>
</ul>
<h3 id="å¦‚ä½•ç”Ÿæˆconfæ–‡ä»¶ä¸­çš„-server-1-x3D-xxxxxx-port1-port2-è¿™ç§peerçš„è®°å½•"><a href="#å¦‚ä½•ç”Ÿæˆconfæ–‡ä»¶ä¸­çš„-server-1-x3D-xxxxxx-port1-port2-è¿™ç§peerçš„è®°å½•" class="headerlink" title="å¦‚ä½•ç”Ÿæˆconfæ–‡ä»¶ä¸­çš„ server.1&#x3D;xxxxxx:port1:port2 è¿™ç§peerçš„è®°å½•?"></a>å¦‚ä½•ç”Ÿæˆconfæ–‡ä»¶ä¸­çš„ server.1&#x3D;xxxxxx:port1:port2 è¿™ç§peerçš„è®°å½•?</h3><ul>
<li>server.$i&#x3D;$NAME-$((i-1)).$DOMAIN:$SERVER_PORT:$ELECTION_PORT</li>
<li>$NAME: ä»hostnameè¯»å–åˆ° ${StatefulSetName}</li>
<li>$DOMAIN: ä» â€˜hostname -dâ€™ å‘½ä»¤ä¸­è¯»å–åˆ°domainä¿¡æ¯</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>stateful-set</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenAPIè®¾è®¡ä¹‹ClientToken</title>
    <url>//2022-03-28-openapi-clienttoken/</url>
    <content><![CDATA[<h1 id="ClientTokenä½œç”¨"><a href="#ClientTokenä½œç”¨" class="headerlink" title="ClientTokenä½œç”¨"></a>ClientTokenä½œç”¨</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>client-token</tag>
        <tag>openapi</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenAPIè®¾è®¡ä¹‹NextToken</title>
    <url>//2022-03-28-openapi-nexttoken/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯:"></a>èƒŒæ™¯:</h1><p>åœ¨APIè®¾è®¡æ—¶, å¦‚æœæ˜¯<code>list</code>æ¥å£, é€šå¸¸éœ€è¦å¯¹è¿”å›çš„ç»“æœè¿›è¡Œåˆ†é¡µ.</p>
<h1 id="ä¸ºå•¥éœ€è¦åˆ†é¡µ"><a href="#ä¸ºå•¥éœ€è¦åˆ†é¡µ" class="headerlink" title="ä¸ºå•¥éœ€è¦åˆ†é¡µ?"></a>ä¸ºå•¥éœ€è¦åˆ†é¡µ?</h1><ol>
<li>æ•°æ®åº“å±‚é¢: é˜²æ­¢ç”±äºæ²¡æœ‰limit, å¯¼è‡´ä»æ•°æ®åº“ä¸­ä¸€æ¬¡æŸ¥è¯¢æ•°æ®å¤ªå¤š, å¯¼è‡´å½¢æˆæ…¢SQL: <ol>
<li>å¯¼è‡´mysqléœ€è¦æŠŠç»“æœæ”¾åœ¨å†…å­˜, ä»è€Œå¯¼è‡´æ•´ä½“MySQLå†…å­˜å ç”¨å¢åŠ , ç”šè‡³oom</li>
<li>å¯¼è‡´é€šè¿‡tcpæ•°æ®åº“è¿æ¥, å¾€clientç«¯ä¼ è¾“è€—æ—¶è¿‡ä¹…. ä¾‹å¦‚10MBçš„æ•°æ®, åœ¨100Mbpsçš„å¸¦å®½ä¸‹éœ€è¦å‡ ä¹1ç§’</li>
</ol>
</li>
<li>åº”ç”¨å±‚é¢: å¦‚æœæ²¡æœ‰åˆ†é¡µ, ä¹Ÿå¾ˆå®¹æ˜“é€ æˆåº”ç”¨å†…å­˜å ç”¨è¿‡å¤š, å¦‚æœæ˜¯Javaåº”ç”¨å¾ˆå¯èƒ½è§¦å‘FGCç­‰.</li>
<li>å‰ç«¯: å¦‚æœä¸åˆ†é¡µ, å¯¼è‡´æµè§ˆå™¨æ— æ³•ç¼“å­˜å¤§é‡æ•°æ®, å¡æ­».<br>æ‰€ä»¥ä¸€èˆ¬å¯¹äºéå®½è¡¨, ä»¥500~2000ä½œä¸ºpageSizeè¾ƒä¸ºåˆé€‚.</li>
</ol>
<h1 id="æ–¹æ¡ˆ1-pageNo-pageSize-æ–¹å¼"><a href="#æ–¹æ¡ˆ1-pageNo-pageSize-æ–¹å¼" class="headerlink" title="æ–¹æ¡ˆ1: pageNo+pageSize æ–¹å¼"></a>æ–¹æ¡ˆ1: pageNo+pageSize æ–¹å¼</h1><h2 id="å…¸å‹å¸¸è§„çš„åˆ†é¡µå†™æ³•"><a href="#å…¸å‹å¸¸è§„çš„åˆ†é¡µå†™æ³•" class="headerlink" title="å…¸å‹å¸¸è§„çš„åˆ†é¡µå†™æ³•"></a>å…¸å‹å¸¸è§„çš„åˆ†é¡µå†™æ³•</h2><ul>
<li>å½“é¡µæ•°å°‘æ—¶, å¦‚ä¸‹ç¬¬1é¡µ, è€—æ—¶0ms:</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees  <span class="token keyword">order</span> <span class="token keyword">by</span> emp_no <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+-----------+--------+------------+</span>
<span class="token operator">|</span> emp_no <span class="token operator">|</span> birth_date <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name <span class="token operator">|</span> gender <span class="token operator">|</span> hire_date  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+-----------+--------+------------+</span>
<span class="token operator">|</span> <span class="token number">499999</span> <span class="token operator">|</span> <span class="token number">1958</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> Sachin     <span class="token operator">|</span> Tsukuda   <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">499998</span> <span class="token operator">|</span> <span class="token number">1956</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">|</span> Patricia   <span class="token operator">|</span> Breugel   <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1993</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">499997</span> <span class="token operator">|</span> <span class="token number">1961</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> Berhard    <span class="token operator">|</span> Lenart    <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1986</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">21</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+-----------+--------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>â€“ å½“é¡µæ•°å¤šæ—¶, å¦‚ä¸‹åˆ°ç¬¬300000&#x2F;3&#x3D;10wé¡µ, è€—æ—¶110ms: </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span>  <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees  <span class="token keyword">order</span> <span class="token keyword">by</span> emp_no <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">300000</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token operator">|</span> emp_no <span class="token operator">|</span> birth_date <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name  <span class="token operator">|</span> gender <span class="token operator">|</span> hire_date  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token operator">|</span>  <span class="token number">10024</span> <span class="token operator">|</span> <span class="token number">1958</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">|</span> Suzette    <span class="token operator">|</span> Pettey     <span class="token operator">|</span> F      <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">10023</span> <span class="token operator">|</span> <span class="token number">1953</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">29</span> <span class="token operator">|</span> Bojan      <span class="token operator">|</span> Montemayor <span class="token operator">|</span> F      <span class="token operator">|</span> <span class="token number">1989</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">10022</span> <span class="token operator">|</span> <span class="token number">1952</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> Shahaf     <span class="token operator">|</span> Famili     <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1995</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.11</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å¦‚ä¸Š, éšç€ç¿»é¡µçš„ç»§ç»­, å½“ <code>limit 1000000, 100</code> çš„æ—¶å€™, æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™.</p>
<h2 id="é—®é¢˜åŸå› åˆ†æ"><a href="#é—®é¢˜åŸå› åˆ†æ" class="headerlink" title="é—®é¢˜åŸå› åˆ†æ"></a>é—®é¢˜åŸå› åˆ†æ</h2><p>å…·ä½“åŸå› å‚è§: <a href="https://mp.weixin.qq.com/s/Wtg9acg6M5q5kkSH4M3qXQ">MySQL ç”¨ limit ä¸ºä»€ä¹ˆä¼šå½±å“æ€§èƒ½ï¼Ÿ</a><br>è¿™é‡Œè¿›è¡Œä¸ªæ¦‚è¿°, åœ¨æ‰§è¡ŒSQLæ—¶, innodbä¼šåšå¦‚ä¸‹ä¸¤æ­¥:  </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ç¬¬ä¸€æ­¥: æŸ¥è¯¢åˆ°ç´¢å¼•å¶å­èŠ‚ç‚¹æ•°æ®
ç¬¬äºŒæ­¥: æ ¹æ®å¶å­èŠ‚ç‚¹ä¸Šçš„ä¸»é”®å€¼å»èšç°‡ç´¢å¼•ä¸ŠæŸ¥è¯¢éœ€è¦çš„å…¨éƒ¨å­—æ®µå€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img data-src="/source/_posts/learn-from-failure/img.png" alt="img.png"></p>
<blockquote>
<p>åƒä¸Šé¢è¿™æ ·ï¼Œéœ€è¦æŸ¥è¯¢1000000æ¬¡ç´¢å¼•èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢1000100æ¬¡èšç°‡ç´¢å¼•çš„æ•°æ®ï¼Œæœ€åå†å°†ç»“æœè¿‡æ»¤æ‰å‰1000000æ¡ï¼Œå–å‡ºæœ€å100æ¡ã€‚<br>MySQLè€—è´¹äº†å¤§é‡éšæœºI&#x2F;Oåœ¨æŸ¥è¯¢èšç°‡ç´¢å¼•çš„æ•°æ®ä¸Šï¼Œè€Œæœ‰1000000æ¬¡éšæœºI&#x2F;OæŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯ä¸ä¼šå‡ºç°åœ¨ç»“æœé›†å½“ä¸­çš„ã€‚<br>åŠ è½½äº†å¾ˆå¤šçƒ­ç‚¹ä¸æ˜¯å¾ˆé«˜çš„æ•°æ®é¡µåˆ°buffer poolï¼Œä¼šé€ æˆbuffer poolçš„æ±¡æŸ“ï¼Œå ç”¨buffer poolçš„ç©ºé—´ã€‚</p>
</blockquote>
<h1 id="æ–¹æ¡ˆ2-æ”¹è¿›çš„-pageNo-pageSize-æ–¹å¼"><a href="#æ–¹æ¡ˆ2-æ”¹è¿›çš„-pageNo-pageSize-æ–¹å¼" class="headerlink" title="æ–¹æ¡ˆ2: æ”¹è¿›çš„ pageNo+pageSize æ–¹å¼"></a>æ–¹æ¡ˆ2: æ”¹è¿›çš„ pageNo+pageSize æ–¹å¼</h1><p>æœ¬è´¨<code>æ–¹æ¡ˆ1</code>æ˜¯ç”±äºå›è¡¨è€—æ—¶, é‚£ä¹ˆå¯ä»¥å…ˆå°†ä¸»é”®ç­›é€‰&amp;æŸ¥è¯¢å‡ºæ¥, ç„¶åç›´æ¥æ ¹æ®ç­›é€‰ä¹‹åçš„ä¸»é”®å»å›è¡¨.</p>
<h2 id="æ”¹è¿›çš„åˆ†é¡µå†™æ³•"><a href="#æ”¹è¿›çš„åˆ†é¡µå†™æ³•" class="headerlink" title="æ”¹è¿›çš„åˆ†é¡µå†™æ³•"></a>æ”¹è¿›çš„åˆ†é¡µå†™æ³•</h2><p>å¦‚ä¸‹, </p>
<ul>
<li>ä» 110ms-&gt;70ms. æ€§èƒ½æœ‰ä¸€å®šæå‡, ä½†ç”±äºæ•°æ®é›†ä¸å¤ªå¥½, æ•°æ®é‡å¤ªå°. åè¾¹è¯•è¯•airportæ•°æ®é›†.</li>
<li>å†…å±‚SQLæœ¬è´¨æ˜¯ç›´æ¥åœ¨é€šè¿‡ä¸»é”®ç´¢å¼•å°†3ä¸ªä¸»é”®æŸ¥è¯¢å‡ºæ¥, å¤–å±‚SQLæ ¹æ®3ä¸ªä¸»é”®å›è¡¨æŸ¥è¯¢å¯¹åº”è¡Œçš„å…¨éƒ¨ä¿¡æ¯.</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> aa<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> employees aa <span class="token keyword">join</span> <span class="token punctuation">(</span><span class="token keyword">select</span> emp_no <span class="token keyword">from</span> employees  <span class="token keyword">order</span> <span class="token keyword">by</span> emp_no <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">300000</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> bb <span class="token keyword">on</span> aa<span class="token punctuation">.</span>emp_no<span class="token operator">=</span>bb<span class="token punctuation">.</span>emp_no<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token operator">|</span> emp_no <span class="token operator">|</span> birth_date <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name  <span class="token operator">|</span> gender <span class="token operator">|</span> hire_date  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token operator">|</span>  <span class="token number">10024</span> <span class="token operator">|</span> <span class="token number">1958</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">|</span> Suzette    <span class="token operator">|</span> Pettey     <span class="token operator">|</span> F      <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">10023</span> <span class="token operator">|</span> <span class="token number">1953</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">29</span> <span class="token operator">|</span> Bojan      <span class="token operator">|</span> Montemayor <span class="token operator">|</span> F      <span class="token operator">|</span> <span class="token number">1989</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">10022</span> <span class="token operator">|</span> <span class="token number">1952</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> Shahaf     <span class="token operator">|</span> Famili     <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1995</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.07</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="æ–¹æ¡ˆ3-nextToken-maxResults-æ–¹å¼"><a href="#æ–¹æ¡ˆ3-nextToken-maxResults-æ–¹å¼" class="headerlink" title="æ–¹æ¡ˆ3: nextToken+maxResults æ–¹å¼"></a>æ–¹æ¡ˆ3: nextToken+maxResults æ–¹å¼</h1><ul>
<li>nextTokenæœ¬è´¨ä¸Šå°±æ˜¯æŒ‰ç…§æŸ¥è¯¢æ¡ä»¶, ä¸Šä¸€æ¬¡ç»“æœé›†ä¸­æœ€åä¸€æ¡è®°å½•çš„æ•°æ®åº“ä¸»é”®IDå€¼.</li>
<li>å› æ­¤ç›´æ¥èµ°ä¸»é”®ç´¢å¼•.</li>
</ul>
<h2 id="å†™æ³•"><a href="#å†™æ³•" class="headerlink" title="å†™æ³•"></a>å†™æ³•</h2><ul>
<li>å½“ç¬¬ä¸€é¡µæ—¶, ç”±äºæ²¡æœ‰nextToken, å› æ­¤ç›´æ¥è·å–(å¯ä»¥çœ‹åˆ°ä¸pageSizeå†™æ³•çš„limit 0, 3ç»“æœæ˜¯ä¸€æ ·çš„):</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees <span class="token keyword">order</span> <span class="token keyword">by</span> emp_no <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+-----------+--------+------------+</span>
<span class="token operator">|</span> emp_no <span class="token operator">|</span> birth_date <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name <span class="token operator">|</span> gender <span class="token operator">|</span> hire_date  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+-----------+--------+------------+</span>
<span class="token operator">|</span> <span class="token number">499999</span> <span class="token operator">|</span> <span class="token number">1958</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">|</span> Sachin     <span class="token operator">|</span> Tsukuda   <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">30</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">499998</span> <span class="token operator">|</span> <span class="token number">1956</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">|</span> Patricia   <span class="token operator">|</span> Breugel   <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1993</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">13</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">499997</span> <span class="token operator">|</span> <span class="token number">1961</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">|</span> Berhard    <span class="token operator">|</span> Lenart    <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1986</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">21</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+-----------+--------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>å½“ç¬¬10wé¡µæ—¶, æœ‰äº†ä¸Šä¸€æ¬¡çš„nextToken, å› æ­¤å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees <span class="token keyword">where</span> emp_no<span class="token operator">&lt;</span><span class="token number">10025</span> <span class="token keyword">order</span> <span class="token keyword">by</span> emp_no <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token operator">|</span> emp_no <span class="token operator">|</span> birth_date <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name  <span class="token operator">|</span> gender <span class="token operator">|</span> hire_date  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token operator">|</span>  <span class="token number">10024</span> <span class="token operator">|</span> <span class="token number">1958</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">|</span> Suzette    <span class="token operator">|</span> Pettey     <span class="token operator">|</span> F      <span class="token operator">|</span> <span class="token number">1997</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">19</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">10023</span> <span class="token operator">|</span> <span class="token number">1953</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">29</span> <span class="token operator">|</span> Bojan      <span class="token operator">|</span> Montemayor <span class="token operator">|</span> F      <span class="token operator">|</span> <span class="token number">1989</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">10022</span> <span class="token operator">|</span> <span class="token number">1952</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">08</span> <span class="token operator">|</span> Shahaf     <span class="token operator">|</span> Famili     <span class="token operator">|</span> M      <span class="token operator">|</span> <span class="token number">1995</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">22</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------------+------------+------------+--------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯ä»¥çœ‹åˆ°, nextTokenæ–¹å¼, éšç€é¡µæ•°çš„å¢åŠ , ç»“æœä¸<code>pageSize</code>æ–¹å¼æ˜¯å®Œå…¨ç­‰ä»·çš„, ä½†æ—¶é—´æ¶ˆè€—å®Œå…¨æ˜¯ç¨³å®šçš„.</p>
<h1 id="ä¼˜ç¼ºç‚¹æ¯”è¾ƒä¸æ€è€ƒ"><a href="#ä¼˜ç¼ºç‚¹æ¯”è¾ƒä¸æ€è€ƒ" class="headerlink" title="ä¼˜ç¼ºç‚¹æ¯”è¾ƒä¸æ€è€ƒ"></a>ä¼˜ç¼ºç‚¹æ¯”è¾ƒä¸æ€è€ƒ</h1><p>nextTokenæ–¹å¼</p>
<ul>
<li>ä¼˜ç‚¹: <ul>
<li>ä¸ä¼šéšç€é¡µæ•°çš„å¢åŠ , å¯¼è‡´æ—¶é—´æ¶ˆè€—çº¿æ€§å¢é•¿. è€Œæ˜¯ç›´æ¥èµ°ä¸»é”®ç´¢å¼•, æ—¶é—´æ¶ˆè€—ç¨³å®š.</li>
</ul>
</li>
<li>ç¼ºç‚¹: <ul>
<li>ç”±äºnextTokenåªæœ‰ä¸€ä¸ªå€¼, ç¿»é¡µä¹‹å, nextTokenå°±è¢«è¦†ç›–æ‰äº†. åªèƒ½é¡ºåºå‘å‰ç¿»é¡µ, è€Œå¾ˆéš¾å†é€€å›ä¸Šä¸€é¡µ. (ä½†å®é™…è°ƒç”¨ç«¯å¯ä»¥ä¿å­˜ä¸‹æ¥, )</li>
<li>nextTokenå€¼æœ¬èº«ç”±äºæ˜¯æ•°æ®åº“ä¸»é”®, å› æ­¤éœ€è¦è¿›è¡ŒåŠ å¯†, é˜²æ­¢å¤–éƒ¨çª¥æ¢åˆ°æ•°æ®æ¡æ•°ç­‰æ•æ„Ÿä¿¡æ¯. ä½†åŠ è§£å¯†å¸¦äº†äº†é¢å¤–çš„CPUæ¶ˆè€—.</li>
</ul>
</li>
</ul>
<h1 id="ä¸€äº›NextToken-MaxResultsçš„å®è·µ"><a href="#ä¸€äº›NextToken-MaxResultsçš„å®è·µ" class="headerlink" title="ä¸€äº›NextToken+MaxResultsçš„å®è·µ"></a>ä¸€äº›NextToken+MaxResultsçš„å®è·µ</h1><ul>
<li><p>AWSçš„<a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstances.html">DescribeInstances</a></p>
</li>
<li><p>AWSçš„<a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Query.Pagination.html">LastEvaluatedKey</a>, æœ¬è´¨ä¸NextTokenæ˜¯ä¸€æ ·çš„</p>
<blockquote>
<p>the LastEvaluatedKey from a Query response should be used as the ExclusiveStartKey for the next Query request</p>
</blockquote>
</li>
<li><p>Aliyunçš„<a href="https://help.aliyun.com/document_detail/25506.html">DescribeInstances</a></p>
</li>
</ul>
<h1 id="å…¶ä»–è®°å½•"><a href="#å…¶ä»–è®°å½•" class="headerlink" title="å…¶ä»–è®°å½•"></a>å…¶ä»–è®°å½•</h1><h2 id="MySQLæŸ¥çœ‹BufferPool"><a href="#MySQLæŸ¥çœ‹BufferPool" class="headerlink" title="MySQLæŸ¥çœ‹BufferPool"></a>MySQLæŸ¥çœ‹BufferPool</h2><p>å¦‚ä¸‹, </p>
<ul>
<li>PRIMARY: ä»£è¡¨bufferpoolä¸­æ•°æ®é¡µæ•°.</li>
<li>val: ä»£è¡¨bufferpoolä¸­ç´¢å¼•é¡µ.</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> TABLE_NAME<span class="token punctuation">,</span> index_name<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>INNODB_BUFFER_PAGE <span class="token keyword">where</span> INDEX_NAME <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'val'</span><span class="token punctuation">,</span><span class="token string">'primary'</span><span class="token punctuation">)</span> <span class="token operator">and</span> TABLE_NAME <span class="token operator">like</span> <span class="token string">'%employees%'</span> <span class="token keyword">group</span> <span class="token keyword">by</span> TABLE_NAME<span class="token punctuation">,</span> index_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------------+------------+----------+</span>
<span class="token operator">|</span> TABLE_NAME              <span class="token operator">|</span> index_name <span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+------------+----------+</span>
<span class="token operator">|</span> <span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>salaries<span class="token punctuation">`</span></span>  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>    <span class="token operator">|</span>     <span class="token number">4486</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>    <span class="token operator">|</span>      <span class="token number">887</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span> <span class="token operator">|</span> val        <span class="token operator">|</span>       <span class="token number">11</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>dept_emp<span class="token punctuation">`</span></span>  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>    <span class="token operator">|</span>      <span class="token number">728</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+------------+----------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="MySQLä¸­-rowidçš„ä½¿ç”¨"><a href="#MySQLä¸­-rowidçš„ä½¿ç”¨" class="headerlink" title="MySQLä¸­_rowidçš„ä½¿ç”¨"></a>MySQLä¸­_rowidçš„ä½¿ç”¨</h2><h3 id="é™åˆ¶æ¡ä»¶"><a href="#é™åˆ¶æ¡ä»¶" class="headerlink" title="é™åˆ¶æ¡ä»¶"></a>é™åˆ¶æ¡ä»¶</h3><p>é€‚ç”¨ç‰ˆæœ¬: <code>MySQL 5.7</code> ~ <code>MySQL 8.0.26</code><br>å‚è§æ–‡æ¡£: <a href="http://blog.itpub.net/26736162/viewspace-2734341/">MySQLä¸­çš„_rowid</a></p>
<p>_rowidä¸å­˜åœ¨çš„æƒ…å†µ:</p>
<ul>
<li><code>ä¸»é”®åˆ—</code>æˆ–è€…<code>éç©ºå”¯ä¸€åˆ—</code>çš„ç±»å‹ä¸æ˜¯<code>æ•°å­—ç±»å‹</code></li>
<li>ä¸»é”®æ˜¯è”åˆä¸»é”®</li>
<li>å”¯ä¸€åˆ—ä¸æ˜¯éç©ºçš„</li>
</ul>
<p>_rowidåªå­˜åœ¨äºä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>å½“è¡¨ä¸­å­˜åœ¨ä¸€ä¸ª <code>æ•°å­—ç±»å‹çš„å•åˆ—ä¸»é”®</code>æ—¶ï¼Œ _rowidå…¶å®å°±æ˜¯æŒ‡çš„æ˜¯è¿™ä¸ªä¸»é”®åˆ—</li>
<li>å½“è¡¨ä¸­ ä¸å­˜åœ¨ä¸»é”®ä½†å­˜åœ¨ä¸€ä¸ª <code>æ•°å­—ç±»å‹çš„éç©ºå”¯ä¸€ç´¢å¼•</code>æ—¶, _rowidå…¶å®å°±æ˜¯æŒ‡çš„æ˜¯å¯¹åº”<code>éç©ºå”¯ä¸€åˆ—</code></li>
</ul>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="ä¸»é”®åˆ—ä¸æ˜¯æ•°å­—ç±»å‹-ä¸ä¼šæœ‰-rowid"><a href="#ä¸»é”®åˆ—ä¸æ˜¯æ•°å­—ç±»å‹-ä¸ä¼šæœ‰-rowid" class="headerlink" title="ä¸»é”®åˆ—ä¸æ˜¯æ•°å­—ç±»å‹, ä¸ä¼šæœ‰_rowid"></a>ä¸»é”®åˆ—ä¸æ˜¯æ•°å­—ç±»å‹, ä¸ä¼šæœ‰_rowid</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">desc</span> departments<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> Field     <span class="token operator">|</span> <span class="token keyword">Type</span>        <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> dept_no   <span class="token operator">|</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>     <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span> dept_name <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> UNI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-------------+------+-----+---------+-------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">></span> <span class="token keyword">select</span> _rowid <span class="token keyword">from</span> departments <span class="token keyword">limit</span> <span class="token number">2</span><span class="token punctuation">;</span>
ERROR <span class="token number">1054</span> <span class="token punctuation">(</span><span class="token number">42</span>S22<span class="token punctuation">)</span>: Unknown <span class="token keyword">column</span> <span class="token string">'_rowid'</span> <span class="token operator">in</span> <span class="token string">'field list'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="è”åˆä¸»é”®-ä¸ä¼šæœ‰-rowid"><a href="#è”åˆä¸»é”®-ä¸ä¼šæœ‰-rowid" class="headerlink" title="è”åˆä¸»é”®, ä¸ä¼šæœ‰_rowid"></a>è”åˆä¸»é”®, ä¸ä¼šæœ‰_rowid</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> salaries<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>    <span class="token operator">|</span> <span class="token keyword">Create</span> <span class="token keyword">Table</span>                                                                                                                                                                                                                                                                                                                                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token operator">|</span> salaries <span class="token operator">|</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>salaries<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>emp_no<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>salary<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>from_date<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>to_date<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>emp_no<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>from_date<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token identifier"><span class="token punctuation">`</span>salaries_ibfk_1<span class="token punctuation">`</span></span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>emp_no<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token identifier"><span class="token punctuation">`</span>employees<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>emp_no<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> _rowid <span class="token keyword">from</span> salaries <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
ERROR <span class="token number">1054</span> <span class="token punctuation">(</span><span class="token number">42</span>S22<span class="token punctuation">)</span>: Unknown <span class="token keyword">column</span> <span class="token string">'_rowid'</span> <span class="token operator">in</span> <span class="token string">'field list'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>æ„Ÿè§‰_rowidå¾ˆé¸¡è‚‹, å¦‚æœä¹±ç”¨å¾ˆå®¹æ˜“å‡ºé”™.</p>
<h2 id="MySQLå…¬å…±å¤§æ•°æ®é›†"><a href="#MySQLå…¬å…±å¤§æ•°æ®é›†" class="headerlink" title="MySQLå…¬å…±å¤§æ•°æ®é›†"></a>MySQLå…¬å…±å¤§æ•°æ®é›†</h2><blockquote>
<p>ä¸ºäº†æµ‹è¯•å¤§æ•°æ®é›†nextTokenä¸pageNoæ–¹å¼, æ‰¾äº†å¾ˆå¤šæµ‹è¯•å¤§æ•°æ®é›†, æ€»ç»“å¦‚ä¸‹</p>
</blockquote>
<ul>
<li>MySQLå®˜æ–¹çš„<a href="https://github.com/datacharmer/test_db">test_db</a><ul>
<li>ä¼˜ç‚¹: ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•, æŒ‰ç…§githubä¸­çš„æ­¥éª¤, å¾ˆå¿«å°±å®Œæˆäº†æ•°æ®çš„å¯¼å…¥.</li>
<li>ç¼ºç‚¹: <ul>
<li>æ€»ä½“æ•°æ®é‡ä¸å¤ªå¤š, æœ€å¤§çš„<code>salaries</code>è¡¨ä¹Ÿåªæœ‰200wè¡Œå·¦å³æ•°æ®, é’ˆå¯¹ç¿»é¡µæç«¯æƒ…å†µ,</li>
<li><code>salaries</code>è¡¨æ²¡æœ‰primary_key, ä¸ç¬¦åˆç¬¬äºŒèŒƒå¼, å³æ•°æ®è¡¨æ¯ä¸€ä¸ªå®ä¾‹æˆ–è€…è¡Œå¿…é¡»è¢«å”¯ä¸€æ ‡è¯†, å¯¼è‡´ä¸å¥½éªŒè¯next_token</li>
</ul>
</li>
</ul>
</li>
<li>MySQLå®˜æ–¹çš„<a href="https://dev.mysql.com/doc/airportdb/en/airportdb-introduction.html">airportdb</a><ul>
<li>ä¼˜ç‚¹: æ•°æ®é‡å¤§, <code>bookings</code>è¡¨æœ‰5000wæ•°æ®, ä¸”ç¬¦åˆç¬¬äºŒèŒƒå¼, å¯ä»¥è¿›è¡ŒnextTokenéªŒè¯.</li>
<li>ç¼ºç‚¹: <ul>
<li>å¯¼å…¥æ•°æ®éœ€è¦å•ç‹¬å®‰è£…<a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-install-macos-quick.html">MySQL Shell</a></li>
<li>æ•°æ®é›†600MB, ä¸‹è½½é€Ÿåº¦å®åœ¨æ˜¯æ‰æ€¥.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="MySQL-Shell"><a href="#MySQL-Shell" class="headerlink" title="MySQL Shell"></a>MySQL Shell</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å‚ç…§æ–‡æ¡£: <a href="https://dev.mysql.com/doc/mysql-shell/8.0/en/mysql-shell-install-macos-quick.html">MySQL Shell</a><br>macä¸Šç›´æ¥ä¸‹è½½dmgå®‰è£…å°±å¥½</p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ul>
<li>ä½¿ç”¨ <code>mysqlsh</code> å‘½ä»¤è¿›å…¥åˆ°shellé‡Œ</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalkerdeMacBook-Pro:~ davywalker$ mysqlsh
MySQL Shell <span class="token number">8.0</span>.28

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2016</span>, <span class="token number">2022</span>, Oracle and/or its affiliates.
Oracle is a registered trademark of Oracle Corporation and/or its affiliates.
Other names may be trademarks of their respective owners.

Type <span class="token string">'\help'</span> or <span class="token string">'\?'</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">;</span> <span class="token string">'\quit'</span> to exit.
 MySQL  JS <span class="token operator">></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ä½¿ç”¨ <code>\connect</code> å‘½ä»¤è¿æ¥æ•°æ®åº“</li>
</ul>
<p>å¦åˆ™ä¼šæŠ¥ <code>Util.loadDump: An open session is required to perform this operation. (RuntimeError)</code> é”™è¯¯</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> MySQL  JS <span class="token operator">></span> <span class="token punctuation">\</span>connect root@localhost:3306
Creating a session to <span class="token string">'root@localhost:3306'</span>
Please provide the password <span class="token keyword">for</span> <span class="token string">'root@localhost:3306'</span><span class="token builtin class-name">:</span>
Your MySQL connection <span class="token function">id</span> is <span class="token number">31</span>
Server version: <span class="token number">8.0</span>.26 MySQL Community Server - GPL
No default schema selected<span class="token punctuation">;</span> <span class="token builtin class-name">type</span> <span class="token punctuation">\</span>use <span class="token operator">&lt;</span>schema<span class="token operator">></span> to <span class="token builtin class-name">set</span> one.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>enable <code>local_infile</code></li>
</ul>
<p>å¦åˆ™ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ERROR: The <span class="token string">'local_infile'</span> global system variable must be <span class="token builtin class-name">set</span> to ON <span class="token keyword">in</span> the target server, after the server is verified to be trusted.
Util.loadDump: local_infile disabled <span class="token keyword">in</span> server <span class="token punctuation">(</span>RuntimeError<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql<span class="token operator">></span> <span class="token builtin class-name">set</span> global <span class="token assign-left variable">local_infile</span><span class="token operator">=</span>ON<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>ä½¿ç”¨<code>util.loadDump</code>å‘½ä»¤å¯¼å…¥dumpæ–‡ä»¶</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> MySQL  localhost:3306 ssl  JS <span class="token operator">></span> util.loadDump<span class="token punctuation">(</span><span class="token string">"/Users/davywalker/Downloads/airport-db"</span>, <span class="token punctuation">&#123;</span>threads: <span class="token number">16</span>, deferTableIndexes: <span class="token string">"all"</span>, ignoreVersion: true<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
Loading DDL and Data from <span class="token string">'/Users/davywalker/Downloads/airport-db'</span> using <span class="token number">16</span> threads.
Opening dump<span class="token punctuation">..</span>.
NOTE: Dump <span class="token function">format</span> has version <span class="token number">1.0</span>.2 and was created by an older version of MySQL Shell. If you experience problems loading it, please recreate the dump using the current version of MySQL Shell and try again.
Target is MySQL <span class="token number">8.0</span>.26. Dump was produced from MySQL <span class="token number">8.0</span>.26-cloud<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>openapi</tag>
        <tag>next-token</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°å½•ä¸€äº›æœ‰è¶£çš„äº§å“è®¾è®¡</title>
    <url>//2022-04-04-good-design/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä»£ç , æ¶æ„, é€»è¾‘, äº§å“, è®¾è®¡ç­‰, ä¸åº”è¯¥æ˜¯æ¯ç‡¥ä¹å‘³çš„, ä¸åº”è¯¥æ˜¯ç—›è‹¦å¤æ‚çš„, è€Œåº”è¯¥æ˜¯æœ‰è¶£çš„, ç®€å•çš„, åº”è¯¥æ˜¯geekçš„, åº”è¯¥æ˜¯ç¾çš„.<br>è¿™é‡Œè®°å½•ä¸‹è‡ªå·±çš„ç‚¹æ»´å‘ç°, å¸Œæœ›èƒ½èµ°å‡ºCRUDä¸çº·æ‚çš„ä¸šåŠ¡é€»è¾‘, é€æ¸æé«˜ä¸€ç‚¹å®¡ç¾ä¸å“å‘³.<br>ç”šè‡³è§‰å¾—åœ¨è½¯ä»¶äº§å“çš„ä¸–ç•Œé‡Œï¼Œä¸åº”è¯¥ç”±å‘†æ¿æ— å‘³çš„ç¨‹åºå‘˜ä¸»å¯¼ï¼Œåº”è¯¥ç”±äº§å“ç»ç†ï¼Œç”±ç”¨ç ”ï¼Œç”±UXç­‰è´Ÿè´£ã€‚<br>ç”¨æˆ·æ˜¯çŸ¥é“ä»€ä¹ˆå¥½ç”¨ï¼Œä»€ä¹ˆä¸å¥½ç”¨çš„ã€‚çŸ¥é“å“ªäº›æœ‰è¶£ï¼Œå“ªäº›æ— è¶£ã€‚<br>Macå­—ä½“æœ€å¼€å§‹ä¹Ÿæ˜¯å› ä¸ºSteve Jobsåœ¨å¤§å­¦é€‰ä¿®äº†è¿™é—¨è¯¾ã€‚<br>è¶Šæ¥è¶Šæ„è¯†åˆ°ï¼Œè½¯ä»¶çš„è®¾è®¡ï¼Œ<mark>éœ€è¦çš„æ˜¯å…‹åˆ¶</mark>ï¼Œå‡å°‘å¯¹ç”¨æˆ·çš„æ‰“æ‰°ï¼Œè€Œä¸æ˜¯ä¸€å‘³å¢åŠ ä¸å †ç ŒåŠŸèƒ½ï¼Œå½±å“ä½“éªŒï¼Œåè¾¹ä¼šé™„ä¸Šè‡ªå·±è¯†åˆ«åˆ°çš„bad designï¼Œå¼•ä»¥ä¸ºæˆ’ã€‚</p>
<h1 id="changelogä¼˜é›…çš„æ ¼å¼"><a href="#changelogä¼˜é›…çš„æ ¼å¼" class="headerlink" title="changelogä¼˜é›…çš„æ ¼å¼"></a>changelogä¼˜é›…çš„æ ¼å¼</h1><ul>
<li><a href="https://gettaurus.org/docs/Changelog2020/#1-15-1sup-30-Oct-2020-sup">taurus</a><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071142374.png"></li>
</ul>
<h1 id="å¼•å¯¼ç”¨æˆ·ä»˜è´¹é˜…è¯»"><a href="#å¼•å¯¼ç”¨æˆ·ä»˜è´¹é˜…è¯»" class="headerlink" title="å¼•å¯¼ç”¨æˆ·ä»˜è´¹é˜…è¯»"></a>å¼•å¯¼ç”¨æˆ·ä»˜è´¹é˜…è¯»</h1><ul>
<li>manningçš„<a href="https://livebook.manning.com/book/docker-in-practice-second-edition/chapter-4/13">docker-in-practice-second-edition</a>, ä¸ä¼šå¼ºåˆ¶ç”¨æˆ·ç‚¹å‡»ä»˜è´¹æ‰èƒ½çœ‹è§ä»˜è´¹å†…å®¹, è€Œæ˜¯ç”¨å¾ˆå·§å¦™çš„æ–¹æ³•, å¯¹å†…å®¹è¿›è¡Œæ¨¡ç³ŠåŒ–</li>
<li>å¯ä»¥ä»˜å‡ºä¸åŒçš„ä»·æ ¼, æ¥è§£é” ä»£ç åŒºåŸŸ-&gt;å°ç« èŠ‚-&gt;å¤§ç« èŠ‚-&gt;æ•´æœ¬ä¹¦<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071143420.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071143350.png"></li>
</ul>
<h1 id="è¾“å…¥å¯†ç "><a href="#è¾“å…¥å¯†ç " class="headerlink" title="è¾“å…¥å¯†ç "></a>è¾“å…¥å¯†ç </h1><ul>
<li><p>è¾“å…¥ç”¨æˆ·åæ—¶, çå¼€çœ¼ç›<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071144071.png"></p>
</li>
<li><p>è¾“å…¥å¯†ç æ—¶, é—­ä¸Šçœ¼ç›<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071144365.png"></p>
</li>
</ul>
<h1 id="Githubä¸åŒçš„é¡µé¢é£æ ¼"><a href="#Githubä¸åŒçš„é¡µé¢é£æ ¼" class="headerlink" title="Githubä¸åŒçš„é¡µé¢é£æ ¼"></a>Githubä¸åŒçš„é¡µé¢é£æ ¼</h1><ul>
<li>å¯ä»¥é€‰æ‹©ä¸åŒçš„filter, è™½ç„¶æ²¡å•¥åµç”¨, ä½†æ„Ÿè§‰éå¸¸geek, å¾ˆæœ‰æ„æ€<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071145971.png"></li>
</ul>
<h1 id="RGBé¢œè‰²çš„ä¸­æ–‡åç§°"><a href="#RGBé¢œè‰²çš„ä¸­æ–‡åç§°" class="headerlink" title="RGBé¢œè‰²çš„ä¸­æ–‡åç§°"></a>RGBé¢œè‰²çš„ä¸­æ–‡åç§°</h1><p>å‘ç°Macä¸Šæˆªå›¾è½¯ä»¶ <a href="https://apps.apple.com/us/app/ishot-screenshot-recording-ocr/id1485844094?mt=12">iShot</a> ä¼šè¯†åˆ«åˆ°æˆªå–å›¾ä¸­é¼ æ ‡å½“å‰ä½ç½®çš„RGBå€¼ï¼Œç„¶åç»™å‡ºå¾ˆå¥½çš„ä¸­æ–‡<br>ä¸­æ–‡å„ç§é¢œè‰²çš„ç¿»è¯‘å¾ˆæœ‰è¯—æ„, ä¾‹å¦‚:   </p>
<ul>
<li>è“è‰²: è”šè“, ç¢§è“, å¤©è“, é¼ å°¾è‰è“, çŸ¢è½¦èŠè“, ç°ä¸å®è“, åœŸè€³å…¶è“, ç»¿æ¾çŸ³è‰², ç°è“, å†›æœè“, æš—å²©è“, å“è“, é½é©¬è“, çˆ±ä¸½ä¸è“</li>
<li>ç´«è‰²: é”¦è‘µç´«, è“ç´«, æš—è“ç´«, ç´«æ°´æ™¶è‰², æœ¨æ§¿ç´«, ç´«ä¸é¦™è‰², è–°è¡£è‰ç´«, æ·¡ç´«ä¸é¦™è‰², è“Ÿç´«</li>
</ul>
<p>ä¸ªäººæ‰¾åˆ°çš„èƒ½å¯¹åº”åˆ°çš„RGBåç§°æ˜ å°„: <a href="https://www.sojson.com/rgb.html">RGBé¢œè‰²å‚è€ƒ</a> ,é—æ†¾çš„æ˜¯:</p>
<ol>
<li>åªæœ‰è‹±æ–‡, æ²¡æœ‰å¯¹åº”ä¸­æ–‡çš„åç§°, è¯—æ„å¾ˆéš¾ä½“ç°å‡ºæ¥.  </li>
<li>è‹±æ–‡ä¹Ÿä¸æ˜¯å¾ˆè´´åˆ‡, ä¾‹å¦‚ VioletRed1(#FF3E96), VioletRed2(#EE3A8C), VioletRed3(#CD3278), VioletRed4(#8B2252), åˆ†åˆ«å¯¹åº”ä¸­æ–‡çš„ â€œæš–ç²‰çº¢â€, â€œå±±èŒ¶çº¢â€, â€œæ¨±æ¡ƒçº¢â€, â€œè¤è‰²â€</li>
</ol>
<h1 id="Emojiçš„çµæ´»è¿ç”¨"><a href="#Emojiçš„çµæ´»è¿ç”¨" class="headerlink" title="Emojiçš„çµæ´»è¿ç”¨"></a>Emojiçš„çµæ´»è¿ç”¨</h1><p>çµæ´»è¿ç”¨Emoji, è®©ä¿¡æ¯æ›´åŠ ç›´è§‚å‹å¥½å¥½ç©å„¿. Life is short, why so serious?</p>
<ul>
<li><p>ä¾‹å¦‚ <a href="https://minikube.sigs.k8s.io/docs/start/">minikube</a> çš„å¯åŠ¨consoleç•Œé¢:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202211012118263.png"></p>
</li>
<li><p>ä¾‹å¦‚ <a href="https://github.com/jenkinsci/ec2-plugin/releases">EC2-Jenkinsçš„ReleaseNotes</a>:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202211012117440.png"></p>
</li>
</ul>
<h1 id="ä¼˜ç§€äº§å“åˆ†æ"><a href="#ä¼˜ç§€äº§å“åˆ†æ" class="headerlink" title="ä¼˜ç§€äº§å“åˆ†æ"></a>ä¼˜ç§€äº§å“åˆ†æ</h1><h2 id="draw-io"><a href="#draw-io" class="headerlink" title="draw.io"></a><a href="https://www.drawio.com/">draw.io</a></h2><ol>
<li><p>å¥½ç”¨çš„äº§å“, ç•Œé¢é£æ ¼ç®€æ´, å®¡ç¾åœ¨çº¿, ä½“éªŒè‰¯å¥½, å…¥é—¨åˆ°è¿›é˜¶, å­¦ä¹ æ›²çº¿å¹³æ»‘.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305152245183.png"></p>
</li>
<li><p>æ¸…æ™°ç¾è§‚çš„<a href="https://drawio-app.com/tutorials/">æ–‡æ¡£</a></p>
</li>
</ol>
<ul>
<li>å†…å®¹å®Œå–„: ç›®å‰è‡ªå·²é‡åˆ°çš„å‡ ä¹æ‰€æœ‰é—®é¢˜, éƒ½å¯ä»¥åœ¨æ–‡æ¡£ä¸Šæ‰¾åˆ°ç­”æ¡ˆ. æ¡ç†æ¸…æ™°, æ—¢ä¸è‡ƒè‚¿é‡å¤, ä¹Ÿä¸ä¸¢ä¸‰è½å››. <mark><font color='red'>æ°¸ä¹…é“¾æ¥å¾ˆé‡è¦!</font></mark></li>
<li>å†…å®¹ç®€æ´: Video Tutorials å›´ç»•ä¸€ä¸ªä¸»é¢˜, å‡ ä¹éƒ½æ˜¯1minä»¥å†…, ç®€æ˜æ‰¼è¦.</li>
<li>å®¡ç¾åœ¨çº¿: é£æ ¼å¾ˆç»Ÿä¸€. æ— è®ºæ˜¯å­—ä½“, è¿˜æ˜¯æ’å›¾.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305152244906.png"></li>
</ul>
<ol start="3">
<li>æŒç»­æ›´æ–°çš„<a href="https://drawio-app.com/blog/">æœ‰ç”¨çš„æŠ€æœ¯åšå®¢</a>, è€Œä¸æ˜¯æ— ç”¨çš„, å®£ä¼ çš„, å¹å˜˜çš„, ä¸»è¦åˆ†å¦‚ä¸‹å‡ ç±»:</li>
</ol>
<ul>
<li>æœ€ä½³å®è·µ: ä¸€äº›ä½¿ç”¨çš„å°æŠ€å·§.</li>
<li>new feature: æ–°åŠŸèƒ½çš„ä»‹ç».</li>
<li>case study: ç”¨æˆ·æ¡ˆä¾‹.</li>
<li>event: çº¿ä¸‹&#x2F;çº¿ä¸Šçš„æŠ€æœ¯æ´»åŠ¨ä»‹ç».</li>
<li>ç«å“æ¯”å¯¹: ä¾‹å¦‚ä¸Gliffy,StarUMLç­‰.</li>
<li>æŒä¹…æ›´æ–°: ä»2016å¹´4æœˆå»ºç«‹åˆ°2023å¹´5æœˆ, å‡ ä¹ä¿æŒæ¯æœˆ1åˆ°2æ¬¡æ›´æ–°. é•¿æœŸåšå¯¹çš„äº‹æƒ…, è¿™ä»½åšæŒä»¤äººæ„ŸåŠ¨. <a href="https://www.youtube.com/@drawioapp/videos">YouTuBeé¢‘é“</a>å†…å®¹ä¸°å¯Œ.</li>
</ul>
<ol start="4">
<li><a href="https://drawio-app.com/pricing/">åˆç†çš„å®šä»·</a>, æ™®é€šç”¨æˆ·æƒ³æ”¯æŒä¸‹, ç«Ÿç„¶æ‰¾ä¸åˆ°ä»˜è´¹å…¥å£.</li>
<li>æŠ€æœ¯æ°›å›´: <a href="https://drawio-app.com/blog/smart-templates-an-exclusive-new-feature-from-draw-io/">Las Vegas Atlassian Team â€™23</a>  <blockquote>
<p>We are excited for users to get their hands on Smart Templates, and weâ€™ll be demoing the feature at our booth next week at Atlassian Team â€™23. Will you be in Las Vegas for the event? Be sure to stop by our booth, located near the Expo Hall entrance, to get a first-hand look.</p>
</blockquote>
</li>
</ol>
<p>æ€»ä½“æ¥è¯´, æ„Ÿè§‰draw.ioçœŸçš„å¾ˆå…‹åˆ¶, å›´ç»•ç€æ ¸å¿ƒèƒ½åŠ›, ç²¾å¿ƒäº†æ‰“ç£¨åŠŸèƒ½ä¸ä½“éªŒ. è¶Šæ·±å…¥äº†è§£, è¶Šä»¤æˆ‘æƒ…ä¸è‡ªç¦çˆ±ä¸Šä»–ä»¬çš„äº§å“, çˆ±ä¸Šä»–ä»¬çš„å›¢é˜Ÿ, çˆ±ä¸ŠDiagramming~</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>product-design</tag>
        <tag>good-design</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘è®¡ç®—ç¬”è®°--awsçš„DefaultVpcå®ç°è°ƒç ”</title>
    <url>//2022-04-05-aws-default-vpc/</url>
    <content><![CDATA[<p><a href="https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html">AWS Default VPCs</a></p>
<ol>
<li>é»˜è®¤æ¯ä¸ªè´¦å·ä¸‹, æ¯ä¸ªåœ°åŸŸä¸‹, AWSéƒ½ä¼šè‡ªåŠ¨åˆ›å»º 172.31.0.0&#x2F;16  CIDRçš„VPC</li>
<li>ä¼šåœ¨è´¦å·ä¸‹Default VPCå†…, æ¯ä¸ªå¯ç”¨åŒºéƒ½åˆ›å»ºä¸€ä¸ªVSW, èŒƒå›´æ˜¯:<br>a. VSWç½‘æ®µèŒƒå›´: [172.31.00000000.0&#x2F;20, 172.31.11110000.0&#x2F;20] å…±16ä¸ªVSW<br>b. æ¯ä¸ªVSWå†…, IPæ•°é‡: 2^12&#x3D;4096 ä¸ª</li>
<li>æ–°çš„å¯ç”¨åŒºä¸Šçº¿ä¹‹å, ç­‰å¾…å‡ å¤©, AWSå°±ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”å¯ç”¨åŒºçš„Default VSW.</li>
<li>åªè¦å¯¹é»˜è®¤VPCè¿›è¡Œäº†é…ç½®ä¿®æ”¹, é‚£ä¹ˆæ–°çš„å¯ç”¨åŒºä¸Šçº¿ä¹‹å, å°±ä¸ä¼šä¸ºä¹‹è‡ªåŠ¨åˆ›å»ºDefaultVSWäº†.</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>aws</tag>
        <tag>cloud</tag>
        <tag>iaas</tag>
        <tag>default-vpc</tag>
        <tag>vpc</tag>
      </tags>
  </entry>
  <entry>
    <title>k8såŸºç¡€æ¶æ„ç¬”è®°--ä¸€äº›å¿…çŸ¥çš„åŸºç¡€æ•°æ®</title>
    <url>//2022-04-05-k8s-common-sense/</url>
    <content><![CDATA[<h1 id="å†…å­˜ç©ºé—´å ç”¨"><a href="#å†…å­˜ç©ºé—´å ç”¨" class="headerlink" title="å†…å­˜ç©ºé—´å ç”¨"></a>å†…å­˜ç©ºé—´å ç”¨</h1><ul>
<li>ä¸€ä¸ªnodeæ•°æ®å¯¹è±¡çš„jsonæ ¼å¼å¤§å°çº¦ä¸º28KB</li>
<li>ä¸€ä¸ªpodçš„æ•°æ®å¯¹è±¡çš„jsonæ ¼å¼å¤§å°çº¦ä¸º40KB</li>
</ul>
<h1 id="è§„æ¨¡"><a href="#è§„æ¨¡" class="headerlink" title="è§„æ¨¡"></a>è§„æ¨¡</h1><p>ç“¶é¢ˆä¸»è¦åœ¨watch&amp;listå¯¼è‡´apiserverå‹åŠ›å·¨å¤§ä¸Š.</p>
<ul>
<li>å•cluster 5000ä¸ªNode, 25000ä¸ªPod</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>k8s-architect</tag>
      </tags>
  </entry>
  <entry>
    <title>k8såŸºç¡€æ¶æ„ç¬”è®°--kube-proxyåŸç†</title>
    <url>//2022-04-05-k8s-kube-proxy/</url>
    <content><![CDATA[<h1 id="k8sç½‘ç»œæ¨¡å‹"><a href="#k8sç½‘ç»œæ¨¡å‹" class="headerlink" title="k8sç½‘ç»œæ¨¡å‹"></a>k8sç½‘ç»œæ¨¡å‹</h1><p>å¦‚ä¸‹ä¸‰ç‚¹æ˜¯åŸºç¡€è¦æ±‚: </p>
<pre class="line-numbers language-none"><code class="language-none">1. å®¹å™¨ä¹‹é—´è¦æ±‚ä¸éœ€è¦ä»»ä½•NATèƒ½ç›´æ¥é€šä¿¡
2. å®¹å™¨ä¸Nodeä¹‹é—´è¦æ±‚ä¸éœ€è¦ä»»ä½•NATèƒ½ç›´æ¥é€šä¿¡
3. å®¹å™¨çœ‹åˆ°è‡ªèº«çš„IPå’Œå¤–é¢çœ‹åˆ°å®ƒçš„IPå¿…é¡»æ˜¯ä¸€æ ·çš„, å³ä¸å­˜åœ¨IPè½¬åŒ–çš„é—®é¢˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h1 id="k8sä¸‰ç±»IP"><a href="#k8sä¸‰ç±»IP" class="headerlink" title="k8sä¸‰ç±»IP"></a>k8sä¸‰ç±»IP</h1><p>Kubernetes é›†ç¾¤å†…éƒ¨å­˜åœ¨ä¸‰ç±» IPï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Node IPï¼šå®¿ä¸»æœºçš„ IP åœ°å€
Pod IPï¼šä½¿ç”¨ç½‘ç»œæ’ä»¶åˆ›å»ºçš„ IPï¼ˆå¦‚ flannelï¼‰ï¼Œä½¿è·¨ä¸»æœºçš„ Pod å¯ä»¥äº’é€š
Cluster IPï¼šè™šæ‹Ÿ IPï¼Œé€šè¿‡ iptables è§„åˆ™è®¿é—®æœåŠ¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å®‰è£… node èŠ‚ç‚¹çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹æ˜¯æŒ‰ç…§ flannel -&gt; docker -&gt; kubelet -&gt; kube-proxy çš„é¡ºåºå¯åŠ¨</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>çœ‹äº†è¿™ä¹ˆå¤šæ–‡ç« , ç»ˆäºç†è§£äº†kube-proxyçš„æ·±å…¥åŸç†ä»¥åŠå‘å±•å†å²:</p>
<ol>
<li>æœ¬è´¨ä¸Šæ˜¯è¿è¡Œåœ¨æ¯ä¸ªhostä¸Šçš„proxyæµé‡è½¬å‘æœåŠ¡. ä»é›†ç¾¤å†…éƒ¨å‘èµ·æ—¶æµé‡è½¬å‘è§„åˆ™ç”Ÿæ•ˆ.</li>
<li>æ³¨æ„ä¸æ˜¯ç½‘å…³!!! å³ä¸èƒ½å¤„ç†k8sé›†ç¾¤å¤–éƒ¨curl serviceip:port&#x2F;xxx çš„è¯·æ±‚, åªèƒ½è·¯ç”±&amp;å¤„ç†é›†ç¾¤å†…éƒ¨çš„è¯·æ±‚, ä¾‹å¦‚ä»hostèŠ‚ç‚¹curl, æˆ–è€…ä»podå†…éƒ¨curl. æ˜¯ä»AHostè½¬å‘åˆ°BHostçš„. è¿™ç‚¹æ˜¯ä¸€ç›´ææ··çš„~</li>
<li>å†å²æ€»ç»“ä¸‹æ¥:<ol>
<li>æ•°æ®é¢: æ ¸å¿ƒçš„è½¬å‘åŠŸèƒ½<ol>
<li>åŸºäºiptables+ç”¨æˆ·ç©ºé—´è½¬å‘</li>
<li>åŸºäºiptables å³çº¯å†…æ ¸ç©ºé—´çš„è·¯ç”±è§„åˆ™</li>
<li>å¯ä»¥åŸºäºipvs&#x2F;lvsè¿›è¡Œè·¯ç”±è½¬å‘.</li>
</ol>
</li>
<li>æ§åˆ¶é¢: ä¸»è¦åšçš„æ˜¯watch apiserver, éšæ—¶æ›´æ–°è½¬å‘è§„åˆ™.</li>
</ol>
</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071218047.png"><br>å› æ­¤ä¹Ÿæ˜ç™½äº†å®˜æ–¹kube-proxyåŸç†è¿™å¼ å›¾é‡Œ, ä¸ºå•¥Clientå§‹ç»ˆåœ¨Hostä¸Š.<br>å› ä¸ºclientå¿…é¡»åœ¨k8sé›†ç¾¤é‡Œ, è€Œé›†ç¾¤é‡Œæ¯ä¸ªnodeéƒ½éƒ¨ç½²äº†kube-proxy. å› æ­¤clientå¿…ç„¶åœ¨nodeä¸Š, è·Ÿæœ¬nodeçš„kube-proxyåœ¨ä¸€èµ·.</p>
<p>è§£é‡Šæ¸…æ¥šäº†, ä¸ºå•¥è¦ç”¨kube-proxyå®ç°service, è€Œä¸æ˜¯ç”¨DNS Aè®°å½•æ¥å®ç°</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>k8s-architect</tag>
        <tag>kube-proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„KubeCtlå‘½ä»¤</title>
    <url>//2022-04-05-k8s-kubectl-cmd/</url>
    <content><![CDATA[<h1 id="ä¸ªäººä¹ æƒ¯"><a href="#ä¸ªäººä¹ æƒ¯" class="headerlink" title="ä¸ªäººä¹ æƒ¯"></a>ä¸ªäººä¹ æƒ¯</h1><p>åœ¨<code>~/.bash_profile</code>é‡Œå¢åŠ alias: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">k</span><span class="token operator">=</span><span class="token string">'kubectl'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="èµ„æºç›¸å…³å‘½ä»¤"><a href="#èµ„æºç›¸å…³å‘½ä»¤" class="headerlink" title="èµ„æºç›¸å…³å‘½ä»¤"></a>èµ„æºç›¸å…³å‘½ä»¤</h1><h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><h3 id="åˆ›å»ºpod"><a href="#åˆ›å»ºpod" class="headerlink" title="åˆ›å»ºpod"></a>åˆ›å»ºpod</h3><ul>
<li><p>å¿«é€Ÿåˆ›å»ºpod</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k run mytest --image<span class="token operator">=</span>k8s.gcr.io/pause:2.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æ ¹æ®yamlåˆ›å»ºpod</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k apply -f my-pause.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h3 id="åˆ—å‡ºpod-åŒ…å«æ‰€åœ¨çš„node"><a href="#åˆ—å‡ºpod-åŒ…å«æ‰€åœ¨çš„node" class="headerlink" title="åˆ—å‡ºpod(åŒ…å«æ‰€åœ¨çš„node)"></a>åˆ—å‡ºpod(åŒ…å«æ‰€åœ¨çš„node)</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k get pod -n kube-system -o wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="æŸ¥çœ‹podè¯¦æƒ…-åŒ…å«æ‰€åœ¨çš„node"><a href="#æŸ¥çœ‹podè¯¦æƒ…-åŒ…å«æ‰€åœ¨çš„node" class="headerlink" title="æŸ¥çœ‹podè¯¦æƒ…(åŒ…å«æ‰€åœ¨çš„node)"></a>æŸ¥çœ‹podè¯¦æƒ…(åŒ…å«æ‰€åœ¨çš„node)</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k describe pod nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åŒ…å«å¦‚ä¸‹é‡è¦ä¿¡æ¯:</p>
<ul>
<li>Podå¯¹åº”çš„clusterIp</li>
<li>Podæ‰€åœ¨çš„nodeName</li>
<li>Podæ‰€å±çš„replicaSet <code>Controlled By xxx</code></li>
<li>Podçš„äº‹ä»¶ <code>Events</code></li>
<li>Podé‡Œcontainerçš„å®šä¹‰, Volumesçš„å®šä¹‰, Labels &amp; Annotations</li>
</ul>
<h3 id="ç™»å½•pod"><a href="#ç™»å½•pod" class="headerlink" title="ç™»å½•pod"></a>ç™»å½•pod</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k <span class="token builtin class-name">exec</span> -ti <span class="token operator">&lt;</span>your-pod-name<span class="token operator">></span> -n <span class="token operator">&lt;</span>your-namespace<span class="token operator">></span>  -- /bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="æŸ¥çœ‹podäº‹ä»¶"><a href="#æŸ¥çœ‹podäº‹ä»¶" class="headerlink" title="æŸ¥çœ‹podäº‹ä»¶"></a>æŸ¥çœ‹podäº‹ä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span><span class="token comment"># k get events --sort-by=.metadata.creationTimestamp</span>
LAST SEEN   TYPE      REASON    OBJECT              MESSAGE
3m17s       Normal    BackOff   pod/no-annotation   Back-off pulling image <span class="token string">"k8s.gcr.io/pause:2.0"</span>
23m         Warning   Failed    pod/no-annotation   Error: ImagePullBackOff
28m         Warning   Failed    pod/no-annotation   Error: ErrImagePull<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æŸ¥çœ‹podæ—¥å¿—"><a href="#æŸ¥çœ‹podæ—¥å¿—" class="headerlink" title="æŸ¥çœ‹podæ—¥å¿—"></a>æŸ¥çœ‹podæ—¥å¿—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k logs <span class="token operator">&lt;</span>your-pod-name<span class="token operator">></span> -n <span class="token operator">&lt;</span>your-namespace<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="åˆ é™¤pod"><a href="#åˆ é™¤pod" class="headerlink" title="åˆ é™¤pod"></a>åˆ é™¤pod</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k delete pod <span class="token operator">&lt;</span>your-pod-name<span class="token operator">></span> -n <span class="token operator">&lt;</span>your-namespace<span class="token operator">></span>
k delete -f <span class="token operator">&lt;</span>your-pod.yaml<span class="token operator">></span> -n <span class="token operator">&lt;</span>your-namespace<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ³¨æ„, <a href="https://linuxhint.com/kubectl-stop-pod/"><mark>k8sé‡Œæ²¡æœ‰åœæ­¢Podçš„æ¦‚å¿µ, åªæœ‰åˆ é™¤(delete)</mark></a></p>
<blockquote>
<p>Kubernetes does not allow you to stop or pause a podâ€™s present state and resume it later. No. It is not feasible to pause a pod and restart it at a later time.</p>
</blockquote>
<p>è¿™é‡Œå¯ä»¥æ€è€ƒä¸‹, podä¸vmçš„åŒºåˆ«, ä¸ºå•¥vmå¯ä»¥stop, deleteçš„æ¦‚å¿µ? </p>
<h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h2><h3 id="è·å–nodesåˆ—è¡¨"><a href="#è·å–nodesåˆ—è¡¨" class="headerlink" title="è·å–nodesåˆ—è¡¨"></a>è·å–nodesåˆ—è¡¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k get no/node/nodes -o wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ³¨æ„, <mark>nodeæ²¡æœ‰namespaceçš„æ¦‚å¿µ</mark></p>
<h3 id="æŸ¥çœ‹nodeè¯¦æƒ…"><a href="#æŸ¥çœ‹nodeè¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹nodeè¯¦æƒ…"></a>æŸ¥çœ‹nodeè¯¦æƒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k describe <span class="token function">node</span> <span class="token operator">&lt;</span>your-node-name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åŒ…å«å¦‚ä¸‹é‡è¦ä¿¡æ¯</p>
<ul>
<li><code>Non-terminated Pods</code>: å³æ‰€æœ‰åœ¨å½“å‰Nodeä¸Šçš„pod</li>
<li><code>Capacity</code>: cpu, memç­‰, ä»£è¡¨Nodeæ•´ä½“çš„.</li>
<li><code>Allocatable</code>: cpu, memç­‰, ä»£è¡¨Nodeå»é™¤ç»™kubeproxy&#x2F;kubeletç­‰ç³»ç»Ÿå…³é”®ç»„ä»¶é¢„ç•™çš„èµ„æºä¹‹å, å¯ä»¥åˆ†é…ç»™podçš„</li>
<li><code>Allocated resources</code>: å·²ç»åˆ†é…å‡ºå»çš„cpu, memç­‰. æŒ‰ç…§æ‰€æœ‰podçš„requestè¿›è¡Œå åŠ çš„.</li>
</ul>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><h3 id="è·å–serviceåˆ—è¡¨"><a href="#è·å–serviceåˆ—è¡¨" class="headerlink" title="è·å–serviceåˆ—è¡¨"></a>è·å–serviceåˆ—è¡¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span><span class="token comment"># k get svc -o wide</span>
NAME            TYPE        CLUSTER-IP        EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE    SELECTOR
kubernetes      ClusterIP   <span class="token number">192.168</span>.0.1       <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP   258d   <span class="token operator">&lt;</span>none<span class="token operator">></span>
nginx-service   ClusterIP   <span class="token number">192.168</span>.198.117   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>/TCP    5d8h   app.kubernetes.io/name<span class="token operator">=</span>proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨æ„: è¿™é‡Œçš„<code>kubernetes</code>å°±æ˜¯apiserverçš„clusterIpåœ°å€äº†</p>
<h3 id="æŸ¥çœ‹svcè¯¦æƒ…"><a href="#æŸ¥çœ‹svcè¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹svcè¯¦æƒ…"></a>æŸ¥çœ‹svcè¯¦æƒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span><span class="token comment"># k describe svc nginx-service</span>
Name:              nginx-service
Namespace:         default
Labels:            <span class="token operator">&lt;</span>none<span class="token operator">></span>
Annotations:       <span class="token operator">&lt;</span>none<span class="token operator">></span>
Selector:          app.kubernetes.io/name<span class="token operator">=</span>proxy
Type:              ClusterIP
IP Families:       <span class="token operator">&lt;</span>none<span class="token operator">></span>
IP:                <span class="token number">192.168</span>.198.117
IPs:               <span class="token number">192.168</span>.198.117
Port:              name-of-service-port  <span class="token number">80</span>/TCP
TargetPort:        http-web-svc/TCP
Endpoints:         <span class="token number">172.24</span>.241.16:80,172.24.241.17:80,172.24.241.18:80 + <span class="token number">1</span> more<span class="token punctuation">..</span>.
Session Affinity:  None
Events:            <span class="token operator">&lt;</span>none<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æŸ¥çœ‹å¯¹åº”çš„endpoints"><a href="#æŸ¥çœ‹å¯¹åº”çš„endpoints" class="headerlink" title="æŸ¥çœ‹å¯¹åº”çš„endpoints"></a>æŸ¥çœ‹å¯¹åº”çš„endpoints</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span><span class="token comment"># k get ep</span>
NAME            ENDPOINTS                                                        AGE
kubernetes      <span class="token number">10.10</span>.0.162:6443,10.11.0.33:6443,10.9.0.58:6443                  258d
nginx-service   <span class="token number">172.24</span>.241.16:80,172.24.241.17:80,172.24.241.18:80 + <span class="token number">1</span> more<span class="token punctuation">..</span>.   5d8h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨æ„: è¿™é‡Œçš„<code>kubernetes</code>å°±æ˜¯apiserverçš„podåœ°å€äº†</p>
<h3 id="æŸ¥çœ‹endpointsè¯¦æƒ…"><a href="#æŸ¥çœ‹endpointsè¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹endpointsè¯¦æƒ…"></a>æŸ¥çœ‹endpointsè¯¦æƒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span><span class="token comment"># k describe ep nginx-service</span>
Name:         nginx-service
Namespace:    default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">></span>
Annotations:  endpoints.kubernetes.io/last-change-trigger-time: <span class="token number">2022</span>-04-01T15:22:45+08:00
Subsets:
  Addresses:          <span class="token number">172.24</span>.241.16,172.24.241.17,172.24.241.18,172.24.241.19
  NotReadyAddresses:  <span class="token operator">&lt;</span>none<span class="token operator">></span>
  Ports:
    Name                  Port  Protocol
    ----                  ----  --------
    name-of-service-port  <span class="token number">80</span>    TCP

Events:  <span class="token operator">&lt;</span>none<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="å¿«é€Ÿåˆ›å»ºdeploy"><a href="#å¿«é€Ÿåˆ›å»ºdeploy" class="headerlink" title="å¿«é€Ÿåˆ›å»ºdeploy"></a>å¿«é€Ÿåˆ›å»ºdeploy</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k run redis --image<span class="token operator">=</span>reids<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="è·å–deploymentsåˆ—è¡¨"><a href="#è·å–deploymentsåˆ—è¡¨" class="headerlink" title="è·å–deploymentsåˆ—è¡¨"></a>è·å–deploymentsåˆ—è¡¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k get deploy/deployment/deployments -n <span class="token operator">&lt;</span>your-namesapce<span class="token operator">></span> -o wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="æŸ¥çœ‹deploymentsè¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹deploymentsè¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹deploymentsè¯¦ç»†ä¿¡æ¯"></a>æŸ¥çœ‹deploymentsè¯¦ç»†ä¿¡æ¯</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k describe deploy/deployment <span class="token operator">&lt;</span>your-deploy-name<span class="token operator">></span> -n <span class="token operator">&lt;</span>your-namesapce<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åŒ…å«å¦‚ä¸‹å…³é”®ä¿¡æ¯</p>
<ul>
<li><code>Replicas</code>: å‰¯æœ¬ä¸ªæ•°æƒ…å†µ</li>
<li><code>Pod Template</code>: Podæ¨¡æ¿çš„è¯¦ç»†ä¿¡æ¯, ä¾‹å¦‚label, imageç­‰</li>
<li><code>NewReplicaSet</code>: å¯¹åº”çš„rs nameä¿¡æ¯</li>
</ul>
<h3 id="æŸ¥çœ‹rsåˆ—è¡¨ä¸è¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹rsåˆ—è¡¨ä¸è¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹rsåˆ—è¡¨ä¸è¯¦ç»†ä¿¡æ¯"></a>æŸ¥çœ‹rsåˆ—è¡¨ä¸è¯¦ç»†ä¿¡æ¯</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k get rs
k describe rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="æŸ¥çœ‹clusterè¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹clusterè¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹clusterè¯¦ç»†ä¿¡æ¯"></a>æŸ¥çœ‹clusterè¯¦ç»†ä¿¡æ¯</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k cluster-info
k cluster-info dump<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="å¿«æ·ä¿®æ”¹deploy-x2F-podç­‰é…ç½®"><a href="#å¿«æ·ä¿®æ”¹deploy-x2F-podç­‰é…ç½®" class="headerlink" title="å¿«æ·ä¿®æ”¹deploy&#x2F;podç­‰é…ç½®"></a>å¿«æ·ä¿®æ”¹deploy&#x2F;podç­‰é…ç½®</h3><p>å¦‚ä¸‹, ä¿®æ”¹å®Œæˆè‡ªåŠ¨ç”Ÿæ•ˆ:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">k edit deploy nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>kubectl</tag>
      </tags>
  </entry>
  <entry>
    <title>k8såŸºç¡€æ¶æ„ç¬”è®°--list&amp;watchæœºåˆ¶</title>
    <url>//2022-04-05-k8s-list-watch/</url>
    <content><![CDATA[<p>æœ¬è´¨ä¸Š:  </p>
<ul>
<li>list: å°±æ˜¯ä¸€ä¸ªGETçš„HTTPæ“ä½œ, è¯·æ±‚åˆ°apiserver, æ˜¯ä¸ªçŸ­è¿æ¥. listç»“æŸ, è¿æ¥å°±å…³é—­.</li>
<li>watch: æ˜¯ä¸€ä¸ªåŸºäº<code>Transfer-Encoding: chunked</code>çš„<a href="https://imququ.com/post/transfer-encoding-header-in-http.html">HTTPé•¿è¿æ¥</a>, apiserverä½œä¸ºhttp server, kube-proxy&#x2F;kubelet&#x2F;kube-schedulerç­‰ä½œä¸ºhttp client.</li>
</ul>
<p>è¿™æ ·: </p>
<ul>
<li>list: æ¥å®ç°kube-proxy, kubelet, kube-schedulerç­‰è§’è‰²å¯åŠ¨åˆå§‹åŒ–æ—¶, å­˜é‡æ•°æ®çš„ä¸€æ¬¡æ‹‰å–.</li>
<li>watch: æ¥å®ç°åç»­å„ç§èµ„æºçš„å¢é‡æ›´æ–°</li>
</ul>
<p>æ‰©å±•: </p>
<ul>
<li>watch: <ul>
<li>k8s java clientä¸­watchæœºåˆ¶, æ˜¯åŸºäºOkHttpClient. &#x2F;&#x2F; TODO: è¡¥ä¸Šå…·ä½“å®ç°ä¾‹å­</li>
<li>watchæœºåˆ¶ä¹Ÿå¯ä»¥åŸºäºwebsocketæ¥å®ç°</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>k8s-architect</tag>
        <tag>list-watch</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸­Log4jçš„æœ€ä½³å®è·µ</title>
    <url>//2022-04-18-java-log4j-bestpractice/</url>
    <content><![CDATA[<h2 id="é€šç”¨"><a href="#é€šç”¨" class="headerlink" title="é€šç”¨"></a>é€šç”¨</h2><ul>
<li>æŠŠThreadName, RequestIdæ”¾åˆ°MDC, åŠ åˆ°patterné‡Œ.</li>
</ul>
<h2 id="å¼‚æ­¥æ—¥å¿—"><a href="#å¼‚æ­¥æ—¥å¿—" class="headerlink" title="å¼‚æ­¥æ—¥å¿—"></a>å¼‚æ­¥æ—¥å¿—</h2><p>ä½¿ç”¨ <a href="https://logging.apache.org/log4j/2.x/manual/async.html#Location">log4j2 asyncLogger</a> æ¥å¼‚æ­¥æ‰“å°</p>
<ul>
<li>ä¸è¦åœ¨patterné‡Œå¢åŠ locationç›¸å…³ä¿¡æ¯, ä¾‹å¦‚class, file, location, line, methodç­‰, å› ä¸ºè¿™äº›åº•å±‚éœ€è¦<a href="https://logging.apache.org/log4j/2.x/manual/async.html#Location">æ‰“å°å †æ ˆ</a>, ç„¶åéå†, æ€§èƒ½è¾ƒå·®. å°¤å…¶æ˜¯éœ€è¦ä½¿ç”¨asyncLoggerçš„åœºæ™¯ä¸‹</li>
<li><a href="https://issues.apache.org/jira/browse/LOG4J2-2031">å¼‚æ­¥æ—¥å¿—åº•å±‚å®ç°åŸç†</a>: æœ¬è´¨æ˜¯ä¸€ä¸ªRingBuffer, é»˜è®¤sizeå¤§çº¦æ˜¯21wæ¡, éœ€è¦æ³¨æ„ä¸è¦ä½¿ç”¨DiscardPolicy;</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>log4j</tag>
        <tag>logging</tag>
        <tag>best-practice</tag>
      </tags>
  </entry>
  <entry>
    <title>k8s virtual-kubeletçš„å®ç°åŸç†ç ”ç©¶</title>
    <url>//2022-04-18-k8s-virtual-kubelet/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¸€ç›´å¾ˆæ„Ÿå…´è¶£, vkçš„å®ç°åŸç†, çœ‹å®˜æ–¹çš„æ–‡æ¡£, å¤ªåå‘ç”¨æˆ·è§†è§’,<br>ç ”ç©¶äº†æºä»£ç , å·¥ä½œæœºåˆ¶å…ˆå¤§æ¦‚è¯´ä¸‹: </p>
<ol>
<li>ä½¿ç”¨apiserverçš„admissionæ’å…¥ç‚¹æœºåˆ¶, vkå¯åŠ¨äº†ä¸€ä¸ªwebserver, å½“åŒ¹é…åˆ°vkæ—¶, ä¼šå°†è¯·æ±‚è·¯ç”±åˆ°vkçš„webserver</li>
<li>vkçš„webserveråšç®€å•çš„ä¸€ä»¶äº‹: å°†podçš„nodenameä¿®æ”¹æˆè‡ªå·±çš„</li>
<li>ç”±äºä»¥åŠæœ‰äº†nodename, å› æ­¤è·³è¿‡shedulerè¿‡ç¨‹, bindè¯·æ±‚ç›´æ¥å‘åˆ°å¯¹åº”çš„kubelet.</li>
<li>è¿™é‡Œçš„kubeletå°±æ˜¯vkå¯åŠ¨çš„è™šæ‹Ÿkubelet. </li>
<li>vkæ”¶åˆ°bindè¯·æ±‚, è°ƒç”¨äº‘å‚å•†çš„OpenAPI, åˆ›å»ºpod.</li>
</ol>
<p>vkæœ¬è´¨ä¸Šæ˜¯ä»¥podå½¢å¼è¿è¡Œåœ¨ç”¨æˆ·è‡ªå·±çš„k8sé›†ç¾¤ä¸Š.</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ‰€ä»¥vkåšäº†å‡ ä»¶äº‹: </p>
<ol>
<li>è´Ÿè´£ç»´æŠ¤podçš„ç”Ÿå‘½å‘¨æœŸ, ä¾‹å¦‚podçš„åˆ›å»ºä¸é”€æ¯.</li>
</ol>
<p>å…¶ä»–æ€è€ƒ:</p>
<ol>
<li>podçš„å¿ƒè·³æ£€æŸ¥ä¸äº‹ä»¶ä¸ŠæŠ¥é“¾è·¯æ˜¯æ€æ ·çš„?</li>
<li>podçš„configmap, secretç­‰ä¿¡æ¯æ›´æ–°, å¦‚ä½•æ¨é€åˆ°podä¸Š?<ol>
<li>æ˜¯vkæ¨é€? </li>
<li>or podä¸Šå®‰è£…agentä¸»åŠ¨pull?</li>
</ol>
</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>virtual-kubelet</tag>
        <tag>vk</tag>
      </tags>
  </entry>
  <entry>
    <title>k8s DNSçš„ç ”ç©¶ä¸å®è·µ</title>
    <url>//2022-04-19-k8s-dns/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¸€ç›´å¯¹äºk8sçš„dnsæœºåˆ¶ä¸ç”šäº†è§£, å€Ÿæ­¤æœºä¼šå½»åº•ææ‡‚.<br>ä¸»è¦å‚ç…§æ–‡ç«  <a href="https://zhuanlan.zhihu.com/p/80141656">KubeDNS å’Œ CoreDNS</a> è¿›è¡Œä¸ªäººæ¶ˆåŒ–.</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="å®¹å™¨å†…éƒ¨DNSé…ç½®"><a href="#å®¹å™¨å†…éƒ¨DNSé…ç½®" class="headerlink" title="å®¹å™¨å†…éƒ¨DNSé…ç½®"></a>å®¹å™¨å†…éƒ¨DNSé…ç½®</h2><p>æ˜ç™½äº†å®¹å™¨å†…éƒ¨<code>/etc/resolv.conf</code>çš„å«ä¹‰: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /etc/resolv.conf
search default.svc.cluster.local svc.cluster.local cluster.local
nameserver <span class="token number">192.168</span>.0.10
options ndots:5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ¬è´¨ä¸Šä¼š: </p>
<ol>
<li>æ ¹æ®ä¼ å…¥çš„åŸŸå</li>
<li>å½“æŸ¥è¯¢çš„åŸŸåä¸­åŒ…å«çš„ . çš„æ•°é‡å°‘äº options.ndots çš„å€¼æ—¶ï¼Œä¼šä¾æ¬¡æ‹¼æ¥searchåˆ—è¡¨ä¸­çš„æ¯ä¸ªå€¼</li>
<li>é€ä¸ªå°è¯•æ‹¼æ¥åç¼€</li>
<li>å‘nameserverå‘é€è§£æè¯·æ±‚</li>
<li>å¦‚æœ search èµ°å®Œäº†éƒ½æ²¡æœ‰æ‰¾åˆ°, é‚£ä¹ˆå°±ä¼šä½¿ç”¨åŸåŸŸåè¿›è¡ŒæŸ¥æ‰¾</li>
</ol>
<p>ä¾‹å¦‚</p>
<ol>
<li>åŒä¸ªnamesapceä¸‹:</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- åœ¨hostä¸Šæ‰§è¡Œ, çœ‹åˆ°æœ‰å¦‚ä¸‹svc
<span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span>$ k get svc
NAME            TYPE        CLUSTER-IP        EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>             AGE
nginx-service   ClusterIP   <span class="token number">192.168</span>.198.117   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>/TCP              19d
-- ç™»å½•default namespaceä¸ŠæŸä¸ªpodå†…éƒ¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤, 
-- <span class="token number">1</span>. ç›´æ¥é€šè¿‡clusterIPè®¿é—®, åˆ™ä¸ç»è¿‡DNS, å¯ä»¥è®¿é—®é€š
$ <span class="token function">curl</span> <span class="token number">192.168</span>.198.117:80
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
<span class="token operator">&lt;</span>/html<span class="token operator">></span>

-- <span class="token number">2</span>. é€šè¿‡svc nameè®¿é—®, åˆ™ç»è¿‡DNS, å¯ä»¥è®¿é—®é€š, åº•å±‚å…¶å®ç»è¿‡ä¸€æ¬¡æ‹¼æ¥, å®Œæ•´åŸŸåæ˜¯: nginx-service.default.svc.cluster.local
$ <span class="token function">curl</span> nginx-service:80
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
<span class="token operator">&lt;</span>/html<span class="token operator">></span>

-- <span class="token number">3</span>. é€šè¿‡svc å®Œæ•´è®¿é—®, åˆ™ç»è¿‡DNS, å¯ä»¥è®¿é—®é€š, åº•å±‚ä¸ç»è¿‡æ‹¼æ¥, å®Œæ•´åŸŸåæ˜¯: nginx-service.default.svc.cluster.local
$ <span class="token function">curl</span> nginx-service.default.svc.cluster.local:80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>è·¨namesapce:</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- åœ¨hostä¸Šæ‰§è¡Œ, æŸ¥çœ‹ kube-system namespaceä¸‹çš„svc
<span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span>$ k get svc -n kube-system
NAME                                 TYPE           CLUSTER-IP        EXTERNAL-IP     PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
heapster                             ClusterIP      <span class="token number">192.168</span>.32.77     <span class="token operator">&lt;</span>none<span class="token operator">></span>          <span class="token number">80</span>/TCP                       272d
-- ç™»å½•default namespaceä¸ŠæŸä¸ªpodå†…éƒ¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤, 
-- <span class="token number">1</span>. ç›´æ¥é€šè¿‡clusterIPè®¿é—®, åˆ™ä¸ç»è¿‡DNS, å¯ä»¥è®¿é—®é€š
$ <span class="token function">curl</span> <span class="token number">192.168</span>.32.77:80
<span class="token number">404</span> page not found

-- <span class="token number">2</span>. é€šè¿‡svcä¸å¸¦namespaceçš„nameè®¿é—®, åˆ™ç»è¿‡DNS, è®¿é—®ä¸é€š, åº•å±‚å…¶å®ç»è¿‡ä¸€æ¬¡æ‹¼æ¥, å®Œæ•´åŸŸåæ˜¯: heapster.default.svc.cluster.local è®¿é—®ä¸é€š
$ <span class="token function">curl</span> heapster:80
curl: <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> Could not resolve host: heapster

-- <span class="token number">3</span>. é€šè¿‡svcå¸¦namespaceçš„nameè®¿é—®, åˆ™ç»è¿‡DNS, è®¿é—®é€š, åº•å±‚å…¶å®ç»è¿‡2æ¬¡æ‹¼æ¥, heapster.kube-system.default.svc.cluster.local è®¿é—®ä¸é€š, heapster.kube-system.svc.cluster.local è®¿é—®é€šäº†
$ <span class="token function">curl</span> heapster.kube-system:80
<span class="token number">404</span> page not found

-- <span class="token number">4</span>. é€šè¿‡svcå¸¦namespaceçš„å®Œæ•´åŸŸåè®¿é—®, åˆ™ç»è¿‡DNS, è®¿é—®é€š, åº•å±‚ä¸ç»è¿‡æ‹¼æ¥
$ <span class="token function">curl</span> heapster.kube-system.svc.cluster.local:80
<span class="token number">404</span> page not found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="å®¹å™¨å†…éƒ¨DNSé…ç½®çš„ç”Ÿæˆ"><a href="#å®¹å™¨å†…éƒ¨DNSé…ç½®çš„ç”Ÿæˆ" class="headerlink" title="å®¹å™¨å†…éƒ¨DNSé…ç½®çš„ç”Ÿæˆ"></a>å®¹å™¨å†…éƒ¨DNSé…ç½®çš„ç”Ÿæˆ</h2><p>å®¹å™¨å†…éƒ¨<code>/etc/resolv.conf</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /etc/resolv.conf
search default.svc.cluster.local svc.cluster.local cluster.local
nameserver <span class="token number">192.168</span>.0.10
options ndots:5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>nameserver 192.168.0.10</code> è®°å½•æ˜¯å¦‚ä½•ç”Ÿæˆçš„? </li>
<li>æœ¬è´¨ä¸Š <code>192.168.0.10</code> æ˜¯dnssvcçš„clusterIp:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@iZ2ze8h8q419hf1fze66dkZ ~<span class="token punctuation">]</span>$ k get svc -n kube-system
NAME                                 TYPE           CLUSTER-IP        EXTERNAL-IP     PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
kube-dns                             ClusterIP      <span class="token number">192.168</span>.0.10      <span class="token operator">&lt;</span>none<span class="token operator">></span>          <span class="token number">53</span>/UDP,53/TCP,9153/TCP       272d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>nameserver 192.168.0.10</code> è®°å½•æ˜¯ä½•æ—¶ç”Ÿæˆçš„?</li>
<li>æ˜¯åœ¨åˆ›å»ºpodæ—¶, ç”±kubeletæ³¨å…¥podå†…éƒ¨</li>
</ul>
<p>&#x2F;&#x2F; TODO: æ˜¯å¦‚ä½•æ³¨å…¥podå†…éƒ¨çš„?<br>&#x2F;&#x2F; TODO: podå†…éƒ¨è®¿é—®å…¬ç½‘, æ˜¯å¦‚ä½•å®ç°çš„? å¦‚ä½•ç¦æ­¢podå†…éƒ¨è®¿é—®å…¬ç½‘? </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>dns</tag>
        <tag>coredns</tag>
        <tag>kube-dns</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°å½•ä¸€äº›è‡ªè®¤ä¸ºä¸å¥½çš„äº§å“è®¾è®¡</title>
    <url>//2022-04-29-bad-design/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è®°å½•ä¸€äº›è‡ªå·±æ˜æ˜¾æ„Ÿè§‰é€€æ­¥ï¼Œä¸é€‚çš„è®¾è®¡ã€‚å¼•ä»¥ä¸ºæˆ’ã€‚</p>
<h1 id="è¿‡å¤šçš„æ‰“æ‰°"><a href="#è¿‡å¤šçš„æ‰“æ‰°" class="headerlink" title="è¿‡å¤šçš„æ‰“æ‰°"></a>è¿‡å¤šçš„æ‰“æ‰°</h1><h2 id="æŠ€æœ¯æ–‡æ¡£é€‰ä¸­å¼¹æ¡†"><a href="#æŠ€æœ¯æ–‡æ¡£é€‰ä¸­å¼¹æ¡†" class="headerlink" title="æŠ€æœ¯æ–‡æ¡£é€‰ä¸­å¼¹æ¡†"></a>æŠ€æœ¯æ–‡æ¡£é€‰ä¸­å¼¹æ¡†</h2><ul>
<li>é˜¿é‡Œäº‘å®˜ç½‘æŠ€æœ¯æ–‡æ¡£ï¼Œé€‰ä¸­æ–‡å­—ä¹‹åï¼Œä¼šè‡ªåŠ¨å¼¹å‡ºâ€œæ–‡æ¡£åé¦ˆâ€è¯´æ˜ï¼Œæœ¬æ„æ˜¯å¥½çš„ï¼Œå¸Œæœ›å¾—åˆ°ç”¨æˆ·çš„åé¦ˆã€‚ä½†åœ¨å¼€å‘è€…å®é™…é˜…è¯»è¿‡ç¨‹ä¸­ï¼Œå°¤å…¶æ˜¯å¤§æ®µçš„æŠ€æœ¯æ–‡æ¡£ï¼Œç»å¸¸ä¼šä¹ æƒ¯æ€§åœ°é¼ æ ‡ç‚¹é€‰ï¼Œæ­¤æ—¶å¼¹å‡ºå¼¹æ¡†ï¼Œéå¸¸åˆ†æ•£æ³¨æ„åŠ›ã€‚<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071159766.png"></li>
<li>åè§‚æµ·å¤–çš„äº‘å‚å•†ï¼Œéƒ½éå¸¸å…‹åˆ¶ç”šè‡³æœ´ç´ ã€‚<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071200696.png"></li>
</ul>
<h2 id="é¡µé¢è¿‡å¤šå †ç Œ"><a href="#é¡µé¢è¿‡å¤šå †ç Œ" class="headerlink" title="é¡µé¢è¿‡å¤šå †ç Œ"></a>é¡µé¢è¿‡å¤šå †ç Œ</h2><ul>
<li>é˜¿é‡Œäº‘å®˜æ–¹æŠ€æœ¯æ–‡æ¡£ï¼Œå³ä¸Šè§’æ˜¯ä¸€å †è¥é”€è®¡åˆ’â€œå‚ä¸æ˜Ÿç«èµ¢ç°é‡‘â€ï¼Œâ€œåˆ†äº«åŠ©åŠ›å¥½ç¤¼â€ï¼›å³ä¸‹è§’æ˜¯â€œé”€å”®å’¨è¯¢â€ï¼Œâ€œä¼šå‘˜ä¸“äº«â€ï¼Œâ€œæ–‡æ¡£åé¦ˆâ€ã€‚è·Ÿç‰›çš®è—“ä¸€æ ·ã€‚<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071200169.png"></li>
<li>åè§‚awsï¼Œå‡ ä¹æ²¡æœ‰è¿‡å¤šæ‰“æ‰°ã€‚<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208071201046.png"></li>
</ul>
<h1 id="ä¸ä¸€çš„é£æ ¼"><a href="#ä¸ä¸€çš„é£æ ¼" class="headerlink" title="ä¸ä¸€çš„é£æ ¼"></a>ä¸ä¸€çš„é£æ ¼</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>product-design</tag>
        <tag>good-design</tag>
        <tag>bad-design</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntuåˆå§‹åŒ–é…ç½®</title>
    <url>//2022-04-29-ubuntu-init/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨å†…ç½‘æ·˜äº†ä¸€ä¸ª ThinkPad X1 Carbon Gen4 çš„è€å¤è‘£ï¼Œ<br>é»˜è®¤æ˜¯æ— ç³»ç»Ÿçš„ï¼Œä¹Ÿä¸å¤ªæƒ³å®‰è£…æ¯«æ— è®¾è®¡æ„Ÿï¼Œç›¸å½“ä¸‘é™‹çš„Windowsã€‚<br>è¿˜å¥½å®¶é‡Œæœ‰Ubuntuçš„å®‰è£…Uç›˜ï¼Œå°±ç›´æ¥æ‹¿æ¥è£…ä¸Šå»äº†ã€‚<br>ä¹‹å‰æ•´ä½“å¯¹Ubuntuçš„ä½“éªŒè¿˜æ˜¯ä¸é”™çš„ï¼Œæ— è®ºæ˜¯ä»UIä¸å­—ä½“è®¾è®¡ä¸Šï¼Œä½¿ç”¨æµç•…åº¦ä¸Šï¼Œè½¯ä»¶é½å…¨åº¦ä¸Šã€‚<br>æœ¬èº«è‡ªå·±æƒ¯ç”¨Macï¼Œåˆ‡æ¢åˆ°Ubuntuåº”è¯¥ä¹Ÿæ˜¯æ— ç¼çš„ã€‚<br>å®é™…é…ç½®ä¸‹æ¥ï¼Œå‘ç°è½¯ä»¶é½å…¨åº¦æ¯”6å¹´å‰è‡ªå·±ä½¿ç”¨æ—¶è¦å¤šå¤ªå¤šå¤ªå¤šäº†ï¼Œå¾ˆå¼€å¿ƒã€‚<br>åœ¨ä¸Šè¾¹ç©å„¿dockerå°±æ›´æ–¹ä¾¿äº†ï¼Œæ›´å¥½åœ°ç†è§£å¹¶ä¸”æŠ˜è…¾æ¸…æ¥šåŸç†å•¦ã€‚<br>æ³¨æ„ï¼Œä»¥ä¸‹éƒ½æ˜¯åŸºäº Ubuntu 20.04.4 LTS ç‰ˆæœ¬(Focal Fossa)è¯´æ˜çš„ã€‚</p>
<h1 id="å¿…è¦ç†Ÿæ‚‰å‘½ä»¤"><a href="#å¿…è¦ç†Ÿæ‚‰å‘½ä»¤" class="headerlink" title="å¿…è¦ç†Ÿæ‚‰å‘½ä»¤"></a>å¿…è¦ç†Ÿæ‚‰å‘½ä»¤</h1><h2 id="aptè½¯ä»¶åŒ…ç®¡ç†"><a href="#aptè½¯ä»¶åŒ…ç®¡ç†" class="headerlink" title="aptè½¯ä»¶åŒ…ç®¡ç†"></a>aptè½¯ä»¶åŒ…ç®¡ç†</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æœç´¢è½¯ä»¶</span>
<span class="token function">sudo</span> <span class="token function">apt-cache</span> search jdk
<span class="token comment"># å®‰è£…è½¯ä»¶</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openjdk-8-jdk
<span class="token comment"># æŸ¥çœ‹è½¯ä»¶å®‰è£…çŠ¶æ€</span>
<span class="token function">sudo</span> dpkg -l <span class="token operator">|</span> <span class="token function">fgrep</span> openjdk-8-jdk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="debè½¯ä»¶åŒ…ç®¡ç†"><a href="#debè½¯ä»¶åŒ…ç®¡ç†" class="headerlink" title="debè½¯ä»¶åŒ…ç®¡ç†"></a>debè½¯ä»¶åŒ…ç®¡ç†</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£….debè½¯ä»¶åŒ…</span>
<span class="token function">sudo</span> dpkg -i xxx.deb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h1 id="å¿…è£…è½¯ä»¶"><a href="#å¿…è£…è½¯ä»¶" class="headerlink" title="å¿…è£…è½¯ä»¶"></a>å¿…è£…è½¯ä»¶</h1><h2 id="å¼€å‘è½¯ä»¶"><a href="#å¼€å‘è½¯ä»¶" class="headerlink" title="å¼€å‘è½¯ä»¶"></a>å¼€å‘è½¯ä»¶</h2><ul>
<li>SSH-Server</li>
</ul>
<p>å®‰è£…å‘½ä»¤å‚è§ <a href="https://davyjones2010.github.io/2022-06-25-linux-network-scripts/#Ubuntu">å¸¸ç”¨çš„Linuxå‘½ä»¤ä¹‹ç½‘ç»œç›¸å…³å‘½ä»¤</a></p>
<ul>
<li><p>JDK</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> add-apt-repository ppa:openjdk-r/ppa
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openjdk-8-jdk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Maven</p>
</li>
<li><p>MySQL</p>
</li>
<li><p>Git</p>
</li>
<li><p>SourceTree -&gt; GitKraken</p>
</li>
<li><p>IntelliJ IDEA</p>
</li>
<li><p>nettools</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> net-tools <span class="token function">traceroute</span>
<span class="token comment"># å®‰è£…ä¹‹åå°±å¯ä»¥æ‰§è¡Œ route -n å‘½ä»¤æŸ¥çœ‹è·¯ç”±è¡¨ä¿¡æ¯ï¼Œæ‰§è¡Œ traceroute è¿½è¸ªå®é™…è·¯ç”±ä¿¡æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>Docker<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> -sSL https://get.daocloud.io/docker <span class="token operator">|</span> <span class="token function">sh</span>
<span class="token function">sudo</span> apt-key adv --keyserver keyserver.ubuntu.com --recv-keys xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li>Vim</li>
<li>Sublime</li>
<li>Postman</li>
<li>KubeCtl</li>
<li>Go</li>
</ul>
<h2 id="æ•ˆç‡"><a href="#æ•ˆç‡" class="headerlink" title="æ•ˆç‡"></a>æ•ˆç‡</h2><ul>
<li>ä¿®æ”¹aptè½¯ä»¶æº</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># vim /etc/apt/sources.list</span>
deb http://mirrors.163.com/ubuntu/ focal main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ focal-security main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ focal-updates main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ focal-proposed main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ focal-backports main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ focal main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ focal-security main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ focal-updates main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ focal-proposed main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ focal-backports main restricted universe multiverse
deb http://ftp.sjtu.edu.cn/ubuntu/ focal main universe restricted multiverse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>XMind</p>
</li>
<li><p>Gliffy Diagrams</p>
</li>
<li><p><a href="https://gnomepomodoro.org/">gnomepomodoro</a></p>
</li>
<li><p>ClashX â€“&gt; QV2Ray</p>
</li>
<li><p><a href="https://www.jianguoyun.com/s/downloads/linux">åšæœäº‘</a></p>
</li>
<li><p>æˆªå›¾</p>
</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none"># ä¿å­˜åˆ° ~&#x2F;Pictures&#x2F; ç›®å½•ä¸‹
Alt + PrintScreen # æˆªå–é€‰ä¸­çš„çª—å£
Shift + PrintScreen # è‡ªç”±é€‰å–

# ä¿å­˜åˆ°å‰ªè´´æ¿
Ctrl + Alt + PrintScreen # æˆªå–é€‰ä¸­çš„çª—å£
Shift + Ctrl + PrintScreen # è‡ªç”±é€‰å–<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å¿…è¦é…ç½®"><a href="#å¿…è¦é…ç½®" class="headerlink" title="å¿…è¦é…ç½®"></a>å¿…è¦é…ç½®</h1><h3 id="æœ€å¤§åŒ–æœ€å°åŒ–å…³é—­æŒ‰é’®æ”¾åˆ°å·¦ä¸Šè§’"><a href="#æœ€å¤§åŒ–æœ€å°åŒ–å…³é—­æŒ‰é’®æ”¾åˆ°å·¦ä¸Šè§’" class="headerlink" title="æœ€å¤§åŒ–æœ€å°åŒ–å…³é—­æŒ‰é’®æ”¾åˆ°å·¦ä¸Šè§’"></a>æœ€å¤§åŒ–æœ€å°åŒ–å…³é—­æŒ‰é’®æ”¾åˆ°å·¦ä¸Šè§’</h3><p>æƒ³è¦è·ŸMacä¹ æƒ¯ä¿æŒä¸€è‡´</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gsettings <span class="token builtin class-name">set</span> org.gnome.desktop.wm.preferences button-layout <span class="token string">"close,maximize,minimize:"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ¢å¤åˆ°å³ä¸Šè§’ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gsettings <span class="token builtin class-name">set</span> org.gnome.desktop.wm.preferences button-layout <span class="token string">":close,maximize,minimize"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å…ˆå†™åˆ°è¿™å„¿å§. åè¾¹æœ‰å•¥å†è¡¥å…….</p>
<h1 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h1><h2 id="Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ"><a href="#Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ" class="headerlink" title="Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ"></a>Mavenè®¾ç½®é˜¿é‡Œäº‘é•œåƒ</h2><p>Copy From <a href="https://zhuanlan.zhihu.com/p/71998219">å°†mavenæºæ”¹ä¸ºå›½å†…é˜¿é‡Œäº‘é•œåƒ</a></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/SETTINGS/1.0.0<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/SETTINGS/1.0.0
                      http://maven.apache.org/xsd/settings-1.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localRepository</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interactiveMode</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>usePluginRegistry</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>offline</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginGroups</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servers</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>é˜¿é‡Œäº‘å…¬å…±ä»“åº“<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>repo1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>central repo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://repo1.maven.org/maven2/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>apache snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>é˜¿é‡Œäº‘é˜¿å¸•å¥‡ä»“åº“<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/apache-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>proxies</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeProfiles</span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">></span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">></span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>releases</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>releases</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>MavenCentral<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://repo1.maven.org/maven2/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmavenApache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/apache-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">></span></span>             
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="ç³»ç»Ÿæ¢å¤è½¯ä»¶"><a href="#ç³»ç»Ÿæ¢å¤è½¯ä»¶" class="headerlink" title="ç³»ç»Ÿæ¢å¤è½¯ä»¶"></a>ç³»ç»Ÿæ¢å¤è½¯ä»¶</h1><p>è¶Šæ¥è¶Šå¸Œæœ›èƒ½åšä¸ªç±»ä¼¼Windowsçš„Ghostç³»ç»Ÿï¼Œå³æŠŠç°åœ¨çš„ç³»ç»Ÿä»¥åŠè½¯ä»¶ä»¥åŠé…ç½®éƒ½æ‰“åŒ…æˆä¸€ä¸ªç³»ç»Ÿé•œåƒï¼Œè¿™æ ·åç»­æ¢ç”µè„‘ï¼Œ<br>ä¹Ÿèƒ½å¾ˆæ–¹ä¾¿åœ°åˆå§‹åŒ–è‡ªå·±çš„ç³»ç»Ÿã€‚çœå¾—é‡å¤å®‰è£…ä¸é…ç½®è¿™ä¹ˆå¤šä¸œè¥¿ã€‚è¿™ä¸ªåç»­ç ”ç©¶ä¸‹å§ã€‚<br><a href="https://blog.csdn.net/leaf6094189/article/details/6009924">https://blog.csdn.net/leaf6094189/article/details/6009924</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>ubuntu</tag>
        <tag>system-init</tag>
        <tag>system-config</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡ç”±äºremoteCacheç±»å‹ä¸å…¼å®¹ä¿®æ”¹å¯¼è‡´çš„å¼‚å¸¸é—®é¢˜</title>
    <url>//2022-04-30-cache-incompatible/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>è¿›è¡ŒRedisç¼“å­˜å‡çº§æ”¹é€ , ç¼“å­˜è®¿é—®å±‚ç»Ÿä¸€è¿›è¡Œäº†ä¿®æ”¹:<br>ä¿®æ”¹å‰ä»£ç å¦‚ä¸‹, æŒ‰ç…§JavaåŸç”Ÿåºåˆ—åŒ–æ–¹å¼: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å†™ç¼“å­˜, Longç±»å‹</span>
cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span> <span class="token number">123L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¯»ç¼“å­˜, Longç±»å‹</span>
<span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹åä»£ç å¦‚ä¸‹, ç»Ÿä¸€æŒ‰ç…§Stringç±»å‹è¿›è¡Œåºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å†™ç¼“å­˜, è½¬æˆStringç±»å‹</span>
cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span> <span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¯»ç¼“å­˜, è·å–Stringç±»å‹</span>
<span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>çº¿ä¸Šå‘å¸ƒè¿‡ç¨‹ä¸­æŠ¥å‡ºå¼‚å¸¸, <code>ClassCastException</code>, Longç±»å‹æ— æ³•è¢«castæˆStringç±»å‹.<br>ç»åˆ†æ, ç”±äºæ˜¯é›†ç¾¤çš„ç¯å¢ƒ, å‘å¸ƒè¿‡ç¨‹ä¸­, é’ˆå¯¹åŒä¸€ä¸ªâ€keyâ€, </p>
<ul>
<li>æœªå¸ƒæœºå™¨å†™å…¥çš„è¿˜æ˜¯Longç±»å‹</li>
<li>å·²å‘å¸ƒçš„æœºå™¨è¯»å–è¯¥â€keyâ€å¯¹åº”çš„value, å°è¯•å¼ºè½¬æˆString,<br>åä¹‹äº¦ç„¶, ä¹Ÿä¼šæœ‰ Stringç±»å‹æ— æ³•è¢«castæˆLongç±»å‹çš„æŠ¥é”™.</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹, å¯¹remote cacheçš„ä¿®æ”¹, ä¸€å®šè¦æ³¨æ„å…¼å®¹æ€§:</p>
<ul>
<li>ä¸æ­¢æ–°ç‰ˆæœ¬æ—§ç‰ˆæœ¬çš„å…¼å®¹æ€§</li>
<li>æ›´è¦è€ƒè™‘åˆ°å‘å¸ƒè¿‡ç¨‹ä¸­æ–°è€æœºå™¨, é’ˆå¯¹åŒä¸€ä¸ªkeyçš„ç±»å‹çš„å…¼å®¹æ€§.</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>cache</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡ç”±äºJVMä¼˜åŒ–å¯¼è‡´å¼‚å¸¸å †æ ˆä¸¢å¤±çš„é—®é¢˜</title>
    <url>//2022-04-30-java-exception-stack-trace-missing/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>çº¿ä¸ŠæŸæ¬¡æ•…éšœæ’æŸ¥, å‘ç°çº¿ä¸Šæœ‰å¼‚å¸¸, ä½†æ— å †æ ˆä¿¡æ¯.<br>å®é™…æŸ¥çœ‹æ‰“å°å¼‚å¸¸çš„åœ°æ–¹, ç¡®å®æ˜¯ä¼šæ‰“å°å‡ºå †æ ˆçš„. é‚£ä¹ˆå †æ ˆä¿¡æ¯ä¸ºå•¥ä¼šä¸¢å‘¢? </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassCastException</span><span class="token operator">:</span> <span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="åŸå› æ’æŸ¥"><a href="#åŸå› æ’æŸ¥" class="headerlink" title="åŸå› æ’æŸ¥"></a>åŸå› æ’æŸ¥</h1><p>JVMé»˜è®¤ä¼šä¼˜åŒ–æ‰ç›¸åŒå †æ ˆçš„ä¿¡æ¯:<br><a href="https://stackoverflow.com/questions/40502576/java-lang-classcastexception-with-null-message-and-cause">java.lang.ClassCastException with null message and cause</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>å¦‚ <a href="https://blog.csdn.net/lisheng19870305/article/details/106361875">â€œjava.lang.ClassCastException: nullâ€åŸå› è§£å†³</a>, é’ˆå¯¹å¦‚ä¸‹ç±»å‹çš„å¼‚å¸¸, JVMé»˜è®¤éƒ½ä¼šä¼˜åŒ–: <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NullPointerException</span>
<span class="token class-name">ArrayIndexOutOfBoundsException</span>
<span class="token class-name">ClassCastException</span>
<span class="token class-name">ArrayIndexOutOfBoundsException</span>
<span class="token class-name">ArrayStoreException</span>
<span class="token class-name">ArithmeticException</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>ä»¥åé”™è¯¯æ—¥å¿—æœ€å¥½ä¿ç•™æ—¶é—´é•¿ä¸€ç‚¹, è¿™æ ·æ‰èƒ½å®šä½å‡ºå¼‚å¸¸é¦–æ¬¡å‡ºç°çš„ä½ç½®, æ‰èƒ½çœ‹åˆ°å®Œæ•´çš„å †æ ˆä¿¡æ¯. </li>
<li>æˆ–è€…å¯ä»¥å¢åŠ : <code>-XX:-OmitStackTraceInFastThrow</code> å‚æ•°æ¥é˜²æ­¢JVMä¼˜åŒ–.</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>stacktrace</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±åº¦æ€è€ƒï¼šä¸æ–­é€¼è¿‘é—®é¢˜çš„æœ¬è´¨ è¯»åæ„Ÿ</title>
    <url>//2022-05-03-Beyond-the-Label/</url>
    <content><![CDATA[<p>æ€»ä½“æ¥è¯´ï¼Œé¸¡æ±¤ä¸å°‘ï¼Œä½†æ²¡å•¥å¹²è´§ï¼Œè¯´çš„éƒ½æ˜¯ä¸€äº›è™šæ— ç¼¥ç¼ˆä¸”äººå°½çš†çŸ¥çš„å¤§é“ç†ã€‚</p>
<hr>
<p>è¯»çš„è¿‡ç¨‹ï¼Œä¹Ÿæ„Ÿè§‰å¾ˆé¸¡è‚‹ï¼Œæ„Ÿè§‰åƒæ˜¯æœ‰äº›è‡ªæ‹çš„äººçš„è‡ªä¼ ï¼Œæ„ˆå‘è¯»ä¸ä¸‹å»ï¼Œä½†åˆä¸ºäº†å®Œæ•´è¯»å®Œä¸€æœ¬ä¹¦ï¼Œç¡¬ç€å¤´çš®è¯»äº†ä¸‹å»ï¼ŒæœŸå¾…ç€åè¾¹è¯´ä¸å®šä¼šç”±æœ‰ä¸åŒçš„æ”¶è·ã€‚<br>ä½†ç»“æœä»¤äººå¤±æœ›ï¼Œç”šè‡³éƒ½ä¸æƒ³åšç¬”è®°ã€‚<br>é¦–å…ˆï¼Œä¹¦åéå¸¸å…·æœ‰è¿·æƒ‘æ€§ï¼Œå®åœ¨æ²¡çœ‹å‡ºè·Ÿæ·±åº¦æ€è€ƒï¼Œä»¥åŠæ¢ç©¶é—®é¢˜çš„æœ¬è´¨æœ‰ä»»ä½•å…³ç³»ã€‚ç›´åˆ°çœ‹äº†è‹±æ–‡åç§°ï¼Œæ‰æç„¶å¤§æ‚Ÿã€‚<br>ã€ŠBeyond the Label: Women, Leadership, and Success on Our Own Termsã€‹ï¼Œ<br>ç›´è¯‘è¿‡æ¥å°±æ˜¯ï¼šã€Šæ‹’ç»æ ‡ç­¾ï¼šå¥³æ€§ï¼Œé¢†å¯¼åŠ›ä¸æˆåŠŸã€‹ï¼Œå‹æ ¹è·Ÿæ·±åº¦æ€è€ƒæ²¡ä»»ä½•å…³ç³»ï¼Œä¹Ÿä¸çŸ¥é“ä¹¦åçš„ä¸­æ–‡ç¿»è¯‘äººå‘˜å’‹æƒ³çš„ã€‚<br>å¦‚æœæ—©çœ‹äº†è‹±æ–‡åï¼Œå°¤å…¶æ˜¯å‡ ä¸ªé›·åŒºè¯â€œWomenâ€ï¼Œâ€œLeadershipâ€ï¼Œâ€œSuccessâ€ç­‰è¿™äº›ï¼Œå°±ä¸€å®šä¸ä¼šè¯»çš„ã€‚</p>
<p>å…¶æ¬¡ï¼Œå†…å®¹æ›´åƒæ˜¯ä½œè€…è‡ªå·±çš„ç»å†è‡ªä¼ ã€‚æœ€å¼€å§‹å½“ä¸ªæ¨é”€å‘˜ï¼Œè«åå¥‡å¦™å°±æ¨é”€æˆåŠŸäº†ï¼Œç„¶åè¿˜è·å¾—äº†è´µäººçš„å¸®åŠ©ã€‚<br>å¦‚æœè¯´æ˜¯å› ä¸ºçœŸè¯šï¼Œé‚£ä¹ˆæˆ‘ç›¸ä¿¡ä¸–ç•Œä¸Šæ¯”å¥¹çœŸè¯šçš„äººè¦å¤šå¾—å¤šï¼Œä¸ºä»€ä¹ˆå…¶ä»–äººæ²¡æœ‰ï¼Ÿ<br>è«åå…¶å¦™å°±ç»“å©šäº†ï¼Œè«åå…¶å¦™è¢«æ´¾åˆ°é¦™æ¸¯ï¼Œè«åå…¶å¦™åˆæŒç®¡äº†GAPï¼ŒæŠŠold navyåšäº†èµ·æ¥ï¼Œç„¶åGAPè«åå…¶å¦™å°±ä¸è¡Œäº†ï¼Œè«åå…¶å¦™å°±æˆäº†é¦™å¥ˆå„¿çš„CEOäº†ã€‚<br>æœ€åç”±è«åå…¶å¦™ç¦»å©šï¼Œè¿˜ç¾å…¶åæ›°â€œæ‰“ç ´è§„åˆ™â€ã€‚<br>æ€»ä½“æ¥è¯´è¿™äº›è½¬å˜è¯»è€…æˆ‘æ˜¯ä¸€å¤´é›¾æ°´ã€‚<br>æˆ‘ç›¸ä¿¡æˆä¸ºä¸€ä¸ªä¼˜ç§€çš„CEOï¼ŒæŠŠä¸€ä¸ªå…¬å¸ä¸å“ç‰Œåšèµ·æ¥ï¼Œéœ€è¦çš„ç»å¯¹ä¸ä»…æ˜¯ä¹¦ä¸­å¥¹æåˆ°çš„è¿™äº›è½¯ç´ è´¨ï¼Œè¿˜æœ‰å·¨å¤§çš„ä¸€å—ï¼Œåº”è¯¥å°±æ˜¯ç¡¬ç´ è´¨ã€‚<br>å¦‚ä½•ç†è§£ç®¡ç†ï¼Œæ¯•ç«Ÿä¹Ÿæ˜¯ä¸€é—¨å·¥ç¨‹ä¸ç§‘å­¦ï¼›å¦‚ä½•ç†è§£è´¢åŠ¡æŠ¥è¡¨ï¼Œå¤„ç†è´¢åŠ¡å±æœºï¼›å¦‚ä½•å“ç‰Œè¥é”€ä¸å½¢è±¡æ ‘ç«‹ï¼Ÿ<br>ç­‰ç­‰ã€‚<br>æ–‡ä¸­æåˆ°çš„è¿™äº›è½¯ç´ è´¨ï¼Œéƒ½å¤ªæ™®é€šäº†ï¼Œå¤ªæ²¡æœ‰ä¸“ä¸šé—¨æ§›äº†ã€‚</p>
<p>æœ€åå°±æ˜¯è®²åˆ°çš„ä¸€äº›å…³äºå¥³æ€§èŒåœºç‰¹æœ‰çš„é—®é¢˜ï¼Œä¾‹å¦‚â€œå½“äººä»¬åªæ³¨æ„ä½ çš„å¤–è²Œè€Œéå·¥ä½œæ—¶ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿâ€ï¼Œå¹¶æ— æ³•å¼•å‘ä¸æ¯«æˆ‘è¿™ä½ç›´ç”·ç™Œæ‚£è€…çš„å…±é¸£ã€‚</p>
<p>å¸å–å‡ ç‚¹æ•™è®­å§ï¼š</p>
<ol>
<li>çœ‹è‹±æ–‡ç¿»è¯‘ä¹¦ä¹‹å‰ï¼Œä¸€å®šè¦çœ‹ä¸‹åŸå…ˆçš„è‹±æ–‡åç§°æ˜¯å•¥ï¼Œåƒä¸‡ä¸èƒ½è¢«å¿½æ‚ äº†ã€‚</li>
<li>ç›¸ä¿¡è‡ªå·±çš„åˆ¤æ–­ï¼Œä¸€æ—¦çœ‹ä¸ä¸‹å»ï¼Œè§‰å¾—æ²¡æ„æ€æ²¡ä»·å€¼æ²¡æ”¶è·ï¼Œå°±æœæ–­å¼ƒå‘ï¼Œä¸è¦ä¸ºäº†å®Œæˆè¯»ä¹¦è€Œè¯»ä¹¦ï¼Œå¦åˆ™æ²‰æ²¡æˆæœ¬å¤ªé«˜ã€‚</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>books</tag>
        <tag>2022</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu kvmè™šæ‹ŸåŒ–é…ç½®</title>
    <url>//2022-05-07-ubuntu-kvm-init/</url>
    <content><![CDATA[<h1 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h1><ul>
<li>OS: Ubuntu 20.04.4 LTS </li>
<li>OS Typeï¼š 64-bit</li>
<li>ç¡¬ä»¶ï¼š ThinkPad-X1-Carbon-4th</li>
<li>CPUï¼šIntelÂ® Coreâ„¢ i5-6200U CPU @ 2.30GHz Ã— 4</li>
<li>MEMï¼š</li>
<li>Graphicsï¼šMesa IntelÂ® HD Graphics 520 (SKL GT2)</li>
<li>Diskï¼š</li>
</ul>
<h1 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h1><h2 id="1-BIOSå¼€å¯CPUè™šæ‹ŸåŒ–"><a href="#1-BIOSå¼€å¯CPUè™šæ‹ŸåŒ–" class="headerlink" title="1. BIOSå¼€å¯CPUè™šæ‹ŸåŒ–"></a>1. BIOSå¼€å¯CPUè™šæ‹ŸåŒ–</h2><h3 id="å¼€å¯"><a href="#å¼€å¯" class="headerlink" title="å¼€å¯"></a>å¼€å¯</h3><ul>
<li>å¼€æœºä¹‹åæŒ‰ä¸‹F1é”®</li>
<li>è¿›å…¥Securityé€‰é¡¹</li>
<li>è¿›å…¥Virtualizationå­é€‰é¡¹</li>
<li>Intel(R) Virtualization Technology é€‰é¡¹ä¿®æ”¹æˆ Enable</li>
<li>Intel(R) VT-d Feature é€‰é¡¹ä¿®æ”¹æˆ Enable</li>
</ul>
<h3 id="ç¡®è®¤"><a href="#ç¡®è®¤" class="headerlink" title="ç¡®è®¤"></a>ç¡®è®¤</h3><h4 id="æ–¹æ¡ˆä¸€ï¼š"><a href="#æ–¹æ¡ˆä¸€ï¼š" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼š"></a>æ–¹æ¡ˆä¸€ï¼š</h4><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥æ‰¾åˆ° <code>Virtualization:                  VT-x</code> é¡¹ç›®å³è¯æ˜å·²ç»å¼€å¯</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads/Clash-Linux$ lscpu
Architecture:                    x86_64
CPU op-mode<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:                  <span class="token number">32</span>-bit, <span class="token number">64</span>-bit
Byte Order:                      Little Endian
Address sizes:                   <span class="token number">39</span> bits physical, <span class="token number">48</span> bits virtual
CPU<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:                          <span class="token number">4</span>
On-line CPU<span class="token punctuation">(</span>s<span class="token punctuation">)</span> list:             <span class="token number">0</span>-3
Thread<span class="token punctuation">(</span>s<span class="token punctuation">)</span> per core:              <span class="token number">2</span>
Core<span class="token punctuation">(</span>s<span class="token punctuation">)</span> per socket:              <span class="token number">2</span>
Socket<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:                       <span class="token number">1</span>
NUMA node<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:                    <span class="token number">1</span>
Vendor ID:                       GenuineIntel
CPU family:                      <span class="token number">6</span>
Model:                           <span class="token number">78</span>
Model name:                      Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i5-6200U CPU @ <span class="token number">2</span>.30GHz
Stepping:                        <span class="token number">3</span>
CPU MHz:                         <span class="token number">499.999</span>
CPU max MHz:                     <span class="token number">2800.0000</span>
CPU min MHz:                     <span class="token number">400.0000</span>
BogoMIPS:                        <span class="token number">4800.00</span>
Virtualization:                  VT-x
L1d cache:                       <span class="token number">64</span> KiB
L1i cache:                       <span class="token number">64</span> KiB
L2 cache:                        <span class="token number">512</span> KiB
L3 cache:                        <span class="token number">3</span> MiB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p>æ‰§è¡Œ <code>egrep -o &#39;(vmx|svm)&#39; /proc/cpuinfo</code> ç”±å¦‚ä¸‹å€¼åˆ™ä¸ºæˆåŠŸ</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">egrep</span> -o <span class="token string">'(vmx|svm)'</span> /proc/cpuinfo 
vmx
vmx
vmx
vmx
vmx
vmx
vmx
vmx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-KVMå®‰è£…"><a href="#2-KVMå®‰è£…" class="headerlink" title="2. KVMå®‰è£…"></a>2. KVMå®‰è£…</h2><p>å…¶ä¸­ <code>libvirt-bin</code> ä¸ºéå¿…è¦ä¾èµ–</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> qemu-kvm qemu libvirt-bin virt-manager virt-viewer bridge-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">sudo</span> kvm-ok
INFO: /dev/kvm exists
KVM acceleration can be used<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="3-ç¡®è®¤ç¯å¢ƒ"><a href="#3-ç¡®è®¤ç¯å¢ƒ" class="headerlink" title="3. ç¡®è®¤ç¯å¢ƒ"></a>3. ç¡®è®¤ç¯å¢ƒ</h2><h1 id="Trouble-Shootings"><a href="#Trouble-Shootings" class="headerlink" title="Trouble Shootings"></a>Trouble Shootings</h1><h2 id="Your-CPU-does-not-support-KVM-extensions"><a href="#Your-CPU-does-not-support-KVM-extensions" class="headerlink" title="Your CPU does not support KVM extensions"></a>Your CPU does not support KVM extensions</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">sudo</span> kvm-ok
Your CPU does not support KVM extensions<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://edu.51cto.com/center/course/lesson/index?id=118662">å¼€æºè™šæ‹ŸåŒ–KVMå…¥é—¨ï¼ˆKVMæ¶æ„+KVMåŸºæœ¬ç®¡ç†ï¼‰è§†é¢‘è¯¾ç¨‹</a></li>
<li><a href="https://blog.csdn.net/ZHOU_VIP/article/details/116767782">ThinkPadæœºå‹BIOSå¼€å¯VTè™šæ‹ŸåŒ–æŠ€æœ¯</a></li>
<li><a href="https://blog.csdn.net/weixin_45761101/article/details/114524806">ubuntuå®‰è£…kvm</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>ubuntu</tag>
        <tag>system-init</tag>
        <tag>system-config</tag>
        <tag>kvm</tag>
        <tag>virtualization</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸­é…ç½®æ–‡ä»¶å ä½ç¬¦æ›¿æ¢çš„å‡ ç§æ¨¡å¼æ¢è®¨ä¸åˆ†æ</title>
    <url>//2022-05-13-java-property-config/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨Java&#x2F;Mavené¡¹ç›®ä¸­, ç»å¸¸ä¼šæœ‰é…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹, éœ€è¦æ ¹æ®ç¯å¢ƒè¿›è¡Œä¸åŒçš„å‚æ•°å˜é‡æ›¿æ¢, å¦‚æœæä¸æ¸…æ¥š, ç»å¸¸ä¼šæ··æ·†.<br>å½“å‰æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼: </p>
<ul>
<li>ç¼–è¯‘æœŸæ›¿æ¢<ul>
<li>Maven Profile</li>
<li><a href="https://juejin.cn/post/6844903962240352263">autoconfig</a></li>
</ul>
</li>
<li>è¿è¡ŒæœŸæ›¿æ¢<ul>
<li>SpringBoot Profile</li>
</ul>
</li>
<li>å…¶ä»–æ›¿æ¢<ul>
<li>Docker Javaåº”ç”¨å¯åŠ¨å‚æ•°</li>
</ul>
</li>
</ul>
<p>å„æœ‰ä¼˜ç¼ºç‚¹. </p>
<h1 id="1-ç¼–è¯‘æœŸæ›¿æ¢"><a href="#1-ç¼–è¯‘æœŸæ›¿æ¢" class="headerlink" title="1. ç¼–è¯‘æœŸæ›¿æ¢"></a>1. ç¼–è¯‘æœŸæ›¿æ¢</h1><h2 id="1-1-Maven-Profile"><a href="#1-1-Maven-Profile" class="headerlink" title="1.1 Maven Profile"></a>1.1 Maven Profile</h2><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><ul>
<li>å‚è§<a href="https://www.cnblogs.com/davenkin/p/advanced-maven-use-profile.html">Maven Profileä½¿ç”¨æ–¹å¼</a></li>
</ul>
<h4 id="æ–¹å¼1-é»˜è®¤æ¿€æ´»"><a href="#æ–¹å¼1-é»˜è®¤æ¿€æ´»" class="headerlink" title="æ–¹å¼1: é»˜è®¤æ¿€æ´»"></a>æ–¹å¼1: é»˜è®¤æ¿€æ´»</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>apple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fruit</span><span class="token punctuation">></span></span>APPLE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fruit</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>banana<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fruit</span><span class="token punctuation">></span></span>BANANA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fruit</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn initialize
mvn clean compile -DskipTests<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="æ–¹å¼2-æŒ‡å®šprofileæ¿€æ´»"><a href="#æ–¹å¼2-æŒ‡å®šprofileæ¿€æ´»" class="headerlink" title="æ–¹å¼2: æŒ‡å®šprofileæ¿€æ´»"></a>æ–¹å¼2: æŒ‡å®šprofileæ¿€æ´»</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn initialize -Pbanana
mvn clean compile -DskipTests -Pbanana<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="æ–¹å¼3-è‡ªåŠ¨æ¿€æ´»Profile"><a href="#æ–¹å¼3-è‡ªåŠ¨æ¿€æ´»Profile" class="headerlink" title="æ–¹å¼3: è‡ªåŠ¨æ¿€æ´»Profile"></a>æ–¹å¼3: è‡ªåŠ¨æ¿€æ´»Profile</h4><p>å¦‚ä¸‹æ ¹æ®mavenå†…ç½®çš„ç³»ç»Ÿå˜é‡è¿›è¡Œ, <a href="https://maven.apache.org/enforcer/enforcer-rules/requireOS.html">æ›´å¤šç³»ç»Ÿå˜é‡</a></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>mac<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>os</span><span class="token punctuation">></span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>family</span><span class="token punctuation">></span></span>mac<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>family</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>os</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.driverClassName</span><span class="token punctuation">></span></span>org.postgresql.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.driverClassName</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.url</span><span class="token punctuation">></span></span>jdbc:postgresql://localhost/database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.url</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.user</span><span class="token punctuation">></span></span>username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.user</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.password</span><span class="token punctuation">></span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.password</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>unix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>os</span><span class="token punctuation">></span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>family</span><span class="token punctuation">></span></span>unix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>family</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>os</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.driverClassName</span><span class="token punctuation">></span></span>com.mysql.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.driverClassName</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.url</span><span class="token punctuation">></span></span>jdbc:mysql://localhost:3306/database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.url</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.user</span><span class="token punctuation">></span></span>username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.user</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database.password</span><span class="token punctuation">></span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database.password</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="é…ç½®æ–‡ä»¶å˜é‡æ›¿æ¢"><a href="#é…ç½®æ–‡ä»¶å˜é‡æ›¿æ¢" class="headerlink" title="é…ç½®æ–‡ä»¶å˜é‡æ›¿æ¢"></a>é…ç½®æ–‡ä»¶å˜é‡æ›¿æ¢</h3><p>å¦‚ä¸‹, æ ¹æ®Maven Profileæ¥é€‰æ‹©ä¸åŒçš„filteræ–‡ä»¶, æ ¹æ®ä¸åŒçš„filteræ–‡ä»¶, ç¼–è¯‘æœŸå°† <code>src/main/resources/*</code> ä¸­çš„å˜é‡éƒ½æ›¿æ¢æ‰. </p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span><span class="token punctuation">></span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>src/main/filters-$&#123;active.profile&#125;.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active.profile</span><span class="token punctuation">></span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active.profile</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- æŠŠå½“å‰profileè®¾ç½®ä¸ºé»˜è®¤profileï¼Œå¯ä»¥åŒæ—¶è¿™æ˜¯å¤šä¸ªä¸ºé»˜è®¤--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active.profile</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active.profile</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>product<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>active.profile</span><span class="token punctuation">></span></span>product<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>active.profile</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">></span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-2-autoconfig"><a href="#1-2-autoconfig" class="headerlink" title="1.2 autoconfig"></a>1.2 autoconfig</h2><p>æœ¬è´¨å…¶å®ä¸maven filterç±»ä¼¼. ä¸åšè¿‡å¤šè§£é‡Š. å‚è§: <a href="https://juejin.cn/post/6844903962240352263">Webxä½¿ç”¨Autoconfigæ€»ç»“</a></p>
<h1 id="2-è¿è¡ŒæœŸæ›¿æ¢"><a href="#2-è¿è¡ŒæœŸæ›¿æ¢" class="headerlink" title="2. è¿è¡ŒæœŸæ›¿æ¢"></a>2. è¿è¡ŒæœŸæ›¿æ¢</h1><h2 id="2-1-SpringBoot-Profile"><a href="#2-1-SpringBoot-Profile" class="headerlink" title="2.1 SpringBoot Profile"></a>2.1 SpringBoot Profile</h2><p>åˆæ­¥ä½¿ç”¨æ–¹å¼å‚è§: <a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1282388483112993">ä½¿ç”¨Profiles</a><br>å…·ä½“å¤šæ¨¡å—åŒ–å¤šå±‚æ¬¡é…ç½®å‚è§: <a href="https://davyjones2010.github.io/2022-02-14-maven-multi-module-test/#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%8C%89%E7%85%A7-%E9%80%9A%E7%94%A8%E6%B5%8B%E8%AF%95%E7%94%9F%E4%BA%A7%E7%AD%89%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3-%E4%B8%A4%E7%B1%BB%E8%BF%9B%E8%A1%8C%E6%8B%86%E5%88%86">SpringBoot+Mavenå¤šæ¨¡å—é¡¹ç›®æµ‹è¯•æœ€ä½³å®è·µ</a><br>ä¼˜ç‚¹: æ— éœ€é‡æ–°ç¼–è¯‘æ‰“åŒ…, ç›´æ¥æŒ‡å®šä¸åŒçš„è¿è¡Œå‚æ•°å³å¯. </p>
<h1 id="3-å…¶ä»–å½¢å¼æ›¿æ¢"><a href="#3-å…¶ä»–å½¢å¼æ›¿æ¢" class="headerlink" title="3. å…¶ä»–å½¢å¼æ›¿æ¢"></a>3. å…¶ä»–å½¢å¼æ›¿æ¢</h1><p>å¦‚ä¸Š, Maven Profileæ–¹æ¡ˆ, å¦‚æœéœ€è¦dev&#x2F;pre&#x2F;prodä¸åŒç¯å¢ƒæ‰“å‡ºæ¥ä¸åŒçš„åŒ…, éœ€è¦åœ¨mavenç¼–è¯‘æ—¶æ‰‹åŠ¨æŒ‡å®š <code>-Pdev</code>.<br>ä½†åœ¨å®é™…CI&#x2F;CDä¸­, ä¸å¯èƒ½æ‰‹åŠ¨æ•²å‘½ä»¤æ¥æ‰“åŒ…&#x2F;æŒ‡å®šå‚æ•°. å› æ­¤éƒ½éœ€è¦ä¸CI&#x2F;CDæ¡†æ¶è¿›è¡Œç»“åˆ, ä»è€Œæ„ŸçŸ¥åˆ°ä¸åŒç¯å¢ƒå‚æ•°. </p>
<h2 id="3-1-è‡ªå®šä¹‰éƒ¨ç½²è„šæœ¬"><a href="#3-1-è‡ªå®šä¹‰éƒ¨ç½²è„šæœ¬" class="headerlink" title="3.1 è‡ªå®šä¹‰éƒ¨ç½²è„šæœ¬"></a>3.1 è‡ªå®šä¹‰éƒ¨ç½²è„šæœ¬</h2><p>è¿™ä¸ªä¾èµ–äºCI&#x2F;CDæ¡†æ¶æœ¬èº«. </p>
<ul>
<li>åœ¨Jenkinsé‡Œ, å¯ä»¥æ‰‹åŠ¨ä¸ºä¸åŒçš„pipeline(ç¯å¢ƒ), æŒ‡å®šä¸åŒçš„å‘½ä»¤. dev pipelineæŒ‡å®š<code>-Pdev</code></li>
<li>åœ¨å…¶ä»–æ¡†æ¶é‡Œ, æ‰‹åŠ¨ç¼–å†™å¯åŠ¨è„šæœ¬ç­‰, è¯†åˆ«CI&#x2F;CDæ¡†æ¶çš„ç¯å¢ƒå˜é‡æ¥æŒ‡å®š<code>-Pdev</code>ç­‰å‚æ•°</li>
</ul>
<h2 id="3-2-Docker-Javaåº”ç”¨å¯åŠ¨å‚æ•°"><a href="#3-2-Docker-Javaåº”ç”¨å¯åŠ¨å‚æ•°" class="headerlink" title="3.2 Docker Javaåº”ç”¨å¯åŠ¨å‚æ•°"></a>3.2 Docker Javaåº”ç”¨å¯åŠ¨å‚æ•°</h2><p>æœ¬è´¨è¿˜æ˜¯åœ¨Dockerfileä¸­, ä¸CI&#x2F;CDæ¡†æ¶ç»“åˆ. </p>
<h3 id="3-2-1-Dockerfileé‡ŒæŒ‡å®šç¯å¢ƒå˜é‡-ç›´æ¥åœ¨-Spring-Propertiesæ–‡ä»¶é‡Œä½¿ç”¨"><a href="#3-2-1-Dockerfileé‡ŒæŒ‡å®šç¯å¢ƒå˜é‡-ç›´æ¥åœ¨-Spring-Propertiesæ–‡ä»¶é‡Œä½¿ç”¨" class="headerlink" title="3.2.1 Dockerfileé‡ŒæŒ‡å®šç¯å¢ƒå˜é‡, ç›´æ¥åœ¨ Spring Propertiesæ–‡ä»¶é‡Œä½¿ç”¨"></a>3.2.1 Dockerfileé‡ŒæŒ‡å®šç¯å¢ƒå˜é‡, ç›´æ¥åœ¨ Spring Propertiesæ–‡ä»¶é‡Œä½¿ç”¨</h3><p>ä¾‹å¦‚: <a href="https://charith.xyz/docker/dockerfile-environment-variables/">Dockerfile: Environment Variables</a></p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">$&#123;DB_USERNAME&#125;</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">$&#123;DB_PASSWORD&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM maven:3.6.3-openjdk-16-slim AS build
ENV <span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span>db <span class="token punctuation">\</span>
     <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span>username <span class="token punctuation">\</span>
     <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span>password
COPY ./mobile-app-ws /usr/local/mobile-app-ws
WORKDIR /usr/local/mobile-app-ws/
RUN mvn -Dmaven.test.skip<span class="token operator">=</span>true clean package

FROM tomcat:8
COPY --from<span class="token operator">=</span>build /usr/local/mobile-app-ws/target/mobile-app-ws-0.0.1-SNAPSHOT.war /usr/local/tomcat/webapps/mobile-app-ws.war
EXPOSE <span class="token number">8080</span>
CMD <span class="token punctuation">[</span><span class="token string">"catalina.sh"</span>, <span class="token string">"run"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åŸºäºä¸åŒçš„å‚æ•°å¯åŠ¨é•œåƒ: (æ³¨æ„ENVå˜é‡ä¸åœ¨æ„å»ºé•œåƒæ—¶ç”Ÿæ•ˆ) </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run -d --name ws-myappv3 <span class="token punctuation">\</span>
   -e <span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span>db-myapp <span class="token punctuation">\</span>
   -e <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span>charith <span class="token punctuation">\</span>
   -e <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span>charith <span class="token punctuation">\</span>
   -p <span class="token number">38083</span>:8080 <span class="token punctuation">\</span>
   --network<span class="token operator">=</span>myapp <span class="token punctuation">\</span>
   myapp:v3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>best-practice</tag>
        <tag>config</tag>
        <tag>properties</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªé€šç”¨æ•°æ®å·¡æ£€æ¡†æ¶çš„è®¾è®¡</title>
    <url>//2022-05-15-cruise-framework-design/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨å®é™…é¡¹ç›®ä¸­, æœ‰è®¸å¤šä¸šåŠ¡åœºæ™¯, ä¼šå­˜åœ¨å¤šå¼ è¡¨æ•°æ®ä¸ä¸€è‡´æˆ–è€…è„æ•°æ®æ®‹ç•™çš„é—®é¢˜,<br>éœ€è¦å®šæœŸæ‰§è¡Œä¸€äº›SQLæ¥è¿›è¡Œæ•°æ®ä¸€è‡´æ€§çš„å·¡æ£€ä¸è®¢æ­£, ä»¥å®ç°æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§.<br>ä¾‹å¦‚ä¸‹è¡¨, éœ€è¦å®šæœŸæŸ¥è¯¢&amp;ç»Ÿè®¡å‡ºâ€™deletedâ€™çŠ¶æ€çš„ç”¨æˆ·æ•°é‡, æŠ¥è­¦, å¹¶æ¸…ç†è¿™äº›æ•°æ®.</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- userè¡¨</span>
user_id<span class="token operator">|</span> age<span class="token operator">|</span> <span class="token keyword">status</span><span class="token operator">|</span>
<span class="token number">1</span><span class="token operator">|</span> <span class="token number">18</span><span class="token operator">|</span> deleted<span class="token operator">|</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h1 id="åˆæ­¥æ–¹æ¡ˆ"><a href="#åˆæ­¥æ–¹æ¡ˆ" class="headerlink" title="åˆæ­¥æ–¹æ¡ˆ:"></a>åˆæ­¥æ–¹æ¡ˆ:</h1><p>æ–¹æ¡ˆ1: å¯ä»¥é’ˆå¯¹æ¯ä¸ªéœ€æ±‚, å•ç‹¬å†™SQL-&gt;DAO-&gt;Serviceç­‰, ä½†å¸¦æ¥çš„é—®é¢˜æ˜¯: </p>
<ol>
<li>å¼€å‘é‡å¤§, æ¯æ¬¡æ–°çš„éœ€æ±‚, éƒ½éœ€è¦æ’¸ä¸€é, é‡å¤å·¥ä½œé‡å¤§.</li>
<li>SQL-&gt;Serviceæ•´ä½“åŠŸèƒ½åˆ†æ•£, ä¸ä¾¿äºç»´æŠ¤.<br>æ–¹æ¡ˆ2: å¯ä»¥åŸºäºæ­¤, æŠ½è±¡å‡ºä¸€ä¸ªé¢å‘SQLçš„é€šç”¨å·¡æ£€æ¡†æ¶, ä¾¿äºç»Ÿä¸€æ¥å…¥ä¸ç»´æŠ¤.</li>
</ol>
<h1 id="æ¶æ„è®¾è®¡æ€è€ƒ"><a href="#æ¶æ„è®¾è®¡æ€è€ƒ" class="headerlink" title="æ¶æ„è®¾è®¡æ€è€ƒ"></a>æ¶æ„è®¾è®¡æ€è€ƒ</h1><p>ä»ç”¨æˆ·è§’åº¦, å¯ä»¥:<br>å®šæ—¶ä»»åŠ¡æ¡†æ¶: </p>
<ol>
<li>åˆ›å»ºå·¡æ£€ä»»åŠ¡, ä¸è¾“å…¥è‡ªå®šä¹‰çš„SQLç»‘å®š</li>
<li>å®šä¹‰å·¡æ£€å‘¨æœŸ</li>
<li>æ‰‹åŠ¨è§¦å‘è¿è¡Œ(ä¾¿äºé¦–æ¬¡é…ç½®ä¹‹åè°ƒè¯•)</li>
<li>æŸ¥çœ‹è¿è¡Œè®°å½•(ä¾¿äº)</li>
</ol>
<p>æŠ¥è­¦ä¸è®¢æ­£æ¡†æ¶: </p>
<ol>
<li>å®šä¹‰ä»»åŠ¡ç»“æœç­›é€‰ä¸æŠ¥è­¦æ¡ä»¶</li>
<li>å®šä¹‰ä»»åŠ¡ç»“æœæ‰§è¡Œçš„è®¢æ­£Action</li>
</ol>
<h2 id="ç¬¬ä¸€éƒ¨åˆ†-å®šæ—¶ä»»åŠ¡æ¡†æ¶"><a href="#ç¬¬ä¸€éƒ¨åˆ†-å®šæ—¶ä»»åŠ¡æ¡†æ¶" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†: å®šæ—¶ä»»åŠ¡æ¡†æ¶"></a>ç¬¬ä¸€éƒ¨åˆ†: å®šæ—¶ä»»åŠ¡æ¡†æ¶</h2><p>æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªé¢å‘SQLçš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶, è°ƒç ”ç°æœ‰çš„ä»»åŠ¡æ¡†æ¶å®ç°(ä¾‹å¦‚Quartz): </p>
<ul>
<li>ä»»åŠ¡æ ¸å¿ƒ: <ul>
<li>ä»»åŠ¡æè¿°ä¸å®šä¹‰(å³æ•°æ®æºæ”¯æŒå“ªäº›? SQLæ”¯æŒå“ªäº›?)</li>
<li>å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦ä¸æ‰§è¡Œ</li>
<li>å†å²ä»»åŠ¡è¿è¡Œæƒ…å†µ<ul>
<li>è€—æ—¶</li>
<li>WorkerIp</li>
<li>æ‰§è¡ŒçŠ¶æ€</li>
</ul>
</li>
</ul>
</li>
<li>è¿ç»´åå°: <ul>
<li>æ‰‹å·¥è§¦å‘<ul>
<li>æŒ‡å®š</li>
</ul>
</li>
<li>ä»»åŠ¡</li>
</ul>
</li>
</ul>
<h2 id="ç¬¬äºŒéƒ¨åˆ†-æ•°æ®è®¢æ­£æŠ¥è­¦æ¡†æ¶"><a href="#ç¬¬äºŒéƒ¨åˆ†-æ•°æ®è®¢æ­£æŠ¥è­¦æ¡†æ¶" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†: æ•°æ®è®¢æ­£æŠ¥è­¦æ¡†æ¶"></a>ç¬¬äºŒéƒ¨åˆ†: æ•°æ®è®¢æ­£æŠ¥è­¦æ¡†æ¶</h2><h1 id="è¯¦ç»†è®¾è®¡"><a href="#è¯¦ç»†è®¾è®¡" class="headerlink" title="è¯¦ç»†è®¾è®¡"></a>è¯¦ç»†è®¾è®¡</h1><p>ä»»åŠ¡åˆ†ä¸º â€œå…¨é‡å·¡æ£€â€ ä¸ â€œå¢é‡å·¡æ£€â€ ä¸¤ç±».<br>å…¨é‡å·¡æ£€: å³æ¯æ¬¡æ‰§è¡ŒSQL, å¯¹æŠ¥è­¦ç»“æœå…¨é‡è¾“å‡º.<br>å¢é‡å·¡æ£€: å³æ¯æ¬¡æ‰§è¡ŒSQL, åªè¾“å‡ºä¸ä¸Šæ¬¡æ‰§è¡Œæœ‰å·®å¼‚çš„(æ–°å¢çš„)æ•°æ®æŠ¥è­¦.</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>best-practice</tag>
        <tag>software-engineering</tag>
        <tag>cruiser</tag>
        <tag>software-design</tag>
        <tag>arch</tag>
      </tags>
  </entry>
  <entry>
    <title>è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€äº›æœ€ä½³å®è·µæ²‰æ·€</title>
    <url>//2022-05-15-software-enginnering-best-practice/</url>
    <content><![CDATA[<h1 id="jar-x2F-mavenç‰ˆæœ¬å·å®šä¹‰"><a href="#jar-x2F-mavenç‰ˆæœ¬å·å®šä¹‰" class="headerlink" title="jar&#x2F;mavenç‰ˆæœ¬å·å®šä¹‰"></a>jar&#x2F;mavenç‰ˆæœ¬å·å®šä¹‰</h1><p>ä¸€èˆ¬æ¨èä½¿ç”¨ <a href="https://chronver.org/">chronVer</a></p>
<h2 id="semVer"><a href="#semVer" class="headerlink" title="semVer"></a><a href="https://semver.org/">semVer</a></h2><ul>
<li>æ ¼å¼: MAJOR.MINOR.PATCH</li>
<li>è¯­ä¹‰: <ul>
<li>MAJOR version when you make incompatible API changes</li>
<li>MINOR version when you add functionality in a backwards compatible manner</li>
<li>PATCH version when you make backwards compatible bug fixes.</li>
</ul>
</li>
<li>ä¼˜ç¼ºç‚¹: <ul>
<li>ä¼˜ç‚¹: è¾ƒä¸ºç®€å•, ä¹Ÿæ˜¯å¤§å®¶å¸¸ç”¨çš„æ–¹å¼.</li>
<li>ç¼ºç‚¹: ä¸ç›´è§‚</li>
</ul>
</li>
</ul>
<h2 id="chronVer"><a href="#chronVer" class="headerlink" title="chronVer"></a><a href="https://chronver.org/">chronVer</a></h2><ul>
<li>æ ¼å¼: YEAR.MONTH.DAY.CHANGESET_IDENTIFIER</li>
<li>è¯­ä¹‰: CHANGESET_IDENTIFIER</li>
<li>ä¼˜ç¼ºç‚¹:<ul>
<li>ä¼˜ç‚¹: ç›´æ¥ç”¨æ—¶é—´æˆ³æ¥æ ‡è¯†, è¾ƒä¸ºç›´è§‚. é€‚ç”¨è¾ƒä¸ºé¢‘ç¹å‘ç‰ˆçš„ç³»ç»Ÿ. </li>
<li>ç¼ºç‚¹: æ¯”è¾ƒéš¾ä»¥æ ‡è¯†ç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹æƒ…å†µ.</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>best-practice</tag>
        <tag>software-engineering</tag>
      </tags>
  </entry>
  <entry>
    <title>RPCè°ƒç”¨å¼‚å¸¸è¡Œä¸ºä¸å¤„ç†æ–¹æ¡ˆæ€»ç»“</title>
    <url>//2022-05-18-rpc-exception-handling/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨ä½¿ç”¨IAcsClientæˆ–è€…dubboè¿›è¡Œrpcè°ƒç”¨æ—¶, å¼‚å¸¸æƒ…å†µæ€»æ˜¯ä¸å¯é¿å…çš„.<br>è¿™é‡Œæ€»ç»“ä¸‹å„ç§å¼‚å¸¸, ä»¥åŠå¯¹åº”çš„è¡¨ç°å½¢å¼ä¸å¤„ç†æ–¹å¼.</p>
<h1 id="å¼‚å¸¸æ€»ç»“"><a href="#å¼‚å¸¸æ€»ç»“" class="headerlink" title="å¼‚å¸¸æ€»ç»“"></a>å¼‚å¸¸æ€»ç»“</h1><table>
<thead>
<tr>
<th>é”™è¯¯åˆ†ç±»</th>
<th>é”™è¯¯ç»†åˆ†</th>
<th>IAcsClient</th>
<th>Dubbo</th>
</tr>
</thead>
<tbody><tr>
<td>å®¢æˆ·ç«¯å¼‚å¸¸</td>
<td>å®¢æˆ·ç«¯ç½‘ç»œæ— è¿æ¥, é—ªæ–­ç­‰</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>IAcsClient æŠ›å‡ºClientExceptionå¼‚å¸¸<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>ClientException</span><span class="token operator">:</span> <span class="token class-name">SDK<span class="token punctuation">.</span>ServerUnreachable</span> <span class="token operator">:</span> <span class="token class-name">Server</span> unreachable<span class="token operator">:</span> connection<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
| </li>
<li>æŠ›å‡ºRpcExceptionå¼‚å¸¸:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122208285.png"> |<br>|  | SDKå‚æ•°ç¼ºå¤±é”™è¯¯ç­‰ |</p>
<ul>
<li>IAcsClient æŠ›å‡ºClientExceptionå¼‚å¸¸<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>ClientException</span><span class="token operator">:</span> <span class="token class-name">SDK<span class="token punctuation">.</span>InvalidProfile</span> <span class="token operator">:</span> <span class="token class-name">No</span> active profile found<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
| </li>
<li>ä¸ä¼šæœ‰è¯¥åœºæ™¯, å› ä¸ºdubboè°ƒç”¨æ²¡æœ‰SDK<br>|<br>| æœåŠ¡ç«¯å¼‚å¸¸ | æœåŠ¡ç«¯é™æµ, å¤„ç†è¶…æ—¶ | </li>
<li>IAcsClient æŠ›å‡ºServerExceptionå¼‚å¸¸<br>|  |<br>|  | ä¸šåŠ¡å¼‚å¸¸, ä¾‹å¦‚è¯·æ±‚å‚æ•°é”™è¯¯, SPOTä»·æ ¼è®¾ç½®è¿‡ä½ç­‰ |</li>
<li>IAcsClient æŠ›å‡ºClientExceptionå¼‚å¸¸</li>
<li>æ³¨æ„ServerExceptionæ˜¯ClientExceptionçš„å­ç±»<br>|</li>
<li>ä¸æŠ›å¼‚å¸¸, è¿”å› PlainResult<Object> isSuccess&#x3D;false; data&#x3D;null; message !&#x3D; null</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122209444.png"> |<br>|  | æœåŠ¡ç«¯æœªæä¾›è¯¥æœåŠ¡ |</p>
<ul>
<li>IAcsClientæŠ›å‡ºClientExceptionå¼‚å¸¸<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>ClientException</span><span class="token operator">:</span> <span class="token class-name">InvalidVersion</span> <span class="token operator">:</span> <span class="token class-name">Specified</span> parameter <span class="token class-name">Version</span> is not <span class="token class-name"><span class="token namespace">valid<span class="token punctuation">.</span></span>
RequestId</span> <span class="token operator">:</span> xxx

<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>ClientException</span><span class="token operator">:</span> <span class="token class-name">InvalidAction<span class="token punctuation">.</span>NotFound</span> <span class="token operator">:</span> <span class="token class-name">Specified</span> api is not found<span class="token punctuation">,</span> please check your url and <span class="token class-name"><span class="token namespace">method<span class="token punctuation">.</span></span>
RequestId</span> <span class="token operator">:</span> xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
| </li>
<li>æŠ›å‡ºRpcExceptionå¼‚å¸¸: <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span>RpcException</span><span class="token operator">:</span> <span class="token class-name">Failed</span> <span class="token keyword">to</span> <span class="token namespace">invoke</span> the method xxx in the service <span class="token class-name"><span class="token namespace">xxx<span class="token punctuation">.</span></span> No</span> provider available <span class="token keyword">for</span> the service xxx from registry xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
|<br>| å…¶ä»–å¼‚å¸¸ |  | IAcsClientæ­£å¸¸è¿”å›. è¿”å›å¯¹è±¡é‡Œ:<br>AcsResponseæœ‰requestId, ä½†è¿”å›ç»“æœä¸ºç©º, success&#x3D;false<br>å•¥æ—¶å€™ä¼šæœ‰è¿™ç§å¼‚å¸¸?  |  |</li>
</ul>
<h1 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h1><h2 id="IAcsClientå¼‚å¸¸å¤„ç†"><a href="#IAcsClientå¼‚å¸¸å¤„ç†" class="headerlink" title="IAcsClientå¼‚å¸¸å¤„ç†"></a>IAcsClientå¼‚å¸¸å¤„ç†</h2><p>æ‰€ä»¥é’ˆå¯¹IAcsClient, å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œå¼‚å¸¸å¤„ç†:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    ecsInnerClient<span class="token punctuation">.</span><span class="token function">getAcsResponse</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ServerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// clientè°ƒç”¨è¶…æ—¶, è¢«æœåŠ¡ç«¯é™æµç­‰, éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸, èµ°åˆ°è¿™é‡Œ, éœ€è¦åç»­é™çº§åˆ°åº“å­˜ç¼“å­˜å®ç°.</span>
     listResourceResponse<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
     log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"DescribeResourceAllocation ServerException. request: &#123;&#125;"</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// SPOTä»·æ ¼ä¸æ»¡è¶³, å®¢æˆ·ç«¯ä¼ å…¥å‚æ•°æœ‰é”™è¯¯, ç­‰ä¸šåŠ¡å¼‚å¸¸, èµ°åˆ°è¿™é‡Œ, æ— éœ€åç»­é™çº§åˆ°åº“å­˜ç¼“å­˜å®ç°.</span>
     listResourceResponse<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
     log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"DescribeResourceAllocation ClientException. request: &#123;&#125;"</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>rpc</tag>
        <tag>exception</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°SpringBootCacheä½¿ç”¨çš„é—®é¢˜æ€»ç»“</title>
    <url>//2022-05-18-springboot-cache/</url>
    <content><![CDATA[<h1 id="Cacheable-æ— å‚æ–¹æ³•"><a href="#Cacheable-æ— å‚æ–¹æ³•" class="headerlink" title="@Cacheable æ— å‚æ–¹æ³•"></a>@Cacheable æ— å‚æ–¹æ³•</h1><p>æœ‰äº›æ— å‚æ–¹æ³•, ä¹Ÿéœ€è¦è¢«SpringBoot @Cacheable è¿›è¡Œcache, å¦‚ä¸‹ä»£ç æ ·ä¾‹:  </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Cachable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"my_cache"</span><span class="token punctuation">,</span> unless<span class="token operator">=</span><span class="token string">"#result == null || #result.size() &lt;= 0"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">listAllUids</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ‰å¦‚ä¸‹éœ€è¦æ³¨æ„çš„ç‚¹:</p>
<ul>
<li>å¯ä»¥ä¸å†™ <code>key=xxx</code>, è¿™æ ·é»˜è®¤çš„keyå°±æ˜¯<code>SimpleType []</code></li>
<li>SpringBootå®˜æ–¹å»ºè®®<a href="https://docs.spring.io/spring/docs/3.1.x/spring-framework-reference/html/cache.html">ä½¿ç”¨æ–¹æ³•åä½œä¸ºkey</a>, å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Cachable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"my_cache"</span><span class="token punctuation">,</span> unless<span class="token operator">=</span><span class="token string">"#result == null || #result.size() &lt;= 0"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#root.method.name"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>ä¹Ÿå¯ä»¥hardcodeä¸€ä¸ªkey, è¿™æ ·æ›´æ˜“äºæŸ¥æ‰¾, å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Cachable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"my_cache"</span><span class="token punctuation">,</span> unless<span class="token operator">=</span><span class="token string">"#result == null || #result.size() &lt;= 0"</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">"'my_key'"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>è¦æ³¨æ„keyé‡Œçš„å¸¸é‡, <font color='red'>ä¸€å®šè¦ç”¨å•å¼•å·æ‹¬èµ·æ¥</font>, å¦åˆ™ä¼š<a href="https://stackoverflow.com/questions/33383366/cacheble-annotation-on-no-parameter-method">æŠ¥é”™å¦‚ä¸‹</a>: <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span></span>SpelEvaluationException</span><span class="token operator">:</span> EL1008E<span class="token operator">:</span><span class="token punctuation">(</span>pos <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Property</span> or field my_key cannot be found on object of type '<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span>CacheExpressionRootObject</span>' <span class="token operator">-</span> maybe not <span class="token keyword">public</span><span class="token operator">?</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>spring-cache</tag>
      </tags>
  </entry>
  <entry>
    <title>k8sç”Ÿæ€ä¸­promethusçš„æ¶æ„ä¸åŸç†ç ”ç©¶</title>
    <url>//2022-05-22-k8s-promethus/</url>
    <content><![CDATA[<h1 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h1><p><a href="https://prometheus.io/docs/introduction/faq/">https://prometheus.io/docs/introduction/faq/</a></p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122209641.png"></p>
<p>æœ¬è´¨ä¸Šæ˜¯ç±»ä¼¼alimonitorçš„ç³»ç»Ÿ.</p>
<h1 id="å‡ ä¸ªç»†èŠ‚"><a href="#å‡ ä¸ªç»†èŠ‚" class="headerlink" title="å‡ ä¸ªç»†èŠ‚:"></a>å‡ ä¸ªç»†èŠ‚:</h1><ul>
<li><p>ä½¿ç”¨pullæ¨¡å¼, è€Œä¸æ˜¯pushæ¨¡å¼. å³promethus serverä¸»åŠ¨å»å„ä¸ªä¸šåŠ¡æ–¹æå–æ•°æ®, è€Œä¸æ˜¯å„ä¸ªä¸šåŠ¡æ–¹ä¸»åŠ¨å¾€promethus serveræ¨é€æ•°æ®.</p>
<ul>
<li>ä¸ºå•¥ä½¿ç”¨pullæ¨¡å¼? <a href="https://prometheus.io/docs/introduction/faq/#why-do-you-pull-rather-than-push">https://prometheus.io/docs/introduction/faq/#why-do-you-pull-rather-than-push</a><ul>
<li>You can run your monitoring on your laptop when developing changes.</li>
<li>You can more easily tell if a target is down.</li>
<li>You can manually go to a target and inspect its health with a web browser.</li>
</ul>
</li>
<li>é’ˆå¯¹ç°å­˜çš„å·²ç»æœ‰çš„pushæ¨¡å¼, æä¾›äº†pushgatewayæ–¹æ¡ˆæ¥å…¼å®¹. (å¯ä»¥å‚è§ä¸Šå›¾æ¶æ„)<ul>
<li><a href="https://prometheus.io/docs/instrumenting/pushing/">https://prometheus.io/docs/instrumenting/pushing/</a></li>
<li>pushgatewayç±»ä¼¼äº</li>
</ul>
</li>
</ul>
</li>
<li><p>ç”±äºä½¿ç”¨äº†pullæ¨¡å¼, å› æ­¤ä¼šæœ‰å„ç§<a href="https://prometheus.io/docs/instrumenting/exporters/">exporterç»„ä»¶</a>, æ¥é€‚é…å„ä¸ªå¸¸ç”¨ç›‘æ§æº, ä¾‹å¦‚ casandra exporter, ECS Exporterç­‰. æœ¬è´¨ä¸Šè¿™ç§exporteræ˜¯ç±»ä¼¼ä¸€ä¸ªhttpæœåŠ¡å™¨, å¯ä»¥è®©promethus serveræ¥æå–æ•°æ®.</p>
</li>
<li><p>æœåŠ¡å‘ç°: ç”±äºä½¿ç”¨çš„æ˜¯pullæ¨¡å¼, å› æ­¤promethuséœ€è¦çŸ¥é“è¦ä»å“ªé‡Œæå–å„ä¸ªä¸šåŠ¡æ–¹çš„metrics, å› æ­¤éœ€è¦ä¸€ä¸ªæœåŠ¡å‘ç°æœºåˆ¶. æœ‰å¦‚ä¸‹ä¸¤ç§:</p>
<ul>
<li>é™æ€æ–‡ä»¶é…ç½®(File-Based SD): ip:port</li>
<li>DNS: nameserver:port <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#dns_sd_config">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#dns_sd_config</a></li>
<li>HTTP_SD:</li>
</ul>
</li>
<li><p>å­˜å‚¨:</p>
<ul>
<li>å­˜å‚¨ä»‹è´¨:<ul>
<li>é»˜è®¤ä½¿ç”¨çš„localstorage, æœ¬åœ°å­˜å‚¨</li>
<li>å¯ä»¥æ”¯æŒremote storage, ä½†ç”±äºå„ä¸ªremote storageçš„æ¥å£&amp;å¯¹åŸç”Ÿçš„promethus SQLæ”¯æŒåº¦çš„ä¸åŒ, åˆ†ä¸ºread&amp;writeèƒ½åŠ›<ul>
<li><a href="https://prometheus.io/docs/operating/integrations/#remote-endpoints-and-storage">remote storageæ”¯æŒåˆ—è¡¨</a></li>
</ul>
</li>
</ul>
</li>
<li>æ•°æ®æ ¼å¼:<ul>
<li>è‡ªå®šä¹‰çš„, æ”¯æŒå‹ç¼©çš„æœ¬åœ°å­˜å‚¨æ ¼å¼.</li>
</ul>
</li>
</ul>
</li>
<li><p>HA:</p>
<ul>
<li>æœåŠ¡HA:<ul>
<li><a href="https://www.robustperception.io/scaling-and-federating-prometheus">https://www.robustperception.io/scaling-and-federating-prometheus</a></li>
<li>é»˜è®¤: å•å°serverè¶³ä»¥æ”¯æ’‘1000å°serverçš„metricsé‡.</li>
<li>æ–¹æ¡ˆ1: Initial Deployment<ul>
<li>2ä¸ªglobal Prometheus , Nä¸ªlocal Promethus, globalè´Ÿè´£æ±‡èšlocalæ•°æ®</li>
<li>ä¿æŒ2ä¸ªglobal, é˜²æ­¢å•å°å®•æœº.</li>
</ul>
</li>
<li>æ–¹æ¡ˆ2: Splitting By Use, æŒ‰ç”¨é€”å‚ç›´æ‹†åˆ†<ul>
<li>promethuså‰åç«¯åˆ†ç¦»éƒ¨ç½²</li>
<li>æŒ‰ä¸šåŠ¡åŸŸåˆ†åˆ«éƒ¨ç½², ä¾‹å¦‚ä¸ºCassandraæœåŠ¡å•ç‹¬éƒ¨ç½²ä¸€å¥—, ä¸ºMySQLæœåŠ¡å•ç‹¬éƒ¨ç½²ä¸€å¥—</li>
</ul>
</li>
<li>æ–¹æ¡ˆ3: Horizontal Sharding, æ°´å¹³æ‹†åˆ†<ul>
<li>ä¸æ¨èå¤šæœºå™¨éƒ¨ç½²,</li>
</ul>
</li>
</ul>
</li>
<li>æ•°æ®HA:<ul>
<li>localstorage: æ— æ³•HA, å› æ­¤promethusæ˜¯æ¨èä½¿ç”¨RAID, æˆ–è€…å®šæœŸæ‰“å¿«ç…§.</li>
</ul>
</li>
</ul>
</li>
<li><p>é™åˆ¶:</p>
<ul>
<li>ä¸è¦ç”¨promethusæ¥è¿›è¡Œtracing&#x2F;logging, åªèƒ½ç”¨æ¥åšmetrics</li>
</ul>
</li>
</ul>
<h1 id="æ ¸å¿ƒæœ¯è¯­-x2F-æŒ‡æ ‡"><a href="#æ ¸å¿ƒæœ¯è¯­-x2F-æŒ‡æ ‡" class="headerlink" title="æ ¸å¿ƒæœ¯è¯­&#x2F;æŒ‡æ ‡"></a>æ ¸å¿ƒæœ¯è¯­&#x2F;æŒ‡æ ‡</h1><p>å®šä¹‰äº†å¾ˆå¥½çš„å‡ ç§é€šç”¨æŒ‡æ ‡, æ¥è¦†ç›–metricså„ä¸ªæ–¹é¢:</p>
<ol>
<li><p>counter: <a href="https://www.robustperception.io/how-does-a-prometheus-counter-work">https://www.robustperception.io/how-does-a-prometheus-counter-work</a></p>
<ol>
<li>rate</li>
</ol>
</li>
<li><p>gauge</p>
</li>
<li><p>histogram, å¦‚ä¸‹, æŒ‰ç…§le&#x3D;â€xxxâ€, leå³â€less thanâ€, å°†latencyåˆ†æˆäº†10ä¸ªbucket</p>
<pre class="line-numbers language-none"><code class="language-none">prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;0.1&quot;&#125; 25547
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;0.2&quot;&#125; 26688
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;0.4&quot;&#125; 27760
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;1&quot;&#125; 28641
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;3&quot;&#125; 28782
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;8&quot;&#125; 28844
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;20&quot;&#125; 28855
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;60&quot;&#125; 28860
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;120&quot;&#125; 28860
prometheus_http_request_duration_seconds_bucket&#123;handler&#x3D;&quot;&#x2F;&quot;,le&#x3D;&quot;+Inf&quot;&#125; 28860<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>summary</p>
</li>
</ol>
<h1 id="æ ¸å¿ƒç»„ä»¶ç ”ç©¶"><a href="#æ ¸å¿ƒç»„ä»¶ç ”ç©¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶ç ”ç©¶"></a>æ ¸å¿ƒç»„ä»¶ç ”ç©¶</h1><h2 id="pushgateway"><a href="#pushgateway" class="headerlink" title="pushgateway"></a>pushgateway</h2><p><a href="https://prometheus.io/docs/practices/pushing/">https://prometheus.io/docs/practices/pushing/</a><br><a href="https://github.com/prometheus/pushgateway">https://github.com/prometheus/pushgateway</a></p>
<h2 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122209523.png"></p>
<h1 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h1><p>Observabilityçš„ä¸‰å¤§éƒ¨åˆ†:</p>
<table>
<thead>
<tr>
<th>Metrics</th>
<th>Promethus + Grafana(å‰ç«¯dashboard)</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Tracing</td>
<td>ELK</td>
<td></td>
</tr>
<tr>
<td>Logging</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122210006.png"><br>**</p>
<ul>
<li><p>Metricsæ¯”è¾ƒå¥½ç†è§£, æ ¸å¿ƒå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ å±‚: <a href="https://codeascraft.com/2011/02/15/measure-anything-measure-everything/">https://codeascraft.com/2011/02/15/measure-anything-measure-everything/</a> metrics are structured by default</p>
<ul>
<li>network</li>
<li>machine: ç°æˆçš„node exporter, <a href="https://github.com/prometheus/node_exporter">https://github.com/prometheus/node_exporter</a><ul>
<li>disk&#x2F;io</li>
<li>cpu&#x2F;mem&#x2F;threads&#x2F;loadâ€¦</li>
<li>status, â€¦</li>
</ul>
</li>
<li>application (è€Œé€šå¸¸åº”ç”¨çš„metricsæ˜¯æœ€ä¸ºå¤æ‚çš„), å…¸å‹çš„åº”ç”¨, å·²ç»æœ‰promethusçš„exporteräº†<ul>
<li>DB</li>
<li></li>
</ul>
</li>
</ul>
</li>
<li><p>Logging:</p>
</li>
<li><h2 id="Tracing-ç±»ä¼¼é¹°çœ¼-æ ¹æ®traceIdæŸ¥çœ‹"><a href="#Tracing-ç±»ä¼¼é¹°çœ¼-æ ¹æ®traceIdæŸ¥çœ‹" class="headerlink" title="Tracing: ç±»ä¼¼é¹°çœ¼, æ ¹æ®traceIdæŸ¥çœ‹"></a>Tracing: ç±»ä¼¼é¹°çœ¼, æ ¹æ®traceIdæŸ¥çœ‹</h2></li>
</ul>
<h1 id="ä¸€äº›æœ‰æ„æ€çš„æ€è€ƒ"><a href="#ä¸€äº›æœ‰æ„æ€çš„æ€è€ƒ" class="headerlink" title="ä¸€äº›æœ‰æ„æ€çš„æ€è€ƒ"></a>ä¸€äº›æœ‰æ„æ€çš„æ€è€ƒ</h1><p><a href="https://www.splunk.com/en_us/data-insider/what-is-observability.html">https://www.splunk.com/en_us&#x2F;data-insider&#x2F;what-is-observability.html</a></p>
<ol>
<li>monitoringä¸observabilityçš„å…³ç³»æ˜¯å•¥?<ol>
<li>Monitoring is an action you perform to increase the observability of your system.</li>
<li>Observability is a property of that system.</li>
</ol>
</li>
<li>ApdexæŒ‡æ ‡: <a href="https://en.wikipedia.org/wiki/Apdex">https://en.wikipedia.org/wiki/Apdex</a></li>
<li>EKL: Elasticsearch, Logstash, and Kibana</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>promethus</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸­å¸¸ç”¨çš„æ•°æ®åº“è¿æ¥æ± ä»¥åŠäº‹åŠ¡æ¡†æ¶çš„åŸç†æ¢ç©¶</title>
    <url>//2022-05-23-java-db-connection-transaction/</url>
    <content><![CDATA[<h1 id="æ€è€ƒ1-Springé‡Œå„ç§äº‹åŠ¡éš”ç¦»çº§åˆ«-æœ¬è´¨ä¸Šæ˜¯å¦‚ä½•å®ç°çš„"><a href="#æ€è€ƒ1-Springé‡Œå„ç§äº‹åŠ¡éš”ç¦»çº§åˆ«-æœ¬è´¨ä¸Šæ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="æ€è€ƒ1: Springé‡Œå„ç§äº‹åŠ¡éš”ç¦»çº§åˆ«, æœ¬è´¨ä¸Šæ˜¯å¦‚ä½•å®ç°çš„?"></a>æ€è€ƒ1: Springé‡Œå„ç§äº‹åŠ¡éš”ç¦»çº§åˆ«, æœ¬è´¨ä¸Šæ˜¯å¦‚ä½•å®ç°çš„?</h1><p>å¾ˆæœ‰æ„æ€çš„ä¸€ä¸ªé—®é¢˜. å•ä¸ªconnectionæˆ–è€…DBåŸç”Ÿæ˜¯æ— æ³•å®ç°çš„, æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¸åŒçš„connectionæ¥å®ç°çš„.</p>
<p><a href="https://stackoverflow.com/questions/19526604/how-does-transaction-suspension-work-in-spring">https://stackoverflow.com/questions/19526604/how-does-transaction-suspension-work-in-spring</a></p>
<blockquote>
<p>The point of suspending a transaction is to change the current transaction for a thread to a new one. This would NOT line up with the semantics of nested transactions because the new and suspended transactions are completely independent of each other. There is no connection-level API to support suspending transactions so this has to be done by using a different connection. If you are using JTA with Spring, this is done by the JTA transaction manager. If you are using DataSourceTransactionManager, you can look in the code and see that it will be saving off the current connection as a â€œsuspended resourceâ€ and grabbing a new connection from the data source for the new transaction.</p>
</blockquote>
<ul>
<li><a href="https://wiyi.org/physical-and-logical-transactions.html">https://wiyi.org/physical-and-logical-transactions.html</a></li>
<li><a href="https://wiyi.org/how-does-transaction-suspension-in-spring.html">https://wiyi.org/how-does-transaction-suspension-in-spring.html</a></li>
</ul>
<h2 id="ç®€åŒ–åçš„æ ·ä¾‹"><a href="#ç®€åŒ–åçš„æ ·ä¾‹" class="headerlink" title="ç®€åŒ–åçš„æ ·ä¾‹"></a>ç®€åŒ–åçš„æ ·ä¾‹</h2><h3 id="REQUIRES-NEW"><a href="#REQUIRES-NEW" class="headerlink" title="REQUIRES_NEW"></a>REQUIRES_NEW</h3><ul>
<li>æ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</li>
<li>è¿™ä¸ªæ–¹æ³•ä¼šç‹¬ç«‹æäº¤äº‹åŠ¡ï¼Œä¸å—è°ƒç”¨è€…çš„äº‹åŠ¡å½±å“ï¼Œçˆ¶çº§å¼‚å¸¸ï¼Œå®ƒä¹Ÿæ˜¯æ­£å¸¸æäº¤</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; å‡å®šä¸ºREQUIRE_NEWä¼ æ’­ç±»å‹
&#x2F;&#x2F; 1. å¤–éƒ¨äº‹åŠ¡æ‰§è¡Œ
Connection conn &#x3D; getConnection(); &#x2F;&#x2F; è¿™é‡Œæ˜¯æ–°å»ºconnection
Statement stmt &#x3D; conn.createStatement();
stmt.execute(&quot;update xxx set xxx &#x3D; xxx&quot;);

&#x2F;&#x2F; 2. åˆ°è¿™é‡Œ, å†…éƒ¨äº‹åŠ¡å¼€å§‹, éœ€è¦æ‰§è¡Œæ–¹æ³•2, REQUIRE_NEWä¼ æ’­çº§åˆ«, é‚£æœ¬è´¨ä¸Šæ˜¯æ–°å»ºäº†ä¸ªconnection. åœ¨Springé‡Œ, å…¶å®å°±æ˜¯suspend(), å³å°†ä¸Šä¸€ä¸ªconnä»ThreadLocalé‡Œç§»é™¤; ç„¶åæŠŠconn2æ”¾å…¥ThreadLocalé‡Œ.
Connection conn2 &#x3D; getConnection(); &#x2F;&#x2F; è¿™ä¸ªconn2ä¸ä¸Šè¾¹çš„connæ˜¯ä¸åŒçš„è¿æ¥
Statement stmt2 &#x3D; conn.createStatement();
stmt2.execute(&quot;update xxx set xxx &#x3D; xxx&quot;);
conn2.commit(); &#x2F;&#x2F; è¿™é‡Œå†…éƒ¨äº‹åŠ¡æ‰§è¡Œcommit();
stmt2.close();
conn2.close();

&#x2F;&#x2F; 3. å¤–éƒ¨äº‹åŠ¡ç»§ç»­æ‰§è¡Œ
stmt.execute(&quot;update xxx set xxx&#x3D;xxx&quot;);
conn.commit();  &#x2F;&#x2F; è¿™é‡Œå¤–éƒ¨äº‹åŠ¡æ‰§è¡Œcommit();
stmt.close();
conn.close();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="PROPAGATION-REQUIRED"><a href="#PROPAGATION-REQUIRED" class="headerlink" title="PROPAGATION_REQUIRED"></a>PROPAGATION_REQUIRED</h3><ul>
<li>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ–°å»ºäº‹åŠ¡</li>
<li>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥å½“å‰äº‹åŠ¡ï¼Œåˆå¹¶æˆä¸€ä¸ªäº‹åŠ¡</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; å‡å®šä¸ºPROPAGATION_REQUIREDä¼ æ’­ç±»å‹: 
&#x2F;&#x2F; 1. æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ–°å»ºäº‹åŠ¡
&#x2F;&#x2F; 2. å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥å½“å‰äº‹åŠ¡ï¼Œåˆå¹¶æˆä¸€ä¸ªäº‹åŠ¡

&#x2F;&#x2F; 1. å¤–éƒ¨äº‹åŠ¡æ‰§è¡Œ
Connection conn &#x3D; getConnection(); &#x2F;&#x2F; è¿™é‡Œæ˜¯æ–°å»ºconnection
Statement stmt &#x3D; conn.createStatement();
stmt.execute(&quot;update xxx set xxx &#x3D; xxx&quot;);

&#x2F;&#x2F; 2. åˆ°è¿™é‡Œ, å†…éƒ¨äº‹åŠ¡å¼€å§‹, éœ€è¦æ‰§è¡Œæ–¹æ³•2, PROPAGATION_MANDATORY ä¼ æ’­çº§åˆ«, é‚£æœ¬è´¨ä¸Šæ˜¯å¤ç”¨äº†ä¸Šä¸€ä¸ªè¿æ¥.
Connection conn2 &#x3D; conn; &#x2F;&#x2F; è¿™ä¸ªconn2ä¸ä¸Šè¾¹çš„connæ˜¯ç›¸åŒçš„è¿æ¥
Statement stmt2 &#x3D; conn.createStatement();
stmt2.execute(&quot;update xxx set xxx &#x3D; xxx&quot;);
&#x2F;&#x2F; conn2.commit(); &#x2F;&#x2F; è¿™é‡Œæ— æ³•åšåˆ°å­äº‹åŠ¡å•ç‹¬æäº¤, å› ä¸ºè·Ÿçˆ¶äº‹åŠ¡å·²ç»åˆå¹¶æˆäº†ä¸€ä¸ªäº‹åŠ¡.

&#x2F;&#x2F; 3. å¤–éƒ¨äº‹åŠ¡ç»§ç»­æ‰§è¡Œ
stmt.execute(&quot;update xxx set xxx&#x3D;xxx&quot;);
conn.commit();  &#x2F;&#x2F; è¿™é‡Œæ•´ä½“äº‹åŠ¡æ‰§è¡Œcommit();
stmt.close();
conn.close();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="NESTED"><a href="#NESTED" class="headerlink" title="NESTED"></a>NESTED</h3><ul>
<li>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå®ƒå°†ä¼šæˆä¸ºçˆ¶çº§äº‹åŠ¡çš„ä¸€ä¸ªå­äº‹åŠ¡ï¼Œæ–¹æ³•ç»“æŸåå¹¶æ²¡æœ‰æäº¤ï¼Œåªæœ‰ç­‰çˆ¶äº‹åŠ¡ç»“æŸæ‰æäº¤</li>
<li>å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ–°å»ºäº‹åŠ¡</li>
<li>å¦‚æœå®ƒå¼‚å¸¸ï¼Œçˆ¶çº§å¯ä»¥æ•è·å®ƒçš„å¼‚å¸¸è€Œä¸è¿›è¡Œå›æ»šï¼Œæ­£å¸¸æäº¤</li>
<li>ä½†å¦‚æœçˆ¶çº§å¼‚å¸¸ï¼Œå®ƒå¿…ç„¶å›æ»šï¼Œè¿™å°±æ˜¯å’Œ <code>REQUIRES_NEW</code> çš„åŒºåˆ«</li>
</ul>
<h1 id="æ€è€ƒ2-Druidè¿æ¥æ± -å¦‚ä½•çŸ¥é“æ± ä¸­å“ªäº›connectionåœ¨ç”¨-å“ªäº›connectionæ²¡åœ¨ç”¨"><a href="#æ€è€ƒ2-Druidè¿æ¥æ± -å¦‚ä½•çŸ¥é“æ± ä¸­å“ªäº›connectionåœ¨ç”¨-å“ªäº›connectionæ²¡åœ¨ç”¨" class="headerlink" title="æ€è€ƒ2: Druidè¿æ¥æ± : å¦‚ä½•çŸ¥é“æ± ä¸­å“ªäº›connectionåœ¨ç”¨, å“ªäº›connectionæ²¡åœ¨ç”¨?"></a>æ€è€ƒ2: Druidè¿æ¥æ± : å¦‚ä½•çŸ¥é“æ± ä¸­å“ªäº›connectionåœ¨ç”¨, å“ªäº›connectionæ²¡åœ¨ç”¨?</h1><h2 id="Druidå®ç°"><a href="#Druidå®ç°" class="headerlink" title="Druidå®ç°:"></a>Druidå®ç°:</h2><p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„å¯¹è±¡æ± , ä¼šæœ‰å¦‚ä¸‹æ–¹æ³•:</p>
<ol>
<li>Object borrow(): å³ä»æ± ä¸­å€Ÿç”¨å¯¹è±¡, ä»è€Œè¯¥å¯¹è±¡ä»æ± ä¸­ç§»é™¤, ä¸èƒ½å†å€Ÿç»™ä»–äºº.</li>
<li>return(Object obj): å³æŠŠå¯¹è±¡å½’è¿˜ç»™æ± å­, ä»¥ä¾¿è¯¥å¯¹è±¡èƒ½è¢«å…¶ä»–äººå¤ç”¨.</li>
</ol>
<p>ä½†çœ‹æ ‡å‡†çš„JDBCå®šä¹‰, ä»¥åŠdruidçš„å®ç°, å‘ç°åªæœ‰å¦‚ä¸‹å®šä¹‰, å³è·å–è¿æ¥çš„å®šä¹‰.</p>
<pre class="line-numbers language-none"><code class="language-none">public interface DataSource &#123;
  Connection getConnection();
  Connection getConnection(String username, String password);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>çœ‹Druidè¿æ¥æ± çš„å®ç°</p>
<ol>
<li>getConnection(): æ˜¯ä»è¿æ¥æ± ä¸­è·å–åˆ°ä¸€ä¸ªå¯ç”¨çš„è¿æ¥, å‚è§: com.alibaba.druid.pool.DruidDataSource#getConnectionInternal</li>
<li><strong>ä½†ä¸ºä»€ä¹ˆæ²¡æœ‰å½’è¿˜æ–¹æ³•å‘¢? å¦‚æœæ²¡æœ‰å½’è¿˜æ–¹æ³•, é‚£è¿æ¥æ± å°±æ²¡æœ‰æ„ä¹‰äº†å‘€!!</strong><ol>
<li>è§£æƒ‘: getConnection()æ‹¿åˆ°çš„æ˜¯: DruidPooledConnection</li>
<li>åœ¨ DruidPooledConnection.close() çš„æ—¶å€™, å…¶å®æœ¬è´¨ä¸Šä¸æ˜¯å°†è¿æ¥å…³é—­, è€Œæ˜¯å°†è¿æ¥å½’è¿˜å›äº†è¿æ¥æ± !!<ol>
<li>è¿™ä¸ªè®¾è®¡è¿˜æ˜¯æŒºå·§å¦™çš„.</li>
</ol>
</li>
</ol>
</li>
<li>é‚£ä¹ˆçœŸæ­£é”€æ¯è¿æ¥æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘¢?<ol>
<li>å³æ•´ä¸ªè¿æ¥æ± é”€æ¯çš„æ—¶å€™. DruidDataSource.close()</li>
</ol>
</li>
</ol>
<h2 id="æ‰©å±•-DBCPçš„æ•°æ®åº“è¿æ¥æ± æ˜¯å¦‚ä½•å®ç°çš„"><a href="#æ‰©å±•-DBCPçš„æ•°æ®åº“è¿æ¥æ± æ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="æ‰©å±•: DBCPçš„æ•°æ®åº“è¿æ¥æ± æ˜¯å¦‚ä½•å®ç°çš„?"></a>æ‰©å±•: DBCPçš„æ•°æ®åº“è¿æ¥æ± æ˜¯å¦‚ä½•å®ç°çš„?</h2><p>æ ¸å¿ƒä»£ç å‚è§: org.apache.commons.dbcp.BasicDataSource</p>
<ol>
<li>ä½¿ç”¨äº†å·¥å‚æ¨¡å¼ </li>
<li>ä¾èµ–apacheçš„commons.pool æ¶æ„æ•´ä½“æ¯”è¾ƒä¼˜ç§€</li>
</ol>
<h3 id="ä»æ± ä¸­è·å–è¿æ¥"><a href="#ä»æ± ä¸­è·å–è¿æ¥" class="headerlink" title="ä»æ± ä¸­è·å–è¿æ¥"></a>ä»æ± ä¸­è·å–è¿æ¥</h3><pre class="line-numbers language-none"><code class="language-none">org.apache.commons.dbcp.BasicDataSource#createDataSource &#123;
	createConnectionPool(); &#x2F;&#x2F; 1. åˆ›å»º GenericObjectPool å®ä¾‹, 
  createPoolableConnectionFactory(); &#x2F;&#x2F; 2. åˆ›å»ºConnectionFactory, (è¿™é‡Œç”¨äº†å·¥å‚æ¨¡å¼), Factoryç”¨æ¥åˆ›å»ºconnection
  &#x2F;&#x2F; åº•å±‚ä½¿ç”¨ org.apache.commons.dbcp.PoolableConnectionFactory#makeObject æ¥æ–°å»ºç‰©ç†è¿æ¥
  createDataSourceInstance(); &#x2F;&#x2F; 3. åˆ›å»ºDbcpDataSourceå¯¹è±¡, å³è¯¥connectionpool
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å°†è¿æ¥å½’è¿˜å›æ± å­"><a href="#å°†è¿æ¥å½’è¿˜å›æ± å­" class="headerlink" title="å°†è¿æ¥å½’è¿˜å›æ± å­"></a>å°†è¿æ¥å½’è¿˜å›æ± å­</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; 1. å®é™…åœ¨æ± å­é‡Œçš„connectionæ˜¯: 
org.apache.commons.dbcp.PoolableConnection#PoolableConnection

&#x2F;&#x2F; 2. ä¹Ÿæ˜¯åœ¨connection.closeçš„æ—¶å€™å°†connectionå½’è¿˜å›æ± å­:
public synchronized void close() throws SQLException &#123;
	if (!isUnderlyingConectionClosed) &#123;
	&#x2F;&#x2F; Normal close: underlying connection is still open, so we
	&#x2F;&#x2F; simply need to return this proxy to the pool
	try &#123;
		_pool.returnObject(this); &#x2F;&#x2F; XXX should be guarded to happen at most once
	&#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="æ€è€ƒ3-CustomTransactionå®ç°"><a href="#æ€è€ƒ3-CustomTransactionå®ç°" class="headerlink" title="æ€è€ƒ3: CustomTransactionå®ç°"></a>æ€è€ƒ3: CustomTransactionå®ç°</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸ºäº†é˜²æ­¢å•ä¸ªå¤§äº‹åŠ¡, å¯¼è‡´é”è¡¨é—®é¢˜. å› æ­¤éœ€è¦æŠŠå¤§äº‹åŠ¡æ‹†åˆ†æˆå¤šä¸ªå­äº‹åŠ¡.</p>
<h1 id="æ€è€ƒ4-TBTransactionImpl-å®ç°"><a href="#æ€è€ƒ4-TBTransactionImpl-å®ç°" class="headerlink" title="æ€è€ƒ4: TBTransactionImpl å®ç°"></a>æ€è€ƒ4: TBTransactionImpl å®ç°</h1><h2 id="èƒŒæ™¯-1"><a href="#èƒŒæ™¯-1" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><ol>
<li>ä¸ºäº†è§£å†³å¤šä¸ªDataSource, å¤šæ•°æ®æºäº‹åŠ¡é—®é¢˜.<ol>
<li>ä¾‹å¦‚ DB1 (sql1), DB2 (sql2); å¸Œæœ›è¿™ä¿©æ•°æ®åº“çš„SQLæ‰§è¡Œ, è¦ä¸åŒæ—¶æˆåŠŸ,  è¦ä¸åŒæ—¶å¤±è´¥.</li>
</ol>
</li>
<li>Best Efforts 1PC (One Phase Commit)<ol>
<li>æœ¬è´¨æ˜¯é‡‡ç”¨çš„æ˜¯1é˜¶æ®µæäº¤æ–¹å¼.</li>
</ol>
</li>
<li>ä¼˜ç¼ºç‚¹:<ol>
<li>ä¼˜ç‚¹: å®ç°&amp;ä½¿ç”¨ç®€å•.</li>
<li>ç¼ºç‚¹: æ— æ³•å½»åº•ä¿è¯ä¸€è‡´æ€§. ä¾‹å¦‚db1å·²ç»commit, db2 commitå¤±è´¥, åˆ™æ•´ä½“å›æ»šä¼šå¤±è´¥æ‰!</li>
</ol>
</li>
<li>ä»£ç å®ç°:</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">boolean</span> var11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

     <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
         var11 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token class-name">TBConnection</span> conn<span class="token punctuation">;</span>
         <span class="token class-name">Iterator</span> i$<span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>m_conn<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
             i$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>m_conn<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

             <span class="token keyword">while</span><span class="token punctuation">(</span>i$<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                 conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TBConnection</span><span class="token punctuation">)</span>i$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 conn<span class="token punctuation">.</span><span class="token function">judgeConnAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">&#125;</span>
         <span class="token punctuation">&#125;</span>

         i$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>m_conn<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å°†db1, db2çš„connectionéƒ½è¿›è¡Œæäº¤</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>i$<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
             conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TBConnection</span><span class="token punctuation">)</span>i$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             conn<span class="token punctuation">.</span><span class="token function">realCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             conn<span class="token punctuation">.</span><span class="token function">realClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span>

         var11 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var13<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// å°†db1, db2çš„connectionéƒ½è¿›è¡Œå›æ»š</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>m_isCommitError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token class-name">Iterator</span> i$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>m_conn<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token keyword">while</span><span class="token punctuation">(</span>i$<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
             <span class="token class-name">TBConnection</span> conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TBConnection</span><span class="token punctuation">)</span>i$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                 conn<span class="token punctuation">.</span><span class="token function">realRollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 conn<span class="token punctuation">.</span><span class="token function">realClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var12<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                 log<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token string">"Rollback ERROR:"</span> <span class="token operator">+</span> var12<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> var12<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">&#125;</span>
         <span class="token punctuation">&#125;</span>

         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span>var13<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>var11<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>m_startHoldConnectionTime <span class="token operator">></span> <span class="token number">0L</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                 <span class="token keyword">long</span> spendtime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>m_startHoldConnectionTime<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>spendtime <span class="token operator">>=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>warnTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                     log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"äº‹åŠ¡æŒç»­æ—¶é—´è¿‡é•¿:"</span> <span class="token operator">+</span> spendtime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>m_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">&#125;</span>
             <span class="token punctuation">&#125;</span>

             <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span>
     <span class="token punctuation">&#125;</span>

     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
        <tag>spring-jdbc</tag>
        <tag>database</tag>
        <tag>connection</tag>
        <tag>transaction</tag>
      </tags>
  </entry>
  <entry>
    <title>èµ„æºè°ƒåº¦APIè®¾è®¡çš„æ€è€ƒ</title>
    <url>//2022-05-23-scheduler-api-design/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è®°å½•ä¸‹è°ƒåº¦APIå®é™…è®¾è®¡ä¸åº”ç”¨åœºæ™¯ä¸­, ä¸€äº›æœ‰æ„ä¹‰çš„æ€è€ƒä¸æ²‰æ·€.</p>
<h1 id="æ‰¹é‡è°ƒåº¦"><a href="#æ‰¹é‡è°ƒåº¦" class="headerlink" title="æ‰¹é‡è°ƒåº¦"></a>æ‰¹é‡è°ƒåº¦</h1><h2 id="amount-amp-minAmount-æ¨¡å¼"><a href="#amount-amp-minAmount-æ¨¡å¼" class="headerlink" title="amount &amp; minAmount æ¨¡å¼:"></a>amount &amp; minAmount æ¨¡å¼:</h2><h3 id="æ¨¡å¼è§£é‡Š"><a href="#æ¨¡å¼è§£é‡Š" class="headerlink" title="æ¨¡å¼è§£é‡Š"></a>æ¨¡å¼è§£é‡Š</h3><p>æ ·ä¾‹è¯·æ±‚å¦‚ä¸‹:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">BatchParam</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Integer</span> minAmount<span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> amount<span class="token punctuation">;</span>    
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¯­ä¹‰è§£é‡Š: </p>
<ul>
<li>minAmount: ä»£è¡¨è¯·æ±‚æ–¹éœ€æ±‚çš„æœ€å°çš„èµ„æºé‡. </li>
<li>amount: ä»£è¡¨è¯·æ±‚æ–¹éœ€è¦çš„æœ€å¤§èµ„æºé‡.</li>
</ul>
<p>æœ‰ç‚¹å„¿æŠ½è±¡, æˆ‘ä»¬ç«™åœ¨schedulerçš„è§’åº¦çœ‹.<br>æ‰¹é‡è°ƒåº¦èµ„æº, èµ„æºä¸ä¸€å®šæ€»ä¼šæ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„èµ„æº, æ­¤æ—¶å°±éœ€è¦åšä¸ªå¦¥å,<br>å¦‚æœèƒ½è°ƒåº¦å‡ºæ¥çš„èµ„æºé‡(realAmount)èŒƒå›´:</p>
<ul>
<li>[0, minAmount), åˆ™ä»£è¡¨æ— æ³•æ»¡è¶³ç”¨æˆ·æœ€å°éœ€æ±‚é‡, ç›´æ¥è¿”å›å¤±è´¥, ä¸æ‰£å‡ä»»ä½•èµ„æº.</li>
<li>[minAmount, amount), åˆ™ä»£è¡¨æ»¡è¶³ç”¨æˆ·æœ€å°éœ€æ±‚é‡, åˆ™è¿”å›éƒ¨åˆ†æˆåŠŸ, æ‰£å‡realAmountçš„èµ„æºé‡, å¹¶æŠŠrealAmounté€å‡ºç»™è°ƒç”¨æ–¹.</li>
<li>&#x3D;&#x3D;amount, åˆ™ä»£è¡¨å¯ä»¥å®Œå…¨æ»¡è¶³ç”¨æˆ·èµ„æºéœ€æ±‚, åˆ™è¿”å›æˆåŠŸ, æ‰£å‡realAmount&#x3D;amountçš„èµ„æºé‡.</li>
</ul>
<h3 id="æ¨¡å¼æ ·ä¾‹"><a href="#æ¨¡å¼æ ·ä¾‹" class="headerlink" title="æ¨¡å¼æ ·ä¾‹"></a>æ¨¡å¼æ ·ä¾‹</h3><p>è¿™ç§åŒå‚æ•°çš„æ–¹æ¡ˆ, æœ¬è´¨æ˜¯å•å‚æ•° <code>amount</code> çš„è¶…é›†. æ›´åŠ çµæ´».</p>
<ul>
<li>allOrNothingæ¨¡å¼: ä¸¥æ ¼è¦æ±‚å¿…é¡»æ˜¯amount, åˆ™å‚æ•°ä¸­ minAmount &#x3D; amount å³å¯å®ç°.</li>
<li>tryBestæ¨¡å¼: èƒ½åˆ›å»ºå‡ ä¸ªæ˜¯å‡ ä¸ª, ä½†æœ€å¥½èƒ½åˆ›å»ºå‡ºamountæ•°é‡. åˆ™å‚æ•°ä¸­, minAmount &#x3D; 0 å³å¯å®ç°.</li>
</ul>
<p>è€Œå®é™…åº”ç”¨ä¸Š, é˜¿é‡Œäº‘çš„API <a href="https://help.aliyun.com/document_detail/63440.html">RunInstances</a> ä¹Ÿæ˜¯å¦‚æ­¤è®¾è®¡çš„.</p>
<h2 id="tryBest-amp-allOrNothing-æ¨¡å¼"><a href="#tryBest-amp-allOrNothing-æ¨¡å¼" class="headerlink" title="tryBest &amp; allOrNothing æ¨¡å¼:"></a>tryBest &amp; allOrNothing æ¨¡å¼:</h2><p>æœ¬è´¨ä¸Šå¯ä»¥ç”¨ä¸Šè¾¹çš„ <code>minAmount, amount</code> ä¸¤ä¸ªå‚æ•°è¿›è¡Œæè¿°, æ›´åŠ ä¼˜é›…ä¸çµæ´».</p>
<h2 id="æ‰¹é‡è°ƒåº¦æ€§èƒ½ä¼˜åŒ–çš„æ€è€ƒ"><a href="#æ‰¹é‡è°ƒåº¦æ€§èƒ½ä¼˜åŒ–çš„æ€è€ƒ" class="headerlink" title="æ‰¹é‡è°ƒåº¦æ€§èƒ½ä¼˜åŒ–çš„æ€è€ƒ"></a>æ‰¹é‡è°ƒåº¦æ€§èƒ½ä¼˜åŒ–çš„æ€è€ƒ</h2><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>scheduler-design</tag>
        <tag>api-design</tag>
        <tag>scheduler-api</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸Springä¸­SPIæœºåˆ¶çš„æ¢è®¨ä¸æ€è€ƒ</title>
    <url>//2022-05-24-java-spring-spi/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>é¡¹ç›®ä¸­ç”¨åˆ°äº†SPIæœºåˆ¶, ä½¿ç”¨è¿‡ç¨‹ä¹Ÿèµ°äº†ä¸€äº›å¼¯è·¯. è¿™é‡Œè®°å½•ä¸‹æ¥. </p>
<h2 id="å‡ ç§SPIæ–¹å¼"><a href="#å‡ ç§SPIæ–¹å¼" class="headerlink" title="å‡ ç§SPIæ–¹å¼"></a>å‡ ç§SPIæ–¹å¼</h2><h2 id="Javaä¸­SPIæœºåˆ¶"><a href="#Javaä¸­SPIæœºåˆ¶" class="headerlink" title="Javaä¸­SPIæœºåˆ¶"></a>Javaä¸­SPIæœºåˆ¶</h2><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><h3 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h3><ul>
<li>jdbcé©±åŠ¨, ä¾‹å¦‚mysql-connector-java.jarä¸­, å°±åœ¨META-INF&#x2F;services&#x2F;java.sql.Driver</li>
</ul>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>æ¯”è¾ƒä¸¥é‡çš„ä¸€ä¸ªé—®é¢˜æ˜¯, è¿™äº›SPIçš„Beanæ¸¸ç¦»äºSpringå®¹å™¨å¤–.<br>SPIä¸­å¼•å…¥çš„å¯¹è±¡(Bean)æ²¡æœ‰è¢«Springå®¹å™¨ç®¡ç†èµ·æ¥.<br>ä»è€Œè¿™äº›Beanå¦‚æœä¾èµ–åˆ°äº†Springå®¹å™¨ä¸­å…¶ä»–Bean, å°±åªèƒ½æ‰‹åŠ¨ä»Springå®¹å™¨ä¸­æ‹¿å‡ºæ¥å¤åˆ¶, å³æ‰‹åŠ¨æ³¨å…¥.<br>å¤ªéº»çƒ¦äº†. </p>
<h2 id="Service-Loader-Spring-integration"><a href="#Service-Loader-Spring-integration" class="headerlink" title="Service Loader Spring integration"></a>Service Loader Spring integration</h2><h2 id="Spring-Factories-Loader"><a href="#Spring-Factories-Loader" class="headerlink" title="Spring Factories Loader"></a>Spring Factories Loader</h2><h1 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h1><h2 id="åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦ç”¨åˆ°ServiceLoader-x2F-SPI-SPIä¼˜ç‚¹å…·ä½“æ˜¯å•¥"><a href="#åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦ç”¨åˆ°ServiceLoader-x2F-SPI-SPIä¼˜ç‚¹å…·ä½“æ˜¯å•¥" class="headerlink" title="åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦ç”¨åˆ°ServiceLoader&#x2F;SPI? SPIä¼˜ç‚¹å…·ä½“æ˜¯å•¥?"></a>åœ¨ä»€ä¹ˆæ—¶å€™éœ€è¦ç”¨åˆ°ServiceLoader&#x2F;SPI? SPIä¼˜ç‚¹å…·ä½“æ˜¯å•¥?</h2><p>ä¸ªäººç†è§£, æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ç¼–è¯‘æœŸä¸å®ç°ç±»&#x2F;åŒ…è§£è€¦. </p>
<h2 id="Spring-Factories-Loaderåœ¨Starterçš„åº”ç”¨åœºæ™¯-ä¼˜åŠ¿æ˜¯å•¥"><a href="#Spring-Factories-Loaderåœ¨Starterçš„åº”ç”¨åœºæ™¯-ä¼˜åŠ¿æ˜¯å•¥" class="headerlink" title="Spring Factories Loaderåœ¨Starterçš„åº”ç”¨åœºæ™¯, ä¼˜åŠ¿æ˜¯å•¥?"></a>Spring Factories Loaderåœ¨Starterçš„åº”ç”¨åœºæ™¯, ä¼˜åŠ¿æ˜¯å•¥?</h2><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><p><a href="https://dzone.com/articles/java-service-loader-vs-spring-factories-loader">Java Service Loader vs. Spring Factories Loader</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
        <tag>spi</tag>
        <tag>service-loader</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡é»‘åå•æ–¹æ¡ˆè®¾è®¡å¼•å‘çš„è®¾è®¡æ€è€ƒ</title>
    <url>//2022-05-31-blacklist-or-attribute/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æ¥åˆ°éœ€æ±‚: æŸäº›ECSè§„æ ¼æ—å¤©ç„¶ä¸å…·å¤‡å®•æœºè¿ç§»çš„èƒ½åŠ›, ä¾‹å¦‚æŸäº›è½¯ä»¶Licenseä¸ç¡¬ä»¶IDç»‘å®š, æˆ–è€…åŠ å¯†ä¿¡æ¯ä¸ç¡¬ä»¶ç»‘å®š, å®•æœºè¿ç§»ä¼šå¯¼è‡´Licenseå¤±æ•ˆæˆ–è€…åŠ å¯†ä¿¡æ¯æ— æ³•è§£å¯†.<br>è€Œåœ¨æ­£å¸¸å®•æœºè¿ç§»æµç¨‹é‡Œé»˜è®¤æ‰€æœ‰è§„æ ¼æ—éƒ½ä¼šæ— å·®åˆ«æ‰§è¡Œ.<br>å› æ­¤éœ€è¦ä»£ç æ”¹é€ ä¸‹, è¯†åˆ«è¿™äº›è§„æ ¼æ—, ç„¶åè·³è¿‡æ‰§è¡Œæµç¨‹. </p>
<h1 id="è§£å†³æ–¹æ¡ˆ1-é»‘åå•æ¨¡å¼"><a href="#è§£å†³æ–¹æ¡ˆ1-é»‘åå•æ¨¡å¼" class="headerlink" title="è§£å†³æ–¹æ¡ˆ1: é»‘åå•æ¨¡å¼"></a>è§£å†³æ–¹æ¡ˆ1: é»‘åå•æ¨¡å¼</h1><p>å³åœ¨é…ç½®é¡¹é‡Œç»´æŠ¤ä¸€ä¸ªé»‘åå•List, ä¼ªä»£ç å¦‚ä¸‹: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">blackList <span class="token operator">=</span> <span class="token function">getFromConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>flavorFamily in blackList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">down_migration_execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ä¼˜ç‚¹: å¼€å‘èµ·æ¥ç®€ä¾¿, çµæ´». ä¹Ÿæ˜¯ç¬¬ä¸€ååº”æƒ³åˆ°çš„æ–¹æ¡ˆ.</li>
<li>ç¼ºç‚¹: ä½¿ç”¨è¯¥æ–¹æ¡ˆ, åç»­å‘ç°é—®é¢˜å¾ˆå¤š: <ul>
<li>ä»£ç å®¹æ˜“è¸©å‘: <ul>
<li>å¦‚æœé…ç½®é¡¹æ˜¯ç”¨æ•°æ®åº“å­—æ®µå­˜å‚¨, é‚£ä¹ˆä¸€å®šè¦æ³¨æ„å­—æ®µçš„ç±»å‹&amp;size, å¦‚æœå¤ªå°ä¼šå¯¼è‡´åç»­å¦‚æœåå•æ‰©å®¹, å­—æ®µæº¢å‡º, ä»è€Œæ— æ³•å®ç°æ•ˆæœ.</li>
</ul>
</li>
<li>è¿ç»´æˆæœ¬è¿‡é«˜: <ul>
<li>å› ä¸ºé»‘åå•ä¸å®ä¾‹è§„æ ¼æ—æœ¬èº«å±æ€§æ˜¯åˆ†æ•£å¼€æ¥çš„. </li>
<li>å¦‚æœåç»­æ–°å¢è§„æ ¼æ—, éœ€è¦æœ‰ä¸ªåœ°æ–¹æ¥é€šçŸ¥äº§å“çš„åŒå­¦, <code>è§„æ ¼æ—éœ€è¦æœ‰æ˜¯å¦å®•æœºè¿ç§»è¿™ä¸ªå±æ€§</code>, ç„¶åéœ€è¦ä»–ä»¬è·‘åˆ°å¦å¤–ä¸€ä¸ªåœ°æ–¹å»ç»´æŠ¤ä¸‹è¿™ä¸ªé»‘åå•. </li>
<li>å°¤å…¶æ˜¯åœ¨ä¸åŒç±»åˆ«çš„è§„æ ¼æ—ç”±ä¸åŒäº§å“åŒå­¦è´Ÿè´£ä¸”äººå‘˜æµåŠ¨æ€§å¤§æ—¶, æ²¡åŠæ³•é€šçŸ¥åˆ°æ¯ä½åŒå­¦. </li>
<li>ä½†ä¸€æ—¦é—æ¼, å¯èƒ½ä¼šå¯¼è‡´çº¿ä¸Šé—®é¢˜.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="è§£å†³æ–¹æ¡ˆ2-å±æ€§æ¨¡å¼"><a href="#è§£å†³æ–¹æ¡ˆ2-å±æ€§æ¨¡å¼" class="headerlink" title="è§£å†³æ–¹æ¡ˆ2: å±æ€§æ¨¡å¼"></a>è§£å†³æ–¹æ¡ˆ2: å±æ€§æ¨¡å¼</h1><p>å³</p>
<ol>
<li>æ˜¯å¦å®•æœºè¿ç§»ä½œä¸ºä¸€ä¸ªå¤©ç„¶å±æ€§&#x2F;å­—æ®µ, æ·»åŠ åœ¨è§„æ ¼æ—&#x2F;è§„æ ¼è¡¨ä¸Š.</li>
<li>è¯¥å±æ€§ä½œä¸ºå¿…å¡«å±æ€§, åœ¨æ–°è§„æ ¼æ—ä¸Šçº¿æ—¶, å¯¹åº”äº§å“åœ¨å¡«å†™å…¶ä»–å±æ€§æ—¶(ä¾‹å¦‚cpu&#x2F;memé…æ¯”ç­‰), è¯¥å±æ€§ä¹Ÿéœ€è¦ä¸€å¹¶å¡«å†™.</li>
</ol>
<p>ä¼ªä»£ç å¦‚ä¸‹:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">flavorDef <span class="token operator">=</span> <span class="token function">getFlavorDef</span><span class="token punctuation">(</span>flavor<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>flavorDef<span class="token punctuation">.</span>canDownMigration<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">down_migration_execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ä¼˜ç‚¹: <ul>
<li>åç»­è¿ç»´æˆæœ¬æä½, æ–°è§„æ ¼æ—&#x2F;è§„æ ¼ä¸Šçº¿æ—¶, è¯¥å­—æ®µä¸å…¶ä»–å±æ€§ç±»ä¼¼, ä½œä¸ºä¸€ä¸ªå¿…å¡«é€‰é¡¹, è®©äº§å“åŒå­¦ç»Ÿä¸€ç»´æŠ¤.</li>
<li>ä»£ç æ•´ä½“ä¹Ÿæ›´é¢å‘å¯¹è±¡ä¸€äº›, å³æ›´åŠ é«˜å†…èš, ä½è€¦åˆ.</li>
</ul>
</li>
<li>ç¼ºç‚¹: <ul>
<li>å‰æœŸæ”¹é€ é‡&amp;é£é™©è¾ƒå¤§: <ul>
<li>è¡¨é‡Œéœ€è¦å¢åŠ å­—æ®µ, å°¤å…¶æ˜¯é’ˆå¯¹å¤§è¡¨ä¸”è®¿é—®é¢‘å‘çš„è¡¨, æœ‰å¯èƒ½é”è¡¨, å¯¼è‡´çº¿ä¸Šé—®é¢˜.</li>
<li>å¦‚æœæœ‰å­˜é‡å¤§é‡çš„è§„æ ¼æ—æ•°æ®, éœ€è¦è¿›è¡Œä¸€æ³¢æ‰¹é‡è®¢æ­£.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="é€‚ç”¨åœºæ™¯æ¢è®¨"><a href="#é€‚ç”¨åœºæ™¯æ¢è®¨" class="headerlink" title="é€‚ç”¨åœºæ™¯æ¢è®¨"></a>é€‚ç”¨åœºæ™¯æ¢è®¨</h1><p>æ€»çš„æ¥è¯´, </p>
<ul>
<li>é»‘ç™½åå•åªé€‚åˆä½œä¸ºä¸€ä¸ªçŸ­æœŸå†…ä¸´æ—¶çš„æ–¹æ¡ˆ&#x2F;å¼€å…³, ä¸”åœ¨ä¸ä¹…ä¹‹å, é»‘ç™½åå•éœ€è¦å…¨éƒ¨æ¸…ç©º.<ul>
<li>ä¾‹å¦‚ä¸Šè¿°ä¾‹å­ä¸­, æŸäº›è§„æ ¼éœ€è¦ <font color='red'>ä¸´æ—¶</font> ç¦æ­¢å®•æœºè¿ç§», ä½†ä¸€å‘¨ä¹‹å, è¿™äº›è§„æ ¼éœ€è¦é‡æ–°enable. </li>
<li>è¿™ä¸ªæ—¶å€™ä¸´æ—¶ä½¿ç”¨é»‘ç™½åå•æœºåˆ¶å‡‘åˆä¸‹è¿˜è¡Œ.</li>
</ul>
</li>
<li>è€Œå±æ€§æ–¹æ¡ˆ, å°±æ›´é€‚åˆä½œä¸ºä¸€ä¸ªå¸¸æ€åŒ–çš„æœºåˆ¶.<ul>
<li>ä¾‹å¦‚ä¸Šè¿°ä¾‹å­ä¸­, æŸäº›è§„æ ¼éœ€è¦çš„<code>æ˜¯å¦ç¦æ­¢å®•æœºè¿ç§»</code>æ˜¯å¤©ç„¶çš„ä¸€ä¸ªå±æ€§, è§„æ ¼ä¸€æ—¦è®¾å®šä¸º <code>ç¦æ­¢å®•æœºè¿ç§»</code> å°±ä¸ä¼šå†ä¿®æ”¹äº†.</li>
</ul>
</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ›´åŠ æ¨èä½¿ç”¨â€å±æ€§æ¨¡å¼â€, è¿™ä¹Ÿæ˜¯ä¸€æ¬¡ä¹‹å‰è‡ªå·±é”™è¯¯è®¾è®¡çš„åæ€, ä¹Ÿåƒåˆ°äº†å¾ˆå¤§çš„è‹¦æœ.<br><strong>åç»­åœ¨ä½¿ç”¨â€é»‘&#x2F;ç™½åå•â€ä½œä¸ºæ–¹æ¡ˆå‰, ä¸€å®šè¦å†æƒ³ä¸‹æ˜¯å¦æ˜¯ä¸´æ—¶æ–¹æ¡ˆ, å¦‚æœä¸æ˜¯, é‚£ä¹ˆå°½é‡èƒ½ä½œä¸ºå®ä½“ä¸Šçš„ä¸€ä¸ªå±æ€§æ¥ç»´æŠ¤.</strong><br>è™½ç„¶å±æ€§æ–¹æ¡ˆ, å‰æœŸæ”¹é€ é‡å¯èƒ½è¾ƒå¤§, ä½†é•¿æœŸæ¥çœ‹, ä¼˜ç‚¹æ˜¯è¿œè¿œå¤§äºç¼ºç‚¹çš„.</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>good-design</tag>
        <tag>bad-design</tag>
        <tag>black-list</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootåŸºäºInterfaceçš„Annotationåœ¨AOPä¸­å¦‚ä½•ç”Ÿæ•ˆ</title>
    <url>//2022-06-02-spring-annotation-on-interface/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>SpringBooté¡¹ç›®ä»£ç é‡Œ, æ–°å¢äº†ä¸€ä¸ª <code>@Perf</code> çš„annotation, å¸Œæœ›å¢åŠ è¯¥annotationçš„æ–¹æ³•, èƒ½è‡ªåŠ¨æ‰“å°å‡ºæ–¹æ³•çš„æ‰§è¡Œè€—æ—¶.<br>å®é™…ä»£ç ç»“æ„ä¸­, ä½¿ç”¨äº†FilterChainæ¨¡å¼, ä¼šæœ‰å¤šä¸ªFilter(ä¾‹å¦‚10+ä¸ª)å®ç°åŒä¸€ä¸ªæ¥å£.<br>å› æ­¤æƒ³ç€æŠŠ <code>@Perf</code> æ‰“åœ¨æ¥å£å±‚é¢, å¸Œæœ›æ‰€æœ‰å®ç°ç±»éƒ½èƒ½ç»§æ‰¿è¯¥annotation, ä»è€Œä¸ç”¨åœ¨æ¯ä¸ªå­ç±»çš„Filteræ–¹æ³•é‡Œé‡å¤æ‰“ä¸Šannotation.<br>ä½†å‘ç°å®é™…æ²¡æœ‰ç”Ÿæ•ˆ.</p>
<h1 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h1><p>åœ¨stackoverflowé‡Œ, ç±»ä¼¼çš„é—®é¢˜ä¹Ÿæ˜¯ä¸€å †,<br>æ€»ç»“ä¸‹æ¥åŸå› æ˜¯å¦‚ä¸‹ä¸¤ä¸ª:  </p>
<ol>
<li>method ä¸Šçš„ annotation æ²¡æœ‰è¢«ç»§æ‰¿ä¸‹æ¥. å‚è§å¦‚ä¸‹ç»§æ‰¿åŸåˆ™è¯¦è§£. </li>
<li>spring åœ¨å¯¹ç±»&#x2F;å¯¹è±¡è¿›è¡Œè¿›è¡Œå¢å¼º(weaving)æ—¶, æ ¡éªŒbeanæ˜¯å¦éœ€è¦è¢«å¢å¼º <code>@Around(&quot;@annotation(Perf)&quot;)</code>, åªä¼šæ ¡éªŒbeanå¯¹åº”çš„classä¸Šçš„annotation, è€Œä¸ä¼šå‘ä¸Šå›æº¯çˆ¶ç±»&#x2F;æ¥å£ä¸Šæ˜¯å¦è¢«æ‰“äº†è¯¥annotation.</li>
</ol>
<h2 id="1-Java-Annotationçš„ç»§æ‰¿åŸåˆ™"><a href="#1-Java-Annotationçš„ç»§æ‰¿åŸåˆ™" class="headerlink" title="1. Java Annotationçš„ç»§æ‰¿åŸåˆ™"></a>1. Java Annotationçš„ç»§æ‰¿åŸåˆ™</h2><h3 id="1-1-Annotationç»§æ‰¿åŸåˆ™"><a href="#1-1-Annotationç»§æ‰¿åŸåˆ™" class="headerlink" title="1.1 Annotationç»§æ‰¿åŸåˆ™:"></a>1.1 Annotationç»§æ‰¿åŸåˆ™:</h3><blockquote>
<p>Javaä¸­ä½œç”¨åœ¨æ–¹æ³•å±‚é¢çš„annotationä¸èƒ½è¢«ç»§æ‰¿<br>Javaä¸­ä½œç”¨åœ¨interfaceå±‚é¢çš„annotationä¸èƒ½è¢«ç»§æ‰¿<br>Javaä¸­æ‰“åœ¨classå±‚é¢çš„annotationé»˜è®¤ä¸èƒ½è¢«ç»§æ‰¿, ä½†å¦‚æœannotationè¢«æ‰“ä¸Š@Inheritedæ ‡ç­¾, åˆ™å¯ä»¥è¢«å­ç±»ç»§æ‰¿</p>
</blockquote>
<ul>
<li>åŸåˆ™å‚è§: <a href="http://www.eclipse.org/aspectj/doc/released/adk15notebook/annotations.html#annotation-inheritance">annotation-inheritance</a></li>
<li>è¯¦ç»†æ¼”ç¤ºæµ‹è¯•ä»£ç å‚è§: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/test/java/edu/xmu/kunlun/headfirst/spring/annotation/AnnotationTest.java">edu.xmu.kunlun.headfirst.spring.annotation.AnnotationTest</a></li>
</ul>
<h3 id="1-2-ä¸ºå•¥ä¼šæœ‰è¿™ç§ç»§æ‰¿åŸåˆ™"><a href="#1-2-ä¸ºå•¥ä¼šæœ‰è¿™ç§ç»§æ‰¿åŸåˆ™" class="headerlink" title="1.2 ä¸ºå•¥ä¼šæœ‰è¿™ç§ç»§æ‰¿åŸåˆ™?"></a>1.2 ä¸ºå•¥ä¼šæœ‰è¿™ç§ç»§æ‰¿åŸåˆ™?</h3><p>ä¸Šè¿°åŸåˆ™çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚, ä¸”ä¸å¯æ€è®®. å¦‚æœæ­»è®°ç¡¬èƒŒ, æ•ˆç‡å¤ªä½. éœ€è¦ä»è®¾è®¡è€…è§’åº¦æ¥è€ƒè™‘ä¸‹ä¸ºå•¥ä¸ç›´æ¥éƒ½èƒ½ç»§æ‰¿å°±å¥½?<br>æƒ³æ¸…æ¥šåŸå› , è¿™äº›åŸåˆ™è‡ªç„¶å°±æ˜ç™½äº†. è‡ªå·±æŸ¥è¯¢äº†stackoverflow, æ ¹æœ¬åŸå› æ˜¯<font color='red'>ä¸ºäº†é¿å…æ­§ä¹‰</font>. è¯¦ç»†åœºæ™¯åˆ†æå¦‚ä¸‹: </p>
<ol>
<li><p>ä¸ºå•¥ä½œç”¨åœ¨æ–¹æ³•å±‚é¢çš„annotationä¸èƒ½è¢«ç»§æ‰¿?<br>å› ä¸ºjava interfaceæ˜¯å¤šç»§æ‰¿çš„<br>åŸå› æ ·ä¾‹å‚è§: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/main/java/edu/xmu/kunlun/headfirst/spring/annotation2/Sub2.java">edu.xmu.kunlun.headfirst.spring.annotation2.Sub2</a> </p>
</li>
<li><p>ä¸ºå•¥ä½œç”¨åœ¨interfaceå±‚é¢çš„annotationä¸èƒ½è¢«ç»§æ‰¿?<br>å› ä¸ºjava interfaceæ˜¯å¤šå®ç°çš„.<br>å¦‚æœclassåŒæ—¶å®ç°äº†å¤šä¸ªinterface, æ¯ä¸ªinterfaceéƒ½å®ç°åŒä¸€ä¸ªannotation(ä½†å¯¹åº”annotationçš„å‚æ•°ä¸åŒ), é‚£ä¹ˆå½“å‰classä½¿ç”¨çš„è¯¥æ˜¯å“ªä¸ªannotation(withå‚æ•°)?<br>è¿™ç§åœºæ™¯ä¸‹, åœ¨OOPä¸­æœ¯è¯­å«åš <a href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">diamond inheritance</a></p>
</li>
<li><p>ä¸ºå•¥ä½œç”¨åœ¨classå±‚é¢çš„annotationå¯ä»¥è¢«ç»§æ‰¿?<br>å› ä¸ºjava classæ˜¯å•ç»§æ‰¿çš„. æ‰€ä»¥ä¸ä¼šæœ‰interfaceçš„é—®é¢˜.</p>
</li>
</ol>
<h3 id="1-3-é—®é¢˜æ€»ç»“"><a href="#1-3-é—®é¢˜æ€»ç»“" class="headerlink" title="1.3 é—®é¢˜æ€»ç»“"></a>1.3 é—®é¢˜æ€»ç»“</h3><p>å› æ­¤å¯ä»¥å¾—çŸ¥, Filteræ¥å£çš„ filter() æ–¹æ³•ä¸Šçš„ annotation æ²¡æœ‰è¢«ç»§æ‰¿ä¸‹æ¥.</p>
<h2 id="2-Spring-AOP-å¢å¼ºåŸç†ä¸åŸåˆ™"><a href="#2-Spring-AOP-å¢å¼ºåŸç†ä¸åŸåˆ™" class="headerlink" title="2. Spring AOP å¢å¼ºåŸç†ä¸åŸåˆ™"></a>2. Spring AOP å¢å¼ºåŸç†ä¸åŸåˆ™</h2><h3 id="2-1-Spring-AOP-ä¸­å‡ ä¸ªé‡è¦æ¦‚å¿µ"><a href="#2-1-Spring-AOP-ä¸­å‡ ä¸ªé‡è¦æ¦‚å¿µ" class="headerlink" title="2.1 Spring AOP ä¸­å‡ ä¸ªé‡è¦æ¦‚å¿µ"></a>2.1 Spring AOP ä¸­å‡ ä¸ªé‡è¦æ¦‚å¿µ</h3><ul>
<li>AOP proxy: an object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on). In the Spring Framework, an AOP proxy will be a JDK dynamic proxy or a CGLIB proxy.</li>
<li>Weaving: linking aspects with other application types or objects to create an advised object. This can be done at compile time (using the AspectJ compiler, for example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks, performs weaving at runtime.<br>æ‰€ä»¥, æœ€å…³é”®é—®é¢˜æ˜¯ç”±äº Spring Boot Weaving æ—¶æ ¹æ®annotationæ²¡æœ‰weaveä¸Šå», è€Œè·Ÿä½¿ç”¨ä½•ç§ç±»å‹çš„ AOP Proxy æ— å…³!</li>
</ul>
<h3 id="2-2-Spring-AOP-Weaving-æ ¸å¿ƒä»£ç "><a href="#2-2-Spring-AOP-Weaving-æ ¸å¿ƒä»£ç " class="headerlink" title="2.2 Spring AOP Weaving æ ¸å¿ƒä»£ç "></a>2.2 Spring AOP Weaving æ ¸å¿ƒä»£ç </h3><p>weavingçš„å‡ ç§ç±»å‹:</p>
<ul>
<li>compile time weaving: åœ¨ç¼–è¯‘æœŸç”Ÿæˆå¢å¼ºç±», ä¾‹å¦‚ä½¿ç”¨ AspectJ compiler  </li>
<li>run time (or load time) weaving: åœ¨è¿è¡ŒæœŸ, å®æ—¶åœ°æ ¡éªŒæ˜¯å¦ç¬¦åˆæ¡ä»¶,</li>
</ul>
<h3 id="2-3-Spring-AOP-Weaving-æ ¸å¿ƒé€»è¾‘"><a href="#2-3-Spring-AOP-Weaving-æ ¸å¿ƒé€»è¾‘" class="headerlink" title="2.3 Spring AOP Weaving æ ¸å¿ƒé€»è¾‘"></a>2.3 Spring AOP Weaving æ ¸å¿ƒé€»è¾‘</h3><p>Spring AOP Weavingæ˜¯load time weaving, å³åœ¨Springå®¹å™¨æ„å»ºå®Œæ‰€æœ‰çš„beanä¹‹å, å®Œæˆå®¹å™¨å¯åŠ¨å‰æ‰§è¡Œçš„, ä½¿ç”¨çš„æ˜¯aspectj weaver</p>
<ul>
<li><p>æ ¸å¿ƒä»£ç å‚è§: <code>org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator#getAdvicesAndAdvisorsForBean</code></p>
</li>
<li><p>è€Œé’ˆå¯¹è¯¥é—®é¢˜, å³åˆ¤æ–­è¯¥Aspectèƒ½å¦åº”ç”¨åœ¨è¯¥ç±»å‹ä¸Š, æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹:<br><code>org.springframework.aop.support.AopUtils#canApply(org.springframework.aop.Pointcut, java.lang.Class&lt;?&gt;, boolean)</code><br>å³åˆ¤æ–­ <code>@Perf</code> èƒ½å¦åº”ç”¨åœ¨ <code>edu.xmu.kunlun.headfirst.spring.service.impl.FilterA</code> å¯¹è±¡ä¸Š:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206051422714.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206051424707.png"></p>
</li>
<li><p>è€Œçœ‹å®é™…å®ç°å¦‚ä¸‹, æ˜¯ç›´æ¥æ ¹æ®targetClassæ¥åˆ¤æ–­, ç¡®å®æ²¡æœ‰å‘ä¸Šç»§ç»­å¯»æ‰¾çˆ¶ç±»&#x2F;æ¥å£å±‚é¢æ˜¯å¦æœ‰å£°æ˜ <code>@Perf</code>, å› æ­¤è¿”å›æ˜¯false:<br><code>org.springframework.aop.aspectj.AspectJExpressionPointcut#matches(java.lang.reflect.Method, java.lang.Class&lt;?&gt;, boolean)</code><br> <img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206051438400.png"></p>
</li>
<li><p>å†æ¥æ€è€ƒä¸‹, ä¸ºå•¥ä¸å‘ä¸Šç»§ç»­å¯»æ‰¾? è¿™ä¸ªå°±åˆå›åˆ°äº† ç¬¬ä¸€ä¸ªé—®é¢˜, Java Annotationçš„ç»§æ‰¿åŸåˆ™; å¦‚æœå‘ä¸Šå¯»æ‰¾, æœ‰å¯èƒ½åœ¨åŒä¸€å±‚æ¬¡æ‰¾åˆ°å¤šä¸ªåŒæ ·çš„annotation, ä½†withä¸åŒçš„å‚æ•°. åœ¨è¿™ç§æƒ…å†µä¸‹, Springæ ¹æœ¬å°±ä¸çŸ¥é“è¯¥ä»¥å“ªä¸ªä¸ºå‡†äº†! å¦‚ä¸‹è¿°ä¾‹å­:</p>
</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Perf</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">boolean</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Perf</span><span class="token punctuation">(</span>print <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>
    
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Perf</span><span class="token punctuation">(</span>print <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AnotherFilter</span> <span class="token punctuation">&#123;</span>

<span class="token punctuation">&#125;</span>

<span class="token comment">// å¦‚æœSpring Weavingä¼šå‘ä¸Š(çˆ¶ç±»/æ¥å£)å¯»æ‰¾, é‚£ä¹ˆåˆ°åº•ä»¥å“ªä¸ªä¸ºå‡†? print=false or print=true??</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterA</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span><span class="token punctuation">,</span> <span class="token class-name">AnotherFilter</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>å†å›åˆ°æœ€åˆçš„é—®é¢˜, å¦‚ä½•èƒ½è§£å†³è¯¥é—®é¢˜?</p>
<h2 id="æ–¹æ¡ˆ1-æ‰“åœ¨å­ç±»æ–¹æ³•ä¸Š"><a href="#æ–¹æ¡ˆ1-æ‰“åœ¨å­ç±»æ–¹æ³•ä¸Š" class="headerlink" title="æ–¹æ¡ˆ1: æ‰“åœ¨å­ç±»æ–¹æ³•ä¸Š"></a>æ–¹æ¡ˆ1: æ‰“åœ¨å­ç±»æ–¹æ³•ä¸Š</h2><p>å°†<code>@Perf</code>æ‰“åœ¨å„ä¸ªå­ç±»çš„å®ç°é‡Œ, ç¼ºç‚¹æ˜¯: éå¸¸éº»çƒ¦, åç»­æœ‰å…¶ä»–å­ç±», éƒ½éœ€è¦è®°å¾—æ‰“ä¸Šannotation.</p>
<h2 id="æ–¹æ¡ˆ2-ä¿®æ”¹pointcutæ¡ä»¶"><a href="#æ–¹æ¡ˆ2-ä¿®æ”¹pointcutæ¡ä»¶" class="headerlink" title="æ–¹æ¡ˆ2: ä¿®æ”¹pointcutæ¡ä»¶"></a>æ–¹æ¡ˆ2: ä¿®æ”¹pointcutæ¡ä»¶</h2><p>ä¸ä½¿ç”¨annotationä½œä¸ºpointcutçš„åŒ¹é…æ¡ä»¶, è€Œé‡‡ç”¨å¦‚ä¸‹è¡¨è¾¾å¼:<br><code>@Around(&quot;execution(public * edu.xmu.kunlun.headfirst.spring.service.Filter+.doFilter(..))&quot;)</code></p>
<ul>
<li>ä¼˜ç‚¹: <code>edu.xmu.kunlun.headfirst.spring.service.Filter</code>çš„æ‰€æœ‰å­ç±»çš„<code>doFilter</code>éƒ½ä¼šè¢«è‡ªåŠ¨å¢å¼º.</li>
<li>ç¼ºç‚¹: å¦‚æœæœ‰å…¶ä»–æ¥å£ä¾‹å¦‚<code>edu.xmu.kunlun.headfirst.spring.service.Weighter</code>çš„æ‰€æœ‰å®ç°éœ€è¦è¢«å¢å¼º, åˆ™éœ€è¦ä¿®æ”¹pointcutè¡¨è¾¾å¼, ä¸æ–¹ä¾¿. </li>
<li><a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/main/java/edu/xmu/kunlun/headfirst/spring/aspect/PerfAspect2.java">ä»£ç æ ·ä¾‹ edu.xmu.kunlun.headfirst.spring.aspect.PerfAspect2</a></li>
</ul>
<h2 id="æ–¹æ¡ˆ3-è‡ªå®šä¹‰å®ç°pointcut"><a href="#æ–¹æ¡ˆ3-è‡ªå®šä¹‰å®ç°pointcut" class="headerlink" title="æ–¹æ¡ˆ3: è‡ªå®šä¹‰å®ç°pointcut"></a>æ–¹æ¡ˆ3: è‡ªå®šä¹‰å®ç°pointcut</h2><p>å‚ç…§Spring Transactionalèƒ½åŠ›, è‡ªå·±å®ç°æ–°çš„Advisor, å…¶ä¸­æœ€ä¸»è¦æ˜¯ä¿®æ”¹pointcut</p>
<ul>
<li>ç¬¬ä¸€æ­¥: åˆ›å»ºè‡ªå®šä¹‰pointcut: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/main/java/edu/xmu/kunlun/headfirst/spring/aspect2/PerfAdvisor.java">edu.xmu.kunlun.headfirst.spring.aspect2.PerfAdvisor#pointcut</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StaticMethodMatcherPointcut</span> pointcut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticMethodMatcherPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ç›´æ¥ä½¿ç”¨springå·¥å…·åŒ…ï¼Œæ¥è·å–methodä¸Šçš„æ³¨è§£ï¼ˆä¼šæ‰¾çˆ¶ç±»ä¸Šçš„æ³¨è§£ï¼‰</span>
        <span class="token keyword">return</span> <span class="token class-name">AnnotatedElementUtils</span><span class="token punctuation">.</span><span class="token function">hasAnnotation</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token class-name">Perf2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ç¬¬äºŒæ­¥: åˆ›å»ºè‡ªå®šä¹‰advice: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/main/java/edu/xmu/kunlun/headfirst/spring/aspect2/PerfInterceptor.java">edu.xmu.kunlun.headfirst.spring.aspect2.PerfInterceptor</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerfInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> className <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>className <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> methodName <span class="token operator">+</span> <span class="token string">" start on PerfInterceptor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            o <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>className <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> methodName <span class="token operator">+</span> <span class="token string">" on PerfInterceptor"</span> <span class="token operator">+</span> <span class="token string">" finished cost: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ç¬¬ä¸‰æ­¥: åˆ›å»ºè‡ªå®šä¹‰advisor, å¹¶ä¸”ä»¥beanå½¢å¼æš´éœ²ç»™Springå®¹å™¨: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/main/java/edu/xmu/kunlun/headfirst/spring/aspect2/PerfAdvisor.java">edu.xmu.kunlun.headfirst.spring.aspect2.PerfAdvisor</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerfAdvisor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractBeanFactoryPointcutAdvisor</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StaticMethodMatcherPointcut</span> pointcut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticMethodMatcherPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ç›´æ¥ä½¿ç”¨springå·¥å…·åŒ…ï¼Œæ¥è·å–methodä¸Šçš„æ³¨è§£ï¼ˆä¼šæ‰¾çˆ¶ç±»ä¸Šçš„æ³¨è§£ï¼‰</span>
            <span class="token keyword">return</span> <span class="token class-name">AnnotatedElementUtils</span><span class="token punctuation">.</span><span class="token function">hasAnnotation</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token class-name">Perf2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Advice</span> advice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerfInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Pointcut</span> <span class="token function">getPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> pointcut<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Advice</span> <span class="token function">getAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> advice<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<ul>
<li>ç¬¬å››æ­¥: æµ‹è¯•: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/test/java/edu/xmu/kunlun/headfirst/spring/aspect2/Perf2Test.java">edu.xmu.kunlun.headfirst.spring.aspect2.Perf2Test</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Perf2Test</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">FilterChain</span> chain<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        chain<span class="token punctuation">.</span><span class="token function">filterAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="æœ€ç»ˆæ–¹æ¡ˆ"><a href="#æœ€ç»ˆæ–¹æ¡ˆ" class="headerlink" title="æœ€ç»ˆæ–¹æ¡ˆ:"></a>æœ€ç»ˆæ–¹æ¡ˆ:</h2><p>å¦‚ä¸Šåˆ†æSpring AOPç›¸å…³æºç </p>
<ul>
<li><code>æ–¹æ¡ˆ3: è‡ªå®šä¹‰å®ç°pointcut</code> è™½ç„¶å¯ä»¥æ»¡è¶³è¦æ±‚, ä½†å­˜åœ¨ä¸¤ä¸ªé—®é¢˜: <ul>
<li>æ€§èƒ½é—®é¢˜: æ ¸å¿ƒä½¿ç”¨çš„<code>AnnotatedElementUtils.hasAnnotation(method, Perf2.class);</code>, æ€§èƒ½å¯èƒ½ä¸ä½³</li>
<li>é€»è¾‘é—®é¢˜: é’ˆå¯¹<code>Diamond Inheritance</code>åœºæ™¯, ç»“æœä¼šå¾ˆå¥‡æ€ª, ä¸ç¬¦åˆé¢„æœŸ</li>
</ul>
</li>
<li>è¿™ä¹Ÿæ˜¯é¿å…åç»­è¸©å‘çš„æœ€ä½³å®è·µäº†. </li>
<li>ä¸ªäººä½¿ç”¨ <code>æ–¹æ¡ˆ1</code> ä½œä¸ºäº†æœ€ç»ˆæ–¹æ¡ˆ.</li>
</ul>
<h1 id="æ‰©å±•æ€è€ƒ"><a href="#æ‰©å±•æ€è€ƒ" class="headerlink" title="æ‰©å±•æ€è€ƒ"></a>æ‰©å±•æ€è€ƒ</h1><h2 id="Springæ¥å£å±‚é¢æ”¯æŒçš„-Transactional-annotation"><a href="#Springæ¥å£å±‚é¢æ”¯æŒçš„-Transactional-annotation" class="headerlink" title="Springæ¥å£å±‚é¢æ”¯æŒçš„ @Transactional annotation"></a>Springæ¥å£å±‚é¢æ”¯æŒçš„ @Transactional annotation</h2><p>å¦‚<a href="https://cloud.tencent.com/developer/article/1832305">æ¥å£ä¸Šæ³¨è§£ AOP æ‹¦æˆªä¸åˆ°åœºæ™¯å…¼å®¹å®ä¾‹æ¼”ç¤º</a> æ–‡ä¸­æ‰€è¨€:<br>Springæœ¬èº«æ”¯æŒçš„ <code>@Transactional</code> annotation, æ˜¯å¯ä»¥æ‰“åœ¨interfaceä¸Š, ç„¶åå­ç±»å°±è‡ªåŠ¨å®ç°äº†transactionç›¸å…³å¢å¼ºçš„åŠŸèƒ½.<br>é‚£ä¹ˆSpringå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢?</p>
<ul>
<li>Springå®˜æ–¹çš„è§£ç­”å¦‚ä¸‹:</li>
</ul>
<blockquote>
<p>The Spring team recommends that you annotate only concrete classes (and methods of concrete classes) with the @Transactional annotation, as opposed to annotating interfaces.<br>You certainly can place the @Transactional annotation on an interface (or an interface method),<br>but this works only as you would expect it to if you use interface-based proxies.<br>The fact that Java annotations are not inherited from interfaces means that,<br>if you use class-based proxies (proxy-target-class&#x3D;â€trueâ€) or the weaving-based aspect (mode&#x3D;â€aspectjâ€),<br>the transaction settings are not recognized by the proxying and weaving infrastructure,<br>and the object is not wrapped in a transactional proxy.</p>
</blockquote>
<p>å®é™…ä¸Š, ä¹Ÿå¼•å‘äº†å¾ˆå¤šè®¨è®º: </p>
<ul>
<li><a href="https://stackoverflow.com/questions/3120143/where-should-i-put-transactional-annotation-at-an-interface-definition-or-at-a">Where should I put @Transactional annotation: at an interface definition or at an implementing class?</a></li>
<li>æ–‡ä¸­æ¨èæˆ–è€…è¯´Springå›¢é˜Ÿæ¨è <code>@Transactional</code> æœ€å¥½è¦æ‰“åœ¨<code>concrete classes</code>ä¸Š, è€Œä¸è¦æ‰“åœ¨interfaceä¸Š.</li>
<li>å› ä¸º <mark><font color='red'>å¦‚æœä½¿ç”¨çš„å¦‚æœä¸æ˜¯JDK Based Proxy(or interface-based proxy), åˆ™è¯¥annotationæ˜¯ä¸ç”Ÿæ•ˆçš„!!!</font></mark></li>
<li>æ‰€ä»¥<mark>å¦‚æœè¦ç”¨åœ¨interfaceä¸Š, ä¸€å®šè¦çŸ¥é“å½“å‰ä½¿ç”¨çš„proxyæ˜¯å“ªç§.</mark> </li>
<li>è€Œåœ¨å®é™…ä¸Š, æœ¬èº«Spring&#x2F;SpringBootçš„é»˜è®¤proxyæ–¹å¼ä¸€ç›´åœ¨å˜, æˆ‘ä»¬å¾ˆéš¾å¼„æ˜ç¡®æ¸…æ¥š(æˆ–è€…è¦å¼„æ¸…æ¥šéœ€è¦è´¹å¾ˆå¤§åŠ²å„¿). ä¸‹æ–‡ä¼šè¯¦ç»†è¯´æ˜.</li>
</ul>
<h2 id="SpringBootä¸­é»˜è®¤ä»£ç†æ–¹å¼"><a href="#SpringBootä¸­é»˜è®¤ä»£ç†æ–¹å¼" class="headerlink" title="SpringBootä¸­é»˜è®¤ä»£ç†æ–¹å¼"></a>SpringBootä¸­é»˜è®¤ä»£ç†æ–¹å¼</h2><p>æ ¹æ® <a href="https://www.springcloud.io/post/2022-01/springboot-aop/#gsc.tab=0">AOP in Spring Boot, is it a JDK dynamic proxy or a Cglib dynamic proxy?</a> æ–‡ä¸­è¯´æ˜,<br>Springé»˜è®¤çš„AOP Proxyä¸SpringBooté»˜è®¤çš„æ˜¯æœ‰åŒºåˆ«çš„ </p>
<h3 id="Springé»˜è®¤AOP-Proxy"><a href="#Springé»˜è®¤AOP-Proxy" class="headerlink" title="Springé»˜è®¤AOP Proxy"></a>Springé»˜è®¤AOP Proxy</h3><ul>
<li>If the proxy object implements the interface, then use the JDK dynamic proxy, otherwise it is the Cglib dynamic proxy.</li>
<li>If the proxy object does not implement an interface, then it is a direct Cglib dynamic proxy.</li>
</ul>
<h3 id="SpringBooté»˜è®¤AOP-Proxy"><a href="#SpringBooté»˜è®¤AOP-Proxy" class="headerlink" title="SpringBooté»˜è®¤AOP Proxy"></a>SpringBooté»˜è®¤AOP Proxy</h3><p>åˆæ ¹æ®SpringBoot 1.0 ä¸ SpringBoot 2.0 ç‰ˆæœ¬æœ‰æ‰€åŒºåˆ†: </p>
<ul>
<li><p>SpringBoot 1.0 AOP ProxyåŸåˆ™: é»˜è®¤ç”¨ JDK proxy</p>
<blockquote>
<p>If the developer has set spring.aop.proxy-target-class to false, then the JDK proxy is used.<br>If the developer has spring.aop.proxy-target-class set to true, then the Cglib proxy is used.<br>If the developer did not configure the spring.aop.proxy-target-class property in the first place, then the JDK proxy is used.</p>
</blockquote>
</li>
<li><p>SpringBoot 2.0 AOP ProxyåŸåˆ™: é»˜è®¤ç”¨ Cglib</p>
<blockquote>
<p>If the developer has set spring.aop.proxy-target-class to false, then the JDK proxy is used.<br>If the developer has spring.aop.proxy-target-class set to true, then the Cglib proxy is used.<br>If the developer did not configure the spring.aop.proxy-target-class property in the first place, then the Cglib proxy is used.</p>
</blockquote>
</li>
</ul>
<h3 id="å…¶ä»–å¥½ç©å„¿çš„"><a href="#å…¶ä»–å¥½ç©å„¿çš„" class="headerlink" title="å…¶ä»–å¥½ç©å„¿çš„"></a>å…¶ä»–å¥½ç©å„¿çš„</h3><ul>
<li>ä¹‹å‰çº¿ä¸Šä¹Ÿæœ‰è¿‡ä¸€æ¬¡æ•…éšœ, å¦‚ä¸‹<code>nestedHystrixWrappedGetCurrentThreadId</code>æ–¹æ³•è°ƒç”¨, è°ƒç”¨åˆ°çš„ <code>hystrixWrappedGetCurrentThreadId</code> åˆ™å®é™…æ²¡æœ‰è¢«å¢å¼º.</li>
<li>æ˜¯å› ä¸ºè°ƒç”¨ <code>hystrixWrappedGetCurrentThreadId</code> å®é™…æ˜¯ç”± è¢«ä»£ç†å¯¹è±¡(target) è°ƒç”¨çš„, è€Œä¸æ˜¯ç”± ä»£ç†å¯¹è±¡(proxy) è°ƒç”¨çš„. å…·ä½“æ ·ä¾‹å‚è§: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/test/java/edu/xmu/kunlun/headfirst/spring/service/impl/UserSvcTest.java">edu.xmu.kunlun.headfirst.spring.service.impl.UserSvcTest</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@HystrixWrapper</span><span class="token punctuation">(</span>commandGroupKey <span class="token operator">=</span> <span class="token string">"blog"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">hystrixWrappedGetCurrentThreadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">getCurrentThreadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">nestedHystrixWrappedGetCurrentThreadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">hystrixWrappedGetCurrentThreadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><ul>
<li><code>@Transactional</code> <mark>ä¸è¦æ‰“åœ¨æ¥å£ä¸Š, ä¸€å®šè¦æ‰“åœ¨å®ç°ç±»ä¸Š!!</mark></li>
<li>æ˜¾å¼å£°æ˜<code>spring.aop.proxy-target-class=true</code>, <mark>è®©Spring&#x2F;SpringBooté¡¹ç›®ç»Ÿä¸€éƒ½ç”¨cglibä½œä¸ºproxyæ–¹å¼. </mark> <code>As a reminder, to always use CGLIB, just set the â€œspring.aop.proxy-target-classâ€ property to true.</code></li>
</ul>
<blockquote>
<p>Before using CGLIB,<br>ensure your codebase always uses pre-existing AOP annotations (such as @Transactional) on concrete classes<br>instead of only on interfaces.<br>Interface-only AOP annotations will be ignored when CGLIB is enabled.<br>Changing when @Transactional aspects are triggered could lead to items not being saved to the database,<br>or poor performance due to transactional boundary shifting.</p>
</blockquote>
<h1 id="Code-Samples"><a href="#Code-Samples" class="headerlink" title="Code Samples"></a>Code Samples</h1><ul>
<li>åç»­å°½é‡ä¼šåœ¨æ¯ä¸ªçŸ¥è¯†ç‚¹é‡Œ, éƒ½å¢åŠ å¯¹åº”çš„å®Œæ•´å¯è¿è¡Œçš„code sample, ä¾¿äºå„ä½å­¦ä¹ ç ”ç©¶.</li>
<li>éšç€è¯¥é—®é¢˜çš„æ·±å…¥ç ”ç©¶, ææ˜ç™½äº†asm, cglib, jdk dynamic proxy, aspectjç­‰çš„å…³ç³», æ„ˆå‘è§‰å¾—è¿˜æ˜¯å¾—å¤šæœç´¢è‹±æ–‡èµ„æ–™.</li>
<li><a href="https://github.com/DavyJones2010/head-first-spring/tree/feature/20220603_annotation_on_interface">æœ¬ç¯‡åšæ–‡é‡Œå®Œæ•´çš„spring aop code sample</a></li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.credera.com/insights/aspect-oriented-programming-in-spring-boot-part-2-spring-jdk-proxies-vs-cglib-vs-aspectj">Aspect-Oriented Programming in Spring Boot Part 2: Spring JDK Proxies vs CGLIB vs AspectJ</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
        <tag>spring-boot</tag>
        <tag>aop</tag>
        <tag>interface</tag>
      </tags>
  </entry>
  <entry>
    <title>çˆ±æ­»æœºç¬¬ä¸‰å­£è§‚åæ„Ÿ</title>
    <url>//2022-06-04-love-death-robots/</url>
    <content><![CDATA[<p>åœ¨è¿™ä¸ªé˜´é›¨è¿ç»µçš„ç«¯åˆ, Netflixçš„çˆ±æ­»æœºç¬¬ä¸‰å­£, å¦‚æœŸè€Œè‡³, æƒŠå–œä¸‡åˆ†.<br>ä¸éœ€è¦ä»»ä½•PPTå¤§è¯, è¿™ä¸ªNETFLIXçš„Logoåœ¨æˆ‘å¿ƒä¸­å°±æ„å‘³ç€ <mark>å¥ˆé£å‡ºå“, å¿…å±ç«å“</mark></p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206051149708.png"></p>
<hr>
<p>ç¬¬ä¸€é›†, ä¾‹è¡Œçš„æœºå™¨äººæ¥åˆ°å·²ç»è’åºŸçš„åœ°çƒ, å‚è§‚äº†å„ä¸ªé˜¶å±‚äººç¾¤åœ¨æœ«æ—¥æ—¶åˆ»çš„,<br>ä¾‹è¡Œåœ°ä»¥å±€å¤–äººçš„è§’åº¦å¹½é»˜åæ§½.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206051150581.png"><br><img data-src="https://s2.loli.net/2022/06/05/7g9AGjZH4t132ve.png" alt="1-1"><br><img data-src="https://s2.loli.net/2022/06/05/9XMwt2LFOshYeWp.png" alt="1-2"><br><img data-src="https://s2.loli.net/2022/06/05/wYeOh4a3FDqpIoE.png" alt="1-3"><br><img data-src="https://s2.loli.net/2022/06/05/QoUclBknD3W59wP.png" alt="1-4"><br><img data-src="https://s2.loli.net/2022/06/05/zp3IlVw6Ai79fYv.png" alt="1-5"></p>
<hr>
<p>æœ€è´Ÿç››èª‰çš„ç¬¬ä¹é›†, Jibaro</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>2022</tag>
        <tag>movie</tag>
        <tag>movie-list</tag>
        <tag>love-death-robots</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLè¿æ¥æ± é‡è¦å‚æ•°é…ç½®åŸç†ç ”ç©¶</title>
    <url>//2022-06-05-mysql-conn-params/</url>
    <content><![CDATA[<h1 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h1><ul>
<li>initialSize: åˆå§‹åŒ–æ—¶connectionæ•°é‡, æ¯ä¸ªconnectionå®é™…æ˜¯ä¸€æ¡ä¸DBçš„TCPè¿æ¥</li>
<li>maxActive: æœ€å¤§è¿æ¥æ± æ•°é‡, å¯¹åº”äºmaxPoolSize</li>
<li>minIdle: æœ€å°è¿æ¥æ± æ•°é‡, å¯¹åº”ä¸minPoolSize</li>
<li>maxWait: è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´, å…·ä½“è¯¦è§£å‚è§: <a href="#maxwait%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3">maxWaitå‚æ•°è¯¦è§£</a></li>
<li>timeBetweenEvictionRunsMillis: é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’</li>
<li>minEvictableIdleTimeMillis: é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</li>
<li>maxEvictableIdleTimeMillis:  é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å¤§ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</li>
<li>maxPoolPreparedStatementPerConnectionSize: PS Cache.æš‚æ—¶ä¸ç®¡</li>
</ul>
<h2 id="maxWaitå‚æ•°è¯¦è§£"><a href="#maxWaitå‚æ•°è¯¦è§£" class="headerlink" title="maxWaitå‚æ•°è¯¦è§£"></a>maxWaitå‚æ•°è¯¦è§£</h2><ul>
<li>å‚æ•°é‡Šä¹‰: <a href="https://www.jianshu.com/p/1ff2bd62dd45">https://www.jianshu.com/p/1ff2bd62dd45</a></li>
</ul>
<ol>
<li>å³å®¢æˆ·ç«¯ä»è¿æ¥æ± ä¸­è·å–connectionçš„æœ€å¤§ç­‰å¾…æ—¶é•¿</li>
<li>å¦‚æœä¸é…ç½®, é»˜è®¤ä¸º-1, å³å®¢æˆ·ç«¯ä¼šä¸€ç›´ç­‰å¾…. è¿™æ ·æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„.</li>
<li>clientä»è¿æ¥æ± ä¸­è·å–connectionç­‰å¾…è¶…æ—¶, é”™è¯¯ä¿¡æ¯å¦‚ä¸‹:<pre class="line-numbers language-none"><code class="language-none">Caused by: com.alibaba.druid.pool.GetConnectionTimeoutException: wait millis 3000, active 4, maxActive 4, creating 0
    at com.alibaba.druid.pool.DruidDataSource.getConnectionInternal(DruidDataSource.java:1722)
    at com.alibaba.druid.pool.DruidDataSource.getConnectionDirect(DruidDataSource.java:1402)
    at com.alibaba.druid.filter.FilterChainImpl.dataSource_connect(FilterChainImpl.java:5059)
    at com.alibaba.druid.filter.logging.LogFilter.dataSource_getConnection(LogFilter.java:886)
    at com.alibaba.druid.filter.FilterChainImpl.dataSource_connect(FilterChainImpl.java:5055)
    at com.alibaba.druid.filter.FilterAdapter.dataSource_getConnection(FilterAdapter.java:2756)
    at com.alibaba.druid.filter.FilterChainImpl.dataSource_connect(FilterChainImpl.java:5055)
    at com.alibaba.druid.filter.stat.StatFilter.dataSource_getConnection(StatFilter.java:680)
    at com.alibaba.druid.filter.FilterChainImpl.dataSource_connect(FilterChainImpl.java:5055)
    at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1380)
    at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1372)
    at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:109)
    at org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:262)
    ... 11 more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<ul>
<li>maxWaitå‚æ•°çš„å‘: <a href="https://tech.youzan.com/shu-ju-ku-lian-jie-chi-pei-zhi/">https://tech.youzan.com/shu-ju-ku-lian-jie-chi-pei-zhi/</a></li>
<li>æ‰©å±•é˜…è¯»: Druidé”çš„å…¬å¹³æ¨¡å¼, <a href="https://github.com/alibaba/druid/wiki/Druid%E9%94%81%E7%9A%84%E5%85%AC%E5%B9%B3%E6%A8%A1%E5%BC%8F%E9%97%AE%E9%A2%98">https://github.com/alibaba/druid/wiki/Druid%E9%94%81%E7%9A%84%E5%85%AC%E5%B9%B3%E6%A8%A1%E5%BC%8F%E9%97%AE%E9%A2%98</a></li>
</ul>
<h1 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h1><h2 id="é¡¹ç›®1é…ç½®æ ·ä¾‹"><a href="#é¡¹ç›®1é…ç½®æ ·ä¾‹" class="headerlink" title="é¡¹ç›®1é…ç½®æ ·ä¾‹"></a>é¡¹ç›®1é…ç½®æ ·ä¾‹</h2><ul>
<li>initialSize: 100</li>
<li>maxActive: 200</li>
<li>minIdle: 100</li>
<li>maxWait: 6000</li>
</ul>
<p>æ³¨æ„, è¿™ä¸ªæ˜¯å•æœºçš„è¿æ¥é…ç½®, è€ƒè™‘åˆ°åˆ†å¸ƒå¼ç¯å¢ƒ:</p>
<ul>
<li>åˆå§‹åŒ–æƒ…å†µä¸‹, dbæ‰¿å—çš„è¿æ¥æ•°æ˜¯ initialSize<em>nodeCount &#x3D; 100</em>81 &#x3D; 8100</li>
<li>å‹åŠ›æœ€å¤§æƒ…å†µä¸‹, dbæ‰¿å—çš„è¿æ¥æ•°æ˜¯ initialSize<em>nodeCount &#x3D; 200</em>81 &#x3D; 16200</li>
</ul>
<h2 id="é¡¹ç›®2é…ç½®é¡¹"><a href="#é¡¹ç›®2é…ç½®é¡¹" class="headerlink" title="é¡¹ç›®2é…ç½®é¡¹"></a>é¡¹ç›®2é…ç½®é¡¹</h2><ul>
<li>initialSize: æœªé…ç½®</li>
<li>maxActive: 300</li>
<li>minIdle: 30</li>
<li>maxWait: 60000</li>
</ul>
<h1 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h1><ol>
<li>å½“å®¢æˆ·ç«¯å¹¶å‘åº¦è¶…è¿‡æœ€å¤§è¿æ¥æ•°æ—¶, ä¼šæ€æ ·?<ol>
<li>è¿æ¥æ± ä¸­è¿æ¥æ•°, ä»min â€“&gt; max çš„å¢é•¿ç­–ç•¥æ˜¯æ€æ ·çš„?</li>
<li>å½“å¢é•¿åˆ°maxä¹‹å, è¯·æ±‚çº¿ç¨‹ä¼šç­‰å¾…maxWait, å¦‚æœè¿˜æ˜¯è·å–ä¸åˆ°, åˆ™æŠ›é”™.</li>
</ol>
</li>
<li>å½“MySQLæœåŠ¡ç«¯è¿æ¥æ•°è¶…è¿‡æœºå™¨èƒ½æ‰¿å—çš„æœ€å¤§è¿æ¥æ•°æ—¶, ä¼šæ€æ ·?</li>
<li>MySQLæœåŠ¡ç«¯ä¸€èˆ¬èƒ½æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°æ˜¯å¤šå°‘?<ol>
<li>å–å†³äºç‰©ç†æœº&#x2F;è™šæ‹Ÿæœºçš„é…ç½®.</li>
</ol>
</li>
<li>ä»€ä¹ˆæ˜¯MySQLçš„session? ä¸connectionæ˜¯å•¥å…³ç³»?<ol>
<li><a href="https://www.zhihu.com/question/30325800">https://www.zhihu.com/question/30325800</a></li>
<li>å’Œç½‘ç«™çš„ä¸€ä¸ªsessionå·®ä¸å¤šå§ï¼Œåªä¸è¿‡sessionæ˜¯æŠŠkeyæ”¾åœ¨cookieé‡Œé¢ï¼Œæ•°æ®åº“è¿æ¥æ˜¯æŠŠkeyæ”¾åœ¨å®¢æˆ·ç«¯çš„libraryçš„å†…å­˜é‡Œï¼ˆæ¯”å¦‚.Net Sql Client)ã€‚å¯¹MS SQLæ¥è¯´ï¼Œè¿™ä¸ªè¿æ¥çš„åè®®å«TDSï¼Œåº•ä¸‹å¯ä»¥èµ°å¤šç§ä¼ è¾“å±‚åè®®ï¼Œæ¯”å¦‚tcpipï¼Œä¹Ÿå¯ä»¥named pipeã€‚è€ŒMySQLå°±åˆæœ‰è‡ªå·±çš„åè®®ã€‚</li>
<li>com.taobao.pamirs.transaction.TBConnection#queryDBSessionID åªæœ‰oracleæœ‰sessionId.</li>
</ol>
</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>mysql</tag>
        <tag>database</tag>
        <tag>connection-pool</tag>
        <tag>druid</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot Transactional AOP å®ç°åŸç†ç ”ç©¶</title>
    <url>//2022-06-06-spring-tx-annonation/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¹¦æ¥ä¸Šå› <a href="https://davyjones2010.github.io/2022-06-03-spring-annotation-on-interface/">SpringBootåŸºäºInterfaceçš„Annotationåœ¨AOPä¸­å¦‚ä½•ç”Ÿæ•ˆI</a>,<br>é‡Œè¾¹åªæ˜¯ç®€ç•¥åœ°è¯´æ˜äº†Springä¸­ @Transactional åªèƒ½åœ¨jdk proxyåœºæ™¯ä¸‹ç”Ÿæ•ˆ, åœ¨cglibåœºæ™¯ä¸‹ä¸ç”Ÿæ•ˆ, ä½†æ²¡æœ‰ç ”ç©¶å…·ä½“ä»£ç å®ç°.<br>æœ¬æ–‡è¯¦ç»†æ¢ç©¶ä¸‹.</p>
<h1 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h1><h2 id="0-Spring-AOPæ•´ä½“æµç¨‹"><a href="#0-Spring-AOPæ•´ä½“æµç¨‹" class="headerlink" title="0. Spring AOPæ•´ä½“æµç¨‹"></a>0. Spring AOPæ•´ä½“æµç¨‹</h2><p>SpringæŠŠæ‰€æœ‰Beanåˆå§‹åŒ–å®Œæˆ, å®¹å™¨å¯åŠ¨å‰, ä¼šéå†å®¹å™¨ä¸­çš„æ¯ä¸ªbean, æ‰§è¡Œæ–¹æ³•, å°è¯•æ‰¾åˆ°å¯ç”¨çš„advisor, ç”Ÿæˆæ–°çš„å¢å¼ºbean, æ–¹æ³•å…¥å£: <code>org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator#findEligibleAdvisors</code><br>è¯¦ç»†æ­¥éª¤: </p>
<ol>
<li>ä»Spring Contexté‡Œæ‰¾åˆ°æ‰€æœ‰Advisors: <code>org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator#findCandidateAdvisors</code></li>
<li>æ ¹æ®Advisorsé‡Œçš„PointCuts&#x2F;JoinPointså®šä¹‰, åˆ¤æ–­è¯¥beanæ˜¯å¦å¯ä»¥è¢«è¯¥Advisorå¢å¼º. <code>org.springframework.aop.support.AopUtils#canApply(org.springframework.aop.Advisor, java.lang.Class&lt;?&gt;, boolean)</code></li>
<li>è·å–åˆ°è¯¥beanå¯ä»¥è¢«å¢å¼ºçš„advisorsåˆ—è¡¨</li>
<li>æ ¹æ®é…ç½®<code>spring.aop.proxy-target-class=true/false</code>, ä½¿ç”¨Cglibæˆ–è€…JDKç”Ÿæˆä»£ç†bean. <code>org.springframework.aop.framework.DefaultAopProxyFactory#createAopProxy</code></li>
<li>ä¹‹åä»Springå®¹å™¨ä¸­è·å–bean(getBeanæˆ–è€…é€šè¿‡@Autowiredç­‰è‡ªåŠ¨æ³¨å…¥), å®é™…ä¸Šè·å–åˆ°çš„æ˜¯ä»£ç†bean.</li>
</ol>
<h2 id="1-Transactional-çš„JoinPoint-x2F-PointCutå®šä¹‰"><a href="#1-Transactional-çš„JoinPoint-x2F-PointCutå®šä¹‰" class="headerlink" title="1. @Transactional çš„JoinPoint&#x2F;PointCutå®šä¹‰"></a>1. @Transactional çš„JoinPoint&#x2F;PointCutå®šä¹‰</h2><ul>
<li>JoinPoint or PointCut, åœ¨AOPé‡Œå³æ˜¯ç±»ä¼¼SQLä¸­whereçš„æ¡ä»¶, å³å“ªäº›ç¬¦åˆæ¡ä»¶çš„class&#x2F;bean&#x2F;methodéœ€è¦è¢«å¢å¼º.</li>
<li>JoinPointæ ‡å‡†æ¥å£å®šä¹‰å¦‚ä¸‹: æ ¸å¿ƒæ˜¯<code>matches</code>æ–¹æ³•.</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">StaticMethodMatcher</span> <span class="token keyword">implements</span> <span class="token class-name">MethodMatcher</span> <span class="token punctuation">&#123;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetClass<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// should never be invoked because isRuntime() returns false</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"Illegal MethodMatcher usage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>@Transactional</code> ä½¿ç”¨çš„æ˜¯: <code>org.springframework.transaction.interceptor.TransactionAttributeSourcePointcut</code>, è€Œ<mark>è¯¥pointcut, ä¼šæŒ‰ç…§ç±»ç»§æ‰¿å…³ç³»å‘ä¸Šå¯»æ‰¾, æ‰¾åˆ°æ¥å£å±‚é¢å®šä¹‰çš„annotation.</mark> </li>
<li>è¯¦ç»†æµ‹è¯•ä»£ç å‚è§: <a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/test/java/edu/xmu/kunlun/headfirst/spring/tx/aop/BeanFactoryTransactionAttributeSourceAdvisorTest.java">edu.xmu.kunlun.headfirst.spring.tx.aop.BeanFactoryTransactionAttributeSourceAdvisorTest#matchesTest</a></li>
</ul>
<h2 id="2-Transactional-çš„Adviceå®šä¹‰"><a href="#2-Transactional-çš„Adviceå®šä¹‰" class="headerlink" title="2. @Transactional çš„Adviceå®šä¹‰"></a>2. @Transactional çš„Adviceå®šä¹‰</h2><ul>
<li>Advice, åœ¨AOPé‡Œå³æ˜¯ç±»ä¼¼SQLä¸­èšåˆå‡½æ•°, å³éœ€è¦å¯¹ç¬¦åˆæ¡ä»¶çš„class&#x2F;bean&#x2F;methodåšä»€ä¹ˆå¤„ç†.</li>
<li>Adviceæ ‡å‡†æ¥å£è¯¦ç»†å®šä¹‰å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MethodInterceptor</span> <span class="token keyword">extends</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nonnull</span> <span class="token class-name">MethodInvocation</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>@Transactional</code> ä½¿ç”¨çš„æ˜¯: <code>org.springframework.transaction.interceptor.TransactionInterceptor</code>, å³ä¼šåœ¨<code>invocation.proceed();</code>å‰ååˆ†åˆ«å¼€å¯ä¸æäº¤äº‹åŠ¡.</li>
</ul>
<h2 id="3-Transactional-çš„Advisorå®šä¹‰"><a href="#3-Transactional-çš„Advisorå®šä¹‰" class="headerlink" title="3. @Transactional çš„Advisorå®šä¹‰"></a>3. @Transactional çš„Advisorå®šä¹‰</h2><ul>
<li>Advisor or Aspect, å°±æ˜¯ JoinPoint + Advice, åŒæ—¶éœ€è¦ä½œä¸ºbeanæ³¨å†Œåœ¨Springä¸­, æ–¹ä¾¿Springå®¹å™¨å¯åŠ¨æ—¶, æ‰§è¡Œ<code>ä»Spring Contexté‡Œæ‰¾åˆ°æ‰€æœ‰Advisors</code>æ­¥éª¤.</li>
<li><code>@Transactional</code> ä½¿ç”¨çš„æ˜¯: <code>org.springframework.transaction.interceptor.BeanFactoryTransactionAttributeSourceAdvisor</code></li>
<li>æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šåœ¨ Aspect ä¸Šæ‰“ä¸Š @Aspect + @Component çš„æ ‡ç­¾</li>
</ul>
<h2 id="4-Transactional-çš„AdvisorBeanåˆå§‹åŒ–-amp-ç»„è£…"><a href="#4-Transactional-çš„AdvisorBeanåˆå§‹åŒ–-amp-ç»„è£…" class="headerlink" title="4. @Transactional çš„AdvisorBeanåˆå§‹åŒ–&amp;ç»„è£…"></a>4. @Transactional çš„AdvisorBeanåˆå§‹åŒ–&amp;ç»„è£…</h2><ul>
<li>ä»£ç ä½ç½®: <code>org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration#transactionAdvisor</code></li>
<li>æœ¬è´¨æ˜¯åœ¨ <code>@Configuration</code> é‡Œé€šè¿‡ <code>@Bean</code> newå‡ºBean<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206072232406.png"></li>
</ul>
<h2 id="å®Œæ•´æ ·ä¾‹"><a href="#å®Œæ•´æ ·ä¾‹" class="headerlink" title="å®Œæ•´æ ·ä¾‹"></a>å®Œæ•´æ ·ä¾‹</h2><ul>
<li>å¦‚ä¸‹æ ·ä¾‹:</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Aspect</span> <span class="token comment">// å‘Springå®¹å™¨è¯´æ˜æ˜¯ä¸ªAspect/Advisor</span>
<span class="token annotation punctuation">@Component</span> <span class="token comment">// å‘Springå®¹å™¨æ³¨å†Œ, æ–¹ä¾¿æ‰¾åˆ°è¯¥bean</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerfAspect</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"@annotation(Perf)"</span><span class="token punctuation">)</span> <span class="token comment">// ä½œä¸ºPointCutå®šä¹‰</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">perf</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span> <span class="token comment">//æ–¹æ³•ä½“ä½œä¸ºAdvice</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>methodName <span class="token operator">+</span> <span class="token string">" start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            o <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>methodName <span class="token operator">+</span> <span class="token string">" finished cost: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å®é™…éªŒè¯"><a href="#å®é™…éªŒè¯" class="headerlink" title="å®é™…éªŒè¯"></a>å®é™…éªŒè¯</h1><h2 id="å¼ºåˆ¶ä½¿ç”¨cglib-æ¥å£ä¸Šçš„-Transactional-èƒ½å¦è¢«æ­£å¸¸å¢å¼º"><a href="#å¼ºåˆ¶ä½¿ç”¨cglib-æ¥å£ä¸Šçš„-Transactional-èƒ½å¦è¢«æ­£å¸¸å¢å¼º" class="headerlink" title="å¼ºåˆ¶ä½¿ç”¨cglib, æ¥å£ä¸Šçš„ @Transactional èƒ½å¦è¢«æ­£å¸¸å¢å¼º?"></a>å¼ºåˆ¶ä½¿ç”¨cglib, æ¥å£ä¸Šçš„ @Transactional èƒ½å¦è¢«æ­£å¸¸å¢å¼º?</h2><ul>
<li>åœ¨springbooté…ç½®é‡Œ, <code>spring.aop.proxy-target-class=true</code></li>
<li><a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/test/java/edu/xmu/kunlun/headfirst/spring/tx/TransApiTest.java">TransApiTest#updateTestä»£ç æ ·ä¾‹</a></li>
<li>å¦‚ä¸‹å‘ç°<code>TransApi</code>æ˜¯è¢«cglibæ­£å¸¸å¢å¼º, ç±»å: <code>class edu.xmu.kunlun.headfirst.spring.tx.TransApiImpl$$EnhancerBySpringCGLIB$$2586b9e2</code>, äº‹åŠ¡èƒ½è¢«æ­£å¸¸å¯åŠ¨</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206062333446.png"></p>
<h2 id="å¼ºåˆ¶ä½¿ç”¨jdk-proxy-æ¥å£ä¸Šçš„-Transactional-èƒ½å¦è¢«æ­£å¸¸å¢å¼º"><a href="#å¼ºåˆ¶ä½¿ç”¨jdk-proxy-æ¥å£ä¸Šçš„-Transactional-èƒ½å¦è¢«æ­£å¸¸å¢å¼º" class="headerlink" title="å¼ºåˆ¶ä½¿ç”¨jdk proxy, æ¥å£ä¸Šçš„ @Transactional èƒ½å¦è¢«æ­£å¸¸å¢å¼º?"></a>å¼ºåˆ¶ä½¿ç”¨jdk proxy, æ¥å£ä¸Šçš„ @Transactional èƒ½å¦è¢«æ­£å¸¸å¢å¼º?</h2><ul>
<li>åœ¨springbooté…ç½®é‡Œ, <code>spring.aop.proxy-target-class=false</code></li>
<li><a href="https://github.com/DavyJones2010/head-first-spring/blob/feature/20220603_annotation_on_interface/src/test/java/edu/xmu/kunlun/headfirst/spring/tx/TransApiTest.java">TransApiTest#updateTestä»£ç æ ·ä¾‹</a></li>
<li>å¦‚ä¸‹å‘ç°<code>TransApi</code>æ˜¯è¢«jdkæ­£å¸¸å¢å¼º, ç±»å: <code>class com.sun.proxy.$Proxy56</code>, äº‹åŠ¡èƒ½è¢«æ­£å¸¸å¯åŠ¨</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206062335278.png"></p>
<ul>
<li>httodo: è¿™é‡Œä¸springå®˜æ–¹æ–‡æ¡£è¯´æ˜æœ‰æ‰€ä¸åŒ. æ ¹æ®ä¸Šè¿°ä»£ç åˆ†æ, å…¶å®åˆ°åº•èƒ½ä¸èƒ½å¢å¼º, ä¸åˆ°åº•ä½¿ç”¨cglibè¿˜æ˜¯ä½¿ç”¨jdk-proxyæ²¡å•¥å…³ç³», åªä¸JoinPoint&#x2F;PointCutçš„å®ç°æœ‰å…³ç³». å¾…æœ€ç»ˆæ¢ç©¶ç¡®è®¤.</li>
</ul>
<h1 id="Code-Samples"><a href="#Code-Samples" class="headerlink" title="Code Samples"></a>Code Samples</h1><ul>
<li><a href="https://github.com/DavyJones2010/head-first-spring/tree/feature/20220603_annotation_on_interface">æœ¬ç¯‡åšæ–‡é‡Œå®Œæ•´çš„spring aop code sample</a></li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
        <tag>spring-boot</tag>
        <tag>aop</tag>
        <tag>interface</tag>
        <tag>spring-tx</tag>
      </tags>
  </entry>
  <entry>
    <title>asciinemaä½¿ç”¨ç¬”è®°</title>
    <url>//2022-06-10-asciinema/</url>
    <content><![CDATA[<h1 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h1><ul>
<li><a href="https://github.com/asciinema/asciinema">asciinema</a></li>
<li><a href="https://github.com/marionebl/svg-term-cli">svg-term-cli</a></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> nodejs
<span class="token function">npm</span> <span class="token function">install</span> -g svg-term-cli<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h1 id="ç”Ÿæˆå½•å±æ–‡ä»¶-cast"><a href="#ç”Ÿæˆå½•å±æ–‡ä»¶-cast" class="headerlink" title="ç”Ÿæˆå½•å±æ–‡ä»¶.cast"></a>ç”Ÿæˆå½•å±æ–‡ä»¶.cast</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">asciinema rec a.cast<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>Ctrl + D ç»“æŸå½•å±</code></p>
<h1 id="æœ¬åœ°æ’­æ”¾å½•å±æ–‡ä»¶"><a href="#æœ¬åœ°æ’­æ”¾å½•å±æ–‡ä»¶" class="headerlink" title="æœ¬åœ°æ’­æ”¾å½•å±æ–‡ä»¶"></a>æœ¬åœ°æ’­æ”¾å½•å±æ–‡ä»¶</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">asciinema play a.cast<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="castæ–‡ä»¶è½¬æˆ-svgæ–‡ä»¶"><a href="#castæ–‡ä»¶è½¬æˆ-svgæ–‡ä»¶" class="headerlink" title=".castæ–‡ä»¶è½¬æˆ.svgæ–‡ä»¶"></a>.castæ–‡ä»¶è½¬æˆ.svgæ–‡ä»¶</h1><p>éœ€è¦å…ˆå®‰è£… <a href="https://github.com/marionebl/svg-term-cli">svg-term-cli</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> a.cast <span class="token operator">|</span> svg-term --out a.svg --term iterm2 --profile mymatrix<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h1><p><a href="https://asciinema.org/docs/config">$HOME&#x2F;.config&#x2F;asciinema&#x2F;config</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>mac</tag>
        <tag>tools</tag>
        <tag>asciinema</tag>
        <tag>svg</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerçš„ä¸€äº›æ€»ç»“II</title>
    <url>//2022-06-11-docker-summary-2/</url>
    <content><![CDATA[<h1 id="execåˆ°å®¹å™¨çš„åŸç†"><a href="#execåˆ°å®¹å™¨çš„åŸç†" class="headerlink" title="execåˆ°å®¹å™¨çš„åŸç†"></a>execåˆ°å®¹å™¨çš„åŸç†</h1><p>æœ¬è´¨æ˜¯åœ¨hostä¸Šæ–°åˆ›å»ºä¸€ä¸ªè¿›ç¨‹, åŠ å…¥åˆ°å·²å­˜åœ¨çš„dockerå®¹å™¨çš„Linux Namespaceä¸­.</p>
<h2 id="1-æŸ¥çœ‹å·²æœ‰dockerå®¹å™¨çš„namespaceä¿¡æ¯"><a href="#1-æŸ¥çœ‹å·²æœ‰dockerå®¹å™¨çš„namespaceä¿¡æ¯" class="headerlink" title="1. æŸ¥çœ‹å·²æœ‰dockerå®¹å™¨çš„namespaceä¿¡æ¯"></a>1. æŸ¥çœ‹å·²æœ‰dockerå®¹å™¨çš„namespaceä¿¡æ¯</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122047763.svg"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span>
<span class="token function">docker</span> inspect --format <span class="token string">'&#123;&#123; .State.Pid &#125;&#125;'</span> dockerContainerId
<span class="token function">sudo</span> <span class="token function">ls</span> -l /proc/<span class="token variable">$pid</span>/ns<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="2-é€šè¿‡setns-ç³»ç»Ÿè°ƒç”¨-å°†æ–°è¿›ç¨‹åŠ å…¥åˆ°å·²æœ‰dockerå®¹å™¨çš„namespaceä¸­"><a href="#2-é€šè¿‡setns-ç³»ç»Ÿè°ƒç”¨-å°†æ–°è¿›ç¨‹åŠ å…¥åˆ°å·²æœ‰dockerå®¹å™¨çš„namespaceä¸­" class="headerlink" title="2. é€šè¿‡setns()ç³»ç»Ÿè°ƒç”¨, å°†æ–°è¿›ç¨‹åŠ å…¥åˆ°å·²æœ‰dockerå®¹å™¨çš„namespaceä¸­"></a>2. é€šè¿‡setns()ç³»ç»Ÿè°ƒç”¨, å°†æ–°è¿›ç¨‹åŠ å…¥åˆ°å·²æœ‰dockerå®¹å™¨çš„namespaceä¸­</h2><p>æ ¸å¿ƒä»£ç å¦‚ä¸‹: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">int main<span class="token punctuation">(</span>int argc, char *argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	int fd<span class="token punctuation">;</span>
	fd <span class="token operator">=</span> open<span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>, O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	if<span class="token punctuation">(</span>setns<span class="token punctuation">(</span>fd, <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">==</span>-1<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		errExit<span class="token punctuation">(</span><span class="token string">"setns"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	execvp<span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>, <span class="token operator">&amp;</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	errExit<span class="token punctuation">(</span><span class="token string">"execvp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./set_ns /proc/<span class="token variable">$pid</span>/ns/net /bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>argv[1]: å³å½“å‰æ–°è¿›ç¨‹è¦åŠ å…¥çš„Namesapceæ–‡ä»¶è·¯å¾„</li>
<li>argv[2]: å³æ–°è¿›ç¨‹è¦åœ¨Namesapceé‡Œè¿è¡Œçš„ç¨‹åº</li>
</ul>
<h2 id="3-éªŒè¯"><a href="#3-éªŒè¯" class="headerlink" title="3. éªŒè¯"></a>3. éªŒè¯</h2><p>å¦‚ä¸‹æ ·ä¾‹, é€šè¿‡execè¿›å…¥å®¹å™¨, åœ¨å®¹å™¨å†…ç¼–å†™å¹¶è¿è¡Œäº†ä¸€ä¸ª<code>tmp.sh</code>è„šæœ¬.<br>å¯ä»¥çœ‹åˆ°, <mark>å®é™…ä¸Šæ˜¯åœ¨hostä¸Šæ–°å»ºäº†ä¸€ä¸ªè¿›ç¨‹, ä¸”è¯¥è¿›ç¨‹ä¸dockerå®¹å™¨å…±äº«åŒä¸€ä»½namespace.</mark></p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122112834.svg"></p>
<h1 id="volumeçš„åŸç†"><a href="#volumeçš„åŸç†" class="headerlink" title="volumeçš„åŸç†"></a>volumeçš„åŸç†</h1><ul>
<li>å…è®¸å°†å®¿ä¸»æœºä¸ŠæŒ‡å®šçš„ç›®å½•æˆ–è€…æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­è¯»å–å’Œä¿®æ”¹</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run -v /test myimageid
<span class="token function">docker</span> run -v /home:/test myimageid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>ç¬¬ä¸€ç§æ–¹å¼, æ²¡æœ‰æ˜¾å¼å£°æ˜å®¿ä¸»æœºç›®å½•, Dockeré»˜è®¤åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•<code>/var/lib/docker/volumes/[volume_id]/_data</code>, ç„¶åæŠŠå®ƒæŒ‚è½½åˆ°å®¹å™¨çš„<code>/test</code>ç›®å½•</li>
<li>ç¬¬äºŒç§æ–¹å¼, æŠŠå®¿ä¸»æœºçš„<code>/home</code>ç›®å½•æŒ‚è½½åˆ°Dockerçš„<code>/test</code>ç›®å½•ä¸‹</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122150473.svg"></p>
<ul>
<li>è¿™é‡Œç”¨åˆ°çš„æŒ‚è½½æŠ€æœ¯, å°±æ˜¯<font color='red'>Linuxçš„ç»‘å®šæŒ‚è½½(bind mount)æœºåˆ¶</font>. <mark>å…è®¸å°†ä¸€ä¸ªç›®å½•æˆ–è€…æ–‡ä»¶, è€Œä¸æ˜¯æ•´ä¸ªè®¾å¤‡æŒ‚è½½åˆ°æŒ‡å®šç›®å½•ä¸Š.</mark></li>
<li>å¹¶ä¸”åœ¨æŒ‚è½½ç‚¹ä¸Šè¿›è¡Œçš„ä»»ä½•æ“ä½œ, åªæ˜¯å‘ç”Ÿåœ¨è¢«æŒ‚è½½çš„ç›®å½•æˆ–è€…æ–‡ä»¶ä¸Š, è€ŒåŸæŒ‚è½½ç‚¹çš„å†…å®¹ä¼šè¢«éšè—èµ·æ¥, ä¸”ä¸å—å½±å“.</li>
</ul>
<h2 id="bind-mount-æ ·ä¾‹"><a href="#bind-mount-æ ·ä¾‹" class="headerlink" title="bind mount æ ·ä¾‹"></a>bind mount æ ·ä¾‹</h2><ul>
<li>å°† <code>test2/</code> ç›®å½•æŒ‚è½½åˆ° <code>test/</code> ç›®å½•(æŒ‚è½½ç‚¹)ä¸‹, ä¹‹åæ‰€æœ‰åœ¨<code>test/</code>ä¸‹çš„ä¿®æ”¹åœ¨<code>test2/</code>ä¸‹éƒ½èƒ½çœ‹åˆ°, åä¹‹äº¦ç„¶.</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mount</span> --bind test2 <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>å°† <code>test2/</code> ä» <code>test/</code> ç›®å½•(æŒ‚è½½ç‚¹) å¸è½½æ‰, ä¹‹å<code>test/</code>ç»´æŒä¸€ä¸ªç©ºçš„æŒ‚è½½ç‚¹, æ‰€æœ‰å˜æ›´éƒ½è½åˆ°äº†<code>test2/</code>ä¸‹</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">umount</span> <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122208304.svg"></p>
<h1 id="å•æœºå®¹å™¨ç½‘ç»œåŸç†"><a href="#å•æœºå®¹å™¨ç½‘ç»œåŸç†" class="headerlink" title="å•æœºå®¹å™¨ç½‘ç»œåŸç†"></a>å•æœºå®¹å™¨ç½‘ç»œåŸç†</h1><h2 id="åŸç†æ¦‚è¿°"><a href="#åŸç†æ¦‚è¿°" class="headerlink" title="åŸç†æ¦‚è¿°"></a>åŸç†æ¦‚è¿°</h2><blockquote>
<p>æœ¬è´¨æ˜¯é€šè¿‡ docker0ç½‘æ¡¥ + VethPair å®ç°å•æœºé—´å¤šä¸ªdockerå®¹å™¨äº’è”</p>
</blockquote>
<ul>
<li>docker0ç½‘æ¡¥ å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚. ç±»ä¼¼ä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœº. ç»´æŠ¤ CAMè¡¨(äº¤æ¢æœºé€šè¿‡MACåœ°å€å­¦ä¹ ç»´æŠ¤çš„ ç«¯å£ä¸MACåœ°å€çš„å¯¹åº”è¡¨)</li>
<li>å„ä¸ªå®¹å™¨é€šè¿‡ VethPair ä¸docker0ç½‘æ¡¥è¿æ¥</li>
<li>ä»host-&gt;container, è·¯ç”±è§„åˆ™, éœ€è¦é€šè¿‡ docker0 ç½‘æ¡¥; docker0ç½‘æ¡¥æŸ¥è¯¢CAMè¡¨, ç›´æ¥æŠŠè¯·æ±‚è½¬å‘åˆ°ç›¸åº”ç«¯å£å³å¯.</li>
<li>ä»container -&gt; container, é€šè¿‡ veth pair åˆ°è¾¾ docker0 ç½‘æ¡¥; docker0ç½‘æ¡¥æŸ¥è¯¢CAMè¡¨, ç›´æ¥æŠŠè¯·æ±‚è½¬å‘åˆ°ç›¸åº”ç«¯å£å³å¯.</li>
</ul>
<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><ul>
<li>æŸ¥çœ‹ç½‘æ¡¥ä¿¡æ¯</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brctl show<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>æŸ¥çœ‹è·¯ç”±è¡¨</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">route<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="å®ä¾‹æ¼”ç¤º"><a href="#å®ä¾‹æ¼”ç¤º" class="headerlink" title="å®ä¾‹æ¼”ç¤º"></a>å®ä¾‹æ¼”ç¤º</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122305851.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122305137.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122305508.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206122305564.png"></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>docker</tag>
        <tag>container</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å‰–æKubernetesç¬”è®°</title>
    <url>//2022-06-11-k8s-deep-dive/</url>
    <content><![CDATA[<p>å¾ˆä¹…æ²¡æœ‰çœ‹åˆ°è¿™ä¹ˆä¸€æœ¬ä¹¦äº†, è™½ç„¶åˆšæ‹¿åˆ°æ‰‹æ„Ÿè§‰å¾ˆè–„, åªæœ‰ä¸åˆ°400é¡µ, ä»·æ ¼ä¹Ÿè´µ, 99å…ƒ.<br>æ¯”èµ·<a href="https://book.douban.com/subject/33444476/">k8sæƒå¨æŒ‡å—</a>è¿™ç§å¤§éƒ¨å¤´, ç•¥æ˜¾å•è–„.<br>ä½†å®é™…ç¿»çœ‹å‰ä¸¤ç« ä¹‹å, æ¬£å–œä¸‡åˆ†. è¶Šå¾€åçœ‹, æ„ˆå‘è§‰å¾—é­è¾Ÿå…¥é‡Œ.<br>ä»åº•å±‚åŸç†å‡ºå‘, æ²¡æœ‰åºŸè¯, æ·±å…¥ä¸”ç»†è‡´åœ°è®²è§£å‡ºdocker&#x2F;k8så®ç°çš„å„ç§ç»†èŠ‚.<br>æœ‰æ•ˆåœ°è§£é‡Šäº†è‡ªå·±å¿ƒä¸­çš„è¯¸å¤šç–‘æƒ‘. ç‰©æœ‰æ‰€å€¼. </p>
<hr>
<h1 id="ä¸€äº›ç–‘æƒ‘è§£é‡Š"><a href="#ä¸€äº›ç–‘æƒ‘è§£é‡Š" class="headerlink" title="ä¸€äº›ç–‘æƒ‘è§£é‡Š"></a>ä¸€äº›ç–‘æƒ‘è§£é‡Š</h1><h2 id="å¤šè¿›ç¨‹-x2F-å¯Œå®¹å™¨"><a href="#å¤šè¿›ç¨‹-x2F-å¯Œå®¹å™¨" class="headerlink" title="å¤šè¿›ç¨‹&#x2F;å¯Œå®¹å™¨"></a>å¤šè¿›ç¨‹&#x2F;å¯Œå®¹å™¨</h2><ul>
<li>Q: å¦‚æœdockerä¸­èµ·äº†å¤šä¸ªè¿›ç¨‹, é‚£ä¹ˆåœ¨å®¿ä¸»æœºä¸Šæ˜¯æ€æ ·çš„? æ˜¯å¤šä¸ªè¿›ç¨‹ or dockerè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹?</li>
<li>A: åœ¨å®¿ä¸»æœºä¸Šæ˜¯å¤šä¸ªè¿›ç¨‹. æœ¬è´¨ä¸Šæ˜¯é€šè¿‡æ–°å»ºè¿›ç¨‹, å°†æ–°è¿›ç¨‹åŠ å…¥åˆ°å·²ç»å­˜åœ¨çš„Namespaceä¸­å®ç°.</li>
</ul>
<hr>
<ul>
<li>Q: å¯Œå®¹å™¨æ˜¯å¦‚ä½•å®ç°çš„?</li>
<li>A:</li>
</ul>
<hr>
<ul>
<li><p>Q: docker exec åˆ°å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤, ç†è®ºä¸Šå®¹å™¨ä¹Ÿæ–°å¼€äº†ä¸ªè¿›ç¨‹æ‰§è¡Œè¯¥å‘½ä»¤(ä¹Ÿå°±ç±»ä¼¼å¯Œå®¹å™¨äº†), æ˜¯å¦‚ä½•å®ç°çš„? </p>
</li>
<li><p>A: </p>
</li>
<li><p>Q: å¯Œå®¹å™¨æ¨¡å¼æœ‰ä»€ä¹ˆç¼ºç‚¹? ä¸ºå•¥ä¸æ¨èä½¿ç”¨å¯Œå®¹å™¨? </p>
<ul>
<li>A:</li>
</ul>
</li>
</ul>
<h2 id="ç½‘ç»œæ¨¡å‹"><a href="#ç½‘ç»œæ¨¡å‹" class="headerlink" title="ç½‘ç»œæ¨¡å‹"></a>ç½‘ç»œæ¨¡å‹</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>books</tag>
        <tag>k8s</tag>
        <tag>2022</tag>
        <tag>docker</tag>
        <tag>container</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§å­¦å¯¹æˆ‘çš„å½±å“</title>
    <url>//2022-06-17-university-summary/</url>
    <content><![CDATA[<p>ä¸€å¹´ä¸€åº¦å¦‚ç«å¦‚è¼çš„é«˜è€ƒå­£ç»“æŸ. è“¦ç„¶å›é¦–, è‡ªå·±å·²ç„¶é«˜ä¸­æ¯•ä¸š13å¹´, å¤§å­¦ä¹Ÿæ¯•ä¸š9å¹´äº†.<br>9å¹´æ—¶é—´, æ”¹å˜äº†å¾ˆå¤š, è¶³ä»¥æŠŠä¸€ä¸ªé²œè¡£æ€’é©¬, æ„æ°”é£å‘, å”‡çº¢é½¿ç™½çš„å°‘å¹´, å˜æˆè€Œä»Šæˆ¿è´·å’Œè½¦è´·ç¼ èº«, è§†åŠ›ä¸ä½“åŠ›ä¿±ä¸‹, æƒ¶æƒ¶ä¸å¯ç»ˆæ—¥çš„æ²¹è…»ä¸­å¹´.</p>
<p>ä½†æœ€è¿‘ä¹Ÿä¸€ç›´åœ¨é…é…¿ä¸åæ€, è¿™çŸ­çŸ­å››å¹´çš„å¤§å­¦ç”Ÿæ´», ç©¶ç«Ÿå¸¦ç»™äº†æˆ‘ä»€ä¹ˆ?<br>å½“æˆ‘åœ¨æ”¶åˆ°å¤–å–, å¤–å–å‘˜è¯´éƒ½æ€ªè‡ªå·±æ²¡ä¸Šå¤§å­¦, æ‰è½å¾—ä»Šå¤©ä¸‹è‹¦åŠ›.<br>å½“æˆ‘åœ¨åç½‘çº¦è½¦, å¸æœºè¯´è¦ä¸æ˜¯è‡ªå·±æ²¡ä¸Šå¤§å­¦, ä¹Ÿä¸è‡³äºç°åœ¨æ¯å¤©è¢«å…¬å¸å‹æ¦¨.</p>
<p>å››å¹´çš„ç”Ÿæ´», æœ‰ä»€ä¹ˆæ ·çš„é­”åŠ›, çœŸçš„è¶³ä»¥æŠŠäººç¾¤å®Œæˆé˜¶çº§åˆ’åˆ†ä¹ˆ?<br>ç°åœ¨æŠŠæ‚ä¹±çš„æ€ç»ªæ€»ç»“æˆæ–‡, èŠä»¥æ…°è—‰.</p>
<h1 id="ä¸€-è®©æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ›´å¤§çš„ä¸–ç•Œ"><a href="#ä¸€-è®©æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ›´å¤§çš„ä¸–ç•Œ" class="headerlink" title="ä¸€: è®©æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ›´å¤§çš„ä¸–ç•Œ"></a>ä¸€: è®©æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ›´å¤§çš„ä¸–ç•Œ</h1><hr>
<p>è¿™ä¸ªè¯è¯´å¾—å¯èƒ½æœ‰ç‚¹å„¿å¤§, æœ‰ç‚¹å„¿è™š, ä½†ç¡®å®ä¸Šå¤§å­¦, è®©æˆ‘è¿™ä¸ªå°é•‡é’å¹´, æœ‰æœºä¼šç¬¬ä¸€æ¬¡ç¦»å¼€äº†é‚£ä¸ªåªæœ‰60ä¸‡äººå£çš„å°åŸå¸‚,<br>è¿›å…¥åˆ°ä¸€ä¸ªäºŒä¸‰çº¿åŸå¸‚, çœ‹åˆ°äº†ä¸€ä¸ªæ›´å¤§çš„ä¸–ç•Œ.</p>
<h2 id="åœ°ç†ä¸Šçš„å†²å‡»"><a href="#åœ°ç†ä¸Šçš„å†²å‡»" class="headerlink" title="åœ°ç†ä¸Šçš„å†²å‡»"></a>åœ°ç†ä¸Šçš„å†²å‡»</h2><p>å®¶ä¹¡å¤„äºè±«è¥¿åŒ—ä¸€ä¸ªä¸èµ·çœ¼çš„è§’è½, ä¸‰é¢ç¯å±±çš„ç›†åœ°, å‰©ä½™ä¸€é¢è¢«é»„æ²³é˜»éš”.<br>ä¼Ÿå¤§çš„å¤ªè¡Œå±±ä¸ç‹å±‹å±±äº¤æ±‡äºæ­¤. <br>è€Œæˆ‘ä»å°ç”Ÿæ´»åœ¨å¤ªè¡Œå±±è„šä¸‹, å¬ç€æ„šå…¬ç§»å±±çš„æ•…äº‹é•¿å¤§. <br>18å²å‰ä»æ¥æ²¡æœ‰ç¦»å¼€è¿‡é‚£ç‰‡å¤§å±±. <br>å¹´å°‘çš„æˆ‘ä¸€ç›´å¾ˆå¥½å¥‡å±±çš„åè¾¹æ˜¯ä»€ä¹ˆ? ä¼šä¸ä¼šæ˜¯ä¸€ç‰‡è”šè“è‰²çš„å¤§æµ·å‘¢? ä¼šä¸ä¼šæ˜¯ä¸€ä¸ªå–§åš£ç¹å, é«˜æ¥¼æ—ç«‹, éœ“è™¹é—ªçƒçš„éƒ½å¸‚å‘¢?<br>æ›¾ç»è·Ÿéšå¥¶å¥¶ä¸ŠåŸ, ç¿»è¶Šäº†çœ¼å‰é‚£åº§å¤§å±±, å‘ç°åœ¨å±±çš„åè¾¹, ä»ç„¶æ˜¯å±±, æ˜¯æ— ç©·æ— å°½ç»µå»¶ä¸ç»çš„å±±, æ˜¯ç›®ä¹‹æ‰€åŠæ¯«æ— é¢“åŠ¿çš„å±±è„‰.<br>æ²®ä¸§è‡³æ.  </p>
<blockquote>
<p>æ²¡æœ‰äººçŸ¥é“ä¸ºä»€ä¹ˆ<br>å¤ªé˜³æ€»ä¸‹åˆ°å±±çš„é‚£ä¸€è¾¹<br>æ²¡æœ‰äººèƒ½å¤Ÿå‘Šè¯‰æˆ‘<br>å±±é‡Œé¢æœ‰æ²¡æœ‰ä½ç€ç¥ä»™<br>å¤šå°‘çš„æ—¥å­é‡Œæ€»æ˜¯<br>ä¸€ä¸ªäººé¢å¯¹ç€å¤©ç©ºå‘å‘†<br>å°±è¿™ä¹ˆå¥½å¥‡å°±è¿™ä¹ˆå¹»æƒ³<br>è¿™ä¹ˆå­¤å•çš„ç«¥å¹´</p>
</blockquote>
<p>è€Œä¸Šå¤§å­¦ç»™äº†æˆ‘ä¸€æ¬¡æœºä¼š,<br>èƒ½å…‰æ˜æ­£å¤§ç†ç›´æ°”å£®åœ°å½»åº•é€ƒç¦»è¿™ç‰‡ç¾¤å±±,<br>æ¯…ç„¶å†³ç„¶åœ°é€‰æ‹©ç¦»å®¶2000å…¬é‡Œå¤–çš„å¦é—¨.</p>
<p>æˆ‘æ¥è‡ªå¤§å±±, <br>æˆ‘è¦å¥”èµ´å‘å¤§æµ·. </p>
<p>ç¬¬ä¸€æ¬¡åˆ°æµ·è¾¹, ç¬¬ä¸€æ¬¡åƒåˆ°èŠ’æœè”æè‚¯å¾·åŸºéº¦å½“åŠ³, </p>
<blockquote>
<p>çˆ¶æ¯åœ¨, ä¸è¿œæ¸¸.<br>æ¸¸å¿…æœ‰æ–¹.</p>
</blockquote>
<h2 id="æ–‡åŒ–ä¸Šçš„å†²å‡»"><a href="#æ–‡åŒ–ä¸Šçš„å†²å‡»" class="headerlink" title="æ–‡åŒ–ä¸Šçš„å†²å‡»"></a>æ–‡åŒ–ä¸Šçš„å†²å‡»</h2><p>åŒå­¦éƒ½æ¥è‡ªäº”æ¹–å››æµ·, </p>
<h2 id="æ€æƒ³ä¸Šçš„å†²å‡»"><a href="#æ€æƒ³ä¸Šçš„å†²å‡»" class="headerlink" title="æ€æƒ³ä¸Šçš„å†²å‡»"></a>æ€æƒ³ä¸Šçš„å†²å‡»</h2><p>å¾ˆå¿«å°±ä½“ä¼šåˆ°äº†è´«å¯Œå·®è·ä¸é˜¶çº§å·®å¼‚.<br>å½“æˆ‘è¿˜åœ¨çœåƒä¿­ç”¨åªä¸ºä¹°ä¸ª100å¤šå…ƒçš„<code>è“é­”MP3</code>, ç”šè‡³å…´å¥‹åœ°ç¡ä¸ç€æ—¶, éš”å£å®¿èˆçš„åŒå­¦å°±å·²ç»å¼€å§‹ç”¨<code>iPod touch</code>é€šè¿‡é™€èºä»ªç©èµ›è½¦æ¸¸æˆäº†.<br>å½“æˆ‘è¿˜åœ¨ç”¨<code>å°çµé€š</code>çš„æ—¶å€™, å®¤å‹å°±å·²ç»å¼€å§‹ç”¨<code>iPhone 3Gs</code>äº†. å½“ç¬¬ä¸€æ¬¡è¯•ç”¨, å½»åº•é¢ è¦†äº†æˆ‘çš„æƒ³è±¡, æ‰çŸ¥é“åŸæ¥æ‰‹æœºå¯ä»¥æ˜¯è¿™æ ·çš„. </p>
<blockquote>
<p>æ¯æ¬¡å®¤å‹æ‰‹æœºè§£é”æ—¶, ç»å…¸çš„â€å’”å“’â€å£°éŸ³, ä»¤æˆ‘ç¾¡æ…•, è‡³ä»Šä»åœ¨æˆ‘è€³è¾¹å›å“, æ˜¯æˆ‘æ°¸è¿œé€¾è¶Šä¸äº†çš„é¸¿æ²Ÿ.</p>
</blockquote>
<p>å½“æˆ‘ä¸ºäº†çœé’±, é€‰æ‹©èŠ±è´¹120å…ƒ, ç¡¬åº§å43å°æ—¶ç«è½¦è·¨è¶Šå››åƒé‡Œå›å®¶, è…°é…¸èƒŒç—›, åŒè…¿æµ®è‚¿æ—¶; å®¤å‹ä¸çˆ¸å¦ˆé€‰æ‹©åé£æœº, å»é¦™æ¸¯è´­ç‰©åº¦å‡.<br>å½“æˆ‘çŸ¥é“å®¤å‹åŸæ¥ç«Ÿç„¶æ²¡æœ‰å‚åŠ é«˜è€ƒ, ç›´æ¥é€šè¿‡ç«èµ›ä¿é€åˆ°å¤§å­¦; è€Œæˆ‘å´å‡ ä¹æ‹¼å‡ºäº†åŠæ¡å‘½, æ‰å¾—ä»¥åœ¨å½“å¹´100ä¸‡è€ƒç”Ÿä¸­æ€å‡ºäº†ä¸€æ¡è¡€è·¯.<br>å½“çœ‹åˆ°å®¤å‹çš„ç­çº§é€šè®¯å½•é‡Œ, å‰å››äº”åéƒ½æ˜¯æ¸…ä¸€è‰²çš„æ¸…åŒ—æµ™äº¤; æˆ‘ä»¬æ²³å—çš„åŒä¼´</p>
<p>å¾ˆåº†å¹¸è‡ªå·±æ²¡æœ‰å› ä¸ºè¿™äº›å·®å¼‚å¯¼è‡´èµ°å‘æ¶ˆæä¸è™šæ— , èµ°å‘æ„¤æ€’ä¸åæŠ—, è€Œæ˜¯æ¥å—è¿™äº›å†²å‡», è¿™å°±æ˜¯ç”Ÿæ´».<br>ç„¶åä¸€ç‚¹ä¸€ç‚¹åœ°å†åŠªåŠ›ä¸€äº›, </p>
<p>å½“ç„¶, å¤–å–å‘˜, ç½‘çº¦è½¦å¸æœºå¯èƒ½ä¹Ÿæ˜¯ä¸€æ ·, å€Ÿç”±æ¥åŸå¸‚æ‰“å·¥.</p>
<h1 id="äºŒ-è®©æˆ‘æ‹¥æœ‰äº†ç‹¬ç«‹æ€è€ƒä¸æ¢ç´¢çŸ¥è¯†çš„èƒ½åŠ›"><a href="#äºŒ-è®©æˆ‘æ‹¥æœ‰äº†ç‹¬ç«‹æ€è€ƒä¸æ¢ç´¢çŸ¥è¯†çš„èƒ½åŠ›" class="headerlink" title="äºŒ: è®©æˆ‘æ‹¥æœ‰äº†ç‹¬ç«‹æ€è€ƒä¸æ¢ç´¢çŸ¥è¯†çš„èƒ½åŠ›"></a>äºŒ: è®©æˆ‘æ‹¥æœ‰äº†ç‹¬ç«‹æ€è€ƒä¸æ¢ç´¢çŸ¥è¯†çš„èƒ½åŠ›</h1><hr>
<p>ç¬¬ä¸€æ¬¡åœ¨åŒå­¦å®¿èˆ, çœ‹åˆ°äº†å¢™å¤–çš„ä¸–ç•Œ.<br>æ‰¹åˆ¤å‹æ€ç»´.<br>æˆé•¿å‹æ€ç»´.</p>
<h1 id="ä¸‰-è®©æˆ‘æ‹¥æœ‰äº†ç ´é™¤ä»»ä½•ç¥è¯äººç‰©çš„ä¿¡å¿ƒä¸å‹‡æ°”"><a href="#ä¸‰-è®©æˆ‘æ‹¥æœ‰äº†ç ´é™¤ä»»ä½•ç¥è¯äººç‰©çš„ä¿¡å¿ƒä¸å‹‡æ°”" class="headerlink" title="ä¸‰: è®©æˆ‘æ‹¥æœ‰äº†ç ´é™¤ä»»ä½•ç¥è¯äººç‰©çš„ä¿¡å¿ƒä¸å‹‡æ°”"></a>ä¸‰: è®©æˆ‘æ‹¥æœ‰äº†ç ´é™¤ä»»ä½•ç¥è¯äººç‰©çš„ä¿¡å¿ƒä¸å‹‡æ°”</h1><hr>
<p>æ­£æ˜¯å› ä¸ºæ¥å—äº†æ€æƒ³ä¸Šçš„å†²å‡», æ‰€ä»¥è‡³ä»Šæˆ‘å¿ƒåº•é‡Œä»ä¸ä¼šå´‡æ‹œæˆ–è€…ç¥è¯ä»»ä½•ä¸€ä¸ªäºº.<br>ç›¸ä¿¡è‡ªå·±</p>
<h1 id="é—æ†¾"><a href="#é—æ†¾" class="headerlink" title="é—æ†¾"></a>é—æ†¾</h1><hr>
<p>æœ€è¿‘ä¹Ÿåœ¨çœ‹&lt;è§„æ¨¡&gt;è¿™æœ¬ä¹¦, åŸå¸‚, çœŸçš„ä¼šè®©ç”Ÿæ´»æ›´ç¾å¥½ä¹ˆ? </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>weekend</tag>
        <tag>diary</tag>
        <tag>books</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè™šæ‹Ÿç½‘ç»œä¸ç½‘ç»œè®¾å¤‡</title>
    <url>//2022-06-19-linux-virtual-network/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä½¿ç”¨VMWareæˆ–è€…KVMè®¾ç½®VMç½‘ç»œæ—¶, é€šå¸¸ä¼šæœ‰å‡ ç§ç½‘ç»œæ¨¡å¼: </p>
<ul>
<li>ç½‘æ¡¥æ¨¡å¼(Bridgeæ¨¡å¼)</li>
<li>NATæ¨¡å¼</li>
</ul>
<p>ä¹‹å‰ä¸€ç›´æ¯”è¾ƒè¿·æƒ‘, ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šåŒºåˆ«, æœ€è¿‘ç ”ç©¶ç»ˆäºææ‡‚äº†, æ€»ç»“å¦‚ä¸‹: </p>
<h1 id="ç½‘æ¡¥æ¨¡å¼"><a href="#ç½‘æ¡¥æ¨¡å¼" class="headerlink" title="ç½‘æ¡¥æ¨¡å¼"></a>ç½‘æ¡¥æ¨¡å¼</h1><h2 id="æœ¬è´¨"><a href="#æœ¬è´¨" class="headerlink" title="æœ¬è´¨"></a>æœ¬è´¨</h2><ol>
<li>æœ¬è´¨ä¸ŠæŠŠLinuxç½‘æ¡¥çœ‹åšä¸€ä¸ªäºŒå±‚çš„äº¤æ¢æœº.</li>
<li>VMè¿æ¥åˆ°è¯¥ç½‘æ¡¥, è·å–è®¿é—®å¤–ç½‘èƒ½åŠ›.</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206202216042.png" alt="linux-bridge"></p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>å› æ­¤</p>
<ol>
<li>VMçš„IPä¸Hostçš„IPæ˜¯åœ¨åŒä¸€ä¸ªç½‘æ®µä¸Šçš„</li>
<li>VMåœ¨ç½‘ç»œä¸­çš„ä½ç½®ä¸Hostæ˜¯å¹¶åˆ—çš„</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206202214199.png" alt="VM"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206202215507.png" alt="Host"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206202216645.png" alt="VM Route Table"></p>
<h2 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a>å®æ“</h2><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><ul>
<li><p>ç½‘æ¡¥æ“ä½œ</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brctl show<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>å®‰è£…å·¥å…·</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> net-tools -y
yum <span class="token function">install</span> bridge-utils -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>é…ç½®</p>
</li>
</ul>
<h1 id="NATæ¨¡å¼"><a href="#NATæ¨¡å¼" class="headerlink" title="NATæ¨¡å¼"></a>NATæ¨¡å¼</h1><h2 id="æœ¬è´¨-1"><a href="#æœ¬è´¨-1" class="headerlink" title="æœ¬è´¨"></a>æœ¬è´¨</h2><ol>
<li>æœ¬è´¨ä¸Šæ˜¯Hostçœ‹åšä¸€ä¸ªNATè®¾å¤‡</li>
<li>VMè¿æ¥åˆ°è¯¥NATè®¾å¤‡ä¸Š, è·å–è®¿é—®å¤–ç½‘èƒ½åŠ›.</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206202212554.png"></p>
<h2 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>å› æ­¤</p>
<ol>
<li>VMçš„IPä¸Hostçš„IPä¸åœ¨åŒä¸€ä¸ªç½‘æ®µ</li>
<li>VMåœ¨ç½‘ç»œä¸­çš„ä½ç½®æ˜¯ä»å±äºHost</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206202159960.png" alt="VMåœ¨192.168.230.0/24ç½‘æ®µ"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206202200319.png" alt="Hoståœ¨192.168.3.0/24ç½‘æ®µ"></p>
<h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><p>&#x2F;&#x2F; TODO:</p>
<h2 id="å…¶ä»–æ³¨æ„äº‹é¡¹"><a href="#å…¶ä»–æ³¨æ„äº‹é¡¹" class="headerlink" title="å…¶ä»–æ³¨æ„äº‹é¡¹"></a>å…¶ä»–æ³¨æ„äº‹é¡¹</h2><p>è¿™é‡Œ VMçš„ç½‘æ¡¥æ¨¡å¼ ä¸ dockerçš„ç½‘æ¡¥&#x2F;Bridgeæ¨¡å¼ æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ã€‚</p>
<ul>
<li>VM ç½‘æ¡¥&#x2F;æ¡¥æ¥æ¨¡å¼: VMä¸HOSTåœ¨åŒä¸€ä¸ªç½‘æ®µã€‚</li>
<li>Docker Bridgeæ¨¡å¼ï¼š Dockerå®¹å™¨ä¸HOSTä¸åœ¨åŒä¸€ä¸ªç½‘æ®µã€‚<blockquote>
<p>Bridge æ˜¯ docker é»˜è®¤çš„ç½‘ç»œæ¨¡å¼ã€‚<br>åŸç†è·Ÿ vmware çš„ NAT æ¨¡å¼ç›¸åŒã€‚<br>å®‰è£… docker æ—¶ï¼Œä¼šç»™å®¿ä¸»æœºåˆ›å»ºä¸€ä¸ª docker0 ç½‘å¡ï¼Œè¯¥ç½‘å¡ä¼šä¸ä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœºç›¸è¿ï¼Œ<br>å½“å®¹å™¨ä»¥ Bridge æ¨¡å¼åˆ›å»ºå¯åŠ¨æ—¶ï¼Œä¼šç»™å®¹å™¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œè¯¥ç½‘å¡åˆ†é…çš„ IP ä¸å®¿ä¸»æœºçš„ docker0 æ‰€åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†… (ä¸€èˆ¬æ˜¯ 172.16.0.0)ã€‚<br>ç„¶åè¿‡ç¨‹å°±å’Œ vmware çš„ NAT æ¨¡å¼å®Œå…¨ç›¸åŒã€‚</p>
</blockquote>
</li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://learnku.com/docs/go-micro-build/1.0/explain-the-network-mode-of-vmware-and-docker/8879"> Vmwareå’ŒDockerçš„ç½‘ç»œæ¨¡å¼è®²è§£</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>linux</tag>
        <tag>iaas</tag>
        <tag>network</tag>
        <tag>cloud-computing</tag>
        <tag>nat</tag>
        <tag>pat</tag>
      </tags>
  </entry>
  <entry>
    <title>NATä¹‹ç«¯å£æ˜ å°„(PAT)åŸç†æ€»ç»“&amp;å®è·µ</title>
    <url>//2022-06-22-linux-network-nat/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ç»å¸¸åœ¨å®¶ç”¨è·¯ç”±å™¨ä¸­, çœ‹åˆ°æœ‰ç«¯å£æ˜ å°„(PAT)é€‰é¡¹, ä½†ä¸æ˜æ‰€ä»¥.<br>æœ€è¿‘åˆšå¥½åœ¨ç ”ç©¶NAT, çŸ¥é“äº†<mark>PATæœ¬è´¨æ˜¯NATçš„ä¸€ç§å®ç°æ–¹å¼, æ›´ç¡®åˆ‡åœ°è¯´æ˜¯DNATçš„ä¸€ç§å®ç°æ–¹å¼</mark>.<br>å› æ­¤å€Ÿæ­¤æœºä¼šå¥½å¥½ç ”ç©¶ä¸‹.</p>
<h1 id="DNATæ€»ç»“"><a href="#DNATæ€»ç»“" class="headerlink" title="DNATæ€»ç»“"></a>DNATæ€»ç»“</h1><h2 id="PATä½œç”¨æ¦‚è¿°"><a href="#PATä½œç”¨æ¦‚è¿°" class="headerlink" title="PATä½œç”¨æ¦‚è¿°"></a>PATä½œç”¨æ¦‚è¿°</h2><p>å®¶ç”¨è·¯ç”±å™¨ä¸­é…ç½®PAT, æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§<code>å†…ç½‘ç©¿é€</code>çš„å®ç°æ–¹å¼ï¼Œæˆ–è€…DNATçš„ä¸€ç§æ–¹å¼ã€‚<br>å³éœ€è¦æŠŠå®¶é‡Œå†…ç½‘æŸå°ä¸»æœºçš„æŸä¸ªæœåŠ¡, æš´éœ²åˆ°å…¬ç½‘ä¸Š, ä»¥ä¾¿èƒ½åœ¨å…¬ç½‘ç¯å¢ƒä¸‹è®¿é—®è¯¥æœåŠ¡.<br>ä¾‹å¦‚</p>
<ul>
<li>å®¶åº­å†…ç½‘ç½‘æ®µæ˜¯<code>192.168.3.0/24</code></li>
<li>å®¶ç”¨è·¯ç”±å™¨, ç”µä¿¡è¿è¥å•†åˆ†é…çš„å¯¹å¤–å…¬ç½‘IPæ˜¯<code>115.192.71.187</code></li>
<li>æŸå°ä¸»æœºIPæ˜¯<code>192.168.3.213</code>: <ul>
<li>æš´éœ²äº†8080çš„æŸä¸ªtomcatæœåŠ¡, æƒ³è¦æŠŠè¿™ä¸ªæœåŠ¡æš´éœ²åœ¨å…¬ç½‘ä¸Š, ä»¥ä¾¿å…¶ä»–äººèƒ½å¤Ÿè®¿é—®.</li>
<li>æš´éœ²äº†è¿œç¨‹æ¡Œé¢RDPç«¯å£æœåŠ¡, ä»¥ä¾¿åœ¨å…¬å¸æˆ–è€…å’–å•¡å…, èƒ½è®¿é—®åˆ°è¯¥è¿œç¨‹æ¡Œé¢.</li>
<li>ç­‰ç­‰</li>
</ul>
</li>
<li>æ­¤æ—¶å¯ä»¥åœ¨è·¯ç”±å™¨ä¸Šå¼€å¯ç«¯å£æ˜ å°„(PAT), å°†è·¯ç”±å™¨ä¸ŠæŸä¸ªç«¯å£(å¦‚8888)ä¸å†…ç½‘ä¸»æœºçš„ç«¯å£(å¦‚8080)å¦‚è¿›è¡Œæ˜ å°„, æ‰€æœ‰è®¿é—®{è·¯ç”±å™¨IP, 8888ç«¯å£}çš„è¯·æ±‚, å°±ä¼šè¢«è‡ªåŠ¨è·¯ç”±åˆ°{å†…ç½‘IP, 8080ç«¯å£}ä¸Š:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202206232339615.png"></p>
<p>&#x2F;&#x2F; TODO: è¿™é‡ŒæŒ–ä¸ªå‘, å†…ç½‘ç©¿é€é™¤äº†PATå¤–, è¿˜æœ‰å…¶ä»–æ–¹æ¡ˆ, ä¾‹å¦‚ <code>èŠ±ç”Ÿå£³</code>, åè¾¹æ–°å¼€ç¯‡ç« è®²ä¸‹åŸç†.</p>
<h2 id="åŸç†æ¦‚è¿°"><a href="#åŸç†æ¦‚è¿°" class="headerlink" title="åŸç†æ¦‚è¿°"></a>åŸç†æ¦‚è¿°</h2><p>æœ¬è´¨ä¸Šæ˜¯å®¶ç”¨è·¯ç”±å™¨ä¿å­˜äº†è¿™ä¹ˆä¸€å¼ NATè¡¨:<br><code>&#123;publicIp, publicPort&#125;</code> â€”æ˜ å°„åˆ°â€”&gt; <code>&#123;localIp, localPort&#125;</code></p>
<h2 id="PATè·¯ç”±æµç¨‹"><a href="#PATè·¯ç”±æµç¨‹" class="headerlink" title="PATè·¯ç”±æµç¨‹"></a>PATè·¯ç”±æµç¨‹</h2><h3 id="0X00-å¤–éƒ¨ç”¨æˆ·-â€“-gt-è·¯ç”±å™¨"><a href="#0X00-å¤–éƒ¨ç”¨æˆ·-â€“-gt-è·¯ç”±å™¨" class="headerlink" title="0X00: å¤–éƒ¨ç”¨æˆ· â€“&gt; è·¯ç”±å™¨"></a>0X00: å¤–éƒ¨ç”¨æˆ· â€“&gt; è·¯ç”±å™¨</h3><ol>
<li>äºŒå±‚å¸§: <code>&#123;remoteMac, remoteIp, remotePort&#125;, &#123;publicMac, publicIp, publicPort&#125;</code></li>
</ol>
<h3 id="0X01-è·¯ç”±å™¨-â€“-gt-å†…ç½‘Server"><a href="#0X01-è·¯ç”±å™¨-â€“-gt-å†…ç½‘Server" class="headerlink" title="0X01: è·¯ç”±å™¨ â€“&gt; å†…ç½‘Server:"></a>0X01: è·¯ç”±å™¨ â€“&gt; å†…ç½‘Server:</h3><ol>
<li>ç›®æ ‡ publicMac &#x3D;&#x3D; routerâ€™s publicMacï¼Œç½‘å¡æ¥æ”¶ï¼Œè§£æä¸‰å±‚IPåŒ…</li>
<li>è¿›å…¥preroutingé˜¶æ®µï¼š(DNATä½œç”¨åœ¨prerouteé˜¶æ®µ)<ol>
<li>æŸ¥NATè¡¨ï¼ˆDNATæ¡ç›®ï¼‰: <code>&#123;publicIp, publicPort&#125;</code> â€“&gt; <code>&#123;localIp, localPort&#125;</code></li>
<li>ä¿®æ”¹ä¸‰å±‚IPåŒ… <code>&#123;remoteIp, remotePort&#125;</code> â€“&gt; <code>&#123;localIp, localPort&#125;</code></li>
</ol>
</li>
<li>ç”±äºæ­¤æ—¶targetIpæ˜¯ localIp, !&#x3D; publicIpï¼Œå› æ­¤ä¸ä¼šèµ°å…¥INPUTæµç¨‹ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šæŠŠæ•°æ®åŒ…äº¤ç»™ä¸Šå±‚åº”ç”¨ã€‚</li>
<li>è¿›å…¥FORWARD&#x2F;ROUTEé˜¶æ®µï¼š<ol>
<li>å¦‚æœæ²¡æœ‰å¼€å¯ip_forwardingï¼Œåˆ™æµç¨‹åˆ°æ­¤ç»“æŸã€‚ç›´æ¥æŠŠIPåŒ…ä¸¢å¼ƒæ‰ã€‚</li>
<li>æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œ<code>route -n</code>ï¼Œæ‰¾åˆ°å¾€localIpç½‘æ®µå‘é€æ•°æ®åŒ…ï¼Œåº”è¯¥ä½¿ç”¨çš„ç½‘å¡ä¸ç½‘å¡å¯¹åº”çš„Macåœ°å€ï¼ˆä¾‹å¦‚ gatewayMacï¼‰</li>
</ol>
</li>
<li>å°è£…äºŒå±‚å¸§<ol>
<li>å‘ARPå¹¿æ’­: whatâ€™s localIpâ€™s mac addr, tell publicMac</li>
<li>è·å–ARPç¼“å­˜è¡¨é¡¹: {localIp} â€“&gt; {localMac}</li>
<li>ä¿®æ”¹å¸§å†…å®¹ä¸º: <code>&#123;gatewayMac, remoteIp, remotePort&#125;, &#123;localMac, localIp, localPort&#125;</code></li>
</ol>
</li>
<li>é€šè¿‡å¯¹åº”çš„ç½‘å¡å‘å‡ºäºŒå±‚å¸§ã€‚</li>
</ol>
<p><img data-src="https://p.k8s.li/iptables.png"></p>
<h3 id="0X02-Serverç«¯å¤„ç†"><a href="#0X02-Serverç«¯å¤„ç†" class="headerlink" title="0X02: Serverç«¯å¤„ç†:"></a>0X02: Serverç«¯å¤„ç†:</h3><ol>
<li>æ¥æ”¶å¦‚ä¸‹IPå¸§<br><code>&#123;gatewayMac, remoteIp, remotePort&#125;, &#123;localMac, localIp, localPort&#125;</code></li>
<li>ç›®æ ‡ localMac &#x3D;&#x3D; Server localMac, ç½‘å¡æ¥æ”¶(æ— éœ€å¼€å¯æ··æ‚æ¨¡å¼), å¦åˆ™ä¸¢å¼ƒ</li>
<li>ç›®æ ‡ localIp &#x3D;&#x3D; Server localIp, TCP&#x2F;IPåè®®æ ˆæ¥æ”¶. <ol>
<li>æ˜¯å¦æœ‰å¯èƒ½IPä¸åŒ¹é…? å¦‚ä½•å¤„ç†? â€“&gt; æ˜¯å¦å¼€å¯äº†ip_forwardingï¼Ÿ å…·ä½“å‚è§</li>
</ol>
</li>
<li>serverç«¯å°†TCPæ•°æ®åŒ…è½¬ç»™å¯¹åº”åº”ç”¨å±‚ç¨‹åºå¤„ç†</li>
</ol>
<h3 id="0X03-Server-â€“å›åŒ…â€“-gt-è·¯ç”±å™¨"><a href="#0X03-Server-â€“å›åŒ…â€“-gt-è·¯ç”±å™¨" class="headerlink" title="0X03: Server â€“å›åŒ…â€“&gt; è·¯ç”±å™¨:"></a>0X03: Server â€“å›åŒ…â€“&gt; è·¯ç”±å™¨:</h3><ol>
<li>Serverå¤„ç†å®Œæ¯•, ç”Ÿæˆå›åŒ…, ç”±äºremoteIpä¸åœ¨ç½‘æ®µ:<br><code>&#123;localIp, localPort&#125;, &#123;remoteIp, remotePort&#125;</code></li>
<li>Serverå‘é€ARPå¹¿æ’­, æŸ¥æ‰¾é»˜è®¤ç½‘å…³(serverç«¯äº‹å…ˆé…ç½®å¥½äº†ç½‘å…³çš„IP)çš„MACåœ°å€ {gatewayIp} â€“&gt; {gatewayMac}</li>
<li>Serverå°è£…äºŒå±‚å¸§, å‘é€ç»™è·¯ç”±å™¨:<br><code>&#123;localMac, localIp, localPort&#125;, &#123;gatewayMac, remoteIp, remotePort&#125;</code></li>
</ol>
<h3 id="0X04-è·¯ç”±å™¨PATå¤„ç†å›åŒ…"><a href="#0X04-è·¯ç”±å™¨PATå¤„ç†å›åŒ…" class="headerlink" title="0X04: è·¯ç”±å™¨PATå¤„ç†å›åŒ…"></a>0X04: è·¯ç”±å™¨PATå¤„ç†å›åŒ…</h3><p>åç»æŸ¥è¯ï¼Œ<mark> é’ˆå¯¹å›åŒ…ï¼Œä¸ä¼šå†è¿‡iptables</mark>ï¼Œè¿›è¡Œå¦‚ä¸‹NATåå‘æŸ¥è¡¨äº†ã€‚<br>å®é™…çœ‹äº†ä¸‹ï¼Œç¡®å®æ²¡æœ‰åŒæ—¶åˆ›å»ºå‡ºå¦‚ä¸‹åå‘çš„iptablesè§„åˆ™ã€‚<br>è€Œæ˜¯<mark>ç”±kernelæ¨¡å—conntrackè¿›è¡Œç»´æŠ¤å®Œæˆ{mac, ip, port}çš„æ›¿æ¢ã€‚<mark></p>
<ol>
<li><del>æ”¶åˆ°äºŒå±‚å¸§:<br><code>&#123;localMac, localIp, localPort&#125;, &#123;gatewayMac, remoteIp, remotePort&#125;</code></del></li>
<li><del>åå‘æŸ¥æ‰¾NATè¡¨:<br><code>&#123;localIp, localPort&#125; --&gt; &#123;publicIp, publicPort&#125;</code></del></li>
<li><del>ä¿®æ”¹ä¸‰å±‚åŒ…(æ›¿æ¢æ‰localIp, localPort):<br><code>&#123;publicIp, publicPort&#125;, &#123;remoteIp, remotePort&#125;</code></del></li>
<li><del>äºŒå±‚å¸§ä¿®æ”¹(ä¿®æ”¹æ‰localMac, gatewayMac):<br><code>&#123;publicMac, publicIp, publicPort&#125;, &#123;remoteMac, remoteIp, remotePort&#125;</code></del></li>
</ol>
<h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„:"></a>æ³¨æ„:</h3><p>è·¯ç”±å™¨æœ¬èº«æ˜¯æœ‰å¤šä¸ªç½‘å¡çš„, å†…ç½‘ä¸­æ˜¯ {gatewayMac, gatewayIp}, å¯¹åº”çš„å…¬ç½‘æ˜¯ {publicMac, publicIp}</p>
<h1 id="SNATæ€»ç»“"><a href="#SNATæ€»ç»“" class="headerlink" title="SNATæ€»ç»“"></a>SNATæ€»ç»“</h1><p>&#x2F;&#x2F; TODO: å¦‚ä½•ä½œç”¨åœ¨postroutingé˜¶æ®µï¼Ÿ</p>
<h1 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h1><p>æ ¸å¿ƒæ˜¯è·¯ç”±å™¨æ€ä¹ˆåˆ›å»ºNATè¡¨? ä½¿ç”¨iptablesä¹ˆ? æ€ä¹ˆæ“ä½œiptablesèƒ½å®ç°ç›¸åŒåŠŸèƒ½? </p>
<h1 id="å®è·µ-amp-éªŒè¯"><a href="#å®è·µ-amp-éªŒè¯" class="headerlink" title="å®è·µ&amp;éªŒè¯"></a>å®è·µ&amp;éªŒè¯</h1><p>&#x2F;&#x2F; TODO: </p>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://blog.k8s.li/linux-net-and-iptables.html#%E5%85%B3%E7%B3%BB">Linux ç½‘ç»œå’Œ iptables è¿è¡ŒåŸç†</a></li>
</ul>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>æœ€è¿‘ç ”ç©¶å…³äºç½‘ç»œ, æœ‰ä¸€å †çš„æ¦‚å¿µ, ä¸€å †çš„å‘è¦å¡«, è¿™é‡Œå…ˆåˆ—å‡ºæ¥: </p>
<ul>
<li>å‡ å¼ è¡¨, ä½œç”¨æ˜¯å•¥? åˆ†åˆ«å¦‚ä½•æŸ¥çœ‹è¡¨é¡¹? <ul>
<li>camè¡¨</li>
<li>arpç¼“å­˜è¡¨</li>
<li>natè¡¨</li>
<li>dnsç¼“å­˜è¡¨</li>
</ul>
</li>
<li>å‡ ç§è®¾å¤‡: <ul>
<li>ä¸‰å±‚äº¤æ¢æœºä¸äºŒå±‚äº¤æ¢æœºåŒºåˆ«?</li>
<li>Linuxç½‘æ¡¥ä¸äº¤æ¢æœºæœ‰å•¥åŒºåˆ«?</li>
</ul>
</li>
<li>å‡ ä¸ªæŠ€æœ¯ç»†èŠ‚<ul>
<li>ç½‘å¡æ··æ‚æ¨¡å¼? å•¥æ—¶å€™ä¸‹å¼€å¯? åº”ç”¨åœºæ™¯æ˜¯å•¥?</li>
<li>ä¼šä¸ä¼šæ”¶åˆ°MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸åŒ¹é…çš„IPåŒ…? å…·ä½“å’‹å¤„ç†? ç›´æ¥ä¸¢å¼ƒ? è¿˜æ˜¯å¯ä»¥ä½¿ç”¨? </li>
<li>ip forwarding æ˜¯å•¥? ä¸ºå•¥NATæ¨¡å¼ä¸‹éœ€è¦å¼€å¯? ä¸ºå•¥ä¸é»˜è®¤å¼€å¯? </li>
<li>ipéš§é“çš„åŸç†æ˜¯å•¥? </li>
<li>lvsçš„å‡ ç§å·¥ä½œåŸç†å†ç ”ç©¶, å†å®è·µéªŒè¯</li>
<li>ç»„æ’­çš„åº”ç”¨åœºæ™¯æ˜¯å•¥? å¾ˆé‡è¦ä¹ˆ?</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>linux</tag>
        <tag>iaas</tag>
        <tag>network</tag>
        <tag>cloud-computing</tag>
        <tag>nat</tag>
        <tag>pat</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡DubboæœåŠ¡è°ƒç”¨å¼‚å¸¸æ’æŸ¥</title>
    <url>//2022-06-24-dubbo-invoke-error/</url>
    <content><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><ul>
<li>åº”ç”¨æ‹“æ‰‘: systemA â€”- dubbo è°ƒç”¨ â€”-&gt; systemB</li>
<li>systemBåº”ç”¨åœ¨å·²æœ‰çš„dubboæ¥å£ç±»é‡Œ, æ–°å¢åŠ äº†ä¸€ä¸ªæ–¹æ³•methodA.</li>
<li>systemAåœ¨è°ƒç”¨è¯¥methodAæ—¶, æŠ›é”™. é”™è¯¯ä¿¡æ¯å¦‚ä¸‹:</li>
</ul>
<h1 id="æ’æŸ¥æ­¥éª¤"><a href="#æ’æŸ¥æ­¥éª¤" class="headerlink" title="æ’æŸ¥æ­¥éª¤"></a>æ’æŸ¥æ­¥éª¤</h1><h2 id="0x00-æ’æŸ¥providerä¾§"><a href="#0x00-æ’æŸ¥providerä¾§" class="headerlink" title="0x00 æ’æŸ¥providerä¾§"></a>0x00 æ’æŸ¥providerä¾§</h2><p>ç¡®è®¤providerä¾§:</p>
<ol>
<li>æœåŠ¡æ˜¯å¦æ­£å¸¸å¯ä»¥æ‰§è¡Œ? &gt; é€šè¿‡telnet localhost, æ‰‹åŠ¨invokeç¡®å®šæ˜¯OKçš„.</li>
<li>æ¥å£ç±»&amp;æ¥å£æ–¹æ³•æ˜¯å¦æ­£å¸¸æ³¨å†Œåœ¨registryä¸Š? &gt; é€šè¿‡æŸ¥çœ‹dubbo registry, å‘ç°æ¥å£ç±»ä¸æ¥å£æ–¹æ³•æ˜¯æ­£å¸¸æ³¨å†Œçš„.</li>
</ol>
<h2 id="0x01-æ’æŸ¥consumerä¾§"><a href="#0x01-æ’æŸ¥consumerä¾§" class="headerlink" title="0x01 æ’æŸ¥consumerä¾§"></a>0x01 æ’æŸ¥consumerä¾§</h2><p>ç¡®è®¤consumerä¾§:</p>
<ol>
<li>æ˜¯å¦æ­£ç¡®ä¾èµ–åˆ°äº†provider?<ol>
<li>é€šè¿‡æŸ¥çœ‹ tcp ESTABLISHED è¿æ¥ç¡®å®šé•¿è¿æ¥å·²ç»å»ºç«‹.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122201347.png"></li>
<li>or æŸ¥çœ‹registryä¸‹å‘çš„ dubbo config æ–‡ä»¶?  â€“&gt; TODO: æš‚æ—¶æ²¡æ‰¾åˆ°, å¾…åˆ†æ.</li>
</ol>
</li>
<li>è¯·æ±‚æ˜¯å¦æ­£ç¡®è·¯ç”±åˆ°äº†providerçš„host?  &#x2F;&#x2F; ç”±äºsystemBæœ‰å¤šå¥—ç¯å¢ƒ, æ€€ç–‘æ˜¯è¯·æ±‚è·¯ç”±åˆ°äº†éç›®æ ‡ç¯å¢ƒ.<ol>
<li>åŠ¨æ€åˆ†æ: æŸ¥çœ‹ dubbo è¯·æ±‚æ—¥å¿— â€“&gt; æ²¡æ‰¾åˆ°, å¾…è¿›ä¸€æ­¥æŸ¥çœ‹.</li>
<li>é™æ€åˆ†æ: æŸ¥çœ‹ diamond é…ç½® + ç›¸å…³ä»£ç , æ˜¯ä¸æ˜¯è·¯ç”±ä»£ç æœ‰è¯¯?</li>
</ol>
</li>
</ol>
<h2 id="0x02-çœŸå®é”™è¯¯åŸå› "><a href="#0x02-çœŸå®é”™è¯¯åŸå› " class="headerlink" title="0x02 çœŸå®é”™è¯¯åŸå› "></a>0x02 çœŸå®é”™è¯¯åŸå› </h2><ul>
<li>providerä¾§ä¸consumerä¾§éƒ½æ²¡æœ‰é—®é¢˜, è·¯ç”±ä¹Ÿæ²¡æœ‰é—®é¢˜, ä½†ä¸ºå•¥ä¼šæŠ¥é”™?</li>
<li>æœ€ç»ˆåœ¨æŸä½åŒå­¦çš„æé†’ä¸‹, æŸ¥çœ‹äº†consumerä¾§çš„erroræ—¥å¿—, å‘ç°äº†è¯¦ç»†çš„é”™è¯¯å †æ ˆä¿¡æ¯å¦‚ä¸‹(åŸæ¥æ˜¯åºåˆ—åŒ–å¤±è´¥):</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122201975.png"></p>
<h2 id="0x03-åŸå› æ¢è®¨"><a href="#0x03-åŸå› æ¢è®¨" class="headerlink" title="0x03 åŸå› æ¢è®¨"></a>0x03 åŸå› æ¢è®¨</h2><h3 id="ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„"><a href="#ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„" class="headerlink" title="ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„?"></a>ä¸ºå•¥dubboè°ƒç”¨å‚æ•°å¿…é¡»è¦æ˜¯Serializableçš„?</h3><p>å› ä¸ºdubbo rpc, é»˜è®¤ä½¿ç”¨hessian2åºåˆ—åŒ–æ–¹å¼.<br><a href="https://blog.csdn.net/liyong1028826685/article/details/117308356">è€Œhessian2é’ˆå¯¹java Objectç±»å‹å‚æ•°, ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„Javaåºåˆ—åŒ–æ–¹å¼</a>.<br>è€ŒJavaåºåˆ—åŒ–åˆ™è¦æ±‚Objectå¿…é¡»<code>implements Serializable</code>æ¥å£.</p>
<h3 id="ä¸ºå•¥åœ¨æœ¬åœ°telnet-invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯"><a href="#ä¸ºå•¥åœ¨æœ¬åœ°telnet-invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯" class="headerlink" title="ä¸ºå•¥åœ¨æœ¬åœ°telnet invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯?"></a>ä¸ºå•¥åœ¨æœ¬åœ°telnet invokeçš„æ—¶å€™æ²¡æœ‰åºåˆ—åŒ–å¤±è´¥é”™è¯¯?</h3><p>å› ä¸ºåœ¨æœ¬åœ°telnet invokeçš„æ—¶å€™, é»˜è®¤ä½¿ç”¨çš„æ˜¯JSONåºåˆ—åŒ–æ–¹å¼!</p>
<h3 id="å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼"><a href="#å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼?"></a>å¦‚ä½•æŸ¥çœ‹å½“å‰æ¥å£ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼?</h3><ol>
<li>æŸ¥çœ‹registry, å¦‚æœæ²¡æœ‰æŒ‡å®š, åˆ™æ˜¯é»˜è®¤çš„hessian2:</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202268.png"></p>
<h3 id="å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼"><a href="#å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼" class="headerlink" title="å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼?"></a>å¦‚ä½•æŒ‡å®šåºåˆ—åŒ–æ–¹å¼?</h3><p><a href="https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/">https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/</a><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202940.png"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;</span>dubbo:protocol <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"dubbo-m"</span> <span class="token assign-left variable">threadpool</span><span class="token operator">=</span><span class="token string">"dubboThreadPool"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"dubbo"</span>  <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;pbs.dubbo.protocol.default.port&#125;</span>"</span>  <span class="token assign-left variable">threads</span><span class="token operator">=</span><span class="token string">"150"</span> 
<span class="token assign-left variable">serialization</span><span class="token operator">=</span><span class="token string">"json"</span> /<span class="token operator">></span>

<span class="token operator">&lt;</span>dubbo:protocol <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"dubbo-h"</span> <span class="token assign-left variable">threadpool</span><span class="token operator">=</span><span class="token string">"dubboThreadPool"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"dubbo"</span>  <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;pbs.dubbo.protocol.high.port&#125;</span>"</span>  <span class="token assign-left variable">threads</span><span class="token operator">=</span><span class="token string">"150"</span> <span class="token assign-left variable">serialization</span><span class="token operator">=</span><span class="token string">"fastjson"</span> /<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="æ”¶è·"><a href="#æ”¶è·" class="headerlink" title="æ”¶è·"></a>æ”¶è·</h1><h2 id="æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤"><a href="#æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤" class="headerlink" title="æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤"></a>æ­£ç¡®çš„é—®é¢˜æ’æŸ¥æ­¥éª¤</h2><ol>
<li>æ’æŸ¥é—®é¢˜æ—¶, ä¼˜å…ˆåœ¨æŠ¥é”™çš„host(ä¸ç”¨ç®¡æ˜¯consumer&#x2F;provider)ä¸Š, æŸ¥çœ‹errorç­‰æ›´è¯¦ç»†çš„å †æ ˆæ—¥å¿—.</li>
</ol>
<h2 id="èµ°çš„ä¸€äº›å¼¯è·¯"><a href="#èµ°çš„ä¸€äº›å¼¯è·¯" class="headerlink" title="èµ°çš„ä¸€äº›å¼¯è·¯"></a>èµ°çš„ä¸€äº›å¼¯è·¯</h2><ol>
<li>providerä¾§æ’æŸ¥æ—¶, invoke æ–¹æ³•åç§°å†™é”™, å¯¼è‡´è¯¯ä»¥ä¸ºæ˜¯provideræ²¡æœ‰æŠŠæ–°çš„æ¥å£æ–¹æ³•æš´éœ²å‡ºå». è¯¯å¯¼äº†æ’æŸ¥æ–¹å‘. å¦‚ä¸‹:</li>
</ol>
<p>æ­£ç¡®çš„: <code>invoke com.xxx.xxx.XXXQueryService.queryHistory(&quot;&quot;)</code><br>é”™è¯¯çš„: <code>invoke com.xxx.xxx.XXXQueryService.describeHistory(&quot;&quot;)</code><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202508.png"><br><a href="#dubbo%E5%A6%82%E4%BD%95%E6%9F%A5%E5%88%B0%E6%9F%90%E5%8F%B0host%E4%B8%AD%E6%9F%90%E4%B8%AA%E6%8E%A5%E5%8F%A3%E6%8F%90%E4%BE%9B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95">å¦‚ä½•å¿«é€ŸæŸ¥çœ‹æŸä¸ªhostçš„æŸä¸ªinterfaceæœ‰æ²¡æœ‰æŠŠæŸä¸ªmethodæš´éœ²å‡ºå»</a></p>
<ol start="2">
<li>consumerä¾§æ’æŸ¥æ—¶, ç”±äºsystemAçš„dubbo consoleçš„ç«¯å£ä¸systemBçš„dubbo console ç«¯å£ä¸ä¸€è‡´, ä¹ŸæŸ¥äº†åŠå¤©.<br><a href="#dubbo%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8Bconsole%E7%9A%84%E7%AB%AF%E5%8F%A3">å¦‚ä½•å¿«é€ŸæŸ¥åˆ°dubbo consoleç«¯å£å·?</a></li>
</ol>
<h2 id="Dubboæœ€ä½³å®è·µ"><a href="#Dubboæœ€ä½³å®è·µ" class="headerlink" title="Dubboæœ€ä½³å®è·µ"></a>Dubboæœ€ä½³å®è·µ</h2><h3 id="dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»"><a href="#dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»" class="headerlink" title="dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»"></a>dubboæŒ‰ç…§ç«¯å£è¿›è¡Œçº¿ç¨‹æ± éš”ç¦»</h3><h4 id="éš”ç¦»åŸç†"><a href="#éš”ç¦»åŸç†" class="headerlink" title="éš”ç¦»åŸç†"></a>éš”ç¦»åŸç†</h4><p>å•ä¸ªhostå¯ä»¥å¼€å¯å¤šä¸ªdubboç«¯å£, æ¯ä¸ªç«¯å£ç”±ç‹¬ç«‹çš„çº¿ç¨‹æ± å¤„ç†, æŠŠsvcæŒ‰ç…§ç«¯å£è¿›è¡Œåˆ†ç»„.<br>å¯ä»¥é˜²æ­¢ä½ä¼˜å…ˆçº§æ¥å£å ç”¨çº¿ç¨‹å¯¼è‡´dubboçº¿ç¨‹æ± æ»¡, ä»è€Œå½±å“é«˜ä¼˜å…ˆçº§æ¥å£.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122202434.png"></p>
<h4 id="éš”ç¦»é…ç½®æ ·ä¾‹"><a href="#éš”ç¦»é…ç½®æ ·ä¾‹" class="headerlink" title="éš”ç¦»é…ç½®æ ·ä¾‹"></a>éš”ç¦»é…ç½®æ ·ä¾‹</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>coreRegistry<span class="token punctuation">"</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.dubbo.registry.address&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token comment">&lt;!-- æ ¸å¿ƒæ¥å£ --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-core<span class="token punctuation">"</span></span> <span class="token attr-name">threadpool</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubboThreadPool<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo<span class="token punctuation">"</span></span>  <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.dubbo.protocol.core.port&#125;<span class="token punctuation">"</span></span>  <span class="token attr-name">threads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token comment">&lt;!-- ä¸­ä¼˜å…ˆçº§æ¥å£çº¿ç¨‹æ± (é»˜è®¤ï¼Œä¸ºäº†æœ€å¤§ä¿æŒå…¼å®¹) --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-m<span class="token punctuation">"</span></span> <span class="token attr-name">threadpool</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubboThreadPool<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo<span class="token punctuation">"</span></span>  <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.dubbo.protocol.default.port&#125;<span class="token punctuation">"</span></span>  <span class="token attr-name">threads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>150<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token comment">&lt;!-- é»˜è®¤providerä½¿ç”¨dubbo-m,http-dubboåè®® --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>provider</span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-m<span class="token punctuation">"</span></span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-sentinel.dubbo.provider.filter<span class="token punctuation">"</span></span> <span class="token attr-name">delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment">&lt;!-- ä½¿ç”¨dubbo-core --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxx.TestService<span class="token punctuation">"</span></span>
<span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-core<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.service.version&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>testService<span class="token punctuation">"</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token comment">&lt;!-- ä½¿ç”¨dubbo-core --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxx.SampleService<span class="token punctuation">"</span></span>
<span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo-core<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pbs.service.version&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sampleService<span class="token punctuation">"</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™"><a href="#dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™" class="headerlink" title="dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™"></a>dubboé»˜è®¤ç«¯å£å·é…ç½®åŸåˆ™</h3><p>å¦‚ä¸Š, <code>pbs.dubbo.protocol.default.port=-1</code>é…ç½®é¡¹, æŒ‰ç…§dubboæ–‡æ¡£è¯´æ˜, åº”è¯¥æ˜¯éšæœºåˆ†é…ä¸€ä¸ªç«¯å£. ä½†å‘ç°systemBå®é™…å¯åŠ¨å, å´å¼€å¯äº† 20880 ç«¯å£. è¿™æ˜¯ä¸ºå•¥?</p>
<h4 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h4><p>æ ¹æ® <a href="https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/">https://dubbo.apache.org/zh/docs/references/xml/dubbo-protocol/</a>  æ–‡æ¡£è¯´æ˜,  <code>åˆ†é…çš„ç«¯å£åœ¨åè®®ç¼ºçœç«¯å£çš„åŸºç¡€ä¸Šå¢é•¿</code><br>ä½†å®é™…è¯­ç„‰ä¸è¯¦, dubboåè®®é»˜è®¤ç«¯å£æ˜¯20880,  é‚£ä¹ˆå¦‚æœé…ç½® <code>port=-1</code>, åˆ™ç«¯å£æ˜¯ <code>20880</code> or <code>20881</code>??</p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203219.png"></p>
<h4 id="æºä»£ç åˆ†æ"><a href="#æºä»£ç åˆ†æ" class="headerlink" title="æºä»£ç åˆ†æ"></a>æºä»£ç åˆ†æ</h4><p>æ ¸å¿ƒä»£ç : <code>com.alibaba.dubbo.config.ServiceConfig#doExportUrlsFor1Protocol</code>, å¯ä»¥å¾—çŸ¥æ˜¯ä» 20880 å¼€å§‹(åŒ…æ‹¬20880).<br>è¿™ä¹Ÿå°±è§£é‡Šäº†, ä¸ºå•¥ <code>pbs.dubbo.protocol.default.port=-1</code>é…ç½®é¡¹, å®é™…å¯¹åº”çš„å¼€å¯ç«¯å£å·æ˜¯ 20880 å•¦.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203404.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203097.png"></p>
<h3 id="dubboå¤šç«¯å£telnetåŸåˆ™"><a href="#dubboå¤šç«¯å£telnetåŸåˆ™" class="headerlink" title="dubboå¤šç«¯å£telnetåŸåˆ™"></a>dubboå¤šç«¯å£telnetåŸåˆ™</h3><p>å¦‚ä¸Š, æš´éœ²äº† 20880~20884 5ä¸ªç«¯å£, ç”¨äºçº¿ç¨‹æ± éš”ç¦».<br>å®é™…:</p>
<ol>
<li>æ¯ä¸ªç«¯å£, éƒ½æ˜¯å¯åŠ¨äº†ä¸€ä¸ªNettyServer<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122203903.png"></li>
<li>å› æ­¤æ¯ä¸ªç«¯å£, éƒ½å¯ä»¥telnetä¸Šå».</li>
<li>telnetæ¯ä¸ªç«¯å£æ‰§è¡Œ ls åˆ—ä¸¾å‡ºæ¥æœ¬æœºæš´éœ²çš„dubboæœåŠ¡éƒ½æ˜¯ä¸€æ ·çš„(ä¼šæŠŠæ‰€æœ‰å…¶ä»–ç«¯å£æš´éœ²çš„æœåŠ¡ä¹Ÿéƒ½æšä¸¾å‡ºæ¥). ä¸ä¼šå› ä¸ºtelnet 20880, å°±åªåˆ—ä¸¾å‡ºæš´éœ²åœ¨20880ç«¯å£çš„æœåŠ¡. å‚è§: <code>com.alibaba.dubbo.rpc.protocol.dubbo.telnet.ListTelnetHandler</code><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122204305.png"></li>
</ol>
<h3 id="dubboç‰ˆæœ¬å·éš”ç¦»"><a href="#dubboç‰ˆæœ¬å·éš”ç¦»" class="headerlink" title="dubboç‰ˆæœ¬å·éš”ç¦»"></a>dubboç‰ˆæœ¬å·éš”ç¦»</h3><p>ç”¨æ¥åŒºåˆ†å¤šå¥—é¢„å‘ç¯å¢ƒ.<br>ä½†å®é™…çœ‹äº†ä¸‹, å¤šå¥—é¢„å‘ç¯å¢ƒproviderçš„ç‰ˆæœ¬å·éƒ½æ˜¯1.0.0, è€Œä¸æ˜¯é€šè¿‡ç‰ˆæœ¬å·æ¥è¿›è¡Œéš”ç¦»çš„. é‚£ä¹ˆconsumerå®é™…æ€ä¹ˆåšçš„è·¯ç”±?<br>&#x2F;&#x2F; TODO:  æ ¸å¿ƒä»£ç é™„å½•<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122204657.png"></p>
<h3 id="dubboåºåˆ—åŒ–"><a href="#dubboåºåˆ—åŒ–" class="headerlink" title="dubboåºåˆ—åŒ–"></a>dubboåºåˆ—åŒ–</h3><ul>
<li>ä½¿ç”¨consoleæ‰‹åŠ¨invoke, ç”¨çš„æ˜¯jsonåºåˆ—åŒ–.</li>
<li>è€ŒconsumerçœŸæ­£è°ƒç”¨æ—¶ç”¨çš„æ˜¯hessian2åºåˆ—åŒ–, å› æ­¤é’ˆå¯¹è¿™ç§åºåˆ—åŒ–å·®å¼‚å¯¼è‡´çš„é”™è¯¯é—®é¢˜, æ˜¯æ— æ³•éªŒè¯åˆ°çš„. éœ€è¦ç¼–ç æµ‹è¯•çš„æ—¶å€™æ³¨æ„.</li>
</ul>
<h3 id="dubbo-ls-x2F-invoke"><a href="#dubbo-ls-x2F-invoke" class="headerlink" title="dubbo ls&#x2F;invoke"></a>dubbo ls&#x2F;invoke</h3><p>å¦‚ä½•æŸ¥çœ‹å½“å‰hostä¸‹ä¾èµ–çš„æ‰€æœ‰dubboæœåŠ¡?</p>
<ol>
<li>é€šè¿‡telnet localhost xxxx è¿›å…¥dubboç®¡æ§é¡µé¢, æ‰§è¡Œ <code>ls</code>å‘½ä»¤, åªèƒ½åˆ—å‡ºè‡ªèº«ä½œä¸ºproviderå¯¹å¤–æš´éœ²çš„æ‰€æœ‰æœåŠ¡.</li>
<li>è€Œæ— æ³•åˆ—å‡ºè‡ªèº«hostä½œä¸ºconsumerä¾èµ–åˆ°çš„æ‰€æœ‰æœåŠ¡.  &#x2F;&#x2F; æŸ¥çœ‹äº†dubboæ–‡æ¡£, ç›®å‰æ²¡æœ‰åŠæ³•é€šè¿‡telnetæŸ¥çœ‹åˆ°.</li>
</ol>
<h3 id="dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•"><a href="#dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•" class="headerlink" title="dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•"></a>dubboå¦‚ä½•æŸ¥åˆ°æŸå°hostä¸­æŸä¸ªæ¥å£æä¾›çš„æ‰€æœ‰æ–¹æ³•</h3><h4 id="æ–¹æ¡ˆ1-telnetæŸ¥çœ‹"><a href="#æ–¹æ¡ˆ1-telnetæŸ¥çœ‹" class="headerlink" title="æ–¹æ¡ˆ1 telnetæŸ¥çœ‹"></a>æ–¹æ¡ˆ1 telnetæŸ¥çœ‹</h4><p><code>ls -l com.xxx.SampleService</code><br>telnet localhost  20880  telnet localhost  20881 telnet localhost  20882 éƒ½èƒ½ç™»ä¸Šå», å®é™…æ–¹æ³•åˆ—è¡¨ä¹Ÿç›¸åŒ.  å‚è§: <a href="#th8th">dubboå¤šç«¯å£telnetåŸåˆ™</a></p>
<h4 id="æ–¹æ¡ˆ2-registryæŸ¥çœ‹"><a href="#æ–¹æ¡ˆ2-registryæŸ¥çœ‹" class="headerlink" title="æ–¹æ¡ˆ2 registryæŸ¥çœ‹"></a>æ–¹æ¡ˆ2 registryæŸ¥çœ‹</h4><p>åœ¨registryä¸­æŸ¥è¯¢æ¥å£, é€‰å®šhostæŸ¥çœ‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122206622.png"></p>
<h3 id="dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£"><a href="#dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£" class="headerlink" title="dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£"></a>dubboå¦‚ä½•æŸ¥çœ‹consoleçš„ç«¯å£</h3><h4 id="æ–¹æ¡ˆ1-é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#æ–¹æ¡ˆ1-é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="æ–¹æ¡ˆ1: é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶"></a>æ–¹æ¡ˆ1: é€šè¿‡æŸ¥çœ‹åº”ç”¨é…ç½®æ–‡ä»¶</h4><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122207808.png"></p>
<blockquote>
<p>è¿™ç§æ–¹å¼æœ€ç›´æ¥, ä¹Ÿæœ€æœ‰æ•ˆ. ç¼ºç‚¹æ˜¯ç´§æ€¥æ’æŸ¥é—®é¢˜æ—¶, å¦‚æœé…ç½®é¡¹ç»è¿‡äº†ä¸€å±‚æœ‰ä¸€å±‚çš„è‡ªåŠ¨æ›¿æ¢, ä¸ä¸€å®šèƒ½å¾ˆå¿«æ‰¾å‡ºå®é™…é…ç½®å€¼æ˜¯å•¥.</p>
</blockquote>
<h4 id="æ–¹æ¡ˆ2-é€šè¿‡æŸ¥çœ‹TCPè¿æ¥"><a href="#æ–¹æ¡ˆ2-é€šè¿‡æŸ¥çœ‹TCPè¿æ¥" class="headerlink" title="æ–¹æ¡ˆ2: é€šè¿‡æŸ¥çœ‹TCPè¿æ¥"></a>æ–¹æ¡ˆ2: é€šè¿‡æŸ¥çœ‹TCPè¿æ¥</h4><ol>
<li><p>æŸ¥çœ‹è¿›ç¨‹å·PID(æ³¨æ„çœ‹æ¸…æ¥šè¿›ç¨‹çš„USERæ˜¯ä¸æ˜¯å½“å‰ç”¨æˆ·)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;appName&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹è¿›ç¨‹å ç”¨çš„TCPåœ¨ListençŠ¶æ€çš„ç«¯å£(å¦‚æœä¸Šä¸€æ­¥è·å–åˆ°çš„PIDä¸æ˜¯å½“å‰ç”¨æˆ·çš„, åˆ™éœ€è¦suåˆ°PIDå¯¹åº”çš„ç”¨æˆ·, æˆ–è€…å¦‚ä¸‹ç”¨sudo)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">lsof</span> -i -P<span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token variable">$&#123;PID&#125;</span> <span class="token operator">|</span> <span class="token function">fgrep</span> LISTEN<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>çœ‹åˆ°å¦‚ä¸‹, ä¸€èˆ¬dubboç«¯å£å·æ˜¯ä»20880å¼€å§‹çš„(åŒ…æ‹¬20880)</p>
</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122207567.png"></p>
<p>ä½†å¦‚æœåº”ç”¨é…ç½®çš„dubboç«¯å£å¾ˆå¥‡æ€ª, ä¸ç¬¦åˆæƒ¯ä¾‹, é‚£è¿™é‡Œå°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªç«¯å£æ¥telnetè¯•è¯•äº†.</p>
<blockquote>
<p>è¿™ç§æ–¹å¼ä¸ç®—éå¸¸ç›´æ¥, ä½†ä¼˜ç‚¹æ˜¯å¯ä»¥ä¸ç”¨å»ç¿»æ‰¾ä»£ç , ç¿»æ‰¾é…ç½®é¡¹. åœ¨ç«¯å£æ•°å¾ˆå°‘çš„æƒ…å†µä¸‹, ç®€å•æœ‰æ•ˆ.</p>
</blockquote>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Dubbo%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%AE%9E%E6%88%98-%E5%AE%8C/16%20%20Dubbo%20Serialize%20%E5%B1%82%EF%BC%9A%E5%A4%9A%E7%A7%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AE%97%E6%B3%95%EF%BC%8C%E6%80%BB%E6%9C%89%E4%B8%80%E6%AC%BE%E9%80%82%E5%90%88%E4%BD%A0.md">Dubbo Serialize å±‚ï¼šå¤šç§åºåˆ—åŒ–ç®—æ³•ï¼Œæ€»æœ‰ä¸€æ¬¾é€‚åˆä½ </a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„Linuxå‘½ä»¤ä¹‹ç½‘ç»œç›¸å…³å‘½ä»¤</title>
    <url>//2022-06-25-linux-network-scripts/</url>
    <content><![CDATA[<h1 id="ARPåè®®"><a href="#ARPåè®®" class="headerlink" title="ARPåè®®"></a>ARPåè®®</h1><h2 id="æŸ¥çœ‹ARPç¼“å­˜è¡¨"><a href="#æŸ¥çœ‹ARPç¼“å­˜è¡¨" class="headerlink" title="æŸ¥çœ‹ARPç¼“å­˜è¡¨"></a>æŸ¥çœ‹ARPç¼“å­˜è¡¨</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/nat$ arp -v
Address                  HWtype  HWaddress           Flags Mask            Iface
_gateway                 ether   c0:b4:7d:69:d6:c3   C                     wlp4s0
<span class="token number">172.17</span>.0.3               ether   02:42:ac:11:00:03   C                     docker0
<span class="token number">192.168</span>.3.2              ether   00:11:32:b2:b7:04   C                     wlp4s0
<span class="token number">172.17</span>.0.2               ether   02:42:ac:11:00:02   C                     docker0
Entries: <span class="token number">4</span>	Skipped: <span class="token number">0</span>	Found: <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜"><a href="#æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜" class="headerlink" title="æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜"></a>æŸ¥çœ‹æŸä¸ªç½‘å¡çš„arpç¼“å­˜</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/nat$ arp -i wlp4s0
Address                  HWtype  HWaddress           Flags Mask            Iface
_gateway                 ether   c0:b4:7d:69:d6:c3   C                     wlp4s0
<span class="token number">192.168</span>.3.2              ether   00:11:32:b2:b7:04   C                     wlp4s0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å‚æ•°è¯¦è§£"><a href="#å‚æ•°è¯¦è§£" class="headerlink" title="å‚æ•°è¯¦è§£"></a>å‚æ•°è¯¦è§£</h2><ul>
<li>flags:<ul>
<li>C: complete, each complete entry in the ARP cache will be marked with the C flag.</li>
<li>M: æ‰‹åŠ¨å¢åŠ çš„ï¼ŒPermanent entries are marked  with  M</li>
<li>P: TODO: ä¸å¤ªæ˜ç™½å…·ä½“å•¥æ„æ€ï¼Œpublished entries have the P flag.</li>
</ul>
</li>
</ul>
<h1 id="ç½‘æ¡¥"><a href="#ç½‘æ¡¥" class="headerlink" title="ç½‘æ¡¥"></a>ç½‘æ¡¥</h1><h2 id="æŸ¥çœ‹ç½‘æ¡¥"><a href="#æŸ¥çœ‹ç½‘æ¡¥" class="headerlink" title="æŸ¥çœ‹ç½‘æ¡¥"></a>æŸ¥çœ‹ç½‘æ¡¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ brctl show
bridge name	bridge <span class="token function">id</span>		STP enabled	interfaces
docker0		<span class="token number">8000</span>.0242cee53ddd	no		veth9aec769
							            vethe466b6b
virbr0		<span class="token number">8000</span>.525400245c90	<span class="token function">yes</span>		virbr0-nic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æŸ¥çœ‹veth-pair"><a href="#æŸ¥çœ‹veth-pair" class="headerlink" title="æŸ¥çœ‹veth pair"></a>æŸ¥çœ‹veth pair</h2><p>å¦‚ä¸Šï¼Œå‘ç°<code>veth9aec769</code>ä¸<code>vethe466b6b</code>éƒ½æŒ‚åœ¨<code>docker0</code>ç½‘æ¡¥ä¸‹ã€‚<br>è¿™ä¸¤ä¸ªvethè®¾å¤‡éƒ½æ˜¯åœ¨hostä¸Šçš„ï¼Œé‚£ä¹ˆä¸¤ä¸ªvethè®¾å¤‡å¯¹åº”çš„pairï¼ˆåˆ†åˆ«åœ¨2ä¸ªdockerå®¹å™¨ä¸­ï¼‰åˆ†åˆ«æ˜¯å•¥ï¼Ÿ</p>
<ol>
<li>æŸ¥çœ‹hostä¸Švethè®¾å¤‡å¯¹åº”çš„dockerå®¹å™¨å†…vethè®¾å¤‡çš„ç¼–å·ï¼ˆå¦‚ä¸‹åˆ†åˆ«æ˜¯if23,if24ï¼‰</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">ip</span> a <span class="token operator">|</span> <span class="token function">fgrep</span> veth9aec769
<span class="token number">24</span>: veth9aec769@if23: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 

davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">ip</span> a <span class="token operator">|</span> <span class="token function">fgrep</span> vethe466b6b
<span class="token number">22</span>: vethe466b6b@if21: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>ç™»å½•dockerå®¹å™¨ä¸­æŸ¥çœ‹vethè®¾å¤‡ç¼–å·</li>
</ol>
<p>å¦‚ä¸‹å¯çŸ¥ï¼š</p>
<ul>
<li>d3f6cb3a496e å®¹å™¨çš„vethç¼–å·æ˜¯21ï¼Œä¸hostä¸Šif22ï¼Œå³vethe466b6bç»‘å®š</li>
<li>333a28ae8ea1 å®¹å™¨çš„vethç¼–å·æ˜¯23ï¼Œä¸hostä¸Šif24ï¼Œå³veth9aec769ç»‘å®š</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/docker$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it d3f6cb3a496e /bin/sh -c <span class="token string">"ip a"</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">21</span>: eth0@if22: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.3/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
       
davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/docker$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 333a28ae8ea1 /bin/sh -c <span class="token string">"ip a"</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">23</span>: eth0@if24: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="CAMè¡¨ï¼ˆMAC-Learning-Tableï¼‰"><a href="#CAMè¡¨ï¼ˆMAC-Learning-Tableï¼‰" class="headerlink" title="CAMè¡¨ï¼ˆMAC Learning Tableï¼‰"></a>CAMè¡¨ï¼ˆMAC Learning Tableï¼‰</h1><p><a href="https://www.xmodulo.com/show-mac-learning-table-linux-bridge.html">How to show a MAC learning table of Linux bridge</a><br>å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°docker0ç½‘æ¡¥ï¼ˆè™šæ‹Ÿäº¤æ¢æœºï¼‰çš„CAMè¡¨ï¼Œå³mac addrå¯¹åº”çš„port no</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ brctl showmacs docker0
port no	mac addr		is local?	ageing timer
  <span class="token number">1</span>	<span class="token number">22</span>:2f:64:b8:78:af	<span class="token function">yes</span>		   <span class="token number">0.00</span>
  <span class="token number">1</span>	<span class="token number">22</span>:2f:64:b8:78:af	<span class="token function">yes</span>		   <span class="token number">0.00</span>
  <span class="token number">2</span>	<span class="token number">46</span>:de:b9:ed:19:0f	<span class="token function">yes</span>		   <span class="token number">0.00</span>
  <span class="token number">2</span>	<span class="token number">46</span>:de:b9:ed:19:0f	<span class="token function">yes</span>		   <span class="token number">0.00</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h1><h2 id="æŸ¥çœ‹è·¯ç”±è¡¨"><a href="#æŸ¥çœ‹è·¯ç”±è¡¨" class="headerlink" title="æŸ¥çœ‹è·¯ç”±è¡¨"></a>æŸ¥çœ‹è·¯ç”±è¡¨</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/ $ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         <span class="token number">172.17</span>.0.1      <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0
<span class="token number">172.17</span>.0.0      *               <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>è¿™æ˜¯dockerå®¹å™¨å†…éƒ¨çš„è·¯ç”±è¡¨ï¼š</li>
<li>ç¬¬äºŒæ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€172.17.0.0&#x2F;16çš„IPåŒ…ï¼Œéƒ½è¦é€šè¿‡eth0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;eth0ï¼‰ï¼Œä¸ç»è¿‡ç½‘å…³ï¼ˆGateway&#x3D;*ï¼‰,ç›´æ¥é€šè¿‡äºŒå±‚ç½‘ç»œå‘é€è¿‡å»ã€‚</li>
<li>ç¬¬ä¸€æ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€å…¶ä»–åœ°å€çš„IPåŒ…ï¼Œéƒ½è¦é€šè¿‡eth0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;eth0ï¼‰ï¼Œè¦å…ˆå‘ç»™ç½‘å…³172.17.0.1ï¼ˆGateway&#x3D;172.17.0.1ï¼‰</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">192.168</span>.3.1     <span class="token number">0.0</span>.0.0         UG    <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0
<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> docker0
<span class="token number">192.168</span>.3.0     <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U     <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>è¿™æ˜¯Hostçš„è·¯ç”±è¡¨ï¼š</li>
<li>ç¬¬äºŒæ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€172.17.0.0&#x2F;16çš„IPåŒ…ï¼Œéƒ½è¦ä»docker0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;docker0ï¼‰ï¼Œä¸ç»è¿‡ç½‘å…³ï¼ˆGateway&#x3D;0.0.0.0ï¼‰ï¼Œç›´æ¥é€šè¿‡äºŒå±‚ç½‘ç»œå‘é€è¿‡å»</li>
<li>ç¬¬ä¸‰æ¡è·¯ç”±è§„åˆ™ï¼šä»è¯¥ä¸»æœºï¼Œå‘å¾€192.168.3.0&#x2F;24çš„IPåŒ…ï¼Œéƒ½è¦ä»wlp4s0ç½‘å¡å‘å‡ºï¼ˆIface&#x3D;wlp4s0ï¼‰ï¼Œä¸ç»è¿‡ç½‘å…³ï¼ˆGateway&#x3D;0.0.0.0ï¼‰ï¼Œç›´æ¥é€šè¿‡äºŒå±‚ç½‘ç»œå‘é€è¿‡å»</li>
</ul>
<p>å› æ­¤ï¼š</p>
<ul>
<li>ä»ä¸»æœº <code>ping 172.17.0.2</code> å®¹å™¨ï¼Œå®é™…æ˜¯è¿›å…¥äº†docker0ç½‘æ¡¥ï¼Œå› æ­¤èƒ½pingé€šå®¹å™¨</li>
<li>ä»ä¸»æœº <code>ping 192.168.3.2</code> å³è¯¥ä¸»æœºå±€åŸŸç½‘å†…å…¶ä»–ä¸»æœºï¼Œå®é™…æ˜¯ä»wlp4s0ç½‘å¡ï¼ˆç‰©ç†ç½‘å¡ï¼‰å‡ºå»ã€‚</li>
</ul>
<h1 id="NAT-x2F-iptables"><a href="#NAT-x2F-iptables" class="headerlink" title="NAT&#x2F;iptables"></a>NAT&#x2F;iptables</h1><h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><h2 id="DNSç¼“å­˜"><a href="#DNSç¼“å­˜" class="headerlink" title="DNSç¼“å­˜"></a>DNSç¼“å­˜</h2><h3 id="Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"><a href="#Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜" class="headerlink" title="Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"></a>Linuxä¸ŠæŸ¥çœ‹DNSç¼“å­˜</h3><h4 id="2016å¹´å‰"><a href="#2016å¹´å‰" class="headerlink" title="2016å¹´å‰"></a>2016å¹´å‰</h4><p><a href="https://unix.stackexchange.com/questions/28553/how-to-read-the-local-dns-cache-contents">By 2016, Prior to systemd, there was almost no OS-level DNS caching</a><br>unless nscd or dnsmasq was installed and running.<br>Even then, the DNS caching feature of nscd is disabled by default at least in Debian because itâ€™s broken.<br><a href="https://stackoverflow.com/questions/11020027/dns-caching-in-linux">The practical upshot is that your linux system very very probably does not do any OS-level DNS caching.</a></p>
<blockquote>
<p>If an end user using your software needs to have DNS caching </br><br>because the DNS query load is large enough to be a problem or the RTT to the external DNS server is long enough to be a problem, </br><br>they can install a caching DNS server such as Unbound on the same machine as your application,<br>configured to cache responses and forward misses to the regular DNS resolvers.</p>
</blockquote>
<h4 id="2016å¹´å"><a href="#2016å¹´å" class="headerlink" title="2016å¹´å"></a>2016å¹´å</h4><p><a href="https://www.freedesktop.org/software/systemd/man/systemd-resolved.service.html">After 2016, nowadays on systemd thereâ€™s a service to cache DNS, it could be enabled with systemctl enable systemd-resolved</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">service</span> systemd-resolved status
systemd-resolved.service - Network Name Resolution
     Loaded: loaded <span class="token punctuation">(</span>/lib/systemd/system/systemd-resolved.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
     Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Sun <span class="token number">2022</span>-05-08 <span class="token number">16</span>:04:20 CST<span class="token punctuation">;</span> <span class="token number">1</span> months <span class="token number">18</span> days ago
       Docs: man:systemd-resolved.service<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
             https://www.freedesktop.org/wiki/Software/systemd/resolved
             https://www.freedesktop.org/wiki/Software/systemd/writing-network-configuration-managers
             https://www.freedesktop.org/wiki/Software/systemd/writing-resolver-clients
   Main PID: <span class="token number">603</span> <span class="token punctuation">(</span>systemd-resolve<span class="token punctuation">)</span>
     Status: <span class="token string">"Processing requests..."</span>
      Tasks: <span class="token number">1</span> <span class="token punctuation">(</span>limit: <span class="token number">9305</span><span class="token punctuation">)</span>
     Memory: <span class="token number">2</span>.6M
     CGroup: /system.slice/systemd-resolved.service
             â””â”€603 /lib/systemd/systemd-resolved<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">cat</span> /etc/resolv.conf
nameserver <span class="token number">127.0</span>.0.53
options edns0 trust-ad<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ resolvectl status
Link <span class="token number">3</span> <span class="token punctuation">(</span>wlp4s0<span class="token punctuation">)</span>
      Current Scopes: DNS        
DefaultRoute setting: <span class="token function">yes</span>        
       LLMNR setting: <span class="token function">yes</span>        
MulticastDNS setting: no         
  DNSOverTLS setting: no         
      DNSSEC setting: no         
    DNSSEC supported: no         
  Current DNS Server: <span class="token number">192.168</span>.3.1
         DNS Servers: <span class="token number">192.168</span>.3.1
          DNS Domain: ~.         
Link <span class="token number">6</span> <span class="token punctuation">(</span>docker0<span class="token punctuation">)</span>
      Current Scopes: none
DefaultRoute setting: no  
       LLMNR setting: <span class="token function">yes</span> 
MulticastDNS setting: no  
  DNSOverTLS setting: no  
      DNSSEC setting: no  
    DNSSEC supported: no  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜"><a href="#Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜" class="headerlink" title="Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜"></a>Chromeä¸ŠæŸ¥çœ‹DNSç¼“å­˜</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chrome://net-internals/<span class="token comment">#dnschrome</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"><a href="#Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜" class="headerlink" title="Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜"></a>Firefoxä¸ŠæŸ¥çœ‹DNSç¼“å­˜</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">about:networking<span class="token comment">#dns</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="DNSåŸŸåè§£ææ’æŸ¥"><a href="#DNSåŸŸåè§£ææ’æŸ¥" class="headerlink" title="DNSåŸŸåè§£ææ’æŸ¥"></a>DNSåŸŸåè§£ææ’æŸ¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:/etc/systemd$ <span class="token function">dig</span> baidu.com
davywalker@davywalker-ThinkPad-X1-Carbon-4th:/etc/systemd$ <span class="token function">dig</span> baidu.com +trace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h1 id="æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯"><a href="#æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯"></a>æŸ¥çœ‹åˆ°æŸä¸ªIPçš„è·¯ç”±ä¿¡æ¯</h1><p>åœ¨Linux&amp;MacOSä¸Šï¼Œtracerouteå‘½ä»¤é»˜è®¤ä½¿ç”¨UDPï¼Œè€ŒWindowsé»˜è®¤ä½¿ç”¨ICMPåè®®ã€‚ä½†å¯ä»¥ä½¿ç”¨<code>traceroute -I</code>æ¥å¼ºåˆ¶ä½¿ç”¨ICMPåè®®ã€‚<br><a href="https://serverfault.com/questions/374620/does-traceroute-use-udp-or-icmp-or-both">By default Windows tracert uses ICMP and both Mac OS X and Linux traceroute use UDP.</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">traceroute</span> <span class="token number">220.181</span>.38.148
<span class="token function">traceroute</span> to <span class="token number">220.181</span>.38.148 <span class="token punctuation">(</span><span class="token number">220.181</span>.38.148<span class="token punctuation">)</span>, <span class="token number">30</span> hops max, <span class="token number">60</span> byte packets
 <span class="token number">1</span>  _gateway <span class="token punctuation">(</span><span class="token number">192.168</span>.3.1<span class="token punctuation">)</span>  <span class="token number">3.140</span> ms  <span class="token number">3.401</span> ms  <span class="token number">5.204</span> ms
 <span class="token number">2</span>  <span class="token number">122.233</span>.112.1 <span class="token punctuation">(</span><span class="token number">122.233</span>.112.1<span class="token punctuation">)</span>  <span class="token number">8.077</span> ms  <span class="token number">8.005</span> ms  <span class="token number">8.613</span> ms
 <span class="token number">3</span>  <span class="token number">61.164</span>.3.50 <span class="token punctuation">(</span><span class="token number">61.164</span>.3.50<span class="token punctuation">)</span>  <span class="token number">8.474</span> ms <span class="token number">61.164</span>.2.2 <span class="token punctuation">(</span><span class="token number">61.164</span>.2.2<span class="token punctuation">)</span>  <span class="token number">8.331</span> ms  <span class="token number">9.131</span> ms
<span class="token number">30</span>  * * *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>ä½¿ç”¨ICMPåè®®è¿›è¡Œtraceroute</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads$ <span class="token function">traceroute</span> -I <span class="token number">220.181</span>.38.148
<span class="token function">traceroute</span> to <span class="token number">220.181</span>.38.148 <span class="token punctuation">(</span><span class="token number">220.181</span>.38.148<span class="token punctuation">)</span>, <span class="token number">30</span> hops max, <span class="token number">60</span> byte packets
 <span class="token number">1</span>  _gateway <span class="token punctuation">(</span><span class="token number">192.168</span>.3.1<span class="token punctuation">)</span>  <span class="token number">3.348</span> ms  <span class="token number">3.300</span> ms  <span class="token number">3.604</span> ms
 <span class="token number">2</span>  <span class="token number">122.233</span>.112.1 <span class="token punctuation">(</span><span class="token number">122.233</span>.112.1<span class="token punctuation">)</span>  <span class="token number">46.031</span> ms  <span class="token number">46.236</span> ms  <span class="token number">46.274</span> ms
 <span class="token number">3</span>  <span class="token number">61.164</span>.3.50 <span class="token punctuation">(</span><span class="token number">61.164</span>.3.50<span class="token punctuation">)</span>  <span class="token number">8.196</span> ms  <span class="token number">9.610</span> ms  <span class="token number">9.522</span> ms
 <span class="token number">4</span>  * <span class="token number">115.233</span>.18.13 <span class="token punctuation">(</span><span class="token number">115.233</span>.18.13<span class="token punctuation">)</span>  <span class="token number">10.761</span> ms *
 <span class="token number">5</span>  <span class="token number">202.97</span>.102.201 <span class="token punctuation">(</span><span class="token number">202.97</span>.102.201<span class="token punctuation">)</span>  <span class="token number">40.430</span> ms  <span class="token number">40.413</span> ms  <span class="token number">40.431</span> ms
 <span class="token number">6</span>  <span class="token number">36.110</span>.245.66 <span class="token punctuation">(</span><span class="token number">36.110</span>.245.66<span class="token punctuation">)</span>  <span class="token number">35.611</span> ms *  <span class="token number">34.008</span> ms
 <span class="token number">7</span>  * * *
 <span class="token number">8</span>  <span class="token number">220.181</span>.182.30 <span class="token punctuation">(</span><span class="token number">220.181</span>.182.30<span class="token punctuation">)</span>  <span class="token number">41.642</span> ms  <span class="token number">41.785</span> ms  <span class="token number">37.416</span> ms
 <span class="token number">9</span>  * * *
<span class="token number">10</span>  * * *
<span class="token number">11</span>  * * *
<span class="token number">12</span>  <span class="token number">220.181</span>.38.148 <span class="token punctuation">(</span><span class="token number">220.181</span>.38.148<span class="token punctuation">)</span>  <span class="token number">40.385</span> ms  <span class="token number">40.757</span> ms  <span class="token number">40.478</span> ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ"><a href="#è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ" class="headerlink" title="è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ"></a>è·¯ç”±å™¨ä¸Šï¼Œå¤šä¸ªç½‘å¡ï¼Œè¯·æ±‚åˆ°æŸä¸ªç½‘å¡ä¹‹åï¼Œæ˜¯å¦‚ä½•è½¬å‘åˆ°å…¶ä»–ç½‘å¡çš„ï¼Ÿ</h2><p>ä¾‹å¦‚ï¼š<br>dockerå®¹å™¨å†…éƒ¨ 172.17.0.2ï¼Œè®¿é—®hostçš„ip (192.168.3.80)</p>
<ol>
<li><p>dockerå®¹å™¨å†…éƒ¨æœ‰ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œédockerå®¹å™¨ç½‘æ®µï¼Œéƒ½åˆ°docker0ç½‘æ¡¥ä¸Šï¼Œdocker0ç½‘æ¡¥IP 172.17.0.1</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         <span class="token number">172.17</span>.0.1      <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>è¯·æ±‚åˆ°docker0ç½‘æ¡¥ 172.17.0.1 ä¹‹åï¼Œï¼ˆdocker0ç½‘æ¡¥æœ¬èº«å°±åœ¨Hostä¸Šï¼‰ï¼ŒæŸ¥çœ‹è·¯ç”±è¡¨ï¼Œä» wlp4s0 ç½‘å¡å‘å‡ºï¼ˆè¿™é‡Œå…·ä½“æ€ä¹ˆå‘å‡ºçš„ï¼Ÿï¼‰</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:/etc/systemd$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">192.168</span>.3.1     <span class="token number">0.0</span>.0.0         UG    <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0
<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> docker0
<span class="token number">192.168</span>.3.0     <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U     <span class="token number">600</span>    <span class="token number">0</span>        <span class="token number">0</span> wlp4s0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="centos-7-å¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€-å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨"><a href="#centos-7-å¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€-å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨" class="headerlink" title="centos 7 å¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€, å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨"></a>centos 7 å¦‚ä½•æŸ¥çœ‹ç½‘å¡çŠ¶æ€, å¹¶å°†æŸä¸ªç½‘å¡è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨</h2><p>ä½¿ç”¨<code>VMware Fusion</code>å®‰è£…å¥½äº†<code>CentOS 7</code>è™šæ‹Ÿæœºä¹‹å, å‘ç°ç½‘ç»œæ€ä¹ˆéƒ½ä¸é€š.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ping</span> baidu.com
ping: baidu.com: Name or <span class="token function">service</span> not known

$ <span class="token function">curl</span> baidu.com
curl: Could not resolve host: baidu.com<span class="token punctuation">;</span> Unknown error<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ’æŸ¥: </p>
<ol>
<li>æŸ¥çœ‹ç½‘å¡è¿æ¥çŠ¶æ€, å‘ç°ä»¥å¤ªç½‘å¡<code>ens33</code>ä¸ºæœªè¿æ¥<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> nmcli d
DEVICE  TYPE      STATE         CONNECTION
ens33   ethernet  disconnected  --
lo      lookback  unmanaged     --<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>ä¿®æ”¹ç½‘å¡çŠ¶æ€<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33
-- <span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>no
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li>é‡å¯ç½‘ç»œæœåŠ¡<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> /etc/init.d/network restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>éªŒè¯ç½‘å¡çŠ¶æ€<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> nmcli d
DEVICE  TYPE      STATE         CONNECTION
ens33   ethernet  connected     ens33
lo      lookback  unmanaged     --<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>éªŒè¯ç½‘ç»œçŠ¶æ€: æˆåŠŸ<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ping</span> baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="centos-7-å¦‚ä½•è®¾ç½®å›ºå®šIP"><a href="#centos-7-å¦‚ä½•è®¾ç½®å›ºå®šIP" class="headerlink" title="centos 7 å¦‚ä½•è®¾ç½®å›ºå®šIP"></a>centos 7 å¦‚ä½•è®¾ç½®å›ºå®šIP</h2><p>ä½¿ç”¨<code>VMware Fusion</code>å®‰è£…å¥½äº†<code>CentOS 7</code>è™šæ‹Ÿæœºä¹‹å, å‘ç°æ¯æ¬¡è™šæ‹Ÿæœºå¯åŠ¨éƒ½ä¼šDHCPè‡ªåŠ¨é‡æ–°åˆ†é…ä¸ªIP, å¯¼è‡´é…ç½®å…ç™»æ¯”è¾ƒéº»çƒ¦.<br>å› æ­¤éœ€è¦è®¾ç½®è™šæ‹Ÿæœºå›ºå®šIP. ä½¿ç”¨å¦‚ä¸‹æ­¥éª¤æ¥: </p>
<ol>
<li><p>é¦–å…ˆæŸ¥çœ‹ç½‘å¡, å¯çŸ¥ç½‘å¡åç§°æ˜¯ <code>ens33</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost network-scripts<span class="token punctuation">]</span><span class="token comment"># ifconfig</span>
ens33: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
        inet <span class="token number">192.168</span>.230.130  netmask <span class="token number">255.255</span>.255.0  broadcast <span class="token number">192.168</span>.230.255
        inet6 fe80::28f7:8740:599:2a5c  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">></span>
        ether 00:0c:29:a2:4d:53  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">19066</span>  bytes <span class="token number">24766708</span> <span class="token punctuation">(</span><span class="token number">23.6</span> MiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">3695</span>  bytes <span class="token number">352775</span> <span class="token punctuation">(</span><span class="token number">344.5</span> KiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹<code>VMWare Fusion</code>é…ç½®ä¸ºå­ç½‘é…ç½®çš„DNSè·¯ç”±å™¨åœ°å€ä¸ç½‘å…³åœ°å€<br>ç”±äºä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼æ˜¯<code>NATæ¨¡å¼</code>, å³è™šæ‹Ÿæœºä¸Macæ‰€åœ¨çš„å­ç½‘æ˜¯ä¸åŒçš„.<br>è™šæ‹Ÿæœºå­ç½‘ç½‘æ®µæ˜¯<code>192.168.230.0/24</code>, è€ŒMacå®¿ä¸»æœºæ‰€åœ¨çš„ç½‘æ®µæ˜¯<code>192.168.3.0/24</code>. æ‰€ä»¥éœ€è¦åœ¨Macä¸ŠæŸ¥çœ‹: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /Library/Preferences/VMware<span class="token punctuation">\</span> Fusion/vmnet8/dhcpd.conf
subnet <span class="token number">192.168</span>.230.0 netmask <span class="token number">255.255</span>.255.0 <span class="token punctuation">&#123;</span>
	range <span class="token number">192.168</span>.230.128 <span class="token number">192.168</span>.230.254<span class="token punctuation">;</span>
	option broadcast-address <span class="token number">192.168</span>.230.255<span class="token punctuation">;</span>
	option domain-name-servers <span class="token number">192.168</span>.230.2<span class="token punctuation">;</span>
	option domain-name localdomain<span class="token punctuation">;</span>
	default-lease-time <span class="token number">1800</span><span class="token punctuation">;</span>                <span class="token comment"># default is 30 minutes</span>
	max-lease-time <span class="token number">7200</span><span class="token punctuation">;</span>                    <span class="token comment"># default is 2 hours</span>
	option netbios-name-servers <span class="token number">192.168</span>.230.2<span class="token punctuation">;</span>
	option routers <span class="token number">192.168</span>.230.2<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ ¹æ®ä¸Šè¿°ä¿¡æ¯å¯çŸ¥, è™šæ‹Ÿæœºå­ç½‘çš„DNSæœåŠ¡å™¨åœ°å€ä¸º<code>192.168.230.2</code>, ç½‘å…³åœ°å€ä¸º<code>192.168.230.2</code></p>
</li>
<li><p>ä¿®æ”¹ç½‘å¡é…ç½®<br>å¦‚ä¸‹, ä¿®æ”¹dhcpä¸ºstatic, å¢åŠ <code>GATEWAY</code>(å³ä¸Šä¸€æ­¥æŸ¥å‡ºæ¥çš„ç½‘å…³åœ°å€) <code>IPADDR</code>(å³éœ€è¦ä½¿ç”¨çš„å›ºå®šIP) <code>NETMASK</code> <code>DNS1</code>(å³ä¸Šä¸€æ­¥æŸ¥å‡ºçš„DNSæœåŠ¡å™¨åœ°å€) <code>DNS2</code> ç­‰ </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33
<span class="token comment"># BOOTPROTO=dhcp</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.230.2
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.230.130
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.230.2
<span class="token assign-left variable">DNS2</span><span class="token operator">=</span><span class="token number">8.8</span>.8.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>é‡å¯ç½‘ç»œæœåŠ¡</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> /etc/init.d/network restart
$ <span class="token function">sudo</span> <span class="token function">service</span> network restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>éªŒè¯ç½‘ç»œèƒ½é€š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ping baidu.com</span>
PING baidu.com <span class="token punctuation">(</span><span class="token number">110.242</span>.68.66<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">110.242</span>.68.66 <span class="token punctuation">(</span><span class="token number">110.242</span>.68.66<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">35.9</span> ms
^C
--- baidu.com <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">1</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 0ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">35.915</span>/35.915/35.915/0.000 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<p>è¿™é‡Œæ’æ’­ä¸€å¥, ç¬¬4æ­¥é…ç½®æ—¶: </p>
<ul>
<li>DNSä¸GATEWAYéƒ½é…ç½®é”™è¯¯, é…ç½®æˆäº†<code>192.168.230.1</code>, å¯¼è‡´pingå®Œå…¨ä¸é€š, éƒ½æ²¡è§£æå‡ºIP</li>
<li>DNSé…ç½®æ­£ç¡®, ä½†GATEWAYé…ç½®é”™è¯¯, åªé…ç½®äº†DNSä¸º<code>192.168.230.2</code>, è€ŒGATEWAYæƒ³å½“ç„¶åœ°é…ç½®ä¸ºäº†<code>192.168.230.1</code>, ç»“æœå¯¼è‡´pingçš„æ—¶å€™, åŸŸåèƒ½è§£æå‡ºæ¥, ä½†100%ä¸¢åŒ…, å³ç½‘ç»œä¸é€š.</li>
<li>æœ€åä¸¤è€…éƒ½é…ç½®æ­£ç¡®, ç½‘ç»œæ‰é€š.</li>
</ul>
<h2 id="å¦‚ä½•æŸ¥çœ‹TCPè¿æ¥åˆ›å»ºçš„æ—¶é—´"><a href="#å¦‚ä½•æŸ¥çœ‹TCPè¿æ¥åˆ›å»ºçš„æ—¶é—´" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹TCPè¿æ¥åˆ›å»ºçš„æ—¶é—´"></a>å¦‚ä½•æŸ¥çœ‹TCPè¿æ¥åˆ›å»ºçš„æ—¶é—´</h2><p>åœ¨æ’æŸ¥TCPè¿æ¥å¼‚å¸¸æ—¶, æŸä¸ªé•¿è¿æ¥ç»å¸¸è«åå…¶å¦™æ–­è¿, éœ€è¦åˆ¤æ–­è¿æ¥çš„å»ºç«‹æ—¶é—´:</p>
<ol>
<li><p>æŸ¥çœ‹è¿›ç¨‹çš„TCPè¿æ¥, è·å–å…·ä½“çš„æœ¬åœ°ç«¯å£å·${port_no}</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">lsof</span> -p <span class="token variable">$&#123;pid&#125;</span> -nP <span class="token operator">|</span> <span class="token function">fgrep</span> TCP <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹æœ¬åœ°ç«¯å£å¯¹åº”çš„TCPè¿æ¥è¯¦æƒ…, PIDä¸FD</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">lsof</span> -i:<span class="token variable">$&#123;port_no&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æŸ¥çœ‹æ–‡ä»¶åˆ›å»ºæ—¶é—´<br>å¦‚ä¸‹, æ–‡ä»¶åˆ›å»ºæ—¶é—´å³TCPè¿æ¥å»ºç«‹æ—¶é—´</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">ls</span> -l /proc/<span class="token variable">$&#123;pid&#125;</span>/fd/<span class="token variable">$&#123;fd&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h1 id="SSH-Server"><a href="#SSH-Server" class="headerlink" title="SSH Server"></a>SSH Server</h1><p>ä¾¿äºå®¢æˆ·ç«¯èƒ½é€šè¿‡SSHè¿æ¥åˆ°è¯¥æœåŠ¡å™¨ä¸Š</p>
<h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…SSH Server</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openssh-server -y

<span class="token comment"># æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span>
<span class="token function">sudo</span> dpkg -l <span class="token operator">|</span> <span class="token function">fgrep</span> openssh-server

<span class="token comment"># ç¡®è®¤sshè¿›ç¨‹å·²å¯åŠ¨</span>
<span class="token function">sudo</span> systemctl status <span class="token function">ssh</span>
<span class="token function">ps</span> -e <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">ssh</span>

<span class="token comment"># å¯åŠ¨sshè¿›ç¨‹</span>
<span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">ssh</span> start
<span class="token comment"># æˆ–è€…</span>
<span class="token function">sudo</span> /etc/init.d/ssh start
<span class="token comment"># æˆ–è€…</span>
<span class="token function">sudo</span> systemctl start <span class="token function">ssh</span>

<span class="token comment"># åœæ­¢sshè¿›ç¨‹</span>
<span class="token function">sudo</span> systemctl stop <span class="token function">ssh</span>

<span class="token comment"># å¼€æœºè‡ªåŠ¨å¯åŠ¨ssh</span>
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">ssh</span>

<span class="token comment"># å…³é—­å¼€æœºè‡ªåŠ¨å¯åŠ¨ssh</span>
<span class="token function">sudo</span> systemctl disable <span class="token function">ssh</span>

<span class="token comment"># å®‰è£…ifconfig</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> net-tools -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>linux</tag>
        <tag>network</tag>
        <tag>nat</tag>
        <tag>arp</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç½‘ç»œä¹‹åŸç†æ¢è®¨ä¸ç–‘é—®æ€»ç»“</title>
    <url>//2022-06-29-linux-network-faq/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><h2 id="ç½‘å¡æ··æ‚æ¨¡å¼"><a href="#ç½‘å¡æ··æ‚æ¨¡å¼" class="headerlink" title="ç½‘å¡æ··æ‚æ¨¡å¼"></a>ç½‘å¡æ··æ‚æ¨¡å¼</h2><ul>
<li><p>å•¥æ˜¯ç½‘å¡æ··æ‚æ¨¡å¼ï¼Ÿ</p>
</li>
<li><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ç½‘å¡æ”¶åˆ°äºŒå±‚å¸§ä¹‹åï¼Œä¼šæŸ¥çœ‹TargetMacæ˜¯å¦ä¸è‡ªèº«çš„Macåœ°å€ç›¸åŒï¼Œå¦‚æœä¸åŒï¼Œåˆ™ä¸¢å¼ƒè¯¥å¸§ã€‚</p>
</li>
<li><p>å¼€å¯äº†æ··æ‚æ¨¡å¼ä¹‹åï¼Œå³ä½¿MACåœ°å€ä¸åŒ¹é…ï¼Œä¹Ÿä¸ä¼šä¸¢å¼ƒã€‚è¿˜æ˜¯ä¼šè¿›å…¥TCP&#x2F;IPåè®®æ ˆå¤„ç†ã€‚</p>
</li>
<li><p>å•¥æ—¶å€™éœ€è¦å¼€å¯ï¼Ÿ</p>
</li>
<li><p>&#x2F;&#x2F; TODO:</p>
</li>
<li><p>å¦‚ä½•å¼€å¯ï¼Ÿ</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// å¼€å¯æ··æ‚æ¨¡å¼
<span class="token function">ifconfig</span> eth0 promisc
// å–æ¶ˆæ··æ‚æ¨¡å¼
<span class="token function">ifconfig</span> eth0 -promisc
// å†…æ ¸åˆ¤æ–­ç½‘å¡æ˜¯å¦å¤„äºæ··æ‚æ¨¡å¼æ˜¯çœ‹å¦‚ä¸‹æ ‡è¯†ï¼Œå¦‚æœç½®ä½äº†0x100ï¼Œåˆ™å¤„äºæ··æ‚æ¨¡å¼
<span class="token function">cat</span> /sys/class/net/eth0/flags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>æ˜¯å¦å¼€å¯äº†æ··æ‚æ¨¡å¼ï¼Œå°±èƒ½å—…æ¢å±€åŸŸç½‘ï¼ˆäºŒå±‚ç½‘ï¼‰å†…çš„æ‰€æœ‰æ•°æ®åŒ…äº†ï¼Ÿ</p>
</li>
<li><p>ä¸ä¸€å®šã€‚</p>
</li>
<li><p>é’ˆå¯¹äºŒå±‚å¦‚æœæ˜¯é›†çº¿å™¨æ¨¡å¼ï¼Œå¯ä»¥å—…æ¢åˆ°ã€‚</p>
</li>
<li><p>ä½†ç°åœ¨å¤§éƒ¨åˆ†äºŒå±‚éƒ½æ˜¯äº¤æ¢æœºæ¨¡å¼ã€‚å³äº¤æ¢æœºä¼šæ ¹æ®CAMè¡¨ï¼Œå¾€å¯¹åº”çš„ç«¯å£è½¬å‘ï¼Œä¸ä¼šæ— è„‘åœ°å…¨éƒ¨ç«¯å£éƒ½è½¬å‘ï¼Œå› æ­¤å—…æ¢ä¸åˆ°ã€‚</p>
</li>
<li><p>å¼€å¯æ··æ‚æ¨¡å¼çš„ä¾‹å­</p>
</li>
<li><p>å¦‚ä¸‹ï¼Œdocker0ç½‘æ¡¥å°±å¼€å¯äº†æ··æ‚æ¨¡å¼ã€‚</p>
</li>
<li><p>&#x2F;&#x2F; TODO: ä¸ºå•¥docker0ç½‘æ¡¥å¼€å¯æ··æ‚æ¨¡å¼ï¼Ÿå…·ä½“æ€ä¹ˆç”¨çš„ï¼Ÿ</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">cat</span> /sys/class/net/docker0/flags 
0x1003<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«"><a href="#è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«" class="headerlink" title="è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«"></a>è·¯ç”±å™¨ä¸NATè®¾å¤‡çš„å…³è”ä¸åŒºåˆ«</h2><h3 id="è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š"><a href="#è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š" class="headerlink" title="è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š"></a>è·¯ç”±å™¨å·¥ä½œåŸç†ï¼š</h3><p>ä¸»è¦ç”¨æ¥è”é€šè¿ä¸ªä¸åŒçš„ç½‘æ®µï¼Œ<mark>åªä¿®æ”¹sourceMacä¸targetMacï¼Œä¸ä¿®æ”¹sourceIpä¸targetIp</mark></p>
<ol>
<li>æ ¹æ®ä¼ å…¥åŒ…æŒ‡å®šçš„targetIpï¼ˆä¼ å…¥åŒ…çš„MACåœ°å€æ˜¯è·¯ç”±å™¨å½“å‰ç½‘å¡çš„MACåœ°å€ï¼ŒIPåœ°å€æ˜¯çœŸæ­£çš„IPåœ°å€ï¼‰</li>
<li>æŸ¥è¯¢è‡ªèº«è·¯ç”±è¡¨ï¼ŒæŸ¥æ‰¾åˆ°æœ€è¿‘çš„ä¸‹ä¸€è·³çš„IPåœ°å€ã€‚<code>route -n</code></li>
<li>å†æ ¹æ®ä¸‹ä¸€è·³çš„IPåœ°å€ï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„MACåœ°å€ã€‚arpç¼“å­˜è¡¨</li>
<li>ä¿®æ”¹æ•°æ®åŒ…çš„targetMACåœ°å€ä¸ºä¸‹ä¸€è·³çš„MACåœ°å€ï¼ŒsourceMACä¸ºå½“å‰ç½‘å¡å‡ºå£çš„macåœ°å€</li>
<li>å°†æ•°æ®åŒ…ä»å¯¹åº”ç½‘å¡é€å‡ºå»ã€‚</li>
</ol>
<blockquote>
<p>è·¯ç”±å™¨çš„æ ¸å¿ƒæ˜¯è·¯ç”±è¡¨çš„ç»´æŠ¤ï¼Œèƒ½ç”Ÿæˆæœ€çŸ­æœ€ä¼˜è·¯å¾„ã€‚<br/><br>ä»sourceIpåˆ°targetIpçš„è·¯ç”±è·¯å¾„ï¼Œå¾ˆå¯èƒ½ä¸å›åŒ…ï¼Œå³ä»targetIpè¿”å›åˆ°sourceIpçš„è·¯ç”±è·¯å¾„ä¸ä¸€æ ·ã€‚<br>å–å†³äºå½“æ—¶çš„è·¯å¾„ä¸­è·¯ç”±å™¨çš„è·¯ç”±è¡¨æƒ…å†µã€‚</p>
</blockquote>
<h3 id="NATå·¥ä½œåŸç†ï¼š"><a href="#NATå·¥ä½œåŸç†ï¼š" class="headerlink" title="NATå·¥ä½œåŸç†ï¼š"></a>NATå·¥ä½œåŸç†ï¼š</h3><ul>
<li><p>åŸç†<br>éœ€è¦ä¿®æ”¹sourceMacä¸targetMacã€‚<br>åŒæ—¶å¦‚æœæ˜¯SNATï¼Œåˆ™è¿˜è¦ä¿®æ”¹sourceIpã€‚<br>å¦‚æœæ˜¯DNATï¼Œåˆ™è¿˜è¦ä¿®æ”¹targetIpã€‚</p>
</li>
<li><p>å®ç°æ–¹å¼:<br>é€šè¿‡iptableså¯ä»¥è®¾ç½®natè¡¨ã€‚<br>snatä½œç”¨åœ¨postroutingé˜¶æ®µï¼Œdnatä½œç”¨åœ¨preroutingé˜¶æ®µã€‚<br>å›åŒ…ç”±å†…æ ¸çš„conntrackæ¨¡å—è´Ÿè´£ï¼Œä¸å†ç”±iptablesè´Ÿè´£ã€‚<br>è¯¦ç»†å‚è§ <a href="https://davyjones2010.github.io/2022-06-23-linux-network-nat">NATä¹‹ç«¯å£æ˜ å°„(PAT)åŸç†æ€»ç»“&amp;å®è·µ</a></p>
</li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç”±æ­¤å¯çŸ¥ï¼Œå®¶ç”¨çš„è·¯ç”±å™¨ï¼Œæ˜¯é™„å¸¦äº†SNATï¼ˆä¹Ÿå¯ä»¥é…ç½®DNATï¼‰åŠŸèƒ½çš„è·¯ç”±å™¨ã€‚</p>
<h2 id="ip-forwarding"><a href="#ip-forwarding" class="headerlink" title="ip_forwarding"></a>ip_forwarding</h2><h3 id="MACåœ°å€åŒ¹é…-ä½†IPåœ°å€ä¸åŒ¹é…"><a href="#MACåœ°å€åŒ¹é…-ä½†IPåœ°å€ä¸åŒ¹é…" class="headerlink" title="MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸åŒ¹é…"></a>MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸åŒ¹é…</h3><p>ç½‘å¡ä¼šä¸ä¼šæ”¶åˆ°MACåœ°å€ä¸å½“å‰ç½‘å¡MACåœ°å€åŒ¹é…, ä½†IPåœ°å€ä¸å½“å‰ç½‘å¡çš„IPä¸åŒ¹é…çš„IPåŒ…?<br>å…·ä½“å’‹å¤„ç†? ç›´æ¥ä¸¢å¼ƒ? è¿˜æ˜¯å¯ä»¥ä½¿ç”¨?</p>
<ul>
<li>ä¼šæ”¶åˆ°ã€‚</li>
<li>å¦‚æœå¼€å¯äº†ip_forwardingï¼Œåˆ™ä¼šè¿›å…¥FORWARD&#x2F;ROUTEé˜¶æ®µï¼ŒæŸ¥çœ‹æœ¬åœ° route è¡¨ï¼Œè¿›å…¥è·¯ç”±ä¸postroutingé˜¶æ®µï¼Œæ‰¾åˆ°å¯¹åº”çš„å‡ºå£ç½‘å¡ï¼Œå°†åŒ…è½¬å‘å‡ºå»ã€‚ä¸è·¯ç”±å™¨çš„åŠŸèƒ½å®Œå…¨ä¸€è‡´äº†ã€‚</li>
<li>å¦‚æœæœªå¼€å¯ip_forwardingï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥åŒ…ã€‚</li>
<li>æ‰€ä»¥ï¼ŒNATæ¨¡å¼ä¸‹ï¼Œå¿…é¡»è¦å¼€å¯ip_forwardingã€‚</li>
</ul>
<h3 id="iptableså·¥ä½œåŸç†å›¾"><a href="#iptableså·¥ä½œåŸç†å›¾" class="headerlink" title="iptableså·¥ä½œåŸç†å›¾"></a>iptableså·¥ä½œåŸç†å›¾</h3><p>æ­¤å›¾æ‘˜è‡ª <a href="https://wiki.archlinux.org/title/Iptables">Archlinux æ–‡æ¡£</a></p>
<pre class="line-numbers language-none"><code class="language-none">                               XXXXXXXXXXXXXXXXXX
                             XXX     Network    XXX
                               XXXXXXXXXXXXXXXXXX
                                       +
                                       |
                                       v
 +-------------+              +------------------+
 |table: filter| &lt;---+        | table: nat&#x2F;dnat  |
 |chain: INPUT |     |        | chain: PREROUTING|
 +-----+-------+     |        +--------+---------+
       |             |                 |
       v             |                 v
 [local process]     |           ****************          +--------------+
       |             +---------+ Routing decision +------&gt; |table: filter |
       v                         ****************          |chain: FORWARD|
****************                                           +------+-------+
Routing decision                                                  |
****************                                                  |
       |                                                          |
       v                        ****************                  |
+-------------+       +------&gt;  Routing decision  &lt;---------------+
|table: nat   |       |         ****************
|chain: OUTPUT|       |               +
+-----+-------+       |               |
      |               |               v
      v               |      +-------------------+
+--------------+      |      | table: nat&#x2F;snat   |
|table: filter | +----+      | chain: POSTROUTING|
|chain: OUTPUT |             +--------+----------+
+--------------+                      |
                                      v
                               XXXXXXXXXXXXXXXXXX
                             XXX    Network     XXX
                               XXXXXXXXXXXXXXXXXX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip-forwarding"><a href="#ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip-forwarding" class="headerlink" title="ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip_forwarding?"></a>ä¸ºå•¥Linuxé»˜è®¤ä¸å¼€å¯ip_forwarding?</h3><p>å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œhoståªæ˜¯æ‰®æ¼”åœ¨ç½‘ç»œä¸­çš„ä¸€å°ä¸»æœºçš„è§’è‰²ï¼Œæ ¹æœ¬ä¸éœ€è¦ip_forwardingçš„åŠŸèƒ½ã€‚</p>
<blockquote>
<p>A Linux machine acting as an ordinary host would not need to have IP forwarding enabled,<br>because it just generates and receives IP traffic for its own purposes</p>
</blockquote>
<h3 id="å¦‚ä½•å¼€å¯ip-forwarding"><a href="#å¦‚ä½•å¼€å¯ip-forwarding" class="headerlink" title="å¦‚ä½•å¼€å¯ip_forwarding?"></a>å¦‚ä½•å¼€å¯ip_forwarding?</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">></span> /proc/sys/net/ipv4/ip_forward<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‰€ä»¥å¼€å¯äº†ip_forwardingï¼Œç›¸å½“äºæœ¬æœºå°±å…·å¤‡ä¸€å°è·¯ç”±å™¨çš„èƒ½åŠ›äº†ã€‚<br/><br>å¦‚æœå†é€šè¿‡iptablesé…ç½®äº†ç›¸åº”çš„natè§„åˆ™ï¼Œå°±ç›¸å½“äºä¸€å°å®¶ç”¨çš„è·¯ç”±å™¨äº†ã€‚</p>
<h2 id="æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜"><a href="#æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜" class="headerlink" title="æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜"></a>æœ¬åœ°å¤šç½‘å¡curlå…¬ç½‘åœ°å€é—®é¢˜</h2><ul>
<li>å¦‚æœæœ¬æœºæœ‰ç§ç½‘ç½‘å¡virbr0, å…¬ç½‘ç½‘å¡en0, ä¸”å¼€å¯äº†virbr0ç½‘æ®µçš„SNATè§„åˆ™. åˆ™åœ¨æœ¬åœ°curlå…¬ç½‘åœ°å€, åˆ™curlçš„å‡ºå£ç½‘å¡æ˜¯å•¥? </li>
<li>æ˜¯é€šè¿‡virbr0, ç„¶åèµ°SNATåˆ°en0å‡ºå»ä¹ˆ?</li>
<li>è¿˜æ˜¯ç›´æ¥é€šè¿‡en0å‡ºå»?</li>
</ul>
<ol>
<li><p>curl æ”¯æŒæŒ‡å®šå‡ºå£ç½‘å¡å¦‚ä¸‹(å®é™…åªæ˜¯ä½¿ç”¨äº†å¯¹åº”ç½‘å¡çš„ipåœ°å€ä½œä¸ºSIP): å¦‚æœä¸æŒ‡å®š, åˆ™ä½¿ç”¨é»˜è®¤ç½‘å¡. </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// curlæŒ‡å®šç½‘å¡å‡ºå£
<span class="token function">curl</span> --interface virbr0 http://www.baidu.com
// macä¸ŠæŸ¥çœ‹é»˜è®¤ç½‘å¡: 
route -n get <span class="token number">0.0</span>.0.0 <span class="token operator">|</span> <span class="token function">grep</span> interface<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>The â€“interface options is used to figure determine what address on the system will be used as the source IP. <br/><br>It doesnâ€™t magically change anything about routing.</p>
</blockquote>
</li>
<li><p>å‚è§<a href="#iptables%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%9B%BE">iptableså·¥ä½œåŸç†å›¾</a>, å¯çŸ¥ä»curlå…¬ç½‘åœ°å€, å°±æ˜¯ä»local processå‡ºå», æ¥ä¸‹æ¥ä¼šèµ°route, å³æŸ¥çœ‹Hostçš„è·¯ç”±è¡¨, ç¡®å®šå‡ºå£ç½‘å¡ä¸ç½‘å…³ä¿¡æ¯.</p>
</li>
<li><p>æ¥ä¸‹æ¥è¿›å…¥postrouting(SNAT)é˜¶æ®µ, å¦‚æœé…ç½®æœ‰SNATè§„åˆ™, ä¸”åˆšå¥½å‘½ä¸­, åˆ™æ‰§è¡ŒSNAT.</p>
</li>
<li><p>æ‰€ä»¥ç»“è®ºæ˜¯å‡ºå£ç½‘å¡æ˜¯en0, è€Œä¸ä¼šç»è¿‡virbr0(å³ä½¿æŒ‡å®šäº†<code>--interface virbr0</code>).</p>
</li>
<li><p>æ˜¯å¦ä¼šSNAT, å–å†³äºæ˜¯å¦æŒ‡å®šäº†<code>--interface virbr0</code>, æŒ‡å®šäº†, åˆ™ä¼šèµ°SNAT; æœªæŒ‡å®š, åˆ™ä¸éœ€è¦èµ°SNAT.</p>
</li>
</ol>
<h2 id="æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜"><a href="#æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜" class="headerlink" title="æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜"></a>æœ¬åœ°å¤šç½‘å¡Javaåº”ç”¨è·å–HostIpé—®é¢˜</h2><ul>
<li>å¦‚æœæœ¬æœºæœ‰å¤šå—ç½‘å¡, åœ¨Javaä¸­å¦‚ä½•è·å–åˆ°è¿™äº›IPåœ°å€? </li>
<li>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨è·å–æœ¬æœºIPçš„æ–¹å¼å¦‚ä¸‹: <mark>å½“Hostå¤šå—ç½‘å¡æ—¶, ä¸å¥½å…¼å®¹, å­˜åœ¨ä¸¥é‡ç¼ºé™·, å°¤å…¶æ˜¯åœ¨çº¿ä¸ŠæœåŠ¡å™¨ç½‘å¡å †å åœºæ™¯ä¸‹!</mark></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">InetAddress</span> ip <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> hostname <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>è§£å†³æ–¹æ¡ˆ: </li>
<li>æ–¹æ¡ˆ1: ä½¿ç”¨ <code>NetworkInterface.getNetworkInterfaces()</code> æ¥å£, è·å–æ‰€æœ‰ç½‘å¡, ç„¶åé€ä¸ªè·å–IPä¿¡æ¯.</li>
<li>æ–¹æ¡ˆ2: è·å–æœ¬æœºçš„FQDN, ç„¶åä½¿ç”¨<code>InetAddress.getByName(FQDN)</code>æ¥è·å–ä¸»ç½‘å¡çš„IPä¿¡æ¯.<ul>
<li>æœ¬æœºçš„FQDNå¯ä»¥å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ.</li>
</ul>
</li>
<li>Ref: <a href="https://crunchify.com/how-to-get-server-ip-address-and-hostname-in-java/">How to get Server IP Address and Hostname in Java</a></li>
</ul>
<h2 id="IPéš§é“"><a href="#IPéš§é“" class="headerlink" title="IPéš§é“"></a>IPéš§é“</h2><h2 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h2><h3 id="LVS-v-s-iptables-x2F-netfilters"><a href="#LVS-v-s-iptables-x2F-netfilters" class="headerlink" title="LVS v.s. iptables&#x2F;netfilters"></a>LVS v.s. iptables&#x2F;netfilters</h3><p>æœ¬è´¨ä¸Š, ä¸¤ä¸ªéƒ½å¯ä»¥åšå››å±‚çš„DNAT, éƒ½æ˜¯å·¥ä½œåœ¨å†…æ ¸ç©ºé—´. </p>
<ul>
<li>LVS: æ›´ä¾§é‡äºLoadBalancing, å®ç°ä¸Šä½¿ç”¨hashæŸ¥è¡¨, è€Œä¸æ˜¯iptablesçš„é¡ºåºæŸ¥è¯¢. æ•ˆç‡æ›´é«˜. </li>
<li>iptables:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042336674.png"></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°, LVSæœ¬è´¨ä¸Šæ˜¯ä¸iptablesé…åˆä½¿ç”¨</li>
<li>å®¢æˆ·è®¿é—®è™šæ‹Ÿ IPï¼ˆVIPï¼‰æ—¶ï¼Œæ•°æ®åŒ…å…ˆåœ¨ä¸»æœºå†…æ ¸ç©ºé—´è¢« PREROUTING é“¾æ£€æµ‹ï¼Œæ ¹æ®æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€è¿›è¡Œè·¯ç”±åˆ¤æ–­ï¼Œè‹¥ç›®æ ‡åœ°å€æ˜¯æœ¬åœ°ï¼Œåˆ™äº¤ç”± INPUT é“¾è¿›è¡Œå¤„ç†ã€‚</li>
<li>IPVS å·¥ä½œäº INPUT é“¾ï¼Œå½“æ•°æ®åŒ…åˆ°è¾¾ INPUT é“¾æ—¶ï¼Œä¼šå…ˆç”± IPVS è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•é€‰å‡ºçœŸå®æœåŠ¡å™¨ IPã€‚</li>
<li>IPVS è½¬å‘æ¨¡å¼ä¸º NAT æ¨¡å¼æ—¶ï¼Œå°†æ•°æ®åŒ…ç”± FORWARD é“¾è¿›è¡Œå¤„ç†åç”± POST-ROUTING é“¾å‘é€ç»™çœŸå®æœåŠ¡å™¨ã€‚</li>
<li>IPVS è½¬å‘æ¨¡å¼ä¸ºé NAT æ¨¡å¼æ—¶ï¼Œåˆ™å°†æ•°æ®åŒ…ç”± POST-ROUTING é“¾å‘é€ç»™çœŸå®æœåŠ¡å™¨ã€‚</li>
</ul>
<h3 id="LVSçš„å‡ ç§æ¨¡å¼åˆ†æ"><a href="#LVSçš„å‡ ç§æ¨¡å¼åˆ†æ" class="headerlink" title="LVSçš„å‡ ç§æ¨¡å¼åˆ†æ"></a>LVSçš„å‡ ç§æ¨¡å¼åˆ†æ</h3><p><a href="https://blog.csdn.net/Splend520/article/details/104587149">linux LVSè´Ÿè½½å‡è¡¡åŸç† NAT DR TUN FULLNAT æ¨¡å¼</a></p>
<h4 id="LVS-NAT-â€“-gt-NAT-x2F-DNAT"><a href="#LVS-NAT-â€“-gt-NAT-x2F-DNAT" class="headerlink" title="LVS-NAT â€“&gt; NAT&#x2F;DNAT"></a>LVS-NAT â€“&gt; NAT&#x2F;DNAT</h4><p>æœ¬è´¨æ˜¯ç±»ä¼¼iptablesçš„ç«¯å£æ˜ å°„(PAT)â€“&gt; æ³¨æ„è¿™é‡Œå…¨ç¨‹æ²¡æœ‰DIPçš„å‚ä¸.</p>
<ul>
<li>LVSæœ¬èº«æœ‰ä¸¤ä¸ªIP, å¯¹å¤–æ˜¯VIP, å¯¹å†…æ˜¯DIP(Director IP)</li>
<li>Clientè¯·æ±‚: {CIP, VIP}</li>
<li>LVSæ˜ å°„: ä¿®æ”¹ç›®æ ‡IP, VIP-&gt;RIP, æ„å»ºæ–°çš„è¯·æ±‚: {CIP, RIP}</li>
<li>Serverå¤„ç†: å®Œæˆåå‘é€å›åŒ…, {RIP, CIP}; ç”±äºCIPä¸RIPä¸åœ¨åŒä¸€ä¸ªç½‘æ®µ, å› æ­¤å‘é€åˆ°ç½‘å…³(å³LVS)</li>
<li>LVSæ˜ å°„: ä¿®æ”¹æºIP, RIP-&gt;VIP, æ„å»ºæ–°çš„å“åº”: {VIP, CIP}</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207052223099.png"></p>
<ul>
<li>ç¼ºç‚¹: <ul>
<li>éœ€è¦RSä¸DSåœ¨åŒä¸€ä¸ªäºŒå±‚ç½‘ç»œé‡Œ, ä¸”éœ€è¦æŠŠDS&#x2F;DIPé…ç½®ä¸ºRSçš„ç½‘å…³.</li>
</ul>
</li>
<li>ä¼˜ç‚¹: <ul>
<li>&#x2F;&#x2F; TODO:</li>
</ul>
</li>
</ul>
<h4 id="LVS-NAT-â€“-gt-FullNAT"><a href="#LVS-NAT-â€“-gt-FullNAT" class="headerlink" title="LVS-NAT â€“&gt; FullNAT"></a>LVS-NAT â€“&gt; FullNAT</h4><ul>
<li>LVSæœ¬èº«æœ‰ä¸¤ä¸ªIP, å¯¹å¤–æ˜¯VIP, å¯¹å†…æ˜¯DIP(Director IP)</li>
<li>Clientè¯·æ±‚: {CIP, VIP}</li>
<li>LVSæ˜ å°„: ä¿®æ”¹ç›®æ ‡IP, VIP-&gt;RIP(RealServerIP); ä¿®æ”¹æºIP, CIP-&gt;DIP; æ„å»ºæ–°çš„è¯·æ±‚: {DIP, RIP}</li>
<li>RealServerå¤„ç†: å®Œæˆåå‘é€å›åŒ…, {RIP, DIP} (FullNATæ¨¡å¼, ä¸éœ€è¦LVSå¿…é¡»æ˜¯ç½‘å…³, åªè¦ä¸‰å±‚IPå¯è¾¾å³å¯)</li>
<li>LVSæ˜ å°„: ä¿®æ”¹æºIP, RIP-&gt;VIP; é€šè¿‡conntrackæŸ¥è¡¨, ä¿®æ”¹ç›®æ ‡IP, DIP-&gt;CIP; æ„å»ºæ–°çš„å“åº”: {VIP, CIP}</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207052218872.png"></p>
<ul>
<li><p>æ³¨æ„: LVS æœ¬èº«ä¸æ”¯æŒ FULLNAT æ¨¡å¼ï¼Œéœ€è¦é¢å¤–å¯¹å†…æ ¸æ‰“è¡¥ä¸åæ‰èƒ½ä½¿ç”¨ã€‚</p>
</li>
<li><p>ç¼ºç‚¹: </p>
<ul>
<li>ä¸ç®¡æ˜¯è¯·æ±‚æ•°æ®åŒ…è¿˜æ˜¯å“åº”æ•°æ®åŒ…ï¼Œéƒ½è¦ç»è¿‡è´Ÿè½½å‡è¡¡å™¨ã€‚ä½†æ˜¯å“åº”æ•°æ®åŒ…ä¸€èˆ¬è¦æ¯”è¯·æ±‚æ•°æ®åŒ…å¤§å¾ˆå¤šï¼Œè¿™å¯èƒ½ä¼šæˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆã€‚</li>
</ul>
</li>
<li><p>ä¼˜ç‚¹:</p>
<ul>
<li>å¦‚ä¸Šå›¾, RealServer(DIP)ä¸éœ€è¦è·ŸLVSåœ¨åŒä¸€ä¸ªç½‘æ®µ, åªè¦IPåŒ…(ä¸‰å±‚è·¯ç”±)å¯è¾¾, å°±èƒ½å®ŒæˆFullNAT</li>
</ul>
</li>
</ul>
<h4 id="LVS-DR"><a href="#LVS-DR" class="headerlink" title="LVS-DR"></a>LVS-DR</h4><h4 id="LVS-TUN"><a href="#LVS-TUN" class="headerlink" title="LVS-TUN"></a>LVS-TUN</h4><h4 id="å®é™…"><a href="#å®é™…" class="headerlink" title="å®é™…"></a>å®é™…</h4><ul>
<li><a href="https://help.aliyun.com/document_detail/27544.html">é˜¿é‡Œäº‘CLB</a>ä½¿ç”¨çš„æ˜¯å“ªç§æ¨¡å¼? NAT?<ul>
<li>å››å±‚é‡‡ç”¨å¼€æºè½¯ä»¶LVSï¼ˆLinux Virtual Serverï¼‰+ keepalivedçš„æ–¹å¼å®ç°è´Ÿè½½å‡è¡¡</li>
<li>LVSåº”è¯¥ä½¿ç”¨çš„æ˜¯NATæ¨¡å¼. ä½†å¦‚æœæ˜¯NATæ¨¡å¼, åˆ™å¿…é¡»æŠŠLVSä½œä¸ºECSçš„ç½‘å…³. &#x2F;&#x2F;TODO: å¾…éªŒè¯</li>
</ul>
</li>
</ul>
<h1 id="HTTP-ä»£ç†"><a href="#HTTP-ä»£ç†" class="headerlink" title="HTTP ä»£ç†"></a>HTTP ä»£ç†</h1><h1 id="ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€"><a href="#ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€" class="headerlink" title="ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€?"></a>ä»€ä¹ˆæ˜¯â€å†·åœŸè±†è·¯ç”±â€ä¸â€çƒ­åœŸè±†è·¯ç”±â€?</h1><ul>
<li>å‚è§: <a href="https://docs.microsoft.com/zh-cn/azure/virtual-network/ip-services/routing-preference-overview">å†·åœŸè±†è·¯ç”±&amp;çƒ­åœŸè±†è·¯ç”±</a></li>
<li>çƒ­åœŸè±†:<ul>
<li>å…¥å£æµé‡: å¦‚æœæ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·è®¿é—®æ‰˜ç®¡åœ¨èŠåŠ å“¥çš„ Azure èµ„æºï¼Œåˆ™æµé‡å°†é€šè¿‡å…¬å…± Internet ä¼ è¾“ï¼Œå¹¶è¿›å…¥èŠåŠ å“¥çš„ Microsoft å…¨çƒç½‘ç»œã€‚</li>
<li>å‡ºå£æµé‡: å‡ºå£æµé‡éµå¾ªç›¸åŒçš„åŸåˆ™ã€‚ æµé‡ä¼šåœ¨æ‰˜ç®¡æœåŠ¡çš„åŒä¸€åŒºåŸŸé€€å‡º Microsoft ç½‘ç»œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ¥è‡ª Azure èŠåŠ å“¥æœåŠ¡çš„æµé‡æœ€ç»ˆä¼ è¾“ç»™æ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·ï¼Œæµé‡å°†ç¦»å¼€èŠåŠ å“¥çš„ Microsoft ç½‘ç»œï¼Œå¹¶é€šè¿‡å…¬å…± Internet ä¼ è¾“ç»™æ–°åŠ å¡çš„ç”¨æˆ·ã€‚</li>
</ul>
</li>
<li>å†·åœŸè±†:<ul>
<li>å…¥å£æµé‡: å¦‚æœæ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·è®¿é—®æ‰˜ç®¡åœ¨ç¾å›½èŠåŠ å“¥çš„ Azure èµ„æºï¼Œåˆ™æµé‡å°†è¿›å…¥ä½äºæ–°åŠ å¡ Edge POP çš„ Microsoft å…¨çƒç½‘ç»œï¼Œå¹¶é€šè¿‡ Microsoft ç½‘ç»œä¼ è¾“åˆ°æ‰˜ç®¡åœ¨èŠåŠ å“¥çš„æœåŠ¡ã€‚</li>
<li>å‡ºå£æµé‡: å¦‚æœæ¥è‡ª Azure èŠåŠ å“¥çš„æµé‡æœ€ç»ˆä¼ è¾“ç»™æ¥è‡ªæ–°åŠ å¡çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæµé‡å°±ä¼šé€šè¿‡ Microsoft ç½‘ç»œä»èŠåŠ å“¥ä¼ è¾“åˆ°æ–°åŠ å¡ï¼Œå¹¶é€€å‡ºä½äºæ–°åŠ å¡ Edge POP çš„ Microsoft ç½‘ç»œã€‚</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>linux</tag>
        <tag>iaas</tag>
        <tag>network</tag>
        <tag>cloud-computing</tag>
        <tag>nat</tag>
        <tag>pat</tag>
      </tags>
  </entry>
  <entry>
    <title>Java&amp;JVM&amp;OQL&amp;MVN å¸¸ç”¨å‘½ä»¤ä¸è„šæœ¬æ€»ç»“</title>
    <url>//2022-07-01-java-jvm/</url>
    <content><![CDATA[<h1 id="Java-amp-JVM"><a href="#Java-amp-JVM" class="headerlink" title="Java&amp;JVM"></a>Java&amp;JVM</h1><h2 id="æ‰“-HeapDump"><a href="#æ‰“-HeapDump" class="headerlink" title="æ‰“ HeapDump"></a>æ‰“ HeapDump</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jmap -dump:live,file<span class="token operator">=</span>heapdump.phrof <span class="token variable">$pid</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æˆ–è€…</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jmap -dump:live,file<span class="token operator">=</span>heapdump.phrof -F <span class="token variable">$pid</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<mark>å°½é‡ä¸è¦ä½¿ç”¨-Få‚æ•°ã€‚</mark> å› ä¸º-Fä½¿ç”¨çš„æ˜¯Linuxæ“ä½œç³»ç»Ÿå±‚é¢çš„å®ç°ï¼Œè€Œä¸æ˜¯JVMå±‚é¢çš„å®ç°ï¼Œä¼šå¯¼è‡´ æ‰“å°å †ä¿¡æ¯å¾ˆæ…¢ã€‚<br/><br>å¦‚æœæç¤ºç¬¬ä¸€ç§æ–¹å¼æ‰“å°ä¸å‡ºæ¥å †çš„ä¿¡æ¯ï¼Œéœ€è¦å¢åŠ -Fï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæ£€æŸ¥ä¸‹ï¼š</p>
<ol>
<li>Javaåº”ç”¨è¿›ç¨‹çš„user_nameæ˜¯å¦ä¸å½“å‰çš„user_nameç›¸åŒï¼Ÿ å¦‚æœä¸åŒï¼Œéœ€è¦åˆ‡æ¢ä¸ºåŒä¸€ä¸ªè´¦å·ã€‚</li>
<li>Javaåº”ç”¨è¿›ç¨‹çš„Javaè·¯å¾„æ˜¯å¦ä¸å½“å‰jmapå‘½ä»¤çš„è·¯å¾„ç›¸åŒï¼Ÿ å¦‚æœä¸åŒï¼Œéœ€è¦åˆ‡æ¢ä¸ºåŒä¸€ä¸ªè·¯å¾„ã€‚</li>
</ol>
</blockquote>
<h2 id="æ‰“-ThreadDump"><a href="#æ‰“-ThreadDump" class="headerlink" title="æ‰“ ThreadDump"></a>æ‰“ ThreadDump</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jstack <span class="token variable">$pid</span> <span class="token operator">></span> tmp.jstack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>æ³¨æ„: å½“CPUåˆ©ç”¨ç‡é«˜æˆ–è€…æƒ³çœ‹ä¸‹çº¿ç¨‹å¡åœ¨å“ªé‡Œæ—¶ï¼Œ<mark>æœ€å¥½éš”å‡ ç§’å°±æ‰“ä¸€ä¸ªçº¿ç¨‹æ ˆï¼Œæ¯ä¸ªçº¿ç¨‹æ ˆéƒ½ä¿ç•™ä¸‹æ¥</mark> <br/><br>å¤šä¸ªçº¿ç¨‹æ ˆå¯¹æ¯”èµ·æ¥çœ‹ï¼Œä¼šæ›´èƒ½æ›´å¥½åœ°å‘ç°é—®é¢˜ã€‚</p>
</blockquote>
<h2 id="æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯"><a href="#æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯"></a>æŸ¥çœ‹æ¶ˆè€—CPUæ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯</h2><p>éœ€è¦ä¸ThreadDumpä¸€èµ·ä½¿ç”¨ï¼Œæ‰èƒ½å®šä½åˆ°å…·ä½“æ˜¯Javaä¸­å“ªä¸ªçº¿ç¨‹ã€‚</p>
<ol>
<li>æŸ¥çœ‹æ¶ˆè€—cpuæ—¶é—´ç‰‡æœ€å¤šçš„è¿›ç¨‹å·<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// æŸ¥çœ‹ç¬æ—¶æ¶ˆè€—CPUï¼Œå€’åºæ’åˆ—
<span class="token function">top</span> -o %CPU
// æŸ¥çœ‹ç´¯è®¡æ¶ˆè€—CPUæ—¶é—´ç‰‡ï¼Œå€’åºæ’åˆ—
<span class="token function">top</span> -o TIME+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">top</span> -o %CPU
<span class="token function">top</span> - <span class="token number">21</span>:39:35 up <span class="token number">10</span>:52,  <span class="token number">1</span> user,  load average: <span class="token number">1.47</span>, <span class="token number">1.36</span>, <span class="token number">1.14</span>
Tasks: <span class="token number">325</span> total,   <span class="token number">4</span> running, <span class="token number">320</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">1</span> zombie
%Cpu0  <span class="token builtin class-name">:</span>  <span class="token number">8.2</span> us,  <span class="token number">4.1</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">87.4</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.3</span> si,  <span class="token number">0.0</span> st
%Cpu1  <span class="token builtin class-name">:</span>  <span class="token number">7.5</span> us,  <span class="token number">3.8</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">88.7</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st
%Cpu2  <span class="token builtin class-name">:</span> <span class="token number">11.6</span> us,  <span class="token number">2.7</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">85.4</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.3</span> si,  <span class="token number">0.0</span> st
%Cpu3  <span class="token builtin class-name">:</span>  <span class="token number">8.4</span> us,  <span class="token number">3.0</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">88.6</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st
MiB Mem <span class="token builtin class-name">:</span>   <span class="token number">7823.4</span> total,    <span class="token number">172.0</span> free,   <span class="token number">5254.4</span> used,   <span class="token number">2397.0</span> buff/cache
MiB Swap:   <span class="token number">2048.0</span> total,    <span class="token number">252.2</span> free,   <span class="token number">1795.7</span> used.   <span class="token number">1107.3</span> avail Mem 

    PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                      
   <span class="token number">2318</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178536</span> <span class="token number">247920</span>  <span class="token number">52372</span> R  <span class="token number">12.5</span>   <span class="token number">3.1</span>  <span class="token number">24</span>:33.00 gnome-shell                                  
   <span class="token number">2099</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">1008428</span> <span class="token number">112204</span>  <span class="token number">78172</span> R  <span class="token number">11.2</span>   <span class="token number">1.4</span>  <span class="token number">23</span>:31.71 Xorg                                         
   <span class="token number">6521</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">868244</span>  <span class="token number">35580</span>  <span class="token number">23924</span> R   <span class="token number">5.9</span>   <span class="token number">0.4</span>   <span class="token number">0</span>:38.61 gnome-terminal-                              
   <span class="token number">5308</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">6370752</span> <span class="token number">517952</span> <span class="token number">219108</span> S   <span class="token number">2.6</span>   <span class="token number">6.5</span>  <span class="token number">39</span>:38.79 firefox                                      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>æŸ¥çœ‹è¿›ç¨‹ä¸‹æ¶ˆè€—æ—¶é—´ç‰‡æœ€å¤šçš„çº¿ç¨‹å·</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">top</span> -Hp <span class="token variable">$pid</span> -o %CPU
<span class="token function">top</span> -Hp <span class="token variable">$pid</span> -o TIME+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token function">top</span> -Hp <span class="token number">2318</span>
<span class="token function">top</span> - <span class="token number">21</span>:42:00 up <span class="token number">10</span>:55,  <span class="token number">1</span> user,  load average: <span class="token number">1.08</span>, <span class="token number">1.38</span>, <span class="token number">1.19</span>
Threads:  <span class="token number">15</span> total,   <span class="token number">0</span> running,  <span class="token number">15</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie
%Cpu<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:  <span class="token number">5.7</span> us,  <span class="token number">1.9</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">92.3</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.1</span> si,  <span class="token number">0.0</span> st
MiB Mem <span class="token builtin class-name">:</span>   <span class="token number">7823.4</span> total,    <span class="token number">158.1</span> free,   <span class="token number">5264.5</span> used,   <span class="token number">2400.9</span> buff/cache
MiB Swap:   <span class="token number">2048.0</span> total,    <span class="token number">250.8</span> free,   <span class="token number">1797.2</span> used.   <span class="token number">1092.3</span> avail Mem 

    PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                      
   <span class="token number">2318</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178588</span> <span class="token number">247724</span>  <span class="token number">52288</span> S   <span class="token number">5.7</span>   <span class="token number">3.1</span>  <span class="token number">24</span>:28.42 gnome-shell                                  
   <span class="token number">2331</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178588</span> <span class="token number">247724</span>  <span class="token number">52288</span> S   <span class="token number">0.0</span>   <span class="token number">3.1</span>   <span class="token number">0</span>:00.34 gmain                                        
   <span class="token number">2335</span> davywal+  <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">5178588</span> <span class="token number">247724</span>  <span class="token number">52288</span> S   <span class="token number">0.0</span>   <span class="token number">3.1</span>   <span class="token number">0</span>:11.10 gdbus                                        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>å°†10è¿›åˆ¶è½¬æˆ16è¿›åˆ¶<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">printf</span> <span class="token string">'%x\n'</span> <span class="token environment constant">$PPID</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// <span class="token number">10</span>è¿›åˆ¶è½¬æˆ16è¿›åˆ¶
davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token builtin class-name">printf</span> <span class="token string">'%x\n'</span> <span class="token number">2318</span>
90e

// <span class="token number">16</span>è¿›åˆ¶è½¬æˆ10è¿›åˆ¶
davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ <span class="token builtin class-name">printf</span> <span class="token string">'%d\n'</span> 0x90e
<span class="token number">2318</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>æŸ¥çœ‹jstackä¸­å¯¹åº”çš„çº¿ç¨‹ä¿¡æ¯</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">fgrep</span> <span class="token string">"0x90e"</span> tmp.jstack -C <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="æŸ¥çœ‹JVMé»˜è®¤HeapSize"><a href="#æŸ¥çœ‹JVMé»˜è®¤HeapSize" class="headerlink" title="æŸ¥çœ‹JVMé»˜è®¤HeapSize"></a>æŸ¥çœ‹JVMé»˜è®¤HeapSize</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -XX:+PrintFlagsFinal -version <span class="token operator">|</span> <span class="token function">fgrep</span> HeapSize
// æŸ¥çœ‹java_home, class_pathç­‰é»˜è®¤é…ç½®ä¸ç³»ç»Ÿç¯å¢ƒå˜é‡
java -XshowSettings:all<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>å¦‚ä¸‹ï¼Œé»˜è®¤HeapSizeä¸º130023424&#x2F;1024&#x2F;1024&#x3D;124MB<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ java -XX:+PrintFlagsFinal -version <span class="token operator">|</span> <span class="token function">fgrep</span> HeapSize
    uintx ErgoHeapSizeLimit                         <span class="token operator">=</span> <span class="token number">0</span>                                   <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
    uintx HeapSizePerGCThread                       <span class="token operator">=</span> <span class="token number">87241520</span>                            <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
    uintx InitialHeapSize                          :<span class="token operator">=</span> <span class="token number">130023424</span>                           <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
    uintx LargePageHeapSizeThreshold                <span class="token operator">=</span> <span class="token number">134217728</span>                           <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
    uintx MaxHeapSize                              :<span class="token operator">=</span> <span class="token number">2051014656</span>                          <span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span>
openjdk version <span class="token string">"1.8.0_312"</span>
OpenJDK Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_312-8u312-b07-0ubuntu1~20.04-b07<span class="token punctuation">)</span>
OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.312</span>-b07, mixed mode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~$ java -XshowSettings:all
VM settings:
    Max. Heap Size <span class="token punctuation">(</span>Estimated<span class="token punctuation">)</span>: <span class="token number">1</span>.70G
    Ergonomics Machine Class: server
    Using VM: OpenJDK <span class="token number">64</span>-Bit Server VM

Property settings:
    awt.toolkit <span class="token operator">=</span> sun.awt.X11.XToolkit
    file.encoding <span class="token operator">=</span> UTF-8
    file.encoding.pkg <span class="token operator">=</span> sun.io<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="OQL"><a href="#OQL" class="headerlink" title="OQL"></a>OQL</h1><ul>
<li><p><a href="https://wiki.eclipse.org/MemoryAnalyzer/OQL">å¦‚ä½•ä½¿ç”¨OQL</a></p>
</li>
<li><p>æŸ¥è¯¢æŸè§„æ ¼ç±»çš„å¯¹è±¡</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æŸ¥è¯¢å¯¹è±¡æŸä¸ªå±æ€§(è¿™é‡Œåªèƒ½æ ¹æ®ç±», æŸ¥åˆ°è¯¥ç±»ä¸‹æ‰€æœ‰å¯¹è±¡çš„å±æ€§)</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>initd<span class="token punctuation">,</span> t<span class="token punctuation">.</span>initAsyn<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>publicCloud<span class="token punctuation">)</span><span class="token punctuation">,</span> namespace<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>regionId<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>useNuwa<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaConfigDns<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaCluster<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>rootPath<span class="token punctuation">)</span> <span class="token keyword">FROM</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æŸ¥è¯¢å¯¹è±¡æŸä¸ªå±æ€§(å¦‚ä½•æ ¹æ®å¯¹è±¡ID, ç²¾ç¡®æŸ¥è¯¢åˆ°è¯¥å¯¹è±¡çš„æŸäº›å±æ€§?)</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> t<span class="token punctuation">.</span>initd<span class="token punctuation">,</span> t<span class="token punctuation">.</span>initAsyn<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>publicCloud<span class="token punctuation">)</span><span class="token punctuation">,</span> namespace<span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>regionId<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>useNuwa<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaConfigDns<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>nuwaCluster<span class="token punctuation">)</span><span class="token punctuation">,</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>rootPath<span class="token punctuation">)</span> <span class="token keyword">FROM</span> OBJECTS <span class="token number">0x7480633e0</span> t<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æ ¹æ®ç±»çš„hashåœ°å€, è·å–å¯¹åº”å®ä¾‹</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> instanceof <span class="token number">0x733ccc9f0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æ ¹æ®å¯¹è±¡hashå€¼è·å–å¯¹è±¡ä¿¡æ¯</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span>  OBJECTS <span class="token number">0xdc2819e0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>æ ¹æ®æ¡ä»¶ç­›é€‰å‡ºå¯¹è±¡ä¿¡æ¯</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl t <span class="token keyword">where</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>hostType<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"ddh.ebmec3metest"</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>UserServiceImpl t <span class="token keyword">where</span> toString<span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"28745-27"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><ul>
<li><p>ä¸‹è½½æºä»£ç . æœ‰æ—¶å€™IDEæ— æ³•è‡ªåŠ¨ä¸‹è½½jaråŒ…çš„æºä»£ç , æ­¤æ—¶ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°±èƒ½ä¸‹è½½</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn dependency:sources<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>ç¼–è¯‘æºç .</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn clean compile -DskipTests<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>ç¼–è¯‘æºç , ä¸”æŠŠç¼–è¯‘çš„jaråŒ…ç­‰äº§ç‰©å®‰è£…åˆ°æœ¬åœ°Repoä¸­.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn clean <span class="token function">install</span> -DskipTests<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>å¼ºåˆ¶é‡æ–°ä¸‹è½½SNAPSHOTåŒ…</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn clean compile -U<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>ä¸å†è”ç½‘ä¸‹è½½ä¾èµ–, å³offline mode</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. å…ˆéªŒè¯æ‰€æœ‰ä¾èµ–éƒ½ä¸‹è½½åˆ°äº†æœ¬åœ°</span>
<span class="token comment"># mvn dependency:go-offline</span>

<span class="token comment"># 2. å†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤, å¼€å¯offlineç¼–è¯‘æ¨¡å¼</span>
<span class="token comment"># mvn -o install</span>
<span class="token comment"># mvn -offline install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>ä¾èµ–è§£æç›¸å…³</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŠŠä¾èµ–æ ‘æ‰“å°å‡ºæ¥</span>
<span class="token comment"># mvn dependency:tree</span>

<span class="token comment"># åˆ†ææ— ç”¨çš„ä¾èµ–</span>
<span class="token comment"># mvn dependency: analyze</span>

<span class="token comment"># åˆ†æé‡å¤çš„ä¾èµ–</span>
<span class="token comment"># mvn dependency:analyze-duplicate</span>

<span class="token comment"># å½“ä½¿ç”¨shellè„šæœ¬æ‰§è¡Œjarå‘½ä»¤å¯åŠ¨é¡¹ç›®æ—¶, éœ€è¦æŠŠé¡¹ç›®ä¾èµ–çš„jaråŒ…éƒ½æ”¾åˆ°classpathå‚æ•°ä¸‹. </span>
<span class="token comment"># ä½†äººè‚‰ä¸€ä¸ªä¸€ä¸ªåŠ å¾ˆéº»çƒ¦, æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°±æŠŠæ‰€æœ‰jaråŒ…å…¨è·¯å¾„éƒ½æ‹¼æ¥æ‰“å°å‡ºæ¥. </span>
<span class="token comment"># mvn dependency:build-classpath</span>

<span class="token comment"># æŠŠæ‰€æœ‰è§£æå¥½çš„ä¾èµ–, å¹³é“ºæ‰“å°</span>
<span class="token comment"># mvn dependency:resolve</span>

<span class="token comment"># åˆ—å‡ºæ‰€æœ‰é…ç½®å¥½çš„remote repo</span>
<span class="token comment"># mvn dependency:list-repositories</span>

<span class="token comment"># æŠŠé¡¹ç›®æ‰€æœ‰ä¾èµ–çš„jaråŒ…éƒ½æ‹·è´åˆ°ç›®æ ‡ç›®å½•ä¸‹</span>
<span class="token comment"># mvn dependency:copy-dependencies -DoutputDirectory="~/lib/"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>java</tag>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡Dubboåº”ç”¨æ€§èƒ½ä¼˜åŒ–</title>
    <url>//2022-07-02-dubbo-app-perf-tunning/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æ–°çš„åº”ç”¨ä»¥dubboæ¥å£å¯¹å¤–æš´éœ²è°ƒåº¦èƒ½åŠ›ã€‚<br>åœ¨ä¸Šçº¿å‰éœ€è¦æ•´ä½“å‹æµ‹ï¼Œç¡®è®¤ä¸‹ç³»ç»Ÿèƒ½åŠ›ä¸ç“¶é¢ˆã€‚</p>
<h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>ç›®æ ‡QPS: 500+<br>ç›®æ ‡RT: 100ms-</p>
<h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042216549.png"></p>
<h2 id="åº”ç”¨æ¡†æ¶"><a href="#åº”ç”¨æ¡†æ¶" class="headerlink" title="åº”ç”¨æ¡†æ¶"></a>åº”ç”¨æ¡†æ¶</h2><ul>
<li>SpringBoot 2.5.6</li>
<li>Druid 1.1.22</li>
</ul>
<h2 id="æœºå™¨é…ç½®æ¸…å•"><a href="#æœºå™¨é…ç½®æ¸…å•" class="headerlink" title="æœºå™¨é…ç½®æ¸…å•"></a>æœºå™¨é…ç½®æ¸…å•</h2><ul>
<li>ECSè§„æ ¼ï¼š ecs.n4.2xlarge</li>
<li>2å°8C16G ç‹¬äº«å‹</li>
<li>CPU: 2.5 GHzä¸»é¢‘çš„Intel Â® Xeon Â®å¤„ç†å™¨</li>
<li>JDK 1.8</li>
<li>ç½‘ç»œï¼š 1.2Gbpsï¼Œå³è‡³å°‘æ”¯æŒ100MB&#x2F;sçš„å†…ç½‘å¸¦å®½</li>
</ul>
<h2 id="ä¸­é—´ä»¶é…ç½®æ¸…å•"><a href="#ä¸­é—´ä»¶é…ç½®æ¸…å•" class="headerlink" title="ä¸­é—´ä»¶é…ç½®æ¸…å•"></a>ä¸­é—´ä»¶é…ç½®æ¸…å•</h2><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><ul>
<li>è§„æ ¼ï¼š8C32GB</li>
<li>æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°é‡ï¼š30000</li>
<li>Hoståˆ°Redisçš„Pingå»¶æ—¶åœ¨1msä»¥å†…</li>
</ul>
<h3 id="DB-x2F-RDS"><a href="#DB-x2F-RDS" class="headerlink" title="DB&#x2F;RDS"></a>DB&#x2F;RDS</h3><ul>
<li>è§„æ ¼ï¼šmysql.x4.4xlarge.2 32C128GB</li>
<li>MySQL 5.7</li>
<li>æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°é‡ï¼š20000</li>
<li>Hoståˆ°DBçš„Pingå»¶æ—¶åœ¨1msä»¥å†…</li>
</ul>
<h1 id="å‹æµ‹è®°å½•"><a href="#å‹æµ‹è®°å½•" class="headerlink" title="å‹æµ‹è®°å½•"></a>å‹æµ‹è®°å½•</h1><h2 id="ç¬¬ä¸€è½®å‹æµ‹"><a href="#ç¬¬ä¸€è½®å‹æµ‹" class="headerlink" title="ç¬¬ä¸€è½®å‹æµ‹"></a>ç¬¬ä¸€è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ"><a href="#å‹æµ‹ç»“æœ" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul>
<li>å‹åˆ°140QPSæ—¶ï¼Œ RTå·²ç»é£™å‡åˆ°8s+ï¼›</li>
</ul>
<h3 id="å…¶ä»–æŒ‡æ ‡"><a href="#å…¶ä»–æŒ‡æ ‡" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul>
<li>cpu: å·²ç»åŸºæœ¬è·‘æ»¡äº†ï¼Œåˆ©ç”¨ç‡780+%ï¼›</li>
<li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li>
<li>ç½‘ç»œï¼š æ€»ä½“å…¥æµé‡åœ¨10Mbpsä»¥ä¸‹ï¼Œå‡ºæµé‡1Mbpsä»¥ä¸‹ï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li>
<li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li>
<li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li>
</ul>
<h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>æ ¹æ®åº”ç”¨æ—¥å¿—ï¼Œå‘ç°æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>Redisè®¿é—®<ul>
<li>å•æ¬¡schedule()è¯·æ±‚ï¼Œä¼šè¿ç»­ä¸²è¡Œè°ƒç”¨40+æ¬¡çš„redis getæ¥å£ã€‚</li>
<li>è¿™äº›ä¸²è¡Œçš„getè°ƒç”¨ï¼ŒåŠ èµ·æ¥å¹³å‡è€—æ—¶åœ¨6s+</li>
</ul>
</li>
<li>å…¶ä»–é—®é¢˜ï¼š<ul>
<li>apache.utilä¸­Pairç±»å‹åºåˆ—åŒ–é—®é¢˜</li>
</ul>
</li>
</ul>
<h3 id="Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ"><a href="#Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ" class="headerlink" title="Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ"></a>Redisè®¿é—®é€Ÿåº¦æ…¢é—®é¢˜åˆ†æ</h3><h4 id="æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ"><a href="#æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ" class="headerlink" title="æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ"></a>æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Ÿ</h4><p>æŸ¥çœ‹äº†RedisæœåŠ¡ç«¯æ•´ä½“æ€§èƒ½æƒ…å†µï¼š</p>
<ul>
<li>å‡ºå£å¸¶å¯¬çˆ²100MBï¼Œç•¶æ™‚åªåˆ©ç”¨äº†10%å·¦å³</li>
<li>CPU Usage 14% å·¦å³</li>
<li>é€£æ¥æ•¸ï¼šæœ€å¤§æ”¯æŒ30000ï¼Œç•¶æ™‚åªæœ‰3å€‹ç©©å®šçš„é€£æ¥</li>
<li>QPS: é«˜å³¯æœŸQPSçˆ²6000ï¼Œè€Œå¯¦ä¾‹çš„maxçˆ²24wï¼Œä½¿ç”¨ç‡åƒ…çˆ²2.5%ï¼Œé é æ²’æœ‰é”åˆ°é™æµé–¾å€¼</li>
</ul>
<h4 id="æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ"><a href="#æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ" class="headerlink" title="æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ"></a>æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Ÿ</h4><ul>
<li>ç¶²çµ¡æµé‡ï¼š10MBå·¦å³ï¼Œé é æ²’æœ‰æ‰“æ»¿ã€‚</li>
<li>Load: å¾ˆä½ï¼Œ0.2ä»¥ä¸‹</li>
</ul>
<h4 id="å•é¡Œå®šä½"><a href="#å•é¡Œå®šä½" class="headerlink" title="å•é¡Œå®šä½"></a>å•é¡Œå®šä½</h4><p>åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œä¸€èˆ¬å°±åªèƒ½æ‡·ç–‘æ˜¯clienté€£æ¥å•é¡Œã€‚é¡ä¼¼HttpClientï¼Œå®¢æˆ¶ç«¯è«‹æ±‚éƒ½åœ¨æ’éšŠç­‰ç€ç²å–connectionã€‚</p>
<ul>
<li>æ–¹æ¡ˆ1ï¼š å¢å¤§é€£æ¥æ± é…ç½®ï¼Œå¢å¤§æœ€å¤§é€£æ¥æ•¸é‡ã€‚</li>
<li>æ–¹æ¡ˆ2ï¼š æ¸›å°‘è«‹æ±‚æ¬¡æ•¸</li>
</ul>
<h3 id="ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul>
<li>Redisä¼˜åŒ–ï¼š<ul>
<li>é‡‡ç”¨äº†æ–¹æ¡ˆ2ï¼š ä½¿ç”¨Redisçš„mgetï¼Œè€Œä¸æ˜¯å•ä¸ªgetã€‚ä»¥å‡å°‘ç½‘ç»œäº¤äº’</li>
<li>ä¸ºå•¥æ²¡é‡‡ç”¨æ–¹æ¡ˆ1ï¼Ÿ <blockquote>
<p>å› ä¸º SpringBoot 1.5.x ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨Jedisä½œä¸ºredis clientï¼Œæ¯”è¾ƒå¥½è°ƒæ•´connectionæ•°é‡ç­‰ã€‚<br/><br>ä½† SpringBoot 2.x ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨äº†Lettuceä½œä¸ºredis clientï¼Œæœ¬èº«åŸºäºNettyçš„å¼‚æ­¥IOæ–¹å¼å®ç°ï¼Œä¸Jedisä¸åŒï¼Œæœ¬èº«å°±æ”¯æŒå•ä¸ªè¿æ¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚<br>æ‰€ä»¥å®˜æ–¹ä¸å»ºè®®é…ç½®è¿æ¥æ± ã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042214249.png"></p>
<ul>
<li>å…¶ä»–é—®é¢˜ä¼˜åŒ–<ul>
<li>è‡ªå·±é‡æ–°å®ç°äº†ä¸€ç‰ˆPairç±»å‹çš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–æ–¹å¼</li>
</ul>
</li>
</ul>
<h2 id="ç¬¬äºŒè½®å‹æµ‹"><a href="#ç¬¬äºŒè½®å‹æµ‹" class="headerlink" title="ç¬¬äºŒè½®å‹æµ‹"></a>ç¬¬äºŒè½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-1"><a href="#å‹æµ‹ç»“æœ-1" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul>
<li>åœ¨250QPSæ—¶ï¼ŒRTåŸºæœ¬ç¨³å®šåœ¨100msä»¥ä¸‹</li>
<li>å‹åˆ°300QPSæ—¶ï¼ŒRTçªç„¶é£™å‡åˆ°3s+</li>
<li>cpuåˆ©ç”¨ç‡è¾ƒä½</li>
<li>å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³</li>
<li>æ²¡æœ‰å‘ç”ŸGC</li>
</ul>
<h3 id="åŸå› åˆ†æ-1"><a href="#åŸå› åˆ†æ-1" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>æ ¹æ®æ—¥å¿—æ‰“ç‚¹ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°å½“æ—¶çš„ç“¶é¢ˆå°±åœ¨ram-clientè°ƒç”¨é‰´æƒæœåŠ¡é‰´æƒä¸Šã€‚</p>
<ul>
<li>RAMæ¥å£é—®é¢˜ï¼š</li>
</ul>
<h3 id="ä¼˜åŒ–æ–¹æ¡ˆ-1"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ-1" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul>
<li>RAM Clientä¼˜åŒ–ï¼š<ul>
<li>å¢å¤§clientçš„max-connectionsæ•°é‡ï¼Œå¢å¤§åˆ°300ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸ªæ’æ›²ï¼Œå½“å¢å¤§clientçš„max-connectionsæ•°é‡åˆ°300ä¹‹åï¼Œé‡æ–°è¿›è¡Œäº†ä¸€æ¬¡å‹æµ‹ï¼Œå‘ç°QPSå¹¶æ²¡æœ‰æå‡ï¼ŒRTçš„ç“¶é¢ˆä»ç„¶åœ¨è®¿é—®RAMä¸Šï¼ <br/><br>åç»­çœ‹äº†ram-clientçš„å‘å¸ƒè®°å½•ï¼Œå‘ç°å±äºram-clientçš„ä¸€ä¸ªbugã€‚<br/><br>ram-clientä½¿ç”¨äº†http-clientä½œä¸ºå†…éƒ¨å®ç°ã€‚<br/><br>å½“å‰ç‰ˆæœ¬ä¸­ï¼Œå¢å¤§max-connectionsæ•°é‡ï¼Œåªæ˜¯å¢å¤§äº†httpclientå…¨å±€æ”¯æŒçš„connectionæ•°é‡ï¼Œè€Œå•ä¸ªhostæ”¯æŒçš„connectionæ•°é‡ä»ç„¶æ˜¯é»˜è®¤å€¼ï¼Œå³8. <br/><br>ç”±äºè®¿é—®ramçš„endpointå°±æ˜¯å•ä¸ªhostï¼Œå› æ­¤ç›¸å½“äºè¯¥é…ç½®æ²¡æœ‰ç”Ÿæ•ˆï¼ <br/><br>åç»­å‡çº§äº†ram-clientç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬å®ç°é‡Œï¼Œå°†max-connectionså€¼åŒæ—¶èµ‹ç»™äº†max-connections-per-hostï¼Œå› æ­¤ç›¸å½“äºmax-connections-per-hostä¹Ÿè¢«è°ƒå¤§ä¸º300äº†<br/><br>å…³äºmax-connectionsä¸max-connections-per-hostå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼Œå‚è§ï¼š <a href="https://davyjones2010.github.io/2022-03-15-http-client-netty/">å¼‚æ­¥HttpClientä½¿ç”¨Nettyä½œä¸ºSocketChannelçš„Provider</a></p>
</blockquote>
<h2 id="ç¬¬ä¸‰è½®å‹æµ‹"><a href="#ç¬¬ä¸‰è½®å‹æµ‹" class="headerlink" title="ç¬¬ä¸‰è½®å‹æµ‹"></a>ç¬¬ä¸‰è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-2"><a href="#å‹æµ‹ç»“æœ-2" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul>
<li><p>200QPS, 80ms RT</p>
</li>
<li><p>300QPSï¼Œ2000ms RT</p>
</li>
<li><p>ç»“æœä¸ä¸Šè½®ç›¸æ¯”ï¼Œå¹¶æ²¡æœ‰æ˜¾è‘—æå‡ã€‚</p>
</li>
<li><p>æ ¹æ®æ—¥å¿—åˆ†æï¼Œramclientè€—æ—¶å·²ç»è¶‹äºå¹³ç¨³ï¼Œå¹³å‡10msä»¥ä¸‹ï¼Œè°ƒåº¦è€—æ—¶åˆä¸Šæ¥äº†ã€‚</p>
</li>
</ul>
<h3 id="å…¶ä»–æŒ‡æ ‡-1"><a href="#å…¶ä»–æŒ‡æ ‡-1" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul>
<li>cpu: åˆ©ç”¨ç‡è¾ƒé«˜ï¼Œ780%+</li>
<li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li>
<li>ç½‘ç»œï¼š æ€»ä½“æµé‡åœ¨10Mbpsï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li>
<li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li>
<li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li>
</ul>
<h3 id="åŸå› åˆ†æ-2"><a href="#åŸå› åˆ†æ-2" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042215103.png"><br>æ ¹æ®å½“æ—¶çš„çº¿ç¨‹å †æ ˆåˆ†æï¼Œå ç”¨CPUé‡æœ€å¤§çš„å°±æ˜¯8ä¸ªlettuceçº¿ç¨‹ï¼Œå‡ ä¹æŠŠCPUæ—¶é—´ç‰‡å æ»¡äº†ã€‚<br>åŒæ—¶æœç´¢äº†ç›¸å…³é—®é¢˜ ï¼Œå‘ç°<a href="https://gitter.im/lettuce-io/Lobby?at=5de8f93446397c721c8ed8ed">ä¸æ˜¯ä¸ªä¾‹</a>ã€‚<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042215636.png"></p>
<h3 id="ä¼˜åŒ–æ–¹æ¡ˆ-2"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ-2" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul>
<li>Redis:<ul>
<li>ä½¿ç”¨Jedisä½œä¸ºClientï¼Œå¹¶ä¸”è°ƒå¤§Jediså¯¹åº”çš„è¿æ¥æ± æ•°é‡</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.redis.client-type</span><span class="token punctuation">=</span><span class="token value attr-value">jedis</span>
<span class="token key attr-name">spring.redis.jedis.pool.max-active</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>
<span class="token key attr-name">spring.redis.jedis.pool.max-idle</span><span class="token punctuation">=</span><span class="token value attr-value">16</span>
<span class="token key attr-name">spring.redis.jedis.pool.max-wait</span><span class="token punctuation">=</span><span class="token value attr-value">10000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="ç¬¬å››è½®å‹æµ‹"><a href="#ç¬¬å››è½®å‹æµ‹" class="headerlink" title="ç¬¬å››è½®å‹æµ‹"></a>ç¬¬å››è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-3"><a href="#å‹æµ‹ç»“æœ-3" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul>
<li>300QPSï¼Œ100ms RT</li>
<li>350QPSï¼Œ200ms RT</li>
<li>400QPSï¼Œ2000ms RT</li>
</ul>
<h3 id="å…¶ä»–æŒ‡æ ‡-2"><a href="#å…¶ä»–æŒ‡æ ‡-2" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul>
<li>cpu: åˆ©ç”¨ç‡è¾ƒé«˜ï¼Œ780%+</li>
<li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li>
<li>ç½‘ç»œï¼š æ€»ä½“æµé‡åœ¨10Mbpsï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li>
<li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li>
<li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li>
</ul>
<h3 id="åŸå› åˆ†æ-3"><a href="#åŸå› åˆ†æ-3" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>æ‰“å°å‡ºäº†å½“æ—¶çš„çº¿ç¨‹æ ˆä¿¡æ¯ï¼Œè¿›è¡Œäº†è¯¦ç»†çš„åˆ†æå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>çº¿ç¨‹æ•°é‡</th>
</tr>
</thead>
<tbody><tr>
<td>ç²å–Druidé€£æ¥</td>
<td>442</td>
</tr>
<tr>
<td>æ­¸é‚„Druidé€£æ¥</td>
<td>164</td>
</tr>
<tr>
<td>æ¥­å‹™ç·šç¨‹ä¸­Bindæ“ä½œ</td>
<td>107</td>
</tr>
<tr>
<td>Log4jæ‰“å°</td>
<td>77</td>
</tr>
<tr>
<td>JedisåŸ·è¡Œ</td>
<td>2</td>
</tr>
</tbody></table>
<ul>
<li>å¤§éƒ¨åˆ†çº¿ç¨‹å¡åœ¨Druidæ•°æ®åº“è¿æ¥æ± å½’è¿˜è¿æ¥ã€è·å–è¿æ¥çš„æ¶é–é˜¶æ®µï¼ˆlock()ï¼‰</li>
<li>å°éƒ¨åˆ†çº¿ç¨‹ç”±äºbind()å¼‚æ­¥çº¿ç¨‹æ± é˜Ÿåˆ—æ»¡ï¼Œå¯¼è‡´å ç”¨äº†ä¸šåŠ¡çº¿ç¨‹</li>
<li>æœ€åä¸€éƒ¨åˆ†çº¿ç¨‹å¡ï¼ˆblockedï¼‰åœ¨log4jæ‰“å°æ—¥å¿—</li>
</ul>
<h4 id="Druidè¿æ¥æ± é—®é¢˜"><a href="#Druidè¿æ¥æ± é—®é¢˜" class="headerlink" title="Druidè¿æ¥æ± é—®é¢˜"></a>Druidè¿æ¥æ± é—®é¢˜</h4><p>èˆ‡ <a href="https://blog.csdn.net/beFocused/article/details/108533137">è®°ä¸€æ¬¡Dubboçº¿ç¨‹è€—å°½çš„é—®é¢˜-druidæ•°æ®åº“è¿æ¥æ± çªå‘æ€§èƒ½</a> æ–‡ä¸­çš„å•é¡Œä¸€æ¨¡ä¸€æ¨£ã€‚</p>
<h4 id="å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜"><a href="#å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜" class="headerlink" title="å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜"></a>å¼‚æ­¥çº¿ç¨‹é˜Ÿåˆ—æ»¡é—®é¢˜</h4><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042216269.png"></p>
<p>éšŠåˆ—é»˜èªé•·åº¦çˆ²200ï¼Œåœ¨200çš„é•·åº¦æ»¿äº†ä¹‹å¾Œï¼Œä½¿ç”¨çš„æ˜¯<code>ThreadPoolExecutor.CallerRunsPolicy</code>, å³ä¸å†åœ¨ç•°æ­¥ç·šç¨‹è£åŸ·è¡Œï¼Œè€Œæ˜¯åœ¨callerç·šç¨‹ä¸­åŸ·è¡Œã€‚<br>å¾è€Œå°è‡´æ¥­å‹™ç·šç¨‹å£“åŠ›é€²ä¸€æ­¥å¢å¤§ã€‚</p>
<h4 id="Log4jæ—¥å¿—é—®é¢˜"><a href="#Log4jæ—¥å¿—é—®é¢˜" class="headerlink" title="Log4jæ—¥å¿—é—®é¢˜"></a>Log4jæ—¥å¿—é—®é¢˜</h4><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207042216085.png"><br>ä¹Ÿæ˜¯æ¯”è¼ƒç¶“å…¸çš„å•é¡Œï¼Œä½¿ç”¨Log2jçš„ç•°æ­¥loggerå³å¯è§£æ±ºã€‚</p>
<h3 id="ä¼˜åŒ–æ–¹æ¡ˆ-3"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ-3" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul>
<li><p>Druidä¼˜åŒ–ï¼š </p>
<ul>
<li>å¢å¤§è¿æ¥æ± ä¸­initialä¸maxçš„è¿æ¥æ•°é‡</li>
<li>ä½¿ç”¨éå…¬å¹³é”ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„å…¬å¹³é”ã€‚å…·ä½“å‚è§<a href="https://mp.weixin.qq.com/s/RaiU9_ioWHvomZLLKuSuGw">æœ‰èµçš„å‹æµ‹è®°å½•</a>ã€‚<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.datasource.druid.maxActive</span><span class="token punctuation">=</span><span class="token value attr-value">600</span>
<span class="token key attr-name">spring.datasource.druid.initialSize</span><span class="token punctuation">=</span><span class="token value attr-value">300</span>
<span class="token key attr-name">spring.datasource.druid.maxWait</span><span class="token punctuation">=</span><span class="token value attr-value">6000</span>
<span class="token key attr-name">spring.datasource.druid.minIdle</span><span class="token punctuation">=</span><span class="token value attr-value">300</span>
<span class="token key attr-name">spring.datasource.druid.poolPreparedStatements</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">spring.datasource.druid.maxOpenPreparedStatements</span><span class="token punctuation">=</span><span class="token value attr-value">20</span>
<span class="token key attr-name">spring.datasource.druid.useUnfairLock</span><span class="token punctuation">=</span><span class="token value attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>bindçº¿ç¨‹æ± ä¼˜åŒ–ï¼š</p>
<ul>
<li>å¢å¤§é˜Ÿåˆ—å¤§å°ï¼Œä»200å¢å¤§åˆ°20000</li>
</ul>
</li>
<li><p>log4jä¼˜åŒ–ï¼š</p>
<ul>
<li>ä½¿ç”¨log4j2çš„asyncLoggerã€‚</li>
</ul>
</li>
</ul>
<h2 id="ç¬¬äº”è½®å‹æµ‹"><a href="#ç¬¬äº”è½®å‹æµ‹" class="headerlink" title="ç¬¬äº”è½®å‹æµ‹"></a>ç¬¬äº”è½®å‹æµ‹</h2><h3 id="å‹æµ‹ç»“æœ-4"><a href="#å‹æµ‹ç»“æœ-4" class="headerlink" title="å‹æµ‹ç»“æœ"></a>å‹æµ‹ç»“æœ</h3><ul>
<li>åœ¨600QPSæ—¶ï¼ŒRTåŸºæœ¬ç¨³å®šåœ¨40msä»¥ä¸‹ã€‚</li>
<li>ç”±äºæ¯æ¬¡è°ƒç”¨æ¥å£ï¼Œéƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ramé‰´æƒæ¥å£ï¼Œramæ•´ä½“é™åˆ¶å•ä¸ªç§Ÿæˆ·éœ€è¦å°äº600qpsï¼›ä¹Ÿæ‹…å¿ƒæŠŠramæ¥å£æ‰“æŒ‚æˆ–è€…è¢«ramé™æµï¼Œå› æ­¤ä¸å†ç»§ç»­å‹æµ‹ã€‚</li>
<li>æŒ‰ç…§å…¶ä»–æŒ‡æ ‡æ¨æµ‹ï¼Œ<mark> ç†è®ºä¸Šå¯ä»¥æ‰“åˆ°1000QPS+ï¼Œå³å•æœº500QPS+ </mark></li>
<li>ç»ˆäºè¾¾æ ‡äº†ï¼~ æ’’èŠ±åº†ç¥~~~</li>
</ul>
<h3 id="å…¶ä»–æŒ‡æ ‡-3"><a href="#å…¶ä»–æŒ‡æ ‡-3" class="headerlink" title="å…¶ä»–æŒ‡æ ‡"></a>å…¶ä»–æŒ‡æ ‡</h3><ul>
<li>cpu: åˆ©ç”¨ç‡è¾ƒä½ï¼Œ400%å·¦å³</li>
<li>mem: å†…å­˜å ç”¨é‡å¾ˆä½ï¼Œæ€»ä½“ç¨³å®šåœ¨34%å·¦å³ã€‚</li>
<li>ç½‘ç»œï¼š æ€»ä½“æµé‡åœ¨10Mbpsï¼Œè¿œè¿œæ²¡æœ‰æ‰“åˆ°å¸¦å®½ä¸Šé™ã€‚</li>
<li>ç£ç›˜ï¼š æ²¡æœ‰é¢‘ç¹çš„ç£ç›˜IO</li>
<li>Java: æ²¡æœ‰å‘ç”Ÿé¢‘ç¹çš„GCã€‚</li>
</ul>
<h1 id="ä¼˜åŒ–æ€»ç»“"><a href="#ä¼˜åŒ–æ€»ç»“" class="headerlink" title="ä¼˜åŒ–æ€»ç»“"></a>ä¼˜åŒ–æ€»ç»“</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>dubbo</tag>
        <tag>perf-tunning</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›æœ‰æ„æ€çš„è®°å½•-4</title>
    <url>//2022-07-03-random-snippets/</url>
    <content><![CDATA[<p>äº”çœ‹: çœ‹è¶‹åŠ¿, çœ‹å¸‚åœº, çœ‹å®¢æˆ·, çœ‹ç«äº‰, çœ‹è‡ªå·±.</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>soft-skills</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡åˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€æœºè®¾è®¡ç¼ºé™·å¯¼è‡´çš„é—®é¢˜</title>
    <url>//2022-07-06-state-machine-in-distributed-system/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><ul>
<li><p>ä¸ºæŸä¸ªå¯¹è±¡itemå»ºæ¨¡, æœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€å˜è¿, åœ¨æ•°æ®åº“ä¸­stateå­—æ®µè®°å½•:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072308671.png"></p>
</li>
<li><p>å…¶ä¸­processingè¿‡ç¨‹å¯èƒ½ä¼šæŒç»­æ—¶é—´è¾ƒä¹…, 10minå·¦å³</p>
</li>
<li><p>åœ¨æœåŠ¡ç«¯æŸä¸ªçº¿ç¨‹å“åº”è¯·æ±‚, è¯¥å¯¹è±¡å¤„äºprocessingè¿‡ç¨‹ä¸­æ—¶, æœåŠ¡å™¨å‘å¸ƒé‡å¯, å¯¼è‡´itemçŠ¶æ€ä¸€ç›´å¡åœ¨processing </p>
</li>
<li><p>è€ŒprocessingçŠ¶æ€, <strong>æœ¬èº«æ˜¯ä¸­é—´çŠ¶æ€, æ— æ³•è¿›è¡Œä»»ä½•äººè‚‰å¹²é¢„&#x2F;æ“ä½œ</strong>, ä»è€Œå¯¼è‡´åªèƒ½ä¸´æ—¶æäº¤æ•°æ®è®¢æ­£, å°†çŠ¶æ€å­—æ®µä¿®æ”¹å›â€initâ€, ç„¶åå†æ‰§è¡Œä¸€æ¬¡process.</p>
</li>
</ul>
<h1 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h1><p>ä»”ç»†æ€è€ƒäº†ä¸‹, å‘ç°è®¾è®¡çš„æ—¶å€™, æ ¹æœ¬åŸå› æ˜¯å¯¹äºä¸­é—´çŠ¶æ€æ²¡æœ‰åšå¥½å¤„ç†, å¦‚èƒŒæ™¯ä¸­ä»‹ç»çš„æœåŠ¡é‡å¯çš„å¤„ç†.<br>è€Œ<mark>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹, æœåŠ¡é‡å¯æ˜¯by designéœ€è¦è¢«æ¥å—çš„.</mark><br>è¿™é‡Œæ€è€ƒäº†ä¸‹å¯èƒ½çš„å‡ ç§å¤„ç†æ–¹å¼:</p>
<h2 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h2><ul>
<li>å¦‚ä½•åŒºåˆ†çŠ¶æ€æœºçš„ä¸­é—´çŠ¶æ€ä¸ç»ˆæ€? </li>
<li>ä¸€æ¡åŸåˆ™: <mark>ç»ˆæ€-&gt;ç»ˆæ€ä¹‹é—´, å¿…é¡»æ˜¯å¯ä»¥äººè‚‰æœ‰å…¥å£è§¦å‘çš„(è€Œä¸æ˜¯ç³»ç»Ÿè‡ªåŠ¨è§¦å‘çš„); å¿…é¡»æ˜¯å¯é‡å…¥çš„.</mark></li>
</ul>
<h2 id="æ–¹æ¡ˆ1-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€"><a href="#æ–¹æ¡ˆ1-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€" class="headerlink" title="æ–¹æ¡ˆ1: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€"></a>æ–¹æ¡ˆ1: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ä¸­é—´çŠ¶æ€</h2><ol>
<li><p>å°†processingä»çŠ¶æ€æœºä¸­åˆ é™¤æ‰, å¦‚ä¸‹: <br/><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072351350.png"></p>
</li>
<li><p>ä½¿ç”¨ åˆ†å¸ƒå¼é”&#x2F;dbå­—æ®µé” æ¥å®ç°æ’ä»–åŠŸèƒ½(å³itemåŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†, é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†ä¸€ä¸ªitemå¯¼è‡´æ­»é”&#x2F;é‡å¤è®¡ç®—ç­‰é—®é¢˜).</p>
<ol>
<li>åœ¨itemæ‰§è¡Œå‰, åŠ ä¸Šé”+é”è¶…æ—¶æ—¶é—´(å¦‚ä¾‹å­ä¸­çš„10min); å…¶ä»–çº¿ç¨‹è¦æ‰§è¡Œæ—¶, æ— æ³•æŠ¢åˆ°è¯¥itemçš„é”. </li>
<li>itemæ‰§è¡Œå®Œæˆä¹‹å, çŠ¶æ€ä¿®æ”¹ä¸ºfinishedä¹‹å, å†é‡Šæ”¾æ‰itemé”.</li>
<li>itemæ‰§è¡Œå¼‚å¸¸ä¸­æ–­(ä¾‹å¦‚æœåŠ¡å™¨é‡å¯, çº¿ç¨‹crashç­‰): ç­‰å¾…é”è¶…æ—¶. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li>
<li>itemæ‰§è¡Œå¤±è´¥: çº¿ç¨‹é‡Œcatchä½å¼‚å¸¸, ä¸»åŠ¨é‡Šæ”¾æ‰è¯¥itemé”. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li>
</ol>
</li>
<li><p>æˆ–è€…ä½¿ç”¨äº‹åŠ¡:(ä¸è¿‡æœ¬ä¾‹å­ä¸­ä¸é€‚åˆ, å› ä¸º10minå¤ªä¹…äº†, å…¶ä»–æ‰§è¡Œè€—æ—¶è¾ƒçŸ­30sä»¥å†…çš„å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ¡ˆ)  </p>
<ol>
<li>itemæ‰§è¡Œå‰å¼€å¯äº‹åŠ¡;</li>
<li>æ‰§è¡Œåä¿®æ”¹çŠ¶æ€ä¸ºfinished, commitäº‹åŠ¡.</li>
<li>itemæ‰§è¡Œå¼‚å¸¸ä¸­æ–­(ä¾‹å¦‚æœåŠ¡å™¨é‡å¯, çº¿ç¨‹crashç­‰): äº‹åŠ¡è‡ªåŠ¨å›æ»š. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li>
<li>itemæ‰§è¡Œå¤±è´¥: ä¸»åŠ¨å›æ»šäº‹åŠ¡. ç”±äºä»ç„¶æ˜¯initçŠ¶æ€(ç»ˆæ€), å› æ­¤å¯ä»¥é‡æ–°äººè‚‰è§¦å‘, æ–°çš„çº¿ç¨‹æŠ¢åˆ°é”, é‡æ–°æ‰§è¡Œ.</li>
</ol>
</li>
</ol>
<h2 id="æ–¹æ¡ˆ2-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€"><a href="#æ–¹æ¡ˆ2-çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹-æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€" class="headerlink" title="æ–¹æ¡ˆ2: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€"></a>æ–¹æ¡ˆ2: çŠ¶æ€æœºè®¾è®¡ä¿®æ”¹: æŠŠprocessingä½œä¸ºçº¯ç²¹çš„ç»ˆæ€</h2><ol>
<li><p>éœ€è¦è®¾è®¡ä»processing-&gt;finished&#x2F;initçš„äººè‚‰è§¦å‘å…¥å£.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207072354738.png"></p>
</li>
<li><p>å¦‚ä½•é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘è¯¥itemä»processing-&gt;finished&#x2F;initçš„å˜è¿? å‚è§æ–¹æ¡ˆ1ä¸­é”&#x2F;äº‹åŠ¡çš„æ–¹å¼</p>
</li>
</ol>
<h2 id="æ–¹æ¡ˆ3-ä¼˜é›…åœæœº"><a href="#æ–¹æ¡ˆ3-ä¼˜é›…åœæœº" class="headerlink" title="æ–¹æ¡ˆ3: ä¼˜é›…åœæœº"></a>æ–¹æ¡ˆ3: ä¼˜é›…åœæœº</h2><ol>
<li>åœ¨shutdown-hooké‡Œæ³¨å†Œäº‹ä»¶:<ol>
<li>å°†çŠ¶æ€æ”¹å›init. â€“&gt; required.</li>
<li>å°†workerçº¿ç¨‹interruptæ‰. â€“&gt; optional, å› ä¸ºå³ä½¿ä¸interrupt, è¿›ç¨‹åœæ­¢çº¿ç¨‹ä¹Ÿä¼šè¢«å›æ”¶.</li>
</ol>
</li>
<li>ä½†è¯¥æ–¹æ¡ˆæœ‰å¾ˆå¤§çš„ç¼ºé™·, å¦‚æœç›´æ¥<code>kill -9</code>, åˆ™shutdown-hookæ ¹æœ¬ä¸ä¼šæ‰§è¡Œ.</li>
</ol>
<h2 id="æœ€ç»ˆæ–¹æ¡ˆ"><a href="#æœ€ç»ˆæ–¹æ¡ˆ" class="headerlink" title="æœ€ç»ˆæ–¹æ¡ˆ"></a>æœ€ç»ˆæ–¹æ¡ˆ</h2><p>æœ€ç»ˆé‡‡ç”¨äº†æ–¹æ¡ˆ2, å› ä¸ºä»çŠ¶æ€æœºä¸­åˆ é™¤æ‰ä¸€ä¸ªç»ˆæ€, å¯¹ç°æœ‰ä»£ç æ”¹é€ é‡å¤ªå¤§äº†.</p>
<h1 id="å…¶ä»–æ€è€ƒ"><a href="#å…¶ä»–æ€è€ƒ" class="headerlink" title="å…¶ä»–æ€è€ƒ"></a>å…¶ä»–æ€è€ƒ</h1><ol>
<li>çŠ¶æ€æœºè®¾è®¡çš„æ—¶å€™, ä¸€å®šè¦æ…é‡è€ƒè™‘å“ªäº›æ˜¯ç»ˆæ€, å“ªäº›æ˜¯ä¸­é—´çŠ¶æ€. ä¸æ˜¯è¯´å› ä¸ºåœ¨æŸä¸ªçŠ¶æ€æŒç»­æ—¶é—´è¾ƒé•¿(å¦‚ä¾‹å­ä¸­çš„processing), å°±è¦ä½œä¸ºç»ˆæ€. </li>
<li>çŠ¶æ€æœºä¸­æ¯ä¸ªç»ˆæ€ä¹‹é—´, å¿…é¡»è€ƒè™‘å¯é‡å…¥æ€§; å¿…é¡»è¦ä¿è¯èƒ½äººè‚‰è§¦å‘ç»ˆæ€ä¹‹é—´çš„è½¬åŒ–. æœ¬æ–‡çš„ä¾‹å­å°±æ˜¯åé¢æ•™æ, itemå¡åœ¨processingè¿™ä¸ªç»ˆæ€, æ— æ³•è¿›è¡Œç¨‹åºä¸Šçš„ä»»ä½•æ“ä½œ.</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>good-design</tag>
        <tag>bad-design</tag>
        <tag>state-machine</tag>
        <tag>lock</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç½‘ç»œä¹‹HTTP ProxyåŸç†ä¸å®ç°åˆ†æ</title>
    <url>//2022-07-10-linux-network-http-proxy/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨ä½¿ç”¨apacheçš„HttpClientæ—¶(è·å–å…¶ä»–å¸¸ç”¨çš„httpclient), ç»å¸¸ä¼šå‘ç°åˆå§‹åŒ–æ—¶å¯ä»¥é…ç½®http proxy. ä½†æœ‰äº›ç–‘é—®:</p>
<ol>
<li>åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦ä½¿ç”¨http proxy?</li>
<li>å…·ä½“http proxyæ€ä¹ˆé…ç½®?</li>
<li>å…·ä½“http proxyçš„å®ç°åŸç†æ˜¯å•¥? åŒ…æ‹¬ httpClient å¦‚ä½•ä½¿ç”¨è¿™ä¸ªproxy? å…·ä½“çš„httpProxyæ€ä¹ˆå¤„ç†è¿™ç§åŒ…?</li>
</ol>
<h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul>
<li>docker</li>
<li>ubuntu</li>
</ul>
<h2 id="http-proxy-æœåŠ¡ç«¯éƒ¨ç½²"><a href="#http-proxy-æœåŠ¡ç«¯éƒ¨ç½²" class="headerlink" title="http proxy æœåŠ¡ç«¯éƒ¨ç½²"></a>http proxy æœåŠ¡ç«¯éƒ¨ç½²</h2><p>Nginxé€šå¸¸æ˜¯ä½œä¸ºåå‘ä»£ç†, ä½†å…¶å®ä¹Ÿå¯ä»¥ä½œä¸ºæ­£å‘ä»£ç†ä½¿ç”¨:  <a href="https://github.com/reiz/nginx_proxy">nginx_proxy</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run -d -p <span class="token number">9999</span>:8888 -v <span class="token variable">$&#123;<span class="token environment constant">PWD</span>&#125;</span>/nginx_allowlist.conf:/usr/local/nginx/conf/nginx.conf reiz/nginx_proxy:0.0.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="http-proxy-å®¢æˆ·ç«¯é…ç½®"><a href="#http-proxy-å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="http proxy å®¢æˆ·ç«¯é…ç½®"></a>http proxy å®¢æˆ·ç«¯é…ç½®</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span><span class="token class-name">HostConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span><span class="token class-name">HttpClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span>methods<span class="token punctuation">.</span></span><span class="token class-name">GetMethod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span>params<span class="token punctuation">.</span></span><span class="token class-name">HttpMethodParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpClientTest</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> ENCODING <span class="token operator">=</span> <span class="token string">"UTF-8"</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://www.google.com"</span><span class="token punctuation">;</span>
        
        <span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HostConfiguration</span> hostConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HostConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hostConfiguration<span class="token punctuation">.</span><span class="token function">setProxy</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">setHostConfiguration</span><span class="token punctuation">(</span>hostConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>
            <span class="token class-name">HttpMethodParams</span><span class="token punctuation">.</span>HTTP_CONTENT_CHARSET<span class="token punctuation">,</span> ENCODING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GetMethod</span> method <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetMethod</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">executeMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Code: "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">String</span> response <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getResponseBodyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ"><a href="#å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ" class="headerlink" title="å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ"></a>å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ</h2><p>ä¸é…ç½®proxy:</p>
<ul>
<li>client â€”http getâ€”&gt; <a href="http://www.google.com/">www.google.com</a></li>
</ul>
<p>é…ç½®äº†proxy:</p>
<ul>
<li>client â€” tcp â€”&gt; proxy â€” http get â€”&gt;  <a href="http://www.google.com/">www.google.com</a></li>
</ul>
<p>å¯ä»¥çœ‹åˆ°, client.executeMethodå®è´¨ä¸Šæ˜¯:</p>
<ol>
<li>clientå…ˆä¸proxyå»ºç«‹äº†TCPè¿æ¥.</li>
<li>ç„¶åå°†HTTPæŠ¥æ–‡, åŒ…æ‹¬ç›®æ ‡åŸŸå(å³GET <a href="http://www.google.com/">http://www.google.com</a>), ä½œä¸ºTCPçš„output streamä¼ ç»™proxy</li>
<li>proxyè§£ætcpæŠ¥æ–‡, è·å–åˆ°çœŸæ­£çš„ç›®æ ‡åŸŸå, æŸ¥æ‰¾DNSè·å–åˆ°google.comçš„ipåœ°å€.</li>
<li>proxyä¸google.comå»ºç«‹TCPè¿æ¥, å‘é€æŠ¥æ–‡bodyç­‰.</li>
</ol>
<p>è¿™ç§ä¹Ÿå«: relay, å³ä¸­ç»§.</p>
<h2 id="å®é™…è¿æ¥åˆ†æ"><a href="#å®é™…è¿æ¥åˆ†æ" class="headerlink" title="å®é™…è¿æ¥åˆ†æ"></a>å®é™…è¿æ¥åˆ†æ</h2><h3 id="hostä¸Šï¼Œ-LISTENäº†9999ç«¯å£"><a href="#hostä¸Šï¼Œ-LISTENäº†9999ç«¯å£" class="headerlink" title="hostä¸Šï¼Œ LISTENäº†9999ç«¯å£"></a>hostä¸Šï¼Œ LISTENäº†9999ç«¯å£</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/PlayGround/docker/nginx-forward-proxy$ <span class="token function">netstat</span> -natp <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token number">9999</span>
<span class="token punctuation">(</span>Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.<span class="token punctuation">)</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:9999            <span class="token number">0.0</span>.0.0:*               LISTEN      -                   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å®¹å™¨å†…éƒ¨ï¼Œ-LISTENäº†8888ç«¯å£"><a href="#å®¹å™¨å†…éƒ¨ï¼Œ-LISTENäº†8888ç«¯å£" class="headerlink" title="å®¹å™¨å†…éƒ¨ï¼Œ LISTENäº†8888ç«¯å£"></a>å®¹å™¨å†…éƒ¨ï¼Œ LISTENäº†8888ç«¯å£</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@84129a407795:/app<span class="token comment"># netstat -nat | fgrep 8888</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8888            <span class="token number">0.0</span>.0.0:*               LISTEN     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å"><a href="#åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å" class="headerlink" title="åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å"></a>åœ¨Hostä¸ŠæŸä¸ªjavaè¿›ç¨‹å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å</h3><ul>
<li><p>HOSTä¸Š Java è¿›ç¨‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalker@davywalker-ThinkPad-X1-Carbon-4th:~/Downloads/Clash-Linux$ <span class="token function">netstat</span> -natp <span class="token operator">|</span> <span class="token function">fgrep</span> <span class="token number">9999</span>
<span class="token punctuation">(</span>Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.<span class="token punctuation">)</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:9999            <span class="token number">0.0</span>.0.0:*               LISTEN      -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:9999          <span class="token number">127.0</span>.0.1:42261         TIME_WAIT   -                   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>å®¹å™¨å†…éƒ¨</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@84129a407795:/app<span class="token comment"># netstat -nat | fgrep 8888</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8888            <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.17</span>.0.4:8888         <span class="token number">172.17</span>.0.1:51960        TIME_WAIT  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>TODO:</p>
<ul>
<li>åœ¨è®¿é—®<code>http://www.google.com</code>æ—¶ï¼ŒJavaæµ‹è¯•ä»£ç æ­£å¸¸è¿”å›ç»“æœã€‚</li>
<li>åœ¨è®¿é—®<code>http://www.baidu.com</code>æ—¶ï¼Œ Javaä¼šå‡ºç°å¦‚ä¸‹å¼‚å¸¸ï¼Œç†è®ºä¸Šç”±äºä¸åœ¨nginxçš„ç™½åå•é‡Œåº”è¯¥è¢«blockçš„ï¼Œä½†ä¸ºå•¥ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Ÿ<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token operator">:</span> <span class="token class-name">Stream</span> closed
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedInputStream</span><span class="token punctuation">.</span><span class="token function">getBufIfOpen</span><span class="token punctuation">(</span><span class="token class-name">BufferedInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">170</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">BufferedInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">336</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>WireLogInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">WireLogInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">69</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>ContentLengthInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ContentLengthInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">170</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>FilterInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">FilterInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">133</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>AutoCloseInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">AutoCloseInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">108</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>FilterInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">FilterInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>AutoCloseInputStream</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">AutoCloseInputStream</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">127</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>HttpMethodBase</span><span class="token punctuation">.</span><span class="token function">getResponseBody</span><span class="token punctuation">(</span><span class="token class-name">HttpMethodBase</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">690</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>HttpMethodBase</span><span class="token punctuation">.</span><span class="token function">getResponseBodyAsString</span><span class="token punctuation">(</span><span class="token class-name">HttpMethodBase</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">803</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">edu<span class="token punctuation">.</span>xmu<span class="token punctuation">.</span>test<span class="token punctuation">.</span>javaweb<span class="token punctuation">.</span>httpclient<span class="token punctuation">.</span></span>HttpClientProxyTest</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token class-name">HttpClientProxyTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h1 id="å†å›åˆ°å®è·µä¸­"><a href="#å†å›åˆ°å®è·µä¸­" class="headerlink" title="å†å›åˆ°å®è·µä¸­"></a>å†å›åˆ°å®è·µä¸­</h1><h2 id="å®è·µ1ï¼š-DNSåŠ«æŒ-æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå"><a href="#å®è·µ1ï¼š-DNSåŠ«æŒ-æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå" class="headerlink" title="å®è·µ1ï¼š DNSåŠ«æŒ+æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå"></a>å®è·µ1ï¼š DNSåŠ«æŒ+æ­£å‘ä»£ç†è¿‡æ»¤åŸŸå</h2><p>é€šè¿‡DNSåŠ«æŒï¼Œå°†æ‰€æœ‰HTTPè¯·æ±‚éƒ½å®šä½åˆ°æ­£å‘ä»£ç†ä¸­ï¼Œåœ¨æ­£å‘ä»£ç†é‡Œè¿›è¡Œä»£ç†åŸŸåçš„é»‘ç™½åå•æ§åˆ¶ã€‚</p>
<ul>
<li>ç¼ºç‚¹ï¼š<ul>
<li>DNSåŠ«æŒå¯ä»¥è¢«æ‰‹åŠ¨ç¦ç”¨ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š<code>8.8.8.8</code>ç»•è¿‡DNSæœåŠ¡å™¨ï¼ˆå½“ç„¶å¦‚æœDNSè¯·æ±‚ç›´æ¥éƒ½è¢«åŠ«æŒï¼Œï¼‰ã€‚</li>
<li>åªé’ˆå¯¹HTTPè¯·æ±‚æœ‰æ•ˆï¼Œå¦‚æœçŸ¥é“ç›®æ ‡çš„IP, å¯ä»¥é€šè¿‡IPç›´è¿ä¸Šã€‚</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>linux</tag>
        <tag>iaas</tag>
        <tag>network</tag>
        <tag>cloud-computing</tag>
        <tag>http-proxy</tag>
        <tag>proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”±ZKçš„SID/ZXIDä¸snowflakeç®—æ³•å¼•å‘çš„IDç”Ÿæˆç®—æ³•æ¢è®¨</title>
    <url>//2022-07-11-zk-uuid-gen/</url>
    <content><![CDATA[<h1 id="å‡ ç§ç”Ÿæˆç®—æ³•"><a href="#å‡ ç§ç”Ÿæˆç®—æ³•" class="headerlink" title="å‡ ç§ç”Ÿæˆç®—æ³•"></a>å‡ ç§ç”Ÿæˆç®—æ³•</h1><h2 id="zké‡Œçš„sidç”Ÿæˆç®—æ³•"><a href="#zké‡Œçš„sidç”Ÿæˆç®—æ³•" class="headerlink" title="zké‡Œçš„sidç”Ÿæˆç®—æ³•"></a>zké‡Œçš„sidç”Ÿæˆç®—æ³•</h2><h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><ul>
<li>ä¸€ä¸ªlongç±»å‹, å ç”¨64ä½</li>
<li>ç”±ZKæœåŠ¡ç«¯ç”Ÿæˆçš„.</li>
<li>å½“å®¢æˆ·ç«¯ä¸ZKæœåŠ¡ç«¯å»ºç«‹å¥½TCPè¿æ¥(æˆ–è€…è¯´åº”ç”¨å±‚è¿æ¥)ä¹‹å, ç”Ÿæˆ.</li>
</ul>
<h3 id="ç”Ÿæˆè§„åˆ™"><a href="#ç”Ÿæˆè§„åˆ™" class="headerlink" title="ç”Ÿæˆè§„åˆ™"></a>ç”Ÿæˆè§„åˆ™</h3><ol>
<li>è·å–å½“å‰æ—¶é—´(2013-10-04 21:59:42)çš„æ¯«ç§’è¡¨ç¤ºï¼š1380895182327 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122157745.png"></p>
<ol start="2">
<li>å°†æ­¥éª¤1ä¸­çš„æ•°å€¼å·¦ç§»24ä½ï¼Œå¾—åˆ°ï¼š</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122157302.png"></p>
<ol start="3">
<li>å³ç§»8ä½ï¼š</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158285.png"></p>
<ol start="4">
<li>æ·»åŠ æœºå™¨æ ‡è¯†: SID. id è¡¨ç¤ºé…ç½®åœ¨myidæ–‡ä»¶ä¸­çš„å€¼ï¼Œé€šå¸¸æ˜¯æ•´æ•°1ã€2ã€3ç­‰,å‡è®¾idä¸º2ï¼š</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158613.png"></p>
<ol start="5">
<li>å°†æ­¥éª¤3å’Œæ­¥éª¤4å¾—åˆ°çš„ä¸¤ä¸ª64ä½è¡¨ç¤ºçš„æ•°å€¼è¿›è¡Œ<code>æˆ–</code>æ“ä½œï¼š</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158687.png"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">initializeNextSessionId</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">long</span> nextSid<span class="token punctuation">;</span>
    nextSid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">currentElapsedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span>
    nextSid <span class="token operator">=</span> nextSid <span class="token operator">|</span> <span class="token punctuation">(</span>id <span class="token operator">&lt;&lt;</span> <span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextSid <span class="token operator">==</span> <span class="token class-name">EphemeralType</span><span class="token punctuation">.</span>CONTAINER_EPHEMERAL_OWNER<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">++</span>nextSid<span class="token punctuation">;</span>  <span class="token comment">// this is an unlikely edge case, but check it just in case</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> nextSid<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="è¯¦ç»†åˆ†æ"><a href="#è¯¦ç»†åˆ†æ" class="headerlink" title="è¯¦ç»†åˆ†æ"></a>è¯¦ç»†åˆ†æ</h3><p>{8ä½, å½“å‰ä¸»æœºçš„myid} {40ä½, æ¯«ç§’æ—¶é—´æˆ³} {16ä½, å•hosté€’å¢åºåˆ—å·}<br>ZKä¸»æœºå¯åŠ¨æ—¶, ä¼šæŠŠå‰ 48ä½åˆå§‹åŒ–å¥½, æ¥ä¸‹æ¥æ¯æ¬¡æœ‰clienté“¾æ¥åˆ°è¯¥host, åˆ™å16ä½è¿›è¡Œé€’å¢.</p>
<h3 id="çº¿ä¸Šæ ·ä¾‹"><a href="#çº¿ä¸Šæ ·ä¾‹" class="headerlink" title="çº¿ä¸Šæ ·ä¾‹"></a>çº¿ä¸Šæ ·ä¾‹</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122158988.png"></p>
<p>ä¾‹å¦‚, sid &#x3D; 0x3 518ae13bc4 16e8 æœ¬è´¨ä¸Šèƒ½æ‹†åˆ†æˆ:</p>
<ul>
<li>å‰8ä½: 0x3, ä»£è¡¨å½“å‰myid&#x3D;3, æ˜¯æ•´ä¸ªZKé›†ç¾¤çš„ç¬¬3å°æœåŠ¡å™¨.</li>
<li>ä¸­é—´40ä½: 518ae13bc4, ä»£è¡¨åˆå§‹åŒ–æ—¶æ—¶é—´æˆ³. ç”±äºç§»ä½æ—¶æˆªæ–­äº†æœ€é«˜ä½1, å› æ­¤å®é™…çš„æ—¶é—´æˆ³æ˜¯ 1518ae13bc4, è½¬æˆ10è¿›åˆ¶1449733995460, æŒ‰ç…§æ¯«ç§’æ•°è½¬æˆæ—¶é—´æˆ³2015-12-10 15:53:15, å¯ä»¥çŸ¥é“è¯¥hostå¯åŠ¨æ˜¯åœ¨è¿™ä¸ªæ—¶é—´ç‚¹.</li>
<li>å16ä½: 16e8, è½¬æˆ10è¿›åˆ¶, 5864, ä»£è¡¨æ˜¯ç¬¬5864ä¸ªè¿æ¥</li>
</ul>
<h3 id="ç¢°æ’åˆ†æ"><a href="#ç¢°æ’åˆ†æ" class="headerlink" title="ç¢°æ’åˆ†æ"></a>ç¢°æ’åˆ†æ</h3><p>æ€è€ƒSIDäº§ç”Ÿè§„åˆ™, æ˜¯å¦æœ‰ç¢°æ’é£é™©?</p>
<ol>
<li>å‰8ä½ä»£è¡¨ä¸»æœºä½, æœ€å¤§æ”¯æŒ256ä¸ªä¸»æœº, å¦‚æœé›†ç¾¤æœ‰ä¸Šåƒå°æœåŠ¡å™¨, è¿™æ ·å¿…ç„¶ä¼šé‡å¤, ä½†è¿™æ ·ä¼šå¯¼è‡´ç¢°æ’ä¹ˆ? â€“&gt; ä¸å¤ªä¼š<ol>
<li>åªè¦èƒ½ä¿è¯å‰48ä½ä¸é‡å¤, å³å¯ä»¥ä¿è¯sidä¸ç¢°æ’. å› ä¸ºå16ä½æ˜¯å•hostç²’åº¦é€’å¢.</li>
</ol>
</li>
<li>å‰48ä½å¦‚ä½•ç¢°æ’?<ol>
<li>å³å‰8ä½ç›¸åŒçš„ä¸»æœº myid&#x3D;1 (äºŒè¿›åˆ¶ 00000001) ä¸ myid&#x3D;257 (100000001)</li>
<li>åœ¨åŒä¸€æ¯«ç§’åŒæ—¶å¯åŠ¨, ä»è€Œä¸­é—´40ä½ç›¸åŒ</li>
<li>è€Œåœ¨å®é™…å°è§„æ¨¡é›†ç¾¤æƒ…å†µä¸‹, åŸºæœ¬å¾ˆéš¾äº§ç”Ÿ.</li>
</ol>
</li>
<li>å•æœºä¸Š, å16ä½å¦‚æœæº¢å‡ºæ€ä¹ˆåŠ?<ol>
<li>å³å•æœºä¸Šclientåå¤åˆ›å»ºsession, è¶…è¿‡äº†2^16&#x3D;65535, å¿…ç„¶ä¼šé‡å¤!</li>
<li>ç»è¯•éªŒ, å‘ç°å½“å16ä½æ»¡äº†ä¹‹å, ä¼šå‘å‰è¾¹å€Ÿä½. ä¾‹å¦‚:<ol>
<li>å•æœºä¸Šä¹‹å‰çš„sid: 0x3 764c3db1d3 768e</li>
<li>åç»­é¢‘ç¹åˆ›å»ºsession, å16ä½æ»¡äº†, å˜æˆ 0x3 764c3db1d4 00e1</li>
</ol>
</li>
<li>çœ‹ä»£ç : æ— è„‘åœ°å¯¹sidåš+1æ“ä½œ. å³ä½¿è¿™æ ·, ä¹Ÿä¸å¤ªä¼šå¯¼è‡´ ä¸­é—´40ä½ç¢°æ’. (æœ‰è¿™ä¸ªå¯èƒ½, ä¾‹å¦‚å½“å‰sessioné¢‘ç¹åˆ›å»º, å˜æˆäº† 0x3 ffffffffff 768e, æ¥ä¸‹æ¥æœåŠ¡å™¨åœ¨ ffffffffff è¿™ä¸ªæ¯«ç§’ç‚¹å¯åŠ¨, ä½†å½“å‰sessionæœªå¤±æ•ˆ, é‡æ–°è¿æ¥ä¸Šå»äº†.  ä»è€Œsidä» 0x3 ffffffffff 0000å¼€å§‹é€’å¢, æœ‰å¯èƒ½é‡æ–°ç”Ÿæˆäº†ä¸€ä¸ª 0x3 ffffffffff 768e çš„sid)</li>
</ol>
</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122159565.png"></p>
<h2 id="zké‡Œçš„zxidç”Ÿæˆç®—æ³•"><a href="#zké‡Œçš„zxidç”Ÿæˆç®—æ³•" class="headerlink" title="zké‡Œçš„zxidç”Ÿæˆç®—æ³•"></a>zké‡Œçš„zxidç”Ÿæˆç®—æ³•</h2><h3 id="zxidç»„æˆ"><a href="#zxidç»„æˆ" class="headerlink" title="zxidç»„æˆ"></a>zxidç»„æˆ</h3><blockquote>
<p>The zxid has two parts: the epoch and a counter. <br/><br>In our implementation the zxid is a 64-bit number. <br/><br>We use the high order 32-bits for the epoch and the low order 32-bits for the counter.</p>
</blockquote>
<p>64ä½çš„longç±»å‹, åŒ…å«ä¸¤éƒ¨åˆ†: å‰32ä½ä»£è¡¨epoch(å³é€‰ä¸¾æ¬¡æ•°); å32ä½ä»£è¡¨counter(å³è¯¥zké›†ç¾¤ä¸­çš„updateæ“ä½œçš„æ¬¡æ•°, åŸºæœ¬æ˜¯å•è°ƒé€’å¢çš„).<br>ä½†å®é™…è¿™æ ·è®¾è®¡æ˜¯æœ‰ç¼ºé™·çš„:</p>
<ul>
<li>åœ¨å®é™…åœºæ™¯ä¸­, quorumä¸€èˆ¬éƒ½æ˜¯åœ¨è¾ƒä¸ºç¨³å®šçš„å†…ç½‘ç¯å¢ƒä¸‹, ä¸å¤ªä¼šå› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´å‘ç”Ÿfailoveré€‰ä¸»åˆ‡æ¢; å› æ­¤epochä½¿ç”¨32ä½, æ”¯æŒ40äº¿æ¬¡é€‰ä¸¾, æ²¡å•¥å¿…è¦.</li>
<li>è€Œå®é™…counterå¢é•¿æ˜¯æ¯”è¾ƒè¿…çŒ›çš„, åœ¨æ”¯æŒ1000qpsçš„ç³»ç»Ÿä¸­, 50å¤©å·¦å³counterå°±ä¼šæº¢å‡º.</li>
<li>è€Œcounteræº¢å‡ºä¼šå¯¼è‡´å‘ç”Ÿä¸€æ¬¡å¼ºåˆ¶é€‰ä¸», ä»è€ŒæŠŠcounteræ¸…é›¶, æŠŠepoch+1;</li>
<li>è€Œåœ¨3.3.5ç‰ˆæœ¬ä¹‹å‰, counteræº¢å‡ºä¸ä¼šé€‰ä¸», å­˜åœ¨bug, å¯¼è‡´zké›†ç¾¤æ•´ä½“ä¸å¯ç”¨. <a href="https://issues.apache.org/jira/browse/ZOOKEEPER-1277">servers stop serving when lower 32bits of zxid roll over</a></li>
</ul>
<h3 id="zxidç”Ÿæˆ"><a href="#zxidç”Ÿæˆ" class="headerlink" title="zxidç”Ÿæˆ"></a>zxidç”Ÿæˆ</h3><ul>
<li>zxidå¿…ç„¶æ˜¯ç”±leaderç”Ÿæˆ, ä¿è¯å•è°ƒé€’å¢, ä¸èƒ½ç”±å®¢æˆ·ç«¯ç”Ÿæˆ.</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> epoch <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> counter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> zxid <span class="token operator">=</span> epoch <span class="token operator">&lt;&lt;</span> <span class="token number">32</span> <span class="token operator">|</span> counter<span class="token punctuation">;</span>
<span class="token comment">// æ–°çš„updateæ“ä½œ</span>
zxid<span class="token operator">++</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="zxidä½¿ç”¨æƒ…å†µ"><a href="#zxidä½¿ç”¨æƒ…å†µ" class="headerlink" title="zxidä½¿ç”¨æƒ…å†µ"></a>zxidä½¿ç”¨æƒ…å†µ</h3><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è„šæœ¬åˆ¤æ–­å32ä½ä½¿ç”¨é‡, å¦‚æœç»“æœ&gt;0.8, ä»£è¡¨ä½¿ç”¨é‡å·²ç»è¶…è¿‡80%, ä»£è¡¨æœ‰é£é™©.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> srvr <span class="token operator">|</span> <span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">32188</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/Zxid/&#123;printf "%f\n", and(strtonum($NF),0xffffffff)/2^32&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="Snowflake-IDç”Ÿæˆç®—æ³•"><a href="#Snowflake-IDç”Ÿæˆç®—æ³•" class="headerlink" title="Snowflake IDç”Ÿæˆç®—æ³•"></a>Snowflake IDç”Ÿæˆç®—æ³•</h2><h3 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122159430.png"></p>
<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul>
<li>41ä½æ—¶é—´æˆ³, æ ‡è¯†çš„æ—¶é—´èŒƒå›´æ˜¯?</li>
</ul>
<p>1970-01-01 08:00:00 ~ 2039-09-07 23:47:35</p>
<blockquote>
<p>41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª) å¾—åˆ°çš„å€¼ï¼Œè¿™é‡Œçš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ï¼ˆå¦‚ä¸‹é¢ç¨‹åºIdWorkerç±»çš„startTimeå±æ€§ï¼‰ã€‚41ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨69å¹´</p>
</blockquote>
<ul>
<li>10ä½æœºå™¨id, æ ‡è¯†çš„æœºå™¨æ•°é‡èŒƒå›´æ˜¯:</li>
</ul>
<p>1024 å°, 5ä½datacenterIdå’Œ 5ä½workerId</p>
<ul>
<li>12ä½åºåˆ—å·</li>
</ul>
<h3 id="å®é™…åœºæ™¯"><a href="#å®é™…åœºæ™¯" class="headerlink" title="å®é™…åœºæ™¯"></a>å®é™…åœºæ™¯</h3><p>RocketMQ, æ¶ˆæ¯IDæ˜¯ä½¿ç”¨snowflakeç®—æ³•ç”Ÿæˆ, æ˜¯ç”±å®¢æˆ·ç«¯äº§ç”Ÿ.</p>
<ul>
<li>å®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“è‡ªå·±çš„datacenterId?</li>
<li>å¯ä»¥é€šè¿‡é…ç½®, ä¹Ÿå¯ä»¥å¦‚ä¸‹, é€šè¿‡æœ¬æœºç½‘å¡çš„MACç”Ÿæˆ, å‚ç…§ï¼š<a href="https://github.com/dromara/hutool/blob/a9310c2d305acac617ca656ea6ffc3be6cc48a4c/hutool-core/src/main/java/cn/hutool/core/util/IdUtil.java#L240">IdUtil.java</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * è·å–æ•°æ®ä¸­å¿ƒID&lt;br>
 * æ•°æ®ä¸­å¿ƒIDä¾èµ–äºæœ¬åœ°ç½‘å¡MACåœ°å€ã€‚
 * &lt;p>
 * æ­¤ç®—æ³•æ¥è‡ªäºmybatis-plus#Sequence
 * &lt;/p>
 *
 * @param maxDatacenterId æœ€å¤§çš„ä¸­å¿ƒID
 * @return æ•°æ®ä¸­å¿ƒID
 * @since 5.7.3
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getDataCenterId</span><span class="token punctuation">(</span><span class="token keyword">long</span> maxDatacenterId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>maxDatacenterId <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"maxDatacenterId must be > 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>maxDatacenterId <span class="token operator">==</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        maxDatacenterId <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mac <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
        mac <span class="token operator">=</span> <span class="token class-name">NetUtil</span><span class="token punctuation">.</span><span class="token function">getLocalHardwareAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UtilException</span> ignore<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// ignore</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> mac<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x000000FF</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> mac<span class="token punctuation">[</span>mac<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0x0000FF00</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> mac<span class="token punctuation">[</span>mac<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">6</span><span class="token punctuation">;</span>
        id <span class="token operator">=</span> id <span class="token operator">%</span> <span class="token punctuation">(</span>maxDatacenterId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> id<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>å®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“è‡ªå·±çš„å·¥ä½œæœºå™¨ID? </li>
<li>æ ¹æ®è¿›ç¨‹PIDä¸datacenterIdç”Ÿæˆ, å‚ç…§ï¼š<a href="https://github.com/dromara/hutool/blob/a9310c2d305acac617ca656ea6ffc3be6cc48a4c/hutool-core/src/main/java/cn/hutool/core/util/IdUtil.java#L240">IdUtil.java</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * è·å–æœºå™¨IDï¼Œä½¿ç”¨è¿›ç¨‹IDé…åˆæ•°æ®ä¸­å¿ƒIDç”Ÿæˆ&lt;br>
 * æœºå™¨ä¾èµ–äºæœ¬è¿›ç¨‹IDæˆ–è¿›ç¨‹åçš„Hashå€¼ã€‚
 *
 * &lt;p>
 * æ­¤ç®—æ³•æ¥è‡ªäºmybatis-plus#Sequence
 * &lt;/p>
 *
 * @param datacenterId æ•°æ®ä¸­å¿ƒID
 * @param maxWorkerId  æœ€å¤§çš„æœºå™¨èŠ‚ç‚¹ID
 * @return ID
 * @since 5.7.3
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getWorkerId</span><span class="token punctuation">(</span><span class="token keyword">long</span> datacenterId<span class="token punctuation">,</span> <span class="token keyword">long</span> maxWorkerId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> <span class="token class-name">StringBuilder</span> mpid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mpid<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>datacenterId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        mpid<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">RuntimeUtil</span><span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UtilException</span> igonre<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//ignore</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/*
     * MAC + PID çš„ hashcode è·å–16ä¸ªä½ä½
     */</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>mpid<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>maxWorkerId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•"><a href="#awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•" class="headerlink" title="awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•"></a>awsä¸­èµ„æºIDç”Ÿæˆç®—æ³•</h2><h3 id="æ–¹æ¡ˆ1-Base36"><a href="#æ–¹æ¡ˆ1-Base36" class="headerlink" title="æ–¹æ¡ˆ1: Base36"></a>æ–¹æ¡ˆ1: Base36</h3><p>ä»£ç å¦‚ä¸‹, ä¼˜ç‚¹æ˜¯ä¸éœ€è¦å ä½ç¬¦, å¯ä»¥ç›´æ¥ç”¨<code>ALPHABET</code>ç”šè‡³å¯ä»¥ä¿®æ”¹<code>ALPHABET</code>çš„é¡ºåºè¾¾åˆ°ç®€å•åŠ å¯†çš„æ•ˆæœ.</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Base36Test</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 26å°å†™+26å¤§å†™+10æ•°å­—=62</span>
    <span class="token comment">//public static String ALPHABET = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";</span>
    <span class="token comment">// 26å°å†™+10æ•°å­—=36</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> ALPHABET <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encoding</span><span class="token punctuation">(</span><span class="token keyword">long</span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"num must be greater than 0."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>

        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> num <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> num <span class="token operator">/=</span> <span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ALPHABET<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>num <span class="token operator">%</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">decoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"str must not be empty."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">long</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            result <span class="token operator">+=</span> ALPHABET<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> dcId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> izId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//int idx = (int)(Math.random() * 1024);</span>
        <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>

        encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span><span class="token number">1023</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
        encoding <span class="token operator">=</span> <span class="token class-name">Base36Test</span><span class="token punctuation">.</span><span class="token function">encoding</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æ–¹æ¡ˆ2-Base64"><a href="#æ–¹æ¡ˆ2-Base64" class="headerlink" title="æ–¹æ¡ˆ2: Base64"></a>æ–¹æ¡ˆ2: Base64</h3><p>ç¼ºç‚¹æ˜¯ä¼šæœ‰<code>=</code>å ä½ç¬¦.</p>
<h1 id="æ—¶é’Ÿå›æ‹¨é—®é¢˜"><a href="#æ—¶é’Ÿå›æ‹¨é—®é¢˜" class="headerlink" title="æ—¶é’Ÿå›æ‹¨é—®é¢˜"></a>æ—¶é’Ÿå›æ‹¨é—®é¢˜</h1><ul>
<li>zké‡Œçš„sidä¸å¤ªä¼šæœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜, æ˜¯å› ä¸ºæ—¶é—´æˆ³æ˜¯æœºå™¨å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„. é™¤éå›æ‹¨æ—¶é—´ç‰¹åˆ«é•¿, åˆšå¥½å›æ‹¨ä¹‹åæœºå™¨åˆé‡å¯äº†, æ‹¿åˆ°äº†ä¹‹å‰é‚£ä¸ªæ—¶é—´æˆ³. ä½†è€ƒè™‘åˆ°å®é™…åœºæ™¯, å®é™…ä¸å¤ªä¼šå‘ç”Ÿ.<ul>
<li>æœºå™¨é‡å¯ä¸ä¼šé‚£ä¹ˆé¢‘ç¹, åªä¼šåœ¨å¯åŠ¨æ—¶ç”Ÿæˆ</li>
<li>æ—¶é’Ÿå›æ‹¨, ä¸€èˆ¬éƒ½æ˜¯äºšç§’çº§åˆ«çš„å›æ‹¨</li>
</ul>
</li>
<li>rocketmqé‡Œsnowflake, ç”±äºæ˜¯å®¢æˆ·ç«¯æ¯æ¬¡ç”Ÿæˆæ—¶å®æ—¶è·å–çš„æ—¶é—´æˆ³, å› æ­¤å³ä½¿å›æ‹¨äº†å‡ æ¯«ç§’, åœ¨ç”ŸæˆIDé€Ÿåº¦éå¸¸å¿«çš„æƒ…å†µä¸‹, ä¹Ÿæœ‰å¯èƒ½é‡å¤. å¦‚ä½•è§£å†³?<ul>
<li>æ¯”è¾ƒæŒ«çš„æ–¹æ¡ˆ, å…³é—­ntp</li>
<li>æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆ: å½“å›æ‹¨æ—¶é—´å°äº15msï¼Œå°±ç­‰æ—¶é—´è¿½ä¸Šæ¥ä¹‹åç»§ç»­ç”Ÿæˆã€‚</li>
</ul>
<ol>
<li>æ›´å¥½çš„æ–¹æ¡ˆ, å½“æ—¶é—´å¤§äº15msæ—¶é—´æˆ‘ä»¬é€šè¿‡<strong>æ›´æ¢workid</strong>æ¥äº§ç”Ÿä¹‹å‰éƒ½æ²¡æœ‰äº§ç”Ÿè¿‡çš„æ¥è§£å†³å›æ‹¨é—®é¢˜ã€‚</li>
<li>æœ€å¥½çš„æ–¹æ¡ˆ: å¦‚ä¸‹ä¿®æ”¹ç®—æ³•, å¯ä»¥æ‰¾2bitä½ä½œä¸ºæ—¶é’Ÿå›æ‹¨ä½ï¼Œå‘ç°æœ‰æ—¶é’Ÿå›æ‹¨å°±å°†å›æ‹¨ä½åŠ 1ï¼Œè¾¾åˆ°æœ€å¤§ä½åå†ä»0å¼€å§‹è¿›è¡Œå¾ªç¯ã€‚</li>
</ol>
</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207122159865.png"></p>
<h1 id="æ–¹æ¡ˆæ¯”è¾ƒ"><a href="#æ–¹æ¡ˆæ¯”è¾ƒ" class="headerlink" title="æ–¹æ¡ˆæ¯”è¾ƒ"></a>æ–¹æ¡ˆæ¯”è¾ƒ</h1><ul>
<li><p>ç›¸åŒç‚¹: </p>
<ul>
<li>éƒ½ä½¿ç”¨longç±»å‹, å ç”¨64ä½</li>
<li>éƒ½å¸Œæœ›æ—¢èƒ½å°½é‡å‡å°‘ç¢°æ’, åˆèƒ½åæ˜ é€’å¢è¶‹åŠ¿</li>
<li>ç»„æˆç»“æ„éƒ½æ˜¯: <code>ä¸»æœºç¼–å·+æ—¶é—´æˆ³+é€’å¢ç¼–å·</code></li>
</ul>
</li>
<li><p>å·®å¼‚ç‚¹:</p>
<ul>
<li>æ—¶é—´æˆ³: <ul>
<li>sidæ—¶é—´æˆ³å ç”¨40ä½(å®Œæ•´çš„åº”è¯¥æ˜¯41ä½, ä½†é»˜è®¤æˆªæ–­äº†æœ€é«˜ä½1); è€Œsnowflakeæ—¶é—´æˆ³å ç”¨41ä½, ç›¸å¯¹æ—¶é—´èŒƒå›´æ˜¯79å¹´, ç»å¯¹æ—¶é—´åˆ°2039å¹´. </li>
<li>sidçš„æ—¶é—´æˆ³, æ˜¯zkä¸»æœºå¯åŠ¨èµ·æ¥çš„æ—¶é—´æˆ³, ä¹‹ååœ¨ä¸‹æ¬¡å¯åŠ¨ä¹‹å‰, å°±ä¸å†å˜åŒ–äº†.</li>
<li>snowflakeçš„æ—¶é—´æˆ³, æ˜¯clientç›¸å¯¹äºæŸä¸ªæ—¶é—´ç‚¹çš„ç›¸å¯¹æ—¶é—´; ä¸”æ˜¯ç”ŸæˆIDçš„å½“å‰æ—¶é—´, ä¸‹ä¸€ä¸ªæ¯«ç§’è¿™ä¸ªæ—¶é—´æˆ³ä¼šå˜åŒ–.</li>
</ul>
</li>
</ul>
</li>
<li><p>å…¶ä»–</p>
<ul>
<li>zkçš„ç®—æ³•, ä½†å•hostå¢æ•°é‡æ˜¯65535(å®é™…å¯ä»¥å€Ÿ40ä½, å³ä¸Šåƒäº¿, ä½†æœ‰ç¢°æ’é£é™©äº†), é€‚ç”¨äºé•¿è¿åœºæ™¯, å³sessionä¸ä¼šé¢‘ç¹åˆ›å»º, ä»è€Œå¯¼è‡´å16ä½é€’å¢é‚£ä¹ˆå¿«.</li>
<li>snowflakeç®—æ³•, æ”¯æŒå•æœºæ¯æ¯«ç§’äº§ç”Ÿ 2^12 &#x3D; 4096 ä¸ªID, é€‚ç”¨äºåˆ›å»ºIDéå¸¸é¢‘ç¹çš„åœºæ™¯.</li>
<li>å‡è®¾, ç”¨zkçš„ç®—æ³•æ¥ç”Ÿæˆsnowflakeçš„id:<ul>
<li>å¦‚æœè¿˜æ˜¯æœºå™¨å¯åŠ¨æ—¶ç”Ÿæˆæ—¶é—´æˆ³ä½, é‚£å•æœºåªèƒ½ç”Ÿæˆ 2^16 &#x3D; 65535 ä¸ªID, ä¹‹åå°±åªèƒ½å€Ÿæ—¶é—´æˆ³çš„ä½äº†, å¯èƒ½ä¼šé‡å¤äº†!</li>
</ul>
</li>
<li>å‡è®¾, ç”¨snowflakeæ¥ç”Ÿæˆzkçš„sid: <ul>
<li>è²Œä¼¼æ²¡å•¥é—®é¢˜.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="å…¶ä»–æ€»ç»“"><a href="#å…¶ä»–æ€»ç»“" class="headerlink" title="å…¶ä»–æ€»ç»“"></a>å…¶ä»–æ€»ç»“</h1><ol>
<li>sid, snowflakeID æœ¬è´¨ä¸Šéƒ½æ˜¯åˆ†å¸ƒå¼IDç”Ÿæˆ, éœ€è¦ä¿éšœå‡ ç‚¹:<ol>
<li>å±€éƒ¨, å…¨å±€ å”¯ä¸€</li>
<li>è¶‹åŠ¿é€’å¢. (è¿™ç‚¹æ˜¯UUIDæ— æ³•è¾¾åˆ°çš„æ•ˆæœ, å› æ­¤ä¸ä½¿ç”¨UUIDGen)</li>
</ol>
</li>
</ol>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.cnblogs.com/haoxinyue/p/5208136.html">https://www.cnblogs.com/haoxinyue/p/5208136.html</a></li>
<li><a href="https://www.cnblogs.com/jiangxinlingdu/p/8440413.html">https://www.cnblogs.com/jiangxinlingdu/p/8440413.html</a></li>
<li><a href="https://xie.infoq.cn/article/ed9b31c014342fd469627d42d">https://xie.infoq.cn/article/ed9b31c014342fd469627d42d</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>zookeeper</tag>
        <tag>distributed-system</tag>
        <tag>uuid</tag>
        <tag>snowflake</tag>
        <tag>sid</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»GitHub CLIç¦æ­¢ç”¨æˆ·åå¯†ç ç™»å½•å¼•å‘çš„æ€è€ƒä¸æ€»ç»“</title>
    <url>//2022-07-23-github-token-login/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨æœ¬åœ°CLIä¸­push githubä»£ç æ—¶, è¦æ±‚è¾“å…¥ç”¨æˆ·åå¯†ç , ä½†è¾“å…¥å¯†ç ä¹‹å, æç¤ºç¦æ­¢ä½¿ç”¨å¯†ç ç™»å½•.</p>
<ul>
<li>æ ¹æ®æç¤ºé…ç½®äº†åŠå¤©SSHå…ç™», ç»“æœå‘ç°å¹¶ä¸ç”Ÿæ•ˆ, pushæ—¶ä»ç„¶è®©è¾“å…¥è´¦å·åå¯†ç .</li>
<li>åç»­æ ¹æ®æç¤º, åœ¨<a href="https://github.com/settings/tokens">GitHubé¡µé¢æ–°ç”³è¯·äº†Token</a>, ç„¶åä½¿ç”¨ ç”¨æˆ·å+Token ç™»å½•å°±å¯ä»¥äº†.<br>ä»è€Œå¼•å‘äº†è¯¸å¤šç–‘é—®ä¸æ€è€ƒ.</li>
</ul>
<h1 id="GitHubè®¿é—®å‡ ç§æ–¹å¼"><a href="#GitHubè®¿é—®å‡ ç§æ–¹å¼" class="headerlink" title="GitHubè®¿é—®å‡ ç§æ–¹å¼"></a>GitHubè®¿é—®å‡ ç§æ–¹å¼</h1><h2 id="æ–¹æ¡ˆ1-SSHæ–¹å¼"><a href="#æ–¹æ¡ˆ1-SSHæ–¹å¼" class="headerlink" title="æ–¹æ¡ˆ1: SSHæ–¹å¼"></a>æ–¹æ¡ˆ1: SSHæ–¹å¼</h2><h3 id="é…ç½®æ–¹å¼"><a href="#é…ç½®æ–¹å¼" class="headerlink" title="é…ç½®æ–¹å¼"></a>é…ç½®æ–¹å¼</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242155452.png"></p>
<p>è¿™ç§æ–¹å¼, å¯ä»¥é€šè¿‡é…ç½®SSHå…ç™»å³å¯.</p>
<h3 id="å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey"><a href="#å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey" class="headerlink" title="å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey?"></a>å¦‚ä½•æ”¯æŒä¸åŒHosté‡‡ç”¨ä¸åŒSSHKey?</h3><p>å¦‚æœåœ¨æœ¬åœ°, æ—¢éœ€è¦é…ç½®giteeçš„SSHå…ç™», åˆéœ€è¦é…ç½®githubçš„SSHå…ç™», æœ‰éœ€è¦é…ç½®å…¶ä»–Hostçš„SSHå…ç™», æ€ä¹ˆèƒ½è®©ä¸åŒçš„Hostä½¿ç”¨ä¸åŒçš„å…¬ç§é’¥å¯¹?</p>
<ul>
<li>é…ç½®æ ·ä¾‹å¦‚ä¸‹:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> ~/.ssh/config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- ä¸º git@gitee.com:/xxx sshåœ°å€é…ç½®
Host gitee.com
  HostName gitee.com
  AddKeysToAgent <span class="token function">yes</span>
  UseKeychain <span class="token function">yes</span>
  IdentityFile ~/.ssh/id_rsa

-- ä¸º git@github.com:xxx/xxx sshåœ°å€é…ç½®
Host github.com
  HostName github.com
  AddKeysToAgent <span class="token function">yes</span>
  UseKeychain <span class="token function">yes</span>
  IdentityFile ~/.ssh/id_ed25519

-- å…¶ä»–åœ°å€é»˜è®¤sshåœ°å€é…ç½®
Host *
  AddKeysToAgent <span class="token function">yes</span>
  UseKeychain <span class="token function">yes</span>
  IdentityFile ~/.ssh/id_ed25519<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>éªŒè¯æ˜¯å¦é…ç½®æ­£ç¡®:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>davywalker@davywalkers-MacBook-Pro ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> git@github.com
PTY allocation request failed on channel <span class="token number">1</span>
Hi DavyJones2010<span class="token operator">!</span> You've successfully authenticated, but GitHub does not provide shell access.
Connection to github.com closed.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="æ–¹æ¡ˆ2-HTTPSæ–¹å¼"><a href="#æ–¹æ¡ˆ2-HTTPSæ–¹å¼" class="headerlink" title="æ–¹æ¡ˆ2: HTTPSæ–¹å¼"></a>æ–¹æ¡ˆ2: HTTPSæ–¹å¼</h2><h3 id="é…ç½®æ–¹å¼-1"><a href="#é…ç½®æ–¹å¼-1" class="headerlink" title="é…ç½®æ–¹å¼"></a>é…ç½®æ–¹å¼</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242155904.png"></p>
<p>è¿™ç§æ–¹å¼, å³èƒŒæ™¯ä¸­çš„æ¡ˆä¾‹, å¿…é¡»é€šè¿‡ ç”¨æˆ·å+Tokenæ–¹å¼ ç™»å½•, å³CLIä¸­å¯†ç å­—æ®µ, ä¸è¦è¾“å…¥è´¦å·çš„å¯†ç , è€Œæ˜¯è¾“å…¥Token</p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242158549.png"></p>
<p>æœç´¢äº†ä¸‹, <strong>ä»2021å¹´8æœˆ13æ—¥å¼€å§‹, GitHubå·²ç»ç¦æ­¢äº† ç”¨æˆ·å+å¯†ç æ–¹å¼ ç™»å½•</strong></p>
<blockquote>
<p>From August 13, 2021, <br/><br>GitHub is no longer accepting account passwords when authenticating Git operations. <br/><br>You need to add a PAT (Personal Access Token) instead, <br/><br>and you can follow the below method to add a PAT on your system. <br/></p>
</blockquote>
<h3 id="GitHubå¯†ç å­˜å‚¨ä½ç½®"><a href="#GitHubå¯†ç å­˜å‚¨ä½ç½®" class="headerlink" title="GitHubå¯†ç å­˜å‚¨ä½ç½®"></a>GitHubå¯†ç å­˜å‚¨ä½ç½®</h3><p>åœ¨ä½¿ç”¨SourceTreeçš„æ—¶å€™, ç”±äºrepoä½¿ç”¨çš„ä¹Ÿæ˜¯HTTPS, å› æ­¤ä¹Ÿæç¤ºè¾“å…¥ ç”¨æˆ·å+å¯†ç , ç”±äºå¯†ç æ–¹å¼è¢«ç¦ç”¨, å› æ­¤åç»­å†pushè¿™ä¸ªrepo, ä¼šä¸€ç›´æŠ¥ç¦æ­¢å¯†ç ç™»å½•é”™è¯¯.<br>ä½†ä¹Ÿ<mark>æ‰¾ä¸åˆ°ä¿®æ”¹&#x2F;åˆ é™¤è¯¥å¯†ç çš„ä½ç½®.</mark></p>
<p>æŸ¥äº†ä¸‹èµ„æ–™, ä¸åŒçš„æ“ä½œç³»ç»Ÿ, ç”šè‡³åŒæ ·æ“ä½œç³»ç»Ÿçš„ä¸åŒçš„ç‰ˆæœ¬, å­˜å‚¨æ–¹å¼éƒ½ä¸åŒ. è¿™é‡Œä»¥ <a href="https://stackoverflow.com/questions/42584934/where-is-my-remote-git-repository-password-stored-on-the-local-machine">MacOS Monterey 12.3.1ç‰ˆæœ¬</a> ä¸ºä¾‹:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalkerdeMacBook-Pro:~ davywalker$ <span class="token function">git</span> config credential.helper
osxkeychain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹å‡ºæ¥æ˜¯ç”±keychainè¿›è¡Œçš„ç®¡ç†, åœ¨Macçš„ <code>Applications -&gt; Utilties -&gt; Keychain Access</code> </p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207252101640.png"></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°SourceTreeåº”ç”¨ä¿å­˜çš„GitHub Repoå¯†ç .</li>
<li>åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°IntelliJ IDEAä¿å­˜çš„GitHub Repoå¯†ç , é€šè¿‡æ˜¾ç¤ºrepoå¯†ç å‘ç°, è¿™ä¸ªå¯†ç å­—æ®µå…¶å®å°±æ˜¯ç­¾å‘ç»™Intellijçš„ PAT(Personal Access Token)</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç”±äº<font color='red'>æœ¬åœ°é…ç½®çš„remote repoæ˜¯HTTPSæ–¹å¼, å› æ­¤é€šè¿‡é…ç½®SSHå…ç™»æ–¹å¼å¿…ç„¶æ˜¯æ— æ•ˆçš„.</font> </p>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202207242202265.png"></p>
<h1 id="ç™»å½•å®‰å…¨æ€è€ƒ"><a href="#ç™»å½•å®‰å…¨æ€è€ƒ" class="headerlink" title="ç™»å½•å®‰å…¨æ€è€ƒ"></a>ç™»å½•å®‰å…¨æ€è€ƒ</h1><h2 id="ä¸ºå•¥ç¦æ­¢CLI-HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•"><a href="#ä¸ºå•¥ç¦æ­¢CLI-HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•" class="headerlink" title="ä¸ºå•¥ç¦æ­¢CLI HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•?"></a>ä¸ºå•¥ç¦æ­¢CLI HTTPSæ–¹å¼é€šè¿‡ç”¨æˆ·åå¯†ç ç™»å½•?</h2><p>åº”è¯¥æ˜¯æ‹…å¿ƒå¯†ç æ³„éœ².<br>ä½†ä¼šåœ¨å“ªç§æƒ…å†µä¸‹æ³„éœ²å¯†ç ?</p>
<ol>
<li>å­˜å‚¨è¿‡ç¨‹: ä¸ºäº†é˜²æ­¢æ¯æ¬¡pushéƒ½é‡å¤è¾“å…¥, git clientåº”è¯¥æŠŠç”¨æˆ·åå¯†ç å­˜å‚¨åˆ°æœ¬æœºæŸä¸ªä½ç½®äº†. </li>
<li>ä¼ è¾“è¿‡ç¨‹: HTTPSä¸­é—´äººæ”»å‡», å‘ç”Ÿæ¦‚ç‡å°±è¾ƒå°äº†<br>æ‰€ä»¥åº”è¯¥è¿˜æ˜¯å¯†ç å­˜å‚¨çš„é£é™©.<br>é€šè¿‡é¡µé¢ç™»å½•, æœ‰äº¤äº’æ–¹å¼å¯ä»¥å®ç°MFA, ä½†<mark>CLIæ–¹å¼æ— æ³•è¿›è¡Œäº¤äº’ä»è€Œå®ç°MFA.</mark><br>è¿™æ ·ä»è€Œå‡å¼±äº†å®‰å…¨æ€§.</li>
</ol>
<h2 id="ä¸ºå•¥é€šè¿‡ç”¨æˆ·å-Tokenæ–¹å¼ç™»å½•-å°±æ”¯æŒå‘¢"><a href="#ä¸ºå•¥é€šè¿‡ç”¨æˆ·å-Tokenæ–¹å¼ç™»å½•-å°±æ”¯æŒå‘¢" class="headerlink" title="ä¸ºå•¥é€šè¿‡ç”¨æˆ·å+Tokenæ–¹å¼ç™»å½•, å°±æ”¯æŒå‘¢"></a>ä¸ºå•¥é€šè¿‡ç”¨æˆ·å+Tokenæ–¹å¼ç™»å½•, å°±æ”¯æŒå‘¢</h2><h3 id="å‡ ç§ç±»å‹çš„Token"><a href="#å‡ ç§ç±»å‹çš„Token" class="headerlink" title="å‡ ç§ç±»å‹çš„Token"></a>å‡ ç§ç±»å‹çš„Token</h3><ul>
<li>å¯†ç : æ—¶é—´ç»´åº¦æ˜¯æ°¸ä¹…æœ‰æ•ˆ, ä¸å¯å¬å›. æƒé™èŒƒå›´æ˜¯æ— é™çš„(é™¤éå­è´¦å·). å¯èƒ½æ˜¯æœ‰è§„å¾‹çš„.</li>
<li>SecretKey: æ—¶é—´ç»´åº¦é€šå¸¸æ˜¯æ°¸ä¹…æœ‰æ•ˆ(ä½†æ”¯æŒè®¾å®šé•¿æœŸ), å¯ä»¥å¬å›. æƒé™èŒƒå›´æ˜¯æœ‰é™çš„. é€šå¸¸æ˜¯UUIDç­‰æ— è§„å¾‹çš„.</li>
<li>RefreshToken: æ—¶é—´ç»´åº¦æ˜¯è¾ƒé•¿ç»´åº¦(ä¾‹å¦‚å¯ä»¥60å¤©), å¯ä»¥å¬å›. æƒé™èŒƒå›´æ˜¯æœ‰é™çš„. é€šå¸¸æ˜¯UUIDç­‰æ— è§„å¾‹çš„.</li>
<li>AccessToken: æ—¶é—´ç»´åº¦æ˜¯è¾ƒçŸ­ç»´åº¦(ä¾‹å¦‚4ä¸ªå°æ—¶), å¯ä»¥å¬å›(ä½†ä¸€èˆ¬ä¸å¬å›, é€šè¿‡å¬å›RefreshTokenå®ç°). æƒé™èŒƒå›´æ˜¯ä¼˜å…ˆçš„. é€šå¸¸æ˜¯UUIDç­‰æ— è§„å¾‹çš„.</li>
</ul>
<h3 id="å‡ ç§ç™»å½•æ–¹å¼"><a href="#å‡ ç§ç™»å½•æ–¹å¼" class="headerlink" title="å‡ ç§ç™»å½•æ–¹å¼"></a>å‡ ç§ç™»å½•æ–¹å¼</h3><ul>
<li>æ–¹å¼1: åœ¨ç½‘é¡µç«¯, é€šå¸¸é€‰æ‹©å¯†ç æ–¹å¼ç™»å½•, ä½†éœ€è¦å¼€å¯MFAä»¥åŠ å›ºå®‰å…¨. ä»¥è¯¥æ–¹å¼ä½œä¸ºå®‰å…¨æ€§æœ€å¼º, æƒé™æœ€å¤§çš„æ–¹å¼. </li>
<li>æ–¹å¼2: åœ¨æœåŠ¡ç«¯SDKé‡Œ, é€šå¸¸é€‰æ‹©SecretKeyæ–¹å¼. SecretKeyå¦‚æœæ³„éœ², å¯ä»¥é€šè¿‡æ–¹å¼1ç™»å½•, ç„¶åæ’¤é”€SecretKeyçš„æœ‰æ•ˆæ€§, é‡æ–°ç­¾å‘æ–°çš„SecretKey. </li>
<li>æ–¹å¼3: åœ¨ç§»åŠ¨ç«¯SDKé‡Œ, é€šå¸¸ä¼šç­¾å‘ä¸€ä¸ªRefreshToken+AccessToken. æ¯æ¬¡AccessTokenè¿‡æœŸä¹‹å, é‡æ–°é€šè¿‡RefreshTokenè°ƒç”¨APIç”³è¯·æ–°çš„AccessToken.</li>
</ul>
<p>å› æ­¤åœ¨GitHub CLIæ–¹å¼ç™»å½•, å…¶å®å°±æ˜¯ä»æ–¹å¼1(ä½†ä¸å¸¦MFA)é™çº§åˆ°æ–¹æ¡ˆ2, ä¸€æ˜¯é™åˆ¶æƒé™èŒƒå›´, äºŒæ˜¯å¯ä»¥éšæ—¶æ’¤é”€. </p>
<h2 id="å…¶ä»–è§£å†³æ–¹æ¡ˆ"><a href="#å…¶ä»–è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–è§£å†³æ–¹æ¡ˆ"></a>å…¶ä»–è§£å†³æ–¹æ¡ˆ</h2><ul>
<li>ä¹Ÿå¯ä»¥å°†remote repoåˆ‡æ¢æˆ<a href="https://docs.github.com/en/get-started/getting-started-with-git/managing-remote-repositories#switching-remote-urls-from-https-to-ssh">SSHæ–¹å¼</a>, å¹¶é…ç½®SSHå…ç™»å®ç°.</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>distributed-system</tag>
        <tag>login</tag>
        <tag>token</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins Alibaba Cloud æ’ä»¶å¼€å‘æ€»ç»“</title>
    <url>//2022-08-07-jenkins-cloud-plugin-dev-summary/</url>
    <content><![CDATA[<h1 id="Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ"><a href="#Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ" class="headerlink" title="Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ"></a>Cloudæ¡†æ¶çš„æ¶æ„ä¸æ¦‚å¿µ</h1><hr>
<h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><h3 id="ERå›¾"><a href="#ERå›¾" class="headerlink" title="ERå›¾"></a>ERå›¾</h3><pre class="mermaid">erDiagram
    Jenkins ||--o{ hudson_slaves_Cloud : contains
    hudson_slaves_Cloud {
        id name
    }
    hudson_slaves_Cloud ||--|{ SlaveTemplate : contains
    SlaveTemplate {
        id templateName
    }
    SlaveTemplate ||--o{ AlibabaEcsSpotFollower : "provision"
    AlibabaEcsSpotFollower {
        id ecsInstanceId
    }
    AlibabaEcsSpotFollower ||--|| SlaveComputer : createComputer
    SlaveComputer {
        id 
    }</pre>

<h3 id="å„Entityå…³è”å…³ç³»"><a href="#å„Entityå…³è”å…³ç³»" class="headerlink" title="å„Entityå…³è”å…³ç³»"></a>å„Entityå…³è”å…³ç³»</h3><p>&#x2F;&#x2F; TODO: å¾…è¡¥å……å®Œå–„.</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Jenkins</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h2 id="noDelayProvisioning"><a href="#noDelayProvisioning" class="headerlink" title="noDelayProvisioning"></a>noDelayProvisioning</h2><ul>
<li>å½“ä»»åŠ¡é˜Ÿåˆ—é‡Œæœ‰ä»»åŠ¡æ—¶, è‡ªåŠ¨ä¼šåœ¨ instanceFloorä¸instanceCap ä¹‹é—´è¿›è¡Œå¼¹æ€§åˆ›å»ºnode.</li>
</ul>
<p>&#x2F;&#x2F; TODO: å¾…è¡¥å……å®Œå–„.</p>
<h1 id="å…¶ä»–é‡è¦ä¿¡æ¯"><a href="#å…¶ä»–é‡è¦ä¿¡æ¯" class="headerlink" title="å…¶ä»–é‡è¦ä¿¡æ¯"></a>å…¶ä»–é‡è¦ä¿¡æ¯</h1><p>å¯¹è±¡åºåˆ—åŒ–åXMLæ–‡ä»¶è·¯å¾„:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token variable">$&#123;proj_path&#125;</span>/alibabacloud-ecs-plugin/work/config.xml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="æ’ä»¶å¼€å‘çš„ç»éªŒ"><a href="#æ’ä»¶å¼€å‘çš„ç»éªŒ" class="headerlink" title="æ’ä»¶å¼€å‘çš„ç»éªŒ"></a>æ’ä»¶å¼€å‘çš„ç»éªŒ</h1><hr>
<h2 id="è§„æ ¼é€‰æ‹©"><a href="#è§„æ ¼é€‰æ‹©" class="headerlink" title="è§„æ ¼é€‰æ‹©"></a>è§„æ ¼é€‰æ‹©</h2><p>åœ¨è§„æ ¼é€‰æ‹©æ , è®¾è®¡çš„æ—¶å€™ä¸ºäº†ç®€ä¾¿ç”¨æˆ·é€‰æ‹©:</p>
<ol>
<li>ä¸‹æ‹‰æ¡†æ–¹å¼, æ–¹ä¾¿ä¸ç†Ÿæ‚‰ECSçš„ç”¨æˆ·é€‰æ‹©</li>
<li>é»˜è®¤ä½¿ç”¨2C8G, å³ç‹¬äº«å‹æœ€å°è§„æ ¼. ä»è€Œå‡å°‘ä¸‹æ‹‰æ¡†è§„æ ¼é‡, ä¾¿äºå…¥é—¨.</li>
</ol>
<p>ä½†åœ¨å®é™…ä¼ä¸šçº§åœºæ™¯ä¸‹, ç”¨æˆ·</p>
<ol>
<li>éœ€è¦æœ‰å¤§è§„æ ¼, åŸºæœ¬éƒ½æ˜¯48Cä»¥ä¸Š, å³ 12xlarge, 16xlarge, 24xlarge çš„è§„æ ¼</li>
<li>æœ¬èº«ä½¿ç”¨ECS, å¯¹ECSè§„æ ¼ç†Ÿæ‚‰, æœ‰ç›®æ ‡è§„æ ¼.</li>
</ol>
<h2 id="SKUé€‰æ‹©"><a href="#SKUé€‰æ‹©" class="headerlink" title="SKUé€‰æ‹©"></a>SKUé€‰æ‹©</h2><ol>
<li>å•ä¸ªCloudProvider, åªæ”¯æŒä¸€ä¸ªSKU, æ•°é‡å¯ä»¥é€‰æ‹©å¤šä¸ª.<br>ä½†åœ¨å®é™…åœºæ™¯ä¸‹:</li>
<li>ç”¨æˆ·å¸Œæœ›åœ¨å¤šå¯ç”¨åŒº, å¤šè§„æ ¼, è¿™æ ·éœ€è¦é‡å¤é€ä¸€é…ç½®CloudProvider, éå¸¸éº»çƒ¦.</li>
</ol>
<h2 id="ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©"><a href="#ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©" class="headerlink" title="ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©"></a>ç³»ç»Ÿç›˜ç±»å‹é€‰æ‹©</h2><p>åœ¨ç³»ç»Ÿç›˜é€‰æ‹©é¡¹ä¸Š, è®¾è®¡çš„æ—¶å€™ä¸ºäº†ç®€ä¾¿ç”¨æˆ·ä¸Šæ‰‹:</p>
<ol>
<li>ä¸éœ€è¦ç”¨æˆ·å¡«å…¥ç³»ç»Ÿç›˜ç±»å‹, åˆ›å»ºECS(RunInstances)æ—¶ä¸ä¼ å…¥ç³»ç»Ÿç›˜ç±»å‹&amp;å¤§å°, ä»è€Œè®©ECSä½¿ç”¨çš„é»˜è®¤å€¼, å³cloud_efficiency</li>
<li>ä¸éœ€è¦ç”¨æˆ·å¡«å…¥ç³»ç»Ÿç›˜å¤§å°, å³ä½¿ç”¨é»˜è®¤çš„20GB</li>
</ol>
<p>ä½†åœ¨å®é™…åœºæ™¯ä¸‹, ç”¨æˆ·:</p>
<ol>
<li>é€‰æ‹©ecs.c7.xxxè§„æ ¼, 7ä»£è§„æ ¼ä¸æ”¯æŒcloud_efficiency, åªæ”¯æŒcloud_essd, å³RunInstancesæ¥å£å¿…é¡»ä¼ å…¥cloud_essdç³»ç»Ÿç›˜ç±»å‹</li>
</ol>
<h2 id="æ•°æ®ç›˜ç±»å‹"><a href="#æ•°æ®ç›˜ç±»å‹" class="headerlink" title="æ•°æ®ç›˜ç±»å‹"></a>æ•°æ®ç›˜ç±»å‹</h2><p>åœ¨æ•°æ®ç›˜é€‰é¡¹ä¸Š, ä¸ºäº†ç”¨æˆ·ä¸Šæ‰‹æ–¹ä¾¿:</p>
<ol>
<li>é»˜è®¤ä¸åˆ›å»º&amp;æŒ‚è½½ç³»ç»Ÿç›˜, å› æ­¤ä¸éœ€è¦ç”¨æˆ·é€‰æ‹©æ•°æ®ç›˜ç±»å‹&amp;æ•°æ®ç›˜å¤§å°<br>ä½†åœ¨å®é™…åœºæ™¯ä¸‹, ç”¨æˆ·:</li>
<li>ä¼šæœ‰å…¨é•œåƒ, å³é•œåƒä¸­æ—¢åŒ…å«ç³»ç»Ÿç›˜, åˆåŒ…å«æ•°æ®ç›˜</li>
</ol>
<h2 id="Masterä¸Slaveé€šä¿¡æ–¹å¼"><a href="#Masterä¸Slaveé€šä¿¡æ–¹å¼" class="headerlink" title="Masterä¸Slaveé€šä¿¡æ–¹å¼"></a>Masterä¸Slaveé€šä¿¡æ–¹å¼</h2><p>JenkinsMasterä¸Slaveçš„è”é€šæ–¹å¼, è®¾è®¡çš„æ—¶å€™ä¸ºäº†æ–¹ä¾¿åº”å¯¹ç”¨æˆ·Masteråœ¨äº‘ä¸Š&#x2F;å…¶ä»–äº‘ä¸Š&#x2F;äº‘ä¸‹ç­‰åœºæ™¯, é»˜è®¤ä¸ºSlaveåˆ›å»ºå…¬ç½‘IP, ä»è€ŒMasteré€šè¿‡å…¬ç½‘IPä¸Slaveè”é€š.<br>ä½†åœ¨å®é™…åœºæ™¯ä¸‹:</p>
<ol>
<li>åˆ›å»ºå…¬ç½‘IPä¼šå¯¼è‡´é¢‘ç¹çš„æ”»å‡».<pre class="line-numbers language-java" data-language="java"><code class="language-java">ã€XXXã€‘å°Šæ•¬çš„xxxxï¼š
äº‘å®‰å…¨ä¸­å¿ƒæ£€æµ‹åˆ°æ¶æ„XX<span class="token punctuation">.</span>XX<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxxæ­£åœ¨å°è¯•æ”»å‡»æ‚¨çš„æœåŠ¡å™¨ï¼šXX<span class="token punctuation">.</span>XX<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxxï¼ˆXX<span class="token operator">-</span>XX<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>ï¼‰ï¼Œå·²ä¸ºæ‚¨åˆ›å»ºIPæ‹¦æˆªç­–ç•¥ï¼Œå¹¶æˆåŠŸæ‹¦æˆªè¯¥æ¶æ„IPï¼Œå»ºè®®æ‚¨ç™»å½•äº‘å®‰å…¨ä¸­å¿ƒæ§åˆ¶å°å®‰å…¨å‘Šè­¦é¡µä¸­æŸ¥çœ‹IPæ‹¦æˆªç­–ç•¥ã€‚è‹¥æ‚¨éœ€è¦æ”¾è¡Œè¯¥ IP ï¼Œæ‚¨å¯ä»¥åœ¨IP æ‹¦æˆªç­–ç•¥ä¸­ç¦ç”¨å®‰å…¨ç­–ç•¥ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li>ç”¨æˆ·æœ¬èº«VPCå°±æ˜¯åœ¨é˜¿é‡Œäº‘ä¸Š, é€šè¿‡å…¬ç½‘è¿æ¥, ä¼šäº§ç”Ÿé¢å¤–çš„è´¹ç”¨.</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>ci</tag>
        <tag>ci/cd</tag>
      </tags>
  </entry>
  <entry>
    <title>çæŠ˜è…¾è½¯è·¯ç”±ç¬”è®°</title>
    <url>//2022-08-07-software-based-router/</url>
    <content><![CDATA[<p>åƒåœ¾ä½¬çš„å‘¨æœ«, æ²¡äº‹å„¿å°±æ˜¯çæŠ˜è…¾, å‰æ®µæ—¶é—´è¢«ç§è‰äº†è½¯è·¯ç”±, ä¸€ç›´å¿ƒç—’ç—’. æœˆåº•ä¸‹å•å¥¢ä¾ˆä¸€æŠŠ, ä»Šå¤©ç»™å½»åº•æèµ·æ¥äº†. ç°åœ¨æ€»ç»“ä¸‹.</p>
<h1 id="ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±"><a href="#ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±" class="headerlink" title="ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±?"></a>ä¸ºå•¥è¦ä½¿ç”¨è½¯è·¯ç”±?</h1><p>æœ‰å‡ ä¸ªåŸå› : </p>
<ol>
<li>å®¶é‡Œçš„Android(V2RayNG), Mac(ClashX), Windows, Ubuntuç­‰è®¾å¤‡éƒ½æœ‰ç›¸å…³è½¯ä»¶èƒ½ç§‘å­¦ä¸Šç½‘; ä½†iPad, iPhoneç­‰è®¾å¤‡, å®‰è£…å°ç«ç®­, å¿…é¡»è¦ç™»å½•æµ·å¤–AppStore, è€Œä¸”è½¯ä»¶è¿˜æ”¶è´¹, å¤ªéº»çƒ¦, å› æ­¤æ²¡æœ‰é…ç½®ç§‘å­¦ä¸Šç½‘. å¯¹å¼ºè¿«ç—‡æ‚£è€…æ¥è¯´, ç®€ç›´æ˜¯ç¾éš¾.</li>
<li>æƒ³è¦å¯¹ç½‘ç»œè®¾å¤‡çš„å·¥ä½œåŸç†èƒ½æœ‰æ›´æ·±å…¥çš„ç†è§£. ä¾‹å¦‚è·¯ç”±å™¨çš„åº•å±‚å·¥ä½œåŸç†, å®é™…çš„è·¯ç”±è¡¨æ˜¯å’‹æ ·çš„? ä¹‹å‰ä½¿ç”¨åä¸ºçš„è·¯ç”±å™¨, è¿™äº›æƒé™å®Œå…¨æ˜¯æ²¡æœ‰çš„, ä¹Ÿæ²¡åŠæ³•çœ‹åˆ°è¿™äº›çš„. å¯¹äºè¶Šç‹±ç‹‚é­”æ¥è¯´, ä¹ŸåŒæ ·æ˜¯ç¾éš¾.</li>
<li>å®¶é‡Œçš„è·¯ç”±å™¨æ˜æ˜¾æ„Ÿè§‰åŠ›ä¸ä»å¿ƒ, 100Mçš„å¸¦å®½, å¹³å¸¸æ ¹æœ¬è·‘ä¸æ»¡, å°±å¼€å§‹å‘çƒ­. </li>
<li>IPTVå…±äº«: <ol>
<li>æ— æ³•å•Šå¿å—ä¸‘é™‹çš„ç”µä¿¡æœºé¡¶ç›’(çƒ½ç« HG680-J), è®¾è®¡å¾—ä¸‘é™‹ä¸å ª, é¥æ§å™¨å·¨éš¾ç”¨; </li>
<li>åªèƒ½åœ¨å®¢å…ä½¿ç”¨, å§å®¤é‡Œä¹Ÿæƒ³è¿æ¥IPTV, ä½†æ˜¯è¿æ¥ä¸ä¸Š.</li>
</ol>
</li>
</ol>
<p>è½¯è·¯ç”±æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä½åŠŸè€—çš„x86æœºå™¨, åº”è¯¥èƒ½å¾ˆå¥½åœ°è§£å†³ä¸Šè¾¹çš„é—®é¢˜. </p>
<h1 id="é…ç½®æ¸…å•"><a href="#é…ç½®æ¸…å•" class="headerlink" title="é…ç½®æ¸…å•"></a>é…ç½®æ¸…å•</h1><table>
<thead>
<tr>
<th>é…ä»¶åç§°</th>
<th>å“ç‰Œ</th>
<th>ä»·æ ¼</th>
<th>è¯¦ç»†è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸»æœº</td>
<td><a href="https://detail.tmall.com/item.htm?id=673002078011&spm=a1z09.2.0.0.237b2e8dIxvpd0&_u=77rqrdmc3b6">å€æ§</a></td>
<td>729</td>
<td>è£¸æœº,</td>
</tr>
<tr>
<td>CPU</td>
<td><a href="https://www.intel.com/content/www/us/en/products/sku/212328/intel-celeron-processor-n5105-4m-cache-up-to-2-90-ghz/specifications.html">Intel N5105</a></td>
<td>æ— , åŒ…å«åœ¨ä¸»æœºé‡Œ</td>
<td>ç¬¬11ä»£, Jasper Lake; 4Core; 10nm; Base 2GHz, Burst 2.9GHz; 4MB L3 Cache; 10W TDP</td>
</tr>
<tr>
<td>å†…å­˜</td>
<td>ä¸‰æ˜Ÿ</td>
<td>380*2</td>
<td>16GB * 2(ç»„æˆåŒé€šé“); DDR4; 3200MHz;</td>
</tr>
<tr>
<td>é—ªå­˜</td>
<td>è¥¿æ•° SN570</td>
<td>350</td>
<td>500GB; NVME</td>
</tr>
<tr>
<td>ç½‘å¡</td>
<td>Intel I225-V</td>
<td>æ— , åŒ…å«åœ¨ä¸»æœºé‡Œ</td>
<td>4ä¸ªç‰©ç†ç½‘å£&#x2F;å¡; 1000Mbps</td>
</tr>
</tbody></table>
<p>åˆè®¡: <code>729 + 380*2 + 350 = 1839</code>, å‡ ä¹å¯ä»¥è¯´æ˜¯ç›®å‰å·¥æ§æœºçš„é¡¶é…äº†.</p>
<div class="note warning"><p>å†…å­˜é¢‘ç‡é™åˆ¶<br>CPUæ”¯æŒçš„å†…å­˜é¢‘ç‡æœ€å¤§ä¸º<code>2933 MHz</code>, å› æ­¤ä½¿ç”¨çš„ DDR4 <code>3200MHz</code> è¢«è‡ªåŠ¨é™é¢‘åˆ°äº†<code>2933 MHz</code>;</p>
</div>


<h1 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h1><h2 id="OpenWrtå®‰è£…"><a href="#OpenWrtå®‰è£…" class="headerlink" title="OpenWrtå®‰è£…"></a>OpenWrtå®‰è£…</h2><p>è£¸æœºä¸Šå®‰è£…OpenWrt, é…ç½®æ­¥éª¤ç›´æ¥çœ‹å°ç”µè§†: <a href="https://www.bilibili.com/video/BV1w541157Uo?spm_id_from=333.880.my_history.page.click&amp;vd_source=25b2aadfc1b4b676c371c31423142e7b">https://www.bilibili.com/video/BV1w541157Uo?spm_id_from=333.880.my_history.page.click&amp;vd_source=25b2aadfc1b4b676c371c31423142e7b</a></p>
<h2 id="æ’ä»¶é…ç½®"><a href="#æ’ä»¶é…ç½®" class="headerlink" title="æ’ä»¶é…ç½®"></a>æ’ä»¶é…ç½®</h2><ul>
<li>OpenClash: &#x2F;&#x2F; TODO:</li>
</ul>
<h1 id="ç½‘ç»œæ‹“æ‰‘"><a href="#ç½‘ç»œæ‹“æ‰‘" class="headerlink" title="ç½‘ç»œæ‹“æ‰‘"></a>ç½‘ç»œæ‹“æ‰‘</h1><p>ç”±äºå®¶é‡Œçš„ç½‘ç»œæ˜¯FTTB(Fiber-To-The-Building)çš„, å› æ­¤æ²¡æœ‰å…‰çŒ«, åªæœ‰ä¸€æ ¹å…¥æˆ·çº¿. </p>
<h2 id="è½¯è·¯ç”±æ”¹é€ å‰"><a href="#è½¯è·¯ç”±æ”¹é€ å‰" class="headerlink" title="è½¯è·¯ç”±æ”¹é€ å‰"></a>è½¯è·¯ç”±æ”¹é€ å‰</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072212775.png"></p>
<h2 id="è½¯è·¯ç”±æ”¹é€ å"><a href="#è½¯è·¯ç”±æ”¹é€ å" class="headerlink" title="è½¯è·¯ç”±æ”¹é€ å"></a>è½¯è·¯ç”±æ”¹é€ å</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072216377.png"></p>
<h1 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h1><h2 id="æ•ˆæœé¢„è§ˆ"><a href="#æ•ˆæœé¢„è§ˆ" class="headerlink" title="æ•ˆæœé¢„è§ˆ"></a>æ•ˆæœé¢„è§ˆ</h2><ol>
<li>å®‰è£…å¥½ <a href="https://github.com/vernesong/OpenClash">OpenClash</a> æ’ä»¶, å±€åŸŸç½‘å†…ç§‘å­¦ä¸Šç½‘æ— å¿§.  </li>
<li>ç›´æ¥SSHä¸Šå», çœ‹åˆ°ä»»ä½•çš„ç½‘ç»œç›¸å…³ä¿¡æ¯:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072139468.png" alt="ARPè¡¨"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072140766.png" alt="è·¯ç”±è¡¨"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072141717.png" alt="ç½‘æ¡¥"></li>
<li>ç½‘é€ŸåŸºæœ¬èƒ½è·‘æ»¡:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072137732.png"></li>
<li>IPTVå…±äº«: ç›®å‰è¿˜æœªå®ç°, æ¶‰åŠåˆ°ç»„æ’­+vLanç­‰, è¿˜åœ¨ç ”ç©¶ä¸­.</li>
</ol>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul>
<li>CPU Loadæä½, é•¿æœŸç»´æŒåœ¨0.1-;</li>
<li>MEM ä½¿ç”¨æ¯”ä¾‹æä½, é•¿æœŸå¯ç”¨å†…å­˜ç»´æŒåœ¨96%+;</li>
<li>èµ„æºå®Œå…¨æ²¡æœ‰å……åˆ†åˆ©ç”¨èµ·æ¥!<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208072130374.png"></li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»ä½“æ¥è¯´, è™½ç„¶è¾¾åˆ°äº†éƒ¨åˆ†ç›®æ ‡, ä½†è¿˜æ˜¯å¤§æå°ç”¨äº†! åè¾¹è®¡åˆ’æœ‰å‡ ç§æ–¹æ¡ˆæ¥å……åˆ†å‹æ¦¨: </p>
<ul>
<li>å¤šè·‘å‡ ä¸ªdockerå®¹å™¨, ä¾‹å¦‚æ­å»ºJenkins, GitLab, Nginx, Redis; æ–¹ä¾¿è‡ªå·±å¹³å¸¸çš„å‹æµ‹éªŒè¯. </li>
<li>æ”¹æˆè£¸æœºä¸Šåˆ·esxi, æ­å»ºå‡ ä¸ªè™šæ‹Ÿæœº, æŠŠOpenWrtæ”¾åœ¨å…¶ä¸­ä¸€ä¸ªè™šæ‹Ÿæœºé‡Œ, å…¶ä»–çš„Ubuntu, Windowsç­‰ä½œä¸ºæ—¥å¸¸ä¼‘é—²å¨±ä¹æœº.</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>çæŠ˜è…¾</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>network</tag>
        <tag>open-wrt</tag>
        <tag>software-based-router</tag>
        <tag>router</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥æ¢ç©¶DNSæµç¨‹ä¸æŠ¥æ–‡</title>
    <url>//2022-08-08-dns-deep-dive/</url>
    <content><![CDATA[<h1 id="DNSæœåŠ¡å™¨ç±»å‹"><a href="#DNSæœåŠ¡å™¨ç±»å‹" class="headerlink" title="DNSæœåŠ¡å™¨ç±»å‹"></a>DNSæœåŠ¡å™¨ç±»å‹</h1><h2 id="root-nameserver"><a href="#root-nameserver" class="headerlink" title="root nameserver"></a>root nameserver</h2><p>å³è´Ÿè´£<code>.</code>åŸŸåçš„, å…¨çƒåªæœ‰13å°(è‡³äºä¸ºå•¥åªæœ‰13å°, è‡ªå·±googleå§):  </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalkerdeMBP:_assets davywalker$ <span class="token function">dig</span> baidu.com +trace

<span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> DiG <span class="token number">9.10</span>.6 <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> baidu.com +trace
<span class="token punctuation">;</span><span class="token punctuation">;</span> global options: +cmd
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	m.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	a.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	h.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	l.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	i.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	g.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	j.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	c.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	k.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	e.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	f.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	b.root-servers.net.
<span class="token builtin class-name">.</span>			<span class="token number">1</span>	IN	NS	d.root-servers.net.
<span class="token punctuation">;</span><span class="token punctuation">;</span> Received <span class="token number">239</span> bytes from <span class="token number">192.168</span>.1.1<span class="token comment">#53(192.168.1.1) in 7 ms</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="TLD-Top-Level-Domain-nameserver"><a href="#TLD-Top-Level-Domain-nameserver" class="headerlink" title="TLD(Top Level Domain) nameserver"></a>TLD(Top Level Domain) nameserver</h2><p>å³å¯¹åº” <code>.com</code>, <code>.gov</code>, <code>.cn</code> ç­‰çš„è§£ææœåŠ¡å™¨. </p>
<h2 id="authoritative-nameserver"><a href="#authoritative-nameserver" class="headerlink" title="authoritative nameserver"></a>authoritative nameserver</h2><p>å³å¯¹åº” <code>.baidu.com</code> <code>.hangzhou.gov</code>, <code>gitee.cn</code> ç­‰çš„è§£ææœåŠ¡å™¨.<br>é€šå¸¸ authoritative nameserver æ˜¯DNSè§£æçš„æœ€åä¸€æ­¥</p>
<blockquote>
<p>The authoritative nameserver is usually the resolverâ€™s last step in the journey for an IP address.</p>
</blockquote>
<h1 id="DNSæŸ¥è¯¢ç±»å‹"><a href="#DNSæŸ¥è¯¢ç±»å‹" class="headerlink" title="DNSæŸ¥è¯¢ç±»å‹"></a>DNSæŸ¥è¯¢ç±»å‹</h1><h2 id="é€’å½’å¼-Recursive-Query"><a href="#é€’å½’å¼-Recursive-Query" class="headerlink" title="é€’å½’å¼(Recursive Query)"></a>é€’å½’å¼(Recursive Query)</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092118248.png"></p>
<h3 id="DNSè¯·æ±‚"><a href="#DNSè¯·æ±‚" class="headerlink" title="DNSè¯·æ±‚:"></a>DNSè¯·æ±‚:</h3><p>å¦‚ä¸‹, æ˜¯ä¸ªè¯·æ±‚ä¸­çš„æ ‡è¯†ä½, ä½¿ç”¨digå‘½ä»¤, </p>
<ul>
<li>å¦‚æœ<code>+trace</code>åˆ™è¯·æ±‚è‡ªåŠ¨ç¦ç”¨é€’å½’(å³å¦‚ä¸‹é€’å½’æ ‡è¯†è®¾ç½®ä¸ºfalse);<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082351183.png"></li>
<li>ä¸åŠ <code>+trace</code>, åˆ™è¯·æ±‚è‡ªåŠ¨ä½¿ç”¨é€’å½’.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092101659.png"></li>
</ul>
<h3 id="DNSå“åº”"><a href="#DNSå“åº”" class="headerlink" title="DNSå“åº”:"></a>DNSå“åº”:</h3><p>å¦‚ä¸‹, </p>
<ul>
<li>ä»£è¡¨å½“å‰LocalDNSæœåŠ¡å™¨æ”¯æŒé€’å½’æŸ¥è¯¢.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082352908.png"></li>
<li>ä¸æ­¤å½¢æˆé²œæ˜å¯¹æ¯”çš„æ˜¯ROOTæ ¹DNSæœåŠ¡å™¨è¿”å›ä¸æ”¯æŒé€’å½’æŸ¥è¯¢.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082353697.png"></li>
</ul>
<h2 id="è¿­ä»£å¼-Iterative-Query"><a href="#è¿­ä»£å¼-Iterative-Query" class="headerlink" title="è¿­ä»£å¼(Iterative Query)"></a>è¿­ä»£å¼(Iterative Query)</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092115451.png"></p>
<h1 id="dig-é‡è¦å‚æ•°ä¸æ¨¡å¼"><a href="#dig-é‡è¦å‚æ•°ä¸æ¨¡å¼" class="headerlink" title="dig é‡è¦å‚æ•°ä¸æ¨¡å¼"></a><code>dig</code> é‡è¦å‚æ•°ä¸æ¨¡å¼</h1><h2 id="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨"><a href="#æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨" class="headerlink" title="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨"></a>æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨</h2><h3 id="æ–¹å¼1-ä½¿ç”¨-traceå‚æ•°"><a href="#æ–¹å¼1-ä½¿ç”¨-traceå‚æ•°" class="headerlink" title="æ–¹å¼1: ä½¿ç”¨+traceå‚æ•°:"></a>æ–¹å¼1: ä½¿ç”¨<code>+trace</code>å‚æ•°:</h3><p>ä¾‹å¦‚ <code>dig @8.8.8.8 baidu.com +trace</code>: </p>
<ol>
<li>@8.8.8.8 åˆ™dig +traceæ—¶, ä»£è¡¨è·å–ROOT ServeråŸŸååˆ—è¡¨, ä¼šè¯·æ±‚8.8.8.8</li>
<li>ä¹‹åä¼šæŠŠæ¯ä¸ªROOT Serverçš„åŸŸå, ä¾‹å¦‚ a.root-servers.net b.root-servers.net ç­‰, è¯·æ±‚LocalDNS(å¦‚å›¾ä¸­çš„30.30.30.30), é€šè¿‡é€’å½’æ–¹å¼(recurse&#x3D;1), è·å–åˆ°å¯¹åº”çš„Aè®°å½•. æ³¨æ„, è¿™é‡Œå°±ä¸å†æ˜¯è¯·æ±‚ 8.8.8.8 äº†!!</li>
<li>ä¹‹åå†è¯·æ±‚æŸä¸ªROOT Server, è·å–åˆ°TLD Serverçš„åŸŸå. ä¾æ¬¡ç±»æ¨, èµ°æ­£å¸¸è¿­ä»£DNSæ–¹å¼.<br>æ‰€ä»¥ @x.x.x.x +trace, æœ¬è´¨ä¸Šæ˜¯ä» 8.8.8.8 è·å–åˆ°æ ¹åŸŸååœ°å€. ä¹‹åè¿˜æ˜¯èµ°çš„æ­£å¸¸è¿­ä»£æŸ¥è¯¢DNSæµç¨‹.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092122506.png"></li>
</ol>
<h3 id="æ–¹å¼2-ä¸ä½¿ç”¨-traceå‚æ•°"><a href="#æ–¹å¼2-ä¸ä½¿ç”¨-traceå‚æ•°" class="headerlink" title="æ–¹å¼2: ä¸ä½¿ç”¨+traceå‚æ•°:"></a>æ–¹å¼2: ä¸ä½¿ç”¨<code>+trace</code>å‚æ•°:</h3><p>ä¾‹å¦‚ <code>dig @8.8.8.8 baidu.com</code></p>
<ol>
<li>@8.8.8.8 åˆ™digæ—¶, ä¼šè¯·æ±‚8.8.8.8, è®©8.8.8.8é€šè¿‡é€’å½’æ–¹å¼, ç›´æ¥ç»™å‡ºå¯¹åº”baidu.comå¯¹åº”çš„IPåœ°å€.</li>
<li>æ³¨æ„: è¿™ç§å°±æ˜¯å®é™…å¸¸ç”¨çš„æ­£å¸¸DNSè§£ææµç¨‹.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092124056.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092125582.png"></li>
</ol>
<p>å¦‚ä¸‹å›¾, è¿™æ˜¯ä»æµè§ˆå™¨é‡Œè¾“å…¥baidu.comä¹‹åçš„DNSæµç¨‹, å¯çŸ¥æ˜¯é€’å½’å¼çš„:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092128420.png"></p>
<h3 id="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“"><a href="#æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“" class="headerlink" title="æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“"></a>æŒ‡å®šåŸŸåè§£ææœåŠ¡å™¨æ€»ç»“</h3><p>å¦‚æœä¸æŒ‡å®š, åˆ™é»˜è®¤: </p>
<ol>
<li>è¯·æ±‚LocalDNS, é€šè¿‡ <code>cat /etc/resolv.conf</code> å¯çŸ¥LocalDNSçš„IP</li>
<li>è®©LocalDNSä½¿ç”¨é€’å½’çš„æ–¹å¼ç»™å‡ºç»“æœ.</li>
</ol>
<h2 id="æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ"><a href="#æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ" class="headerlink" title="æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ"></a>æŒ‡å®šä½¿ç”¨TCPåè®®è§£æ</h2><p>é»˜è®¤DNSåè®®æ˜¯åŸºäºUDP 53ç«¯å£; ä½†ä¹Ÿå¯ä»¥åŸºäºTCP 53ç«¯å£å®Œæˆè¯·æ±‚.  </p>
<h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dig</span> @8.8.8.8 baidu.com +tcp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="åŒ…è§£æ"><a href="#åŒ…è§£æ" class="headerlink" title="åŒ…è§£æ"></a>åŒ…è§£æ</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092204677.png"></p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>&#x2F;&#x2F; TODO:<br>&#x2F;&#x2F; 1. å¯ä»¥æ€è€ƒä¸‹ DNS over TCP(DoT) ä¸DNS over UDP(DoU)å„è‡ªçš„ä¼˜ç¼ºç‚¹<br>&#x2F;&#x2F; 2. è¿‘å‡ å¹´æœ‰ DNS over TLS; DNS over HTTP; DNS over HTTPS; ä¸ºå•¥ä¼šæœ‰è¿™ä¹ˆå¤šå¥—å¨ƒåè®®? æ˜¯ä¸ºäº†è§£å†³å•¥é—®é¢˜? ä¼˜ç¼ºç‚¹æ˜¯å•¥? </p>
<h1 id="WireSharkæŠ“åŒ…å®æˆ˜"><a href="#WireSharkæŠ“åŒ…å®æˆ˜" class="headerlink" title="WireSharkæŠ“åŒ…å®æˆ˜"></a>WireSharkæŠ“åŒ…å®æˆ˜</h1><h2 id="ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…"><a href="#ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…" class="headerlink" title="ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…"></a>ç®€å•çš„é¡¶çº§åŸŸåDNSæŠ“åŒ…</h2><h3 id="å‘½ä»¤-1"><a href="#å‘½ä»¤-1" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°±ç®€å•åœ°å¯¹baidu.comè¿›è¡ŒDNSæŠ“åŒ…</span>
davywalkerdeMBP:_assets davywalker$ <span class="token function">dig</span> baidu.com +trace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="traceè¿­ä»£å¼-WireSharkåˆ†æ"><a href="#traceè¿­ä»£å¼-WireSharkåˆ†æ" class="headerlink" title="+traceè¿­ä»£å¼, WireSharkåˆ†æ"></a><code>+trace</code>è¿­ä»£å¼, WireSharkåˆ†æ</h3><h4 id="ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–-å¯¹åº”çš„root-nameserver"><a href="#ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–-å¯¹åº”çš„root-nameserver" class="headerlink" title="ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–.å¯¹åº”çš„root nameserver"></a>ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–<code>.</code>å¯¹åº”çš„root nameserver</h4><h5 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>/etc/resolv.conf</code>ä¸­å¯¹åº”çš„LocalDNS IP</li>
<li>è¯·æ±‚æ˜¯UDPåè®®, ç›®æ ‡LocalDNSçš„ç«¯å£å·æ˜¯53</li>
<li>è¯·æ±‚å†…å®¹æ˜¯: <code>&lt;ROOT&gt;</code>, å³æ ¹åŸŸåDNS; ç±»å‹æ˜¯ <code>NS</code>, å³nameserver; å°±æ˜¯è¯·æ±‚æ ¹åŸŸåçš„nameserver<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082303614.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082259231.png"></li>
</ul>
<h5 id="å“åº”"><a href="#å“åº”" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>å“åº”å†…å®¹é‡Œæœ‰13ä¸ªæ ¹åŸŸåæœåŠ¡å™¨çš„åŸŸå </li>
<li>ä½†æ³¨æ„: <mark>æ²¡æœ‰è¿”å›nameserverçš„domainå¯¹åº”çš„IPåœ°å€!!!</mark> , ç»åˆ†æä¸æ¨æµ‹, ç”±äºå…¨çƒ13ä¸ªæ ¹åŸŸåæœåŠ¡å™¨çš„IPæ˜¯<del>æ°¸è¿œä¸ä¼šå˜</del>çš„(æœ‰å¯èƒ½ä¼šå˜åŒ–, <a href="https://web.archive.org/web/20130310100321/http://d.root-servers.org/renumber.html">å†å²ä¸Šä¹Ÿå˜åŒ–è¿‡</a>), å„ä¸ªdomainå¯¹åº”çš„IPåœ°å€åº”è¯¥æ˜¯<mark>é€šè¿‡<a href="https://www.iana.org/domains/root/files">Root Hint File</a>, ç¼“å­˜åœ¨æ“ä½œç³»ç»Ÿä¸­</mark>.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082306546.png"></li>
</ul>
<h4 id="ç¬¬äºŒæ­¥-å‘root-nameserverè¯·æ±‚-è¯·æ±‚è·å–-com-å¯¹åº”çš„TLDâ€™s-nameserver"><a href="#ç¬¬äºŒæ­¥-å‘root-nameserverè¯·æ±‚-è¯·æ±‚è·å–-com-å¯¹åº”çš„TLDâ€™s-nameserver" class="headerlink" title="ç¬¬äºŒæ­¥: å‘root nameserverè¯·æ±‚, è¯·æ±‚è·å–.com.å¯¹åº”çš„TLDâ€™s nameserver"></a>ç¬¬äºŒæ­¥: å‘root nameserverè¯·æ±‚, è¯·æ±‚è·å–<code>.com.</code>å¯¹åº”çš„TLDâ€™s nameserver</h4><h5 id="è¯·æ±‚-1"><a href="#è¯·æ±‚-1" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>202.12.27.33</code>, ç»åˆ†æ, æ˜¯<code>m.root-servers.net.</code>å¯¹åº”çš„IPåœ°å€. åº”è¯¥æ˜¯æŒ‰ç…§æŸç§ç®—æ³•éšæœºé€‰çš„.</li>
<li>è¯·æ±‚æƒ³è¦ç›´æ¥ä»root nameserverä¸­è·å–åˆ° baidu.com çš„Aè®°å½•<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082308662.png"></li>
</ul>
<h5 id="å“åº”-1"><a href="#å“åº”-1" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>å“åº”å†…å®¹é‡Œæœ‰13ä¸ª<code>.com.</code>åŸŸåæœåŠ¡å™¨çš„åŸŸå.</li>
<li>ä½†æ³¨æ„: <mark>åŒæ—¶åœ¨Additional recordséƒ¨åˆ†, æŠŠå„ä¸ªåŸŸåæœåŠ¡å™¨å¯¹åº”çš„IPä¹Ÿéƒ½ä»¥Aè®°å½•å½¢å¼è¿”å›</mark>. è¿™ä¸ªå°±æ˜¯æ‰€è°“çš„ <strong><a href="https://blog.csdn.net/dranker/article/details/109754755">Glue Record</a></strong>, è¯•æƒ³ä¸‹, å¦‚æœæ²¡æœ‰è¿”å›Aè®°å½•, é‚£ä¹ˆå¦‚æœ<code>.com.</code>è¿”å›çš„nameserveræ˜¯<code>a.com.</code>, é‚£ä¹ˆå¦‚ä½•è·å–åˆ°è¿™ä¸ªdomainå¯¹åº”çš„IP? é€šè¿‡DNSä¹ˆ? é‚£å°±æ— é™é€’å½’äº†!</li>
<li>Additional recordsä¸­<code>AAAA</code>è®°å½•, ä»£è¡¨çš„æ˜¯å„ä¸ªåŸŸåæœåŠ¡å™¨å¯¹åº”çš„IPV6åœ°å€.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082315463.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082321212.png"></li>
</ul>
<h4 id="ç¬¬ä¸‰æ­¥-å‘TLDâ€™s-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„authoritative-nameserver"><a href="#ç¬¬ä¸‰æ­¥-å‘TLDâ€™s-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„authoritative-nameserver" class="headerlink" title="ç¬¬ä¸‰æ­¥: å‘TLDâ€™s nameserverè¯·æ±‚, è¯·æ±‚è·å–baidu.com.å¯¹åº”çš„authoritative nameserver"></a>ç¬¬ä¸‰æ­¥: å‘TLDâ€™s nameserverè¯·æ±‚, è¯·æ±‚è·å–<code>baidu.com.</code>å¯¹åº”çš„authoritative nameserver</h4><h5 id="è¯·æ±‚-2"><a href="#è¯·æ±‚-2" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>192.31.80.30</code>, é€šè¿‡ç¿»çœ‹ä¸Šä¸€ä¸ªGlue Record, å¯ä»¥çŸ¥é“æ­£æ˜¯<code>d.gtld-servers.net: type A, class IN, addr 192.31.80.30</code>å¯¹åº”çš„IP.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082323511.png"></li>
</ul>
<h5 id="å“åº”-2"><a href="#å“åº”-2" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>å“åº”çš„å†…å®¹é‡Œæ²¡æœ‰<code>baidu.com</code>çš„Aè®°å½•ä¿¡æ¯, è€Œæ˜¯ä¸€å †çš„NSè®°å½•ä¿¡æ¯, ä»¥åŠNSå¯¹åº”çš„IP, å› æ­¤è¿˜éœ€è¦ç»§ç»­å¾€ä¸‹æŸ¥.</li>
<li>å¦‚æœæ˜¯æŸ¥è¯¢é¡¶çº§åŸŸå(ä¾‹å¦‚github.com), æˆ–è€…äºŒçº§åŸŸå(ä¾‹å¦‚login.github.com)ç­‰:  <ul>
<li>é‚£ä¹ˆç†è®ºä¸Šè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç›´æ¥è¿”å›Aè®°å½•äº†. å³ä¸ç”¨å†èµ°ç¬¬å››æ­¥äº†. æ­¤æ—¶Aè®°å½•å¯ä»¥æ˜¯ä¸ªVIP, ç„¶åæ ¹æ®è¯·æ±‚å…·ä½“çš„äºŒçº§åŸŸå, ä¾‹å¦‚<code>login.github.com</code>, é€šè¿‡Nginxç­‰åå‘ä»£ç†åˆ°å¯¹åº”æœåŠ¡å³å¯.</li>
<li>ä½†å®é™…åˆ†æäº†ä¸‹, å¤§éƒ¨åˆ†ç½‘ç«™(å¦‚ä¸‹å›¾ä¸­<code>alibaba.com</code>, <code>zhihu.com</code>, <code>aliyun.com</code>ç­‰), éƒ½æ˜¯åœ¨è¿™é‡Œè¿”å›è‡ªå·±çš„<code>authoritative nameserver</code>, è‡ªå·±æ€è€ƒäº†ä¸‹åŸå› : <ul>
<li>ä¸€æ˜¯: å› ä¸º TLDâ€™s nameserver é€šå¸¸æ˜¯ç”±å›½å®¶æˆ–è€…ç»„ç»‡ç»Ÿä¸€ç®¡ç†çš„, å„ä¸ªå…¬å¸å¦‚æœIPå˜åŒ–, ä¸å¥½åŒæ­¥åˆ° TLD ä¸­. è€Œ authoritative nameserver ä¸€èˆ¬éƒ½æ˜¯å„ä¸ªå…¬å¸è‡ªå·±ç®¡ç†, æ—¶æ•ˆæ€§ä¸çµæ´»æ€§éƒ½å¾ˆé«˜. ä¾‹å¦‚å¯ä»¥ç»™æŸäº›äºŒçº§&#x2F;ä¸‰çº§åŸŸåé…ç½®ä¸åŒçš„IP.  </li>
<li>äºŒæ˜¯: å› ä¸ºå¦‚æœç›´æ¥Aè®°å½•æ³¨å†Œåœ¨TLDä¸Š, é‚£ä¹ˆæ•´ä¸ªç½‘ç«™çš„æ‰€æœ‰äºŒçº§&#x2F;ä¸‰çº§åŸŸåç­‰, å°±åªèƒ½æœ‰ä¸€ä¸ªIPå…¥å£äº†. æ•´ä½“é£é™©å°±å¾ˆå¤§äº†. å¦‚æœVIPæŒ‚äº†, æ•´ä¸ªç½‘ç«™éƒ½ä¸å¯ç”¨äº†. å¦‚æœæ˜¯ä¸åŒçš„äºŒçº§åŸŸå, åˆ†é…ä¸åŒnameserver, åˆ™</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082326335.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082343058.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082343720.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082344089.png"></p>
<h4 id="ç¬¬å››æ­¥-å‘authoritative-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„ip"><a href="#ç¬¬å››æ­¥-å‘authoritative-nameserverè¯·æ±‚-è¯·æ±‚è·å–baidu-com-å¯¹åº”çš„ip" class="headerlink" title="ç¬¬å››æ­¥: å‘authoritative nameserverè¯·æ±‚, è¯·æ±‚è·å–baidu.com.å¯¹åº”çš„ip"></a>ç¬¬å››æ­¥: å‘authoritative nameserverè¯·æ±‚, è¯·æ±‚è·å–<code>baidu.com.</code>å¯¹åº”çš„ip</h4><h5 id="è¯·æ±‚-3"><a href="#è¯·æ±‚-3" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°:</p>
<ul>
<li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>14.215.178.80</code>, é€šè¿‡ç¿»çœ‹ä¸Šä¸€ä¸ªGlue Record, å¯ä»¥çŸ¥é“æ­£æ˜¯<code>ns4.baidu.com: type A, class IN, addr 14.215.178.80</code>å¯¹åº”çš„IP.</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082345386.png"></p>
<h5 id="å“åº”-3"><a href="#å“åº”-3" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>æ­£ç¡®åœ°è¿”å›äº†<code>baidu.com</code>çš„Aè®°å½•<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208082347974.png"></li>
</ul>
<h3 id="ä¸åŠ -traceé€’å½’å¼-WireSharkåˆ†æ"><a href="#ä¸åŠ -traceé€’å½’å¼-WireSharkåˆ†æ" class="headerlink" title="ä¸åŠ +traceé€’å½’å¼, WireSharkåˆ†æ"></a>ä¸åŠ <code>+trace</code>é€’å½’å¼, WireSharkåˆ†æ</h3><h4 id="ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–aliyun-comçš„IPåœ°å€-Aè®°å½•"><a href="#ç¬¬ä¸€æ­¥-å‘LocalDNSå‘èµ·è¯·æ±‚-è¯·æ±‚è·å–aliyun-comçš„IPåœ°å€-Aè®°å½•" class="headerlink" title="ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–aliyun.comçš„IPåœ°å€(Aè®°å½•)"></a>ç¬¬ä¸€æ­¥: å‘LocalDNSå‘èµ·è¯·æ±‚, è¯·æ±‚è·å–<code>aliyun.com</code>çš„IPåœ°å€(Aè®°å½•)</h4><h5 id="è¯·æ±‚-4"><a href="#è¯·æ±‚-4" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h5><p>å¯ä»¥çœ‹åˆ°:</p>
<ul>
<li>è¯·æ±‚çš„ç›®æ ‡IPæ˜¯<code>/etc/resolv.conf</code>ä¸­å¯¹åº”çš„LocalDNS IP<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208090001833.png"></li>
</ul>
<h5 id="å“åº”-4"><a href="#å“åº”-4" class="headerlink" title="å“åº”"></a>å“åº”</h5><p>å¯ä»¥çœ‹åˆ°: </p>
<ul>
<li>LocalDNSç›´æ¥æŠŠDNSçš„Aè®°å½•ç»“æœè¿”å›äº†. æ‰€æœ‰çš„è¿­ä»£æ“ä½œéƒ½æ˜¯LocalDNSæ‰§è¡Œçš„äº†.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208090002803.png"></li>
</ul>
<h1 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h1><h2 id="åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜"><a href="#åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜" class="headerlink" title="åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜"></a>åŸŸåæœåŠ¡å™¨æœ¬èº«IPè§£æé—®é¢˜</h2><p>DNSåè®®è¿”å›äº†æ ¹åŸŸåæœåŠ¡å™¨çš„åŸŸå, ä¾‹å¦‚<code>m.root-servers.net.</code>, ä½†å®é™…åç»­å‘æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢TLDåŸŸåæœåŠ¡å™¨çš„è¯·æ±‚æ—¶, æ˜¯éœ€è¦çŸ¥é“æ ¹åŸŸåæœåŠ¡å™¨çš„IPçš„! è¿™ä¸ªIPä»å“ªé‡Œè·å–? é€šè¿‡WireSharkæŠ“åŒ…, å‘ç°è¿”å›çš„æ ¹åŸŸåæœåŠ¡å™¨åŸŸååˆ—è¡¨é‡Œ, æ²¡æœ‰è¿™äº›åŸŸåå¯¹åº”çš„IPåœ°å€. éš¾é“ä¹Ÿæ˜¯é€šè¿‡DNSè§£æçš„ä¹ˆ? è¿™æ ·å°±æ¶‰åŠåˆ°å¾ªç¯.<br><mark> Glue Record </mark></p>
<h2 id="digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ"><a href="#digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ" class="headerlink" title="digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ?"></a>digè¯·æ±‚èƒ½å¦ä½¿ç”¨æŒ‡å®šâ€é€’å½’å¼â€æˆ–è€…â€è¿­ä»£å¼â€ä¹ˆ?</h2><blockquote>
<p>åˆ‡æ¢æŸ¥è¯¢ä¸­çš„ RDï¼ˆè¦æ±‚é€’å½’ï¼‰ä½è®¾ç½®ã€‚<br>åœ¨ç¼ºçœæƒ…å†µä¸‹è®¾ç½®è¯¥ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ dig æ­£å¸¸æƒ…å½¢ä¸‹å‘é€é€’å½’æŸ¥è¯¢ã€‚<br>å½“ä½¿ç”¨æŸ¥è¯¢é€‰é¡¹ +nssearch æˆ– +trace æ—¶ï¼Œé€’å½’è‡ªåŠ¨ç¦ç”¨ã€‚</p>
</blockquote>
<h2 id="æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„"><a href="#æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„" class="headerlink" title="æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„?"></a>æœ‰CNAMEçš„DNSè¯·æ±‚å…·ä½“æ˜¯å’‹æ ·çš„?</h2><p>ä¾‹å¦‚ <code>dig passport.baidu.com +trace</code>, è¿”å›: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">passport.baidu.com. <span class="token number">1200</span> IN CNAME passport.n.shifen.com.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>åœ¨digè°ƒç”¨æµç¨‹ä¸­, åˆ°CNAMEå°±ç»“æŸäº†; å› ä¸ºæ²¡æœ‰ç»§ç»­æ‰§è¡Œ<code>dig passport.n.shifen.com +trace</code></li>
<li>ä½†åœ¨å®é™…æµè§ˆå™¨è®¿é—®æ—¶, æµè§ˆå™¨æ”¶åˆ°CNAMEè®°å½•, ä¼šé‡æ–°å‘ä¸€ä¸ªDNSè¯·æ±‚è§£æ<code>passport.n.shifen.com</code>åŸŸå.</li>
</ul>
<h2 id="ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ"><a href="#ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ" class="headerlink" title="ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ?"></a>ç›´æ¥ä½¿ç”¨DNSè¿”å›çš„IPè®¿é—®ç½‘ç«™å¯ä»¥ä¹ˆ?</h2><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å¦‚ä¸‹, è¿”å›çš„<code>baidu.com</code>çš„Aè®°å½•<code>39.156.66.10</code>IPåœ°å€: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">^CdavywalkerdeMBP:~ davywalker$ <span class="token function">dig</span> baidu.com
<span class="token punctuation">;</span><span class="token punctuation">;</span> QUESTION SECTION:
<span class="token punctuation">;</span>baidu.com.			IN	A
<span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:
baidu.com.		<span class="token number">1</span>	IN	A	<span class="token number">110.242</span>.68.66
baidu.com.		<span class="token number">1</span>	IN	A	<span class="token number">39.156</span>.66.10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>æ˜¯å¦å¯ä»¥ä¸ç”¨åŸŸåç›´æ¥é€šè¿‡IPè®¿é—®?</li>
<li>ç­”æ¡ˆæ˜¯<mark>ä¸å¯ä»¥</mark><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092137035.png"></li>
</ul>
<h3 id="ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ"><a href="#ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ" class="headerlink" title="ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ"></a>ä¸ºå•¥è¦ç¦æ­¢ç›´æ¥é€šè¿‡ipè®¿é—®ï¼Ÿ</h3><ul>
<li>è™šæ‹Ÿä¸»æœºï¼Œä¸»æœºä¸Šæ”¾ç½®äº†Nä¸ªç½‘ç«™ï¼Œè€Œæ¯ä¸ªç½‘ç«™ç»‘å®š1ä¸ªæˆ–ä»¥ä¸ŠåŸŸåï¼Œæ‰€ä»¥ç”¨åŸŸåè®¿é—®ä¸»æœºå¯ä»¥è§£æåˆ°ç½‘ç«™ç›®å½•ï¼Œä½†ç”¨IPçš„è¯æœåŠ¡å™¨å°±ä¸çŸ¥é“è§£æåˆ°å“ªä¸ªç›®å½•äº†ï¼</li>
<li>ä¸ºäº†é¿å…åˆ«äººæŠŠæœªå¤‡æ¡ˆçš„åŸŸåè§£æåˆ°è‡ªå·±çš„æœåŠ¡å™¨IPè€Œå¯¼è‡´æœåŠ¡å™¨è¢«æ–­ç½‘; ç›®å‰å›½å†…å¾ˆå¤šæœºæˆ¿éƒ½è¦æ±‚ç½‘ç«™ä¸»å…³é—­ç©ºä¸»æœºå¤´ï¼Œé˜²æ­¢æœªå¤‡æ¡ˆçš„åŸŸåæŒ‡å‘è¿‡æ¥é€ æˆéº»çƒ¦</li>
<li>å¯èƒ½æ˜¯å‡ºäºå®‰å…¨çš„è€ƒè™‘, å¦‚æœç›´æ¥ä½¿ç”¨IPè®¿é—®, åˆ™HTTPSè¯ä¹¦æœ‰æ•ˆæ€§å°±æ— æ³•æ ¡éªŒäº†. è¿™æ ·è¢«é’“é±¼äº†ä¹Ÿä¸çŸ¥é“.</li>
</ul>
<h3 id="å®è·µ-å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®-ä»¥Nginxä¸ºä¾‹"><a href="#å®è·µ-å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®-ä»¥Nginxä¸ºä¾‹" class="headerlink" title="å®è·µ: å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®(ä»¥Nginxä¸ºä¾‹)"></a>å®è·µ: å¦‚ä½•è®¾ç½®ç¦æ­¢ipç›´æ¥è®¿é—®(ä»¥Nginxä¸ºä¾‹)</h3><ul>
<li>å‚è§å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£: <a href="http://nginx.org/en/docs/http/request_processing.html">How to prevent processing requests with undefined server names</a></li>
<li>å®è·µå‚ç…§: <a href="https://davyjones2010.github.io/2022-08-09-nginx-scripts/#%E7%A6%81%E6%AD%A2%E9%80%9A%E8%BF%87IP%E8%AE%BF%E9%97%AE">Nginxé…ç½®-ç¦æ­¢é€šè¿‡IPè®¿é—®</a></li>
</ul>
<h3 id="å®è·µ-å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡-ä»¥Nginxä¸ºä¾‹"><a href="#å®è·µ-å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡-ä»¥Nginxä¸ºä¾‹" class="headerlink" title="å®è·µ: å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡(ä»¥Nginxä¸ºä¾‹)"></a>å®è·µ: å¦‚ä½•è®¾ç½®å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡(ä»¥Nginxä¸ºä¾‹)</h3><ul>
<li>å‚è§å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£: <a href="http://nginx.org/en/docs/http/request_processing.html">How to prevent processing requests with undefined server names</a></li>
<li>å®è·µå‚ç…§: <a href="https://davyjones2010.github.io/2022-08-09-nginx-scripts/#%E5%8D%95Host%E5%A4%9A%E5%9F%9F%E5%90%8D-%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%90%8C%E6%9C%8D%E5%8A%A1">Nginxé…ç½®-å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡
</a></li>
</ul>
<h3 id="nslookup-å¦‚ä½•æŒ‡å®š-nameserver"><a href="#nslookup-å¦‚ä½•æŒ‡å®š-nameserver" class="headerlink" title="nslookup å¦‚ä½•æŒ‡å®š nameserver?"></a>nslookup å¦‚ä½•æŒ‡å®š nameserver?</h3><ul>
<li><p>å¦‚ä¸‹, æŒ‡å®š <code>ns7.taobao.com.</code> ä¸ºæŸ¥è¯¢ <code>taobao.com</code> åŸŸåçš„ns</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nslookup</span> taobao.com ns7.taobao.com.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>å®Œæ•´çš„nslookupå‘½ä»¤å‚è§: <a href="https://phoenixnap.com/kb/nslookup-command">How to Use the nslookup Command</a></p>
</li>
</ul>
<h3 id="â€œNon-authoritative-answerâ€-ä»£è¡¨å•¥æ„æ€"><a href="#â€œNon-authoritative-answerâ€-ä»£è¡¨å•¥æ„æ€" class="headerlink" title="â€œNon-authoritative answerâ€ ä»£è¡¨å•¥æ„æ€?"></a>â€œNon-authoritative answerâ€ ä»£è¡¨å•¥æ„æ€?</h3><p>å¦‚ä¸‹,  â€œNon-authoritative answerâ€ ä»£è¡¨è¯·æ±‚ä¸æ˜¯ç”±å¯¹åº”çš„æƒå¨æœåŠ¡å™¨è¿”å›, è€Œæ˜¯ç”±æœ¬åœ°æˆ–è€…å…¶ä»–DNSç¼“å­˜çš„ç»“æœ.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> google.com
Server:  one.one.one.one
Address:  <span class="token number">1.1</span>.1.1

Non-authoritative answer:
google.com      MX preference <span class="token operator">=</span> <span class="token number">10</span>, mail exchanger <span class="token operator">=</span> aspmx.l.google.com
google.com      MX preference <span class="token operator">=</span> <span class="token number">20</span>, mail exchanger <span class="token operator">=</span> alt1.aspmx.l.google.com
google.com      MX preference <span class="token operator">=</span> <span class="token number">30</span>, mail exchanger <span class="token operator">=</span> alt2.aspmx.l.google.com
google.com      MX preference <span class="token operator">=</span> <span class="token number">40</span>, mail exchanger <span class="token operator">=</span> alt3.aspmx.l.google.com
google.com      MX preference <span class="token operator">=</span> <span class="token number">50</span>, mail exchanger <span class="token operator">=</span> alt4.aspmx.l.google.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.cloudflare.com/learning/dns/dns-server-types/">https://www.cloudflare.com/learning/dns/dns-server-types/</a></li>
<li><a href="https://www.jianshu.com/p/f6ef04bf6af2">https://www.jianshu.com/p/f6ef04bf6af2</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>dns</tag>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„Nginxå‘½ä»¤ä¸é…ç½®</title>
    <url>//2022-08-09-nginx-scripts/</url>
    <content><![CDATA[<h1 id="MACç¯å¢ƒ"><a href="#MACç¯å¢ƒ" class="headerlink" title="MACç¯å¢ƒ"></a>MACç¯å¢ƒ</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/local/var/www
/usr/local/Cellar/nginx/1.21.3/html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="é…ç½®æ–‡ä»¶è·¯å¾„"><a href="#é…ç½®æ–‡ä»¶è·¯å¾„" class="headerlink" title="é…ç½®æ–‡ä»¶è·¯å¾„"></a>é…ç½®æ–‡ä»¶è·¯å¾„</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/local/etc/nginx
/usr/local/etc/nginx/nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="ç¦æ­¢é€šè¿‡IPè®¿é—®"><a href="#ç¦æ­¢é€šè¿‡IPè®¿é—®" class="headerlink" title="ç¦æ­¢é€šè¿‡IPè®¿é—®"></a>ç¦æ­¢é€šè¿‡IPè®¿é—®</h3><ul>
<li>ç»‘å®šäº†hosts<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1 example.org www.example.org<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>åªå…è®¸é€šè¿‡<code>localhost:8080</code>æˆ–è€…<code>example.org:8080</code>æˆ–è€…<code>www.example.org:8080</code>è®¿é—®, </li>
<li>ç¦æ­¢é€šè¿‡<code>127.0.0.1:8080</code>è®¿é—®, è¿”å›502é”™è¯¯.<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>
    listen  <span class="token number">8080</span><span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">502</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

server <span class="token punctuation">&#123;</span>
    listen       <span class="token number">8080</span><span class="token punctuation">;</span>
    server_name  localhost example.org www.example.org<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092149192.png"></p>
<h3 id="å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡"><a href="#å•Hostå¤šåŸŸå-ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡" class="headerlink" title="å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡"></a>å•Hostå¤šåŸŸå, ä¸åŒåŸŸåè®¿é—®ä¸åŒæœåŠ¡</h3><ul>
<li>ç»‘å®šäº†hosts<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1 example.org www.example.org<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>é€šè¿‡<code>localhost:8080</code>è®¿é—®, åˆ™è®¿é—®åˆ° <code>$NGINX_HOME/html/</code> ç›®å½•</li>
<li>é€šè¿‡<code>example.org:8080</code>æˆ–è€…<code>www.example.org:8080</code>è®¿é—®, åˆ™è®¿é—®åˆ° <code>$NGINX_HOME/html2/</code> ç›®å½•</li>
<li>ç¦æ­¢é€šè¿‡<code>127.0.0.1:8080</code>è®¿é—®, è¿”å›502é”™è¯¯.<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>
    listen  <span class="token number">8080</span><span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">502</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
server <span class="token punctuation">&#123;</span>
    listen       <span class="token number">8080</span><span class="token punctuation">;</span>
    server_name  example.org www.example.org<span class="token punctuation">;</span>
    location / <span class="token punctuation">&#123;</span>
        root html2<span class="token punctuation">;</span>
        index index.html index.htm<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">&#123;</span>
        root   html2<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
server <span class="token punctuation">&#123;</span>
    listen       <span class="token number">8080</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>
    location / <span class="token punctuation">&#123;</span>
        root   html<span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">&#123;</span>
        root   html<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092152127.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092152948.png"></li>
</ul>
<h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>NGINX_HOME:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/local/Cellar/nginx/1.21.3
location / <span class="token punctuation">&#123;</span>
root   html<span class="token punctuation">;</span>
index  index.html index.htm<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šè¾¹çš„htmlå°±æ˜¯ NGINX_HOME&#x2F;html&#x2F;</p>
<h2 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew services start nginx
brew services restart nginx
brew services stop nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚-è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå-å¦‚æœæ˜¯åŸŸåçš„è¯-å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†"><a href="#Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚-è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå-å¦‚æœæ˜¯åŸŸåçš„è¯-å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†" class="headerlink" title="Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚, è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå? å¦‚æœæ˜¯åŸŸåçš„è¯, å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†?"></a>Nginxæ˜¯å¦‚ä½•çŸ¥é“æœ¬æ¬¡è¯·æ±‚, è¯·æ±‚çš„æ˜¯IPè¿˜æ˜¯åŸŸå? å¦‚æœæ˜¯åŸŸåçš„è¯, å¤šä¸ªåŸŸåå¦‚ä½•åŒºåˆ†?</h3><ul>
<li>å¦‚ä¸‹å›¾, æœ¬è´¨ä¸Šè¿˜æ˜¯Nginxè§£æHTTPåè®®, æ ¹æ®è¯·æ±‚è¡Œé‡Œçš„<code>RequestURL</code>æ¥è¿›è¡Œåˆ¤æ–­.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092154665.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208092154173.png"></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>mac</tag>
        <tag>linux</tag>
        <tag>network</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>çæŠ˜è…¾æ´‹åƒåœ¾ç”µè„‘ç¬”è®°</title>
    <url>//2022-08-13-computer-diy/</url>
    <content><![CDATA[<p>åƒåœ¾ä½¬çš„å‘¨æœ«, æ²¡äº‹å„¿å°±æ˜¯çæŠ˜è…¾, è‡ªä»åœ¨Bç«™è¢«ç§è‰äº†æ´‹åƒåœ¾, æŒ‰è€ä¸ä½å¿ƒä¸­çš„å†²åŠ¨, å†³å®šä¹Ÿç”¨æ´‹åƒåœ¾ç»„è£…ä¸€å°èƒ½æ•°æ¡†æ¡†çš„ç”µè„‘, ç©ç©å„¿æ¸¸æˆ, å‹æ¦¨å‹æ¦¨æ€§èƒ½.</p>
<h1 id="ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾"><a href="#ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾" class="headerlink" title="ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾"></a>ä¸ºå•¥è¦ä½¿ç”¨æ´‹åƒåœ¾</h1><ul>
<li>ä¸€: ç©·, </li>
<li>äºŒ: ç©,</li>
</ul>
<h1 id="é…ç½®æ¸…å•"><a href="#é…ç½®æ¸…å•" class="headerlink" title="é…ç½®æ¸…å•"></a>é…ç½®æ¸…å•</h1><blockquote>
<p>å‡ ä¹éƒ½æ˜¯ä»æµ·é²œå¸‚åœºæ·˜æ¥çš„</p>
<ul>
<li>ä¼˜ç‚¹æ˜¯ä¾¿å®œ, æ€§ä»·æ¯”é«˜; </li>
<li>ç¼ºç‚¹æ˜¯ç”µæ°”ç‰¹æ€§è¡°å‡ä¸æ˜ç¡®, é•¿æœŸç¨³å®šæ€§æ²¡æœ‰ä¿éšœ.</li>
</ul>
</blockquote>
<p>ä½†å¯¹äºå¶å°”ç©ä¸€ç©æ¸¸æˆ, ä¸æ˜¯é•¿æœŸé«˜è´Ÿè·è·‘æ¸²æŸ“ç­‰, æ•´ä½“è¿˜OK. ç›®æ ‡æ˜¯<strong>1000å…ƒ</strong>å·¦å³æå®š.</p>
<h2 id="è¯¦ç»†æ¸…å•"><a href="#è¯¦ç»†æ¸…å•" class="headerlink" title="è¯¦ç»†æ¸…å•"></a>è¯¦ç»†æ¸…å•</h2><table>
<thead>
<tr>
<th>é…ä»¶åç§°</th>
<th>å“ç‰Œ</th>
<th>æ•°é‡</th>
<th>ä»·æ ¼</th>
<th>è¯¦ç»†è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>CPU</td>
<td><a href="https://ark.intel.com/content/www/us/en/ark/products/83357/intel-xeon-processor-e52630l-v3-20m-cache-1-80-ghz.html">IntelÂ® XeonÂ® Processor E5-2630L v3</a></td>
<td>1</td>
<td>80</td>
<td>Haswell; 8Core 16HT; 22 nmåˆ¶ç¨‹; Base 1.8GHz, Burst 2.90 GHz; 20MB L3 Cache; 55W TDP</td>
</tr>
<tr>
<td>ä¸»æ¿</td>
<td><a href="https://item.taobao.com/item.htm?id=676047268901">X99å¯¨æ¿</a></td>
<td>1</td>
<td>250</td>
<td></td>
</tr>
<tr>
<td>å†…å­˜</td>
<td>å¨åˆšä¸‡ç´«åƒçº¢</td>
<td>4</td>
<td>160 + 200</td>
<td>8GB; DDR4 2133MHz; å¼ºè¿«ç—‡4æ¡å¿…é¡»æ’æ»¡, ç»„æˆ4é€šé“^_^</td>
</tr>
<tr>
<td>é—ªå­˜</td>
<td><a href="https://www.intel.com/content/www/us/en/products/sku/134583/intel-ssd-760p-series-256gb-m-2-80mm-pcie-3-1-x4-3d2-tlc/specifications.html">IntelÂ® SSD 760P</a></td>
<td>1</td>
<td>160</td>
<td>256GB; PCIe 3.1 x4 æ¥å£, NVMe</td>
</tr>
<tr>
<td>æ˜¾å¡</td>
<td>è“å®çŸ³RX460</td>
<td>1</td>
<td>350</td>
<td>4GBæ˜¾å­˜; æ— éœ€å•ç‹¬ä¾›ç”µ; HDMI + VGA + DP æ¥å£</td>
</tr>
<tr>
<td>ç”µæº</td>
<td>é‘«è°·å…¨æ¨¡ç»„</td>
<td>1</td>
<td>120</td>
<td>550W, æ•´ä½“ç»°ç»°æœ‰ä½™äº†</td>
</tr>
<tr>
<td>CPUæ•£çƒ­å™¨</td>
<td>é•¿åŸéœ„é¾™400</td>
<td>1</td>
<td>45</td>
<td>4é“œç®¡, 3é’ˆè„š</td>
</tr>
<tr>
<td>æœºç®±</td>
<td>å¾…æŒ‘é€‰</td>
<td>1</td>
<td>??</td>
<td>??</td>
</tr>
</tbody></table>
<p>åˆè®¡ <code>80 + 250 + 160 + 200 + 160 + 350 + 120 + 45 = 1,365</code><br>ç°åœ¨æ˜¾å¡ç”µæºéƒ½è¿˜æ²¡åˆ°, å¸Œæœ›ç»„è£…ä¸Šå»ä¹‹åä¸€æ¬¡ç‚¹äº®, å°±å¯ä»¥è¯´å£°â€çœŸé¦™!â€å•¦.</p>
<h2 id="ä¸»æ¿ç»†èŠ‚"><a href="#ä¸»æ¿ç»†èŠ‚" class="headerlink" title="ä¸»æ¿ç»†èŠ‚"></a>ä¸»æ¿ç»†èŠ‚</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208132325729.png"></p>
<div class="note info"><p>x99å«ä¹‰<br>æ‰€è°“çš„x99ä¸»æ¿, ä»£è¡¨çš„å…¶å®æ˜¯<code>Intel X99 chipset</code>, æ˜¯Intelçš„PCH(Platform Controller Hub)å³å—æ¡¥èŠ¯ç‰‡, å®šä¹‰äº†ä¸»æ¿çš„è§„èŒƒ, å¦‚ä¸‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208140001662.png"></p>
</div>

<p>å…¶ä»–ç»†èŠ‚: </p>
<ul>
<li>CPUæ’æ§½: å•è·¯; LGA2011 <ul>
<li>LGAä»£è¡¨LGA(Land Grid Array)å°è£…ç±»å‹, å³CPUä¸Šåªæœ‰è§¦ç‚¹, æ²¡æœ‰é’ˆ; ä¸ä¹‹å¯¹åº”çš„æ˜¯PGA(Pin Grid Array)å°è£…ç±»å‹, å³CPUä¸Šæœ‰é’ˆ(å°è±¡ä¸­è€å¼çš„CPUéƒ½æ˜¯è¿™ç§ç±»å‹), æ›´å®¹æ˜“æŠ˜æ–­; ä¸¤è€…ä¼˜ç¼ºç‚¹å‚è§:<a href="https://techedged.com/lga-vs-pga/">LGA vs PGA CPU Sockets: Whatâ€™s the Difference?</a>, éå¸¸è¯¦ç»†äº†. TODO: å•¥æ—¶å€™ç¿»è¯‘å‡ºæ¥.</li>
<li>2011ä»£è¡¨æ˜¯2011ä¸ªé’ˆè„š; <a href="https://zhuanlan.zhihu.com/p/48593932">CPUåº•éƒ¨çš„å°å—æ˜¯å¹²ä»€ä¹ˆç”¨ï¼Ÿä¸ºä»€ä¹ˆCPUè¿™ä¹ˆå¤šç”µæºå¼•è„šï¼Ÿ</a></li>
</ul>
</li>
<li>CPUåªæ”¯æŒDDR4å†…å­˜, ä½†ä¸»æ¿æ”¯æŒDDR3(é—®äº†åº—å®¶, ä¸»æ¿åŒæ—¶ä¹Ÿæ”¯æŒDDR4), ç°åœ¨DDR4æ™®éä»·æ ¼æ¯”è¾ƒè´µ, æ²¡åŠæ³•ä½¿ç”¨é—²é±¼ä¸Šä»·æ ¼å·¨ä¾¿å®œçš„DDR3 ECCå†…å­˜.</li>
</ul>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="CPUå‹å·"><a href="#CPUå‹å·" class="headerlink" title="CPUå‹å·"></a>CPUå‹å·</h3><p>ä¹°çš„æ—¶å€™æ²¡æœ‰çœ‹æ¸…æ¥šCPUå‹å·, ä»¥ä¸ºæ˜¯ <code>E5-2630 V3</code>, ç»“æœå®é™…æ˜¯ <code>E5-2630L V3</code>, æ‰çŸ¥é“å¤šäº†çš„è¿™ä¸ª<code>L</code>ä»£è¡¨<mark>ä½åŠŸè€—(Low Power)</mark>, åŸºé¢‘åªæœ‰<code>1.8GHz</code>ä¸èƒ½å¿.<br>å› æ­¤å°±åˆæ·˜äº†å¦‚ä¸‹ä¸¤ä¸ªèƒ½å¤Ÿé€‚é…X99ä¸»æ¿çš„CPU, å‡†å¤‡åˆ°æ—¶å€™å„è‡ªå¯¹æ¯”æµ‹è¯•ä¸‹:</p>
<table>
<thead>
<tr>
<th>é…ä»¶åç§°</th>
<th>å“ç‰Œ</th>
<th>æ•°é‡</th>
<th>ä»·æ ¼</th>
<th>è¯¦ç»†è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>CPU</td>
<td><a href="https://ark.intel.com/content/www/us/en/ark/products/83357/intel-xeon-processor-e52630l-v3-20m-cache-1-80-ghz.html">IntelÂ® XeonÂ® Processor E5-2630L v3</a></td>
<td>1</td>
<td>80</td>
<td>8Core 16HT; 22 nmåˆ¶ç¨‹; Base 1.8GHz, Burst 2.90 GHz; 20MB L3 Cache; 55W TDP</td>
</tr>
<tr>
<td>CPU</td>
<td><a href="https://ark.intel.com/content/www/us/en/ark/products/81706/intel-xeon-processor-e52660-v3-25m-cache-2-60-ghz.html">IntelÂ® XeonÂ® Processor E5-2660 v3</a></td>
<td>1</td>
<td>100</td>
<td>10Core 20HT; 22 nmåˆ¶ç¨‹; Base 2.60 GHz, Burst 3.3 GHz; 25MB L3 Cache; 105W TDP</td>
</tr>
<tr>
<td>CPU</td>
<td><a href="https://ark.intel.com/content/www/us/en/ark/products/83352/intel-xeon-processor-e52620-v3-15m-cache-2-40-ghz.html">IntelÂ® XeonÂ® Processor E5-2620 v3</a></td>
<td>1</td>
<td>20</td>
<td>6Core 12HT; 22 nmåˆ¶ç¨‹; Base 2.40 GHz, Burst 3.20 GHz; 15MB L3 Cache; 85W TDP; ä½ ä¸èƒ½å¯¹ä¸€ä¸ª20å—é’±çš„CPUè¦æ±‚æ›´å¤šäº†! :)</td>
</tr>
</tbody></table>
<div class="note info"><blockquote>
<p>CPUç›–å­ä¸Šçš„<code>Costa Rica</code>, <code>Malay</code> ä»£è¡¨å•¥æ„æ€?<br>Just to clear something up, the markings on the back of the CPU refer to the packaging site - not the manufacturing site of the actual silicon chip itself.<br>ä¹Ÿå°±æ˜¯è¯´<mark>ä»£è¡¨çš„æ˜¯å°è£…å·¥å‚çš„åœ°ç‚¹</mark>, <code>Malay</code> ä»£è¡¨ <code>Malaysia</code></p>
</blockquote>
</div>

<h3 id="ECCå†…å­˜"><a href="#ECCå†…å­˜" class="headerlink" title="ECCå†…å­˜"></a>ECCå†…å­˜</h3><div class="note warning"><p>å†…å­˜ä¹°æˆECCå´ä¸èƒ½ç”¨ ECCå†…å­˜åˆ°åº•æ˜¯ä»€ä¹ˆé¬¼?</p>
</div>

<ul>
<li>è¿™æ˜¯å› ä¸ºä¸€èˆ¬çš„ç”µè„‘ä¸ºäº†é€Ÿåº¦ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸æ”¯æŒECCå†…å­˜ï¼Œè€ŒECCå†…å­˜ç”±äºæœ‰æ ¡éªŒè¿™ä¸€æ­¥éª¤ï¼Œä¸€èˆ¬éƒ½å¤šç”¨åœ¨æœåŠ¡å™¨é¢†åŸŸï¼Œ<mark>æ™®é€šçš„å®¶ç”¨ä¸»æ¿ä¸€èˆ¬éƒ½æ˜¯ä¸æ”¯æŒçš„</mark>ï¼Œè€Œä¸”å¯¹äºæœåŠ¡å™¨ï¼Œè¿˜è¦åŒºåˆ†REG-ECCå’Œçº¯ECCçš„åŒºåˆ«ï¼ŒREGæ˜¯å¸¦å¯„å­˜å™¨çš„ECCå†…å­˜ï¼Œå¯ä»¥æ”¯æŒæ›´å¤§çš„å•æ¡å®¹é‡ï¼Œä½†æ˜¯ç”±äºæœ‰å¯„å­˜å™¨çš„å­˜åœ¨ï¼Œå»¶è¿Ÿä¼šæ›´é«˜ã€‚</li>
</ul>
<h3 id="CPUæ•£çƒ­å™¨"><a href="#CPUæ•£çƒ­å™¨" class="headerlink" title="CPUæ•£çƒ­å™¨"></a>CPUæ•£çƒ­å™¨</h3><div class="note warning"><p>ä¸»æ¿ä¸Š<code>CPU FAN</code>æ˜¯4é’ˆçš„, ä¹°æ¥çš„æ•£çƒ­å™¨é£æ‰‡æ˜¯3é’ˆçš„. åŒºåˆ«æ˜¯å•¥? æ€ä¹ˆæ’?</p>
</div>

<blockquote>
<p>2é’ˆ, 3é’ˆä¸4é’ˆé£æ‰‡åŒºåˆ«?</p>
</blockquote>
<ul>
<li>2é’ˆçš„æ•£çƒ­é£æ‰‡ï¼ˆç»“æ„ç®€å•ï¼Œä½†ä¸èƒ½æµ‹é€Ÿï¼‰: ä¸€ä¸ªç”¨äºä¾›ç”µã€ä¸€ä¸ªç”¨äºæ¥åœ°ï¼Œä¸è¿‡æ²¡æœ‰æµ‹é€ŸåŠŸèƒ½ã€‚ç›®å‰2é’ˆçš„æ•£çƒ­é£æ‰‡å·²ç»åœ¨å¸‚åœºä¸Šå¤§é‡é‡‡ç”¨ï¼Œä½†æ˜¯2é’ˆçš„é£æ‰‡åœ¨å˜é€Ÿç­‰æ–¹é¢ä¸Šå·²ç»ä¸èƒ½æ»¡è¶³è¦æ±‚äº†</li>
<li>3é’ˆçš„æ•£çƒ­é£æ‰‡ï¼ˆVCç”µå‹è°ƒé€Ÿï¼Œçµæ´»æ€§æ¬ ä½³ï¼‰: ç¬¬ä¸‰æ¡çº¿, ä¸»è¦æ˜¯èµ·ç€æµ‹é€Ÿçš„ä½œç”¨ï¼Œé€šè¿‡ä¸»æ¿èƒ½å¤Ÿä¾¦æµ‹åˆ°é£æ‰‡æ˜¯å¦åœ¨è½¬ã€è½¬é€Ÿä¸ºå¤šå°‘ï¼Œä½†æ˜¯3é’ˆæ•£çƒ­é£æ‰‡çš„è°ƒé€Ÿæ˜¯é€šè¿‡è°ƒæ•´é£æ‰‡ç”µå‹æ¥å®ç°çš„ï¼Œæ­¤å¤–ï¼Œèƒ½ä¸èƒ½è°ƒé€Ÿè¿˜éœ€è¦çœ‹ä¸‹ä¸»æ¿æ˜¯å¦æ”¯æŒï¼Œæ˜¾ç„¶è¿™ç§è°ƒèŠ‚è½¬é€Ÿå¹¶ä¸å¤Ÿçµæ´»ï¼Œä¸èƒ½å®æ—¶åæ˜ CPUçŠ¶æ€çš„ä¿¡æ¯ï¼Œè¿˜éœ€è¦åœ¨ä¸»æ¿BIOSä¸­è¿›è¡Œå„ç§è®¾ç½®ã€‚</li>
<li>4é’ˆçš„æ•£çƒ­é£æ‰‡ï¼ˆæ›´åŠ çµæ´»æ›´åŠ æ™ºèƒ½çš„è°ƒé€Ÿï¼‰: 4é’ˆçš„æ•£çƒ­é£æ‰‡æ˜¯åœ¨3é’ˆåŸºç¡€ä¸Šåˆå¤šäº†ä¸€æ ¹PWMçº¿ï¼ˆ è„‰å®½è°ƒå˜ï¼‰ï¼Œæ‰€è°“çš„PWMçº¿å°±æ˜¯åˆ©ç”¨PWMæœºåˆ¶æ¥è°ƒèŠ‚é£æ‰‡è½¬é€Ÿï¼Œè€Œé£æ‰‡ç”µå‹æ˜¯æ’å®šçš„ï¼Œé¿å…äº†æ§åˆ¶ç”µå‹æ¥å˜é€Ÿçš„ä¸€ç³»åˆ—å¼Šç«¯ã€‚è€ŒPWMé£æ‰‡æ— éœ€ä¾èµ–ä¸»æ¿BIOSï¼Œæ›´åŠ çœå¿ƒæ–¹ä¾¿ã€‚PWMè„‰å†²ä¿¡å·å¯ä»¥è¾“å‡ºä¸åŒçš„å ç©ºæ¯”ï¼ˆDuty Cycleï¼‰ï¼Œ0-100%ä¹‹é—´çš„å ç©ºæ¯”å°±èƒ½è°ƒèŠ‚å‡ºä¸åŒçš„é£æ‰‡è½¬é€Ÿï¼Œæ‰€ä»¥èƒ½å¤Ÿåšåˆ°ç²¾ç¡®ã€çµæ´»æ§åˆ¶ã€‚</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208140950640.png"></p>
<blockquote>
<p>3é’ˆæ€ä¹ˆæ’å…¥ä¸»æ¿4é’ˆæ¥å£ä¸­?</p>
</blockquote>
<ul>
<li>å…¼å®¹, æœ‰é˜²å‘†æœºåˆ¶.</li>
</ul>
<p>æ€»ä½“æ¥è¯´, é£æ‰‡è¸©å‘äº†, ä½†ä¹Ÿå¤Ÿç”¨äº†:</p>
<ol>
<li>åº”è¯¥è´­ä¹°6é“œç®¡</li>
<li>åº”è¯¥è´­ä¹°4é’ˆçš„</li>
</ol>
<h2 id="æˆæœå±•ç¤º"><a href="#æˆæœå±•ç¤º" class="headerlink" title="æˆæœå±•ç¤º"></a>æˆæœå±•ç¤º</h2><h3 id="æˆå“å›¾"><a href="#æˆå“å›¾" class="headerlink" title="æˆå“å›¾"></a>æˆå“å›¾</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172253812.png"></p>
<h3 id="æ•°æ¡†æ¡†"><a href="#æ•°æ¡†æ¡†" class="headerlink" title="æ•°æ¡†æ¡†"></a>æ•°æ¡†æ¡†</h3><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172318658.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172253927.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172254393.png"></p>
<h2 id="å‡çº§æ½œåŠ›-amp-è®¡åˆ’"><a href="#å‡çº§æ½œåŠ›-amp-è®¡åˆ’" class="headerlink" title="å‡çº§æ½œåŠ›&amp;è®¡åˆ’"></a>å‡çº§æ½œåŠ›&amp;è®¡åˆ’</h2><p>æ•´ä½“CPUè¿˜æ˜¯æ¯”è¾ƒå¼ºæ‚çš„, æœ‰å¾ˆå¤§å‡çº§æ½œåŠ›</p>
<h3 id="ä¸»æ¿å‡çº§"><a href="#ä¸»æ¿å‡çº§" class="headerlink" title="ä¸»æ¿å‡çº§"></a>ä¸»æ¿å‡çº§</h3><ul>
<li>å‡çº§æˆä¸¤è·¯, çœ‹æœ‰æ²¡å¿…è¦å§, è¿™æ ·ç”µè´¹åƒä¸æ¶ˆ, ç”µæºå¯èƒ½ä¹Ÿè¦å‡çº§; <a href="https://post.smzdm.com/p/aoo8wewm/pic_3/#bigImg">X99åŒè·¯ä¸»æ¿ç®€è¯„</a> æŒ‡æ˜äº†æ–¹å‘</li>
</ul>
<h3 id="CPUå‡çº§"><a href="#CPUå‡çº§" class="headerlink" title="CPUå‡çº§"></a>CPUå‡çº§</h3><ul>
<li>X99æ•´ä½“è¿˜æ”¯æŒV4(Broadwell)çš„CPU, ä¾‹å¦‚ <code>E5-2660 V4</code>, 16å¹´ä¸Šå¸‚, 14nmåˆ¶ç¨‹. å…¨éƒ¨åˆ—è¡¨å‚è§: </li>
<li>2699 v3: 650RMBå·¦å³</li>
<li><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208141020764.png"></li>
</ul>
<h3 id="å†…å­˜å‡çº§"><a href="#å†…å­˜å‡çº§" class="headerlink" title="å†…å­˜å‡çº§"></a>å†…å­˜å‡çº§</h3><ul>
<li>ECCå†…å­˜: è¿™å‡ ä¸ªCPUéƒ½æ”¯æŒECCå†…å­˜, ç­‰ä¸‹æ‰¹æœåŠ¡å™¨æ·˜æ±°, æˆ–è€…DDR5ä¸»æµ, å°±å¯ä»¥ä½ä»·æ·˜å‡ ä¸ªDDR4 ECCå†…å­˜;</li>
<li>å®¹é‡å‡çº§: CPUæ”¯æŒ <code>192GB * 4 = 768GB</code> ä¸»æ¿æ”¯æŒ<code>32GB*4=128GB</code>; å½“å‰æ˜¯<code>8GB*4=32GB</code>, æœ‰å¾ˆå¤§å‡çº§æ½œåŠ›, ç­‰å†…å­˜ä»·æ ¼ä¸‹é™å§~</li>
<li>é¢‘ç‡å‡çº§: CPUé™åˆ¶æœ€å¤§æ”¯æŒ2133MHz, å¯¼è‡´æœ€æ–°çš„3200MHzéƒ½æ²¡æ³•ç”¨(èƒ½ç”¨, ä½†ä¼šè‡ªåŠ¨é™é¢‘åˆ°2133MHz).</li>
</ul>
<h1 id="å­¦åˆ°äº†å•¥"><a href="#å­¦åˆ°äº†å•¥" class="headerlink" title="å­¦åˆ°äº†å•¥"></a>å­¦åˆ°äº†å•¥</h1><h2 id="å¸¸ç”¨ä¸»æ¿å‹å·"><a href="#å¸¸ç”¨ä¸»æ¿å‹å·" class="headerlink" title="å¸¸ç”¨ä¸»æ¿å‹å·"></a>å¸¸ç”¨ä¸»æ¿å‹å·</h2><ul>
<li>X79<ul>
<li>Sandy Bridge-E, Ivy Bridge-E</li>
<li>Quad-channel DDR3, up to two DIMMs per channel</li>
</ul>
</li>
<li>X99<ul>
<li>Haswell-E, Broadwell-E</li>
<li>Quad-channel DDR4, up to two DIMMs per channel</li>
</ul>
</li>
</ul>
<h2 id="å®¶ç”¨æœºç®±å‹å·"><a href="#å®¶ç”¨æœºç®±å‹å·" class="headerlink" title="å®¶ç”¨æœºç®±å‹å·"></a>å®¶ç”¨æœºç®±å‹å·</h2><ul>
<li>E-ATX</li>
<li>ATX</li>
<li>M-ATX</li>
<li>ITX</li>
</ul>
<h2 id="å¥‡æŠ€æ·«å·§"><a href="#å¥‡æŠ€æ·«å·§" class="headerlink" title="å¥‡æŠ€æ·«å·§"></a>å¥‡æŠ€æ·«å·§</h2><blockquote>
<p>Q: é‹ç›’æœºç®±, å¦‚ä½•æ— å¼€å…³å¼€æœº?<br>A: ç›´æ¥èºä¸åˆ€æˆ³ä¸»æ¿, è¿æ¥é’ˆè„š.<br><img data-src="http://p8.itc.cn/images01/20200823/5eb93a0ca39443f68d7d3392fc3615ea.jpeg"></p>
</blockquote>
<h2 id="å…¶ä»–ä½“æ‚Ÿ"><a href="#å…¶ä»–ä½“æ‚Ÿ" class="headerlink" title="å…¶ä»–ä½“æ‚Ÿ"></a>å…¶ä»–ä½“æ‚Ÿ</h2><ul>
<li>çŸ¥é“äº†ç»å¸¸è¯´çš„V3, V4åˆ©æ—§æ˜¯å•¥äº†; å¯¹è¿™ç§æ´‹åƒåœ¾CPUå¸‚åœºè¡Œæƒ…æœ‰äº†å¤§æ¦‚çš„è®¤çŸ¥.</li>
<li>è®¡ç®—æœºå¹¶éåªæœ‰CPU, è¿˜æœ‰å†…å­˜, ä¸»æ¿, æ˜¾å¡ç”šè‡³ç”µæº, æ•£çƒ­å™¨ç­‰; ä¹Ÿéƒ½æ˜¯æä¸ºå…³é”®çš„. å°¤å…¶æ˜¯è¿™ç§æ´‹åƒåœ¾, CPUè·Ÿä¸è¦é’±ä¸€æ ·, å…¶ä»–ç»„ä»¶çš„å¯æ‰©å±•æ€§ä¸ç¨³å®šæ€§å°±è‡³å…³é‡è¦äº†. å¾ˆå¤šç‰¹æ€§ä¸æ­¢è¦çœ‹CPUæ˜¯å¦æ”¯æŒ, ä¹Ÿè¦çœ‹ä¸»æ¿. ä¾‹å¦‚å†…å­˜çš„DDRä»£æ•°, æœ€å¤§å®¹é‡, é€šé“æ•°, æœ€å¤§é¢‘ç‡, æ˜¯å¦æ”¯æŒECC; ä¾‹å¦‚CPUæ’æ§½çš„é’ˆè„šæ•°;</li>
<li>æ‘©å°”å®šå¾‹çš„ææ€–: ä¸Šè¾¹å‡ ä¸ªCPUåŸºæœ¬éƒ½æ˜¯14å¹´Q3ä¸Šå¸‚, åˆ°ä»Šå¤©2022å¹´Q2, ä»…ä»…8å¹´å·¦å³:  <ul>
<li>ä»·æ ¼: å°±å·²ç»è·Œå€’äº†ç™½èœä»·, ä»¥<code>E5-2660 v3</code>ä¸ºä¾‹, ä¸Šå¸‚ä»·æ ¼æ˜¯<code>$1445.00</code>, ç°åœ¨æ˜¯<code>100RMB=$15</code>. </li>
<li>æ€§èƒ½: å½“å‰ä¸»æµçš„12ä»£Intel, ä»¥å®¶ç”¨çš„ <a href="https://ark.intel.com/content/www/cn/zh/ark/products/134594/intel-core-i712700k-processor-25m-cache-up-to-5-00-ghz.html">i7-12700K</a> ä¸ºä¾‹, åˆ¶ç¨‹å·²ç»åˆ°äº†7nm; æ›´ä¸ç”¨æARMæ¶æ„ä¸‹çš„ä¸»æµåˆ¶ç¨‹éƒ½æ˜¯5nmäº†.</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ—§æ—¶ç‹è°¢å ‚å‰ç‡•, é£å…¥å¯»å¸¸ç™¾å§“å®¶</p>
</blockquote>
<h2 id="è€å¸æœºè¸©å‘è®°"><a href="#è€å¸æœºè¸©å‘è®°" class="headerlink" title="è€å¸æœºè¸©å‘è®°"></a>è€å¸æœºè¸©å‘è®°</h2><blockquote>
<p>è‡ªè¯©ä¸ºåƒåœ¾ä½¬, ç»“æœè¿™æ¬¡ç»„è£…ç”µè„‘, ç»“ç»“å®å®æŠŠè‡ªå·±ç»™æ•™è‚²äº†ä¸€ç•ª.</p>
</blockquote>
<h3 id="Uç›˜å¥—è·¯"><a href="#Uç›˜å¥—è·¯" class="headerlink" title="Uç›˜å¥—è·¯"></a>Uç›˜å¥—è·¯</h3><p>åœ¨æŸå®ä¹°äº†2ä¸ª32GBçš„Uç›˜, æƒ³è¦åˆ†åˆ«ä½œä¸ºwin10ä¸centosçš„è£…æœºPE.<br>ç»“æœåœ¨æ‹·è´é•œåƒåˆ°Uç›˜çš„æ—¶å€™, å‘ç°ä¼ è¾“é€Ÿåº¦å¥‡æ…¢æ— æ¯”, åªæœ‰6MB&#x2F;s.<br>æ™®é€šçš„win10é•œåƒå¤§å°æ˜¯4GBå·¦å³, ä¹Ÿå°±æ˜¯å…¨éƒ¨æ‹·è´åˆ°Uç›˜é‡Œéœ€è¦: <code>4 * 1024 / 6 / 60 = 11.3</code>, è¦10min+;<br>ä¸è§£, é‚é—®å®¢æœ, è§£é‡Šé“æ˜¯USB2.0çš„. ä»”ç»†çœ‹äº†ä¸‹è¯¦æƒ…é¡µ, ç¡•å¤§çš„â€USB 2.0â€ä»¿ä½›åœ¨å˜²è®½æˆ‘@-@<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172225310.png"></p>
<p>What??? éƒ½2202å¹´äº†, ç«Ÿç„¶è¿˜æœ‰USB 2.0?? æˆ‘ä»¿ä½›å¬åˆ°äº†ä¸€ä¸ªå›½é™…ç¬‘è¯.<br>ä¸ªäººä¸‹æ„è¯†é‡ŒUSB2.0éƒ½å·²ç»è·Ÿé¼ æ ‡&#x2F;é”®ç›˜çš„PS&#x2F;2æ¥å£ä¸€æ ·, å·²ç»é”€å£°åŒ¿è¿¹äº†, by defaultä¸éƒ½åº”è¯¥æ˜¯3.0çš„ä¹ˆ?</p>
<p>æ­¤ä¸ºå‘ä¸€.</p>
<h3 id="é•œåƒæ–‡ä»¶å¥—è·¯"><a href="#é•œåƒæ–‡ä»¶å¥—è·¯" class="headerlink" title="é•œåƒæ–‡ä»¶å¥—è·¯"></a>é•œåƒæ–‡ä»¶å¥—è·¯</h3><p>ä¸ºå›¾çœäº‹å„¿, åœ¨æŸCSXNç½‘ç«™èŠ±äº†Nå¤šç§¯åˆ†, ä¸‹è½½äº†ä¸ªâ€çº¯å‡€ç‰ˆâ€é•œåƒ.<br>ç»“æœä¸€å®‰è£…, é‡Œè¾¹å¯†å¯†éº»éº»å„ç§è½¯ä»¶, ä»€ä¹ˆ360å…¨å®¶æ¡¶, TXå…¨å®¶æ¡¶, 2345å…¨å®¶æ¡¶.<br>æµè§ˆå™¨ä¸»é¡µè¢«ä¿®æ”¹å¾—ä¸åƒæ ·å­.<br><mark>åŸæ¥ä¼ªè£…æˆçº¯å‡€ç‰ˆå•Š</mark></p>
<p>å»æœè‡ªå·±ä»ç„¶åœç•™åœ¨åå¹´å‰çš„ç»å…¸çš„ é›¨æ—Xé£, æ·±åº¦, ç³»ç»Ÿä¹‹å®¶ç­‰, ç»“æœä¸€ä¸ªä¸€ä¸ªéƒ½ä¸åƒæ ·å­. ä¸€ç‚¹éƒ½ä¸<code>çº¯å‡€</code>!<br>æœ€ååªèƒ½è€è€å®å®å»ä¸‹è½½å®˜æ–¹é•œåƒ, åˆä¸æ˜¯ä¸èƒ½ç”¨@-@</p>
<h3 id="2345å¥—è·¯"><a href="#2345å¥—è·¯" class="headerlink" title="2345å¥—è·¯"></a>2345å¥—è·¯</h3><p>æ³¨å†Œè¡¨é‡Œæœç´¢â€çœ‹å›¾ç‹â€, ä¸æŸ¥ä¸çŸ¥é“, ä¸€æŸ¥å“ä¸€è·³. å¯†å¯†éº»éº»çš„, çœ‹å¾—æˆ‘ç¥ç»è¡°å¼±.<br>å¿ƒæƒ³ä¸€ä¸ªä¸€ä¸ªåˆ é™¤ä¹Ÿä¸æ˜¯ä¸ªäº‹å„¿å•Š.<br>ç´¢æ€§å¤§ç¬”ä¸€æŒ¥, ç›´æ¥æŠŠçˆ¶èŠ‚ç‚¹åˆ é™¤. ç»“æœç›´æ¥ç»å…¸çš„windowsè“å±.<br>æ²¡åŠæ³•, åªå¥½æ‹¾èµ·ä¼ ç»Ÿè‰ºèƒ½, è¿›å…¥PE, é‡è£…ç³»ç»Ÿ!</p>
<ul>
<li>ä¸æœä¸çŸ¥é“, ä¸€æœå“ä¸€è·³. <a href="https://www.zhihu.com/question/35188509/answer/1266544765">åŠ£è¿¹æ–‘æ–‘</a>. åŸæ¥è€æ¿å·²ç»è·‘è·¯, æèµ·äº†ç½‘è´·, åŒºå—é“¾.</li>
<li>å¥½å®¶ä¼™, æˆ‘ç›´å‘¼å¥½å®¶ä¼™. åŸæ¥è¿˜æƒ³åšç™¾å¹´ä¼ä¸š, å¤©å¤©åœ¨å®˜ç½‘ç»™è‡ªå·±å€’è®¡æ—¶å‘¢.</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202208172241888.png"></p>
<blockquote>
<p>åŒæ ·æ˜¯å°ç« é±¼, å·®åˆ«å’‹å°±é‚£ä¹ˆå¤§å‘¢? ç§ç§äººå®¶ <a href="https://github.com/">GitHub</a> å¤šæœ‰èŠ‚æ“.</p>
</blockquote>
<h3 id="win10æ— èŠ‚æ“å¥—è·¯"><a href="#win10æ— èŠ‚æ“å¥—è·¯" class="headerlink" title="win10æ— èŠ‚æ“å¥—è·¯"></a>win10æ— èŠ‚æ“å¥—è·¯</h3><p>å®‰è£…å¥½ç³»ç»Ÿ, å‡†å¤‡å®‰è£…æ˜¾å¡é©±åŠ¨, ç»“æœæŠ¥è­¦, Cç›˜å­˜å‚¨ç©ºé—´ä¸è¶³.<br>What??? æˆ‘Cç›˜å¯æ˜¯40GBçš„å®¹é‡, å°±è£…äº†ä¸ªç³»ç»Ÿ, å•¥è½¯ä»¶éƒ½æ²¡å®‰è£…å‘¢, å’‹å°±æ²¡äº†?<br>æ¯ä¸ªæ–‡ä»¶å¤¹å¤§å°åŠ èµ·æ¥, æ€»å…±ä¹Ÿæ‰10å¤šGB, å‰©ä¸‹çš„20GBå“ªé‡Œå»äº†? æŸ¥è¯¢æ‰çŸ¥é“, åŸæ¥æ˜¯è¢«å¾®è½¯å¥—è·¯äº†.</p>
<ul>
<li><a href="https://www.itechtics.com/reserved-storage-windows-10/">17GBçš„é¢„ç•™ç©ºé—´</a></li>
<li>5GBçš„ä¼‘çœ æ–‡ä»¶</li>
</ul>
<blockquote>
<p>FxxK MicroSoft!</p>
</blockquote>
<h3 id="å¤šä¹ˆç—›çš„é¢†æ‚Ÿ"><a href="#å¤šä¹ˆç—›çš„é¢†æ‚Ÿ" class="headerlink" title="å¤šä¹ˆç—›çš„é¢†æ‚Ÿ"></a>å¤šä¹ˆç—›çš„é¢†æ‚Ÿ</h3><p>æƒ³æƒ³ä¹‹å‰, è‡ªå·±è¢«mac&#x2F;linuxä¿æŠ¤å¾—å¤ªå¥½äº†. è¿˜ä¸€ç›´åœ¨çº³é—·ä¸ºå•¥è¦ç»™ç¡¬ç›˜åˆ†åŒº, Cç›˜, Dç›˜å•¥çš„å¤šéº»çƒ¦.<br>è¿™æ¬¡æˆ‘çŸ¥é“äº†, æˆ‘ä¹–ä¹–åœ°åˆ†æˆäº†å‡ ä¸ªåŒº, å®‰è£…å¥½äº†GHOSTå·¥å…·, ä¹–ä¹–ç»™Cç›˜æ‰“äº†ä¸ªGHOSTé•œåƒ.<br>éšæ—¶å‡†å¤‡è¢«è¿™äº›æµæ°“è½¯ä»¶â€XXâ€, éšæ—¶å‡†å¤‡é‡è£…&#x2F;æ¢å¤ç³»ç»Ÿ.</p>
<blockquote>
<p>æ²¡åŠæ³•, Windowsçš„ç”Ÿå­˜ç¯å¢ƒå®åœ¨æ˜¯å¤ªæ¶åŠ£äº†!!</p>
</blockquote>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://www.expreview.com/62077.html">æ•£çƒ­é£æ‰‡çš„2é’ˆã€3é’ˆã€4é’ˆéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>çæŠ˜è…¾</category>
      </categories>
      <tags>
        <tag>diy</tag>
      </tags>
  </entry>
  <entry>
    <title>åä¸‡ä¸ªä¸ºä»€ä¹ˆä¹‹--ä¸ºä»€ä¹ˆç£ç›˜éœ€è¦åˆ†åŒºä¸æŒ‚è½½?</title>
    <url>//2022-08-30-disk-partition/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ç»å¸¸ä¼šæœ‰ä¸ªç–‘é—®: </p>
<ul>
<li>ä¸ºä»€ä¹ˆç£ç›˜éœ€è¦è¿›è¡Œåˆ†åŒº, ä¸åˆ†åŒºç›´æ¥æŒ‰ç…§æ–‡ä»¶å¤¹åˆ’åˆ†æœ‰å•¥é—®é¢˜? è¿™ä¸ªåœ¨Windowsä¸‹å°¤å…¶æœ‰ç–‘é—®.</li>
<li>ä¸ºå•¥éœ€è¦æŒ‚è½½? ç›´æ¥æ’å…¥è®¾å¤‡, ä¸ºå•¥ä¸èƒ½åƒWindowsä¸‹Uç›˜ä¸€æ ·ç›´æ¥çƒ­æ’æ‹”? Linuxä¸‹ä¸ºå•¥è¿˜éœ€è¦æ‰‹åŠ¨æŒ‚è½½ä¸‹? </li>
<li>åˆ†åŒºä¸æ ¼å¼åŒ–ä»¥åŠæ–‡ä»¶ç³»ç»Ÿæœ‰å•¥å…³ç³»ä¸åŒºåˆ«? æ˜¯ä¸€å¯¹ä¸€çš„ä¹ˆ? ä¸€ä¸ªåˆ†åŒºä¸‹åªèƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¹ˆ? ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸‹åªèƒ½æœ‰ä¸€ä¸ªåˆ†åŒºä¹ˆ?</li>
</ul>
<h1 id="ä¸ºå•¥éœ€è¦åˆ†åŒº"><a href="#ä¸ºå•¥éœ€è¦åˆ†åŒº" class="headerlink" title="ä¸ºå•¥éœ€è¦åˆ†åŒº?"></a>ä¸ºå•¥éœ€è¦åˆ†åŒº?</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹ æƒ¯äº†ä½¿ç”¨Linux&#x2F;Macä¹‹å, å®Œå…¨æ²¡æœ‰åˆ†åŒºçš„æ¦‚å¿µäº†.</p>
<ul>
<li>Linux&#x2F;Ubuntuè£…æœºæ­¥éª¤:<ul>
<li>ä¸€æ•´å—ç£ç›˜, é€‰å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹, è¿›è¡Œæ ¼å¼åŒ–.</li>
<li>ç›´æ¥åœ¨ç£ç›˜ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿ, å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†.</li>
</ul>
</li>
<li>Macç”šè‡³æ— éœ€è£…æœº, å¼€æœºç›´æ¥ä½¿ç”¨.</li>
</ul>
<p>å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­, ä¸åˆ†åŒºæœ‰å¦‚ä¸‹ä¼˜åŠ¿:</p>
<ul>
<li>è½¯ä»¶å®‰è£…: æ— éœ€å…³æ³¨éœ€è¦æŠŠè½¯ä»¶å®‰è£…åœ¨å“ªä¸ªç›˜(Cç›˜&#x2F;Dç›˜&#x2F;Eç›˜â€¦), é€šå¸¸åªéœ€è¦é»˜è®¤è·¯å¾„å°±å¥½;</li>
<li>æ–‡ä»¶ä¸‹è½½å­˜å‚¨: æ— éœ€å…³æ³¨æ–‡ä»¶è¦ä¿å­˜åœ¨å“ªä¸ªç›˜, åªéœ€è¦å…³æ³¨ä¿å­˜åœ¨å“ªä¸ªç›®å½•å³å¯.</li>
</ul>
<blockquote>
<p>å› æ­¤å®Œå…¨ä¸ç”¨æ‹…å¿ƒåˆ°åº•åˆ†å‡ ä¸ªåŒº, æ¯ä¸ªåˆ†åŒºå¤§å°å¤šå°‘, Cç›˜æ»¡äº†å¦‚ä½•æ‰©å®¹ä¹‹ç±»çš„é—®é¢˜.</p>
</blockquote>
<p>å› æ­¤, åœ¨æ”’äº†å°Windowsæœºå™¨ä¹‹å, çŠ¹è±«è¦ä¸è¦åˆ†å¤šä¸ªåŒº. åæ¥äº‹å®æ•™ä¼šäº†æˆ‘æ€ä¹ˆåšäºº.</p>
<blockquote>
<p>Win10å¾ˆæ— èŠ‚æ“åœ°ä¼šåœ¨Cç›˜é¢„ç•™30GB+çš„ç©ºé—´, è¿˜è¦æ”¾è™šæ‹Ÿå†…å­˜æ–‡ä»¶ç­‰, å¯¼è‡´å¯æ€œçš„Cç›˜ç«‹åˆ»å­˜å‚¨æŠ¥è­¦.</p>
</blockquote>
<h2 id="ä¸ªäººå®è·µç†è§£"><a href="#ä¸ªäººå®è·µç†è§£" class="headerlink" title="ä¸ªäººå®è·µç†è§£"></a>ä¸ªäººå®è·µç†è§£</h2><p>ä¸ªäººä½¿ç”¨ä¸‹æ¥, å”¯ä¸€çš„ç†ç”±å°±æ˜¯: <strong>åˆ†åŒºéš”ç¦», æ–¹ä¾¿æ— æŸé‡è£…ç³»ç»Ÿ.</strong></p>
<p>Mac&#x2F;Linuxä¸Š, å‡ ä¹æ— éœ€ä¹Ÿæ²¡æœ‰é‡è£…è¿‡ç³»ç»Ÿ. ä½†<strong>åœ¨Windowsä¸‹, é‡è£…ç³»ç»Ÿç®€ç›´æ˜¯å¸¸æ€</strong>. </p>
<blockquote>
<p>åƒåœ¾(ç—…æ¯’)è½¯ä»¶å¤ªå¤š, è¿æ‰€è°“çš„çº¯å‡€é•œåƒä¹Ÿæ ¹æœ¬ä¸çº¯å‡€.</p>
</blockquote>
<ul>
<li>éƒ½æƒ³å¾€æ³¨å†Œè¡¨é‡Œå·å·å¡ä¸œè¥¿. æ¸…ç†æ³¨å†Œè¡¨, ä¸€ä¸å°å¿ƒå°±ä¼šæŠŠç³»ç»Ÿæ¸…ç†è“å±.</li>
<li>æˆ–è€…æœ‰ç—…æ¯’, ç›´æ¥ç³»ç»Ÿå´©æºƒ.</li>
</ul>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<ul>
<li>è¦ä¹ˆé€šè¿‡PEè¿›å…¥ç³»ç»Ÿ, æ‰¾åˆ°é—®é¢˜ç‚¹, è¿›è¡Œä¿®å¤. </li>
<li>è¦ä¹ˆç›´æ¥é‡è£…ç³»ç»Ÿ. </li>
<li>æ‰¾åˆ°é—®é¢˜ç‚¹å¤ªéº»çƒ¦, æ‰€ä»¥è¿˜æ˜¯æ— è„‘ä¸€é”®é‡è£…å§.</li>
</ul>
<p>ä½†é‡è£…ç³»ç»Ÿ, å°±éœ€è¦æŠŠåˆ†åŒºé‡æ–°æ ¼å¼åŒ–. æƒ³æƒ³å§, è¾›è‹¦å®‰è£…çš„è½¯ä»¶, è®¾å®šçš„é…ç½®, ä¿å­˜çš„æ–‡ä»¶, éƒ½ä¼šéšç€æ ¼å¼åŒ–è¢«å®Œå…¨æŠ¹é™¤!<br>æ‰€ä»¥è¿˜æ˜¯åˆ†åŒºå§, åªæ ¼å¼åŒ–Cç›˜å°±å¥½. è½¯ä»¶å•Š, æ–‡ä»¶å•Š, é…ç½®å•Š, éƒ½æ”¾åˆ°å…¶ä»–ç›˜é‡Œå¥½äº†.</p>
<h2 id="å…¶ä»–ä¸“ä¸šç†ç”±"><a href="#å…¶ä»–ä¸“ä¸šç†ç”±" class="headerlink" title="å…¶ä»–ä¸“ä¸šç†ç”±"></a>å…¶ä»–ä¸“ä¸šç†ç”±</h2><p>å‚ç…§çŸ¥ä¹ <a href="https://www.zhihu.com/question/47538075/answer/107737383">å…¶å®windowsåˆ†åŒºæ˜¯ä¸æ˜¯åˆ†Cç›˜å’ŒDç›˜å°±å¥½äº†ï¼Ÿ</a> å›ç­”.</p>
<ul>
<li>ç—…æ¯’æ³›æ»¥, ä¼šæŠŠç³»ç»ŸæCrash, éœ€è¦é¢‘ç¹é‡è£…ç³»ç»Ÿ.</li>
<li>æ—©æœŸçš„FAT16&#x2F;32æ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„å•ä¸ªåˆ†åŒºå®¹é‡æœ‰é™. FAT32æœ€å¤§æ–‡ä»¶ç³»ç»Ÿæ€»å®¹é‡ 128GB, åœ¨ç°åœ¨éšä¾¿ä¸€ä¸ªç¡¬ç›˜å°±æ˜¯1TB+, æ— æ³•å……åˆ†åˆ©ç”¨ç£ç›˜ç©ºé—´.</li>
<li>xpä¹‹å‰çš„windowsç³»åˆ—æ“ä½œç³»ç»Ÿæœ¬èº«ç¨³å®šæ€§å ªå¿§ï¼Œå¾ˆå®¹æ˜“å› ä¸ºç”¨æˆ·æ“ä½œã€è½¯ä»¶æ•…éšœå´©æºƒç”šè‡³ç ´åã€‚å°¤å…¶æ˜¯ç»å¸¸æŠ˜è…¾çš„æ¡Œé¢ç³»ç»Ÿã€‚è¿™å°±å¯¼è‡´ç”¨æˆ·ä¸å¾—ä¸é¢‘ç¹é‡è£…ç³»ç»Ÿã€‚</li>
<li>æ“ä½œç³»ç»Ÿæƒé™&amp;è½¯ä»¶å…¼å®¹é—®é¢˜: ç°åœ¨win10ç®¡ç†å‘˜æƒé™å°äº†ï¼ŒæŸäº›è½¯ä»¶è£…åœ¨Cç›˜ä¼šæœ‰æƒé™é—®é¢˜ï¼Œæ¯”å¦‚notepad++è£…åœ¨Cç›˜ï¼Œç›´æ¥è¿è¡Œçš„è¯æ˜¯ä¸èƒ½ä¿å­˜è‡ªå®šä¹‰é…ç½®çš„</li>
</ul>
<blockquote>
<p>æ‰€ä»¥åœ¨Windowsä¸‹, è¿˜æ˜¯è€è€å®å®åˆ†åŒºå§! å½“ç„¶åœ¨ä¸¥è‚ƒçš„ä¼ä¸šåœºæ™¯, ä¹Ÿæ¨èæŒ‰ç…§ç³»ç»Ÿç›˜ä¸æ•°æ®ç›˜è¿›è¡Œä¸‹åŒºåˆ†.</p>
</blockquote>
<h1 id="ä¸ºå•¥éœ€è¦æŒ‚è½½"><a href="#ä¸ºå•¥éœ€è¦æŒ‚è½½" class="headerlink" title="ä¸ºå•¥éœ€è¦æŒ‚è½½?"></a>ä¸ºå•¥éœ€è¦æŒ‚è½½?</h1><p>å°¤å…¶æ˜¯åœ¨Linuxä¸‹, è®¾å¤‡å¯ä»¥ä» &#x2F;dev&#x2F;sda[b] è·¯å¾„ä¸‹è·å–, ä¸ºå•¥ä¸èƒ½ç›´æ¥æ“ä½œè¿™äº›è®¾å¤‡? è¿˜éœ€è¦æŒ‚è½½(mount)ä¸‹?</p>
<h2 id="ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨"><a href="#ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨" class="headerlink" title="ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨?"></a>ä¸ºå•¥ç£ç›˜éœ€è¦æŒ‚è½½æ‰èƒ½ä½¿ç”¨?</h2><h3 id="ä¸ºå•¥ä¸èƒ½ç›´æ¥æ“ä½œ-dev-sda-b-ç­‰è£¸è®¾å¤‡"><a href="#ä¸ºå•¥ä¸èƒ½ç›´æ¥æ“ä½œ-dev-sda-b-ç­‰è£¸è®¾å¤‡" class="headerlink" title="ä¸ºå•¥ä¸èƒ½ç›´æ¥æ“ä½œ/dev/sda[b]ç­‰è£¸è®¾å¤‡?"></a>ä¸ºå•¥ä¸èƒ½ç›´æ¥æ“ä½œ<code>/dev/sda[b]</code>ç­‰è£¸è®¾å¤‡?</h3><h3 id="æŒ‚è½½å…·ä½“åšäº†å•¥"><a href="#æŒ‚è½½å…·ä½“åšäº†å•¥" class="headerlink" title="æŒ‚è½½å…·ä½“åšäº†å•¥?"></a>æŒ‚è½½å…·ä½“åšäº†å•¥?</h3><p>æœ¬è´¨ä¸Š, Windowsä¸‹ä¹Ÿæ˜¯æœ‰æŒ‚è½½è¿™ä¸€æ­¥çš„, æœ¬è´¨ä¸ŠæŒ‚è½½å°±æ˜¯æŠŠåˆ†åŒº&#x2F;ç£ç›˜æ ¼å¼åŒ–ä¹‹åçš„æ–‡ä»¶ç³»ç»Ÿ, æŒ‚è½½åˆ°æ“ä½œç³»ç»Ÿæ–‡ä»¶æ ‘ä¸‹, æ˜ å°„åˆ°æŸä¸ªç›®å½•,<br>ä¾¿äºæ“ä½œç³»ç»Ÿ</p>
<h3 id="Windowsä¸‹ä¹Ÿæœ‰æŒ‚è½½ä¹ˆ"><a href="#Windowsä¸‹ä¹Ÿæœ‰æŒ‚è½½ä¹ˆ" class="headerlink" title="Windowsä¸‹ä¹Ÿæœ‰æŒ‚è½½ä¹ˆ?"></a>Windowsä¸‹ä¹Ÿæœ‰æŒ‚è½½ä¹ˆ?</h3><p>æ˜¯çš„. Windowsä¸‹</p>
<h2 id="ä¸ºå•¥ä¸èƒ½åƒWindowsä¸€æ ·-æ’å…¥è®¾å¤‡ç›´æ¥é»˜è®¤æŒ‚è½½"><a href="#ä¸ºå•¥ä¸èƒ½åƒWindowsä¸€æ ·-æ’å…¥è®¾å¤‡ç›´æ¥é»˜è®¤æŒ‚è½½" class="headerlink" title="ä¸ºå•¥ä¸èƒ½åƒWindowsä¸€æ ·, æ’å…¥è®¾å¤‡ç›´æ¥é»˜è®¤æŒ‚è½½?"></a>ä¸ºå•¥ä¸èƒ½åƒWindowsä¸€æ ·, æ’å…¥è®¾å¤‡ç›´æ¥é»˜è®¤æŒ‚è½½?</h2><p>è¿™ä¸ªæœç´¢äº†çŸ¥ä¹, <a href="https://www.zhihu.com/question/524667726/answer/2437578886">å¾—åˆ°çš„ç»“è®º</a>æ˜¯: </p>
<ol>
<li><p>Unix-likeçš„æ“ä½œç³»ç»Ÿä¸æ”¯æŒè‡ªåŠ¨mountåŸå› æ˜¯ä¸ºäº†æƒé™æ§åˆ¶</p>
<blockquote>
<p>POSIXæƒé™çš„æ¦‚å¿µå‡ºç°çš„å¾ˆæ—©ï¼ŒUnixã€Linuxéƒ½æ˜¯æ”¯æŒPOSIXæƒé™çš„ã€‚<br>é‚£ä¹ˆå¯¹äºä¸€ä¸ªæ–°è®¾å¤‡æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿä¸æ˜¯å¾ˆç¡®å®šæ˜¯ä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½å¯¹è¿™ä¸ªè®¾å¤‡æœ‰è®¿é—®æƒé™ï¼Œ<br>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè‡ªåŠ¨mountï¼Œé‚£ä¹ˆè¿™ä¸ªè®¾å¤‡çš„å†…å®¹å°±å¯èƒ½ä¼šè¢«æ‰€æœ‰ç”¨æˆ·çœ‹åˆ°ï¼Œ<br>è¿™æ ·ä¼šæœ‰å®‰å…¨çš„éšæ‚£ã€‚æ‰€ä»¥Unixå’ŒLinuxæ‰è¦æ±‚å¿…é¡»å…ˆmountï¼Œ<br>å¹¶ä¸”mountå‘½ä»¤å¿…é¡»è¦ç”¨rootæƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸€ä¸ªæœªçŸ¥çš„è®¾å¤‡ï¼Œ<br>å¿…é¡»ç”±rootæ¥å†³å®šæ˜¯ä¸æ˜¯å¯ç”¨çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™ç§è®¾è®¡çš„åŸå› å·²ç»å¾ˆæ¸…æ™°äº†ï¼Œå°±æ˜¯ä¸ºäº†æƒé™æ§åˆ¶ã€‚</p>
</blockquote>
</li>
<li><p>Windowsä¸éœ€è¦è¿™ä¸ªæœºåˆ¶ï¼Œæ˜¯å› ä¸ºWindowsæ˜¯ä»DOSå‘å±•è¿‡æ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€ç›´æ²¡æœ‰æƒé™æ§åˆ¶ï¼Œ</p>
<blockquote>
<p>æ‰€ä»¥Windowsä¹Ÿä¸éœ€è¦mount</p>
</blockquote>
</li>
<li><p>Linuxä¹Ÿå¯ä»¥åšåˆ°è‡ªåŠ¨æŒ‚è½½, ä¾‹å¦‚Ubuntuå°±æ˜¯è‡ªåŠ¨æŒ‚è½½çš„</p>
</li>
</ol>
<h1 id="ç£ç›˜-amp-æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†"><a href="#ç£ç›˜-amp-æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†" class="headerlink" title="ç£ç›˜&amp;æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†"></a>ç£ç›˜&amp;æ–‡ä»¶ç³»ç»Ÿçš„æ‰©å±•çŸ¥è¯†</h1><h2 id="ç£ç›˜-åˆ†åŒº-æ–‡ä»¶ç³»ç»Ÿ-å…³ç³»"><a href="#ç£ç›˜-åˆ†åŒº-æ–‡ä»¶ç³»ç»Ÿ-å…³ç³»" class="headerlink" title="ç£ç›˜, åˆ†åŒº, æ–‡ä»¶ç³»ç»Ÿ å…³ç³»"></a>ç£ç›˜, åˆ†åŒº, æ–‡ä»¶ç³»ç»Ÿ å…³ç³»</h2><p>å¦‚ä¸‹: </p>
<pre class="mermaid">erDiagram
    DiskDevice ||--|{ Partition : contain
    Partition ||--|| FileSystem : format</pre>

<h3 id="ç£ç›˜-x2F-å—è®¾å¤‡-gt-åˆ†åŒº"><a href="#ç£ç›˜-x2F-å—è®¾å¤‡-gt-åˆ†åŒº" class="headerlink" title="ç£ç›˜&#x2F;å—è®¾å¤‡ -&gt; åˆ†åŒº"></a>ç£ç›˜&#x2F;å—è®¾å¤‡ -&gt; åˆ†åŒº</h3><p>ä¸€ä¸ªç£ç›˜è®¾å¤‡(HDD, SSD, Uç›˜ç­‰), å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒº. åˆ†åŒºæ–¹å¼æœ‰MBR, GPTä¸¤ç§.<br>é‚£ä¹ˆç£ç›˜åˆ†åŒºçš„å…ƒä¿¡æ¯å†™åœ¨å“ªé‡Œ? </p>
<ul>
<li>æ˜¯å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¹ˆ? æ­¤æ—¶ç£ç›˜è¿˜æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿ, æ‰€ä»¥åº”è¯¥ä¸æ˜¯ä»¥æ–‡ä»¶å½¢å¼ä¿å­˜, æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå°±æ— æ³•ç›´æ¥åœ¨æ“ä½œç³»ç»Ÿé‡Œæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶å¹¶æ“ä½œ.</li>
<li>æ˜¯å­˜å‚¨åœ¨è£¸è®¾å¤‡çš„å›ºå®šä½ç½®(å®ƒåœ¨ç¡¬ç›˜ä¸Šçš„ä¸‰ç»´åœ°å€ä¸ºï¼ˆæŸ±é¢ï¼Œç£å¤´ï¼Œæ‰‡åŒºï¼‰ï¼ï¼ˆ0ï¼Œ0ï¼Œ1ï¼‰ã€‚)</li>
<li>é€šè¿‡ <code>lsblk</code> å‘½ä»¤æŸ¥çœ‹å·²ç»æŒ‚è½½çš„å—è®¾å¤‡<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@662fd3213ce8:/data<span class="token comment"># lsblk</span>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
vda    <span class="token number">254</span>:0    <span class="token number">0</span> <span class="token number">59</span>.6G  <span class="token number">0</span> disk
`-vda1 <span class="token number">254</span>:1    <span class="token number">0</span> <span class="token number">59</span>.6G  <span class="token number">0</span> part /etc/hosts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="åˆ†åŒº-gt-æ–‡ä»¶ç³»ç»Ÿ"><a href="#åˆ†åŒº-gt-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="åˆ†åŒº -&gt; æ–‡ä»¶ç³»ç»Ÿ"></a>åˆ†åŒº -&gt; æ–‡ä»¶ç³»ç»Ÿ</h3><p>ä¸€ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ. å› æ­¤åŒä¸€ä¸ªç£ç›˜è®¾å¤‡çš„å¤šä¸ªåˆ†åŒº, å„ä¸ªåˆ†åŒºéƒ½å¯ä»¥æ ¼å¼åŒ–æˆä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹.</p>
<ul>
<li>é€šè¿‡ <code>df -h</code> å‘½ä»¤æŸ¥çœ‹åˆ†åŒº<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@662fd3213ce8:/data<span class="token comment"># df -h</span>
Filesystem      Size  Used Avail Use% Mounted on
overlay          59G  <span class="token number">2</span>.7G   53G   <span class="token number">5</span>% /
tmpfs            64M     <span class="token number">0</span>   64M   <span class="token number">0</span>% /dev
shm              64M     <span class="token number">0</span>   64M   <span class="token number">0</span>% /dev/shm
/dev/vda1        59G  <span class="token number">2</span>.7G   53G   <span class="token number">5</span>% /data
tmpfs           <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G   <span class="token number">0</span>% /proc/acpi
tmpfs           <span class="token number">3</span>.9G     <span class="token number">0</span>  <span class="token number">3</span>.9G   <span class="token number">0</span>% /sys/firmware<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®"><a href="#æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®"></a>æ–‡ä»¶ç³»ç»Ÿç±»å‹æè¿°å…ƒæ•°æ®</h3><div class="note warning"><p>TODO: æš‚æ—¶è¿˜æ²¡æœç´¢åˆ°ç›¸å…³ä¿¡æ¯.</p>
</div>

<h3 id="æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•-amp-æ–‡ä»¶å…ƒæ•°æ®"><a href="#æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•-amp-æ–‡ä»¶å…ƒæ•°æ®" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•&amp;æ–‡ä»¶å…ƒæ•°æ®:"></a>æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç›®å½•&amp;æ–‡ä»¶å…ƒæ•°æ®:</h3><ul>
<li>ä¾‹å¦‚ext4, ä»¥inodeå½¢å¼ä¿å­˜. åŒ…æ‹¬æ–‡ä»¶å¤§å°, æƒé™ä¿¡æ¯, gmtCreated, gmtModified, åŒ…å«çš„blockæ•°é‡, å­˜å‚¨åœ¨ç£ç›˜çš„ä½ç½®(æŸ±é¢) ç­‰</li>
<li>å¯ä»¥ä½¿ç”¨ stat å‘½ä»¤æŸ¥çœ‹</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@662fd3213ce8:/data<span class="token comment"># stat dump.rdb</span>
  File: dump.rdb
  Size: <span class="token number">105</span>       	Blocks: <span class="token number">8</span>          IO Block: <span class="token number">4096</span>   regular <span class="token function">file</span>
Device: fe01h/65025d	Inode: <span class="token number">1055693</span>     Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0600/-rw-------<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span>  <span class="token number">999</span>/   redis<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span>  <span class="token number">999</span>/   redis<span class="token punctuation">)</span>
Access: <span class="token number">2022</span>-10-12 <span class="token number">16</span>:01:07.043330092 +0000
Modify: <span class="token number">2022</span>-06-26 <span class="token number">10</span>:16:40.880774990 +0000
Change: <span class="token number">2022</span>-06-26 <span class="token number">10</span>:16:40.896774990 +0000
 Birth: <span class="token number">2022</span>-06-26 <span class="token number">10</span>:16:40.869774990 +0000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div class="note warning"><p>TODO: åˆ†æä¸‹statçš„å…·ä½“ä¿¡æ¯å«ä¹‰, å°¤å…¶æ˜¯ Device ç›¸å…³çš„, æ˜¯ä¸æ˜¯æ“ä½œç³»ç»Ÿç›´æ¥å°±æŒ‰ç…§è¿™ä¸ªä¿¡æ¯å»å¯»æ‰¾åˆ°æ–‡ä»¶çš„æŸ±é¢èŒƒå›´äº†?</p>
</div>

<h3 id="åˆ†åŒºåç§°è§„èŒƒ"><a href="#åˆ†åŒºåç§°è§„èŒƒ" class="headerlink" title="åˆ†åŒºåç§°è§„èŒƒ"></a>åˆ†åŒºåç§°è§„èŒƒ</h3><ul>
<li>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œç¡¬ç›˜åˆ†åŒºå‘½åä¸ºsda1ï¼sda4æˆ–è€…hda1ï¼hda4</li>
</ul>
<div class="note warning"><p>TODO: è‡ªå·±æ‰¾ä¸ªUç›˜è¯•ä¸‹åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒº, æ¯ä¸ªåˆ†åŒºä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹?</p>
</div>





<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>åä¸‡ä¸ªä¸ºä»€ä¹ˆ</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>disk</tag>
        <tag>os</tag>
      </tags>
  </entry>
  <entry>
    <title>K8séƒ¨ç½²ä½¿ç”¨é”™è¯¯æ’æŸ¥</title>
    <url>//2022-11-01-k8s-trouble-shooting/</url>
    <content><![CDATA[<h1 id="ImagePullBackOff"><a href="#ImagePullBackOff" class="headerlink" title="ImagePullBackOff"></a>ImagePullBackOff</h1><h2 id="é”™è¯¯"><a href="#é”™è¯¯" class="headerlink" title="é”™è¯¯"></a>é”™è¯¯</h2><hr>
<p>åœ¨macä¸Šä½¿ç”¨minikube, åˆ›å»ºpodå‡ºç°å¦‚ä¸‹ ImagePullBackOff:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Normal   Pulling    8s               kubelet            Pulling image <span class="token string">"docker.io/nginx:1.23"</span>
Warning  Failed     8s               kubelet            Failed to pull image <span class="token string">"docker.io/nginx:1.23"</span><span class="token builtin class-name">:</span> rpc error: code <span class="token operator">=</span> Unknown desc <span class="token operator">=</span> Error response from daemon: Get <span class="token string">"https://registry-1.docker.io/v2/"</span><span class="token builtin class-name">:</span> dial tcp: lookup registry-1.docker.io on <span class="token number">192.168</span>.64.1:53: server misbehaving
Warning  Failed     8s               kubelet            Error: ErrImagePull
Normal   BackOff    6s <span class="token punctuation">(</span>x2 over 7s<span class="token punctuation">)</span>  kubelet            Back-off pulling image <span class="token string">"docker.io/nginx:1.23"</span>
Warning  Failed     6s <span class="token punctuation">(</span>x2 over 7s<span class="token punctuation">)</span>  kubelet            Error: ImagePullBackOff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><hr>
<p>å‚è§: <a href="https://github.com/docker/for-mac/issues/1317">è§£å†³æ–¹æ¡ˆ</a></p>
<ol>
<li><p>ç™»å½•minikubeçš„èŠ‚ç‚¹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ minikube <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>åœ¨minikube nodeä¸Šæ‰‹åŠ¨ pull docker image, å¦‚ä¸‹, å‘ç°é—®é¢˜ä»ç„¶é‡ç°</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> pull docker.io/nginx
Using default tag: latest
Error response from daemon: Get <span class="token string">"https://registry-1.docker.io/v2/"</span><span class="token builtin class-name">:</span> dial tcp: lookup registry-1.docker.io on <span class="token number">192.168</span>.64.1:53: server misbehaving<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>ä¿®æ”¹minikube nodeä¸Šçš„resolv.confæ–‡ä»¶çš„nameserver:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/resolv.conf
nameserver <span class="token number">8.8</span>.8.8
search <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>é‡æ–°å°è¯•æ‰‹åŠ¨pull image, å‘ç°é—®é¢˜è§£å†³:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> pull docker.io/nginx:1.23
<span class="token number">1.23</span>: Pulling from library/nginx
Digest: sha256:943c25b4b66b332184d5ba6bb18234273551593016c0e0ae906bab111548239f
Status: Downloaded newer image <span class="token keyword">for</span> nginx:1.23
docker.io/library/nginx:1.23<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>é€€å‡ºnode, åœ¨Macä¸Šé‡æ–°æ£€æŸ¥podçŠ¶æ€, é—®é¢˜è§£å†³ğŸ‰ğŸ‰ğŸ‰:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">davywalkerdeMacBook-Pro:~ davywalker$ k get po
NAME                              READY   STATUS    RESTARTS   AGE
hello-minikube-67b8c7bdfd-965qn   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          87s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="ä¸ºå•¥å«â€ImagePullBackOffâ€"><a href="#ä¸ºå•¥å«â€ImagePullBackOffâ€" class="headerlink" title="ä¸ºå•¥å«â€ImagePullBackOffâ€??"></a>ä¸ºå•¥å«â€ImagePullBackOffâ€??</h2><hr>
<p>å‚è§æ–‡ç«  <a href="https://www.tutorialworks.com/kubernetes-imagepullbackoff/">Kubernetes ImagePullBackOff error: what you need to know</a> è¯´æ˜.</p>
<blockquote>
<p>The status ImagePullBackOff means that a Pod couldnâ€™t start,<br>because Kubernetes couldnâ€™t pull a container image.<br>The â€˜BackOffâ€™ part means that Kubernetes will keep trying to pull the image,<br>with an increasing delay (â€˜back-offâ€™).</p>
</blockquote>
<p>è¿™é‡Œçš„â€BackOffâ€å°±æ˜¯â€é€€é¿â€çš„æ„æ€, å½“æ‹‰å–å¤±è´¥æ—¶, kubeletåº”è¯¥æœ‰ä¸ªé€€é¿ç®—æ³•æ¥é‡è¯•æ‹‰å–. å…·ä½“é€€é¿ç®—æ³•æ˜¯å•¥, æœ‰å¾…åç»­é’»ç ”. ğŸ¤”</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>kubectl</tag>
        <tag>trouble-shooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ç©è½¬minikube</title>
    <url>//2022-11-02-k8s-play-with-minikube/</url>
    <content><![CDATA[<h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><ul>
<li><p>ç™»å½•Node</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">minikube <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>kubectl</tag>
        <tag>minikube</tag>
      </tags>
  </entry>
  <entry>
    <title>åä¸‡ä¸ªä¸ºä»€ä¹ˆ--ç”¨æ™¶ä½“ç®¡æ•°é‡è¡¡é‡èŠ¯ç‰‡çš„å…ˆè¿›æ€§åˆç†ä¹ˆ?</title>
    <url>//2022-11-05-transistor-cnt-a-flawed-metric/</url>
    <content><![CDATA[<h1 id="0x00-Intro"><a href="#0x00-Intro" class="headerlink" title="0x00: Intro"></a>0x00: Intro</h1><p>æœ€è¿‘åœ¨çœ‹ <a href="https://zhuanlan.zhihu.com/p/479978458">The Basic Principles of Computers for Everyone</a> è¿™æœ¬ä¹¦, ä» </p>
<ul>
<li>ä¸éé—¨(NAND) å¼€å§‹, åŠ ä¸Šéé—¨, æ„å»ºä¸é—¨</li>
<li>4ä¸ªNANDæ„å»ºä¸€ä½å¸¦å¼€å…³çš„å­˜å‚¨å•å…ƒ(M); </li>
<li>8ä¸ªå­˜å‚¨å•å…ƒ(M)æ„å»º1Byteçš„å­˜å‚¨(B)</li>
<li>8ä¸ªä¸é—¨æ„å»ºä¸€ä¸ª8ä½çš„Enabler(E)</li>
<li>B+E æ„å»ºä¸€ä¸ª 8ä½ <strong>å¯„å­˜å™¨(R)</strong> + æ€»çº¿</li>
<li>8ä¸ªä¸é—¨+3ä¸ªéé—¨æ„å»ºä¸€ä¸ª <strong>3X8è¯‘ç å™¨(Decoder)</strong></li>
<li>1ä¸ª8ä½å¯„å­˜å™¨&amp;2ä¸ª4X16è¯‘ç å™¨(ç”¨äºå¯»å€) + 256ä¸ª1ä½å¯„å­˜å™¨(R)&amp;3ä¸ªä¸é—¨(ç”¨äºå­˜æ•°) æ„å»º 256ä½ çš„RAM</li>
</ul>
<p>ç­‰ç­‰, éå¸¸æ·±å…¥æµ…å‡º. åè¾¹ä¼šæŠŠè¯»ä¹¦ç¬”è®°è¡¥å……ä¸Šæ¥. </p>
<p>å¿ä¸ä½æ€ç»´è·³è·ƒäº†ä¸‹, æ„å»ºä¸€ä¸ª256ä½çš„RAMè‡³å°‘éœ€è¦((4*8+8) + (4+16) + (4+1)*256 + 3 &#x3D; 1343)ä¸ªé—¨(4ä¸ªMOSç®¡æ„å»ºå‡ºä¸€ä¸ªä¸éé—¨, ä½†å½“å‰ä¸»æµçš„éƒ½æ˜¯FinFET, åœºæ•ˆåº”æ™¶ä½“ç®¡). è™½ç„¶æ˜¯RAMçš„å®ç°, ä¸å®é™…CPUä¸ŠL1&#x2F;L2&#x2F;L3Cacheçš„å®ç°æ–¹å¼ä¸åŒ, ä½†ä¹Ÿèƒ½åŸºæœ¬è¯´æ˜ç‚¹å„¿é—®é¢˜, å°±æ˜¯æˆ‘ä»¬æ„å»ºCPU&#x2F;DRAMç­‰éƒ½éœ€è¦åºå¤§æ•°é‡çš„æ™¶ä½“ç®¡.</p>
<p>æƒ³èµ·è‹¹æœ2021å‘å¸ƒçš„M1 MaxèŠ¯ç‰‡, <a href="https://www.apple.com/hk/en/newsroom/2021/10/introducing-m1-pro-and-m1-max-the-most-powerful-chips-apple-has-ever-built/">æ™¶ä½“ç®¡æ•°é‡æ˜¯570äº¿, 57 billion transistors</a>, ä¾‹å¦‚è‡ªå·±åœ¨ç”¨çš„<code>Intel Xeon E5 2660 V3</code>, ä¹Ÿæœ‰2.6 billionä¸ªtransistors. è¿™ç§åºå¤§çš„æ•°å­—, æ€»æ˜¯è®©äººå¾ˆéœ‡æ’¼. ä¹Ÿæ— å¤–ä¹å‚å•†ä¼šç”¨è¿™ä¸ªæ•°å­—æ¥å¹å˜˜, æ¥ä½œä¸ºé‡è¦æŒ‡æ ‡, è¯´æ˜è‡ªå·±çš„CPU&#x2F;èŠ¯ç‰‡æœ‰å¤šå¤æ‚å¤šå…ˆè¿›. æ¯•ç«ŸèŠ¯ç‰‡é¢ç§¯æ€»å…±å°±é‚£ä¹ˆå¤§, 10å€æ™¶ä½“ç®¡æ•°é‡çš„æå‡, åŸºæœ¬å°±åªèƒ½æå‡å¯†åº¦äº†, ä¹Ÿå°±æ˜¯å¾—é å…ˆè¿›åˆ¶ç¨‹ç­‰. </p>
<p>ä½†æˆ‘ä»¬æŠ€æœ¯äººéƒ½è¦æœ‰æ‰¹åˆ¤æ€§æ€ç»´, ä»”ç»†å†æƒ³ä¸‹, CPUä¸­<a href="https://zhuanlan.zhihu.com/p/31422201">å‡ ä¹ä¸€åŠçš„é¢ç§¯éƒ½æ˜¯L3 Cache</a>, Cacheçš„ç”µè·¯è®¾è®¡å¹¶ä¸å¤æ‚, å› æ­¤éƒ½æ˜¯å…ˆè¿›åˆ¶ç¨‹å¸¦æ¥çš„çº¢åˆ©ä¹ˆ? æ™¶ä½“ç®¡æ•°é‡åºå¤§, çœŸçš„èƒ½è¯´æ˜æŠ€æœ¯NBä¹ˆ?</p>
<p>é‚æœç´¢äº†ä¸‹èµ„æ–™, å‘ç°æœç„¶æœ‰äººç ¸åœºå­çš„, <a href="https://www.realworldtech.com/transistor-count-flawed-metric/">Transistor Count: A Flawed Metric</a>, åœ¨æ ‡é¢˜é‡Œå°±æ˜ç¡®ä¹‹å¤„, <strong>æ™¶ä½“ç®¡æ•°é‡æ˜¯ä¸€ä¸ªæœ‰ç¼ºé™·çš„æŒ‡æ ‡</strong>. è¯¦ç»†é˜…è¯»äº†ä¹‹å, æˆ‘è¯•ç€æ€»ç»“ä¸‹ä½œè€…çš„å‡ ä¸ªç†ç”±.</p>
<h1 id="0x01-æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„"><a href="#0x01-æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„" class="headerlink" title="0x01: æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„!!"></a>0x01: æ™¶ä½“ç®¡æ•°é‡æ˜¯æ•°ä¸å‡†çš„!!</h1><hr>
<p>å‚å•†ç»™å‡ºçš„æ™¶ä½“ç®¡æ•°é‡éƒ½æ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼. åŒæ ·çš„è®¾è®¡, æ™¶ä½“ç®¡æ•°é‡ä¼šæœ‰33%åˆ°37%çš„è¯¯å·®. ä¸ºå•¥å‘¢? æ‘˜å½• <a href="https://www.eet-china.com/news/202009071737.html">ä¸ºä»€ä¹ˆè¯´Intelçš„10nmå·¥è‰ºæ¯”åˆ«å®¶7nmæ›´å…ˆè¿›ï¼Ÿ</a> ä¸­çš„ç‰‡æ®µ:</p>
<blockquote>
<p>æ¯”è¾ƒå¤è€çš„ä¸€ç§è®¡é‡å¯†åº¦çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯ç”¨ CPPï¼ˆcontacted poly pitchï¼Œå³ gate pitchï¼Œæ …é—´è·ï¼‰å»ä¹˜ä»¥ metal pitch æœ€å°é‡‘å±é—´è·ã€‚<br>åˆ°äº† FinFET æ™¶ä½“ç®¡æ—¶æœŸï¼Œå¢åŠ  finï¼ˆé³ï¼‰é«˜åº¦ã€å‡å°‘ fin ä¹‹é—´çš„é—´è·å°±èƒ½æœ‰æ•ˆå¢åŠ é©±åŠ¨ç”µæµã€‚é©±åŠ¨ç”µæµä¸Šå»ä¹‹åï¼Œå°±å¯ä»¥å‡å°‘ fin çš„æ•°é‡â€”â€”ä¸€ä¸ªå•å…ƒå‡å°‘ fin çš„æ•°é‡ï¼Œä¹Ÿå°±å®ç°äº†é‡‘å± track çš„å‡å°‘ï¼Œå¯ä»¥é™ä½åŠ¨æ€åŠŸè€—ï¼Œä¸æ­¤åŒæ—¶ç¡®ä¿æ€§èƒ½ï¼Œç”šè‡³è¿˜èƒ½é€šè¿‡ä¸€äº›ä¼˜åŒ–æ‰‹æ³•æ¥æå‡é€Ÿåº¦ã€‚<br>åœ¨é‡‘å± track å‡å°‘ä¹‹åï¼Œä¼ ç»Ÿè®¡ç®—å¯†åº¦çš„æ–¹æ³•å…¶å®å°±ä¸æ€ä¹ˆå‡†ç¡®äº†ï¼Œå› ä¸ºå®ƒå…¶å®ä¸èƒ½åæ˜ å•å…ƒé«˜åº¦å‡å°‘è¿™æ ·çš„å®é™…ç»“æ„å˜åŒ–ã€‚æ‰€ä»¥åæ¥æœ‰æ–¹æ³•æ˜¯ CPP ä¹˜ä»¥ MMPï¼ˆæœ€å°é‡‘å±é—´è·ï¼‰ï¼Œå†ä¹˜ä»¥ Track æ•°ã€‚<br>ä½†æ›´å¤šçš„ç»“æ„ä¼˜åŒ–ï¼Œæ¯”å¦‚åæ–‡ä¼šæåˆ°çš„ COAG æŠ€æœ¯è¿›ä¸€æ­¥é™ä½äº†å•å…ƒé«˜åº¦ï¼ŒåŒæ—¶é‡‡ç”¨ dummy gate æ¥ç¼©å‡å•å…ƒçš„å®½åº¦ã€‚é‚£ä¹ˆåœ¨å•å…ƒå®½åº¦ã€é«˜åº¦åŒæ—¶é™ä½çš„æƒ…å†µä¸‹ï¼Œä¸Šé¢è¿™ç§è®¡ç®—æ–¹æ³•å°±åˆä¸å‡†ç¡®äº†ã€‚<br>æ‰€ä»¥å¦‚ä»Šçš„æ™¶ä½“ç®¡æ•°å­—ï¼Œæ›´å¤šçš„åº”å½“ä½œä¸ºä¸€ç§å‚è€ƒæ¥çœ‹ï¼Œæ¯•ç«Ÿæ™¶ä½“ç®¡å¹¶ä¸æ˜¯ä»¥å‡åŒ€çš„æ–¹å¼åˆ†å¸ƒåœ¨ die ä¸Šçš„ã€‚</p>
</blockquote>
<h1 id="0x02-ä¸åŒç±»å‹çš„èŠ¯ç‰‡-è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„-ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦"><a href="#0x02-ä¸åŒç±»å‹çš„èŠ¯ç‰‡-è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„-ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦" class="headerlink" title="0x02: ä¸åŒç±»å‹çš„èŠ¯ç‰‡, è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„, ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦"></a>0x02: ä¸åŒç±»å‹çš„èŠ¯ç‰‡, è®¾è®¡ç›®æ ‡æ˜¯æœ‰å·®å¼‚çš„, ä¸ä¼šä¸€å‘³è¿½æ±‚é«˜å¯†åº¦</h1><hr>
<p>ä¾‹å¦‚</p>
<ul>
<li>ASCIèŠ¯ç‰‡, åªéœ€è¦è¾¾åˆ°ç›®æ ‡çš„ååé‡å³å¯, ä¸éœ€è¦è¿½æ±‚é«˜ä¸»é¢‘. ä¾‹å¦‚<code>Cisco Silicon One</code>, åªéœ€è¦è¾¾åˆ°ç›®æ ‡çš„400Gbpsä»¥å¤ªç½‘ååé‡å³å¯. å› æ­¤ASCIè®¾è®¡å›¢é˜Ÿæ›´å€¾å‘äº 1. ä½¿ç”¨è‡ªåŠ¨åŒ–è®¾è®¡å·¥å…· 2. æ›´å°‘çš„å®šåˆ¶ç”µè·¯ 3. æ›´é«˜å¯†åº¦æ™¶ä½“ç®¡(å•Finçš„FinFETæ™¶ä½“ç®¡). </li>
<li>æœåŠ¡å™¨èŠ¯ç‰‡è¿½æ±‚æ›´é«˜é¢‘ç‡, ä¾‹å¦‚<code>Xeon 8268</code>å’Œ<code>Xeon 8260</code>éƒ½æœ‰24 Core, ä½†8268çš„é¢‘ç‡æ˜¯2.9GHz, 8260æ˜¯2.4GHz, ä»·æ ¼ç›¸å·®äº†$1600. å› æ­¤æœåŠ¡å™¨èŠ¯ç‰‡è®¾è®¡æ›´å€¾å‘äº 1. æ›´å¤šçš„å®šåˆ¶ç”µè·¯ 2. æ›´å¤§çš„æ™¶ä½“ç®¡(2Fin, 3Finç”šè‡³æ›´å¤šFinçš„FinFETæ™¶ä½“ç®¡)<blockquote>
<p>TODO: FinFETä¸­Finæ•°é‡ä¸ä¸»é¢‘çš„å…³ç³»æ˜¯?</p>
</blockquote>
</li>
</ul>
<h1 id="0x03-èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ"><a href="#0x03-èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ" class="headerlink" title="0x03. èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ"></a>0x03. èŠ¯ç‰‡ä¸­ä¸åŒåŠŸèƒ½åŒºåŸŸå¯†åº¦ä¸åŒ</h1><hr>
<p><img data-src="https://plantegg.github.io/images/951413iMgBlog/4Z1nU.png"><br>å¦‚ä¸Šå›¾, å¤„ç†å™¨ç»„æˆéƒ¨åˆ†:</p>
<ol>
<li>CPU Cores, åŒ…å« cores, L1 Cache, L2 Cache</li>
<li>L3 Cache</li>
<li>System Interface</li>
<li>I&#x2F;O, åŒ…å« QPI, DIMM</li>
</ol>
<p>å¦‚ä¸‹ä¸¤ä¸ªå¤„ç†å™¨, éƒ½æ˜¯foræœåŠ¡å™¨åœºæ™¯:<br><img data-src="https://www.realworldtech.com/wp-content/uploads/2020/05/Table1.png?x97168" alt="Table 1. Transistor count and density for major regions for the Poulson and Tukwila generations of Itanium processors"></p>
<p>å¦‚ä¸Šå›¾, CPU ä¸åŒåŒºåŸŸ, å¯†åº¦å·®å¼‚èƒ½é«˜è¾¾20å€. ä¾‹å¦‚Poulsonçš„L3 Cacheå¯†åº¦æ˜¯13.33Mtr&#x2F;mm2, ä½†IOåŒºåŸŸå¯†åº¦æ˜¯0.65Mtr&#x2F;mm2</p>
<blockquote>
<p>Naturally, the cache region which primarily comprises ultra-dense SRAM is the densest and makes up most of the transistors in each design.<br>The I&#x2F;O is the least dense portion of the two designs, because it contains many delicate analog circuits such as PLLs and DLLs, digital filters, and the large, high-voltage I&#x2F;O transistors that are used to transmit and receive off-chip data.</p>
</blockquote>
<p>å¦‚æœåªè¿½æ±‚é«˜å¯†åº¦, åºå¤§æ•°é‡, ç›´æ¥å †L3Cacheå°±è¡Œäº†.</p>
<h1 id="0x04-å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡"><a href="#0x04-å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡" class="headerlink" title="0x04: å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡"></a>0x04: å®é™…æœ‰å¾ˆå¤šæ— æ•ˆçš„æ™¶ä½“ç®¡</h1><hr>
<p>æ­£å¸¸å·¥ä½œçš„å«åšactive transistors, ä½†å®é™…ä¸Š, ç”Ÿäº§å‡ºæ¥çš„èŠ¯ç‰‡é‡Œè¿˜ä¼šåŒ…å«: </p>
<ol>
<li>dummy transistors: ä¸»è¦ç”¨æ¥æå‡è‰¯å“ç‡, ä½†æ•°é‡ä¸ç®—é‚£ä¹ˆåºå¤§.</li>
<li>decap transistors(decoupling capacitors): æ•°é‡å°±æ¯”è¾ƒå·¨å¤§äº†.</li>
</ol>
<blockquote>
<p>To ensure yield, the die must be relatively uniform and the whitespace cannot be truly empty. Many designs will fill the whitespace with decap cells to provide decoupling capacitance for power delivery and thereby improve operating frequency.</p>
</blockquote>
<p>å®é™…ä¸Šæ— æ•ˆæ™¶ä½“ç®¡æ•°é‡å åˆ°äº†20%~30%, ç”šè‡³æ›´å¤š.</p>
<blockquote>
<p>They found that in the small sampled regions that the active transistors were between 70-80% of the total, and the remaining 20-30% of layout transistors were decap and dummy devices.</p>
</blockquote>
<h1 id="0x05-æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾"><a href="#0x05-æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾" class="headerlink" title="0x05. æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾"></a>0x05. æ™¶ä½“ç®¡ä¸è´µå¤šè€Œè´µåœ¨ç²¾</h1><hr>
<p>ä¾‹å¦‚ AMD Radeon VII æ¯” RX 5700å¤šäº†28%çš„transistors, ä½†æ˜¯ä¸¤è€…æ€§èƒ½å·®ä¸å¤š. éƒ¨åˆ†åŸå› æ˜¯RX 5700ä½¿ç”¨äº†æ›´åŠ å…ˆè¿›çš„æ¶æ„, è€Œä¸”RX 5700è¦ä¾¿å®œå¾ˆå¤š.</p>
<blockquote>
<p>When it comes to actual value to customers, itâ€™s not about the transistor count, but how the transistors are used.</p>
</blockquote>
<h1 id="0x06-æ€»ç»“"><a href="#0x06-æ€»ç»“" class="headerlink" title="0x06: æ€»ç»“"></a>0x06: æ€»ç»“</h1><p>æ‰€ä»¥, è¿™ä¸œè¥¿å°±è·Ÿå¨±ä¹å¤§å¸ˆè·‘åˆ†ä¸€æ ·, åªä½œä¸ºä¸€ä¸ªå‚è€ƒé¡¹, ä¸è¦ä½œä¸ºå”¯ä¸€æŒ‡æ ‡. ä¸èƒ½ä¸€å¶éšœç›®ä¸è§æ³°å±±.</p>
<p>æ›´é‡è¦çš„æ˜¯, æˆ‘ä»¬æŠ€æœ¯äºº, <strong>éœ€è¦ä¿æŒç‹¬ç«‹æ€è€ƒèƒ½åŠ›</strong>, çŸ¥å…¶ç„¶, ä¹Ÿè¦çŸ¥å…¶æ‰€ä»¥ç„¶, ä¸è¦è¢«å‚å•†å¿½æ‚ äº†. </p>
<h1 id="0xFF-å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®"><a href="#0xFF-å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®" class="headerlink" title="0xFF:å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®"></a>0xFF:å…¶ä»–ä¸€äº›å¥½ç©å„¿çš„ç§‘æ™®</h1><ol>
<li>L3 Cacheä¸ºå•¥ä¸èƒ½åšå¾—æ›´å¤§ä¸€äº›? ç›´æ¥æ›¿æ¢æ‰RAMä¸è¡Œä¹ˆ?</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>åä¸‡ä¸ªä¸ºä»€ä¹ˆ</category>
      </categories>
      <tags>
        <tag>semi-conductor</tag>
        <tag>cpu</tag>
        <tag>hardware</tag>
        <tag>chip</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç£ç›˜ä¸åˆ†åŒºçš„å¸¸ç”¨å‘½ä»¤</title>
    <url>//2022-11-16-disk-partition-2/</url>
    <content><![CDATA[<h1 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h1><h2 id="æŸ¥çœ‹å½“å‰ç³»ç»Ÿå—è®¾å¤‡åˆ—è¡¨"><a href="#æŸ¥çœ‹å½“å‰ç³»ç»Ÿå—è®¾å¤‡åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹å½“å‰ç³»ç»Ÿå—è®¾å¤‡åˆ—è¡¨"></a>æŸ¥çœ‹å½“å‰ç³»ç»Ÿå—è®¾å¤‡åˆ—è¡¨</h2><h3 id="fdisk-l"><a href="#fdisk-l" class="headerlink" title="fdisk -l"></a>fdisk -l</h3><p>å¦‚ä¸‹, <code>fdisk -l</code> å‘½ä»¤, å¯ä»¥æ˜¾ç¤ºå‡º:</p>
<ol>
<li>å½“å‰ç³»ç»Ÿå­˜åœ¨2å—å—è®¾å¤‡, åˆ†åˆ«æ˜¯ <code>/dev/sda</code> ä¸ <code>/dev/sdb</code>, å¤§å°åˆ†åˆ«ä¸º 21.5GB ä¸ 31.5GB</li>
<li><code>/dev/sda</code> ç£ç›˜, åˆ’ä¸ºä¸¤ä¸ªåˆ†åŒº, åˆ†åˆ«æ˜¯ <code>/dev/sda1</code> <code>/dev/sda2</code>, å…¶ä¸­ <code>/dev/sda2</code> ä¸ºLVMæ–‡ä»¶ç³»ç»Ÿç±»å‹</li>
<li><code>/dev/sdb</code> ç£ç›˜(ä¸ªäººçŸ¥é“æ˜¯Uç›˜), åˆ’åˆ†ä¸º1ä¸ªåˆ†åŒº <code>/dev/sdb1</code> , æ–‡ä»¶ç³»ç»Ÿç±»å‹æ˜¯ <code>W95 FAT32</code></li>
<li>TODO: ç–‘é—®1  <code>/dev/mapper/centos-root</code> <code>/dev/mapper/centos-swap</code> åˆ†åˆ«éƒ½æ˜¯å•¥? ä¸ªäººå·²çŸ¥æ˜¯åœ¨ <code>/dev/sda2</code> ä¸‹ç»§ç»­åˆ†åŒºå‡ºæ¥çš„, å¦‚ä¸‹ <code>lsblk</code> å‘½ä»¤æŒ‡ç¤º. ä½†ä¸ºå•¥è¿™é‡Œæ²¡æœ‰</li>
<li>TODO: ç–‘é—®2 <code>Linux LVM</code> å…·ä½“æ˜¯å•¥æ–‡ä»¶ç³»ç»Ÿç±»å‹?</li>
</ol>
<blockquote>
<p>SATA device names follow the pattern &#x2F;dev&#x2F;sd[a-z]<br>while NVMe device names have the following pattern &#x2F;dev&#x2F;nvme[1-9]n[1-9]</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># fdisk -l</span>
Disk /dev/sda: <span class="token number">21.5</span> GB, <span class="token number">21474836480</span> bytes, <span class="token number">41943040</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
Disk label type: dos
Disk identifier: 0x000b7bb1

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        <span class="token number">2048</span>     <span class="token number">2099199</span>     <span class="token number">1048576</span>   <span class="token number">83</span>  Linux
/dev/sda2         <span class="token number">2099200</span>    <span class="token number">41943039</span>    <span class="token number">19921920</span>   8e  Linux LVM

Disk /dev/mapper/centos-root: <span class="token number">18.2</span> GB, <span class="token number">18249416704</span> bytes, <span class="token number">35643392</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes

Disk /dev/mapper/centos-swap: <span class="token number">2147</span> MB, <span class="token number">2147483648</span> bytes, <span class="token number">4194304</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes

Disk /dev/sdb: <span class="token number">31.5</span> GB, <span class="token number">31457280000</span> bytes, <span class="token number">61440000</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
Disk label type: dos
Disk identifier: 0x1c9aed9e

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1   *          <span class="token number">64</span>    <span class="token number">61439999</span>    <span class="token number">30719968</span>    b  W95 FAT32<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a>lsblk</h3><ul>
<li>å¦‚ä¸‹, ç±»å‹ä¸ºâ€diskâ€çš„æœ‰ä¸¤ä¸ª, sda sdb</li>
<li>sda è¢«åˆ’åˆ†ä¸ºäº†2ä¸ªåˆ†åŒº, sda1 ä¸ sda2</li>
<li>sdb è¢«åˆ’åˆ†ä¸ºäº†1ä¸ªåˆ†åŒº, sdb1</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   20G  <span class="token number">0</span> disk
â”œâ”€sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
â””â”€sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
  â”œâ”€centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   17G  <span class="token number">0</span> lvm  /
  â””â”€centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">1</span> <span class="token number">29</span>.3G  <span class="token number">0</span> disk
â””â”€sdb1            <span class="token number">8</span>:17   <span class="token number">1</span> <span class="token number">29</span>.3G  <span class="token number">0</span> part<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æŸ¥çœ‹è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹"><a href="#æŸ¥çœ‹è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹" class="headerlink" title="æŸ¥çœ‹è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹"></a>æŸ¥çœ‹è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹</h2><h3 id="ä¸æŒ‚è½½æŸ¥çœ‹-fdisk-l"><a href="#ä¸æŒ‚è½½æŸ¥çœ‹-fdisk-l" class="headerlink" title="ä¸æŒ‚è½½æŸ¥çœ‹: fdisk -l"></a>ä¸æŒ‚è½½æŸ¥çœ‹: fdisk -l</h3><p>å¦‚ä¸Š, </p>
<h3 id="ä¸æŒ‚è½½æŸ¥çœ‹-blkid"><a href="#ä¸æŒ‚è½½æŸ¥çœ‹-blkid" class="headerlink" title="ä¸æŒ‚è½½æŸ¥çœ‹: blkid"></a>ä¸æŒ‚è½½æŸ¥çœ‹: blkid</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/sda2</span>
/dev/sda2: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"xb72qt-XG0d-7jNA-VOEC-z3jt-y7bz-mtye35"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"LVM2_member"</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/mapper/centos-root</span>
/dev/mapper/centos-root: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"a30443bd-8ab9-4869-917d-fe51b512b993"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"xfs"</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/sdb1</span>
/dev/sdb1: <span class="token assign-left variable">LABEL</span><span class="token operator">=</span><span class="token string">"DISK_IMG"</span> <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"1C9A-ED9E"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"vfat"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æŒ‚è½½åæŸ¥çœ‹-df-hT"><a href="#æŒ‚è½½åæŸ¥çœ‹-df-hT" class="headerlink" title="æŒ‚è½½åæŸ¥çœ‹: df -hT"></a>æŒ‚è½½åæŸ¥çœ‹: df -hT</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># df -hT</span>
Filesystem              Type      Size  Used Avail Use% Mounted on
devtmpfs                devtmpfs  475M     <span class="token number">0</span>  475M   <span class="token number">0</span>% /dev
tmpfs                   tmpfs     487M     <span class="token number">0</span>  487M   <span class="token number">0</span>% /dev/shm
tmpfs                   tmpfs     487M  <span class="token number">7</span>.7M  479M   <span class="token number">2</span>% /run
tmpfs                   tmpfs     487M     <span class="token number">0</span>  487M   <span class="token number">0</span>% /sys/fs/cgroup
/dev/mapper/centos-root xfs        17G  <span class="token number">1</span>.4G   16G   <span class="token number">9</span>% /
/dev/sda1               xfs      1014M  138M  877M  <span class="token number">14</span>% /boot
tmpfs                   tmpfs      98M     <span class="token number">0</span>   98M   <span class="token number">0</span>% /run/user/0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æŸ¥çœ‹æ‰€æœ‰å·²æŒ‚è½½çš„åˆ†åŒºä¸æŒ‚è½½ç‚¹æ–‡ä»¶ç³»ç»Ÿç­‰ä¿¡æ¯-findmnt"><a href="#æŸ¥çœ‹æ‰€æœ‰å·²æŒ‚è½½çš„åˆ†åŒºä¸æŒ‚è½½ç‚¹æ–‡ä»¶ç³»ç»Ÿç­‰ä¿¡æ¯-findmnt" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰å·²æŒ‚è½½çš„åˆ†åŒºä¸æŒ‚è½½ç‚¹æ–‡ä»¶ç³»ç»Ÿç­‰ä¿¡æ¯ findmnt"></a>æŸ¥çœ‹æ‰€æœ‰å·²æŒ‚è½½çš„åˆ†åŒºä¸æŒ‚è½½ç‚¹æ–‡ä»¶ç³»ç»Ÿç­‰ä¿¡æ¯ findmnt</h3><p>å¦‚ä¸‹: </p>
<ol>
<li><code>/dev/mapper/centos-root</code> åˆ†åŒºæŒ‚è½½åœ¨ <code>/</code> ç›®å½•ä¸‹, æ–‡ä»¶ç³»ç»Ÿç±»å‹æ˜¯<code>xfs</code></li>
<li><code>/dev/sda1</code> åˆ†åŒºæŒ‚è½½åœ¨ <code>/boot/</code> ç›®å½•ä¸‹, æ–‡ä»¶ç³»ç»Ÿç±»å‹æ˜¯<code>xfs</code></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># findmnt</span>
TARGET                                SOURCE                  FSTYPE     OPTIONS
/                                     /dev/mapper/centos-root xfs        rw,relatime,seclabel,attr2,inode64,noquota
â”œâ”€/sys                                sysfs                   sysfs      rw,nosuid,nodev,noexec,relatime,seclabel
â”‚ â”œâ”€/sys/kernel/security              securityfs              securityfs rw,nosuid,nodev,noexec,relatime
â”‚ â”œâ”€/sys/fs/cgroup                    tmpfs                   tmpfs      ro,nosuid,nodev,noexec,seclabel,mode<span class="token operator">=</span><span class="token number">755</span>
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/systemd          cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,xattr,release_agent<span class="token operator">=</span>/usr/lib/systemd/systemd-cgroups-agent,name<span class="token operator">=</span>systemd
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/memory           cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,memory
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/blkio            cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,blkio
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/cpuset           cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,cpuset
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/perf_event       cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,perf_event
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/net_cls,net_prio cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,net_prio,net_cls
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/devices          cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,devices
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/cpu,cpuacct      cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,cpuacct,cpu
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/hugetlb          cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,hugetlb
â”‚ â”‚ â”œâ”€/sys/fs/cgroup/freezer          cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,freezer
â”‚ â”‚ â””â”€/sys/fs/cgroup/pids             cgroup                  cgroup     rw,nosuid,nodev,noexec,relatime,seclabel,pids
â”‚ â”œâ”€/sys/fs/pstore                    pstore                  pstore     rw,nosuid,nodev,noexec,relatime
â”‚ â”œâ”€/sys/kernel/config                configfs                configfs   rw,relatime
â”‚ â”œâ”€/sys/fs/selinux                   selinuxfs               selinuxfs  rw,relatime
â”‚ â””â”€/sys/kernel/debug                 debugfs                 debugfs    rw,relatime
â”œâ”€/proc                               proc                    proc       rw,nosuid,nodev,noexec,relatime
â”‚ â””â”€/proc/sys/fs/binfmt_misc          systemd-1               autofs     rw,relatime,fd<span class="token operator">=</span><span class="token number">26</span>,pgrp<span class="token operator">=</span><span class="token number">1</span>,timeout<span class="token operator">=</span><span class="token number">0</span>,minproto<span class="token operator">=</span><span class="token number">5</span>,maxproto<span class="token operator">=</span><span class="token number">5</span>,direct,pipe_ino<span class="token operator">=</span><span class="token number">13709</span>
â”œâ”€/dev                                devtmpfs                devtmpfs   rw,nosuid,seclabel,size<span class="token operator">=</span>485840k,nr_inodes<span class="token operator">=</span><span class="token number">121460</span>,mode<span class="token operator">=</span><span class="token number">755</span>
â”‚ â”œâ”€/dev/shm                          tmpfs                   tmpfs      rw,nosuid,nodev,seclabel
â”‚ â”œâ”€/dev/pts                          devpts                  devpts     rw,nosuid,noexec,relatime,seclabel,gid<span class="token operator">=</span><span class="token number">5</span>,mode<span class="token operator">=</span><span class="token number">620</span>,ptmxmode<span class="token operator">=</span>000
â”‚ â”œâ”€/dev/hugepages                    hugetlbfs               hugetlbfs  rw,relatime,seclabel
â”‚ â””â”€/dev/mqueue                       mqueue                  mqueue     rw,relatime,seclabel
â”œâ”€/run                                tmpfs                   tmpfs      rw,nosuid,nodev,seclabel,mode<span class="token operator">=</span><span class="token number">755</span>
â”‚ â””â”€/run/user/0                       tmpfs                   tmpfs      rw,nosuid,nodev,relatime,seclabel,size<span class="token operator">=</span>99568k,mode<span class="token operator">=</span><span class="token number">700</span>
â””â”€/boot                               /dev/sda1               xfs        rw,relatime,seclabel,attr2,inode64,noquota<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="åˆ†åŒº"><a href="#åˆ†åŒº" class="headerlink" title="åˆ†åŒº"></a>åˆ†åŒº</h2><h3 id="åˆ’åˆ†åˆ†åŒº-fdisk-n"><a href="#åˆ’åˆ†åˆ†åŒº-fdisk-n" class="headerlink" title="åˆ’åˆ†åˆ†åŒº: fdisk n"></a>åˆ’åˆ†åˆ†åŒº: fdisk n</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdb</span>
Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: n
Partition type:
   p   primary <span class="token punctuation">(</span><span class="token number">0</span> primary, <span class="token number">0</span> extended, <span class="token number">4</span> <span class="token function">free</span><span class="token punctuation">)</span>
   e   extended
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: p
Partition number <span class="token punctuation">(</span><span class="token number">1</span>-4, default <span class="token number">1</span><span class="token punctuation">)</span>:
First sector <span class="token punctuation">(</span><span class="token number">2048</span>-61439999, default <span class="token number">2048</span><span class="token punctuation">)</span>:
Using default value <span class="token number">2048</span>
Last sector, +sectors or +size<span class="token punctuation">&#123;</span>K,M,G<span class="token punctuation">&#125;</span> <span class="token punctuation">(</span><span class="token number">2048</span>-61439999, default <span class="token number">61439999</span><span class="token punctuation">)</span>:
Using default value <span class="token number">61439999</span>
Partition <span class="token number">1</span> of <span class="token builtin class-name">type</span> Linux and of size <span class="token number">29.3</span> GiB is <span class="token builtin class-name">set</span>

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: w
The partition table has been altered<span class="token operator">!</span>

Calling ioctl<span class="token punctuation">(</span><span class="token punctuation">)</span> to re-read partition table.
Syncing disks.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="åˆ é™¤åˆ†åŒº-fdisk-d"><a href="#åˆ é™¤åˆ†åŒº-fdisk-d" class="headerlink" title="åˆ é™¤åˆ†åŒº fdisk d"></a>åˆ é™¤åˆ†åŒº fdisk d</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdb</span>
å‘½ä»¤<span class="token punctuation">(</span>è¾“å…¥ m è·å–å¸®åŠ©<span class="token punctuation">)</span>ï¼šd
åˆ†åŒºå· <span class="token punctuation">(</span><span class="token number">1</span>-3ï¼Œé»˜è®¤ <span class="token number">3</span><span class="token punctuation">)</span>ï¼š
åˆ†åŒº <span class="token number">3</span> å·²åˆ é™¤

å‘½ä»¤<span class="token punctuation">(</span>è¾“å…¥ m è·å–å¸®åŠ©<span class="token punctuation">)</span>ï¼šw
The partition table has been altered<span class="token operator">!</span>

Calling ioctl<span class="token punctuation">(</span><span class="token punctuation">)</span> to re-read partition table.
æ­£åœ¨åŒæ­¥ç£ç›˜ã€‚
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -p</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      <span class="token number">8</span>:0    <span class="token number">0</span>   20G  <span class="token number">0</span> disk
â”œâ”€/dev/sda1                   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
â””â”€/dev/sda2                   <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
  â”œâ”€/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   17G  <span class="token number">0</span> lvm  /
  â””â”€/dev/mapper/centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
/dev/sdb                      <span class="token number">8</span>:16   <span class="token number">1</span> <span class="token number">29</span>.3G  <span class="token number">0</span> disk
â”œâ”€/dev/sdb1                   <span class="token number">8</span>:17   <span class="token number">1</span>   10G  <span class="token number">0</span> part
â””â”€/dev/sdb2                   <span class="token number">8</span>:18   <span class="token number">1</span>    4G  <span class="token number">0</span> part
/dev/sr0                     <span class="token number">11</span>:0    <span class="token number">1</span>  973M  <span class="token number">0</span> rom<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="æŒ‚è½½åˆ†åŒº-mount"><a href="#æŒ‚è½½åˆ†åŒº-mount" class="headerlink" title="æŒ‚è½½åˆ†åŒº mount"></a>æŒ‚è½½åˆ†åŒº mount</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/sdb1 /root/movie</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/sdb2 /root/book</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
æ–‡ä»¶ç³»ç»Ÿ                 å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
/dev/sdb1                 10G   33M   10G    <span class="token number">1</span>% /root/movie
/dev/sdb2                <span class="token number">4</span>.0G   33M  <span class="token number">4</span>.0G    <span class="token number">1</span>% /root/book
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -p</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sdb                      <span class="token number">8</span>:16   <span class="token number">1</span> <span class="token number">29</span>.3G  <span class="token number">0</span> disk
â”œâ”€/dev/sdb1                   <span class="token number">8</span>:17   <span class="token number">1</span>   10G  <span class="token number">0</span> part /root/movie
â””â”€/dev/sdb2                   <span class="token number">8</span>:18   <span class="token number">1</span>    4G  <span class="token number">0</span> part /root/book<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="å¸è½½åˆ†åŒº-umount"><a href="#å¸è½½åˆ†åŒº-umount" class="headerlink" title="å¸è½½åˆ†åŒº umount"></a>å¸è½½åˆ†åŒº umount</h3><blockquote>
<p>æœ¬è´¨ä¸Šä¸Windowsä¸Šå¼¹å‡ºUç›˜(è®¾å¤‡)æ˜¯ä¸€æ ·é“ç†, åº•å±‚å°±æ˜¯å°†è¯¥è®¾å¤‡ä»æ–‡ä»¶æ ‘ä¸­åˆ é™¤.<br>å› æ­¤å¦‚æœæ“ä½œç³»ç»Ÿæ­£åœ¨è®¿é—®&#x2F;å ç”¨è¯¥è®¾å¤‡, ä¼šå¸è½½&#x2F;å¼¹å‡ºå¤±è´¥.</p>
</blockquote>
<p>å¸è½½æ–¹å¼: </p>
<ul>
<li>é€šè¿‡æŒ‚è½½ç‚¹å¸è½½</li>
<li>é€šè¿‡è®¾å¤‡åå¸è½½</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># umount -v /root/movie #é€šè¿‡æŒ‚è½½ç‚¹å¸è½½</span>
umount: /root/movie <span class="token punctuation">(</span>/dev/sdb1<span class="token punctuation">)</span> å·²å¸è½½
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># umount -v /dev/sdb2 #é€šè¿‡è®¾å¤‡åå¸è½½</span>
umount: /root/book <span class="token punctuation">(</span>/dev/sdb2<span class="token punctuation">)</span> å·²å¸è½½
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -p</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sdb                      <span class="token number">8</span>:16   <span class="token number">1</span> <span class="token number">29</span>.3G  <span class="token number">0</span> disk
â”œâ”€/dev/sdb1                   <span class="token number">8</span>:17   <span class="token number">1</span>   10G  <span class="token number">0</span> part
â””â”€/dev/sdb2                   <span class="token number">8</span>:18   <span class="token number">1</span>    4G  <span class="token number">0</span> part
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
æ–‡ä»¶ç³»ç»Ÿ                 å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
devtmpfs                 475M     <span class="token number">0</span>  475M    <span class="token number">0</span>% /dev
/dev/mapper/centos-root   17G  <span class="token number">1</span>.4G   16G    <span class="token number">9</span>% /
/dev/sda1               1014M  138M  877M   <span class="token number">14</span>% /boot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¸è½½ä¹‹å, é‡æ–°æŒ‚è½½:</p>
<ol>
<li>ä¸è¦æ±‚æ–°çš„æŒ‚è½½ç‚¹ä¸ä¹‹å‰ä¸€ç›´. ä¾‹å¦‚ä¹‹å‰<code>/dev/sdb2</code>æŒ‚è½½åˆ°<code>/root/book</code>ç›®å½•ä¸‹, å¸è½½ä¹‹åé‡æ–°æŒ‚è½½, <code>/dev/sdb2</code>å¯ä»¥æŒ‚è½½åˆ° <code>/root/movie</code> ç›®å½•ä¸‹</li>
<li>åˆ†åŒºé‡Œè¾¹çš„å†…å®¹ä»ç„¶æ˜¯ä¿ç•™çš„. ä¾‹å¦‚ <code>/dev/sdb2</code> åˆ†åŒºå¸è½½é‡æ–°æŒ‚è½½åˆ°å…¶ä»–ç›®å½•, è¯¥åˆ†åŒºä¸‹çš„å†…å®¹ä»ç„¶æ˜¯ä¿ç•™çš„, èƒ½ä»æ–°çš„ç›®å½•ä¸‹è®¿é—®åˆ°è¯¥å†…å®¹.</li>
</ol>
<h1 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h1><h2 id="ä¸ºç£ç›˜æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ"><a href="#ä¸ºç£ç›˜æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ä¸ºç£ç›˜æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ"></a>ä¸ºç£ç›˜æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="ä¸åˆ†åŒº-ç›´æ¥æ ¼å¼åŒ–æ•´ä¸ªè®¾å¤‡"><a href="#ä¸åˆ†åŒº-ç›´æ¥æ ¼å¼åŒ–æ•´ä¸ªè®¾å¤‡" class="headerlink" title="ä¸åˆ†åŒº, ç›´æ¥æ ¼å¼åŒ–æ•´ä¸ªè®¾å¤‡"></a>ä¸åˆ†åŒº, ç›´æ¥æ ¼å¼åŒ–æ•´ä¸ªè®¾å¤‡</h3><ul>
<li>å¦‚ä¸‹, ç›´æ¥æŠŠUç›˜æ ¼å¼åŒ–ä¸ºxfsæ–‡ä»¶ç³»ç»Ÿ, ä¹‹åä½¿ç”¨ <code>blkid</code> æŸ¥çœ‹è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹, ä½¿ç”¨<code>lsblk</code>åªèƒ½çœ‹åˆ°è¯¥è®¾å¤‡æ˜¯è£¸è®¾å¤‡: <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs -f /dev/sdb</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/sdb</span>
/dev/sdb: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"b3841552-6b45-4e76-980a-911a107fbade"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"xfs"</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -p</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      <span class="token number">8</span>:0    <span class="token number">0</span>   20G  <span class="token number">0</span> disk
â”œâ”€/dev/sda1                   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
â””â”€/dev/sda2                   <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
  â”œâ”€/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   17G  <span class="token number">0</span> lvm  /
  â””â”€/dev/mapper/centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
/dev/sdb                      <span class="token number">8</span>:16   <span class="token number">1</span> <span class="token number">29</span>.3G  <span class="token number">0</span> disk
/dev/sr0                     <span class="token number">11</span>:0    <span class="token number">1</span>  973M  <span class="token number">0</span> rom<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="åˆ†åŒº-æ ¼å¼åŒ–åˆ†åŒº"><a href="#åˆ†åŒº-æ ¼å¼åŒ–åˆ†åŒº" class="headerlink" title="åˆ†åŒº, æ ¼å¼åŒ–åˆ†åŒº"></a>åˆ†åŒº, æ ¼å¼åŒ–åˆ†åŒº</h3><ul>
<li><p>å¦‚ä¸‹, <code>/dev/sdb</code>Uç›˜åˆ†æˆ1ä¸ªåˆ†åŒº, ä½†ä¸å¯¹åˆ†åŒºè¿›è¡Œæ ¼å¼åŒ–, blkid æŸ¥çœ‹åˆ°çš„ä¿¡æ¯ä¸ºç©º</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># fdisk -l</span>
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            <span class="token number">2048</span>    <span class="token number">61439999</span>    <span class="token number">30718976</span>   <span class="token number">83</span>  Linux
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/sdb</span>
/dev/sdb: <span class="token assign-left variable">PTTYPE</span><span class="token operator">=</span><span class="token string">"dos"</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/sdb1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>å°†åˆ†åŒºæ ¼å¼åŒ–ä¹‹å, blkid æŸ¥çœ‹åˆ°å…·ä½“åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿç±»å‹ä¿¡æ¯:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs -f /dev/sdb1</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># blkid /dev/sdb1</span>
/dev/sdb1: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">"6c3bcc54-b925-4e3c-a101-6edf5ca28268"</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">"xfs"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="æ‰©å®¹-x2F-ç¼©å®¹åˆ†åŒº"><a href="#æ‰©å®¹-x2F-ç¼©å®¹åˆ†åŒº" class="headerlink" title="æ‰©å®¹&#x2F;ç¼©å®¹åˆ†åŒº"></a>æ‰©å®¹&#x2F;ç¼©å®¹åˆ†åŒº</h2><h3 id="æ™®é€šç±»å‹åˆ†åŒº"><a href="#æ™®é€šç±»å‹åˆ†åŒº" class="headerlink" title="æ™®é€šç±»å‹åˆ†åŒº"></a>æ™®é€šç±»å‹åˆ†åŒº</h3><p>å¯ä»¥æ— æŸæ‰©å®¹ç¼©å®¹ä¹ˆ? </p>
<h3 id="LVMç±»å‹"><a href="#LVMç±»å‹" class="headerlink" title="LVMç±»å‹"></a>LVMç±»å‹</h3><p>å‚ç…§: <a href="https://zhuanlan.zhihu.com/p/450057653">centos7æ‰©å®¹æ ¹ç›®å½•</a><br>è‡ªå·±ä½¿ç”¨çš„è™šæ‹Ÿæœºæ˜¯20Gç¡¬ç›˜. æƒ³è¦æ‰©å®¹ä¸‹æ ¹ç›®å½•, æ‰©å®¹åˆ°32G, å³å¦‚ä¸‹çš„ <code>MOUNTPOINT /</code>: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -p</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      <span class="token number">8</span>:0    <span class="token number">0</span>   20G  <span class="token number">0</span> disk
â”œâ”€/dev/sda1                   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
â””â”€/dev/sda2                   <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
  â”œâ”€/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   17G  <span class="token number">0</span> lvm  /
  â””â”€/dev/mapper/centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="VMWare-Fusionä¸­ä¿®æ”¹ç£ç›˜å¤§å°"><a href="#VMWare-Fusionä¸­ä¿®æ”¹ç£ç›˜å¤§å°" class="headerlink" title="VMWare Fusionä¸­ä¿®æ”¹ç£ç›˜å¤§å°"></a>VMWare Fusionä¸­ä¿®æ”¹ç£ç›˜å¤§å°</h4><p>æ“ä½œæ–¹å¼æ¯”è¾ƒç®€å•, ç›´æ¥åœ¨æ§åˆ¶é¢æ¿ä¿®æ”¹æ–‡ä»¶å¤§å°å³å¯.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202211222348543.png"></p>
<ul>
<li>è¯¥æ­¥éª¤ç»“æŸå, æ•ˆæœ:<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -p</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      <span class="token number">8</span>:0    <span class="token number">0</span>   32G  <span class="token number">0</span> disk
â”œâ”€/dev/sda1                   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
â””â”€/dev/sda2                   <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
  â”œâ”€/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   17G  <span class="token number">0</span> lvm  /
  â””â”€/dev/mapper/centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="å°†æ–°å¢çš„ç©ºé—´æ–°å»ºä¸€ä¸ªLVMç±»å‹åˆ†åŒº-fdisk"><a href="#å°†æ–°å¢çš„ç©ºé—´æ–°å»ºä¸€ä¸ªLVMç±»å‹åˆ†åŒº-fdisk" class="headerlink" title="å°†æ–°å¢çš„ç©ºé—´æ–°å»ºä¸€ä¸ªLVMç±»å‹åˆ†åŒº(fdisk)"></a>å°†æ–°å¢çš„ç©ºé—´æ–°å»ºä¸€ä¸ªLVMç±»å‹åˆ†åŒº(fdisk)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sda</span>
å‘½ä»¤<span class="token punctuation">(</span>è¾“å…¥ m è·å–å¸®åŠ©<span class="token punctuation">)</span>ï¼šn
Partition type:
   p   primary <span class="token punctuation">(</span><span class="token number">2</span> primary, <span class="token number">0</span> extended, <span class="token number">2</span> <span class="token function">free</span><span class="token punctuation">)</span>
   e   extended
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>:
Using default response p
åˆ†åŒºå· <span class="token punctuation">(</span><span class="token number">3,4</span>ï¼Œé»˜è®¤ <span class="token number">3</span><span class="token punctuation">)</span>ï¼š
èµ·å§‹ æ‰‡åŒº <span class="token punctuation">(</span><span class="token number">41943040</span>-67108863ï¼Œé»˜è®¤ä¸º <span class="token number">41943040</span><span class="token punctuation">)</span>ï¼š
å°†ä½¿ç”¨é»˜è®¤å€¼ <span class="token number">41943040</span>
Last æ‰‡åŒº, +æ‰‡åŒº or +size<span class="token punctuation">&#123;</span>K,M,G<span class="token punctuation">&#125;</span> <span class="token punctuation">(</span><span class="token number">41943040</span>-67108863ï¼Œé»˜è®¤ä¸º <span class="token number">67108863</span><span class="token punctuation">)</span>ï¼š
å°†ä½¿ç”¨é»˜è®¤å€¼ <span class="token number">67108863</span>
åˆ†åŒº <span class="token number">3</span> å·²è®¾ç½®ä¸º Linux ç±»å‹ï¼Œå¤§å°è®¾ä¸º <span class="token number">12</span> GiB

å‘½ä»¤<span class="token punctuation">(</span>è¾“å…¥ m è·å–å¸®åŠ©<span class="token punctuation">)</span>ï¼šp

ç£ç›˜ /dev/sdaï¼š34.4 GB, <span class="token number">34359738368</span> å­—èŠ‚ï¼Œ67108864 ä¸ªæ‰‡åŒº
Units <span class="token operator">=</span> æ‰‡åŒº of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
æ‰‡åŒºå¤§å°<span class="token punctuation">(</span>é€»è¾‘/ç‰©ç†<span class="token punctuation">)</span>ï¼š512 å­—èŠ‚ / <span class="token number">512</span> å­—èŠ‚
I/O å¤§å°<span class="token punctuation">(</span>æœ€å°/æœ€ä½³<span class="token punctuation">)</span>ï¼š512 å­—èŠ‚ / <span class="token number">512</span> å­—èŠ‚
ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šdos
ç£ç›˜æ ‡è¯†ç¬¦ï¼š0x000b7bb1

   è®¾å¤‡ Boot      Start         End      Blocks   Id  System
/dev/sda1   *        <span class="token number">2048</span>     <span class="token number">2099199</span>     <span class="token number">1048576</span>   <span class="token number">83</span>  Linux
/dev/sda2         <span class="token number">2099200</span>    <span class="token number">41943039</span>    <span class="token number">19921920</span>   8e  Linux LVM
/dev/sda3        <span class="token number">41943040</span>    <span class="token number">67108863</span>    <span class="token number">12582912</span>   <span class="token number">83</span>  Linux

å‘½ä»¤<span class="token punctuation">(</span>è¾“å…¥ m è·å–å¸®åŠ©<span class="token punctuation">)</span>ï¼št
åˆ†åŒºå· <span class="token punctuation">(</span><span class="token number">1</span>-3ï¼Œé»˜è®¤ <span class="token number">3</span><span class="token punctuation">)</span>ï¼š3
Hex ä»£ç <span class="token punctuation">(</span>è¾“å…¥ L åˆ—å‡ºæ‰€æœ‰ä»£ç <span class="token punctuation">)</span>ï¼šL
Hex ä»£ç <span class="token punctuation">(</span>è¾“å…¥ L åˆ—å‡ºæ‰€æœ‰ä»£ç <span class="token punctuation">)</span>ï¼š8e
å·²å°†åˆ†åŒºâ€œLinuxâ€çš„ç±»å‹æ›´æ”¹ä¸ºâ€œLinux LVMâ€

å‘½ä»¤<span class="token punctuation">(</span>è¾“å…¥ m è·å–å¸®åŠ©<span class="token punctuation">)</span>ï¼šw
The partition table has been altered<span class="token operator">!</span>
æ­£åœ¨åŒæ­¥ç£ç›˜ã€‚
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># partprobe</span>
Warning: æ— æ³•ä»¥è¯»å†™æ–¹å¼æ‰“å¼€ /dev/sr0 <span class="token punctuation">(</span>åªè¯»æ–‡ä»¶ç³»ç»Ÿ<span class="token punctuation">)</span>ã€‚/dev/sr0 å·²æŒ‰ç…§åªè¯»æ–¹å¼æ‰“å¼€ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>è¯¥æ­¥éª¤ç»“æŸå, æ•ˆæœå¦‚ä¸‹, çœ‹åˆ°å¤šäº†ä¸€å—åˆ†åŒº<code>/dev/sda3</code>, TODO: ä¸ºå•¥è¿™é‡Œçœ‹åˆ°çš„ç±»å‹è¿˜æ˜¯<code>part</code>??</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   32G  <span class="token number">0</span> disk
â”œâ”€sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
â”œâ”€sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
â”‚ â”œâ”€centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   17G  <span class="token number">0</span> lvm  /
â”‚ â””â”€centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
â””â”€sda3            <span class="token number">8</span>:3    <span class="token number">0</span>   12G  <span class="token number">0</span> part
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>  973M  <span class="token number">0</span> rom<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="å°†è¯¥LVMåˆ†åŒºæ·»åŠ åˆ°pv-groupä¸‹-å¹¶æ‰©å±•åŸæ¥çš„Logical-volume-å®ç°é€»è¾‘å·æ‰©å®¹"><a href="#å°†è¯¥LVMåˆ†åŒºæ·»åŠ åˆ°pv-groupä¸‹-å¹¶æ‰©å±•åŸæ¥çš„Logical-volume-å®ç°é€»è¾‘å·æ‰©å®¹" class="headerlink" title="å°†è¯¥LVMåˆ†åŒºæ·»åŠ åˆ°pv groupä¸‹, å¹¶æ‰©å±•åŸæ¥çš„Logical volume, å®ç°é€»è¾‘å·æ‰©å®¹"></a>å°†è¯¥LVMåˆ†åŒºæ·»åŠ åˆ°pv groupä¸‹, å¹¶æ‰©å±•åŸæ¥çš„Logical volume, å®ç°é€»è¾‘å·æ‰©å®¹</h4><ol>
<li><p>å°†è¯¥LVMåˆ†åŒºæ·»åŠ åˆ°pv groupä¸‹, <code>vgextend</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lvm</span>
lvm<span class="token operator">></span> pvcreate /dev/sda3
  Physical volume <span class="token string">"/dev/sda3"</span> successfully created.
lvm<span class="token operator">></span> pvdisplay
  --- Physical volume ---
  PV Name               /dev/sda2
  VG Name               centos
  PV Size               <span class="token operator">&lt;</span><span class="token number">19.00</span> GiB / not usable <span class="token number">3.00</span> MiB
  Allocatable           <span class="token function">yes</span> <span class="token punctuation">(</span>but full<span class="token punctuation">)</span>
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">4863</span>
  Free PE               <span class="token number">0</span>
  Allocated PE          <span class="token number">4863</span>
  PV UUID               xb72qt-XG0d-7jNA-VOEC-z3jt-y7bz-mtye35

  <span class="token string">"/dev/sda3"</span> is a new physical volume of <span class="token string">"12.00 GiB"</span>
  --- NEW Physical volume ---
  PV Name               /dev/sda3
  VG Name
  PV Size               <span class="token number">12.00</span> GiB
  Allocatable           NO
  PE Size               <span class="token number">0</span>
  Total PE              <span class="token number">0</span>
  Free PE               <span class="token number">0</span>
  Allocated PE          <span class="token number">0</span>
  PV UUID               f71O6u-tlAf-F2Cr-rTyy-zGcq-YqE2-PvO5Ri

lvm<span class="token operator">></span> vgdisplay 
  --- Volume group ---
  VG Name               centos
  System ID
  Format                lvm2
  Metadata Areas        <span class="token number">1</span>
  Metadata Sequence No  <span class="token number">3</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span class="token number">0</span>
  Cur LV                <span class="token number">2</span>
  Open LV               <span class="token number">2</span>
  Max PV                <span class="token number">0</span>
  Cur PV                <span class="token number">1</span>
  Act PV                <span class="token number">1</span>
  VG Size               <span class="token operator">&lt;</span><span class="token number">19.00</span> GiB
  PE Size               <span class="token number">4.00</span> MiB
  Total PE              <span class="token number">4863</span>
  Alloc PE / Size       <span class="token number">4863</span> / <span class="token operator">&lt;</span><span class="token number">19.00</span> GiB
  Free  PE / Size       <span class="token number">0</span> / <span class="token number">0</span>
  VG UUID               seZW4N-tjt9-C5Qg-UFYp-z0uY-TZgq-2F94Hd

lvm<span class="token operator">></span> vgextend centos /dev/sda3 <span class="token comment"># å°†è¯¥LVMåˆ†åŒºæ·»åŠ åˆ°pv groupä¸‹</span>
  Volume group <span class="token string">"centos"</span> successfully extended<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>æ‰©å±•åŸå§‹çš„Logical Volume, <code>lvextend</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lvm<span class="token operator">></span> lvdisplay
  --- Logical volume ---
  LV Path                /dev/centos/swap
  LV Name                swap
  VG Name                centos
  LV UUID                wltk2Z-WIJW-vB6N-en6c-z5kg-U1IV-MWF7iX
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> localhost, <span class="token number">2022</span>-10-22 07:51:02 -0400
  LV Status              available
  <span class="token comment"># open                 2</span>
  LV Size                <span class="token number">2.00</span> GiB
  Current LE             <span class="token number">512</span>
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">8192</span>
  Block device           <span class="token number">253</span>:1
lvm<span class="token operator">></span> lvextend -l +100%FREE /dev/centos/root
  Size of logical volume centos/root changed from <span class="token operator">&lt;</span><span class="token number">17.00</span> GiB <span class="token punctuation">(</span><span class="token number">4351</span> extents<span class="token punctuation">)</span> to <span class="token number">28.99</span> GiB <span class="token punctuation">(</span><span class="token number">7422</span> extents<span class="token punctuation">)</span>.
  Logical volume centos/root successfully resized.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>è¯¥æ­¥éª¤ç»“æŸå, æ•ˆæœå¦‚ä¸‹:</p>
</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -p</span>
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
/dev/sda                      <span class="token number">8</span>:0    <span class="token number">0</span>   32G  <span class="token number">0</span> disk
â”œâ”€/dev/sda1                   <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
â”œâ”€/dev/sda2                   <span class="token number">8</span>:2    <span class="token number">0</span>   19G  <span class="token number">0</span> part
â”‚ â”œâ”€/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   29G  <span class="token number">0</span> lvm  /
â”‚ â””â”€/dev/mapper/centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>    2G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
â””â”€/dev/sda3                   <span class="token number">8</span>:3    <span class="token number">0</span>   12G  <span class="token number">0</span> part
  â””â”€/dev/mapper/centos-root <span class="token number">253</span>:0    <span class="token number">0</span>   29G  <span class="token number">0</span> lvm  /<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="åŒæ­¥åˆ°æ–‡ä»¶ç³»ç»Ÿ-å®ç°æ ¹ç›®å½•æ‰©å®¹"><a href="#åŒæ­¥åˆ°æ–‡ä»¶ç³»ç»Ÿ-å®ç°æ ¹ç›®å½•æ‰©å®¹" class="headerlink" title="åŒæ­¥åˆ°æ–‡ä»¶ç³»ç»Ÿ, å®ç°æ ¹ç›®å½•æ‰©å®¹"></a>åŒæ­¥åˆ°æ–‡ä»¶ç³»ç»Ÿ, å®ç°æ ¹ç›®å½•æ‰©å®¹</h4><p>æ³¨æ„, è¿™é‡Œçš„ <code>/dev/centos/root</code> æ˜¯<code>Logical volume</code>çš„<code>LV Path</code>, å³ä½¿ç”¨ <code>lvdisplay</code> ä¹‹åæ˜¾ç¤ºçš„<code>LV Path</code><br>è€Œä¸æ˜¯ <code>/dev/mapper/centos-root</code> è¿™ä¸ªè·¯å¾„.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># xfs_growfs /dev/centos/root</span>
meta-data<span class="token operator">=</span>/dev/mapper/centos-root <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">1113856</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">spinodes</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">4455424</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal               <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>
data blocks changed from <span class="token number">4455424</span> to <span class="token number">7600128</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>è¯¥æ­¥éª¤ç»“æŸå, æ•ˆæœå¦‚ä¸‹: <pre class="line-numbers language-none"><code class="language-none">[root@localhost ~]# lsblk -p
NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
&#x2F;dev&#x2F;sda                      8:0    0   32G  0 disk
â”œâ”€&#x2F;dev&#x2F;sda1                   8:1    0    1G  0 part &#x2F;boot
â”œâ”€&#x2F;dev&#x2F;sda2                   8:2    0   19G  0 part
â”‚ â”œâ”€&#x2F;dev&#x2F;mapper&#x2F;centos-root 253:0    0   29G  0 lvm  &#x2F;
â”‚ â””â”€&#x2F;dev&#x2F;mapper&#x2F;centos-swap 253:1    0    2G  0 lvm  [SWAP]
â””â”€&#x2F;dev&#x2F;sda3                   8:3    0   12G  0 part
  â””â”€&#x2F;dev&#x2F;mapper&#x2F;centos-root 253:0    0   29G  0 lvm  &#x2F;

[root@localhost ~]# df -h
æ–‡ä»¶ç³»ç»Ÿ                 å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
&#x2F;dev&#x2F;mapper&#x2F;centos-root   29G  1.4G   28G    5% &#x2F;
&#x2F;dev&#x2F;sda1               1014M  138M  877M   14% &#x2F;boot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="æ€»ç»“-amp-æ€è€ƒ"><a href="#æ€»ç»“-amp-æ€è€ƒ" class="headerlink" title="æ€»ç»“&amp;æ€è€ƒ"></a>æ€»ç»“&amp;æ€è€ƒ</h1><p>æ·±åˆ»ä½“ä¼šåˆ°äº†ç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿçš„å…³ç³», å¦‚çŸ¥ä¹æŸä½å¤§ç¥æ‰€è¨€, <strong>æ ¹æœ¬æ²¡æœ‰å…³ç³»!</strong> </p>
<ul>
<li>ä¸€ä¸ªç£ç›˜(å—è®¾å¤‡)å¯ä»¥åˆ†ä¸ºå¤šä¸ªåˆ†åŒº, æ¯ä¸ªåˆ†åŒºéƒ½å¯ä»¥åˆ†åˆ«æ ¼å¼åŒ–ä¸ºä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿ, ç„¶ååˆ†åˆ«æŒ‚è½½åœ¨ä¸åŒçš„ç›®å½•ä¸‹.</li>
<li>è£¸è®¾å¤‡ä¹Ÿå¯ä»¥ä¸åˆ†åŒº, ç›´æ¥æ ¼å¼åŒ–ä¸ºæ–‡ä»¶ç³»ç»Ÿ.</li>
<li>æ–‡ä»¶ç³»ç»Ÿé‡Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä½œä¸º(è™šæ‹ŸåŒ–ä¸º)ä¸€ä¸ªå—è®¾å¤‡ä½¿ç”¨ </li>
<li>å¤šä¸ªç£ç›˜&#x2F;å¤šä¸ªåˆ†åŒºä¹Ÿå¯ä»¥å…±åŒç»„æˆä¸€ä¸ªè®¾å¤‡, è¯¥è®¾å¤‡ä½¿ç”¨ä¸€ä¸ªåˆ†åŒº&#x2F;æ–‡ä»¶ç³»ç»Ÿç±»å‹.</li>
</ul>
<p>TODO: </p>
<ol>
<li>ç ”ç©¶ä¸‹LVMå§, ä¸æ±‚æºç çº§åˆ«çš„æ·±å…¥, ä½†åŸç†ä¸å®è·µéœ€è¦è·Ÿä¸Š.</li>
<li>åˆ†åŒºä¸æ–‡ä»¶ç³»ç»Ÿæ ¼å¼æ–¹æ¡ˆçš„æœ€ä½³å®è·µæ˜¯å•¥?</li>
</ol>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://linux.cn/article-10194-1.html">å¦‚ä½•åœ¨ Linux ä¸­æŸ¥çœ‹å·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/450057653">centos7æ‰©å®¹æ ¹ç›®å½•ï¼ˆ&#x2F;dev&#x2F;mapper&#x2F;centos-rootï¼‰</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>Linuxå¸¸ç”¨å‘½ä»¤</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>disk</tag>
        <tag>os</tag>
        <tag>file-system</tag>
      </tags>
  </entry>
  <entry>
    <title>2023 å¹´åº¦ä¹¦å•</title>
    <url>//2022-12-31-booklist-for-2023/</url>
    <content><![CDATA[<h1 id="BookList"><a href="#BookList" class="headerlink" title="BookList"></a>BookList</h1><hr>
<h2 id="å¿…è¯»"><a href="#å¿…è¯»" class="headerlink" title="å¿…è¯»"></a>å¿…è¯»</h2><h3 id="è®¡ç®—æœº"><a href="#è®¡ç®—æœº" class="headerlink" title="è®¡ç®—æœº"></a>è®¡ç®—æœº</h3><ul>
<li><input disabled="" type="checkbox"> Google 4ç¯‡è®ºæ–‡å¤ä¹  GFS MapReduce BigTable Dapper</li>
<li><input disabled="" type="checkbox"> <a href="https://github.com/yanfeizhang/coder-kung-fu">æ·±å…¥ç†è§£Linuxç½‘ç»œ</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/3998926/">ç³»ç»Ÿåˆ†æå¸ˆè€ƒè¯•å…¨ç¨‹æŒ‡å¯¼</a></li>
<li><input disabled="" type="checkbox"> <a href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E5%B8%88%E6%95%99%E7%A8%8B/8182174">ç³»ç»Ÿåˆ†æå¸ˆæ•™ç¨‹</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/26643785/">æ·±åº¦æ¢ç´¢åµŒå…¥å¼æ“ä½œç³»ç»Ÿï¼šä»é›¶å¼€å§‹è®¾è®¡ã€æ¶æ„å’Œå¼€å‘</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/11530329/">30å¤©è‡ªåˆ¶æ“ä½œç³»ç»Ÿ</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/27091064/">äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µâ€”â€”ä»å•ä½“åˆ°æœåŠ¡åŒ–æ¶æ„æ¼”è¿›</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/35731316/">æ–‡ä»¶ç³»ç»ŸæŠ€æœ¯å†…å¹•</a> <a href="https://www.bilibili.com/video/av889477532/">Bç«™è§†é¢‘</a></li>
</ul>
<h3 id="ç»æµ"><a href="#ç»æµ" class="headerlink" title="ç»æµ"></a>ç»æµ</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/25926542/">ä¸€æœ¬ä¹¦è¯»æ‡‚è´¢æŠ¥</a> -20230125</li>
</ul>
<h3 id="å¥åº·"><a href="#å¥åº·" class="headerlink" title="å¥åº·"></a>å¥åº·</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/27104999/">ç™Œç—‡æ–°çŸ¥: ç§‘å­¦ç»ˆç»“ææ…Œ</a> -20230119</li>
</ul>
<h3 id="å†å²ç¤¾ç§‘"><a href="#å†å²ç¤¾ç§‘" class="headerlink" title="å†å²ç¤¾ç§‘"></a>å†å²ç¤¾ç§‘</h3><ul>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/26943161/">æœªæ¥ç®€å²</a></li>
</ul>
<h3 id="éŸ³ä¹"><a href="#éŸ³ä¹" class="headerlink" title="éŸ³ä¹"></a>éŸ³ä¹</h3><ul>
<li><input disabled="" type="checkbox"> <a href="https://www.amazon.com/Harmony-Fifth-Walter-Piston/dp/0393954803">Harmony by Walter Piston</a></li>
</ul>
<h3 id="é€šè¯†"><a href="#é€šè¯†" class="headerlink" title="é€šè¯†"></a>é€šè¯†</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="https://clauswilke.com/dataviz/">Fundamentals of Data Visualization</a></li>
<li><input disabled="" type="checkbox"> <a href="https://bookdown.org/yihui/rmarkdown/">R Markdown: The Definitive Guide</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/27175636/">æ•°æ®åˆ†ææ€ç»´: äº§å“ç»ç†çš„æˆé•¿ç¬”è®°</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/27108685/">ç”¨æ•°æ®è®²æ•…äº‹ (è±†ç“£)</a> -20230718 done</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/34922776/">ä»£ç ç²¾è¿›ä¹‹è·¯ ä»ç å†œåˆ°å·¥åŒ  (è±†ç“£)</a> -20230629 done</li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/24381562/">ç»Ÿè®¡æ€ç»´ (è±†ç“£)</a> -doing</li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/35426737/">å´å†›æ•°å­¦é€šè¯†è®²ä¹‰</a></li>
<li><input disabled="" type="checkbox"> <a href="https://zhuanlan.zhihu.com/p/543113943">è°·æ­Œæ–¹æ³•è®º</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="">ç¡…è°·æ¥ä¿¡</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/26115203/">æƒè¡¡ï¼šæ‰¹åˆ¤æ€§æ€ç»´ä¹‹æ¢ç©¶é€”å¾„</a></li>
<li><input disabled="" type="checkbox"> <a href="http://hongchaozhang.github.io/blog/2019/08/26/infomation-theory/">ä¿¡æ¯è®º40è®²</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/35590821/">ã€Œå›¾è§£ã€äº§å“ï¼šäº§å“ç»ç†ä¸šåŠ¡è®¾è®¡ä¸ UML å»ºæ¨¡</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/26593654/">The Open Organization</a></li>
</ul>
<h3 id="å°è¯´"><a href="#å°è¯´" class="headerlink" title="å°è¯´"></a>å°è¯´</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/26957420/">ä¸´é«˜å¯æ˜</a> -20230418</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/36069426/">å¤§åŒ»-ç ´æ™“ç¯‡</a> -20230703</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/36104107/">é•¿å®‰çš„è”æ</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/30414743/">æ˜¾å¾®é•œä¸‹çš„å¤§æ˜</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/11524204/">å›´åŸ</a> -20230508</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://m.douban.com/book/subject/26876438/">äººé—´è‰æœ¨</a> -20230521</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/36328704/">å¤ªç™½é‡‘æ˜Ÿæœ‰ç‚¹çƒ¦ (è±†ç“£)</a> -20230709</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/26365250/">æ­»äººç» (è±†ç“£)</a> -20230808</li>
</ul>
<h2 id="é€‰è¯»"><a href="#é€‰è¯»" class="headerlink" title="é€‰è¯»"></a>é€‰è¯»</h2><ul>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/4163938/">è½¯ä»¶éšæƒ³å½•</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://book.douban.com/subject/36082349/">Chip War</a> -20230517 done</li>
<li><input disabled="" type="checkbox"> <a href="https://www.amazon.com/Only-Paranoid-Survive-Exploit-Challenge/dp/0385483821">Only the paranoid survive</a></li>
<li><input disabled="" type="checkbox"> <a href="https://book.douban.com/subject/1313875/">The Innovatorâ€™s Dilemma</a> -doing</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://www.amazon.com/-/es/Sid-Meier/dp/1324005874">Sid Meierâ€™s Memoir!: A Life in Computer Games</a> -20230625 done</li>
</ul>
<h1 id="ThesisList"><a href="#ThesisList" class="headerlink" title="ThesisList"></a>ThesisList</h1><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="https://www.alibabacloud.com/blog/a-paper-on-rund-a-lightweight-secure-container-runtime-for-high-density-deployment-and-high-concurrency-startup-in-serverless-computing_599753">A Paper on RunD: A Lightweight Secure Container Runtime for High-density Deployment and High-concurrency Startup in Serverless Computing - Alibaba Cloud Community</a> -20230912 done</li>
</ul>
<h1 id="ReadList"><a href="#ReadList" class="headerlink" title="ReadList"></a>ReadList</h1><hr>
<ul>
<li><input checked="" disabled="" type="checkbox"> <a href="https://mp.weixin.qq.com/s/EUAN-w14moJiQ0oVUTCtgQ">å¦‚ä½•å†™å‡ºä¸€ä»½ä¼˜ç§€çš„è®¾è®¡æ–‡æ¡£</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://mp.weixin.qq.com/s/YdoxVxz_91ZFemF8JuxRvQ">Koordinator 0.6ï¼šä¼ä¸šçº§å®¹å™¨è°ƒåº¦ç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼Œå¼•å…¥ CPU ç²¾ç»†ç¼–æ’ã€èµ„æºé¢„ç•™ä¸å…¨æ–°çš„é‡è°ƒåº¦æ¡†æ¶</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://mp.weixin.qq.com/s/_ehHZfBo9A6_oq5RaA57Vw">æºæ‰‹15å¹´ï¼Œè¯­é›€åˆ›å§‹äººç‰ä¼¯ä»èš‚èšç¦»èŒï¼Œé€‰æ‹©ä¸€ä¸ªäººè¿œè¡Œ</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://zhuanlan.zhihu.com/p/590569755">å¤§å‚ç—…ï¼šç©¿å ‚é£å’Œå¹³æµå±‚ - çŸ¥ä¹</a></li>
</ul>
<h1 id="MovieList"><a href="#MovieList" class="headerlink" title="MovieList"></a>MovieList</h1><hr>
<h2 id="å­¦ä¹ "><a href="#å­¦ä¹ " class="headerlink" title="å­¦ä¹ "></a>å­¦ä¹ </h2><ul>
<li><input disabled="" type="checkbox"> <a href="https://www.bilibili.com/video/BV1qa4y1j7xk/">2020 å—äº¬å¤§å­¦è®¡ç®—æœºç³»ç»ŸåŸºç¡€ä¹ é¢˜è¯¾ (è’‹ç‚å²©)</a></li>
<li><input disabled="" type="checkbox"> <a href="https://www.bilibili.com/video/BV1sR4y1V7T4/">2022 å—äº¬å¤§å­¦æ‹”å°–è®¡åˆ’ã€Šæ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°ã€‹</a></li>
<li><input disabled="" type="checkbox"> <a href="https://www.bilibili.com/video/av889477532/">æ–‡ä»¶ç³»ç»ŸæŠ€æœ¯å†…å¹• Bç«™è§†é¢‘</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://time.geekbang.org/column/intro/460?utm_term=zeusXD30A&utm_source=geektime&utm_medium=geektime&utm_campaign=100099801&utm_content=text&tab=comment">éƒ­ä¸œç™½çš„æ¶æ„è¯¾</a> -20230718 done</li>
<li><input disabled="" type="checkbox"> <a href="https://www.khanacademy.org/economics-finance-domain/ap-microeconomics/basic-economic-concepts/resource-allocation-and-economic-systems/v/property-rights-in-a-market-system">Microeconomics | Khan Academy</a></li>
</ul>
<h2 id="å¨±ä¹"><a href="#å¨±ä¹" class="headerlink" title="å¨±ä¹"></a>å¨±ä¹</h2><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="https://movie.douban.com/subject/35465232/">ç‹‚é£™</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://movie.douban.com/subject/35465011/">æ˜¾å¾®é•œä¸‹çš„å¤§æ˜ä¹‹ä¸ç»¢æ¡ˆ</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://movie.douban.com/subject/35208467/">æƒ³è§ä½  æƒ³è¦‹ä½  (2022)</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://m.douban.com/movie/subject/36193784/">é»‘æš—è£è€€ç¬¬äºŒå­£</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://movie.douban.com/subject/35588177/">æ¼«é•¿çš„å­£èŠ‚</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://movie.douban.com/subject/26955946/">å®‰çœ ä¹¦åº—</a> -ing</li>
<li><input disabled="" type="checkbox"> <a href="https://movie.douban.com/subject/35609387/">çŒé­”äºº ç¬¬ä¸‰å­£ (è±†ç“£)</a> -ing</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://movie.douban.com/subject/35506348/">ç™½è²èŠ±åº¦å‡æ‘ ç¬¬ä¸€å­£ (è±†ç“£)</a></li>
</ul>
<h1 id="Games"><a href="#Games" class="headerlink" title="Games"></a>Games</h1><hr>
<ul>
<li><a href="https://www.douban.com/game/27185974/">DriveClub VR</a></li>
</ul>
<h1 id="Certificates"><a href="#Certificates" class="headerlink" title="Certificates"></a>Certificates</h1><hr>
<ul>
<li><strong>è½¯è€ƒé«˜çº§ç³»ç»Ÿæ¶æ„è®¾è®¡å¸ˆ</strong></li>
<li>CKA</li>
<li>IELTS</li>
</ul>
<h1 id="Blogs"><a href="#Blogs" class="headerlink" title="Blogs"></a>Blogs</h1><ul>
<li>Jenkins Core&amp;Cloudç³»åˆ—åšå®¢</li>
</ul>
<h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><ul>
<li><a href="https://github.com/AmruthPillai/Reactive-Resume">å¼€æºç®€å†ç”Ÿæˆå™¨</a></li>
<li><a href="https://github.com/sb2nov/resume">Latexç®€å†æ¨¡æ¿</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>ä¹¦å•</category>
      </categories>
      <tags>
        <tag>books</tag>
        <tag>2023</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‹è¯é›†é”¦&amp;èµæ</title>
    <url>//2023-02-08-songci/</url>
    <content><![CDATA[<h1 id="è¡Œé¦™å­Â·è¿‡ä¸ƒé‡Œæ¿‘"><a href="#è¡Œé¦™å­Â·è¿‡ä¸ƒé‡Œæ¿‘" class="headerlink" title="è¡Œé¦™å­Â·è¿‡ä¸ƒé‡Œæ¿‘"></a>è¡Œé¦™å­Â·è¿‡ä¸ƒé‡Œæ¿‘</h1><p>å®‹ Â· è‹è½¼<br>ä¸€å¶èˆŸè½»ï¼ŒåŒæ¡¨é¸¿æƒŠã€‚æ°´å¤©æ¸…ã€å½±æ¹›æ³¢å¹³ã€‚é±¼ç¿»è—»é‰´ï¼Œé¹­ç‚¹çƒŸæ±€ã€‚è¿‡æ²™æºªæ€¥ï¼Œéœœæºªå†·ï¼Œæœˆæºªæ˜ã€‚<br>é‡é‡ä¼¼ç”»ï¼Œæ›²æ›²å¦‚å±ã€‚ç®—å½“å¹´ã€è™šè€ä¸¥é™µã€‚å›è‡£ä¸€æ¢¦ï¼Œä»Šå¤ç©ºåã€‚ä½†è¿œå±±é•¿ï¼Œäº‘å±±ä¹±ï¼Œæ™“å±±é’ã€‚</p>
<p>è¿™é¦–è¯ä½œäºå…¬å…ƒ1073å¹´ï¼ˆå®‹ç¥å®—ç†™å®å…­å¹´ï¼‰æ˜¥äºŒæœˆã€‚è‹è½¼æ—¶ä»»æ­å·é€šåˆ¤ï¼Œå·¡æŸ¥å¯Œé˜³ï¼Œç”±æ–°åŸè‡³æ¡åºï¼Œä¹˜èˆŸå¯Œæ˜¥æ±Ÿï¼Œç»è¿‡ä¸ƒé‡Œæ¿‘æ—¶ä½œæ­¤è¯ã€‚</p>
<p>ä¸ƒé‡Œæ¿‘ï¼šåˆåä¸ƒé‡Œæ»©ã€ä¸ƒé‡Œæ³·ï¼Œåœ¨ä»Šæµ™æ±Ÿçœæ¡åºå¿åŸå—ä¸‰åé‡Œã€‚é’±å¡˜æ±Ÿä¸¤å²¸å±±å³¦å¤¹å³™ï¼Œæ°´æµæ¹æ€¥ï¼Œè¿ç»µä¸ƒé‡Œï¼Œæ•…åä¸ƒé‡Œæ¿‘ã€‚æ¿‘ï¼Œæ²™çŸ³ä¸Šæµè¿‡çš„æ€¥æ°´ã€‚</p>
<p>ä¸¥é™µï¼šå³ä¸¥å…‰ï¼Œå­—å­é™µï¼Œä¸œæ±‰äººï¼Œæ›¾ä¸<a href="https://so.gushiwen.cn/authorv_0ef2b626111d.aspx">åˆ˜ç§€</a>åŒå­¦ï¼Œå¹¶å¸®åŠ©åˆ˜ç§€æ‰“å¤©ä¸‹ã€‚åˆ˜ç§€ç§°å¸åï¼Œä»–æ”¹åéšå±…ã€‚åˆ˜ç§€ä¸‰æ¬¡æ´¾äººæ‰æŠŠä»–å¬åˆ°äº¬å¸ˆã€‚æˆè°è®®å¤§å¤«ï¼Œä»–ä¸è‚¯æ¥å—ï¼Œå½’éšå¯Œæ˜¥æ±Ÿï¼Œç»ˆæ—¥é’“é±¼ã€‚</p>
<p>æ¥ä¸‹æ¥â€œè¿‡æ²™æºªæ€¥ï¼Œéœœæºªå†·ï¼Œæœˆæºªæ˜â€ä¸‰å¥ï¼ŒèŠ‚å¥è½»å¿«ã€‚æ²™æºªï¼Œæ˜¯ç™½å¤©ä¹‹æºªï¼Œæ¸…æ¾ˆè€Œè§æ²™åº•ï¼›éœœæºªï¼Œæ˜¯æ¸…æ™“ä¹‹æºªï¼Œæ¸…å†·è€Œæœ‰éœœæ„ï¼›æœˆæºªï¼Œä¹ƒæ˜¯æœˆä¸‹ä¹‹æºªï¼Œæ˜¯æ˜äº®çš„æ°´æ™¶ä¸–ç•Œã€‚è¯äººç”¨è’™å¤ªå¥‡æ‰‹æ³•ï¼Œå‰ªæ¥äº†ä¸‰ä¸ªä¸åŒæ—¶è¾°çš„èˆŸè¡Œä¹‹æ™¯ã€‚æ—¢å†™å‡ºäº†èˆ¹ä¹‹è¡Œç¨‹ï¼Œä¹Ÿåˆ›é€ å‡ºæ¸…å¯’å‡„ç¾çš„æ„å¢ƒï¼Œç”±æ­¤å¼•å‡ºä¸€è‚¡äººç”Ÿçš„å†µå‘³ï¼Œä¸ºä¸‹ç‰‡æŠ’å†™äººç”Ÿæ„Ÿæ…¨ä½œäº†é“ºå«ã€‚</p>
<p>â€œç®—å½“å¹´ï¼Œè™šè€ä¸¥é™µã€‚â€ä¸œæ±‰åˆå¹´çš„ä¸¥å­é™µï¼Œéšå±…ä¸ä»•ï¼Œå‚é’“å¯Œæ˜¥æ±Ÿä¸Šã€‚æ˜”äººå¤šè¯´ä¸¥å…‰å‚é’“å®æ˜¯â€œé’“åâ€ï¼Œä¸œå¡åœ¨æ­¤ï¼Œä¹Ÿç¬‘ä¸¥å…‰å½“å¹´ç™½ç™½åœ¨æ­¤ç»ˆè€ï¼Œä¸æ›¾çœŸæ­£é¢†ç•¥åˆ°å±±æ°´ä½³å¤„ã€‚â€œå›è‡£ä¸€æ¢¦ï¼Œä»Šå¤ç©ºåâ€ï¼Œè¡¨è¾¾å‡ºæµ®ç”Ÿè‹¥æ¢¦çš„æ„Ÿæ…¨ï¼šçš‡å¸å’Œéšå£«ï¼Œè€Œä»Šä¹Ÿå·²å¦‚æ¢¦ä¸€èˆ¬æ¶ˆå¤±ï¼Œåªç•™ä¸‹ç©ºåè€Œå·²ã€‚é‚£ä¹ˆçœŸæ­£èƒ½æ°¸æ’ç•™ä¼ çš„å®ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿâ€œä½†è¿œå±±é•¿ï¼Œäº‘å±±ä¹±ï¼Œæ™“å±±é’ã€‚â€åªæœ‰è¿œå±±è¿ç»µï¼Œé‡å³¦å å¶‚ï¼›å±±é—´ç™½äº‘ï¼Œç¼­ç»•å˜å½¢ï¼›æ™“å±±æ™¨æ›¦ï¼Œé’ç¿ æ¬²æ»´ã€‚æ„æ€æ˜¯è¯´ï¼Œåªæœ‰å¤§è‡ªç„¶æ‰æ˜¯æ°¸æ’çš„ï¼Œåªæœ‰å¤§è‡ªç„¶ä¹‹ç¾æ‰æ˜¯æ°¸æ’çš„ã€‚è¿™æ˜¯<a href="https://so.gushiwen.cn/authorv_3b99a16ff2dd.aspx">è‹è½¼</a>çš„ä¸€è´¯æ€æƒ³ï¼Œæ­£å¦‚ä»–åœ¨ã€Šå‰èµ¤å£èµ‹ã€‹ä¸­æ‰€æ„Ÿå¹çš„ï¼šâ€œæƒŸæ±Ÿä¸Šä¹‹æ¸…é£ï¼Œä¸å±±é—´ä¹‹æ˜æœˆï¼Œè€³å¾—ä¹‹è€Œä¸ºå£°ï¼Œç›®é‡ä¹‹è€Œæˆè‰²ï¼Œå–ä¹‹æ— ç¦ï¼Œç”¨ä¹‹ä¸ç«­â€¦â€¦â€</p>
<hr>
<h1 id="ä¸´å®‰æ˜¥é›¨åˆéœ"><a href="#ä¸´å®‰æ˜¥é›¨åˆéœ" class="headerlink" title="ä¸´å®‰æ˜¥é›¨åˆéœ"></a>ä¸´å®‰æ˜¥é›¨åˆéœ</h1><p>å®‹ Â· é™†æ¸¸</p>
<p>ä¸–å‘³å¹´æ¥è–„ä¼¼çº±ï¼Œè°ä»¤éª‘é©¬å®¢äº¬åã€‚<br>å°æ¥¼ä¸€å¤œå¬æ˜¥é›¨ï¼Œæ·±å··æ˜æœå–æèŠ±ã€‚<br>çŸ®çº¸æ–œè¡Œé—²ä½œè‰ï¼Œæ™´çª—ç»†ä¹³æˆåˆ†èŒ¶ã€‚<br>ç´ è¡£è«èµ·é£å°˜å¹ï¼ŒçŠ¹åŠæ¸…æ˜å¯åˆ°å®¶ã€‚</p>
<p>å­©å„¿å··é‡Œçš„å—å®‹æ…¢ç”Ÿæ´»</p>
<p>æˆ‘ä»¬çš„æ•…äº‹ä»æ­åŸé—¹å¸‚åŒºçš„ä¸€å¹¢å°æ¥¼è¯´èµ·ã€‚</p>
<p>å—å®‹åå®‰ä¸€éš…ï¼Œä¸´å®‰åŸçš„äººä»¬æœ‰äº†çŸ­æš‚çš„æ…¢ç”Ÿæ´»æ—¶å…‰ã€‚é™†æ¸¸åœ¨èµ·èµ·ä¼ä¼çš„ä»•é€”ä¸­é—´ï¼Œä¹Ÿå¾—ä»¥é’±å¡˜æ±Ÿè¾¹è§‚æ½®ã€è¥¿å­æ¹–ä¸Šæ³›èˆŸã€å†·æ³‰äº­ä¸­é¥®é…’ã€æ·±å··å°æ¥¼æˆåˆ†èŒ¶ã€‚æœ€è®©å¦‚ä»Šæ­å·äººä¹é“çš„è«è¿‡äºä»–å’Œä¸€æ¡å°å··ä¸€åº§å°æ¥¼çš„ä¼ è¯´ã€‚</p>
<p>å­©å„¿å··98å·ï¼Œé™†æ¸¸å›åˆ°æ­å·åšå†›å™¨å°‘ç›‘ï¼Œå°±å¯“å±…äºè¿™å¹¢å°æ¥¼é‡Œï¼Œè€Œä»–åŠå…¬çš„åœ°æ–¹ä½äºç°åœ¨çš„ç™¾äº•åŠå··ä¸€å¸¦ï¼Œæ¯å¤©ä»–æˆ–èµ°è·¯æˆ–ä¹˜è½¿æˆ–éª‘é©¬å»ä¸Šç­ã€‚</p>
<p>å°æ¥¼ç°åœ¨æ˜¯é™†æ¸¸çºªå¿µé¦†ï¼Œç™½å¢™é»›ç“¦ï¼Œå²æœˆæ–‘é©³çš„ç—•è¿¹å¾ˆæ˜¾çœ¼ï¼Œè¿™é‡Œè™½ç„¶æ˜¯æ¸…æœ«å»ºç­‘ï¼Œæ²¡æœ‰ç•™ä¸‹ä»–çš„ä»»ä½•ç—•è¿¹ï¼Œä½†ä¸€é¦–ã€Šä¸´å®‰æ˜¥é›¨åˆéœã€‹è¶³çŸ£ã€‚</p>
<p>å¤„äºé—¹å¸‚ä¸­çš„å­©å„¿å··å½“æ—¶ç”šæ˜¯çƒ­é—¹ã€‚ä¸ƒå¤•ï¼Œå­©å­ä»¬ä¼šä¹°æ³¥åœŸåšçš„ç©å…·ï¼Œæ‰‹æŒæ–°é²œçš„è·å¶å¬‰æˆï¼›é™¤å¤•ï¼Œå®¶åº­ä¸»å¦‡ä»¬ä¼šåœ¨ä¾›æ¡Œä¸Šæ‘†æ”¾æ³¥å¨ƒå¨ƒï¼Œç”¨çº¢è‰²çš„ç»’çº¿ç»™æ³¥å¨ƒå¨ƒç³»ä¸€ä¸ªé’±å¸ï¼Œä»¥æ±‚æ—©ç”Ÿè´µå­ï¼›å¹³æ—¥é‡Œï¼Œè¿™æ¡å··å­å°±æˆäº†æ“…é•¿æå¡‘æ³¥å­©å„¿çš„æ°‘é—´è‰ºäººçš„å¤©å ‚ï¼Œæ³¥å¶é“ºå­ç”šå¤šï¼Œä¸”ç”Ÿæ„å…´éš†ã€‚æ‰€ä»¥å“ªæ€•æ˜¯é™†æ¸¸å¤œç­åå›åˆ°å°æ¥¼ï¼Œå··å­ä¹Ÿæ˜¯â€œè¿‘åŠç¯ç«å¦‚æ˜¼æ˜ï¼Œåé‡Œä¸œé£å¹å¸‚å£°ã€‚â€</p>
<p>åˆæ˜¥ï¼Œæ·…æ·…æ²¥æ²¥çš„é›¨å£°æµ¸æ»¡äº†äºŒæ¥¼çš„ä¹¦æˆ¿ï¼Œ â€œå°æ¥¼ä¸€å¤œå¬æ˜¥é›¨ï¼Œæ·±å··æ˜æœå–æèŠ±ã€‚çŸ®çº¸æ–œè¡Œé—²ä½œè‰ï¼Œæ™´çª—ç»†ä¹³æˆåˆ†èŒ¶ã€‚â€è™½ç„¶è¯—ã€é…’ã€èŠ±ã€èŒ¶ä¸€åº”ä¿±å…¨ï¼Œä½†é™†æ¸¸éš¾ä»¥å…¥çœ ï¼Œå› ä¸ºä»–èŠ±ç”²ä¹‹å¹´è¿˜æ²¡å®ç°è‡ªå·±çš„è‹±é›„æ¢¦â€”â€”â€œä¸Šé©¬å‡»ç‹‚èƒ¡,ä¸‹é©¬è‰å†›ä¹¦â€ï¼Œæ”¶å¤ä¸­åŸã€‚</p>
<p>æ®å²æ–™è®°è½½ï¼Œé™†æ¸¸ä¸€ç”Ÿå¤šæ¬¡æ¥æ­ï¼Œå¹¶å±…ä½åœ¨ä¿å’ŒåŠï¼Œå®‹æ—¶çš„ä¿å’ŒåŠå°±æ˜¯ç°åœ¨çš„å­©å„¿å··ï¼Œä¿—ç§°ç –è¡—å··ã€‚åœ¨é™†æ¸¸çš„çœ¼ä¸­ï¼Œå­©å„¿å··æ˜¯æå¯Œè¯—æ„çš„ï¼šå¤œè‰²ç¿çƒ‚ã€é™å¯‚å¦‚é‡ã€‚â€œè¿‘åŠç¯ç«å¦‚æ˜¼æ˜ï¼Œåé‡Œæ€é£å¹å¸‚å£°â€ã€â€œè°å®¶å°æ¥¼æ­Œæ¼ä¾¬ï¼Œä½™å“ç¼¥ç¼ˆè¦å¸˜æ Šã€‚â€ç­‰è¯—å¥å°±æ˜¯é™†æ¸¸ç¬”ä¸‹çš„å­©å„¿å··ã€‚è¿™ä½æ·±åˆ‡å…³æ³¨å›½å®¶å‘½è¿çš„è±ªè¿ˆè¯—äººï¼Œç«Ÿå°†å­©å„¿å··çš„å¸‚äº•é£è²Œè§‚å¯Ÿã€æå†™å¾—å¦‚æ­¤ç”ŸåŠ¨ï¼Œå®ä¸ºä¸æ˜“ï¼Œé™†æ¸¸ä¸ºå­©å„¿å··çš„ä¼ ç¥å†™ç…§ï¼Œä¸€ç›´æµä¼ è‡³ä»Šã€‚</p>
<p>å­©å„¿å··çš„é‡è¦å†å²æ–‡åŒ–ä»·å€¼ï¼Œè¿˜åœ¨äºå—å®‹çˆ±å›½è¯—äººé™†æ¸¸æ›¾å†™ä¸‹äº†åé—»éè¿©çš„ä¸æœ½è¯—ç¯‡ï¼šâ€œä¸–å‘³å¹´æ¥è–„ä¼¼çº±ï¼Œè°ä»¤éª‘é©¬å®¢äº¬åã€‚å°æ¥¼ä¸€å¤œå¬æ˜¥é›¨ï¼Œæ·±å··æ˜æœå–æèŠ±ã€‚çŸ®çº¸æ–œè¡Œé—²ä½œè‰ï¼Œæ™´çª—ç»†ä¹³æˆåˆ†èŒ¶ã€‚ç´ è¡£è«èµ·é£å°˜å¹ï¼ŒçŠ¹åŠæ¸…æ˜å¯åˆ°å®¶ã€‚â€ ç°åœ¨çš„å­©å„¿å··98å·ï¼Œè®¾æœ‰<a href="https://baike.baidu.com/item/%E9%99%86%E6%B8%B8%E7%BA%AA%E5%BF%B5%E9%A6%86/6426661?fromModule=lemma_inlink">é™†æ¸¸çºªå¿µé¦†</a>ã€‚</p>
<p>é™†æ¸¸62å²æ—¶ä»»é™¤å†›å™¨å°‘ç›‘ï¼ˆå”å®‹æ—¶æœŸçš„å®˜èŒåï¼Œç›‘ç£å…µå™¨ã€æ——å¸œã€æˆå¸ç­‰ç‰©å“çš„é€ ä½œï¼‰ï¼Œå°±ä½åœ¨å­©å„¿å··å†…çš„å—æ¥¼ï¼Œåœ¨ä¸çœ ä¹‹å¤œå¬äº†æ˜¥é›¨ä¹‹åï¼Œå†™ä¸‹äº†è‘—åçš„ã€Š<a href="https://baike.baidu.com/item/%E4%B8%B4%E5%AE%89%E6%98%A5%E9%9B%A8%E5%88%9D%E9%9C%81/7331905?fromModule=lemma_inlink">ä¸´å®‰æ˜¥é›¨åˆéœ</a>ã€‹ï¼šä¸–å‘³å¹´æ¥è–„ä¼¼çº±ï¼Œè°ä»¤éª‘é©¬å®¢äº¬åï¼Ÿå°æ¥¼ä¸€å¤œå¬æ˜¥é›¨ï¼Œæ·±å··æ˜æœå–æèŠ±ã€‚çŸ®çº¸æ–œè¡Œé—²ä½œè‰ï¼Œæ™´çª—ç»†ä¹³æˆåˆ†èŒ¶ã€‚ç´ è¡£è«èµ·é£å°˜å¹ï¼ŒçŠ¹åŠæ¸…æ˜å¯åˆ°å®¶ã€‚</p>
<hr>
<h1 id="çœ‹æ¢…ç»å¥"><a href="#çœ‹æ¢…ç»å¥" class="headerlink" title="çœ‹æ¢…ç»å¥"></a>çœ‹æ¢…ç»å¥</h1><p>é™†æ¸¸ ã€”å®‹ä»£ã€•</p>
<p>è€å­èˆæ—¶ä¸é¡»æ‹ï¼Œæ¢…èŠ±ä¹±æ’ä¹Œå·¾é¦™ã€‚<br>æ¨½å‰ä½œå‰§è«ç›¸ç¬‘ï¼Œæˆ‘æ­»è¯¸å›æ€æ­¤ç‹‚ã€‚</p>
<hr>
<h1 id="å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦-ä¹‹ä¸€"><a href="#å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦-ä¹‹ä¸€" class="headerlink" title="å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦ ä¹‹ä¸€"></a>å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦ ä¹‹ä¸€</h1><p>å®‹ Â· è‹è½¼<br>é»‘äº‘ç¿»å¢¨æœªé®å±±ï¼Œç™½é›¨è·³ç ä¹±å…¥èˆ¹ã€‚<br>å·åœ°é£æ¥å¿½å¹æ•£ï¼Œæœ›æ¹–æ¥¼ä¸‹æ°´å¦‚å¤©ã€‚</p>
<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>å…­æœˆäºŒåä¸ƒæ—¥ï¼šæŒ‡å®‹ç¥å®—ç†™å®äº”å¹´ï¼ˆ1072ï¼‰å…­æœˆäºŒåä¸ƒæ—¥ã€‚<br>æœ›æ¹–æ¥¼ï¼šå¤å»ºç­‘åï¼Œåˆå«çœ‹ç»æ¥¼ã€‚ä½äºæ­å·è¥¿æ¹–ç•”ï¼Œäº”ä»£æ—¶å´è¶Šç‹é’±å¼˜ä¿¶æ‰€å»ºã€‚</p>
<h2 id="èµæ"><a href="#èµæ" class="headerlink" title="èµæ"></a>èµæ</h2><p>å…¬å…ƒ1072å¹´ï¼ˆå®‹ç¥å®—ç†™å®äº”å¹´ï¼‰ï¼Œä½œè€…åœ¨æ­å·ä»»é€šåˆ¤ã€‚è¿™å¹´å…­æœˆäºŒåä¸ƒæ—¥ï¼Œä»–æ¸¸è§ˆè¥¿æ¹–ï¼Œåœ¨èˆ¹ä¸Šçœ‹åˆ°å¥‡å¦™çš„æ¹–å…‰å±±è‰²ï¼Œå†åˆ°æœ›æ¹–æ¥¼ä¸Šå–é…’ï¼Œå†™ä¸‹è¿™äº”é¦–ä¸ƒè¨€ç»å¥ã€‚æœ¬è¯—æ˜¯å…¶ç¬¬ä¸€é¦–ã€‚</p>
<p>æ­¤è¯—æç»˜äº†æœ›æ¹–æ¥¼çš„ç¾ä¸½é›¨æ™¯ã€‚æ‰æ€æ•æ·çš„è¯—äººç”¨è¯—å¥æ•æ‰åˆ°è¥¿å­æ¹–è¿™ä¸€ç•ªåˆ«å…·é£å‘³çš„â€œå³å…´è¡¨æ¼”â€ï¼Œç»˜æˆä¸€å¹…â€œè¥¿æ¹–éª¤é›¨å›¾â€ã€‚ä¹Œäº‘éª¤èšï¼Œå¤§é›¨çªé™ï¼Œå€¾åˆ»åˆé›¨è¿‡å¤©æ™´ï¼Œæ°´å¤©ä¸€è‰²ã€‚åˆæ˜¯å±±ï¼Œåˆæ˜¯æ°´ï¼Œåˆæ˜¯èˆ¹ï¼Œè¿™å°±çªå‡ºäº†æ³›èˆŸè¥¿æ¹–çš„ç‰¹ç‚¹ã€‚å…¶æ¬¡ï¼Œä½œè€…ç”¨â€œé»‘äº‘ç¿»å¢¨â€ï¼Œâ€œç™½é›¨è·³ç â€å½¢æˆå¼ºçƒˆçš„è‰²å½©å¯¹æ¯”ï¼Œç»™äººä»¥å¾ˆå¼ºçš„è´¨æ„Ÿã€‚å†æ¬¡ï¼Œç”¨â€œç¿»å¢¨â€å†™äº‘çš„æ¥åŠ¿ï¼Œç”¨â€œè·³ç â€æç»˜é›¨ç‚¹é£æº…çš„æƒ…æ€ï¼Œä»¥åŠ¨è¯å‰ç§»çš„å¥å¼ä½¿æ¯”å–»è¿ç”¨å¾—çµæ´»ç”ŸåŠ¨å´ä¸éœ²ç—•è¿¹ã€‚è€Œâ€œå·åœ°é£æ¥å¿½å¹æ•£ï¼Œæœ›æ¹–æ¥¼ä¸‹æ°´å¦‚å¤©â€ä¸¤å¥åˆæŠŠå¤©æ°”ç”±éª¤é›¨åˆ°æ™´æœ—å‰è½¬å˜ä¹‹å¿«æç»˜å¾—ä»¤äººå¿ƒæ¸…æ°”çˆ½ï¼Œçœ¼å‰é™¡ç„¶ä¸€äº®ï¼Œå¢ƒç•Œå¤§å¼€ã€‚</p>
<p>è¯—äººå°†ä¸€åœºå˜å¹»çš„é£é›¨å†™å¾—ååˆ†ç”ŸåŠ¨ã€‚ä»–é‚£æ—¶æ˜¯ååœ¨èˆ¹ä¸Šã€‚èˆ¹æ­£å¥½åˆ’åˆ°æœ›æ¹–æ¥¼ä¸‹ï¼Œå¿½è§è¿œå¤„å¤©ä¸Šæ¶Œèµ·æ¥ä¸€ç‰‡é»‘äº‘ï¼Œå°±åƒæ³¼ç¿»äº†ä¸€ç›†å¢¨æ±ï¼ŒåŠè¾¹å¤©ç©ºéœæ—¶æ˜æš—ã€‚è¿™ç‰‡é»‘äº‘ä¸åä¸å€šï¼Œç›´å‘æ¹–ä¸Šå¥”æ¥ï¼Œä¸€çœ¨çœ¼é—´ï¼Œä¾¿æ³¼ä¸‹ä¸€åœºå€¾ç›†å¤§é›¨ã€‚åªè§æ¹–é¢ä¸Šæº…èµ·æ— æ•°æ°´èŠ±ï¼Œé‚£é›¨ç‚¹è¶³æœ‰é»„è±†å¤§å°ï¼Œçº·çº·æ‰“åˆ°èˆ¹ä¸Šæ¥ï¼Œå°±åƒå¤©è€çˆ·æŠŠåƒä¸‡é¢—çç ä¸€é½æ’’ä¸‹ï¼Œèˆ¹ç¯·èˆ¹æ¿ï¼Œå…¨æ˜¯ä¸€ç‰‡ä¹’ä¹’ä¹“ä¹“çš„å£°å“ã€‚èˆ¹ä¸Šæœ‰äººå“æ…Œäº†ï¼Œåš·ç€è¦é å²¸ã€‚å¯æ˜¯è¯—äººæœè¿œå¤„ä¸€çœ‹ï¼Œå´çŸ¥é“è¿™ä¸è¿‡æ˜¯ä¸€åœºè¿‡çœ¼äº‘é›¨ï¼Œè½¬çœ¼å°±æ”¶åœºäº†ã€‚è¿œå¤„çš„ç¾¤å±±ä¾ç„¶æ˜ ç€é˜³å…‰ï¼Œå…¨æ— åŠç‚¹é›¨æ„ã€‚äº‹å®ä¸Šä¹Ÿç¡®å®æ˜¯å¦‚æ­¤ã€‚è¿™ç‰‡é»‘äº‘ï¼Œé¡ºç€é£åŠ¿å¹æ¥ï¼Œä¹Ÿé¡ºç€é£åŠ¿ç§»å»ã€‚è¿˜ä¸åˆ°åŠç›èŒ¶å·¥å¤«ï¼Œé›¨è¿‡å¤©æ™´ï¼Œä¾æ—§æ˜¯ä¸€ç‰‡å¹³é™ã€‚æ°´æ˜ ç€å¤©ï¼Œå¤©ç…§ç€æ°´ï¼Œç¢§æ³¢å¦‚é•œï¼Œåˆæ˜¯ä¸€æ´¾æ¸©æŸ”æ˜åªšçš„é£å…‰ã€‚</p>
<p>è¯—äººå…ˆåœ¨èˆ¹ä¸­ï¼Œååœ¨æ¥¼å¤´ï¼Œè¿…é€Ÿæ•æ‰ä½æ¹–ä¸Šæ€¥å‰§å˜åŒ–çš„è‡ªç„¶æ™¯ç‰©ï¼šäº‘ç¿»ã€é›¨æ³»ã€é£å·ã€å¤©æ™´ï¼Œå†™å¾—æœ‰è¿œæœ‰è¿‘ï¼Œæœ‰åŠ¨æœ‰é™ï¼Œæœ‰å£°æœ‰è‰²ï¼Œæœ‰æ™¯æœ‰æƒ…ã€‚æŠ“ä½å‡ ä¸ªè¦ç‚¹ï¼ŒæŠŠä¸€åœºå¿½ç„¶è€Œæ¥åˆå¿½ç„¶è€Œå»çš„éª¤é›¨ï¼Œå†™å¾—éå¸¸é²œæ˜ï¼Œå¯Œäºæƒ…è¶£ï¼Œé¢‡è§åŠŸå¤«ã€‚è¯—ç”¨â€œç¿»å¢¨â€å†™å‡ºäº‘çš„æ¥åŠ¿ï¼Œç”¨â€œè·³ç â€æç»˜é›¨çš„ç‰¹ç‚¹ï¼Œè¯´æ˜æ˜¯éª¤é›¨è€Œä¸æ˜¯ä¹…é›¨ã€‚â€œæœªé®å±±â€æ˜¯éª¤é›¨æ‰æœ‰çš„æ™¯è±¡ã€‚â€œå·åœ°é£â€è¯´æ˜é›¨è¿‡å¾—å¿«çš„åŸå› ï¼Œéƒ½æ˜¯å¦‚å®æå†™ï¼Œå´åˆ†æ’åœ¨ç¬¬ä¸€ã€ç¬¬ä¸‰å¥ä¸­ï¼Œå½¼æ­¤å‘¼åº”ï¼Œçƒ˜æ‰˜å¾—å¥½ã€‚</p>
<p>æœ€åç”¨â€œæ°´å¦‚å¤©â€å†™ä¸€åœºéª¤é›¨çš„ç»“æŸï¼Œåˆæœ‰æ‚ ç„¶ä¸å°½çš„æƒ…è‡´ã€‚å¥ä¸­åˆç”¨â€œç™½é›¨â€å’Œâ€œé»‘äº‘â€æ˜ è¡¬ï¼Œç”¨â€œæ°´å¦‚å¤©â€å’Œâ€œå·åœ°é£â€å¯¹ç…§ï¼Œç”¨â€œä¹±å…¥èˆ¹â€œä¸â€œæœªé®å±±â€æ¯”è¾ƒï¼Œéƒ½æ˜¾å‡ºä½œè€…æ„æ€æ—¶çš„ç”¨å¿ƒã€‚è¿™äºŒåå…«ä¸ªå­—ï¼Œéšç¬”æŒ¥æ´’ï¼Œä¿¡æ‰‹æ‹ˆæ¥ï¼Œæ˜¾ç¤ºå‡ºä½œè€…åŠŸåŠ›çš„æ·±åšï¼Œåªæ˜¯åœ¨è¡¨é¢ä¸Šä¸ç€ç—•è¿¹ç½¢äº†ã€‚</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>å¥¥è¿ä¼šè§£è¯´é‚£ä¸ªï¼Œæˆ‘è®°å¾—ä¸œäº¬å¥¥è¿ä¼šçš®åˆ’è‰‡æœ‰ä¸ªæ¯”èµ›å› ä¸ºä¸‹é›¨æ¨è¿Ÿäº†ï¼Œç„¶åå¼€å§‹æ—¶é›¨è¿˜æ²¡æœ‰å®Œå…¨åœï¼Œå±å¹•ä¸Šèƒ½çœ‹åˆ°é›¨ç‚¹æ’å‡»çš„æ ·å­ï¼Œç„¶åè§£è¯´æ¥äº†å¥é»‘äº‘ç¿»å¢¨æœªé®å±±ç™½é›¨è·³ç ä¹±å…¥èˆ¹</p>
<hr>
<h1 id="å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦-ä¹‹äº”"><a href="#å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦-ä¹‹äº”" class="headerlink" title="å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦ ä¹‹äº”"></a>å…­æœˆäºŒåä¸ƒæ—¥æœ›æ¹–æ¥¼é†‰ä¹¦ ä¹‹äº”</h1><p>å®‹ Â· è‹è½¼</p>
<p>æœªæˆå°éšèŠä¸­éšï¼Œå¯å¾—é•¿é—²èƒœæš‚é—²ã€‚<br>æˆ‘æœ¬æ— å®¶æ›´å®‰å¾€ï¼Œæ•…ä¹¡æ— æ­¤å¥½æ¹–å±±ã€‚</p>
<p>åšä¸åˆ°éšå±…å±±æ—ï¼Œæš‚æ—¶å…ˆåšä¸ªé—²å®˜å§ï¼Œè¿™æ ·å°šå¯å¾—åˆ°é•¿æœŸçš„æ‚ é—²èƒœè¿‡æš‚æ—¶çš„ä¼‘é—²ã€‚<br>æˆ‘æœ¬æ¥å°±æ²¡æœ‰å®¶ï¼Œä¸å®‰èº«åœ¨è¿™é‡Œåˆèƒ½åˆ°å“ªé‡Œå»å‘¢?ä½•å†µå°±ç®—æ˜¯æ•…ä¹¡ï¼Œä¹Ÿæ²¡æœ‰åƒè¿™é‡Œè¿™æ ·ä¼˜ç¾çš„æ¹–å…‰å±±è‰²ã€‚</p>
<hr>
<h1 id="æ¹–å·"><a href="#æ¹–å·" class="headerlink" title="æ¹–å·"></a>æ¹–å·</h1><p>ã€ä½œè€…ã€‘æˆ´è¡¨å…ƒã€æœä»£ã€‘å®‹</p>
<p>å±±ä»å¤©ç›®æˆç¾¤å‡ºï¼Œæ°´å‚å¤ªæ¹–åˆ†æ¸¯æµã€‚<br>è¡Œéæ±Ÿå—æ¸…ä¸½åœ°ï¼Œäººç”Ÿåªåˆä½æ¹–å·ã€‚</p>
<hr>
<h1 id="å¯’é£Ÿé›¨äºŒé¦–"><a href="#å¯’é£Ÿé›¨äºŒé¦–" class="headerlink" title="å¯’é£Ÿé›¨äºŒé¦–"></a>å¯’é£Ÿé›¨äºŒé¦–</h1><p>è‹è½¼ ã€”å®‹ä»£ã€•</p>
<p>è‡ªæˆ‘æ¥é»„å·ï¼Œå·²è¿‡ä¸‰å¯’é£Ÿã€‚<br>å¹´å¹´æ¬²æƒœæ˜¥ï¼Œæ˜¥å»ä¸å®¹æƒœã€‚<br>ä»Šå¹´åˆè‹¦é›¨ï¼Œä¸¤æœˆç§‹è§ç‘Ÿã€‚<br>å§é—»æµ·æ£ èŠ±ï¼Œæ³¥æ±¡ç‡•è„‚é›ªã€‚<br><strong>æš—ä¸­å·è´Ÿå»ï¼Œå¤œåŠçœŸæœ‰åŠ›ã€‚</strong><br><strong>ä½•æ®Šç—…å°‘å¹´ï¼Œç—…èµ·å¤´å·²ç™½ã€‚</strong></p>
<p>æ˜¥æ±Ÿæ¬²å…¥æˆ·ï¼Œé›¨åŠ¿æ¥ä¸å·²ã€‚<br>å°å±‹å¦‚æ¸”èˆŸï¼Œæ¿›æ¿›æ°´äº‘é‡Œã€‚<br>ç©ºåº–ç…®å¯’èœï¼Œç ´ç¶çƒ§æ¹¿è‹‡ã€‚<br>é‚£çŸ¥æ˜¯å¯’é£Ÿï¼Œä½†è§ä¹Œè¡”çº¸ã€‚<br>å›é—¨æ·±ä¹é‡ï¼ŒåŸå¢“åœ¨ä¸‡é‡Œã€‚<br>ä¹Ÿæ‹Ÿå“­é€”ç©·ï¼Œæ­»ç°å¹ä¸èµ·ã€‚</p>
<h2 id="è¯‘æ–‡"><a href="#è¯‘æ–‡" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h2><p>è‡ªä»æˆ‘æ¥åˆ°é»„å·ï¼Œå·²åº¦è¿‡ä¸‰ä¸ªå¯’é£Ÿæ—¶é™…ã€‚<br>å¹´å¹´çˆ±æƒœæ˜¥å…‰æƒ³å°†å®ƒæŒ½ç•™ï¼Œæ˜¥å¤©è‡ªç®¡è‡ªå½’å»ä¸å®¹äººæƒ‹æƒœã€‚<br>ä»Šå¹´åˆè‹¦äºè¿è¿é˜´é›¨ï¼Œç»µå»¶ä¸¤ä¸ªæœˆæ°”å€™è§ç‘Ÿä¸€å¦‚ç§‹å­£ã€‚<br>ç‹¬å§åœ¨åºŠå¬å¾—é›¨æ‰“æµ·æ£ ï¼Œèƒ­è„‚æ ·èŠ±ç“£åƒé›ªç‰‡å‡‹è½æ±¡æ³¥ã€‚<br>é€ ç‰©ä¸»æŠŠè‰³ä¸½çš„æµ·æ£ å·å·èƒŒå»ï¼Œå¤œåŠçš„é›¨çœŸæœ‰ç¥åŠ›ã€‚<br>é›¨ä¸­æµ·æ£ ä»¿ä½›ä¸€ä½æ‚£ç—…çš„å°‘å¹´ï¼Œç—…æ„ˆæ—¶åŒé¬“æ–‘ç™½å·²ç„¶è€å»ã€‚</p>
<p>æ˜¥æ±Ÿæš´æ¶¨ä»¿ä½›è¦å†²è¿›é—¨æˆ·ï¼Œé›¨åŠ¿å‡¶çŒ›è¢­æ¥ä¼¼ä¹æ²¡æœ‰ç©·å·²ã€‚<br>æˆ‘çš„å°å±‹å®›å¦‚ä¸€å¶æ¸”èˆŸï¼Œç¬¼ç½©åœ¨æ¿›æ¿›æ°´äº‘é‡Œã€‚<br>ç©ºç©ºçš„å¨æˆ¿ç…®ç€äº›å¯’èœï¼Œæ½®æ¹¿çš„èŠ¦è‹‡ç‡ƒåœ¨ç ´ç¶åº•ã€‚<br>å“ªè¿˜çŸ¥é“è¿™ä¸€å¤©ç«Ÿç„¶æ˜¯å¯’é£Ÿï¼Œå´çœ‹è§ä¹Œé¸¦è¡”æ¥çƒ§å‰©çš„çº¸å¸ã€‚<br>å¤©å­çš„å®«é—¨æœ‰ä¹é‡ï¼Œæ·±è¿œéš¾ä»¥å½’å»ï¼Œç¥–ä¸Šçš„åŸèŒ”é¥éš”ä¸‡é‡Œä¸èƒ½åŠç¥­ã€‚<br>æˆ‘åªæƒ³å­¦é˜®ç±ä½œç©·é€”ç—›å“­ï¼Œå¿ƒå¤´å´ä¼¼æ­»ç°å¹¶ä¸æƒ³é‡æ–°ç‡ƒèµ·ã€‚</p>
<h2 id="æ³¨é‡Š-1"><a href="#æ³¨é‡Š-1" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>å¯’é£Ÿï¼šæ—§å†æ¸…æ˜èŠ‚çš„å‰ä¸€å¤©ï¼Œæ˜¯å¯’é£ŸèŠ‚ã€‚<br>èƒ­è„‚é›ªï¼šæŒ‡æµ·æ£ èŠ±ç“£ã€‚</p>
<h2 id="åˆ›ä½œèƒŒæ™¯"><a href="#åˆ›ä½œèƒŒæ™¯" class="headerlink" title="åˆ›ä½œèƒŒæ™¯"></a>åˆ›ä½œèƒŒæ™¯</h2><p>è¿™é¦–è¯—ä½œäºå…ƒä¸°äº”å¹´ï¼ˆ1082å¹´ï¼‰ä¸‰æœˆå¯’é£ŸèŠ‚ã€‚ä¸œå¡ä¾ç„¶å¤„å¢ƒè‰°éš¾ï¼Œç”Ÿæ´»å‡„å‡‰ã€‚å¿ƒæƒ…å­¤éƒã€‚ç»è¿‡é™©æ¶çš„æ”¿æ²»æ–—äº‰å’Œç‰¢ç‹±çš„æŠ˜ç£¨ï¼Œä¸œå¡çš„ä¸ªæ€§æ”¶æ•›äº†è®¸å¤šã€‚è¿™ä¸¤é¦–è¯—å……åˆ†è¡¨ç°äº†è¿™ç§å¿ƒå¢ƒå¹³å’Œä¹‹åçš„æ— å¥ˆå’Œç»æœ›ã€‚</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è¯—è¯</category>
      </categories>
      <tags>
        <tag>è¯—è¯</tag>
        <tag>å®‹è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>å”è¯—é›†é”¦&amp;èµæ</title>
    <url>//2023-02-08-tangshi/</url>
    <content><![CDATA[<h1 id="å¿†ç§¦å¨¥"><a href="#å¿†ç§¦å¨¥" class="headerlink" title="å¿†ç§¦å¨¥"></a>å¿†ç§¦å¨¥</h1><p>æç™½</p>
<p>ç®«å£°å’½ï¼Œç§¦å¨¥æ¢¦æ–­ç§¦æ¥¼æœˆã€‚ç§¦æ¥¼æœˆï¼Œå¹´å¹´æŸ³è‰²ï¼Œçé™µä¼¤åˆ«ã€‚</p>
<p>ä¹æ¸¸åŸä¸Šæ¸…ç§‹èŠ‚ï¼Œå’¸é˜³å¤é“éŸ³å°˜ç»ã€‚éŸ³å°˜ç»ï¼Œè¥¿é£æ®‹ç…§ï¼Œæ±‰å®¶é™µé˜™ã€‚</p>
<hr>
<h1 id="æ‚å’ä¸‰é¦–"><a href="#æ‚å’ä¸‰é¦–" class="headerlink" title="æ‚å’ä¸‰é¦–"></a>æ‚å’ä¸‰é¦–</h1><p>ç‹ç»´</p>
<p>å®¶ä½å­Ÿæ´¥æ²³ï¼Œé—¨å¯¹å­Ÿæ´¥å£ã€‚<br>å¸¸æœ‰æ±Ÿå—èˆ¹ï¼Œå¯„ä¹¦å®¶ä¸­å¦ã€‚</p>
<p>å›è‡ªæ•…ä¹¡æ¥ï¼Œåº”çŸ¥æ•…ä¹¡äº‹ã€‚<br>æ¥æ—¥ç»®çª—å‰ï¼Œå¯’æ¢…è‘—èŠ±æœªã€‚</p>
<p>å·²è§å¯’æ¢…å‘ï¼Œå¤é—»å•¼é¸Ÿå£°ã€‚<br>å¿ƒå¿ƒè§†æ˜¥è‰ï¼Œç•å‘é˜¶å‰ç”Ÿã€‚</p>
<p>å­Ÿæ´¥æ²³ï¼šæŒ‡æ²³å—æ´›é˜³åŒ—éƒ¨çš„é»„æ²³å—å²¸ä¸€å¸¦ï¼Œæ˜¯â€œæ­¦ç‹ä¼çº£ï¼Œä¸å…«ç™¾è¯¸ä¾¯ä¼šç›Ÿâ€ä¹‹åœ°ï¼Œä¸ºå¤ä»£äº¤é€šè¦é“ã€‚</p>
<hr>
<h1 id="æ¸¸æ´åº­æ¹–äº”é¦–Â·å…¶äºŒ"><a href="#æ¸¸æ´åº­æ¹–äº”é¦–Â·å…¶äºŒ" class="headerlink" title="æ¸¸æ´åº­æ¹–äº”é¦–Â·å…¶äºŒ"></a>æ¸¸æ´åº­æ¹–äº”é¦–Â·å…¶äºŒ</h1><p>ï¼ˆå”ï¼‰æç™½</p>
<p>å—æ¹–ç§‹æ°´å¤œæ— çƒŸï¼Œè€å¯ä¹˜æµç›´ä¸Šå¤©ã€‚<br>ä¸”å°±æ´åº­èµŠæœˆè‰²ï¼Œå°†èˆ¹ä¹°é…’ç™½äº‘è¾¹ã€‚</p>
<h2 id="èµæ"><a href="#èµæ" class="headerlink" title="èµæ"></a>èµæ</h2><p>è¯—äººä¸ºæˆ‘ä»¬æç»˜äº†æœˆå¤œæ³›èˆŸçš„æƒ…å½¢ï¼šæ˜æœˆçšçšï¼Œæ¹–æ°´æ‚ æ‚ ã€‚æ´åº­ç§‹æ°´æ¾„æ¾ˆæ— çƒŸï¼Œæ°´æœˆç›¸æ˜ ï¼Œæ¸…è¾‰æ€¡äººã€‚</p>
<p>è¯—äººä¸å‹äººï¼ˆæ­¤å¤„ï¼Œæˆ‘ä»¬ä¸å¦¨æŠŠå…¶æ—å”ä¹Ÿå½“ä½œå‹äººï¼‰æ³›èˆŸæ¹–ä¸Šï¼Œä¸æ¸…é£æœ—æœˆä¸ºä¼´ï¼Œä¸ç”±ç”Ÿå‡ºé—ä¸–ç‹¬ç«‹ã€ç¾½åŒ–ç™»ä»™çš„â€œä¸Šå¤©â€ä¹‹å¿µã€‚ä½†ä¹˜æµä¸Šå¤©ç»ˆä¸å¯å¾—ï¼Œè¯—äººä¹Ÿåªå¥½æ”¶èµ·è¿™ä»½ä¸ç¾çš„æƒ³è±¡ï¼Œå§‘ä¸”å‘æ´åº­æ¹–èµŠå‡ åˆ†æœˆè‰²ï¼Œç—›å¿«åœ°èµæœˆå–é…’ã€‚</p>
<p>é¦–å¥å†™æ™¯ï¼ŒåŒæ—¶ç‚¹å‡ºç§‹æ¸¸æ´åº­äº‹ã€‚â€œå—æ¹–ç§‹æ°´å¤œæ— çƒŸâ€ï¼Œåˆè¯»å¹³æ·¡æ— å¥‡ï¼Œä¼¼æ˜¯å…¨ä¸è´¹åŠ›ï¼Œè„±å£è€Œå‡ºï¼Œå®åˆ™æå…·è¡¨ç°åŠ›ï¼šæœˆå¤œæ³›èˆŸï¼Œæ´åº­æ¹–æ°´å…¨ä¸ä¼¼ç™½æ—¥çƒŸæ³¢æµ©æ¸ºã€æ°´æ±½è’¸è…¾ä¹‹æ°”è±¡ã€‚æ³¢æ¾œä¸æƒŠï¼Œæ¾„æ¾ˆå¦‚ç”»ã€‚æ— çƒŸæ°´æ„ˆæ¸…ï¼Œæ°´æ¸…æœˆæ›´æ˜ã€‚æº¶æº¶æœˆè‰²æº¶äºæ°´ï¼Œæ‚ æ‚ æ¹–å…‰æ‚ æœˆæ˜ã€‚è¿™ç§æ™¯è±¡ï¼Œè¿™ç§æ„å‘³ï¼Œéç½®èº«å…¶ä¸­ä¸å¯å¾—ï¼Œéå†™æ„ç®€ç¬”ä¸å¯å¾—ã€‚è¯—äººè™½ç„¶æ²¡æœ‰ç²¾å·¥ç»†ç»˜ï¼Œä½†è¯»è€…å¿ƒä¸­è‡ªä¼šæ¶Œç°å‡ºä¸€å¹…æ°´å¤©ä¸€è‰²çš„ç¾å¥½å›¾æ™¯ã€‚</p>
<hr>
<h1 id="é€æŸ´ä¾å¾¡"><a href="#é€æŸ´ä¾å¾¡" class="headerlink" title="é€æŸ´ä¾å¾¡"></a>é€æŸ´ä¾å¾¡</h1><p>ï¼ˆå”ï¼‰ç‹æ˜Œé¾„</p>
<p>æ²…æ°´é€šæ³¢æ¥æ­¦å†ˆï¼Œé€å›ä¸è§‰æœ‰ç¦»ä¼¤ã€‚<br>é’å±±ä¸€é“åŒäº‘é›¨ï¼Œæ˜æœˆä½•æ›¾æ˜¯ä¸¤ä¹¡ã€‚</p>
<p>å…¸å‹ç‹æ˜Œé¾„é£æ ¼çš„é€åˆ«è¯—ã€‚<br>ç‹æ˜Œé¾„ä¸€ç”Ÿå®˜åœºæ²‰æµ®(ä»¥æ²‰ä¸ºä¸»)ï¼Œäº¤å‹å¹¿é˜”ï¼Œè¯—æ–‡é¢˜ææ¶‰çŒé¢‡å¤šï¼Œå°¤æ“…è¾¹å¡ã€å®«æ€¨ã€ç¦»åˆ«ã€‚</p>
<p>å¯èƒ½æ˜¯å› ä¸ºå¤§éƒ¨åˆ†æ—¶é—´ä¸æ˜¯è¢«è´¬ï¼Œå°±æ˜¯è°ªå±…ï¼Œä¸€ç”Ÿé«˜å¼€ä½èµ°ï¼Œæ‰€ä»¥è€ç‹éå¸¸çæƒœæœ‹å‹ä¹‹é—´çš„æ¸©æš–æƒ…æ„ã€‚ç‹æ˜Œé¾„çš„é€åˆ«è¯—ï¼Œé¦–å…ˆæ˜¯æ„æ€æ–°é¢–ï¼Œä¸è½çª è‡¼ï¼Œçœ‹ä¼¼è½»ææ·¡å†™ï¼Œå…¶å®æƒ…æ„æµ“åšã€‚å…¶æ¬¡æ˜¯ä¸é‡ç¦»åˆ«åœºæ™¯ï¼Œå¤šæç»˜åˆ«åæƒ…æ™¯ã€‚é‡ç‚¹æ˜¯ï¼Œä¸ä¼¤ç¦»åˆ«è€Œå¤šæ…°åˆ«ï¼Œä½†å´å›å‘³é¢‡æ·±ã€‚</p>
<p>å›åˆ°è¿™é¦–è¯—ï¼Œå‰ä¸¤å¥å…ˆè¯´æ²…æ°´é€šæ³¢ï¼Œæ·¡åŒ–è·ç¦»æ„Ÿ(ç›®æµ‹é¾™æ ‡åˆ°æ­¦å†ˆï¼Œå¥½åƒä¹Ÿä¸è¿‘)ï¼Œé¡ºç†æˆç« çš„æ‰¾äº†ç†ç”±ï¼Œéšå£è¯´æ²¡è§‰å¾—æœ‰å•¥ç¦»æ„ã€‚ç¨å¾®æœ‰ç‚¹å¿ƒçœ¼éƒ½èƒ½çœ‹å‡ºæ¥ï¼Œé‚£ä¹ˆå¤§çš„è¯—äººï¼Œè¯´å¾—è¶Šæ— æ‰€è°“ï¼Œå…¶å®è¶Šå½“å›äº‹å„¿ã€‚</p>
<p>ä¸‹ä¸€å¥å°±çœ‹å‡ºåŠŸå¤«äº†ï¼Œé’å±±ä¸€é“åŒäº‘é›¨ï¼Œå°±ä¸ƒä¸ªå­—ï¼Œä¿¡æ¯é‡è¶…çº§å¤§ã€‚é’å±±ä¸€é“ï¼Œæ²¡æœ‰ç‰¹æŒ‡å“ªåº§å±±ï¼Œè¯´æ˜åŒæ¸¸è¿‡ä¸æ­¢ä¸€åº§å±±ï¼Œçˆ±å¥½ç›¸åŒï¼Œæœ‰ç‚¹æºæ‰‹è¸éé’å±±çš„æ„æ€ã€‚åŒäº‘é›¨å°±ä¸è¯´äº†ï¼Œè‡³å°‘å…±åŒç»å†äº†å„ç§å¤©æ°”å˜åŒ–ï¼Œè¯´æ˜ç›¸å¤„æ—¶é—´ä¸çŸ­(æƒ³æ±¡äº†çš„è‡ªå·±é¢å£å»)ã€‚</p>
<p>æœ€åä¸€å¥ï¼Œæ˜æœˆä½•æ›¾æ˜¯ä¸¤ä¹¡ï¼Œæˆè‚‰æ¥äº†ã€‚ç¬¬ä¸€å±‚æ„æ€ï¼Œå€Ÿæ˜æœˆåŒå¤©ï¼Œå†æ¬¡æ‹‰è¿‘å½¼æ­¤è·ç¦»ï¼Œæ˜¯ä¸ºæ…°åˆ«â€”â€”åƒé‡Œå…±å©µå¨Ÿã€‚ç¬¬äºŒå±‚æ„æ€ï¼Œæ¯•ç«Ÿ38ä¸‡å…¬é‡Œä¹˜ä»¥2ï¼Œè¯´ä¸è¿œã€‚ã€‚ã€‚çœŸä¸è¿œå—ï¼Ÿæ˜¯ä¸ºå¿åˆ«â€”â€”é“æ˜¯æ— æ™´å´æœ‰æ™´ã€‚ç¬¬ä¸‰å±‚æ„æ€ï¼Œä»æ­¤ä»¥åï¼Œæ—¥è¸é’å±±ï¼Œå¤œæœ›æ˜æœˆï¼Œæ²¡æœ‰äº†ä½ ï¼Œå´å…¨éƒ½æ˜¯ä½ ï¼Œæ˜¯ä¸ºéš¾åˆ«â€”â€”é†’ä¹Ÿæ— èŠï¼Œé†‰ä¹Ÿæ— èŠã€‚ã€‚ã€‚</p>
<p>è€ç‹åŒå­¦ï¼Œæµªæ¼«è±ªæƒ…ä¸åŠæç™½ï¼Œæ‰åæ¨ªæº¢ä¸åŠç‹ç»´ï¼Œä¾ ä¹‹å¤§è€…ä¸åŠæœç”«ï¼Œä½†æ˜¯å…¶æƒ…æ™¯å¦™åˆï¼Œæ„ä¸å¢ƒæµ‘ï¼Œå§”å©‰å«è“„ï¼Œæ„å¢ƒæ·±è¿œï¼Œå ªç§°å¤§å®¶ã€‚</p>
<hr>
<h1 id="é…¬ä¸­éƒ½å°åæºæ–—é…’åŒé±¼äºé€†æ—…è§èµ "><a href="#é…¬ä¸­éƒ½å°åæºæ–—é…’åŒé±¼äºé€†æ—…è§èµ " class="headerlink" title="é…¬ä¸­éƒ½å°åæºæ–—é…’åŒé±¼äºé€†æ—…è§èµ "></a>é…¬ä¸­éƒ½å°åæºæ–—é…’åŒé±¼äºé€†æ—…è§èµ </h1><p><a href="https://so.gushiwen.cn/authorv_b90660e3e492.aspx">æç™½</a> <a href="https://so.gushiwen.cn/shiwens/default.aspx?cstr=%E5%94%90%E4%BB%A3">ã€”å”ä»£ã€•</a></p>
<p>é²é…’è‹¥ç¥ç€ï¼Œæ±¶é±¼ç´«é”¦é³ã€‚<br>å±±ä¸œè±ªåæœ‰ä¿Šæ°”ï¼Œæ‰‹æºæ­¤ç‰©èµ è¿œäººã€‚<br>æ„æ°”ç›¸å€¾ä¸¤ç›¸é¡¾ï¼Œæ–—é…’åŒé±¼è¡¨æƒ…ç´ ã€‚<br>åŒé³ƒå‘€å‘·é³é¬£å¼ ï¼Œæ‹¨å‰Œé“¶ç›˜æ¬²é£å»ã€‚<br>å‘¼å„¿æ‹‚å‡ éœœåˆƒæŒ¥ï¼Œçº¢è‚ŒèŠ±è½ç™½é›ªéœã€‚<br>ä¸ºå›ä¸‹ç®¸ä¸€é¤é¥±ï¼Œé†‰è‘—é‡‘éä¸Šé©¬å½’ã€‚</p>
<h2 id="è¯‘æ–‡"><a href="#è¯‘æ–‡" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h2><p>é²åœ°çš„é…’è‰²å¦‚ç¥ç€ï¼Œæ±¶æ°´é±¼ç´«é³ä¼¼é”¦ã€‚<br>å±±ä¸œå°åè±ªçˆ½ä¿Šé€¸ï¼ææ¥è¿™ä¸¤æ ·ä¸œè¥¿é€ç»™å®¢äººã€‚<br>äºŒäººæ„æ°”ç›¸æŠ•ï¼Œä¸¤ç›¸é¡¾æƒœï¼Œä¸¤æ¡é±¼ä¸€æ¯é…’ä»¥è¡¨æƒ…æ„ã€‚<br>é±¼å„¿åååŒé³ƒï¼ŒæŒ¯èµ·é³é¬£ï¼Œè·‹åˆºä¸€å£°ï¼Œè¦ä»é“¶ç›˜ä¸­è·³å»ã€‚<br>å”¤å„¿æ“¦å‡€å‡ æ¡ˆæŒ¥åˆ€å‰²è‚‰ï¼Œçº¢çš„å¦‚åŒèŠ±è½ï¼Œç™½çš„å¥½ä¼¼é›ªé£ã€‚<br>ä¸ºä½ ä¸‹ç®¸åƒè¶³äº†é…’ï¼Œè‘—éä¸Šé©¬ï¼Œé†‰è’™è’™åœ°å½’å»ã€‚</p>
<p>é³ï¼ˆqÃ­ï¼‰é¬£ï¼ˆliÃ¨ï¼‰ï¼šé±¼çš„èƒŒé³ä¸ºé³ï¼Œèƒ¸é³ä¸ºé¬£ã€‚</p>
<h2 id="åˆ›ä½œèƒŒæ™¯"><a href="#åˆ›ä½œèƒŒæ™¯" class="headerlink" title="åˆ›ä½œèƒŒæ™¯"></a>åˆ›ä½œèƒŒæ™¯</h2><p>å…¬å…ƒ746å¹´ï¼ˆå¤©å®äº”å¹´ï¼‰ï¼Œ<a href="https://so.gushiwen.cn/authorv_b90660e3e492.aspx">æç™½</a>å§ç—…ä»»åŸå¾ˆä¹…ï¼Œç§‹å¤©ï¼Œç—…ç¨å¥½ï¼Œåˆå»æ¸¸è§ˆé²éƒ¡ï¼Œåˆ°è¾¾ä¸­éƒ½ã€‚ä¸­éƒ½ä¸€ä½ä¹…ä»°æç™½ç››åçš„å°å®˜æºæ–—é…’åŒé±¼åˆ°æ—…é¦†æ‹œè®¿æç™½ã€‚å¸­ä¸­ï¼Œæç™½è¯—å…´å¤§å‘ï¼Œä½œæ­¤è¯—ä»¥é…¬è°¢ã€‚</p>
<h2 id="èµæ-1"><a href="#èµæ-1" class="headerlink" title="èµæ"></a>èµæ</h2><p>è¿™é¦–è¯—è®°è¿°è¯—äººåœ¨æµªè¿¹æ±Ÿæ¹–çš„æ—…é€”ä¸­ï¼Œæ”¶åˆ°ä¸­éƒ½ä¸€å°åèµ é€çš„é…’ã€é±¼ï¼Œä¾¿è±ªå…´å¤§å‘ï¼Œçƒ¹é±¼ç…®é…’ï¼ŒäºŒäººå¯¹é…Œï¼Œç›´åˆ°é…’é…£é¥­é¥±ï¼Œæ‰â€œé†‰è‘—é‡‘éä¸Šé©¬å½’â€ã€‚<br>â€œé²é…’è‹¥ç¥ç€ï¼Œæ±¶é±¼ç´«é”¦é³ï¼Œâ€æ˜¯ç››èµä¸­éƒ½å°åç¤¼ç‰©çš„çè´µã€‚ä»¥â€œæ–—é…’è¯—ç™¾ç¯‡â€è€Œè‘—ç§°çš„â€œè°ªä»™äººâ€<a href="https://so.gushiwen.cn/authorv_b90660e3e492.aspx">æç™½</a>ï¼Œå¯¹å±±ä¸œåé…’ç´ æœ‰ç‰¹æ®Šçš„æ„Ÿæƒ…ï¼Œæ›¾ç»ä¸ºæ­¤å†™ä¸‹çƒ­æƒ…æ´‹æº¢çš„è¯—å¥ï¼šâ€œå…°é™µç¾é…’éƒé‡‘é¦™ï¼Œç‰ç¢—ç››æ¥ç¥ç€å…‰ï¼Œä½†ä½¿ä¸»äººèƒ½é†‰å®¢ï¼Œä¸çŸ¥ä½•å¤„æ˜¯ä»–ä¹¡ã€‚â€ä¸­éƒ½å°åå¸¦æ¥çš„ç¾é…’ä¹Ÿæ˜¯å…‰â€œè‹¥ç¥ç€â€ï¼Œè¿™å°±ä½¿æç™½æ„ˆæ„Ÿè°¢å°åçš„æƒ…æ„ã€‚<br>ä¸­éƒ½å°åèƒ½ä»¥åè´µçš„è´¡å“é‡‘èµ¤é³èµ é€æç™½ï¼Œå¯è§å…¶æƒ…æ·±æ„é•¿ã€‚æç™½åœ¨è¯—çš„å¤´ä¸¤å¥é¦–å…ˆä»å…‰å½©è‰²æ³½ä¸Šå¯¹é²é…’ï¼Œæ±¶é±¼è¿›è¡Œç‚¹æŸ“ï¼Œè¯´æ˜ç¤¼ç‰©çš„åè´µï¼Œä¸ºä¸‹æ–‡æŠ’å†™å°åå¯¹è¯—äººçš„æŒšæƒ…åšå¥½é“ºå«ã€‚â€œå±±ä¸œè±ªåæœ‰ä¿Šæ°”ï¼Œæ‰‹æºæ­¤ç‰©èµ è¿œäººâ€ç›´æŠ’èƒ¸è‡†ï¼Œçƒ­æƒ…èµç¾ä¸­éƒ½å°åé«˜å°šçš„å¿ƒçµï¼Œèµç¾å°åå¯¹æç™½è¿™å¼‚ä¹¡â€œè¿œäººâ€çš„æ·±æƒ…åšè°Šã€‚ç¬¬ä¸‰å¥ä¸­è¯—äººä¸ç”¨â€œå°åâ€è€Œç”¨â€œè±ªåâ€ï¼Œæ—¢æ˜¯å¯¹å°åçš„å°Šé‡ï¼Œåˆæš—ç¤ºå‡ºæç™½å¯¹ä¸­éƒ½å°åä½è™½å‘ï¼Œå¾·å´é«˜çš„èµèµï¼Œæ¢å¥è¯è¯´ï¼Œâ€œå°åâ€å¾·æœ¬é«˜ä½å´å‘ï¼Œè¯´æ˜å°å»ºç¤¾ä¼šçš„é»‘æš—ã€‚<br>â€œæ„æ°”ç›¸å€¾ä¸¤ç›¸é¡¾ï¼Œæ–—é…’åŒé±¼è¡¨æƒ…ç´ ã€‚â€åœ¨è¿™ä¸¤å¥è¯—ä¸­ï¼Œç›´æ¥åŸå’å½¼æ­¤ä¹‹é—´çš„çœŸæŒšçš„å‹è°Šã€‚ä¸­éƒ½å°åå’Œè¯—äººçš„â€œä¸¤ç›¸é¡¾â€ï¼Œå› ä¸ºäºŒäººçš„æ„æ°”ä¹‹â€œç›¸å€¾â€ã€‚è€ŒäºŒäººâ€œæ„æ°”ç›¸å€¾â€çš„åŠ›é‡æ”¯ç‚¹åˆéƒ½åœ¨äºæœ‰ä¸è‚¯æ‘§çœ‰æŠ˜è…°äº‹æƒè´µçš„å´‡é«˜å¿ƒçµã€‚æ­£ç”±äºæœ‰äº†è¿™å…±é€šçš„ä»·å€¼è§‚ï¼Œå› æ­¤ä¸­éƒ½å°åå¯¹â€œèµé‡‘æ”¾è¿˜â€çš„æç™½ä¸ä½†ä¸é„™å¼ƒï¼Œç›¸åï¼Œè¿˜â€œæ„æ°”ç›¸å€¾â€åœ°â€œæºæ–—é…’åŒé±¼äºé€†æ—…â€æ¥æ‹œè®¿ã€‚ä¹Ÿæ­£ç”±äºæœ‰äº†ç›¸é€šçš„å¿ƒçµï¼Œå› æ­¤æç™½å¯¹å°åé‚£ä¸é™„ç‚è¶‹åŠ¿çš„é«˜å°šå“æ ¼æ‰æ„ˆåŠ é’¦ä½©ï¼Œâ€œæ–—é…’åŒé±¼è¡¨æƒ…ç´ â€ä¸€å¥æ˜¯å¯¹â€œæ„æ°”ç›¸å€¾ä¸¤ç›¸é¡¾â€çš„è¡¥å……ï¼Œâ€œæ–—é…’åŒé±¼â€åŸæœ¬æ˜¯ä¸­éƒ½å°åä¸ºâ€œè¡¨æƒ…ç´ â€èµ äºˆè¯—äººçš„ç¤¼ç‰©ï¼Œä½†åœ¨â€œæ¨ç›¸é€¢ä¹‹æ™šâ€çš„æ°›å›´ä¸­ï¼Œè¯—äººå´å°†â€œæ–—é…’åŒé±¼â€â€œå€ŸèŠ±çŒ®ä½›â€èˆ¬åœ°åèµ å°åï¼Œè¡¨è¾¾äº†è¯—äººå¯¹å°åç”±è¡·æ•¬æ…•çš„â€œæƒ…ç´ â€ã€‚<br>â€œåŒé³ƒå‘€å‘·é³é¬£å¼ ï¼Œè·‹åˆºé“¶ç›˜æ¬²é£å»â€ä¸¤å¥ã€‚æ˜¯å†™èµ¤é³é±¼å‡ºæ°´åçš„ç¥æ€ï¼šèµ¤é³é±¼å‘ç€å‘€å‘·çš„å£°éŸ³ï¼Œé³é¬£éƒ½å¤§å¼ å¼€æ¥ï¼Œåœ¨ç›˜ä¸­æ¿€çƒˆåœ°ç¿»æ»šç€å‡ æ¬²é£èµ°ã€‚â€œå‘¼å„¿æ‹‚å‡ éœœåˆƒæŒ¥ï¼Œçº¢è‚¥èŠ±è½ç™½é›ªéœâ€ä¸¤å¥ï¼Œé‡åœ¨æå†™å®°é±¼ï¼Œåšé±¼çš„è¿‡ç¨‹ï¼Œæ„æ€æ˜¯æ‹›å‘¼å­©å­æ“¦å‡€æ¡Œæ¡ˆæŒ¥åˆ€å®°é±¼ï¼Œé›ªç™½è‚¥å«©çš„é±¼è‚‰å‘ˆç°åœ¨çœ¼å‰ã€‚è¿™é‡Œâ€œå‘¼â€ã€â€œæ‹‚â€ã€â€œæŒ¥â€ä¸‰ä¸ªåŠ¨è¯ç»™äººä»¥æ¬¢å¿«ä¹‹æ„Ÿï¼Œä½¿è¯—å¥çš„å†…åœ¨èŠ‚å¥æ„Ÿè¿…é€ŸåŠ å¿«ï¼›è€Œâ€œçº¢â€ã€â€œèŠ±â€ã€â€œç™½â€ä¸‰ç§é²œäº®çš„è‰²å½©ï¼Œä¹Ÿç»™äººä»¥èµå¿ƒæ‚¦ç›®çš„æ„Ÿè§‰ã€‚è¿™äº›å……æ»¡åŠ¨æ„Ÿå’Œè‰²å½©æ„Ÿçš„å­—è¯çš„å·§å¦™é—´ç”¨ï¼Œæ˜¾ç¤ºå‡ºæç™½åŠå…¶å®¶äººé…¬è°¢ä¸­éƒ½å°åæ—¶è½»æ¾å¿«æ·çš„å¿ƒæƒ…ã€‚<br>ç»“å¥â€œä¸ºå›ä¸‹ç­¯ä¸€é¤é¥±ï¼Œé†‰è‘—é‡‘éä¸Šé©¬å½’â€ï¼Œæ„æ€æ˜¯å¸Œæœ›å°åå¼€æ€€ç•…é¥®ï¼Œä¹‹åå†ä¸Šé©¬é…£ç„¶å½’å»ã€‚è¿™é¦–è¯—æ­Œè™½ç„¶ä¸è±¡ã€Šèµ æ±ªä¼¦ã€‹ã€ã€Šé»„é¹¤æ¥¼é€<a href="https://so.gushiwen.cn/authorv_3811e4e1f460.aspx">å­Ÿæµ©ç„¶</a>ä¹‹å¹¿é™µã€‹ç­‰è¯—ä½œä¸€æ ·è‘—åï¼Œä½†åœ¨æç™½æå†™å‹æƒ…çš„è¯—æ­Œä¸­ä»ä¸å¤±ä¸ºä¸€é¦–ä½³ä½œã€‚å®ƒä½“ç°äº†è¯—äººå¯¹ä¸‹å±‚ç™¾å§“çš„æ·±æŒšå‹æƒ…ã€‚<br>æç™½è‡ªç¦»é•¿å®‰åï¼Œé¥±è§ˆä¸–æ€ä¹‹ç‚å‡‰ï¼Œå€å°åŠ¿åŠ›å°äººçš„é„™è§†ã€‚å›°çª˜ä¹‹æ—¶ï¼Œç´ æ˜§å¹³ç”Ÿçš„ä¸­éƒ½å°åèƒ½æ¯…ç„¶å†²ç ´ä¸–ä¿—æ¨Šç¯±ï¼Œâ€œæºæ–—é…’åŒé±¼äºé€†æ—…â€æ‹œè®¿æç™½ï¼Œæ›´æ˜¾å…¶å¿ƒçµä¹‹ç¾ã€‚åŒæ—¶é€šè¿‡æ­éœ²å°åçš„ä½å‘ä¸å¿ƒçµçš„é«˜æ´ä¹‹é—´æ‰€å­˜åœ¨çš„çŸ›ç›¾ï¼Œæ§è¯‰æ‘§æ®‹äººæ‰çš„å°å»ºç¤¾ä¼šã€‚å¦å¤–ï¼Œæ­¤è¯—å†™é±¼é…’æ´»çµæ´»ç°ï¼Œè·ƒç„¶çº¸ä¸Šï¼Œè€Œæç™½è±ªçˆ½å¦è¯šã€çƒ­æƒ…å¾…äººçš„éŸ³å®¹ç¬‘è²Œï¼Œä¹Ÿå®›ç„¶å¯æ¥ã€‚<br>â€œæ„æ°”ç›¸å€¾ä¸¤ç›¸é¡¾â€ï¼Œä¹Ÿæ˜¾ç¤ºäº†ä¸€ä»£å¤§è¯—äººä¸ä¸‹å±‚ç¤¾ä¼šä¸€å°åæ„æ°”ç›¸æŠ•çš„çœŸæŒšå‹è°ŠåŠå¿ƒå¿ƒç›¸å°çš„å¿ƒçµä¹‹ç¾</p>
<hr>
<h1 id="å‰‘å®¢-x2F-è¿°å‰‘"><a href="#å‰‘å®¢-x2F-è¿°å‰‘" class="headerlink" title="å‰‘å®¢ &#x2F; è¿°å‰‘"></a>å‰‘å®¢ &#x2F; è¿°å‰‘</h1><p>ï¼ˆå”ï¼‰è´¾å²›</p>
<p>åå¹´ç£¨ä¸€å‰‘ï¼Œéœœåˆƒæœªæ›¾è¯•ã€‚<br>ä»Šæ—¥æŠŠç¤ºå›ï¼Œè°æœ‰ä¸å¹³äº‹ï¼Ÿ</p>
<hr>
<h1 id="çŸ­æ­Œè¡Œ"><a href="#çŸ­æ­Œè¡Œ" class="headerlink" title="çŸ­æ­Œè¡Œ"></a>çŸ­æ­Œè¡Œ</h1><p>ï¼ˆå”ï¼‰æç™½</p>
<p>ç™½æ—¥ä½•çŸ­çŸ­ï¼Œç™¾å¹´è‹¦æ˜“æ»¡ã€‚<br>è‹ç©¹æµ©èŒ«èŒ«ï¼Œä¸‡åŠ«å¤ªæé•¿ã€‚<br>éº»å§‘å‚ä¸¤é¬“ï¼Œä¸€åŠå·²æˆéœœã€‚<br>å¤©å…¬è§ç‰å¥³ï¼Œå¤§ç¬‘äº¿åƒåœºã€‚<br>å¾æ¬²æ½å…­é¾™ï¼Œå›è½¦æŒ‚æ‰¶æ¡‘ã€‚<br>åŒ—æ–—é…Œç¾é…’ï¼ŒåŠé¾™å„ä¸€è§ã€‚<br>å¯Œè´µéæ‰€æ„¿ï¼Œä¸äººé©»é¢œå…‰ã€‚</p>
<hr>
<h1 id="ä¾ å®¢è¡Œ"><a href="#ä¾ å®¢è¡Œ" class="headerlink" title="ä¾ å®¢è¡Œ"></a>ä¾ å®¢è¡Œ</h1><p>æç™½ã€”å”ä»£ã€•</p>
<p>èµµå®¢ç¼¦èƒ¡ç¼¨ï¼Œå´é’©éœœé›ªæ˜ã€‚<br>é“¶éç…§ç™½é©¬ï¼Œé£’æ²“å¦‚æµæ˜Ÿã€‚<br>åæ­¥æ€ä¸€äººï¼Œåƒé‡Œä¸ç•™è¡Œã€‚<br>äº‹äº†æ‹‚è¡£å»ï¼Œæ·±è—èº«ä¸åã€‚<br>é—²è¿‡ä¿¡é™µé¥®ï¼Œè„±å‰‘è†å‰æ¨ªã€‚<br>å°†ç‚™å•–æœ±äº¥ï¼ŒæŒè§åŠä¾¯å¬´ã€‚<br>ä¸‰æ¯åç„¶è¯ºï¼Œäº”å²³å€’ä¸ºè½»ã€‚<br>çœ¼èŠ±è€³çƒ­åï¼Œæ„æ°”ç´ éœ“ç”Ÿã€‚<br>æ•‘èµµæŒ¥é‡‘æ§Œï¼Œé‚¯éƒ¸å…ˆéœ‡æƒŠã€‚<br>åƒç§‹äºŒå£®å£«ï¼Œçƒœèµ«å¤§æ¢åŸã€‚<br>çºµæ­»ä¾ éª¨é¦™ï¼Œä¸æƒ­ä¸–ä¸Šè‹±ã€‚<br>è°èƒ½ä¹¦é˜ä¸‹ï¼Œç™½é¦–å¤ªç„ç»ã€‚</p>
<h2 id="è¯‘æ–‡-1"><a href="#è¯‘æ–‡-1" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h2><p>ç‡•èµµçš„ä¾ å£«ï¼Œå¤´ä¸Šç³»ç€ä¾ å£«çš„æ­¦ç¼¨ï¼Œè…°ä½©å´è¶Šé—ªäº®çš„å¼¯åˆ€ã€‚<br>éª‘ç€é“¶éç™½é©¬ï¼Œåœ¨å¤§è¡—ä¸Šé©°éª‹å°±åƒå¤©ä¸Šçš„æµæ˜Ÿä¸€æ ·è¿…ç–¾ã€‚<br>ä»–ä»¬æ­¦è‰ºç›–ä¸–ï¼Œåæ­¥å¯æ–©æ€ä¸€äººï¼Œåƒé‡Œä¹‹è¡Œï¼Œæ— äººå¯æŒ¡ã€‚<br>ä»–ä»¬å¤§äº‹åšæˆåï¼Œæ‹‚è¢–è€Œå»å°†åŠŸåŠ³å’Œç¾åéšè—èµ·æ¥ã€‚<br>æƒ³å½“å¹´ï¼Œä¾¯å¬´ã€æœ±äº¥ä¸ä¿¡é™µå›ç»“äº¤ï¼Œä¸ä¹‹è„±å‰‘æ¨ªè†ï¼Œäº¤ç›¸æ¬¢é¥®ã€‚<br>ä¸æœ±äº¥ã€ä¾¯èµ¢ä¸€åŒå¤§å£åƒè‚‰ï¼Œå¤§ç¢—é¥®é…’ã€‚<br>å‡ æ¯çƒ­é…’ä¸‹è‚šï¼Œä¾¿æ…·æ…¨è®¸è¯ºï¼Œæ„¿ä¸ºçŸ¥å·±ä¸¤è‚‹æ’åˆ€ï¼Œä¸€è¯ºé‡äºæ³°å±±ã€‚<br>é…’åçœ¼èŠ±è€³çƒ­ï¼Œæ„æ°”å‹ƒå‹ƒåŠ²ç”Ÿï¼Œæ„ŸåŠ¨è‹å¤©ï¼Œå¯è´¯é•¿è™¹ã€‚<br>æœ±äº¥ä¸ºä¿¡é™µå›æ•‘èµµï¼ŒæŒ¥èµ·äº†é‡‘æ¤ï¼Œä½¿èµµéƒ½é‚¯éƒ¸ä¸Šä¸‹ï¼Œéƒ½ä¸ºä¹‹éœ‡æƒŠã€‚<br>äºŒä½å£®å£«çš„è±ªä¸¾ï¼Œåƒç§‹ä¹‹åä»ç„¶åœ¨å¤§æ¢åŸä¼ ä¸ºç¾è°ˆã€‚<br>ä»–ä»¬çºµç„¶æ­»å»è€Œä¾ éª¨çŠ¹é¦™ï¼Œä¸æ„§ä¸ºä¸€ä¸–è‹±è±ªã€‚<br>è°èƒ½åƒæ‰¬é›„ä¸€æ ·ï¼Œåœ¨ä¹¦é˜é‡Œç ”ç©¶ã€Šå¤ªç„ç»ã€‹åˆ°è€ï¼Œè€Œä¸€è¾ˆå­æ— æ‰€ä½œä¸ºå‘¢ï¼Ÿ</p>
<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>ä¿¡é™µï¼šä¿¡é™µå›ï¼Œæˆ˜å›½å››å…¬å­ä¹‹ä¸€ï¼Œä¸ºäººç¤¼è´¤ä¸‹å£«ï¼Œé—¨ä¸‹é£Ÿå®¢ä¸‰åƒä½™äººã€‚<br>æœ±äº¥ã€ä¾¯å¬´ï¼šéƒ½æ˜¯ä¿¡é™µå›çš„é—¨å®¢ã€‚æœ±æœ¬æ˜¯ä¸€å± å¤«ï¼Œä¾¯åŸæ˜¯é­å›½éƒ½åŸå¤§æ¢ä¸œé—¨çš„é—¨å®˜ï¼Œä¸¤äººéƒ½å—åˆ°ä¿¡é™µå›çš„ç¤¼é‡ï¼Œéƒ½ä¸ºä¿¡é™µå›æ‰€ç”¨ã€‚ç‚™ï¼Œçƒ¤è‚‰ã€‚å•–ï¼Œåƒã€‚<br>å•–æœ±äº¥ï¼šè®©æœ±äº¥æ¥åƒã€‚<br>â€œä¸‰æ¯â€ä¸¤å¥ï¼šè¯´å‡ æ¯é…’ä¸‹è‚šå°±ä½œå‡ºäº†æ‰¿è¯ºï¼Œå¹¶ä¸”æŠŠæ‰¿è¯ºçœ‹å¾—æ¯”äº”å²³è¿˜é‡ã€‚<br>ç´ éœ“ï¼šç™½è™¹ã€‚å¤äººè®¤ä¸ºï¼Œå‡¡è¦å‡ºç°ä¸å¯»å¸¸çš„å¤§äº‹ï¼Œå°±ä¼šæœ‰ä¸å¯»å¸¸çš„å¤©è±¡å‡ºç°ï¼Œå¦‚â€œç™½è™¹è´¯æ—¥â€ã€‚<br>çƒœèµ«ï¼šå½¢å®¹å£°åç››å¤§ã€‚å¤§æ¢åŸï¼šé­å›½éƒ½åŸï¼Œä»Šæ²³å—å¼€å°ã€‚<br>å¤ªç„ç»ï¼šè¥¿æ±‰æ‰¬é›„çš„ä¸€éƒ¨å“²å­¦è‘—ä½œã€‚æ‰¬é›„æ›¾åœ¨çš‡å¸è—ä¹¦çš„å¤©ç¦„é˜ä»»æ ¡åˆŠå·¥ä½œã€‚</p>
<hr>
<h1 id="å’è€èµ æ¢¦å¾—"><a href="#å’è€èµ æ¢¦å¾—" class="headerlink" title="å’è€èµ æ¢¦å¾—"></a>å’è€èµ æ¢¦å¾—</h1><p>[ å” ]  ç™½å±…æ˜“<br>ä¸å›ä¿±è€ä¹Ÿï¼Œè‡ªé—®è€ä½•å¦‚ã€‚<br>çœ¼æ¶©å¤œå…ˆå§ï¼Œå¤´æ…µæœæœªæ¢³ã€‚<br>æœ‰æ—¶æ‰¶æ–å‡ºï¼Œå°½æ—¥é—­é—¨å±…ã€‚<br>æ‡’ç…§æ–°ç£¨é•œï¼Œä¼‘çœ‹å°å­—ä¹¦ã€‚<br>æƒ…äºæ•…äººé‡ï¼Œè¿¹å…±å°‘å¹´ç–ã€‚<br>å”¯æ˜¯é—²è°ˆå…´ï¼Œç›¸é€¢å°šæœ‰é¦€ã€‚</p>
<hr>
<h1 id="é…¬ä¹å¤©å’è€è§ç¤º"><a href="#é…¬ä¹å¤©å’è€è§ç¤º" class="headerlink" title="é…¬ä¹å¤©å’è€è§ç¤º"></a>é…¬ä¹å¤©å’è€è§ç¤º</h1><p>åˆ˜ç¦¹é”¡ ã€”å”ä»£ã€•</p>
<p>äººè°ä¸é¡¾è€ï¼Œè€å»æœ‰è°æ€œã€‚<br>èº«ç˜¦å¸¦é¢‘å‡ï¼Œå‘ç¨€å† è‡ªåã€‚<br>åºŸä¹¦ç¼˜æƒœçœ¼ï¼Œå¤šç¸ä¸ºéšå¹´ã€‚<br>ç»äº‹è¿˜è°™äº‹ï¼Œé˜…äººå¦‚é˜…å·ã€‚<br>ç»†æ€çš†å¹¸çŸ£ï¼Œä¸‹æ­¤ä¾¿ç¿›ç„¶ã€‚<br>è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©ã€‚</p>
<p>é˜…äººå¦‚é˜…å·ï¼šæ„è°“é˜…å†äººç”Ÿå¦‚åŒç§¯æ°´æˆå·ä¸€æ ·ã€‚è¯­å‡ºé™†æœºã€Šå¹é€èµ‹ã€‹ï¼šâ€œé˜…æ°´ä»¥æˆå·ï¼Œæ°´æ»”æ»”è€Œæ—¥åº¦ï¼›ä¸–é˜…äººè€Œä¸ºä¸–ï¼Œäººå†‰å†‰è€Œè¡Œæš®ã€‚â€é˜…ï¼Œç»å†ã€‚</p>
<h1 id="å¶ä½œå¯„æœ—ä¹‹"><a href="#å¶ä½œå¯„æœ—ä¹‹" class="headerlink" title="å¶ä½œå¯„æœ—ä¹‹"></a>å¶ä½œå¯„æœ—ä¹‹</h1><p>ç™½å±…æ˜“ ã€”å”ä»£ã€•</p>
<p>å†æƒ³ä¸ºå®˜æ—¥ï¼Œæ— å¦‚åˆºå²æ—¶ã€‚<br>æ¬¢å¨±æ¥å®¾å®¢ï¼Œé¥±æš–åŠå¦»å„¿ã€‚<br>è‡ªåˆ°ä¸œéƒ½åï¼Œå®‰é—²æ›´å¾—å®œã€‚<br>åˆ†å¸èƒœåˆºå²ï¼Œè‡´ä»•èƒœåˆ†å¸ã€‚<br>ä½•å†µå›­æ—ä¸‹ï¼Œæ¬£ç„¶å¾—æœ—ä¹‹ã€‚<br>ä»°ååŒæ—§è¯†ï¼Œä¸ºä¹å³æ–°çŸ¥ã€‚<br>æœ‰é›ªå…ˆç›¸è®¿ï¼Œæ— èŠ±ä¸ä½œæœŸã€‚<br>æ–—é†²å¹²é…¿é…’ï¼Œå¤¸å¦™ç»†åŸè¯—ã€‚<br>é‡Œå··åƒæ¥å¾€ï¼Œéƒ½é—¨äº”åˆ«ç¦»ã€‚<br>å²åˆ†ä¸¤å›é¦–ï¼Œä¹¦åˆ°ä¸€å¼€çœ‰ã€‚<br>å¶è½æ§äº­é™¢ï¼Œå†°ç”Ÿç«¹é˜æ± ã€‚<br>é›€ç½—è°é—®è®¯ï¼Œé¹¤æ°…ç½¢è¿½éšã€‚<br>èº«ä¸å¿ƒä¿±ç—…ï¼Œå®¹å°†åŠ›å…±è¡°ã€‚<br>è€æ¥å¤šå¥å¿˜ï¼Œå”¯ä¸å¿˜ç›¸æ€ã€‚</p>
<h2 id="è¯‘æ–‡-2"><a href="#è¯‘æ–‡-2" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h2><p>å›æƒ³ä¸ºå®˜æ—¶çš„æ—¥å­ï¼Œæ²¡æœ‰æ¯”åšåˆºå²æ—¶æ›´å¿«æ„èˆ’ç•…äº†ã€‚<br>æ¬¢ä¹çš„æ¥å¾…æ¥è®¿çš„å®¾å®¢ï¼Œå¦»å„¿çš„ç”Ÿæ´»èƒ½å¤Ÿå¾—åˆ°ä¿éšœã€‚<br>è‡ªä»æ¥åˆ°ä¸œéƒ½ä»¥åï¼Œç”Ÿæ´»æ¸…é—²æ›´èƒœä»å‰ã€‚<br>åšåˆ†å¸æ—¶æ¸…é—²çš„ç”Ÿæ´»èƒœè¿‡åˆºå²ï¼Œè¾å»å®˜èŒåç”Ÿæ´»æ¸…é—²èƒœè¿‡åˆ†å¸ã€‚<br>æ›´ä¸è¯´æ˜¯åœ¨è¿™åè¿œçš„å®¶ä¹¡ï¼Œèƒ½æ”¶åˆ°ä½ çš„ä¹¦ä¿¡éå¸¸æ¬£å–œã€‚<br>ä»°æ…•ä½ çš„å¤§åå°±åƒä¸ä½ ç›¸è¯†å·²ä¹…ï¼Œä¸€èµ·åšä¹æ›²å°±åƒæ˜¯æ–°å¾—çš„çŸ¥å·±ã€‚<br>ä¸‹é›ªæ—¶å°±å…ˆåˆ°æœ—ä¹‹å®¶é‡Œæ‹œè®¿ï¼Œä¸æ˜¯èŠ±å¼€æ—¶èŠ‚ä¸ç›¸çº¦ã€‚<br>è¾¹ç•…é¥®ç€è‡ªå·±é…¿é€ çš„ç¾é…’ï¼Œè¾¹ç»†ç»†å“å‘³æ‰€ä½œçš„è¯—å¥ã€‚<br>ä½œä¸ºé‚»é‡Œå·²æ¥å¾€æ— æ•°éï¼Œåœ¨é‚£äº¬éƒ½åŸé—¨ä¹Ÿå·²åˆ†åˆ«äº”æ¬¡ã€‚<br>ç¿˜é¦–ä»¥ç›¼ä½ çš„æ¥ä¿¡ï¼Œä¹¦ä¿¡åˆ°æ—¶æ–¹èƒ½èˆ’å±•çœ‰å¤´ã€‚<br>æ§äº­é™¢ä¸­å·²æ»¡æ˜¯è½å¶ï¼Œç«¹é˜æ± ä¸­çš„æ°´ä¹Ÿç»“æ»¡å†°éœœã€‚<br>é—¨åº­å†·è½æ— å¤„è¯¢é—®è®¯æ¯ï¼Œåªå¾—æ”¾å¼ƒè¿½é—®ã€‚<br>èº«ä½“ç—…ç—›å¢å¤šï¼Œå®¹è²Œä¸ä½“åŠ›ä¹Ÿåœ¨é€æ¸è¡°é€€ã€‚<br>è™½å·²å¹´è€è®°å¿†å‡é€€ï¼Œä½†ä½ æˆ‘é—´é‚£äº›ç›¸å¤„åœºæ™¯ä»å†å†åœ¨ç›®ä»æœªå¿˜å´ã€‚</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è¯—è¯</category>
      </categories>
      <tags>
        <tag>è¯—è¯</tag>
        <tag>å”è¯—</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸»å¸­è¯—è¯é›†é”¦&amp;èµæ</title>
    <url>//2023-02-08-zhuxishici/</url>
    <content><![CDATA[<h1 id="æ°´è°ƒæ­Œå¤´Â·é‡ä¸Šäº•å†ˆå±±"><a href="#æ°´è°ƒæ­Œå¤´Â·é‡ä¸Šäº•å†ˆå±±" class="headerlink" title="æ°´è°ƒæ­Œå¤´Â·é‡ä¸Šäº•å†ˆå±±"></a>æ°´è°ƒæ­Œå¤´Â·é‡ä¸Šäº•å†ˆå±±</h1><p>ä¹…æœ‰å‡Œäº‘å¿—ï¼Œé‡ä¸Šäº•å†ˆå±±ã€‚<br>åƒé‡Œæ¥å¯»æ•…åœ°ï¼Œæ—§è²Œå˜æ–°é¢œã€‚<br>åˆ°å¤„èºæ­Œç‡•èˆï¼Œæ›´æœ‰æ½ºæ½ºæµæ°´ï¼Œé«˜è·¯å…¥äº‘ç«¯ã€‚<br>è¿‡äº†é»„æ´‹ç•Œï¼Œé™©å¤„ä¸é¡»çœ‹ã€‚<br>é£é›·åŠ¨ï¼Œæ—Œæ——å¥‹ï¼Œæ˜¯äººå¯°ã€‚<br>ä¸‰åå…«å¹´è¿‡å»ï¼Œå¼¹æŒ‡ä¸€æŒ¥é—´ã€‚<br>å¯ä¸Šä¹å¤©æ½æœˆï¼Œå¯ä¸‹äº”æ´‹æ‰é³–ï¼Œè°ˆç¬‘å‡¯æ­Œè¿˜ã€‚<br>ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªè¦è‚¯ç™»æ”€ï¼</p>
<hr>
<h1 id="å¿†ç§¦å¨¥Â·å¨„å±±å…³"><a href="#å¿†ç§¦å¨¥Â·å¨„å±±å…³" class="headerlink" title="å¿†ç§¦å¨¥Â·å¨„å±±å…³"></a>å¿†ç§¦å¨¥Â·å¨„å±±å…³</h1><p>è¥¿é£çƒˆï¼Œé•¿ç©ºé›å«éœœæ™¨æœˆã€‚éœœæ™¨æœˆï¼Œé©¬è¹„å£°ç¢ï¼Œå–‡å­å£°å’½ã€‚</p>
<p>é›„å…³æ¼«é“çœŸå¦‚é“ï¼Œè€Œä»Šè¿ˆæ­¥ä»å¤´è¶Šã€‚ä»å¤´è¶Šï¼Œè‹å±±å¦‚æµ·ï¼Œæ®‹é˜³å¦‚è¡€ã€‚</p>
<hr>
<h1 id="æ¸…å¹³ä¹Â·å…­ç›˜å±±"><a href="#æ¸…å¹³ä¹Â·å…­ç›˜å±±" class="headerlink" title="æ¸…å¹³ä¹Â·å…­ç›˜å±±"></a>æ¸…å¹³ä¹Â·å…­ç›˜å±±</h1><p>å¤©é«˜äº‘æ·¡ï¼Œæœ›æ–­å—é£é›ã€‚ä¸åˆ°é•¿åŸéå¥½æ±‰ï¼Œå±ˆæŒ‡è¡Œç¨‹äºŒä¸‡ã€‚</p>
<p>å…­ç›˜å±±ä¸Šé«˜å³°ï¼Œçº¢æ——æ¼«å·è¥¿é£ã€‚ä»Šæ—¥é•¿ç¼¨åœ¨æ‰‹ï¼Œä½•æ—¶ç¼šä½è‹é¾™ï¼Ÿ</p>
<hr>
<h1 id="ä¸ƒå¾‹Â·å’ŒæŸ³äºšå­å…ˆç”Ÿ"><a href="#ä¸ƒå¾‹Â·å’ŒæŸ³äºšå­å…ˆç”Ÿ" class="headerlink" title="ä¸ƒå¾‹Â·å’ŒæŸ³äºšå­å…ˆç”Ÿ"></a>ä¸ƒå¾‹Â·å’ŒæŸ³äºšå­å…ˆç”Ÿ</h1><p>é¥®èŒ¶ç²¤æµ·æœªèƒ½å¿˜ï¼Œç´¢å¥æ¸å·å¶æ­£é»„ã€‚</p>
<p>ä¸‰åä¸€å¹´è¿˜æ—§å›½ï¼Œè½èŠ±æ—¶èŠ‚è¯»åç« ã€‚</p>
<p>ç‰¢éªšå¤ªç››é˜²è‚ æ–­ï¼Œé£ç‰©é•¿å®œæ”¾çœ¼é‡ã€‚</p>
<p>è«é“æ˜†æ˜æ± æ°´æµ…ï¼Œè§‚é±¼èƒœè¿‡å¯Œæ˜¥æ±Ÿã€‚</p>
<hr>
<h1 id="ä¸ƒå¾‹Â·äººæ°‘è§£æ”¾å†›å é¢†å—äº¬"><a href="#ä¸ƒå¾‹Â·äººæ°‘è§£æ”¾å†›å é¢†å—äº¬" class="headerlink" title="ä¸ƒå¾‹Â·äººæ°‘è§£æ”¾å†›å é¢†å—äº¬"></a>ä¸ƒå¾‹Â·äººæ°‘è§£æ”¾å†›å é¢†å—äº¬</h1><p>é’Ÿå±±é£é›¨èµ·è‹é»„ï¼Œç™¾ä¸‡é›„å¸ˆè¿‡å¤§æ±Ÿã€‚<br>è™è¸é¾™ç›˜ä»Šèƒœæ˜”ï¼Œå¤©ç¿»åœ°è¦†æ…¨è€Œæ…·ã€‚<br>å®œå°†å‰©å‹‡è¿½ç©·å¯‡ï¼Œä¸å¯æ²½åå­¦éœ¸ç‹ã€‚<br>å¤©è‹¥æœ‰æƒ…å¤©äº¦è€ï¼Œäººé—´æ­£é“æ˜¯æ²§æ¡‘ã€‚</p>
<h2 id="è¯‘æ–‡"><a href="#è¯‘æ–‡" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h2><p>è‡ªç„¶ç•Œå¦‚æœæœ‰çŸ¥ï¼Œå®ƒä¼šä½“å¯Ÿåˆ°å…´ç››ä¸è¡°è´¥è¿™æ¡ä¸å¯æ”¹å˜çš„æ³•åˆ™ã€‚äº‹ç‰©ä¸æ–­çš„å‘å‰å‘å±•æ›´æ–°å’Œå˜åŒ–ï¼Œè¿™æ˜¯å¿…ç„¶çš„è§„å¾‹ã€‚</p>
<h2 id="åˆ›ä½œèƒŒæ™¯"><a href="#åˆ›ä½œèƒŒæ™¯" class="headerlink" title="åˆ›ä½œèƒŒæ™¯"></a>åˆ›ä½œèƒŒæ™¯</h2><p>1949å¹´4æœˆ21æ—¥ï¼Œæ¯›æ³½ä¸œä¸»å¸­å’Œæœ±å¾·æ€»å¸ä»¤å‘å‡ºã€Šå‘å…¨å›½è¿›å†›çš„å‘½ä»¤ã€‹ï¼Œå·ä»¤å…¨å†›åšå†³ã€å½»åº•ã€å¹²å‡€ã€å…¨éƒ¨åœ°æ­¼ç­ä¸­å›½å¢ƒå†…ä¸€åˆ‡æ•¢äºæŠµæŠ—çš„å›½æ°‘å…šååŠ¨æ´¾ï¼Œè§£æ”¾å…¨ä¸­å›½ã€‚ä¸­å›½äººæ°‘è§£æ”¾å†›ç™¾ä¸‡å¤§å†›äº4æœˆ23æ—¥å é¢†å›½æ°‘å…šååŠ¨æ”¿åºœçš„â€œé¦–éƒ½â€å—äº¬ã€‚æ¯›æ³½ä¸œåŒå¿—åœ¨åŒ—å¹³é¦™å±±åŒæ¸…åˆ«å¢…å¾—åˆ°å é¢†å—äº¬çš„æ·æŠ¥ï¼Œå¿ƒæƒ…æŒ¯å¥‹ï¼Œå†™ä¸‹äº†è¿™é¦–è¯—ã€‚</p>
<hr>
<h1 id="ä¸ƒå¾‹äºŒé¦–Â·é€ç˜Ÿç¥"><a href="#ä¸ƒå¾‹äºŒé¦–Â·é€ç˜Ÿç¥" class="headerlink" title="ä¸ƒå¾‹äºŒé¦–Â·é€ç˜Ÿç¥"></a>ä¸ƒå¾‹äºŒé¦–Â·é€ç˜Ÿç¥</h1><p>è¯»å…­æœˆä¸‰åæ—¥ã€Šäººæ°‘æ—¥æŠ¥ã€‹ï¼Œä½™æ±Ÿå¿æ¶ˆç­äº†è¡€å¸è™«ã€‚æµ®æƒ³è”ç¿©ï¼Œå¤œä¸èƒ½å¯ã€‚å¾®é£æ‹‚ç…¦ï¼Œæ—­æ—¥ä¸´çª—ï¼Œé¥æœ›å—å¤©ï¼Œæ¬£ç„¶å‘½ç¬”ã€‚</p>
<p>ç»¿æ°´é’å±±æ‰è‡ªå¤šï¼Œåä½—æ— å¥ˆå°è™«ä½•ï¼<br>åƒæ‘è–œè”äººé—çŸ¢ï¼Œä¸‡æˆ·è§ç–é¬¼å”±æ­Œã€‚<br>ååœ°æ—¥è¡Œå…«ä¸‡é‡Œï¼Œå·¡å¤©é¥çœ‹ä¸€åƒæ²³ã€‚<br>ç‰›éƒæ¬²é—®ç˜Ÿç¥äº‹ï¼Œä¸€æ ·æ‚²æ¬¢é€é€æ³¢ã€‚</p>
<p>æ˜¥é£æ¨æŸ³ä¸‡åƒæ¡ï¼Œå…­äº¿ç¥å·å°½èˆœå°§ã€‚<br>çº¢é›¨éšå¿ƒç¿»ä½œæµªï¼Œé’å±±ç€æ„åŒ–ä¸ºæ¡¥ã€‚<br>å¤©è¿äº”å²­é“¶é”„è½ï¼Œåœ°åŠ¨ä¸‰æ²³é“è‡‚æ‘‡ã€‚<br>å€Ÿé—®ç˜Ÿå›æ¬²ä½•å¾€ï¼Œçº¸èˆ¹æ˜çƒ›ç…§å¤©çƒ§ã€‚</p>
<h2 id="è¯‘æ–‡-1"><a href="#è¯‘æ–‡-1" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h2><p>ç¥–å›½å¤§åœ°ä¸Šç™½ç™½æœ‰è¿™ä¹ˆå¤šçš„ç»¿æ°´é’å±±ï¼Œè¿ç¥åŒ»åä½—æ‹¿å°å°çš„è¡€å¸è™«ä¹Ÿæ²¡æœ‰æ ¹æ²»çš„åŠæ³•ã€‚<br>è®¸å¤šæ‘åº„è’è‰ä¸›ç”Ÿï¼Œæ³æ— äººè¿¹ï¼Œç˜Ÿç–«æ— æƒ…è”“å»¶ï¼Œåƒé—¨ä¸‡æˆ·å®¶ç ´äººäº¡ï¼Œå¬åˆ°çš„åªæ˜¯é¬¼åœ¨å”±æ­Œã€‚<br>ååœ¨åœ°çƒä¸Šæ¯å¤©è¡Œèµ°å…«ä¸‡é‡Œçš„è·¯ç¨‹ï¼Œæ²¿ç€å¤©è·¯é¥é¥åœ°çœ‹è¿‡æµ©æ¸ºçš„é“¶æ²³ã€‚<br>ç‰›éƒå¦‚é—®èµ·è¡€å¸è™«ç—…çš„äº‹ï¼Œä¸€åˆ‡æ‚²æ¬¢ç¦»åˆéƒ½å·²éšç€æ—¶å…‰çš„æµé€è€Œæˆä¸ºè¿‡å»ã€‚</p>
<p>æ˜¥é£å¹æ‹‚æ¨æŸ³æ–°ç»¿ï¼Œæ–°ä¸­å›½ä¸€ç‰‡æ˜¥æ„ç›ç„¶ï¼Œå…­äº¿äººæ°‘æ„æ°”é£å‘ï¼Œä¸ªä¸ªéƒ½åƒå¤ä»£çš„å°§èˆœä¸€æ ·ã€‚<br>è½èŠ±éšç€è‡ªå·±çš„å¿ƒæ„ç¿»æ³¢é€æµªï¼Œé’å±±æœ‰æ„åŒ–å´å²–é™©é˜»ä¸ºåº·åº„å¤§é“ã€‚<br>äººæ°‘ç¾¤ä¼—æŒ¥åŠ¨é“¶å…‰é—ªé—ªçš„é“é”„ï¼ŒæŒ¥èˆç€åšå®çš„è‡‚è†€ï¼Œå…´ä¿®æ°´åˆ©ï¼Œæ•´æ²»å±±æ²³ï¼Œä½¿å¤§åœ°éƒ½ä¸ºä¹‹é¢¤åŠ¨ã€‚<br>è¯•é—®ç˜Ÿç¥å•Šï¼Œä½ è¦å¾€å“ªé‡Œå»ï¼Ÿäººä»¬ç„šåŒ–çº¸é’±ï¼Œç‚¹èµ·æ˜çƒ›ï¼Œç«å…‰æ˜äº®ï¼Œç…§è€€å¤©ç©ºï¼Œä»¥æ­¤æ¥é€èµ°ç˜Ÿç¥ã€‚</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>è¯—è¯</category>
      </categories>
      <tags>
        <tag>è¯—è¯</tag>
        <tag>ä¸»å¸­è¯—è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡å¿ƒè·³å¯¼è‡´dubboè°ƒç”¨å¶ç°å¤±è´¥é—®é¢˜æ’æŸ¥</title>
    <url>//2023-02-09-dubbo-heartbeat-fail/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><h2 id="åº”ç”¨æ‹“æ‰‘"><a href="#åº”ç”¨æ‹“æ‰‘" class="headerlink" title="åº”ç”¨æ‹“æ‰‘"></a>åº”ç”¨æ‹“æ‰‘</h2><ul>
<li>SystemAä½œä¸ºclient, é€šè¿‡dubboæ¥å£è°ƒç”¨SystemBæä¾›çš„æŸä¸ªæœåŠ¡</li>
<li>SystemBç”±2å°æœºå™¨ç»„æˆä¸€ä¸ªé›†ç¾¤, å³ SystemB.45 SystemB.46</li>
</ul>
<pre class="mermaid">graph TD
    A[SystemA] --> |dubbo| B[SystemB.45];
        A[SystemA] --> |dubbo| C[SystemB.46];</pre>


<h2 id="è¯¦ç»†é—®é¢˜"><a href="#è¯¦ç»†é—®é¢˜" class="headerlink" title="è¯¦ç»†é—®é¢˜"></a>è¯¦ç»†é—®é¢˜</h2><p>SystemAè°ƒç”¨SystemBçš„æœåŠ¡æ—¶:</p>
<ol>
<li><p>SystemAæ—¥å¿—ä¸­æŒç»­æ€§å‡ºç°è°ƒç”¨SystemBå¤±è´¥, è¯¦ç»†é”™è¯¯ä¿¡æ¯å¦‚ä¸‹:</p>
</li>
<li><p>ä¸”<strong>SystemAæŠ¥é”™æ—¥å¿—éƒ½å›ºå®šå‡ºç°åœ¨SystemB.46è¿™å°æœºå™¨ä¸Š</strong></p>
</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092122356.png"></p>
<h1 id="é—®é¢˜1-ä¸ºå•¥å‡ºç°â€channel-is-closedâ€é”™è¯¯-ä»è€Œå¯¼è‡´è°ƒç”¨å¤±è´¥"><a href="#é—®é¢˜1-ä¸ºå•¥å‡ºç°â€channel-is-closedâ€é”™è¯¯-ä»è€Œå¯¼è‡´è°ƒç”¨å¤±è´¥" class="headerlink" title="é—®é¢˜1: ä¸ºå•¥å‡ºç°â€channel is closedâ€é”™è¯¯, ä»è€Œå¯¼è‡´è°ƒç”¨å¤±è´¥?"></a>é—®é¢˜1: ä¸ºå•¥å‡ºç°â€channel is closedâ€é”™è¯¯, ä»è€Œå¯¼è‡´è°ƒç”¨å¤±è´¥?</h1><h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡:"></a>ç°è±¡:</h2><p>æ ¹æ®æºä»£ç åˆ†æåªæœ‰åº•å±‚TCPè¿æ¥å…³é—­, æ‰ä¼šæœ‰è¯¥é”™è¯¯æŠ¥å‡º. ä½†ä¸ºå•¥TCPè¿æ¥ä¼šå…³é—­?</p>
<ol>
<li>æ˜¯å› ä¸ºç½‘ç»œé—ªæ–­ä¹ˆ? ç†è®ºä¸Šå†…ç½‘ç¯å¢ƒä¸‹, é“¾è·¯å¯é , ä¸åº”è¯¥é¢‘ç¹å‘ç”Ÿ.</li>
<li>æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­? or æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­?</li>
</ol>
<p>æŒ‰ç…§100msä¸€æ¬¡æ‰“å°æŸä¸ªdubboæœåŠ¡çš„TCPè¿æ¥çŠ¶æ€. å‘ç°æ¯éš”2~5min, dubboçš„TCPè¿æ¥å°±ä¼šé‡å»º. è€Œä¸”è§‚å¯Ÿåˆ°é‡å»ºæ—¶æ˜¯Providerå¤„äºTIME_WAITçŠ¶æ€, ä¹Ÿå°±çŸ¥é“æ˜¯Providerä¸»åŠ¨å…³é—­è¿æ¥çš„.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092124462.png"><br>åŸºæœ¬å¯ä»¥ç¡®è®¤, TCPè¿æ¥æ˜¯æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­çš„.</p>
<h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› :"></a>åŸå› :</h2><ol>
<li><strong>å› ä¸ºproviderä¸»åŠ¨æŠŠè¿æ¥ç©ºé—²å…³é—­æ‰äº†</strong></li>
</ol>
<p>æŸ¥çœ‹æœåŠ¡ç«¯hsf-remoting.log, å‘ç°å¦‚ä¸‹é¢‘ç¹çš„å…³é—­TCPæ—¥å¿—.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092126521.png"></p>
<ol start="2">
<li>Providerçš„HSFç‰ˆæœ¬2.2.10.1, æŸ¥çœ‹å¯¹åº”ä»£ç , å‘ç°ä½¿ç”¨çš„æ˜¯Netty io.netty.handler.timeout.IdleStateHandler æ–¹å¼è¿›è¡Œé“¾è·¯ç©ºé—²æ£€æµ‹, é»˜è®¤è¶…è¿‡ 90s æ²¡æœ‰æ•°æ®ä¼ è¾“, Providerå°±ä¼šä¸»åŠ¨å…³é—­TCPè¿æ¥.</li>
<li>Consumerä¾§, æŠ›é”™çš„åœ°ç‚¹æ˜¯: com.alibaba.dubbo.remoting.transport.AbstractClient#send , å³åœ¨å‘é€æ•°æ®åŒ…æ—¶å‘ç°TCPè¿æ¥å·²å…³é—­, æŠ›å‡ºå¼‚å¸¸.</li>
</ol>
<h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³:"></a>è§£å†³:</h2><h3 id="æ–¹æ¡ˆ1-å¢å¤§ç©ºé—²é˜ˆå€¼"><a href="#æ–¹æ¡ˆ1-å¢å¤§ç©ºé—²é˜ˆå€¼" class="headerlink" title="æ–¹æ¡ˆ1: å¢å¤§ç©ºé—²é˜ˆå€¼"></a>æ–¹æ¡ˆ1: å¢å¤§ç©ºé—²é˜ˆå€¼</h3><p>å¢åŠ å¦‚ä¸‹å¯åŠ¨å‚æ•°, æ‰©å¤§æœåŠ¡ç«¯ç©ºé—²æ—¶é•¿, 15min; ä¸€èˆ¬SystemAè°ƒç”¨ä¸å¤ªä¼š15minéƒ½æ²¡æœ‰è¯·æ±‚, æ¯æ¬¡ä¸šåŠ¡è¯·æ±‚è¿›æ¥, ä¹Ÿéƒ½ä¼šé‡ç½®æ—¶é—´, åŸºæœ¬èƒ½ä¿è¯TCPé•¿è¿ä¸æ–­.</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span><span class="token class-name">Dhsf</span><span class="token punctuation">.</span>server<span class="token punctuation">.</span>idle<span class="token punctuation">.</span>time<span class="token operator">=</span><span class="token number">900</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å¢åŠ å‚æ•°ä¹‹å, æŸ¥çœ‹ hsf-remoting.log, å°±æ²¡æœ‰é¢‘ç¹çš„CloseIdleæ—¥å¿—äº†, æŸ¥çœ‹TCPè¿æ¥, å‘ç°è¿æ¥ç«¯å£é•¿æœŸä¿æŒç¨³å®š, æ²¡æœ‰å†å‘ç”Ÿé‡å»º, æŸ¥çœ‹çº¿ä¸Šé”™è¯¯æ—¥å¿—, å‘ç°è¯¥é”™è¯¯æ¶ˆå¤±, é—®é¢˜è§£å†³.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092127153.png"></p>
<h3 id="æ–¹æ¡ˆ2-ç¼©çŸ­å¿ƒè·³é—´éš”"><a href="#æ–¹æ¡ˆ2-ç¼©çŸ­å¿ƒè·³é—´éš”" class="headerlink" title="æ–¹æ¡ˆ2: ç¼©çŸ­å¿ƒè·³é—´éš”"></a>æ–¹æ¡ˆ2: ç¼©çŸ­å¿ƒè·³é—´éš”</h3><p>å‡å°å®¢æˆ·ç«¯å¿ƒè·³å‘é€é—´éš”. (dubbo é»˜è®¤å¿ƒè·³åŒ…é—´éš”ä¸º 60s)<br>åœ¨<code>dubbo-config.xml</code>ä¸»é…ç½®æ–‡ä»¶é‡Œ, å¢åŠ å¦‚ä¸‹é…ç½®:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dubbo<span class="token punctuation">"</span></span> <span class="token attr-name">heartbeat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="æœ€ç»ˆæ–¹æ¡ˆ-ç¼©çŸ­å¿ƒè·³é—´éš”"><a href="#æœ€ç»ˆæ–¹æ¡ˆ-ç¼©çŸ­å¿ƒè·³é—´éš”" class="headerlink" title="æœ€ç»ˆæ–¹æ¡ˆ: ç¼©çŸ­å¿ƒè·³é—´éš”"></a>æœ€ç»ˆæ–¹æ¡ˆ: ç¼©çŸ­å¿ƒè·³é—´éš”</h3><ul>
<li>æ–¹æ¡ˆ1ä¸»è¦é—®é¢˜æ˜¯æ”¹é€ é‡å¤§, éœ€è¦ä¿®æ”¹åº”ç”¨çš„éƒ¨ç½²è„šæœ¬, è€Œæœ¬èº«åº”ç”¨æ˜¯æœªdockeråŒ–çš„, éƒ¨ç½²è„šæœ¬åœ¨aoneä¸­éœ€è¦å•ç‹¬çš„ç¯å¢ƒåŒ…å‘å¸ƒ. ä¸€æ—¦å…¶ä»–ç¯å¢ƒåˆå§‹åŒ–æ²¡æœ‰å¢æ·»è¯¥é…ç½®, å°±ä¼šå¯¼è‡´é—®é¢˜é‡ç°. è€Œä¿®æ”¹ä»£ç é…ç½®æ–‡ä»¶åˆ™æ›´å¥½ç»´æŠ¤.</li>
<li>æ–¹æ¡ˆ1ä¹Ÿæœ‰ä¼˜åŠ¿, å³å¿ƒè·³åŒ…å‘é€é¢‘ç‡ä½, 60sä¸€æ¬¡, è€Œéæ–°ä¿®æ”¹çš„20sä¸€æ¬¡, å¯¹consumerä¾§å‹åŠ›ä¼šå°ä¸€äº›.<br>ä½†ç»¼åˆè€ƒè™‘, å¿ƒè·³åŒ…é¢‘ç‡å¢åŠ å¯¹åº”ç”¨å‹åŠ›ä»£ä»·å…¶å®å¾ˆå°, æœ€ç»ˆå†³å®šé€‰æ‹©æ–¹æ¡ˆ2.</li>
</ul>
<h1 id="é—®é¢˜2-ä¸ºå•¥channel-is-closedå¼‚å¸¸ä¿¡æ¯ä¸­-æ€»æ˜¯é›†ä¸­åœ¨æŸä¸ªç‰¹å®šprovider-channel-closed"><a href="#é—®é¢˜2-ä¸ºå•¥channel-is-closedå¼‚å¸¸ä¿¡æ¯ä¸­-æ€»æ˜¯é›†ä¸­åœ¨æŸä¸ªç‰¹å®šprovider-channel-closed" class="headerlink" title="é—®é¢˜2: ä¸ºå•¥channel is closedå¼‚å¸¸ä¿¡æ¯ä¸­, æ€»æ˜¯é›†ä¸­åœ¨æŸä¸ªç‰¹å®šprovider channel closed?"></a>é—®é¢˜2: ä¸ºå•¥channel is closedå¼‚å¸¸ä¿¡æ¯ä¸­, æ€»æ˜¯é›†ä¸­åœ¨æŸä¸ªç‰¹å®šprovider channel closed?</h1><h2 id="ç°è±¡-1"><a href="#ç°è±¡-1" class="headerlink" title="ç°è±¡:"></a>ç°è±¡:</h2><p>å¦‚ cn-chengdu, SystemAè°ƒç”¨SystemBæ—¥å¿—, æ€»æ˜¯è¯´ SystemB.46:12200 çš„channel closed, è€Œå¦å¤–ä¸€ä¸ªprovider SystemB.45:12200 ä»æ¥æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092128763.png"></p>
<ol>
<li><p>éš¾é“è¯´åªæœ‰SystemB.46çš„TCPè¿æ¥ä¼šIdleé‡å»º, SystemB.45 å°±ä¸ä¼šé‡å»ºä¹ˆ?</p>
<ol>
<li>å¹¶ä¸æ˜¯, æŸ¥çœ‹ SystemB.45 çš„ hsf-remoting.log æ—¥å¿—, å‘ç°ä¸ 46 åŸºæœ¬ç›¸åŒ, TCPè¿æ¥ä¼šé¢‘ç¹é‡å»º.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092129160.png"></li>
</ol>
</li>
<li><p>ä¸ºå•¥æ²¡æœ‰æŠ¥å‡º: SystemB.45 channel is closed å‘¢?</p>
</li>
</ol>
<h2 id="åŸå› -1"><a href="#åŸå› -1" class="headerlink" title="åŸå› :"></a>åŸå› :</h2><ul>
<li>æ ¹æœ¬åŸå› æ˜¯dubbo clientå‘èµ·RPCè°ƒç”¨å‰ è¿æ¥çŠ¶æ€æ£€æµ‹ + failoverç­–ç•¥ å¯¼è‡´çš„:</li>
</ul>
<ol>
<li><p>dubbo clientå‘èµ·è°ƒç”¨æ—¶, com.alibaba.dubbo.rpc.cluster.support.FailoverClusterInvoker#doInvoke</p>
</li>
<li><p>ä¼šä½¿ç”¨ com.alibaba.dubbo.rpc.cluster.support.AbstractClusterInvoker#select æ¥é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„provider(ä»£ç é‡Œå«invokers), æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092130342.png"></p>
</li>
<li><p>loadbalance.select(invokers, getUrl(), invocation); éšæœºé€‰æ‹©ä¸€ä¸ªprovider(ä¾‹å¦‚ SystemB.45 ), selectedä¸ºnull, å¦‚æœ SystemB.45å¯¹åº”çš„TCPè¿æ¥å…³é—­, åˆ™ invoker.isAvailable() ä¸ºfalse, ä»è€Œè¿›å…¥ reselectæµç¨‹, å¦‚æœ 46å¯¹åº”çš„TCPè¿æ¥ä¹Ÿå…³é—­, åˆ™ reselect è¿”å›çš„rinvokerä¸ºnull, ä»è€Œè¿›å…¥</p>
</li>
<li><p>æ‰€æœ‰å¯èƒ½caseå¦‚ä¸‹, å¯ä»¥çŸ¥é“æŠ›å‡ºå¼‚å¸¸æ—¶, è‚¯å®šé”™è¯¯ä¿¡æ¯æ˜¯46å¤±è´¥, å› æ­¤å°±è§£é‡Šäº†ä¸Šè¾¹çš„é—®é¢˜.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>45æœºå™¨çŠ¶æ€</th>
<th>46æœºå™¨çŠ¶æ€</th>
<th>loadbalanceç»“æœ</th>
<th>æœ€ç»ˆAbstractClusterInvoker#selectç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>45 TCPæ­£å¸¸</td>
<td>46 TCPæ­£å¸¸</td>
<td>é€‰ä¸­45</td>
<td>ç›´æ¥ä½¿ç”¨45ä½œä¸ºprovider, ä¸ä¼šæŠ›å‡ºå¼‚å¸¸.</td>
</tr>
<tr>
<td>45 TCPæ­£å¸¸</td>
<td>46 TCPæ­£å¸¸</td>
<td>é€‰ä¸­46</td>
<td>ç›´æ¥ä½¿ç”¨46ä½œä¸ºprovider, ä¸ä¼šæŠ›å‡ºå¼‚å¸¸.</td>
</tr>
<tr>
<td>45 TCPæ­£å¸¸</td>
<td>46 TCPå¼‚å¸¸</td>
<td>é€‰ä¸­45</td>
<td>ç›´æ¥ä½¿ç”¨45ä½œä¸ºprovider, ä¸ä¼šæŠ›å‡ºå¼‚å¸¸.</td>
</tr>
<tr>
<td>45 TCPæ­£å¸¸</td>
<td>46 TCPå¼‚å¸¸</td>
<td>é€‰ä¸­46</td>
<td>è°ƒç”¨å‰reselectåˆ°45, ä»è€Œè°ƒç”¨æˆåŠŸ, ä¸ä¼šæŠ›å‡ºå¼‚å¸¸.</td>
</tr>
<tr>
<td>45 TCPå¼‚å¸¸</td>
<td>46 TCPæ­£å¸¸</td>
<td>é€‰ä¸­45</td>
<td>è°ƒç”¨å‰reselectåˆ°46, ä»è€Œè°ƒç”¨æˆåŠŸ, ä¸ä¼šæŠ›å‡ºå¼‚å¸¸.</td>
</tr>
<tr>
<td>45 TCPå¼‚å¸¸</td>
<td>46 TCPæ­£å¸¸</td>
<td>é€‰ä¸­46</td>
<td>ç›´æ¥ä½¿ç”¨46ä½œä¸ºprovider, ä¸ä¼šæŠ›å‡ºå¼‚å¸¸.</td>
</tr>
<tr>
<td>45 TCPå¼‚å¸¸</td>
<td>46 TCPå¼‚å¸¸</td>
<td>é€‰ä¸­45</td>
<td>ç”±äº45çš„indexä¸º0, index+1, ä»è€Œå°±å°è¯•failoveråˆ°46, è¿”å›46. åç»­åœ¨invokeæ—¶, ç”±äº46ä¹Ÿæ˜¯å…³é—­, å› æ­¤æŠ›å‡º46å¤±è´¥.</td>
</tr>
<tr>
<td>45 TCPå¼‚å¸¸</td>
<td>46 TCPå¼‚å¸¸</td>
<td>é€‰ä¸­46</td>
<td>ç”±äº46çš„indexä¸º1, ä¸å†index+1(å¦åˆ™å°±IndexOutOfBoundsExceptionå•¦), ä»è€Œè¿”å›46. åç»­åœ¨invokeæ—¶, ç”±äº46ä¹Ÿæ˜¯å…³é—­çš„, å› æ­¤æŠ›å‡º46å¤±è´¥.</td>
</tr>
</tbody></table>
<ol start="3">
<li>ç”±æ­¤å¯ä»¥ä¸‹ç»“è®º, å½“providersæ•°é‡&gt;&#x3D;2æ—¶, åœ¨å‘ç”Ÿè¯¥å¼‚å¸¸æ—¶, æŠ¥é”™ä¿¡æ¯é‡Œå¿…ç„¶ä¸ä¼šæœ‰ç¬¬ä¸€ä¸ªprovider, å› ä¸ºç¬¬ä¸€ä¸ªproviderå¤±è´¥, ä¼šindex+1, è¿”å›ç¬¬2ä¸ª. ä»¥åŒæ ·æŠ›é”™çš„â€SystemCâ€ä¸ºä¾‹è¿›è¡Œè§‚å¯Ÿ, éªŒè¯äº†è¯¥çŒœæƒ³:<ol>
<li>æŠ›å‡ºçš„channel is closedä¿¡æ¯ä¸­, provideråªæœ‰, â€œSystemC.40â€  â€œSystemC.173â€ â€œSystemC.240â€ â€œSystemC.17â€ â€œSystemC.174â€ , è€Œæ²¡æœ‰æ’åœ¨ç¬¬ä¸€ä¸ª   SystemC.183 è¿™ä¸ªprovider.</li>
</ol>
</li>
</ol>
<h1 id="é—®é¢˜3-ä¸ºå•¥channelä¼šç©ºé—²è¢«å…³é—­-å¿ƒè·³ä¿æ´»æœºåˆ¶å¤±æ•ˆäº†ä¹ˆ"><a href="#é—®é¢˜3-ä¸ºå•¥channelä¼šç©ºé—²è¢«å…³é—­-å¿ƒè·³ä¿æ´»æœºåˆ¶å¤±æ•ˆäº†ä¹ˆ" class="headerlink" title="é—®é¢˜3: ä¸ºå•¥channelä¼šç©ºé—²è¢«å…³é—­? å¿ƒè·³ä¿æ´»æœºåˆ¶å¤±æ•ˆäº†ä¹ˆ?"></a>é—®é¢˜3: ä¸ºå•¥channelä¼šç©ºé—²è¢«å…³é—­? å¿ƒè·³ä¿æ´»æœºåˆ¶å¤±æ•ˆäº†ä¹ˆ?</h1><p>dubboclient, é»˜è®¤ä¼š60så‘é€ä¸€æ¬¡å¿ƒè·³åŒ…, æ‰€ä»¥æœåŠ¡ç«¯ç©ºé—²timeoutæ˜¯90s&gt;60s, ç†è®ºä¸Šé“¾è·¯åº”è¯¥ä¸€ç›´ä¿æ´», ä½†ä¸ºå•¥?</p>
<h2 id="ç°è±¡-2"><a href="#ç°è±¡-2" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><p>å®é™…ç”¨tcpdumpæŸ¥çœ‹äº†ä¸‹, å‘ç°ç¨³å®šæ˜¯2minä¸€æ¬¡çš„å¿ƒè·³, ä¸ºå•¥ä¸æ˜¯1minä¸€æ¬¡?<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092131119.png"></p>
<ul>
<li>ä¸Šè¾¹tcpdumpå‡ºæ¥çš„ç¡®å®šæ˜¯å¿ƒè·³åŒ…ä¹ˆ?</li>
<li>æ˜¯å¿ƒè·³åŒ…! å¦‚ä¸‹TCPåŒ…æ•°æ®æ®µå†…å®¹ä¸º: dabbe200000000000005d772000000014e æŸ¥çœ‹ä»£ç :<br><em>com.alibaba.dubbo.remoting.exchange.codec.ExchangeCodec#encodeRequest</em>, å¯çŸ¥å†…å®¹ç¬¦åˆdubboå¿ƒè·³åŒ…åè®®:</li>
</ul>
<ol>
<li>ä»¥ 0xdabb ä¸ºå¼€å¤´</li>
<li>isTwoWay, isEventéƒ½ä¸ºtrue; å› æ­¤æŒ‰ç…§å¦‚ä¸‹è¿ç®—å¯çŸ¥, ç¬¬ä¸‰ä¸ªå­—èŠ‚æ˜¯ 0xe2</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">header<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>FLAG_REQUEST <span class="token operator">|</span> serialization<span class="token punctuation">.</span><span class="token function">getContentTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">isTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> header<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> FLAG_TWOWAY<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">isEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> header<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> FLAG_EVENT<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>å¿ƒè·³åŒ…çš„mDataä¸ºnull, é€šè¿‡hessian2åºåˆ—åŒ–ä¹‹å, <em>com.alibaba.com.caucho.hessian.io.Hessian2Output#writeNull</em>, nullå ç”¨ä¸€ä¸ªå­—èŠ‚, ä¼šè¢«é»˜è®¤å†™ä½œ N</li>
<li>æ•´ä¸ªTCP Payloadä¸º17ä¸ªå­—èŠ‚, åŒ…æ‹¬ 16ä¸ªå­—èŠ‚çš„dubboåè®®å¤´ +  1ä¸ªå­—èŠ‚çš„0x4e(å³ä¸ºNçš„ASCIIç ), ç¬¦åˆå®é™…æŠ“åŒ…æƒ…å†µ.</li>
</ol>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092131065.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092132229.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302092133191.png"></p>
<h2 id="åŸå› -2"><a href="#åŸå› -2" class="headerlink" title="åŸå› "></a>åŸå› </h2><ul>
<li>æ ¹æœ¬åŸå› æ˜¯ com.alibaba.dubbo.remoting.exchange.support.header.HeartBeatTask è®¾è®¡ç¼ºé™·å¯¼è‡´.</li>
</ul>
<ol>
<li>HeartBeatTask æ˜¯åœ¨com.alibaba.dubbo.remoting.exchange.support.header.HeaderExchangeServer#startHeatbeatTimerè¿›è¡Œå¯åŠ¨, ä½¿ç”¨ScheduledExecutorService, å®šæ—¶æ‰§è¡Œé—´éš”æ—¶é—´ä¸ºheartbeatå€¼, å³ä¸º60s(60000ms)ä¸€æ¬¡.</li>
<li>HeartBeatTask æ‰§è¡Œå…·ä½“å®ç°(åˆ é™¤äº†ä¸æœ¬é—®é¢˜ä¸ç›¸å…³çš„ä»£ç ):</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token class-name">Channel</span> channel <span class="token operator">:</span> channelProvider<span class="token punctuation">.</span><span class="token function">getChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Long</span> lastRead <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token class-name">Long</span> <span class="token punctuation">)</span> channel<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>
                <span class="token class-name">HeaderExchangeHandler</span><span class="token punctuation">.</span>KEY_READ_TIMESTAMP <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> lastWrite <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token class-name">Long</span> <span class="token punctuation">)</span> channel<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>
                <span class="token class-name">HeaderExchangeHandler</span><span class="token punctuation">.</span>KEY_WRITE_TIMESTAMP <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span> lastRead <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> now <span class="token operator">-</span> lastRead <span class="token operator">></span> heartbeat <span class="token punctuation">)</span> <span class="token comment">// æ³¨æ„: è¿™é‡Œçš„heartbeatæ˜¯60000ms</span>
                <span class="token operator">||</span> <span class="token punctuation">(</span> lastWrite <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> now <span class="token operator">-</span> lastWrite <span class="token operator">></span> heartbeat <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Request</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            req<span class="token punctuation">.</span><span class="token function">setVersion</span><span class="token punctuation">(</span> <span class="token string">"2.0.0"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            req<span class="token punctuation">.</span><span class="token function">setTwoWay</span><span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            req<span class="token punctuation">.</span><span class="token function">setEvent</span><span class="token punctuation">(</span> <span class="token class-name">Request</span><span class="token punctuation">.</span>HEARTBEAT_EVENT <span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span> req <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span> <span class="token string">"Send heartbeat to remote channel "</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                      <span class="token operator">+</span> <span class="token string">", cause: The channel has no data-transmission exceeds a heartbeat period: "</span> <span class="token operator">+</span> heartbeat <span class="token operator">+</span> <span class="token string">"ms"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>é—®é¢˜å¤ç°:<ol>
<li>2022å¹´09æœˆ27æ—¥18:53:00,000 è§¦å‘ä¸€æ¬¡HeartBeatTask, å‡è®¾æœ¬æ¬¡æ‰§è¡Œåˆ° channel.send(req), å³å‘é€äº†å¿ƒè·³åŒ….</li>
<li>ç”±äºå‘é€äº†å¿ƒè·³åŒ…, å› æ­¤channelçš„ lastWrite ä¼šè¢«æ›´æ–° å‡è®¾è¢«æ›´æ–°ä¸º 2022å¹´09æœˆ27æ—¥18:53:00,001 (æ³¨æ„è¿™ä¸ªæ—¶é—´ä¸æ‰§è¡ŒHeartBeatTaskä¼šæœ‰å‡ æ¯«ç§’å·®å¼‚, å› ä¸ºnettyå¤„ç†ä¼šè€—æ—¶)</li>
<li>2022å¹´09æœˆ27æ—¥18:54:00,000 å†æ¬¡è§¦å‘ä¸€æ¬¡HeartBeatTask, å½“å‰æ—¶é—´(å³ä¸º2022å¹´09æœˆ27æ—¥18:54:00,000) - lastWrite(2022å¹´09æœˆ27æ—¥18:53:00,001) ä¸º 59999ms &lt; 60000ms, å› æ­¤æœ¬æ¬¡ä¸å†å‘é€å¿ƒè·³åŒ….</li>
<li>2022å¹´09æœˆ27æ—¥18:55:00,000 å†æ¬¡è§¦å‘ä¸€æ¬¡HeartBeatTask, å½“å‰æ—¶é—´(å³ä¸º2022å¹´09æœˆ27æ—¥18:55:00,000) - lastWrite(2022å¹´09æœˆ27æ—¥18:53:00,001) ä¸º 119999ms &gt; 60000ms, å› æ­¤æœ¬æ¬¡å‘é€å¿ƒè·³åŒ….  ä»ä¸Šæ¬¡å¿ƒè·³åŒ…åˆ°è¿™æ¬¡, åˆšå¥½é—´éš”ä¸º2min.</li>
</ol>
</li>
<li>å› æ­¤åœ¨é“¾è·¯ç©ºé—²æ—¶, <strong>ä¸¤æ¬¡å¿ƒè·³çš„é—´éš”ç¨³å®šä¸º120s &gt; HSFæœåŠ¡ç«¯çš„90s</strong>, å› æ­¤æœåŠ¡ç«¯ä¼šé¢‘ç¹åœ°å…³é—­è¿æ¥!</li>
</ol>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>dubboclientåœ¨è¿›è¡Œfailoverä¹‹å, æŠ¥é”™ä¿¡æ¯ä¸ç›´è§‚, ä¸€ç›´åœ¨æŠ¥46è°ƒç”¨å¤±è´¥, ä»è€Œå¯¼è‡´ä»¥ä¸ºåªæœ‰46è¿™å°provideræœ‰é—®é¢˜, ä»è€Œä»¥ä¸ºæ˜¯å•å°æœºå™¨çš„é—®é¢˜, ä»è€Œè¯¯å¯¼äº†æ’æŸ¥æ–¹å‘(ä¾‹å¦‚46è¿™å°æœºå™¨load, ç½‘ç»œç­‰æœ‰å•¥ç‰¹æ®Šé—®é¢˜). å¦‚æœfailoveré€»è¾‘ä¸­, ä¸æ˜¯ç®€å•åœ°æŒ‰ç…§index+1, è€Œæ˜¯ä½¿ç”¨ç¯å½¢æ•°ç»„, è¿™æ ·æŠ¥é”™ä¿¡æ¯ä¼šæŠ¥å‡º45, 46æœ‰é—®é¢˜, ä»è€Œä¸ä¼šè¯¯å¯¼æ’æŸ¥æ–¹å‘.</li>
<li>è¯¥é—®é¢˜åªæœ‰åœ¨dubboclientä¸æ‰€æœ‰çš„providerçš„TCPè¿æ¥éƒ½å…³é—­, ä»è€Œfailoverå¤±è´¥, ä»è€ŒæŠ›å‡ºå¼‚å¸¸. å› æ­¤è¾ƒä¸ºå¶ç°, å¯¼è‡´æ— æ³•ç¨³å®šå¤ç°ä»¥åŠä¿å­˜ç°åœº. (å½“ç„¶ç°åœ¨çŸ¥é“äº†åŸå› , å°±å¯ä»¥é€šè¿‡iptablesæ¥æ¨¡æ‹Ÿé‡ç°è¯¥é—®é¢˜).</li>
<li>æ ¹æœ¬åŸå› è¿˜æ˜¯HSFæœåŠ¡ç«¯å¯¹ä¸dubboclientçš„é€‚é…ä¸å¥½:<ol>
<li>é»˜è®¤å‚æ•°90s+dubboclienté»˜è®¤çš„60s, åœ¨å°æµé‡æƒ…å†µä¸‹å®Œå…¨æ˜¯å‘çˆ¹, åœ¨å¤§æµé‡æƒ…å†µä¸‹, ç”±äºä¸šåŠ¡è¯·æ±‚ä¸€ç›´ä¼šæœ‰, ç›¸å½“äºé€šè¿‡ä¸šåŠ¡è¯·æ±‚æ¥è¿›è¡Œä¿æ´»äº†, å› æ­¤ä¸ä¼šæœ‰æœ¬æ–‡çš„é—®é¢˜.</li>
<li>HSFä½œä¸ºdubboæœåŠ¡ç«¯é˜‰å‰²æ‰äº†dubboåŸç”ŸæœåŠ¡ç«¯çš„åå‘ä¿æ´»èƒ½åŠ›(provider-&gt;client), ä»è€Œå˜æˆäº†å•å‘å¿ƒè·³(client-&gt;provider), å¯é æ€§å·®å¾ˆå¤š.</li>
<li>å¿ƒè·³ä¿æ´»ä½œä¸ºRPCæ¡†æ¶çš„åŸºç¡€, å‡ºç°é—®é¢˜é€šå¸¸æ˜¯æœ€åæ€€ç–‘çš„ç‚¹. è€Œå¦‚æœç”¨dubboä½œä¸ºæœåŠ¡ç«¯, è¦å¯é å¾—å¤š, æœ‰åŒå‘ä¿æ´»æœºåˆ¶, å…·ä½“å¯ä»¥å‚ç…§: <a href="https://dubbo.apache.org/zh/blog/2018/08/19/dubbo-%E7%8E%B0%E6%9C%89%E5%BF%83%E8%B7%B3%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93%E4%BB%A5%E5%8F%8A%E6%94%B9%E8%BF%9B%E5%BB%BA%E8%AE%AE/?spm=ata.21736010.0.0.318e4799tOQZt9">dubbo-ç°æœ‰å¿ƒè·³æ–¹æ¡ˆæ€»ç»“ä»¥åŠæ”¹è¿›å»ºè®®</a></li>
</ol>
</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>dubbo</tag>
        <tag>heartbeat</tag>
      </tags>
  </entry>
  <entry>
    <title>å·¥ä½œæµæ¡†æ¶ä¸­IDä¸Tokenä½¿ç”¨å¼•å‘çš„æ€è€ƒ</title>
    <url>//2023-02-09-inner-id-outer-id-design/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨ä½¿ç”¨å·¥ä½œæµæ¡†æ¶æ—¶, å‘ç°token&#x2F;idå­—æ®µéå¸¸å¤š, å°¤å…¶æ˜¯</p>
<ul>
<li>workflow_id</li>
<li>biz_id</li>
</ul>
<p>è¿™ä¸¤ä¸ªçš„æ ¼å¼éƒ½æ˜¯UUID, éƒ½æ˜¯å”¯ä¸€çš„.<br><img data-src="https://intranetproxy.alipay.com/skylark/lark/0/2021/png/18490/1629896347576-a7614293-1ddc-4d13-9f9a-e48248cfac62.png#clientId=u1f1ec6f0-275f-4&from=paste&height=683&id=u52913c82&name=image.png&originHeight=938&originWidth=762&originalType=binary&ratio=1&rotation=0&showTitle=false&size=547248&status=done&style=none&taskId=u9488ccd6-246c-4b06-8e39-5b5ea32309a&title=&width=555" alt="image.png"><br>è¿™ä¸¤ä¸ªåˆ†åˆ«ä»£è¡¨å•¥?</p>
<ul>
<li>biz_idæ˜¯å¤–éƒ¨ä¼ å…¥çš„ä¸šåŠ¡å”¯ä¸€ID, å®¢æˆ·ç«¯æ’æŸ¥é—®é¢˜æ—¶å¯ä»¥ä½¿ç”¨. ä½œä¸ºå¤–éƒ¨ä¸»é”®<ul>
<li>ä¸€ä¸ªbiz_idä»£è¡¨ä¸€æ¬¡ä¸šåŠ¡è¯·æ±‚, å¯èƒ½ä¼šå¯¹åº”å¤šä¸ªworkflow_id;</li>
<li>ä¾‹å¦‚ åˆ›å»ºECSå®ä¾‹çš„ä¸€æ¬¡è¯·æ±‚, å¯¹åº”ä¸€ä¸ªbiz_id(request_id), ä½†ä¼šå¯¹åº”å¤šä¸ªworkflowçš„ç¼–æ’, å› æ­¤ä¸èƒ½æŠŠbiz_idä½œä¸ºå”¯ä¸€é”®(ä¼šå¯¼è‡´workflow_instanceå”¯ä¸€é”®å†²çª), ä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨workflow_id(ä¼šå¯¼è‡´æ— æ³•traceåˆ°æ•´ä¸ªè¯·æ±‚)</li>
</ul>
</li>
<li>workflow_idæ˜¯ç³»ç»Ÿå†…éƒ¨ç”Ÿæˆçš„ç³»ç»Ÿå”¯ä¸€ID, å¯ä»¥è®¤ä¸ºæ˜¯å”¯ä¸€ä¸»é”®. ä½œä¸ºå†…éƒ¨ä¸»é”®</li>
</ul>
<h1 id="å‡ ç§æ–¹æ¡ˆ"><a href="#å‡ ç§æ–¹æ¡ˆ" class="headerlink" title="å‡ ç§æ–¹æ¡ˆ"></a>å‡ ç§æ–¹æ¡ˆ</h1><p>ä¸ºä»€ä¹ˆä¸æŠŠbiz_idä¸workflow_idåˆå¹¶æˆä¸€ä¸ª? å¯ä»¥å‡è®¾ä¸‹è¿°å‡ ç§æ–¹æ¡ˆ:</p>
<h2 id="æ–¹æ¡ˆ1-å¤–éƒ¨ä¸ä¼ å…¥biz-id-åªä½¿ç”¨workflow-id"><a href="#æ–¹æ¡ˆ1-å¤–éƒ¨ä¸ä¼ å…¥biz-id-åªä½¿ç”¨workflow-id" class="headerlink" title="æ–¹æ¡ˆ1: å¤–éƒ¨ä¸ä¼ å…¥biz_id, åªä½¿ç”¨workflow_id"></a>æ–¹æ¡ˆ1: å¤–éƒ¨ä¸ä¼ å…¥biz_id, åªä½¿ç”¨workflow_id</h2><ul>
<li>å­˜åœ¨ä¸€ä¸ªå…ˆåä¾èµ–çš„é—®é¢˜: å¦‚æœåœ¨workflow_idç”Ÿæˆå‰å‡ºç°äº†é—®é¢˜, æ ¹æ®å“ªä¸ªæ¥å®šä½è¿™æ¬¡è¯·æ±‚, è¯¥æ€ä¹ˆæ’æŸ¥?</li>
<li>æ— æ³•å®ç°biz_idå¯¹åº”å¤šä¸ªworkflow_idçš„ä¸€å¯¹å¤šå…³ç³»</li>
</ul>
<h2 id="æ–¹æ¡ˆ2-å¤–éƒ¨ä¼ å…¥biz-id-å†…éƒ¨ä¸ç”Ÿæˆæ–°çš„workflow-id"><a href="#æ–¹æ¡ˆ2-å¤–éƒ¨ä¼ å…¥biz-id-å†…éƒ¨ä¸ç”Ÿæˆæ–°çš„workflow-id" class="headerlink" title="æ–¹æ¡ˆ2: å¤–éƒ¨ä¼ å…¥biz_id, å†…éƒ¨ä¸ç”Ÿæˆæ–°çš„workflow_id:"></a>æ–¹æ¡ˆ2: å¤–éƒ¨ä¼ å…¥biz_id, å†…éƒ¨ä¸ç”Ÿæˆæ–°çš„workflow_id:</h2><ul>
<li>å¤–éƒ¨biz_idå¦‚æœç”Ÿæˆçš„ä¸å¯é , æœ‰é‡å¤, ä¼šå¯¼è‡´workflowå·¥ä½œæœºåˆ¶äº§ç”Ÿé—®é¢˜.</li>
<li>ä¸èƒ½ä¿¡ä»»ä»»ä½•å¤–éƒ¨ä¼ å…¥çš„IDä½œä¸ºå†…éƒ¨çš„ä¸»é”®ID</li>
</ul>
<p>æ‰€ä»¥è®¾è®¡ä¸¤ä¸ªIDä¹Ÿæ˜¯åˆç†çš„, ä¸€ä¸ªå†…éƒ¨ID, ä¸€ä¸ªå¤–éƒ¨ID, ç”šè‡³å¯ä»¥è®¤ä¸ºæ˜¯æœ€ä½³å®è·µ.</p>
<h2 id="æ–¹æ¡ˆ3-å¤–éƒ¨ä¼ å…¥biz-id-å†…éƒ¨åŒæ—¶ä¹Ÿç”Ÿæˆworkflow-id"><a href="#æ–¹æ¡ˆ3-å¤–éƒ¨ä¼ å…¥biz-id-å†…éƒ¨åŒæ—¶ä¹Ÿç”Ÿæˆworkflow-id" class="headerlink" title="æ–¹æ¡ˆ3: å¤–éƒ¨ä¼ å…¥biz_id, å†…éƒ¨åŒæ—¶ä¹Ÿç”Ÿæˆworkflow_id"></a>æ–¹æ¡ˆ3: å¤–éƒ¨ä¼ å…¥biz_id, å†…éƒ¨åŒæ—¶ä¹Ÿç”Ÿæˆworkflow_id</h2><ul>
<li>å³å®ç°ä¸Šæœ€ç»ˆé€‰ç”¨çš„æ–¹æ¡ˆ</li>
<li>å½“biz_idä¸workflow_idæ˜¯ä¸€å¯¹ä¸€åœºæ™¯ä¸‹, biz_idé™¤äº†æ–¹ä¾¿è¿›è¡Œå®¢æˆ·ç«¯å®šä½é—®é¢˜, ä¹Ÿå¯ä»¥ä½œä¸ºclient_tokenå®ç°å¹‚ç­‰</li>
</ul>
<h1 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h1><p>å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨clientTokenç”¨æ¥å®ç°å¹‚ç­‰</p>
<ul>
<li><a href="https://next.api.aliyun.com/document/Ecs/2014-05-26/RunInstances">ECS SDKè°ƒç”¨</a>:<ul>
<li>æ”¯æŒæ–¹æ¡ˆ1, å³å®¢æˆ·ç«¯ä¸ä¼ å…¥ä»»ä½•requestIDä¿¡æ¯, è¯·æ±‚å®Œæˆåä¼šè¿”å›å†…éƒ¨ç”Ÿæˆçš„requestID.</li>
<li>ä¹Ÿæ”¯æŒæ–¹æ¡ˆ3, å³å®¢æˆ·ç«¯ä¼ å…¥clientToken, è¯·æ±‚å®Œæˆåä¼šè¿”å›å†…éƒ¨ç”Ÿæˆçš„requestID.</li>
</ul>
</li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/Run_Instance_Idempotency.html">AWS SDKè°ƒç”¨</a>:<ul>
<li>åŒæ ·æ”¯æŒæ–¹æ¡ˆ1ä¸æ–¹æ¡ˆ3;</li>
</ul>
</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>good-design</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„Linuxå‘½ä»¤ä¹‹tcpdump</title>
    <url>//2023-02-10-linux-network-tcpdump-sample/</url>
    <content><![CDATA[<h1 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h1><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302102123138.png"></p>
<h1 id="æ ·ä¾‹"><a href="#æ ·ä¾‹" class="headerlink" title="æ ·ä¾‹"></a>æ ·ä¾‹</h1><h2 id="åº”ç”¨æ‹“æ‰‘"><a href="#åº”ç”¨æ‹“æ‰‘" class="headerlink" title="åº”ç”¨æ‹“æ‰‘"></a>åº”ç”¨æ‹“æ‰‘</h2><pre class="mermaid">graph BT
    B[HostB:anyPort] -..-> |dubbo| A[HostA:12200];</pre>

<h2 id="æ‹“æ‰‘è¯´æ˜"><a href="#æ‹“æ‰‘è¯´æ˜" class="headerlink" title="æ‹“æ‰‘è¯´æ˜"></a>æ‹“æ‰‘è¯´æ˜</h2><ul>
<li>HostAæ˜¯æœåŠ¡ç«¯, å¼€å¯äº†12200æœåŠ¡ç«¯å£</li>
<li>HostBæ˜¯å®¢æˆ·ç«¯, å¼€å¯äº†ä»»æ„ç«¯å£ä¸HostA:12200è¿æ¥</li>
<li>åœ¨HostAä¸Šæ‰§è¡Œtcpdump æŸ¥çœ‹ HostA:12200 &lt;-&gt; HostB çš„é€šä¿¡</li>
</ul>
<h2 id="å‘½ä»¤å®è·µ"><a href="#å‘½ä»¤å®è·µ" class="headerlink" title="å‘½ä»¤å®è·µ"></a>å‘½ä»¤å®è·µ</h2><p>âƒ in é“¾è·¯(å³ä»B â€”&gt;A:12200)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> tcpdump -i eth0 -P <span class="token keyword">in</span> -vv dst port <span class="token number">12200</span> and src <span class="token function">host</span> <span class="token variable">$&#123;hostB&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>âƒ out é“¾è·¯(å³ä»A:12200â€”&gt;B)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> tcpdump -i eth0 -P out -vv src port <span class="token number">12200</span> and dst <span class="token function">host</span> <span class="token variable">$&#123;hostB&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>âƒ inout (å³ä»A:12200&lt;â€”&gt;B)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tcpdump -i eth0  <span class="token function">host</span> <span class="token variable">$&#123;hostB&#125;</span> and port <span class="token number">12200</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>âƒ dump æŠ“å–å…·ä½“åŒ…å†…å®¹, å¯¼å‡ºä¸ºæ–‡ä»¶, ä¾¿äºwiresharkåˆ†æ (æ³¨æ„, è¿™é‡Œå¯¼å‡ºçš„æ–‡ä»¶ä¸ºäºŒè¿›åˆ¶, æ¨èä½¿ç”¨.pcapä½œä¸ºåç¼€å)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> tcpdump -i eth0 -P <span class="token keyword">in</span> -vv dst port <span class="token number">12200</span> and src <span class="token function">host</span> <span class="token variable">$&#123;hostB&#125;</span> -w ~/tcpdump.pcap<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>âƒ è¯»å–tcpdumpæ–‡ä»¶ (æ³¨æ„, è¿™é‡Œè¯»å–çš„æ–‡ä»¶ä¹Ÿä¸ºäºŒè¿›åˆ¶)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> tcpdump -r tcpdump.pcap<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://blog.csdn.net/weixin_36338224/article/details/107035214">linuxä¸‹å¦‚ä½•ä½¿ç”¨ tcpdump è¿›è¡ŒæŠ“åŒ…è¯¦ç»†æ•™ç¨‹</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>code-snippets</tag>
        <tag>linux</tag>
        <tag>network</tag>
        <tag>tcpdump</tag>
      </tags>
  </entry>
  <entry>
    <title>jmockitæµ‹è¯•æ¡†æ¶å¸¸ç”¨æŠ€å·§</title>
    <url>//2023-02-19-jmockit-usage-faq/</url>
    <content><![CDATA[<h1 id="Injectable-ä¸-Mocked-æœ‰å•¥åŒºåˆ«"><a href="#Injectable-ä¸-Mocked-æœ‰å•¥åŒºåˆ«" class="headerlink" title="@Injectable  ä¸ @Mocked æœ‰å•¥åŒºåˆ«?"></a>@Injectable  ä¸ @Mocked æœ‰å•¥åŒºåˆ«?</h1><p><a href="https://www.cnblogs.com/shoren/p/jmokit-summary.html">https://www.cnblogs.com/shoren/p/jmokit-summary.html</a></p>
<ol>
<li>Injectableåªä¼šmockå½“å‰å®ä¾‹</li>
<li>Mockedä¼šmockè¯¥ç±»ä¸‹æ‰€æœ‰å®ä¾‹</li>
</ol>
<p>é’ˆå¯¹ @Tested çš„ç±», æ‰€æœ‰fieldå¿…é¡»ä½¿ç”¨ Injectable æ¥æ³¨å…¥, ä½¿ç”¨ Mocked æ¥æ ‡è¯†çš„properties, ä¸ä¼šè¢«æ³¨å…¥.</p>
<h1 id="å¦‚ä½•æµ‹è¯•privateæ–¹æ³•"><a href="#å¦‚ä½•æµ‹è¯•privateæ–¹æ³•" class="headerlink" title="å¦‚ä½•æµ‹è¯•privateæ–¹æ³•?"></a>å¦‚ä½•æµ‹è¯•privateæ–¹æ³•?</h1><p><code>mockit.Deencapsulation#invoke(java.lang.Object, java.lang.String, java.lang.Object...)</code></p>
<hr>
<h2 id="å¦‚ä½•æµ‹è¯•privateæ–¹æ³•-å¹¶ä¸”ä¼ å…¥nullä½œä¸ºå‚æ•°"><a href="#å¦‚ä½•æµ‹è¯•privateæ–¹æ³•-å¹¶ä¸”ä¼ å…¥nullä½œä¸ºå‚æ•°" class="headerlink" title="å¦‚ä½•æµ‹è¯•privateæ–¹æ³•, å¹¶ä¸”ä¼ å…¥nullä½œä¸ºå‚æ•°?"></a>å¦‚ä½•æµ‹è¯•privateæ–¹æ³•, å¹¶ä¸”ä¼ å…¥nullä½œä¸ºå‚æ•°?</h2><p>ä½¿ç”¨<code>Deencapsulation.invoke</code> æµ‹è¯•privateæ–¹æ³•æ—¶, å¦‚æœéœ€è¦ä¼ å…¥nullä½œä¸ºå‚æ•°, å¦‚æœç›´æ¥ä¼ å…¥null,  ä¼šæŠ¥é”™, æ ·ä¾‹å¦‚ä¸‹:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç¬¬1, ç¬¬3ä¸ªå‚æ•°ä¸ºnull</span>
<span class="token class-name">Deencapsulation</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>testResourceService<span class="token punctuation">,</span> <span class="token string">"testMethod"</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token keyword">null</span><span class="token punctuation">,</span> param1<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> param2<span class="token punctuation">,</span> param3<span class="token punctuation">,</span> param4<span class="token punctuation">,</span> param5<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalArgumentException</span><span class="token operator">:</span> <span class="token class-name">Invalid</span> <span class="token keyword">null</span> value passed as argument <span class="token number">0</span>

	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span></span>ServiceImplTest</span><span class="token punctuation">.</span><span class="token function">testMethod</span><span class="token punctuation">(</span>xxxTest<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1141</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span>JUnit4IdeaTestRunner</span><span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span><span class="token class-name">JUnit4IdeaTestRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">69</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span>IdeaTestRunner</span>$<span class="token class-name">Repeater</span><span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span><span class="token class-name">IdeaTestRunner</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span>JUnitStarter</span><span class="token punctuation">.</span><span class="token function">prepareStreamsAndStart</span><span class="token punctuation">(</span><span class="token class-name">JUnitStarter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">235</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span>JUnitStarter</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">JUnitStarter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">54</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è§£å†³æ–¹æ¡ˆ:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç¬¬1, ç¬¬3ä¸ªå‚æ•°, ä½¿ç”¨ ç±»å.class æ¥ä¼ å…¥</span>
<span class="token class-name">Deencapsulation</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>testResourceService<span class="token punctuation">,</span> <span class="token string">"testMethod"</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> param1<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> param2<span class="token punctuation">,</span> param3<span class="token punctuation">,</span> param4<span class="token punctuation">,</span> param5<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>å‚è§:  <a href="https://stackoverflow.com/questions/23096026/how-to-pass-null-string-to-a-private-method-using-jmockit-while-unit-testing-it">https://stackoverflow.com/questions/23096026/how-to-pass-null-string-to-a-private-method-using-jmockit-while-unit-testing-it</a></p>
<h1 id="å¦‚ä½•mock-staticæ–¹æ³•"><a href="#å¦‚ä½•mock-staticæ–¹æ³•" class="headerlink" title="å¦‚ä½•mock staticæ–¹æ³•"></a>å¦‚ä½•mock staticæ–¹æ³•</h1><p>ä¾‹å¦‚éœ€è¦mock EnvUtil.get() è¿™ä¸ªstaticæ–¹æ³•, å¦‚ä¸‹å³å¯:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">MockUp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnvUtil</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ³¨æ„, è¿™é‡Œä¸è¦åŠ  static æ ‡è¯†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"inventoryResourceProviderUseLocal"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token string">"true"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token string">"false"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å‚è§: <a href="https://www.baeldung.com/jmockit-static-method">https://www.baeldung.com/jmockit-static-method</a></p>
<h1 id="å¦‚ä½•mock-Testedå¯¹è±¡çš„æ–¹æ³•"><a href="#å¦‚ä½•mock-Testedå¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="å¦‚ä½•mock Testedå¯¹è±¡çš„æ–¹æ³•"></a>å¦‚ä½•mock Testedå¯¹è±¡çš„æ–¹æ³•</h1><p>ç”±äº Tested çš„å¯¹è±¡, é€šå¸¸éƒ½æ˜¯å½“å‰UTéœ€è¦æµ‹è¯•çš„å¯¹è±¡æœ¬èº«. åœ¨æµ‹è¯•çš„ç›®æ ‡æ–¹æ³•(å¦‚ä¸‹ä¾‹å­ä¸­çš„calcUserScore), éœ€è¦æœ¬èº«ä¾èµ–åˆ°å½“å‰ç±»çš„å…¶ä»–æ–¹æ³•, ä¸”é€»è¾‘éå¸¸å¤æ‚(ä¾‹å¦‚ä¸‹ä¾‹ä¸­çš„getUserById), åˆ™å¯ä»¥å°†æµ‹è¯•å¯¹è±¡æœ¬èº«çš„éƒ¨åˆ†æ–¹æ³•ä¹Ÿè¿›è¡Œmock. å¦‚ä¸‹:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">JMockit</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceMockTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Tested</span>
    <span class="token class-name">UserServiceImpl</span> userService<span class="token punctuation">;</span>

    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">calcUserScoreTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">new</span> <span class="token class-name">MockUp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserServiceImpl</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@Mock</span>
            <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> uid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        userService<span class="token punctuation">.</span><span class="token function">calcUserScore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å¦‚ä½•mock-Injectableå¯¹è±¡çš„æ–¹æ³•"><a href="#å¦‚ä½•mock-Injectableå¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="å¦‚ä½•mock Injectableå¯¹è±¡çš„æ–¹æ³•"></a>å¦‚ä½•mock Injectableå¯¹è±¡çš„æ–¹æ³•</h1><p>Injectableå¯¹è±¡é€šå¸¸æ˜¯å½“å‰è¦æµ‹è¯•å¯¹è±¡ä¾èµ–çš„å…¶ä»–å¯¹è±¡. æ–¹æ³•å¦‚ä¸‹:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">JMockit</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceMockTest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Tested</span>
    <span class="token class-name">UserServiceImpl</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Injectable</span>
    <span class="token class-name">AddrService</span> addrSvc<span class="token punctuation">;</span>

    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getUsrAddrTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Addr</span> testAddr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Addr</span><span class="token punctuation">(</span><span class="token string">"cn"</span><span class="token punctuation">,</span> <span class="token string">"hangzhou"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Expectations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>
            addrSvc<span class="token punctuation">.</span><span class="token function">getAddrByAddrId</span><span class="token punctuation">(</span>anyLong<span class="token punctuation">)</span><span class="token punctuation">;</span>
            result <span class="token operator">=</span> testAddr<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        
        userService<span class="token punctuation">.</span><span class="token function">getUsrAddr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å¦‚ä½•æ ¹æ®ä¸åŒçš„è¾“å…¥å‚æ•°-å€¼-mockä¸åŒçš„è¾“å‡ºç»“æœ"><a href="#å¦‚ä½•æ ¹æ®ä¸åŒçš„è¾“å…¥å‚æ•°-å€¼-mockä¸åŒçš„è¾“å‡ºç»“æœ" class="headerlink" title="å¦‚ä½•æ ¹æ®ä¸åŒçš„è¾“å…¥å‚æ•°(å€¼), mockä¸åŒçš„è¾“å‡ºç»“æœ"></a>å¦‚ä½•æ ¹æ®ä¸åŒçš„è¾“å…¥å‚æ•°(å€¼), mockä¸åŒçš„è¾“å‡ºç»“æœ</h1><blockquote>
<p>å°¤å…¶æ˜¯åœ¨è¾“å…¥å‚æ•°æ˜¯ä¸ªListçš„æ—¶å€™, éœ€è¦mockä¸åŒçš„è¾“å‡º</p>
</blockquote>
<p>ä»£ç ç‰‡æ®µå¦‚ä¸‹, æ ¸å¿ƒæ˜¯ä½¿ç”¨Delegate, å®Œæ•´æ ·ä¾‹å‚è§:<a href="https://github.com/DavyJones2010/test-core/blob/master/src/test/java/edu/xmu/test/javase/jmockit/JMockitTest.java#L27">JMockitTest.java</a> </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Expectations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// ç”±äºè¿™é‡Œ userDao è¢«mockäº†, å› æ­¤ä¸ä¼šçœŸæ­£å»æ‰§è¡Œ userDao.insert æ–¹æ³•</span>
    userDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> any<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å› æ­¤ä½¿ç”¨ Delegate æ¥æ ¹æ®ä¸åŒçš„inputæ¥mock userDao.insertçš„ä¸åŒoutput;</span>
    <span class="token comment">// å¦‚æœoutputä¸ºvoid, åˆ™ä½¿ç”¨ Delegate&lt;Void></span>
    result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Delegate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æ–¹æ³•ç­¾åéœ€è¦mockçš„æ–¹æ³•`insert`ä¿æŒä¸€è‡´</span>
        <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">User</span> usr<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UserException</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// è¿™é‡Œæ ¹æ®ä¸åŒçš„input(usr), å¯¹ userDao.insert çš„ç»“æœè¿›è¡Œmock</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>usr<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"Wang"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"User is Wang!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UserException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å¦‚ä½•Mock-Injectableçš„Beançš„voidä¸”ä¿®æ”¹äº†å‚æ•°çš„æ–¹æ³•"><a href="#å¦‚ä½•Mock-Injectableçš„Beançš„voidä¸”ä¿®æ”¹äº†å‚æ•°çš„æ–¹æ³•" class="headerlink" title="å¦‚ä½•Mock @Injectableçš„Beançš„voidä¸”ä¿®æ”¹äº†å‚æ•°çš„æ–¹æ³•"></a>å¦‚ä½•Mock @Injectableçš„Beançš„voidä¸”ä¿®æ”¹äº†å‚æ•°çš„æ–¹æ³•</h1><blockquote>
<p>å°¤å…¶æ˜¯@Injectableçš„ Bean çš„æ–¹æ³•å¯¹è¾“å…¥å‚æ•°æ‰§è¡Œäº†initç­‰æ“ä½œ, ä¹‹åçš„æ­¥éª¤é‡Œä¾èµ–initä¹‹åçš„å€¼</p>
</blockquote>
<p>ä»£ç ç‰‡æ®µå¦‚ä¸‹, æ ¸å¿ƒæ˜¯ä½¿ç”¨Delegate, å®Œæ•´æ ·ä¾‹å‚è§:<a href="https://github.com/DavyJones2010/test-core/blob/master/src/test/java/edu/xmu/test/javase/jmockit/JMockitTest.java#L59">JMockitTest.java</a></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token keyword">new</span> <span class="token class-name">Expectations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// è¿™é‡Œæ²¡æœ‰çœŸæ­£å»æ‰§è¡Œformat, å› æ­¤æ²¡æœ‰æŠŠageè¿›è¡Œè§„æ•´</span>
    userDao<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> any<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è™½ç„¶userDao.formatæ— è¿”å›ç»“æœä¸”è¢«mockäº†(æœªæ‰§è¡Œ), ä½†è¿™é‡Œä»ç„¶å¯ä»¥ä½¿ç”¨ result = new Delegate&lt;Void>() &#123;&#125; å¯¹æ–¹æ³•æ‰§è¡Œå†…å®¹&amp;ç»“æœè¿›è¡ŒMock</span>
    result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Delegate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æ–¹æ³•ç­¾åéœ€è¦mockçš„æ–¹æ³•`format`ä¿æŒä¸€è‡´</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">User</span> usr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            usr<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="å¦‚ä½•è¿›è¡ŒDAOå±‚æµ‹è¯•"><a href="#å¦‚ä½•è¿›è¡ŒDAOå±‚æµ‹è¯•" class="headerlink" title="å¦‚ä½•è¿›è¡ŒDAOå±‚æµ‹è¯•"></a>å¦‚ä½•è¿›è¡ŒDAOå±‚æµ‹è¯•</h1><p>æ•°æ®åº“æµ‹è¯•: <a href="https://www.freesion.com/article/88601080583/">UNITILSåº“çš„ä½¿ç”¨ç»å†</a></p>
<h2 id="å¦‚ä½•é˜²æ­¢è‡ªåŠ¨å›æ»š"><a href="#å¦‚ä½•é˜²æ­¢è‡ªåŠ¨å›æ»š" class="headerlink" title="å¦‚ä½•é˜²æ­¢è‡ªåŠ¨å›æ»š?"></a>å¦‚ä½•é˜²æ­¢è‡ªåŠ¨å›æ»š?</h2><p>ä½¿ç”¨ <code>@Transactional(TransactionMode.COMMIT)</code>å…¶ä¸­ <code>org.unitils.database.annotations.Transactional</code></p>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><ul>
<li>ç”±äºé¡¹ç›®å†å²ä¾èµ–, ä»¥åŠè‡ªèº«ç†Ÿæ‚‰ç¨‹åº¦åŸå› , ä½¿ç”¨äº† <a href="http://jmockit.github.io/changes.html">JMockit - Development history</a> ä½œä¸ºMockæµ‹è¯•æ¡†æ¶.</li>
<li>ä½†è¯¥é¡¹ç›®åœ¨2019å¹´12æœˆä¹‹åå°±åœæ­¢äº†æ›´æ–°. äº‹å®ä¸Šä¹Ÿè¸©äº†å‘, ä¸æ”¯æŒMac M1&#x2F;M2 ARMæ¶æ„çš„JDK, å¯¼è‡´åªèƒ½ä½¿ç”¨Hackçš„æ–¹å¼æ¥ç»•è¿‡. å‚è§ <a href="https://github.com/jmockit/jmockit1/issues/710">Issue #710</a></li>
<li>æ‰€ä»¥é’ˆå¯¹æ–°çš„åº”ç”¨, å»ºè®®ä½¿ç”¨ <a href="https://github.com/mockito/mockito">GitHub - mockito</a>, è™½ç„¶æœ‰ä¸€å®šçš„å­¦ä¹ è¿ç§»æˆæœ¬, ä½†è‡³å°‘è‡³ä»Š(2023å¹´08æœˆ09æ—¥)ä»åœ¨æ´»è·ƒç»´æŠ¤ä¸­.</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>jmockit</tag>
        <tag>unit-test</tag>
        <tag>ut</tag>
        <tag>test-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL/MySQLä½¿ç”¨è¿‡ç¨‹ä¸­çš„è¸©å‘åˆé›†</title>
    <url>//2023-02-19-mysql-learn-from-failure/</url>
    <content><![CDATA[<h1 id="left-join"><a href="#left-join" class="headerlink" title="left join"></a>left join</h1><h2 id="keyåœ¨å³è¡¨ä¸­é‡å¤å¯¼è‡´ç»“æœé›†é‡å¤"><a href="#keyåœ¨å³è¡¨ä¸­é‡å¤å¯¼è‡´ç»“æœé›†é‡å¤" class="headerlink" title="keyåœ¨å³è¡¨ä¸­é‡å¤å¯¼è‡´ç»“æœé›†é‡å¤"></a>keyåœ¨å³è¡¨ä¸­é‡å¤å¯¼è‡´ç»“æœé›†é‡å¤</h2><p>æ ·ä¾‹å‚è§: <a href="http://sqlfiddle.com/#!9/4f158d1/7">SQL Fiddle</a><br>æ‰€ä»¥left joinä¹‹å‰, <font color='red'>ä¸€å®šè¦ç¡®è®¤å³è¡¨çš„keyæ˜¯å¦ä¼šé‡å¤</font>.<br>å°¤å…¶æ˜¯åœ¨å†™HIVEè¿™ç§æ¯”è¾ƒé‡é‡çº§çš„SQLä¹‹å‰, ä¸€å®šè¦æ³¨æ„, å¦åˆ™ä¼šå¯¼è‡´æŠ¥è¡¨åˆ¶ä½œå‡ºæ¥æ•°æ®é‡å¤, å½±å“æ•°æ®è´¨é‡.</p>
<h2 id="onä¸­å†™äº†å·¦è¡¨çš„"><a href="#onä¸­å†™äº†å·¦è¡¨çš„" class="headerlink" title="onä¸­å†™äº†å·¦è¡¨çš„"></a>onä¸­å†™äº†å·¦è¡¨çš„</h2><div class="note warning"><p>left join ä¸ºäº†ä¿è¯å·¦è¡¨æ‰€æœ‰è¡Œ, å› æ­¤oné‡Œçš„æ¡ä»¶åªå¯¹å³è¡¨èµ·ä½œç”¨, æ§åˆ¶å·¦è¡¨çš„æ¡ä»¶å†™åˆ°oné‡Œä¹Ÿæ²¡ç”¨</p>
</div>
<p>æ ·ä¾‹å‚è§: <a href="http://sqlfiddle.com/#!9/4f158d1/10">SQL Fiddle</a><br>æ‰€ä»¥left joinçš„æ—¶å€™, <font color='red'>ä¸€å®šè¦ä¿è¯ç­›é€‰å·¦è¡¨çš„æ¡ä»¶è¦æ”¾åˆ°whereé‡Œ, è€Œä¸è¦æ”¾åˆ°oné‡Œ</font>. </p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaçº¿ç¨‹çŠ¶æ€ä¸jstackçº¿ç¨‹æ ˆåˆ†æå®æˆ˜</title>
    <url>//2023-02-22-java-jstack-thread-status/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æŸæ¬¡æœºæˆ¿é—´å…‰çº¤è¢«æŒ–æ–­, å¯¼è‡´è·¨æœºæˆ¿é€šä¿¡ç½‘ç»œä¸¢åŒ…ç‡é«˜. </p>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>TODO: è¡¥å……</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>learn-from-failure</tag>
        <tag>java</tag>
        <tag>jstack</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æœ¬ä¹¦è¯»æ‡‚è´¢æŠ¥ç¬”è®°</title>
    <url>//2023-02-24-finance-report-reading-notes/</url>
    <content><![CDATA[
<div class="markmap-container" style="height:500px">
  <svg data="{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:1,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;ä¸€æœ¬ä¹¦è¯»æ‡‚è´¢æŠ¥&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;ä¼ä¸šæ´»åŠ¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;ç»è¥æ´»åŠ¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;ç”Ÿäº§äº§å“&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;é”€å”®äº§å“&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;å›æ”¶è´§æ¬¾&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;æŠ•èµ„æ´»åŠ¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;èèµ„æ´»åŠ¨&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;ä¼ä¸šç›®çš„&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;ç›ˆåˆ©&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;ç¬¬ä¸€å¼ è¡¨: èµ„äº§è´Ÿå€ºè¡¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;èµ„äº§(Assets)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[25,26]},&quot;v&quot;:&quot;æµåŠ¨èµ„äº§(Current Assets, æµåŠ¨æ€§ä»é«˜åˆ°ä½)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[27,28]},&quot;v&quot;:&quot;è´§å¸èµ„é‡‘(Cash)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[29,30]},&quot;v&quot;:&quot;é’±, æ”¾åœ¨é“¶è¡Œé‡Œ, æ”¾åœ¨å…¬å¸é‡Œ&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[31,32]},&quot;v&quot;:&quot;åº”æ”¶è´¦æ¬¾(Accounts Receivable)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[33,34]},&quot;v&quot;:&quot;åœ¨é”€å”®äº§å“çš„æ—¶å€™ï¼Œæ—¶å¸¸æœ‰å–æ‰äº§å“å´æ”¶ä¸åˆ°é’±çš„æƒ…å†µå‘ç”Ÿï¼Œè¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿå¯èƒ½æ˜¯å› ä¸ºä¹°æ–¹è¯´ä¸èƒ½é©¬ä¸Šä»˜é’±ç»™å–æ–¹ï¼Œè€Œå–æ–¹åˆä¸æƒ³å¤±å»è¿™ä¸ªå®¢æˆ·ï¼Œæ‰€ä»¥æ„¿æ„æ‰¿æ‹…é£é™©ï¼Œè®©ä¹°æ–¹å»¶è¿Ÿä»˜æ¬¾ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºï¼ŒåŒç±»äº§å“çš„å”®å–è€…å¾ˆå¤šï¼Œä¸ºäº†å’Œåˆ«äººç«äº‰ï¼Œå–æ–¹å¿…é¡»å‘ä¹°æ–¹æ‰¿è¯ºä¸€äº›ä¼˜æƒ æ¡ä»¶&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[35,36]},&quot;v&quot;:&quot;å…¶ä»–åº”æ”¶æ¬¾(Other Receivables)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[37,38]},&quot;v&quot;:&quot;â€œå°å¼ çš„å¥½æœ‹å‹å°çº¢çš„å…¬å¸ä¸´æ—¶å‘¨è½¬ä¸å¼€ï¼Œå°çº¢å°±å‘å°å¼ å€Ÿäº†100ä¸‡å…ƒï¼Œå¹¶æ‰¿è¯ºä¸¤å‘¨ä¹‹åæŠŠé’±è¿˜ç»™å°å¼ ã€‚è¿™ç¬”é’±æ˜¾ç„¶ä¸æ˜¯ä¸€é¡¹æŠ•èµ„ï¼Œæˆ–è€…è¯´ä¸æ˜¯ä¸€é¡¹å¯¹å¤–çš„è´·æ¬¾ï¼Œå› ä¸ºå°å¼ æ²¡æœ‰å‘å°çº¢æ”¶å–ä»»ä½•åˆ©æ¯ï¼›ä½†å°å¼ åˆå¿…é¡»åœ¨ä¸¤å‘¨ä¹‹åæ”¶å›å‘å°çº¢çš„å€Ÿæ¬¾ï¼Œæ‰€ä»¥è¯´è¿™ç¬”é’±ä¹Ÿæ˜¯ä¸€ç¬”åº”æ”¶æ¬¾ã€‚è¿™ç§ç±»å‹çš„åº”æ”¶æ¬¾è·Ÿä¸€èˆ¬çš„åº”æ”¶è´¦æ¬¾æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒä¸æ˜¯é”€å”®äº§å“æ‰€å¾—ï¼Œæ‰€ä»¥æ˜¯â€œå…¶ä»–åº”æ”¶æ¬¾â€ã€‚â€&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[39,40]},&quot;v&quot;:&quot;â€œåœ¨ç°å®ä¸­ï¼Œç¡®å®æœ‰ä¸€äº›å…¬å¸çš„å…¶ä»–åº”æ”¶æ¬¾é«˜è¾¾å‡ åä¸ªäº¿ã€‚â€&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[43,44]},&quot;v&quot;:&quot;é¢„ä»˜è´¦æ¬¾(Prepaid Accounts)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[45,46]},&quot;v&quot;:&quot;â€œæ¯”å¦‚è¯´è´§å“ç›¸å½“ç´§ç¼ºï¼Œå–æ–¹å¯èƒ½ä¼šè¦æ±‚ä¹°æ–¹é¢„ä»˜ä¸€ç¬”å®šé‡‘ï¼Œç”šè‡³è¦æ±‚ä¹°æ–¹é¢„ä»˜æ‰€æœ‰çš„è´§æ¬¾ï¼›è€Œä¹°æ–¹ä¹Ÿæƒ³è¦åˆ‡åˆ‡å®å®åœ°æŠŠä¸œè¥¿æ¡åœ¨æ‰‹é‡Œï¼Œå› è€Œä¹Ÿæ„¿æ„æå‰æŠŠé’±ä»˜ç»™å–æ–¹ã€‚è¿™æ ·å°±äº§ç”Ÿäº†é¢„ä»˜è´¦æ¬¾ã€‚â€&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[47,48]},&quot;v&quot;:&quot;å­˜è´§(Inventory)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[49,50]},&quot;v&quot;:&quot;åœ¨äº§å“(Work in Process)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[51,52]},&quot;v&quot;:&quot;äº§æˆå“(Finished Goods)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[53,54]},&quot;v&quot;:&quot;å­˜è´§(Inventory)&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[55,56]},&quot;v&quot;:&quot;å¾…æ‘Šè´¹ç”¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[57,58]},&quot;v&quot;:&quot;å…¶ä»–æµåŠ¨èµ„äº§&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[59,60]},&quot;v&quot;:&quot;éæµåŠ¨èµ„äº§(Non-current Assets)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[61,62]},&quot;v&quot;:&quot;é•¿æœŸæŠ•èµ„(Long-term Investments)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[63,64]},&quot;v&quot;:&quot;å‚è‚¡åˆ«çš„å…¬å¸&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[65,66]},&quot;v&quot;:&quot;é•¿æœŸæŒæœ‰çš„è‚¡æƒå’Œå€ºåˆ¸&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[67,68]},&quot;v&quot;:&quot;å›ºå®šèµ„äº§(Fixed Assets)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[69,70]},&quot;v&quot;:&quot;ä¾‹å¦‚è®¾å¤‡, å‚æˆ¿, æ±½è½¦, ç”µè„‘&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[71,72]},&quot;v&quot;:&quot;ä½¿ç”¨æ—¶é—´é•¿, å…·æœ‰è¾ƒé«˜çš„ä»·å€¼&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[73,74]},&quot;v&quot;:&quot;åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­, å›ºå®šèµ„äº§ä¼šé€æ¸æŸè€—, ä»·å€¼ä¹Ÿä¼šéšç€æŸè€—é€æ¸é™ä½. å³â€æŠ˜æ—§â€(Depreciation)&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[77,78]},&quot;v&quot;:&quot;æ— å½¢èµ„äº§(Intangible Assets)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[79,80]},&quot;v&quot;:&quot;ä¸“åˆ©æƒ, ä¸“æœ‰æŠ€æœ¯, ç‰ˆæƒ, å•†æ ‡æƒ, å•†æ ‡æƒ, å•†èª‰&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[81,82]},&quot;v&quot;:&quot;åœŸåœ°ä½¿ç”¨æƒ(Land Usage Rights)&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[87,88]},&quot;v&quot;:&quot;å…¶ä»–éæµåŠ¨èµ„äº§&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[89,90]},&quot;v&quot;:&quot;ç”Ÿç‰©èµ„äº§(Biological Assets)&quot;}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[93,94]},&quot;v&quot;:&quot;è´Ÿå€º(Liability)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[95,96]},&quot;v&quot;:&quot;æµåŠ¨è´Ÿå€º&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[97,98]},&quot;v&quot;:&quot;çŸ­æœŸå€Ÿæ¬¾(Short-term Borrowing)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[99,100]},&quot;v&quot;:&quot;è¿˜æ¬¾æœŸé™åœ¨ä¸€å¹´ä»¥ä¸‹çš„å€Ÿæ¬¾&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[101,102]},&quot;v&quot;:&quot;åº”ä»˜è´¦æ¬¾&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[103,104]},&quot;v&quot;:&quot;å…¶ä»–åº”ä»˜æ¬¾&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[105,106]},&quot;v&quot;:&quot;é¢„æ”¶è´¦æ¬¾&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[107,108]},&quot;v&quot;:&quot;å…¶ä»–åº”ä»˜æ¬¾&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[109,110]},&quot;v&quot;:&quot;éæµåŠ¨è´Ÿå€º&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[111,112]},&quot;v&quot;:&quot;é•¿æœŸå€Ÿæ¬¾(Long-term Borrowing)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[113,114]},&quot;v&quot;:&quot;åº”ä»˜å€ºåˆ¸&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[115,116]},&quot;v&quot;:&quot;é•¿æœŸåº”ä»˜æ¬¾&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[117,118]},&quot;v&quot;:&quot;å…¶ä»–éæµåŠ¨è´Ÿå€º&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[119,120]},&quot;v&quot;:&quot;æ‰€æœ‰è€…æƒç›Š&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[121,122]},&quot;v&quot;:&quot;å®æ”¶èµ„æœ¬&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[123,124]},&quot;v&quot;:&quot;èµ„æœ¬å…¬ç§¯&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[125,126]},&quot;v&quot;:&quot;ç›ˆä½™å…¬ç§¯&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[127,128]},&quot;v&quot;:&quot;ç•™å­˜æ”¶ç›Š&quot;}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[129,130]},&quot;v&quot;:&quot;ç¬¬äºŒå¼ è¡¨: åˆ©æ¶¦è¡¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[131,132]},&quot;v&quot;:&quot;åƒä¸€ä¸ªæ¼æ–—, ä½†åˆ©æ¶¦ä¸ç­‰åŒäºç°é‡‘æµ&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[133,134]},&quot;v&quot;:&quot;è¥ä¸šæ”¶å…¥&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[135,136]},&quot;v&quot;:&quot;è¥ä¸šæ”¶å…¥: å–å‡ºäº§å“æ‰€è·å¾—çš„çš„æ”¶ç›Š&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[137,138]},&quot;v&quot;:&quot;-è¥ä¸šæˆæœ¬&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[139,140]},&quot;v&quot;:&quot;è¥ä¸šæˆæœ¬: å–å‡ºçš„äº§å“æˆæœ¬&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[141,142]},&quot;v&quot;:&quot;-è¥ä¸šç¨é‡‘åŠé™„åŠ &quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[143,144]},&quot;v&quot;:&quot;è¥ä¸šç¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[145,146]},&quot;v&quot;:&quot;æ¶ˆè´¹ç¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[147,148]},&quot;v&quot;:&quot;åŸå¸‚ç»´æŠ¤å»ºè®¾ç¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[149,150]},&quot;v&quot;:&quot;èµ„æºç¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[151,152]},&quot;v&quot;:&quot;æ•™è‚²é™„åŠ è´¹&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[153,154]},&quot;v&quot;:&quot;â€¦&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[155,156]},&quot;v&quot;:&quot;-è¥ä¸šè´¹ç”¨(Operating Expenses)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[157,158]},&quot;v&quot;:&quot;â€œåœ¨ç”Ÿäº§å’Œé”€å”®è¿‡ç¨‹ä¸­äº§ç”Ÿçš„è´¹ç”¨å°±æ˜¯è¥ä¸šè´¹ç”¨ã€‚æ¯”å¦‚è¯´æŠŠè´§ç‰©ä»ä»“åº“è¿åˆ°é”€å”®åœºæ‰€çš„è¿è´¹ã€ä»“å‚¨è´¹ã€å¹¿å‘Šè´¹å’Œå…¶ä»–ä¸ºäº†ä¿ƒé”€è€Œæ”¯å‡ºçš„ä¸€äº›è´¹ç”¨ã€é”€å”®äººå‘˜çš„å·¥èµ„ã€é—¨åº—çš„åº—ç§ŸæŠ‘æˆ–æ˜¯æŠ˜æ—§â€”â€”è§†ä¹é—¨åº—åº—é¢çš„æ‰€æœ‰æƒæ˜¯å¦åœ¨ä¼ä¸šè‡ªå·±æ‰‹ä¸Šï¼Œç­‰ç­‰ã€‚â€&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[159,160]},&quot;v&quot;:&quot;-ç®¡ç†è´¹ç”¨(General and Administrative Expense)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[161,162]},&quot;v&quot;:&quot;â€œç®¡ç†è´¹ç”¨å°±æ˜¯ä¸ä¼ä¸šçš„ç®¡ç†ç¯èŠ‚æœ‰å…³çš„ä¸€åˆ‡è´¹ç”¨ã€‚æ¯”å¦‚è¯´ç®¡ç†éƒ¨é—¨å„ç§äººå‘˜çš„å·¥èµ„ï¼Œæ¯”å¦‚è¯´è¡Œæ”¿å¼€æ”¯ã€åŠå…¬æ¥¼çš„æŠ˜æ—§ç­‰ï¼Œéƒ½æ˜¯ç®¡ç†è´¹ç”¨ã€‚å› æ­¤ï¼Œä¸åŒç±»å‹å·¥ä½œäººå‘˜çš„å·¥èµ„å¾€å¾€å±äºä¸åŒçš„é¡¹ç›®â€”â€”é”€å”®äººå‘˜çš„å·¥èµ„å±äºè¥ä¸šè´¹ç”¨ï¼Œè€Œç®¡ç†äººå‘˜çš„å·¥èµ„å±äºç®¡ç†è´¹ç”¨ã€‚ä¸åŒç±»å‹çš„å›ºå®šèµ„äº§çš„æŠ˜æ—§ä¹Ÿå±äºä¸åŒçš„é¡¹ç›®ï¼Œé—¨åº—çš„æŠ˜æ—§å±äºè¥ä¸šè´¹ç”¨ï¼ŒåŠå…¬æ¥¼çš„æŠ˜æ—§å±äºç®¡ç†è´¹ç”¨ï¼Œè€Œå‚æˆ¿çš„æŠ˜æ—§å±äºç”Ÿäº§æˆæœ¬ã€‚â€&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[163,164]},&quot;v&quot;:&quot;-è´¢åŠ¡è´¹ç”¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[165,166]},&quot;v&quot;:&quot;ä¾‹å¦‚å…¬å¸ç­¹é›†äº†å¤§é‡èµ„é‡‘, è¿™äº›èµ„é‡‘æ˜¯é€šè¿‡è‚¡æƒèèµ„è·å¾—, å› æ­¤å€Ÿæ¬¾åˆ©æ¯ä¸º0; è¿™äº›èµ„é‡‘å­˜åœ¨é“¶è¡Œ, äº§ç”Ÿå­˜æ¬¾åˆ©æ¯=100w; å› æ­¤è´¢åŠ¡è´¹ç”¨=-100w; å› æ­¤è¥ä¸šæ”¶å…¥-è´¢åŠ¡è´¹ç”¨=è¥ä¸šæ”¶å…¥+100w; æ˜¯å¢åŠ åˆ©æ¶¦çš„.&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[167,168]},&quot;v&quot;:&quot;=å€Ÿæ¬¾åˆ©æ¯-å­˜æ¬¾åˆ©æ¯&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[169,170]},&quot;v&quot;:&quot;-èµ„äº§å‡å€¼æŸå¤±(Inpairment Loss of Assets Impairment)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[171,172]},&quot;v&quot;:&quot;å¤§éƒ¨åˆ†èµ„äº§æŒ‰ç…§â€å†å²æˆæœ¬â€æ¥æœºæ¶, å¦‚æœèµ„äº§å‘ç”Ÿäº†å‡å€¼, éœ€è¦æ‰£é™¤è¯¥éƒ¨åˆ†å‡å€¼, åˆ©æ¶¦ä¹Ÿä¼šç›¸åº”å—åˆ°å½±å“.è¿™å°±æ˜¯â€èµ„äº§å‡å€¼æŸå¤±â€&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[173,174]},&quot;v&quot;:&quot;+æŠ•èµ„æ”¶ç›Š(Investment Income)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[175,176]},&quot;v&quot;:&quot;â€œæ¯”å¦‚å°å¼ å…¬å¸çš„å­å…¬å¸ç»™å°å¼ çš„å…¬å¸åˆ†çº¢äº†ï¼Œé‚£è¿™ç¬”é’±å°±æ˜¯å°å¼ å…¬å¸çš„æŠ•èµ„æ”¶ç›Šã€‚å®é™…ä¸Šï¼ŒæŠ•èµ„æ”¶ç›Šå¯ä»¥è¯´æ˜¯å°å¼ ä»¥æˆç«‹å­å…¬å¸è¿™ç§ç‰¹æ®Šæ–¹å¼è¿›è¡Œçš„è¥ä¸šæ´»åŠ¨ï¼Œæ‰€ä»¥ä»æ—§æ˜¯è¥ä¸šåˆ©æ¶¦å½“ä¸­çš„ä¸€éƒ¨åˆ†ã€‚â€&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[177,178]},&quot;v&quot;:&quot;è¥ä¸šåˆ©æ¶¦(Operating Profit)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[179,180]},&quot;v&quot;:&quot;=è¥ä¸šæ”¶å…¥-è¥ä¸šæˆæœ¬-è¥ä¸šç¨é‡‘åŠé™„åŠ -ä¸‰é¡¹è´¹ç”¨-èµ„äº§å‡å€¼æŸå¤±+æŠ•èµ„æ”¶ç›Š&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[181,182]},&quot;v&quot;:&quot;è¥ä¸šå¤–&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[183,184]},&quot;v&quot;:&quot;è¥ä¸šå¤–æ”¶å…¥(Non-operating Revenues)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[185,186]},&quot;v&quot;:&quot;å–æ‰äº†å…¬å¸ä¸€å°é—²ç½®è®¾å¤‡, ç”±æ­¤è·å¾—çš„æ”¶ç›Šä¸ºâ€è¥ä¸šå¤–æ”¶å…¥â€, å› ä¸ºå…¬å¸ç»è¥çš„ç›®çš„æ˜¯é€šè¿‡â€å‡ºå”®äº§å“èµšé’±â€, è€Œä¸æ˜¯é€šè¿‡å‡ºå”®è‡ªå·±çš„å›ºå®šèµ„äº§(è®¾å¤‡)èµšé’± è·å¾—çš„èµ”å¿å’Œå¥–åŠ±&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[187,188]},&quot;v&quot;:&quot;è¥ä¸šå¤–æ”¯å‡º(Non-operating Expenses)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[189,190]},&quot;v&quot;:&quot;å› è¿è§„é­å—å¤„ç½š, æˆ–è€…ç«ç¾, æ°´ç¾, åœ°éœ‡æ‰€å¯¼è‡´çš„æŸå¤±&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[191,192]},&quot;v&quot;:&quot;åˆ©æ¶¦æ€»é¢&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[193,194]},&quot;v&quot;:&quot;=è¥ä¸šåˆ©æ¶¦+è¥ä¸šå¤–æ”¶å…¥-è¥ä¸šå¤–ä¹‹å¤„+è¡¥è´´æ”¶å…¥+æ±‡å…‘æŸç›Š&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[195,196]},&quot;v&quot;:&quot;å‡€åˆ©æ¶¦(Net Profit)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[197,198]},&quot;v&quot;:&quot;å‡€åˆ©æ¶¦æ˜¯ä¸€ä¸ªä¼ä¸šç»è¥çš„æœ€ç»ˆæˆæœ. å‡€åˆ©æ¶¦å¤š, ç»è¥æ•ˆç›Šå°±å¥½; å‡€åˆ©æ¶¦å°‘, ç»è¥æ•ˆç›Šå°±å·®&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[199,200]},&quot;v&quot;:&quot;=åˆ©æ¶¦æ€»é¢-æ‰€å¾—ç¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[201,202]},&quot;v&quot;:&quot;æ‰€å¾—ç¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[203,204]},&quot;v&quot;:&quot;ä¸­å›½ä¼ä¸šæ‰€å¾—ç¨ç¨ç‡ä¸€èˆ¬åœ¨25%; ä½†è¿™é‡Œçš„25%æ˜¯â€åº”ç¨æ‰€å¾—â€çš„25%; è€Œéâ€åˆ©æ¶¦æ€»é¢â€çš„25%; åˆ©æ¶¦æ€»é¢: ä»¥ä¼šè®¡å‡†åˆ™ä¸ºåŸºç¡€è®¡ç®—å‡ºæ¥ åº”ç¨æ‰€å¾—: ä»¥ç¨æ³•ä¸ºåŸºç¡€è®¡ç®—å‡ºæ¥&quot;}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[205,206]},&quot;v&quot;:&quot;å…¶ä»–çŸ¥è¯†&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[207,208]},&quot;v&quot;:&quot;èµ„äº§ä¸è´¹ç”¨çš„åŒºåˆ«&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[209,210]},&quot;v&quot;:&quot;å¦‚æœè¿™ç¬”é’±å¯ä»¥æ¢æ¥ä¸€ä¸ªå¯¹å°†æ¥æœ‰ç”¨çš„ä¸œè¥¿, é‚£å°±æ˜¯èµ„äº§. ä¾‹å¦‚6ä¸‡å…ƒä¹°æ¥çš„èƒ½å¤Ÿä½¿ç”¨6ä¸ªæœˆçš„åŠå…¬ç”¨å“. 6ä¸ªæœˆä¹‹å, è¿™ç¬”é’±å°±å˜æˆäº†è´¹ç”¨.&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[211,212]},&quot;v&quot;:&quot;å¦‚æœè¿™ç¬”é’±èŠ±å®Œå°±å®Œäº†, é‚£å®ƒå°±æ˜¯è´¹ç”¨. ä¾‹å¦‚é¢„ä»˜çš„æˆ¿ç§Ÿ, é¢„ä»˜çš„å¹¿å‘Šè´¹ç”¨.&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[213,214]},&quot;v&quot;:&quot;å¾ˆå¤šæƒ…å†µä¸‹, èµ„äº§å’Œè´¹ç”¨åªå­˜åœ¨æ—¶é—´æ¦‚å¿µä¸Šçš„ä¸åŒ.&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[215,216]},&quot;v&quot;:&quot;èµ„äº§è®¡ä»·æ–¹å¼&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[217,218]},&quot;v&quot;:&quot;å†å²æˆæœ¬/åŸå§‹æˆæœ¬/å®é™…æˆæœ¬(Historical Cost)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[219,220]},&quot;v&quot;:&quot;ä¾‹å¦‚1å°ä½¿ç”¨äº†5å¹´çš„ç”Ÿäº§è®¾å¤‡, å¦‚ä½•è®¡ä»·?&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[221,222]},&quot;v&quot;:&quot;å¦‚æœèµ„äº§å‡å€¼, åˆ™å¿½ç•¥, å¦‚æœèµ„äº§å‡å€¼,å°±æŠŠè¿™ä¸ªå‡å€¼è®°å½•ä¸‹æ¥.&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[223,224]},&quot;v&quot;:&quot;åªè¦æ²¡æœ‰æ–°çš„äº¤æ˜“å‘ç”Ÿ, èµ„äº§çš„ä»·å€¼åªèƒ½å‡å°‘, ä¸èƒ½å¢åŠ &quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[225,226]},&quot;v&quot;:&quot;â€œåœ¨å†å²æˆæœ¬çš„è®¡ä»·ä½“ç³»ä¸‹ï¼Œå¢åŠ èµ„äº§ä»·å€¼çš„å”¯ä¸€é€”å¾„æ˜¯å‘ç”Ÿä¸€ä¸ªæ–°çš„äº¤æ˜“â€&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[227,228]},&quot;v&quot;:&quot;å…¬å…ä»·å€¼/å…¬å…å¸‚ä»·/å…¬å…ä»·æ ¼(Fair Value)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[229,230]},&quot;v&quot;:&quot;é‡‘èèµ„äº§(Financial Assets)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[231,232]},&quot;v&quot;:&quot;ä¾‹å¦‚è‚¡ç¥¨&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[233,234]},&quot;v&quot;:&quot;æˆ¿åœ°äº§&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[235,236]},&quot;v&quot;:&quot;å¿…é¡»æ˜¯æŠ•èµ„æ€§æˆ¿åœ°äº§&quot;}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[237,238]},&quot;v&quot;:&quot;åˆ©æ¶¦åˆ†ç±»&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[239,240]},&quot;v&quot;:&quot;æ¯›åˆ©æ¶¦&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[241,242]},&quot;v&quot;:&quot;=è¥ä¸šæ”¶å…¥-è¥ä¸šæˆæœ¬&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[243,244]},&quot;v&quot;:&quot;å‡€åˆ©æ¶¦&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[245,246]},&quot;v&quot;:&quot;=æ¯›åˆ©æ¶¦-è¥ä¸šç¨é‡‘åŠé™„åŠ -ä¸‰é¡¹è´¹ç”¨&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[247,248]},&quot;v&quot;:&quot;ç¨ç§åˆ†ç±»&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[249,250]},&quot;v&quot;:&quot;ä»·å†…ç¨(Tax Included in Price)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[251,252]},&quot;v&quot;:&quot;å¦‚è¥ä¸šç¨(Business Tax)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[253,254]},&quot;v&quot;:&quot;â€œå›½å®¶å¯¹å·¥å•†è¥åˆ©äº‹ä¸šæŒ‰è¥ä¸šé¢å¾æ”¶çš„ç¨, å±äºæµè½¬è¯¾ç¨çš„ä¸€ç±»â€&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[255,256]},&quot;v&quot;:&quot;ä¾‹å¦‚å»é¥­åº—åƒé¥­, æ”¯ä»˜äº†100å…ƒ, ä½†å®é™…é¥­åº—éœ€è¦æŒ‰ç…§100å…ƒç»™ç¨åŠ¡éƒ¨åˆ†æ”¯ä»˜ä¸€å®šæ¯”ä¾‹ç¨è´¹.&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[257,258]},&quot;v&quot;:&quot;ç”±ç»è¥è€…æ‰¿æ‹…&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[259,260]},&quot;v&quot;:&quot;å› æ­¤åœ¨ç»è¥è€…çš„åˆ©æ¶¦è¡¨ä¸­, åªèƒ½å‡ºç°â€è¥ä¸šç¨ç¨æ”¶æˆæœ¬â€, è€Œä¸ä¼šå‡ºç°â€å¢å€¼ç¨ç¨æ”¶æˆæœ¬â€&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[261,262]},&quot;v&quot;:&quot;ä»·å¤–ç¨(Tax Excluded in Price)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[263,264]},&quot;v&quot;:&quot;å¦‚å¢å€¼ç¨(Value-added Tax)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[265,266]},&quot;v&quot;:&quot;â€œä¸€ç§é”€å”®ç¨ï¼Œæ˜¯æ¶ˆè´¹è€…æ‰¿æ‹…çš„ç¨è´¹â€&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[267,268]},&quot;v&quot;:&quot;ç”±æ¶ˆè´¹è€…æ‰¿æ‹…&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[269,270]},&quot;v&quot;:&quot;æ¶ˆè´¹è€…åœ¨è´­ä¹°ä¸œè¥¿æ—¶, å·²ç»æŠŠç¨é‡‘äº¤ç»™äº†å–æ–¹, å–æ–¹ä¹Ÿå·²ç»æ›¿ç¨åŠ¡å±€ä»æ¶ˆè´¹è€…è¿™é‡Œæ”¶äº†ç¨, æ˜¯æ³¨å®šè¦ä»˜ç»™ç¨åŠ¡å±€çš„. å› æ­¤å¯¹äºç»è¥è€…æ¥è¯´, è¿™ç¬”é’±ç®—æ˜¯â€è´Ÿå€ºâ€&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[271,272]},&quot;v&quot;:&quot;å› æ­¤å¢å€¼ç¨ä½“ç°åœ¨èµ„äº§è´Ÿå€ºè¡¨ä¸­â€åº”äº¤ç¨é‡‘â€è¿™ä¸€é¡¹ç›®ä¸­&quot;}]}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[273,274]},&quot;v&quot;:&quot;è´¢åŠ¡åˆ†ææ–¹æ³•&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[275,276]},&quot;v&quot;:&quot;åŒå‹åˆ†æ&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[277,278]},&quot;v&quot;:&quot;è¶‹åŠ¿åˆ†æ(Trend Analysis)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[279,280]},&quot;v&quot;:&quot;ä½¿ç”¨åŒå‹åˆ†æä¸è‡ªå·±è¿‡å»ç›¸æ¯”, å°±å«è¶‹åŠ¿åˆ†æ&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[281,282]},&quot;v&quot;:&quot;æ¯”è¾ƒåˆ†æ(Comparing Analysis)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[283,284]},&quot;v&quot;:&quot;ä¸åˆ«çš„ä¼ä¸šç›¸æ¯”, æ— è®ºæ˜¯ç«äº‰å¯¹æ‰‹è¿˜æ˜¯è¡Œä¸šçš„æ ‡æ†ä¼ä¸šæˆ–è€…è¡Œä¸šå†…çš„å¹³å‡æ°´å¹³, å°±å«â€æ¯”è¾ƒåˆ†æâ€&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[285,286]},&quot;v&quot;:&quot;æ¯›åˆ©ç‡(Gross Margin)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[287,288]},&quot;v&quot;:&quot;å‡€åˆ©ç‡(Net Profit Margin)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[289,290]},&quot;v&quot;:&quot;æ€»èµ„äº§æŠ¥é…¬ç‡(Return on Assets)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[291,292]},&quot;v&quot;:&quot;=æ”¶å…¥/æ€»èµ„äº§*å‡€åˆ©æ¶¦/æ”¶å…¥=å‡€åˆ©æ¶¦/æ€»èµ„äº§&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[293,294]},&quot;v&quot;:&quot;æŠ•èµ„å›æŠ¥ç‡(Return on Investment, ROI)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[295,296]},&quot;v&quot;:&quot;å‡€èµ„äº§æ”¶ç›Šç‡(Return on Equity, ROE)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[297,298]},&quot;v&quot;:&quot;å‘¨è½¬ç‡&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[299,300]},&quot;v&quot;:&quot;åœ¨ä¸€å¹´ä¹‹å†…, ä¼ä¸šçš„èµ„äº§ä¸€å…±è½¬äº†å¤šå°‘åœˆ&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[301,302]},&quot;v&quot;:&quot;å‘¨è½¬ç‡è¶Šè¿‡, èµšçš„é’±ä¹Ÿå°±è¶Šå¤š&quot;}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[303,304]},&quot;v&quot;:&quot;å¿å€ºèƒ½åŠ›(Solvency)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[305,306]},&quot;v&quot;:&quot;çŸ­æœŸå¿å€ºèƒ½åŠ›&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[307,308]},&quot;v&quot;:&quot;æµåŠ¨æ¯”ç‡(Current Ratio)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[309,310]},&quot;v&quot;:&quot;å¥åº·å…¬å¸å¤§å¤šåœ¨3~4ä¹‹é—´&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[311,312]},&quot;v&quot;:&quot;å¤§å¤šæ•°ä¸­å›½ä¼ä¸šæµåŠ¨æ¯”ç‡åœ¨1åˆ°2ä¹‹é—´&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[317,318]},&quot;v&quot;:&quot;é€ŸåŠ¨æ¯”ç‡(Quick Ratio/Acid-test Ratio)&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[319,320]},&quot;v&quot;:&quot;é•¿æœŸå¿å€ºèƒ½åŠ›&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[321,322]},&quot;v&quot;:&quot;å¿è¿˜åˆ©æ¯èƒ½åŠ›&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[323,324]},&quot;v&quot;:&quot;æ¯ç¨å‰æ”¶ç›Š(Earnings before Interest and Tax, EBIT)&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[325,326]},&quot;v&quot;:&quot;åˆ©æ¯æ”¶å…¥å€æ•°(Times Interest Earned/Interest Production Multiples)&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[329,330]},&quot;v&quot;:&quot;å¿è¿˜æœ¬é‡‘èƒ½åŠ›&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[331,332]},&quot;v&quot;:&quot;èµ„äº§è´Ÿå€ºç‡(Liability/Asset Ratio), åˆç§°è´¢åŠ¡æ æ†(Financial Leverage)&quot;}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[335,336]},&quot;v&quot;:&quot;äº”åŠ›å›¾(Five Forces Model)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[337,338]},&quot;v&quot;:&quot;å³äº”åŠ›åˆ†ææ¨¡å‹&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[339,340]},&quot;v&quot;:&quot;ç°æœ‰ä¼ä¸šä¹‹é—´çš„ç«äº‰&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[341,342]},&quot;v&quot;:&quot;è¡Œä¸šå¢é•¿&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[343,344]},&quot;v&quot;:&quot;é›†ä¸­&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[345,346]},&quot;v&quot;:&quot;å¤šæ ·åŒ–ç«äº‰&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[347,348]},&quot;v&quot;:&quot;è½¬æ¢æˆæœ¬&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[349,350]},&quot;v&quot;:&quot;è§„æ¨¡ç»æµå‹&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[351,352]},&quot;v&quot;:&quot;å­¦ä¹ æˆæœ¬&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[353,354]},&quot;v&quot;:&quot;å›ºå®š/å¯å˜æˆæœ¬&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[355,356]},&quot;v&quot;:&quot;äº§èƒ½è¿‡å‰©&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[357,358]},&quot;v&quot;:&quot;é€€å‡ºæˆæœ¬&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[359,360]},&quot;v&quot;:&quot;æ–°è¿›å…¥è€…çš„å¨èƒ&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[361,362]},&quot;v&quot;:&quot;æ›¿ä»£äº§å“çš„å¨èƒ&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[363,364]},&quot;v&quot;:&quot;è´­ä¹°è€…çš„è®®ä»·èƒ½åŠ›&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[365,366]},&quot;v&quot;:&quot;ä¾›è´§æ–¹çš„è®®ä»·èƒ½åŠ›&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[367,368]},&quot;v&quot;:&quot;ä¼ä¸šæˆ˜ç•¥å®šä½&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[369,370]},&quot;v&quot;:&quot;æˆæœ¬é¢†å…ˆæˆ˜ç•¥(Overall Cost Leadership)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[371,372]},&quot;v&quot;:&quot;ä¸»åŠ¨ç‰ºç‰²æ•ˆç›Š, æ¥æ¢å–æ•ˆç‡çš„æˆ˜ç•¥, æ˜¯â€æ•ˆç‡åˆ¶èƒœâ€çš„æˆ˜ç•¥.&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[373,374]},&quot;v&quot;:&quot;æ¯›åˆ©ç‡ä½&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[375,376]},&quot;v&quot;:&quot;é«˜å‘¨è½¬&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[377,378]},&quot;v&quot;:&quot;å·®å¼‚åŒ–æˆ˜ç•¥(Differentiation Strategy)&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[379,380]},&quot;v&quot;:&quot;æ ·ä¾‹&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[381,382]},&quot;v&quot;:&quot;ç«äº‰æ€§åˆ¶é€ ä¸šä¼ä¸š&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[383,384]},&quot;v&quot;:&quot;å›ºå®šèµ„äº§å€¼æœ€é«˜&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[385,386]},&quot;v&quot;:&quot;èµ„é‡‘å¯†é›†å‹çš„åˆ¶é€ ä¼ä¸š&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[387,388]},&quot;v&quot;:&quot;å…¶æ¬¡æ˜¯è¥æ”¶æ¬¾é¡¹&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[389,390]},&quot;v&quot;:&quot;ä¸ºäº†é”€å”®è‡ªå·±çš„äº§å“, å…è®¸å®¢æˆ·æš‚ç¼“æ”¯ä»˜è´§æ¬¾, å› æ­¤åº”è¯¥é¢ä¸´å‹åŠ›.&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[391,392]},&quot;v&quot;:&quot;æœåŠ¡å‹ä¼ä¸š&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[393,394]},&quot;v&quot;:&quot;æ— å½¢èµ„äº§å æ¯”å¤§&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[395,396]},&quot;v&quot;:&quot;äººä¹Ÿå¯ä»¥ä½œä¸ºæ— å½¢èµ„äº§, ä¾‹å¦‚ä¿±ä¹éƒ¨èŠ±2000wä¸çƒæ˜Ÿç­¾äº†3å¹´ä¹°æ–­åè®®&quot;}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[397,398]},&quot;v&quot;:&quot;è¥ä¸šåˆ©æ¶¦ä¸è¥ä¸šå¤–æ”¶å…¥&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[399,400]},&quot;v&quot;:&quot;Aå…¬å¸èµšäº†1000w, 900wæ¥è‡ªè¥ä¸šåˆ©æ¶¦, 100wæ¥è‡ªè¥ä¸šå¤–æ”¶å…¥&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[401,402]},&quot;v&quot;:&quot;Bå…¬å¸èµšäº†1000w, 100wæ¥è‡ªè¥ä¸šåˆ©æ¶¦, 900wæ¥è‡ªè¥ä¸šå¤–æ”¶å…¥&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:3,&quot;p&quot;:{&quot;lines&quot;:[403,404]},&quot;v&quot;:&quot;ä¸‰å¼ è¡¨å…³æ³¨ç‚¹&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[405,406]},&quot;v&quot;:&quot;ç°é‡‘æµé‡è¡¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[407,408]},&quot;v&quot;:&quot;é“¶è¡Œè´·æ¬¾å…³æ³¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[409,410]},&quot;v&quot;:&quot;å»é“¶è¡Œè´·æ¬¾, é“¶è¡Œå…³æ³¨è¯¥è¡¨. é“¶è¡Œä»æ¥éƒ½ä¸å¸Œæœ›ä¼ä¸šè¿˜ä¸èµ·é’±, ä¹Ÿä¸å¸Œæœ›ä¼ä¸šé€šè¿‡å˜å–è‡ªå·±çš„èµ„äº§æ¥è¿˜å€º. å®ƒå¸Œæœ›ä¼ä¸šæ‰‹å¤´æ°¸è¿œæœ‰å¤§é‡çš„ç°é‡‘.&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[411,412]},&quot;v&quot;:&quot;åˆ©æ¶¦è¡¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[413,414]},&quot;v&quot;:&quot;æŠ•èµ„è€…å…³æ³¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[415,416]},&quot;v&quot;:&quot;åˆ©æ¶¦è¡¨å°†å¯æŒç»­çš„åˆ©æ¶¦(ç»è¥åˆ©æ¶¦) å’Œä¸å¯æŒç»­çš„åˆ©æ¶¦(è¥ä¸šå¤–æ”¶æ”¯, è¡¥è´´æ”¶å…¥, æ±‡å…‘æŸç›Š) åˆ†åˆ«åˆ—ç¤º ä¸ä»…å±•ç¤ºä¼ä¸šç°åœ¨èµšäº†å¤šå°‘é’±, è¿˜èƒ½ä½¿è¯»æŠ¥è¡¨çš„äººå½¢æˆå¯¹ä¼ä¸šæœªæ¥ç›ˆåˆ©çš„é¢„æœŸ.&quot;}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[417,418]},&quot;v&quot;:&quot;èµ„äº§è´Ÿå€ºè¡¨&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[419,420]},&quot;v&quot;:&quot;ä¼ä¸šå¹¶è´­å…³æ³¨&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[421,422]},&quot;v&quot;:&quot;å› ä¸º â€œè‚¡ä¸œæƒç›Š=èµ„äº§-è´Ÿå€ºâ€ æ’ç­‰å¼&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[423,424]},&quot;v&quot;:&quot;èµ„äº§æœ‰é«˜ä¼°çš„é£é™©&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:5,&quot;p&quot;:{&quot;lines&quot;:[425,426]},&quot;v&quot;:&quot;è´Ÿå€ºæœ‰ä½ä¼°çš„é£é™©&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[427,428]},&quot;v&quot;:&quot;æˆ–æœ‰è´Ÿå€º: Cå…¬å¸ä¸ºBå…¬å¸åšäº†æ‹…ä¿, Bå…¬å¸è·‘è·¯&quot;},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[429,430]},&quot;v&quot;:&quot;è¡¨å¤–è´Ÿå€º:&quot;}]}]}]}]},{&quot;t&quot;:&quot;heading&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[431,432]},&quot;v&quot;:&quot;ç¬¬ä¸‰å¼ è¡¨: ç°é‡‘æµé‡è¡¨&quot;}]}"></svg>
</div>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>note</tag>
        <tag>book-list</tag>
        <tag>finance</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaçº¿ç¨‹BLOCKEDä¸WAITINGçŠ¶æ€æ·±å…¥ç ”ç©¶</title>
    <url>//2023-02-25-java-thread-sync-deep-dive/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¸Šæ¬¡æœºæˆ¿æ–­ç½‘çš„jstackåˆ†æä¹‹å, å‘ç°å…¶å®ä¸ªäººå¹¶æ²¡æœ‰æ·±å…¥ç†è§£Javaä¸­çº¿ç¨‹çš„å¦‚ä¸‹ä¸¤ä¸ªçŠ¶æ€çš„åŒºåˆ«: </p>
<ul>
<li>â€œBLOCKEDâ€</li>
<li>â€œWAITINGâ€<br>æˆ–è€…, éƒ½æ˜¯çº¿ç¨‹è¢«é˜»å¡æ— æ³•è¿è¡Œ(è®©å‡ºäº†CPUçš„æ—¶é—´ç‰‡)çš„çŠ¶æ€:</li>
<li>é—®é¢˜1: è¿™ä¸¤ä¸ªçŠ¶æ€å…·ä½“æœ‰å•¥åŒºåˆ«? </li>
<li>é—®é¢˜2: JVMä¸ºä»€ä¹ˆè¦è¿›è¡Œä¸Šè¾¹ä¸¤ä¸ªçŠ¶æ€çš„åŒºåˆ†? ä¸ºä»€ä¹ˆä¸åªç”¨ä¸€ä¸ªçŠ¶æ€æ ‡è¯†?</li>
</ul>
<p>å…ˆä¸æ€¥ç€å›ç­”è¿™ä¸ªé—®é¢˜, æˆ‘ä»¬ä»ä¸€ä¸ªä¾‹å­å‡ºå‘:  </p>
<h1 id="ç”Ÿäº§è€…-amp-æ¶ˆè´¹è€…ä¾‹å­"><a href="#ç”Ÿäº§è€…-amp-æ¶ˆè´¹è€…ä¾‹å­" class="headerlink" title="ç”Ÿäº§è€…&amp;æ¶ˆè´¹è€…ä¾‹å­"></a>ç”Ÿäº§è€…&amp;æ¶ˆè´¹è€…ä¾‹å­</h1><p>å…ˆæ¥ä¸€é“é¢è¯•é‡Œæ—¶å¸¸é—®åˆ°çš„é¢˜ç›®:<br><code>ä¸¤ä¸ªçº¿ç¨‹, åˆ†åˆ«æ‰®æ¼”æ¶ˆè´¹è€…&amp;ç”Ÿäº§è€…çš„è§’è‰², å‡è®¾é˜Ÿåˆ—ä¸º1, æ— é™å¾ªç¯. å¦‚ä½•å†™?</code></p>
<h2 id="ä»£ç æ ·ä¾‹"><a href="#ä»£ç æ ·ä¾‹" class="headerlink" title="ä»£ç æ ·ä¾‹"></a>ä»£ç æ ·ä¾‹</h2><ul>
<li>å®Œæ•´ä»£ç å‚è§: <a href="https://github.com/DavyJones2010/test-core/blob/master/src/test/java/edu/xmu/test/concurrent/ProducerConsumerTest.java">ProducerConsumerTest.java</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// consumer</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"consumer is waiting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start consuming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finished consuming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isEmpty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// producer</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"producer is waiting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start producing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isEmpty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finished producing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å˜ä½“å†™æ³•-1"><a href="#å˜ä½“å†™æ³•-1" class="headerlink" title="å˜ä½“å†™æ³•-1"></a>å˜ä½“å†™æ³•-1</h2><p>å¦‚æœåœ¨è°ƒç”¨<code>lock.notify()</code>ä¹‹åå†ç”Ÿäº§æˆ–è€…å†æ¶ˆè´¹, ä¼šæ€ä¹ˆæ ·?<br>å³ä»£ç å˜ä½“å¦‚ä¸‹: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// consumer</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"consumer is waiting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start consuming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finished consuming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isEmpty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// producer</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"producer is waiting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start producing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isEmpty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finished producing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>å¯ä»¥è‡ªå·±å°è¯•ä¸‹, ä»£ç ç»“æœä»ç„¶æ˜¯æ­£å¸¸çš„, å³ä¸æ­£å¸¸å†™æ³•å®Œå…¨æ²¡æœ‰åŒºåˆ«. </p>
</blockquote>
<p>è¿™æ˜¯æ€ä¹ˆå›äº‹å„¿? </p>
<ul>
<li>producerè°ƒç”¨<code>lock.notify()</code>çš„æ—¶å€™æ˜¯ç›´æ¥æŠŠconsumerå”¤é†’å¼€å§‹æ‰§è¡Œäº†ä¹ˆ? ä½†producerç”Ÿäº§çš„ä»£ç åœ¨<code>lock.notify()</code>ä¹‹å, é‚£ä¹ˆ<code>isEmpty=false</code>æ˜¯å¦ä¼šæ‰§è¡Œåˆ°?</li>
<li>å¦‚æœ<code>isEmpty=false</code>æ‰§è¡Œä¸åˆ°, è€Œæ˜¯åœ¨consumerä¾§æ‰§è¡Œ, é‚£ä¹ˆconsumerä¹Ÿè¿˜æ˜¯æ— æ³•å¼€å§‹æ¶ˆè´¹(å› ä¸ºæ— æ³•èµ°å‡º<code>while(isEmpty)</code>è¿™ä¸ªåˆ¤æ–­å¾ªç¯), ç»“æœåº”è¯¥æ˜¯consumerä»ç„¶å¡åœ¨<code>wait()</code>ä¸Š. </li>
<li>å¦‚æœ<code>isEmpty=true</code>æ‰§è¡Œåˆ°, é‚£ä¹ˆæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å”¤é†’äº†consumerå‘¢?<br>å¥½å¤æ‚, <strong>ä»£ç çš„æ‰§è¡Œé“¾è·¯åˆ°åº•æ˜¯æ€æ ·çš„??</strong></li>
</ul>
<h2 id="wait-x2F-notifyè¯¦è§£"><a href="#wait-x2F-notifyè¯¦è§£" class="headerlink" title="wait&#x2F;notifyè¯¦è§£"></a>wait&#x2F;notifyè¯¦è§£</h2><p>è¦ææ¸…æ¥šä»£ç é“¾è·¯æ˜¯æ€æ ·çš„, é¦–å…ˆæˆ‘ä»¬éœ€è¦æ¸…æ¥šè°ƒç”¨wait&#x2F;notifyæ—¶åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ?</p>
<blockquote>
<p>ç”±äºwait&#x2F;notifyéƒ½æ˜¯nativeçš„ä»£ç , é˜…è¯»ä¸æ˜“. å› æ­¤ä¸‹æ–‡ä¸»è¦å†…å®¹&#x2F;æ¦‚å¿µéƒ½æ˜¯å‚ç…§<a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html">Java SE Specification</a>, è¿›è¡Œä¸ªäººç†è§£ä¸ç ”ç©¶.</p>
</blockquote>
<p>å…ˆç»™å‡ºä¸‰ä¸ªé‡è¦çš„æ¦‚å¿µ: </p>
<ul>
<li>object monitor: æ¯ä¸ªjavaå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªobject monitor</li>
<li>blocked set: æ¯ä¸ªjavaå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªblocked set</li>
<li>wait set: æ¯ä¸ªjavaå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªwait set</li>
</ul>
<p>å†æ¥è¯´æ˜ä¸‹ä¸‰ä¸ªæ¦‚å¿µå®é™…æ˜¯æ€ä¹ˆä½¿ç”¨çš„:</p>
<ol>
<li>å¦‚ä¸‹ç®€å•ä»£ç , å®é™…çº¿ç¨‹æ‰§è¡Œæ—¶å‘ç”Ÿäº†å¦‚ä¸‹äº‹æƒ…: <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// do smt</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<ul>
<li><p>çº¿ç¨‹æ‰§è¡Œ<code>synchronized(o)</code>ä¼šå¯¼è‡´: </p>
<ul>
<li>çº¿ç¨‹å°è¯•å»æŠ¢å <code>object monitor</code>; </li>
<li>å¦‚æœæŠ¢å åˆ°, åˆ™è¯¥çº¿ç¨‹æ‹¥æœ‰äº†è¯¥<code>object monitor</code>, è¿›è¡Œä¸´ç•ŒåŒºä»£ç æ‰§è¡Œ. </li>
<li>å¦‚æœæŠ¢å ä¸åˆ°, åˆ™è¯¥çº¿ç¨‹è¢«æ”¾å…¥è¯¥å¯¹è±¡çš„<code>blocked set</code>ä¸­. å…·ä½“ <ol>
<li>ä»€ä¹ˆæ—¶å€™å”¤é†’: å¯ä»¥ç®€åŒ–è®¤ä¸ºä¸ºJVMä¼šåœ¨åº•å±‚æ—¶åˆ»è½®è¯¢<code>object monitor</code>å ç”¨æƒ…å†µ, ä¸€æ—¦<code>object monitor</code>è¢«é‡Šæ”¾, ç«‹åˆ»ä»<code>blocked set</code>ä¸­æ‰¾ä¸ªçº¿ç¨‹å¼€å§‹æ‰§è¡Œ.</li>
<li>å¦‚æœå¤šä¸ªçº¿ç¨‹éƒ½åœ¨<code>block set</code>ä¸­, è¯¥å”¤é†’å“ªä¸ª, ç”±JVMæ¥å†³å®š(TODO: è¿™ä¸ªå…·ä½“å¾…æ¢ç©¶, ä¸å½±å“æœ¬æ–‡).</li>
</ol>
</li>
</ul>
</li>
<li><p>çº¿ç¨‹é€€å‡º<code>synchronized(o)</code>ä¸´ç•ŒåŒºä¼šå¯¼è‡´: </p>
<ul>
<li>å½“å‰çº¿ç¨‹é‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMè½®è¯¢åˆ°<code>object monitor</code>å¤„äºç©ºé—², ç«‹åˆ»ä»<code>blocked set</code>ä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹, è®©è¯¥çº¿ç¨‹å¼€å§‹ä¸´ç•ŒåŒºä»£ç æ‰§è¡Œ.</li>
</ul>
</li>
</ul>
<ol start="2">
<li>å†åŠ ä¸Šç®€å•çš„wait&#x2F;notify:<br>å¦‚ä¸‹, ä¸€ä¸ªæœ€ç®€å•çš„producer&#x2F;consumerç¨‹åº: <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// consumer</span>
<span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    o<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// consume</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// produce</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// produce</span>
    o<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<blockquote>
<p>å…ˆå‡è®¾consumerå…ˆæ‰§è¡Œ</p>
</blockquote>
<ul>
<li><p>consumeræ‰§è¡Œé“¾è·¯: </p>
<ol>
<li><code>synchronized(o)</code>: è·å–åˆ°<code>object monitor</code>, å¼€å§‹ä¸´ç•ŒåŒºä»£ç æ‰§è¡Œ.</li>
<li><code>o.wait()</code>: è™½ç„¶å¯ä»¥æ‹†è§£ä¸ºå¦‚ä¸‹å‡ æ­¥, ä½†waitæœ¬èº«æ˜¯åŸå­æ“ä½œ <ol>
<li>æŠŠconsumerçº¿ç¨‹æ”¾å…¥åˆ°è¯¥å¯¹è±¡çš„ <code>wait set</code> ä¸­</li>
<li>é‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMå°†producerä»<code>block set</code>ä¸­å–å‡º, (è§¦å‘JVM&#x2F;OSçš„è½®è¯¢, å¼•å‘producerè·å–åˆ°<code>object monitor</code>ä»è€Œè¿›å…¥ä¸´ç•ŒåŒº)</li>
</ol>
</li>
</ol>
</li>
<li><p>produceræ‰§è¡Œé“¾è·¯:</p>
<ol>
<li><code>synchronized(o)</code>: è·å–ä¸åˆ°<code>object monitor</code>, è¢«æ”¾å…¥<code>block set</code>ä¸­ </li>
<li>consumeré€€å‡ºä¸´ç•ŒåŒº, producerè¢«è‡ªåŠ¨ä»<code>block set</code>ä¸­å–å‡º, è·å–åˆ°<code>object monitor</code>ä»è€Œè¿›å…¥ä¸´ç•ŒåŒº (ä¸consumeræ‰§è¡Œé“¾è·¯çš„2.3æ­¥éª¤é‡å )</li>
<li><code>o.notify()</code>:</li>
</ol>
<ul>
<li>producerå¹¶ä¸ä¼šå› ä¸º<code>notify()</code>è€Œé‡Šæ”¾æ‰<code>object monitor</code>: <mark><strong><code>notify</code>å¹¶ä¸ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹é‡Šæ”¾æ‰<code>object monitor</code>!</strong></mark>, è€Œæ˜¯ç»§ç»­å¾€ä¸‹æ‰§è¡Œä»£ç .</li>
<li>JVMå°†consumerä»<code>wait set</code>ä¸­å–å‡º, å°è¯•è·å¾—<code>object monitor</code></li>
<li>ç”±äºproduceræ­¤æ—¶å¹¶æ²¡æœ‰é‡Šæ”¾æ‰<code>object monitor</code>, å› æ­¤JVMå°±æŠŠconsumeræ”¾å…¥åˆ°äº†<code>block set</code>ä¸­(å³ä»<code>wait set</code>ç§»åˆ°äº†<code>block set</code>ä¸­)</li>
</ul>
<ol start="4">
<li>é€€å‡ºä¸´ç•ŒåŒº:</li>
</ol>
<ul>
<li>produceré‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMå°†consumerä»<code>block set</code>ä¸­å–å‡º</li>
<li>è§¦å‘JVMå†…éƒ¨çš„è½®è¯¢, å¼•å‘consumerè·å–åˆ°<code>object monitor</code>, ä»è€Œç»§ç»­<code>o.wait()</code>ä¹‹åçš„ä»£ç ç‰‡æ®µæ‰§è¡Œ</li>
</ul>
</li>
<li><p>consumerç»§ç»­æ‰§è¡Œ, æ³¨æ„:</p>
<ol>
<li>æ­¤æ—¶consumeræ˜¯<mark>ç»§ç»­ä»<code>object.wait()</code>ä¹‹åçš„ä»£ç å¼€å§‹æ‰§è¡Œ. (å³ä¹‹å‰ä¸­æ–­çš„åœ°æ–¹ç»§ç»­).</mark> </li>
<li>è€Œ<mark>ä¸æ˜¯é‡æ–°é€šè¿‡<code>synchronized(o)</code>æŠ¢<code>object monitor</code>, ç„¶åä»å¤´å¼€å§‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç .</mark> å› ä¸ºå†…éƒ¨JVMå·²ç»æŠŠ<code>object monitor</code>ç»™äº†consumeräº†.</li>
<li>é€€å‡ºä¸´ç•ŒåŒº:<ul>
<li>consumeré‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMå°è¯•ä»<code>block set</code>ä¸­å–å‡ºçº¿ç¨‹, ç”±äº<code>block set</code>ä¸ºç©º, nothing happens</li>
</ul>
</li>
</ol>
</li>
<li><p>ç»ˆæ€: <strong>produceræ‰§è¡Œå®Œæˆ, consumerä¹Ÿæ‰§è¡Œå®Œæˆ.</strong></p>
</li>
</ul>
<blockquote>
<p>å†å‡è®¾producerå…ˆæ‰§è¡Œ</p>
</blockquote>
<ul>
<li><p>produceræ‰§è¡Œé“¾è·¯:</p>
<ol>
<li><code>synchronized(o)</code>: producerè·å–åˆ°<code>object monitor</code>, å¼€å§‹ä¸´ç•ŒåŒºä»£ç æ‰§è¡Œ.</li>
</ol>
</li>
<li><p>consumeræ‰§è¡Œé“¾è·¯:</p>
<ol>
<li><code>synchronized(o)</code>: consumerè·å–ä¸åˆ°<code>object monitor</code>, è¢«æ”¾å…¥<code>block set</code>ä¸­</li>
</ol>
</li>
<li><p>produceræ‰§è¡Œé“¾è·¯:</p>
<ol>
<li><code>o.notify()</code>: <ol>
<li>producerä¸ä¼šå› ä¸º<code>notify()</code>è€Œé‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMä»<code>wait set</code>ä¸­å¯»æ‰¾ä¸€ä¸ªçº¿ç¨‹, ç§»å‡º<code>wait set</code>, å¹¶æ”¾å…¥åˆ°<code>blocked set</code>ä¸­. ç”±äºæ­¤æ—¶<code>wait set</code>ä¸ºç©º(consumeråœ¨<code>block set</code>ä¸­). å› æ­¤nothing happens</li>
</ol>
</li>
<li>é€€å‡ºä¸´ç•ŒåŒº:<ol>
<li>produceré‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMå°†consumerä»<code>block set</code>ä¸­å–å‡º, ç”±äº<code>object monitor</code>å·²ç»è¢«produceré‡Šæ”¾, å› æ­¤consumerç›´æ¥è·å–åˆ°<code>object monitor</code>, å¼€å§‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç   (consumerçŠ¶æ€ <code>block set</code> -&gt; <code>RUNNABLE</code>)</li>
</ol>
</li>
</ol>
</li>
<li><p>consumeræ‰§è¡Œé“¾è·¯:</p>
<ol>
<li><code>o.wait()</code>: <ol>
<li>æŠŠconsumerçº¿ç¨‹æ”¾å…¥åˆ°è¯¥å¯¹è±¡çš„ <code>wait set</code> ä¸­</li>
<li>é‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMå°è¯•ä»<code>block set</code>ä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹, ç”±äºæ­¤æ—¶<code>block set</code>ä¸ºç©º, å› æ­¤nothing happens</li>
</ol>
</li>
</ol>
</li>
<li><p>ç»ˆæ€: <strong>produceræ‰§è¡Œå®Œæˆ, consumerä¸€ç›´å¡åœ¨<code>WAITING</code>çŠ¶æ€.</strong></p>
</li>
</ul>
<h2 id="wait-x2F-notify-x2F-synchronizedæ€»ç»“"><a href="#wait-x2F-notify-x2F-synchronizedæ€»ç»“" class="headerlink" title="wait&#x2F;notify&#x2F;synchronizedæ€»ç»“"></a>wait&#x2F;notify&#x2F;synchronizedæ€»ç»“</h2><h3 id="è°ƒç”¨-synchronized-object-æ—¶ä¼šå‘ç”Ÿ"><a href="#è°ƒç”¨-synchronized-object-æ—¶ä¼šå‘ç”Ÿ" class="headerlink" title="è°ƒç”¨ synchronized(object) æ—¶ä¼šå‘ç”Ÿ:"></a>è°ƒç”¨ synchronized(object) æ—¶ä¼šå‘ç”Ÿ:</h3><ol>
<li>å½“å‰çº¿ç¨‹å°è¯•æŠ¢å  <code>object monitor</code></li>
<li>å¦‚æœæŠ¢å åˆ°, åˆ™è¿›å…¥ä¸´ç•ŒåŒº.</li>
<li>å¦‚æœæŠ¢å ä¸åˆ°, æŠŠå½“å‰çº¿ç¨‹æ”¾å…¥åˆ°<code>blocked set</code>ä¸­. JVMä¼šç›‘æ§<code>object monitor</code>, å½“<code>object monitor</code>å½’è¿˜æ—¶, ä»<code>blocked set</code>ä¸­æŒ‘é€‰ä¸€ä¸ªçº¿ç¨‹ç»§ç»­ä»£ç æ‰§è¡Œ(å¯èƒ½æ˜¯è¿›å…¥ä¸´ç•ŒåŒº, ä¹Ÿå¯èƒ½æ˜¯ç»§ç»­ä¹‹å‰ä¸­æ–­çš„ä»£ç )</li>
</ol>
<h3 id="å‡º-synchronized-object-æ—¶ä¼šå‘ç”Ÿ"><a href="#å‡º-synchronized-object-æ—¶ä¼šå‘ç”Ÿ" class="headerlink" title="å‡º synchronized(object) æ—¶ä¼šå‘ç”Ÿ:"></a>å‡º synchronized(object) æ—¶ä¼šå‘ç”Ÿ:</h3><ol>
<li>é‡Šæ”¾æ‰<code>object monitor</code>;</li>
<li>JVMä¼šç›‘æ§<code>object monitor</code>, å½“å®ƒå½’è¿˜æ—¶, ä»<code>blocked set</code>ä¸­æŒ‘é€‰ä¸€ä¸ªçº¿ç¨‹ç»§ç»­ä»£ç æ‰§è¡Œ(å¯èƒ½æ˜¯è¿›å…¥ä¸´ç•ŒåŒº, ä¹Ÿå¯èƒ½æ˜¯ç»§ç»­ä¹‹å‰ä¸­æ–­çš„ä»£ç )</li>
</ol>
<h3 id="è°ƒç”¨-object-wait-æ—¶ä¼šå‘ç”Ÿ"><a href="#è°ƒç”¨-object-wait-æ—¶ä¼šå‘ç”Ÿ" class="headerlink" title="è°ƒç”¨ object.wait() æ—¶ä¼šå‘ç”Ÿ:"></a>è°ƒç”¨ object.wait() æ—¶ä¼šå‘ç”Ÿ:</h3><ol>
<li>æŠŠå½“å‰çº¿ç¨‹æ”¾å…¥åˆ° <code>wait set</code> ä¸­</li>
<li>é‡Šæ”¾æ‰<code>object monitor</code></li>
<li>JVMä¼šç›‘æ§<code>object monitor</code>, å½“å®ƒå½’è¿˜æ—¶, ä»<code>blocked set</code>ä¸­æŒ‘é€‰ä¸€ä¸ªçº¿ç¨‹ç»§ç»­ä»£ç æ‰§è¡Œ(å¯èƒ½æ˜¯è¿›å…¥ä¸´ç•ŒåŒº, ä¹Ÿå¯èƒ½æ˜¯ç»§ç»­ä¹‹å‰ä¸­æ–­çš„ä»£ç )</li>
</ol>
<h3 id="è°ƒç”¨-object-notify-æ—¶ä¼šå‘ç”Ÿ"><a href="#è°ƒç”¨-object-notify-æ—¶ä¼šå‘ç”Ÿ" class="headerlink" title="è°ƒç”¨ object.notify() æ—¶ä¼šå‘ç”Ÿ:"></a>è°ƒç”¨ object.notify() æ—¶ä¼šå‘ç”Ÿ:</h3><ol>
<li>ä¸ä¼šå› ä¸º<code>notify()</code>è€Œé‡Šæ”¾æ‰<code>object monitor</code>, è€Œæ˜¯ç»§ç»­å¾€ä¸‹æ‰§è¡Œä»£ç .</li>
<li>JVMä»<code>wait set</code>ä¸­å¯»æ‰¾ä¸€ä¸ªçº¿ç¨‹, ç§»å‡º<code>wait set</code>, å¹¶æ”¾å…¥åˆ°<code>blocked set</code>ä¸­.(JVMä¼šæŒç»­ç›‘æ§<code>object monitor</code>çŠ¶æ€)</li>
</ol>
<h3 id="çº¿ç¨‹åœ¨ä¸åŒä½ç½®çš„ä¸åŒçŠ¶æ€"><a href="#çº¿ç¨‹åœ¨ä¸åŒä½ç½®çš„ä¸åŒçŠ¶æ€" class="headerlink" title="çº¿ç¨‹åœ¨ä¸åŒä½ç½®çš„ä¸åŒçŠ¶æ€"></a>çº¿ç¨‹åœ¨ä¸åŒä½ç½®çš„ä¸åŒçŠ¶æ€</h3><p>å› æ­¤å¯ä»¥æ ¹æ®çº¿ç¨‹æ‰€å¤„çš„ä½ç½®ä¸åŒ, æ¥åŒºåˆ†ä¸åŒçŠ¶æ€: </p>
<ul>
<li>åœ¨<code>wait set</code>é‡Œ: <code>WAITING</code>çŠ¶æ€</li>
<li>åœ¨<code>blocked set</code>é‡Œ: <code>BLOCKED</code>çŠ¶æ€</li>
</ul>
<p>å› æ­¤ä¹Ÿå°±ä»æ ¹æœ¬ä¸Šè§£é‡Šäº†æœ¬æ–‡å¼€å¤´çš„ç¬¬ä¸€ä¸ªé—®é¢˜ <code>é—®é¢˜1: è¿™ä¸¤ä¸ªçŠ¶æ€å…·ä½“æœ‰å•¥åŒºåˆ«?</code></p>
<h3 id="æ€»ç»“çº¿ç¨‹å¯èƒ½çš„çŠ¶æ€å˜åŒ–"><a href="#æ€»ç»“çº¿ç¨‹å¯èƒ½çš„çŠ¶æ€å˜åŒ–" class="headerlink" title="æ€»ç»“çº¿ç¨‹å¯èƒ½çš„çŠ¶æ€å˜åŒ–"></a>æ€»ç»“çº¿ç¨‹å¯èƒ½çš„çŠ¶æ€å˜åŒ–</h3><ul>
<li><code>RUNNABLE</code> -&gt; <code>block set</code>: å¡åœ¨synchronized</li>
<li><code>RUNNABLE</code> -&gt; <code>wait set</code>: å¡åœ¨synchronizedé‡Œwait</li>
<li><code>wait set</code>  -&gt; <code>block set</code>: waitä¹‹åè¢«å…¶ä»–çº¿ç¨‹è°ƒç”¨çš„notifyå”¤é†’</li>
<li><code>block set</code> -&gt; <code>wait set</code>: ä¸å­˜åœ¨è¯¥é“¾è·¯, å¯èƒ½å½“å‰çº¿ç¨‹åœ¨block set, ä½†è¢«èµ‹äºˆobject monitorä¹‹å, è‚¯å®šè¿›å…¥äº†RUNNABLEçŠ¶æ€. å¯èƒ½RUNNABLEä¹‹åä¸»åŠ¨è°ƒç”¨äº†wait, ä½†ä¹Ÿä¸æ˜¯ç›´æ¥ä»<code>blocked set</code>åˆ°<code>wait set</code></li>
<li><code>block set</code> -&gt; <code>RUNNABLE</code>: å…¶ä»–çº¿ç¨‹waitä¹‹å, è‡ªåŠ¨é‡Šæ”¾æ‰object monitor, å½“å‰çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ</li>
</ul>
<pre class="mermaid">stateDiagram
    [*] --> CREATED: new Thread
    CREATED --> RUNNABLE: Thread.start()
    RUNNABLE --> BLOCKED: synchronized()
    RUNNABLE --> WAITING: wait()
    BLOCKED --> RUNNABLE: å…¶ä»–çº¿ç¨‹wait()
    WAITING --> BLOCKED: å…¶ä»–çº¿ç¨‹è°ƒç”¨notify()
    RUNNABLE --> DESTROYED: runæ‰§è¡Œç»“æŸ, æˆ–è€…æŠ›å‡ºå¼‚å¸¸é€€å‡º
    DESTROYED --> [*]: ç»“æŸ</pre>

<h2 id="wait-x2F-notify-x2F-synchronizedå®æˆ˜"><a href="#wait-x2F-notify-x2F-synchronizedå®æˆ˜" class="headerlink" title="wait&#x2F;notify&#x2F;synchronizedå®æˆ˜"></a>wait&#x2F;notify&#x2F;synchronizedå®æˆ˜</h2><p>æ­¤æ—¶å°±å¾ˆå®¹æ˜“æ ¹æ®ä¸‰ä¸ªæ¦‚å¿µçš„æµè½¬, æ¥åˆ†æä¸‹ä¸Šæ–‡çš„ <code>å˜ä½“å†™æ³•-1</code> çš„æ‰§è¡Œæµç¨‹, ä¹Ÿå°±æ˜ç™½ä¸ºå•¥ä¹Ÿå¯ä»¥workäº†.<br>æœ¬æ–‡å°±ä¸å†èµ˜è¿°äº†.</p>
<h2 id="å˜ä½“å†™æ³•-2"><a href="#å˜ä½“å†™æ³•-2" class="headerlink" title="å˜ä½“å†™æ³•-2"></a>å˜ä½“å†™æ³•-2</h2><p>å¦‚ä¸‹ä¾‹å­ä¸­, åŸºäº<code>å˜ä½“å†™æ³•-1</code>æŠŠ<code>synchronized(lock)</code>æ”¾åœ¨<code>while(true)</code>å¤–å±‚, ä¼šæ­£å¸¸æ‰§è¡Œä¹ˆ? å¯ä»¥å…ˆè¯•ç€è‡ªå·±åˆ†æä¸‹(è¯¦ç»†åˆ†æå¦‚ä¸‹). </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// consumer</span>
<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 1. è·å–object monitor</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"consumer is waiting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3. æŠŠè‡ªå·±æ”¾åˆ°wait seté‡Œ, é‡Šæ”¾object monitor; 5. JVMæŠŠconsumerä»wait seté‡Œç§»å‡º, ç§»å…¥åˆ°block seté‡Œ; 8. JVMæŠŠconsumerä»block seté‡Œç§»å‡º, consumerè·å–object monitor</span>
        <span class="token punctuation">&#125;</span>
        lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9. é€šçŸ¥JVMæŠŠproducerä»wait seté‡Œç§»å‡º, ç§»å…¥åˆ°block seté‡Œ; consumerç»§ç»­å¾€ä¸‹æ‰§è¡Œ(ä»ç„¶ä¿æœ‰object monitor)</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start consuming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finished consuming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isEmpty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 10. consumeræ¶ˆè´¹å®Œæˆ, ç»§ç»­æ‰§è¡Œåˆ°ç¬¬3æ­¥, ä¾æ¬¡å¾ªç¯.</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// producer</span>
<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 2. æŠŠè‡ªå·±æ”¾åˆ°block seté‡Œ, ç­‰å¾…è·å–object monitor; 4. ä»block setç§»å‡º, è·å– object monitor</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"producer is waiting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            lock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7. æŠŠè‡ªå·±æ”¾åˆ°wait seté‡Œ, é‡Šæ”¾object monitor; 9. JVMæŠŠproducerä»wait seté‡Œç§»å‡º, ç§»å…¥åˆ°block seté‡Œ; 4.2 producerä»block setç§»å‡º, è·å– object monitor</span>
        <span class="token punctuation">&#125;</span>
        lock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5. é€šçŸ¥JVMæŠŠconsumerä»wait seté‡Œç§»å‡º, ç§»å…¥åˆ°block seté‡Œ; producerç»§ç»­å¾€ä¸‹æ‰§è¡Œ(ä»ç„¶ä¿æœ‰object monitor)</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start producing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isEmpty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// 6. producerå¼€å§‹ç”Ÿäº§</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finished producing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ç­”æ¡ˆæ­æ™“: æ²¡å•¥åŒºåˆ«, æ­£å¸¸æ‰§è¡Œ.</p>
</blockquote>
<h1 id="å®é™…ç”Ÿäº§åº”ç”¨"><a href="#å®é™…ç”Ÿäº§åº”ç”¨" class="headerlink" title="å®é™…ç”Ÿäº§åº”ç”¨"></a>å®é™…ç”Ÿäº§åº”ç”¨</h1><p>&#x2F;&#x2F; TODO: </p>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="WAITINGä¸TIMED-WAITINGåŒºåˆ«"><a href="#WAITINGä¸TIMED-WAITINGåŒºåˆ«" class="headerlink" title="WAITINGä¸TIMED_WAITINGåŒºåˆ«"></a>WAITINGä¸TIMED_WAITINGåŒºåˆ«</h2><h2 id="Object-wait-ä¸-Thread-sleep-çš„åŒºåˆ«"><a href="#Object-wait-ä¸-Thread-sleep-çš„åŒºåˆ«" class="headerlink" title="Object.wait() ä¸ Thread.sleep() çš„åŒºåˆ«"></a>Object.wait() ä¸ Thread.sleep() çš„åŒºåˆ«</h2><p>åˆæ˜¯é¢è¯•å¸¸é—®çš„ä¸€é“é¢˜.<br>é€šè¿‡ä¸Šè¾¹åˆ†æå¯çŸ¥</p>
<p>è¡Œä¸ºä¸ŠåŒºåˆ«: </p>
<ul>
<li>Object.wait()ä¹‹å:<ol>
<li>æŠŠå½“å‰çº¿ç¨‹ç§»åˆ°wait seté‡Œ </li>
<li>é‡Šæ”¾æ‰object monitor</li>
<li>çº¿ç¨‹æš‚åœæ‰§è¡Œ, è®©å‡ºCPUæ—¶é—´ç‰‡</li>
</ol>
</li>
<li>Thread.sleep()ä¹‹å:<ol>
<li>çº¿ç¨‹æš‚åœæ‰§è¡Œ, è®©å‡ºCPUæ—¶é—´ç‰‡; ä¸ä¼šæœ‰1, 2çš„æ“ä½œ.</li>
</ol>
</li>
</ul>
<p>ç»“æœä¸ŠåŒºåˆ«: </p>
<ul>
<li>Object.wait()ä¹‹å: çº¿ç¨‹è¿›å…¥ WAITING (on object monitor) æˆ–è€… TIMED_WAITING (on object monitor) çŠ¶æ€ </li>
<li>Thread.sleep()ä¹‹å: çº¿ç¨‹è¿›å…¥ TIMED_WAITING (sleeping) çŠ¶æ€</li>
</ul>
<h2 id="å…¶ä»–å‡ ç§æƒ…å†µ"><a href="#å…¶ä»–å‡ ç§æƒ…å†µ" class="headerlink" title="å…¶ä»–å‡ ç§æƒ…å†µ"></a>å…¶ä»–å‡ ç§æƒ…å†µ</h2><p>é™¤äº†æœ¬æ–‡, å…¶å®è¿˜ä¼šæœ‰å¤šç§æƒ…å†µä¼šå¯¼è‡´çº¿ç¨‹è¿›å…¥<code>BLOCKED</code>, <code>WAITING</code>çŠ¶æ€, å¦‚ä¸‹:<br><img data-src="https://www.baeldung.com/wp-content/uploads/2018/02/Life_cycle_of_a_Thread_in_Java.jpg"></p>
<p>ä½†æœ¬è´¨å·²ç»è®²æ¸…æ¥šäº†, å¤§å®¶å…¶å®å¯ä»¥çœ‹ä¸‹<code>Thread.join()</code>çš„æºä»£ç , åˆ†æä¸‹å½“ä¸»çº¿ç¨‹è°ƒç”¨<code>t.join()</code>ä¸<code>t.join(30000L)</code>æ—¶, ä¸»çº¿ç¨‹çš„çŠ¶æ€åº”è¯¥æ˜¯ä»€ä¹ˆ?</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">MyThread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// run()é‡Œè¾¹å°±æ˜¯</span>
    t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//    t.join();</span>
<span class="token comment">//    t.join(30000L);</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ç­”æ¡ˆ: t.join()æ—¶, ä¸»çº¿ç¨‹æ˜¯WAITING (on object monitor); t.join(30000L)æ—¶, ä¸»çº¿ç¨‹çŠ¶æ€æ˜¯TIMED_WAITING(on object monitor) </p>
</blockquote>
<p>åŸå› : æºä»£ç åˆ†æå³å¯<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202302252202526.png"></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å‡ ç‚¹æ„Ÿæƒ³: </p>
<ol>
<li>å€Ÿæ­¤æœºä¼š, è§£é‡Šäº†è‡ªå·±å†…å¿ƒä»¥æ¥çš„é•¿ä¹…çš„ç–‘æƒ‘, æ„Ÿè§‰å¾ˆé€šé€. <ol>
<li>æ ¹æœ¬åŸå› : JVM&#x2F;OSå°è£…äº†å¤ªå¤šä¸œè¥¿, ä¾‹å¦‚æœ¬æ–‡å†…å®¹, å¦‚æœä¸çŸ¥é“æœ‰ä¸Šè¾¹ä¸‰ç§ä¸œè¥¿, æ ¹æœ¬æ— æ³•under the hoodå½»åº•è§£é‡Šæ¸…æ¥šé—®é¢˜.</li>
<li>æœ€å¥½æ–¹å¼: è¿˜æ˜¯è‡ªå·±å»ç¿»æºä»£ç ; </li>
<li>å…¶æ¬¡: å°±æ˜¯çœ‹å®˜æ–¹æ‰‹å†Œ. è¿™æ¬¡å®˜æ–¹docå…¶å®è®²å¾—ä¹Ÿéå¸¸æ¸…æ™°.</li>
<li>æœ€å: å·¥ç§‘ä¸€å®šè¦å»å®è·µ, è‡ªå·±å†™ä¸€äº›å°demoæ‰“æ‰“jstackå¾ˆå¤šé—®é¢˜ä¸€ä¸‹å­å°±æ¸…æ™°äº†.</li>
</ol>
</li>
<li>é’ˆå¯¹Javaä¸­çº¿ç¨‹çŠ¶æ€åˆ‡æ¢, å¾ˆå¤šèµ„æ–™å…¶å®è®²å¾—å¹¶ä¸å¥½, è®¤è¯†éƒ½å¾ˆæµ…æ˜¾, ç”šè‡³æœ‰æå¤§çš„è¯¯å¯¼æ€§. å¤§å®¶å¼•ä»¥ä¸ºæˆ’.<br>ä¾‹å¦‚: <a href="https://www.javatpoint.com/thread-states-in-java">Thread States in Java</a> çš„çŠ¶æ€æœºå›¾, å­˜åœ¨å¦‚ä¸‹å‡ ä¸ªé—®é¢˜: <ol>
<li>åœ¨å®é™…ç”Ÿäº§ä¸­, æˆ‘ä»¬çš„jstacké‡Œ, æ°¸è¿œä¸ä¼šçœ‹åˆ°<code>RUNNING</code>çŠ¶æ€çš„çº¿ç¨‹, éƒ½æ˜¯å¤„äº<code>RUNNABLE</code>çš„. å‚è§ <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr034.html">JavaSE Spec</a></li>
<li>æ²¡æœ‰è¯¦ç»†åŒºåˆ†<code>BLOCKED</code>ä¸<code>WAITING</code>è¿™ä¸¤ç§çŠ¶æ€, è€Œè¿™ä¸¤ä¸ªçŠ¶æ€ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨jstacké‡Œå¸¸è§çš„, ä¹Ÿæ˜¯å¤§å®¶éƒ½ä¼šæœ‰ç–‘æƒ‘çš„, ä¹Ÿæ˜¯å¸Œæœ›æœ¬æ–‡ç»™å¤§å®¶é˜è¿°æ¸…æ™°çš„.</li>
</ol>
</li>
</ol>
<p>ä¾‹å¦‚: <a href="https://dzone.com/articles/difference-between-blocked-waiting-timed-waiting-e">Difference Between BLOCKED, WAITING, And TIMED_WAITING? Explained Through Real-Life Examples</a><br>    1. è™½ç„¶æ˜¯åŸºäºç”Ÿæ´»çš„æƒ…å†µè¿›è¡Œç±»æ¯”, ä½†è¿˜æ˜¯æ²¡æœ‰æ ¹æœ¬æ€§ç¬¬è§£é‡Šæ¸…æ¥šè¿™ä¸‰ç§çŠ¶æ€çš„æ ¹æœ¬åŒºåˆ«. çœ‹å®Œä»æ˜¯ä¸€å¤´é›¾æ°´.<br>    2. <strong>ä¸€å®šè¦å¯¹äºè¿™ç§ä½¿ç”¨ç±»æ¯”æ¥è§£é‡ŠæŠ€æœ¯é—®é¢˜çš„æ–‡ç« æŠ±æœ‰é«˜åº¦è­¦æƒ•</strong>. ä¾‹å¦‚æŠŠdockerç±»æ¯”é›†è£…ç®±, æŠŠHTTPåè®®ç±»æ¯”ä¿©äººè°ˆè¯ç­‰. éƒ½æ˜¯know whatçš„, ä½†know whyä¸know howçš„çŸ¥è¯†æ‰æ˜¯æˆ‘ä»¬çœŸæ­£åº”è¯¥æŒæ¡çš„.</p>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html">Java Language Specification - Chapter 17. Threads and Locks</a></li>
<li><a href="https://stackoverflow.com/questions/39927299/in-java-if-a-thread-calls-notify-before-wait-how-does-this-not-cause-the-se">SoFä¸Šä¸€ä¸ªæœ‰æ„æ€çš„wait-notifyé—®é¢˜</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>concurrent</tag>
        <tag>java</tag>
        <tag>javase</tag>
        <tag>thread</tag>
        <tag>sync</tag>
        <tag>know-why</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºJVM DNS Cacheé—®é¢˜çš„ç ”ç©¶</title>
    <url>//2023-03-04-java-jvm-dns-caching/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æŸæ¬¡jstackå‘ç°åº”ç”¨å¡åœ¨DNSè§£æä¸Š, å‘ç°åº”ç”¨ä¸ºäº†åšè´Ÿè½½å‡è¡¡, æ•…æ„å°†JVM DNS Cacheå¤±æ•ˆæ—¶é—´è®¾ç½®ä¸ºäº†0, å³æ°¸ä¸ç¼“å­˜.<br>è¿™æ‰çŸ¥é“åŸæ¥è¿˜æœ‰è¿™ä¸ªå‚æ•°. å› æ­¤å€Ÿæ­¤æœºä¼šå°±æŸ¥é˜…èµ„æ–™, è¯¦ç»†ç ”ç©¶ä¸‹.</p>
<h1 id="Java-DNSæµç¨‹"><a href="#Java-DNSæµç¨‹" class="headerlink" title="Java DNSæµç¨‹"></a>Java DNSæµç¨‹</h1><h2 id="æµç¨‹è¯¦è§£"><a href="#æµç¨‹è¯¦è§£" class="headerlink" title="æµç¨‹è¯¦è§£"></a>æµç¨‹è¯¦è§£</h2><p>å½“æˆ‘ä»¬è°ƒç”¨å¦‚ä¸‹æ–¹å¼è§£æåŸŸåæ—¶, ç»è¿‡äº†å¦‚ä¸‹æµç¨‹: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> hostname <span class="token operator">=</span> <span class="token string">"www.baidu.com"</span><span class="token punctuation">;</span>
<span class="token class-name">InetAddress</span> addr <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202303041111414.png"></p>
<p>çœ‹äº†ä¸Šå›¾, ä¼°è®¡ä¼šæœ‰å‡ ä¸ªç–‘é—®: </p>
<ol>
<li>é€šå¸¸åŸŸåä¼šå¯¹åº”å¤šä¸ªIP, ä¸ºå•¥Javaä¸­<code>InetAddress.getByName</code>è§£æåªè¿”å›ä¸€ä¸ªIP? å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„?</li>
<li>DNSå…·ä½“å®ç°æ˜¯æ€ä¹ˆåšçš„å‘¢?<br>å¸¦ç€ç–‘é—®å¾€ä¸‹çœ‹å§.</li>
</ol>
<h2 id="å…·ä½“è§£æå®ç°"><a href="#å…·ä½“è§£æå®ç°" class="headerlink" title="å…·ä½“è§£æå®ç°"></a>å…·ä½“è§£æå®ç°</h2><p>å…·ä½“è§£æå®ç°, å‚è§ä¸Šå›¾çš„<code>getaddrinfo</code>. è¯¥æ–¹æ³•æ˜¯POSIXåè®®çš„æ ‡å‡†, ç”±å„ä¸ªæ“ä½œç³»ç»Ÿæ¥å®ç°.<br><a href="https://jvns.ca/blog/2022/02/23/getaddrinfo-is-kind-of-weird/">è¯¦ç»†ç‚¹æ­¤</a></p>
<p>getaddrinfo is part of a library called libc which is the standard C library.<br>There are at least 3 versions of libc:</p>
<ul>
<li>glibc (GNU libc)</li>
<li>musl libc</li>
<li>the Mac OS version of libc (I donâ€™t know if this has a name)</li>
</ul>
<p>çœŸæ­£çš„å®ç°å°±æ›´å¤šå•¦. æœ‰äº›åœ¨ <code>getaddrinfo</code> é‡Œæœ‰ç¼“å­˜, æœ‰äº›æ²¡æœ‰, è¿™ç‚¹è¦ä¾æ®è‡ªå·±çš„å¹³å°æ³¨æ„ç ”ç©¶.<br>ä¹‹æ‰€ä»¥æˆ‘ä»¬è®¾ç½®, æ˜¯å› ä¸ºçº¿ä¸Šä½¿ç”¨äº†è‡ªç ”çš„dnsClient, ç›¸å½“äºé‡å†™äº†<code>getaddrinfo</code>, æ˜¯æ²¡æœ‰ç¼“å­˜çš„. å› æ­¤JVMè®¾ç½®ç¼“å­˜æœª0ä¹Ÿå°±èƒ½ç”Ÿæ•ˆ.  </p>
<h2 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h2><p>æ³¨æ„ä¸Šå›¾ä¸­, â€œin cache?â€ ä»£è¡¨çš„æ˜¯åŸŸåå¯¹åº”çš„IPæ˜¯å¦å·²ç»åœ¨JVMçš„ç¼“å­˜ä¸­äº†.<br>æ—¢ç„¶æ¶‰åŠåˆ°ç¼“å­˜, å°±å¿…ç„¶æ¶‰åŠåˆ°å¤±æ•ˆæ—¶é—´çš„é—®é¢˜. å› æ­¤JVMæä¾›äº†å¦‚ä¸‹2ä¸ªå‚æ•°:</p>
<ul>
<li>networkaddress.cache.ttl (default: -1): ä»£è¡¨DNSè§£ææˆåŠŸæ—¶, hostName-&gt;ip çš„ç¼“å­˜å¤±æ•ˆæ—¶é—´. é»˜è®¤-1ä»£è¡¨æ°¸ä¸å¤±æ•ˆ. </li>
<li>networkaddress.cache.negative.ttl (default: 10): ä»£è¡¨DNSè§£æå¤±è´¥æ—¶, hostName-&gt;ç©ºç¼“å­˜ çš„å¤±æ•ˆæ—¶é—´. é»˜è®¤ä¸º10s. å°±æ˜¯ä¸ºäº†åšç©ºæŸ¥è¯¢ä¿æŠ¤.</li>
</ul>
<h2 id="å¦‚ä½•è®¾ç½®ä¸Šè¿°å‚æ•°"><a href="#å¦‚ä½•è®¾ç½®ä¸Šè¿°å‚æ•°" class="headerlink" title="å¦‚ä½•è®¾ç½®ä¸Šè¿°å‚æ•°"></a>å¦‚ä½•è®¾ç½®ä¸Šè¿°å‚æ•°</h2><h3 id="æ–¹æ¡ˆ1-JVMå¯åŠ¨å‚æ•°"><a href="#æ–¹æ¡ˆ1-JVMå¯åŠ¨å‚æ•°" class="headerlink" title="æ–¹æ¡ˆ1: JVMå¯åŠ¨å‚æ•°"></a>æ–¹æ¡ˆ1: JVMå¯åŠ¨å‚æ•°</h3><p>åœ¨åº”ç”¨å¯åŠ¨æ—¶, è®¾ç½®å¯åŠ¨å‚æ•°:<br><code>-Dsun.net.inetaddr.ttl=0 -Dsun.net.inetaddr.negative.ttl=0</code></p>
<h3 id="æ–¹æ¡ˆ2-åº”ç”¨å¯åŠ¨åè®¾ç½®å˜é‡"><a href="#æ–¹æ¡ˆ2-åº”ç”¨å¯åŠ¨åè®¾ç½®å˜é‡" class="headerlink" title="æ–¹æ¡ˆ2: åº”ç”¨å¯åŠ¨åè®¾ç½®å˜é‡"></a>æ–¹æ¡ˆ2: åº”ç”¨å¯åŠ¨åè®¾ç½®å˜é‡</h3><p>åœ¨åº”ç”¨å¯åŠ¨å, è®¾ç½®å‚æ•°: (æ³¨æ„å‚æ•°åä¸å¯åŠ¨å‚æ•°åç§°ä¸åŒ)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span>Security</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"networkaddress.cache.ttl"</span> <span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span>Security</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"networkaddress.cache.negative.ttl"</span> <span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="æ–¹æ¡ˆ3-è®¾ç½®JVMé…ç½®"><a href="#æ–¹æ¡ˆ3-è®¾ç½®JVMé…ç½®" class="headerlink" title="æ–¹æ¡ˆ3: è®¾ç½®JVMé…ç½®"></a>æ–¹æ¡ˆ3: è®¾ç½®JVMé…ç½®</h3><p>ç¼–è¾‘<code>$JRE_HOME/lib/security/java.security</code> æ–‡ä»¶, å¢åŠ å¦‚ä¸‹é…ç½®: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">networkaddress<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>ttl <span class="token operator">=</span> <span class="token number">0</span>
networkaddress<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>negative<span class="token punctuation">.</span>ttl <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h1 id="é—®é¢˜é‡ç°"><a href="#é—®é¢˜é‡ç°" class="headerlink" title="é—®é¢˜é‡ç°"></a>é—®é¢˜é‡ç°</h1><p>ä¸ºäº†æ¨¡æ‹Ÿé‡ç°å½“æ—¶ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µ, è®¾ç½®æŸä¸ªä¸å­˜åœ¨çš„åŸŸå, è¿™æ ·è§£æéœ€è¦èŠ±æ—¶é—´. </p>
<ul>
<li><a href="https://github.com/DavyJones2010/test-core/blob/master/src/test/java/edu/xmu/test/dns/DnsCachingTest.java">æµ‹è¯•ä»£ç </a></li>
</ul>
<h2 id="ä¸ç¦ç”¨negative"><a href="#ä¸ç¦ç”¨negative" class="headerlink" title="ä¸ç¦ç”¨negative"></a>ä¸ç¦ç”¨negative</h2><p>å‘ç°å¤§éƒ¨åˆ†çº¿ç¨‹å¡åœ¨è®¿é—®DNSç¼“å­˜ä¸Š, è¾¾ä¸åˆ°é‡ç°çš„æ•ˆæœ:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202303041108536.png"></p>
<h2 id="ç¦ç”¨negative"><a href="#ç¦ç”¨negative" class="headerlink" title="ç¦ç”¨negative"></a>ç¦ç”¨negative</h2><p>è¿™ä¸‹å°±é‡ç°çš„å½“æ—¶çš„æƒ…å†µ, å¤§éƒ¨åˆ†çº¿ç¨‹éƒ½å¡åœ¨çœŸæ­£è§£æåŸŸåä¸Š(æˆ–è€…å«<code>getaddrinfo</code>ç³»ç»Ÿè°ƒç”¨ä¸Š):<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202303041147157.png"></p>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="å…³äºJava-DNSè§£æå®ç°çš„åæ§½"><a href="#å…³äºJava-DNSè§£æå®ç°çš„åæ§½" class="headerlink" title="å…³äºJava DNSè§£æå®ç°çš„åæ§½"></a>å…³äºJava DNSè§£æå®ç°çš„åæ§½</h2><p>å…³äºJavaåŸŸåè§£æé—®é¢˜, å³<code>InetAddress.getByName()</code>å®ç°, å‘ç°äº†å¾ˆæœ‰è¶£çš„ä¸€ç¯‡å°æ–‡:<br><a href="https://blog.bmarwell.de/2020/09/23/javas-dns-resolution-is-so-90ies.html">Javaâ€™s DNS resolution is so 90ies! Javaçš„DNSè§£æå®ç°ä»ç„¶åœç•™åœ¨90å¹´ä»£!</a></p>
<h3 id="å­˜åœ¨3ä¸ªé—®é¢˜"><a href="#å­˜åœ¨3ä¸ªé—®é¢˜" class="headerlink" title="å­˜åœ¨3ä¸ªé—®é¢˜"></a>å­˜åœ¨3ä¸ªé—®é¢˜</h3><ol>
<li>é¦–å…ˆ, è™½ç„¶DNSä¼šè¿”å›å¤šä¸ªIP, ä½†<code>InetAddress.getByName()</code>åªä¼šè¿”å›ç¬¬ä¸€ä¸ªIP. </li>
<li>å…¶æ¬¡, è¿”å›çš„IPå¹¶ä¸”ä¸ä¼šä¿è¯è¿™ä¸ªIPèƒ½ä¸èƒ½è¿é€š.</li>
<li>æœ€å, <code>InetAddress</code> æ‰€æœ‰å®ç°æ–¹æ³•éƒ½æ˜¯<code>non-public</code>çš„, å¯¼è‡´æ‰©å±•&#x2F;ä¿®å¤æä¸ºå›°éš¾!<blockquote>
<p>Wow, that is remarkably simple! How do we know that this IP will be reachable? Well, we do not! If there are more IPs in the answer section, they are just being ignored.</p>
</blockquote>
</li>
</ol>
<h3 id="ä½œè€…çš„è§£å†³æ–¹æ¡ˆ"><a href="#ä½œè€…çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä½œè€…çš„è§£å†³æ–¹æ¡ˆ"></a>ä½œè€…çš„è§£å†³æ–¹æ¡ˆ</h3><ol>
<li>é€šè¿‡JavaAgentè§£å†³äº†<code>InetAddress</code>éš¾ä»¥æ‰©å±•çš„é—®é¢˜</li>
<li>é€šè¿‡ç±»ä¼¼pythonä¸­çš„æ–¹æ¡ˆ, DNSè·å–åˆ°IpListä¹‹å, ä¼šå°è¯•è¿æ¥ip 3æ¬¡(timeout 100ms), ç›´åˆ°è·å–å¯ä»¥è¿é€šçš„ip, å†è¿”å›.</li>
<li>è¯¦ç»†ä»£ç å‚è§: [bmarwell&#x2F;nameserviceagent]<a href="https://github.com/bmarwell/nameserviceagent">https://github.com/bmarwell/nameserviceagent</a><br>æˆ‘å°±å–œæ¬¢è¿™ç§èƒ½å–·èƒ½å¹²çš„å®å¹²å®¶:)</li>
</ol>
<h2 id="å…³äºé…ç½®JVM-DNSç¼“å­˜ç”Ÿæ•ˆæƒ…å†µé—®é¢˜"><a href="#å…³äºé…ç½®JVM-DNSç¼“å­˜ç”Ÿæ•ˆæƒ…å†µé—®é¢˜" class="headerlink" title="å…³äºé…ç½®JVM DNSç¼“å­˜ç”Ÿæ•ˆæƒ…å†µé—®é¢˜"></a>å…³äºé…ç½®JVM DNSç¼“å­˜ç”Ÿæ•ˆæƒ…å†µé—®é¢˜</h2><ol>
<li><p>å®é™…åœ¨Macä¸Šè®¾ç½®JVM DNSç¼“å­˜éƒ½ä¸º0, å‘ç°å¹¶ä¸ç”Ÿæ•ˆ. ä¾‹å¦‚<code>www.baidu.com</code>å…¶å®è¿”å›äº†2ä¸ªIP, ä½†æµ‹è¯•ä»£ç ä¸€ç›´è¿”å›1ä¸ª.<br>è¿™æ˜¯ç”±äº Mac OS has DNS caching, å³æŠŠä¸Šè¿° <code>getaddrinfo</code> çš„ç³»ç»Ÿè°ƒç”¨ä¹Ÿè¿›è¡Œäº†ç¼“å­˜. </p>
</li>
<li><p>è€ŒLinuxä¸Š <code>getaddrinfo</code> ä¸ä¸€å®šä¼šæœ‰ç¼“å­˜, é™¤éä½¿ç”¨<code>systemd-resolved</code>ç­‰å·¥å…·</p>
<blockquote>
<p>Linux doesnâ€™t necessarily unless you use systemd-resolved or something</p>
</blockquote>
</li>
</ol>
<p>æ‰€ä»¥åœ¨é…ç½®JVM DNSå‚æ•°å‰, ä¹Ÿè¯·åŠ¡å¿…ç¡®è®¤å¥½è‡ªå·±çš„OSç¯å¢ƒä»¥åŠå„è‡ªå®ç°.</p>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://maheshsenniappan.medium.com/host-name-resolution-in-java-80301fea465a">Host name resolution in Java</a></li>
<li><a href="https://stackoverflow.com/questions/1256556/how-to-make-java-honor-the-dns-caching-timeout">How to make Java honor the DNS Caching Timeout?</a></li>
<li><a href="https://jvns.ca/blog/2022/02/23/getaddrinfo-is-kind-of-weird/">Some things about getaddrinfo that surprised me</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>dns</tag>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title>revealjsåˆ¶ä½œPPTç¬”è®°</title>
    <url>//2023-03-05-head-first-revealjs/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘åœ¨Bç«™å­¦ä¹ è’‹ç‚å²©è€å¸ˆçš„OS: </p>
<ul>
<li>å†…å®¹è‡ªæ˜¯ä¸å¿…å¤šè¯´, å¹²è´§æ»¡æ»¡.</li>
<li>å¯¹è¯¾ä»¶PPTæ›´æ˜¯ååˆ†æ¬£èµ. </li>
<li><a href="https://jyywiki.cn/OS/2022/slides/3.slides#/">å®é™…æ ·ä¾‹</a></li>
</ul>
<h2 id="ç‰¹ç‚¹1-å¯¼èˆªæ¸…æ™°"><a href="#ç‰¹ç‚¹1-å¯¼èˆªæ¸…æ™°" class="headerlink" title="ç‰¹ç‚¹1: å¯¼èˆªæ¸…æ™°"></a>ç‰¹ç‚¹1: å¯¼èˆªæ¸…æ™°</h2><p>é£æ ¼ç®€çº¦ä¸“ä¸š:</p>
<ul>
<li>æ¨ªå‘å¯¼èˆªåŒºåˆ†å¤§ç±»</li>
<li>çºµå‘å¯¼èˆªæ¥åŒºåˆ†å°ç±»</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202303052225650.png"></p>
<h2 id="ç‰¹ç‚¹2-ç®¡ç†è½»é‡"><a href="#ç‰¹ç‚¹2-ç®¡ç†è½»é‡" class="headerlink" title="ç‰¹ç‚¹2: ç®¡ç†è½»é‡"></a>ç‰¹ç‚¹2: ç®¡ç†è½»é‡</h2><ul>
<li>åŸºäºä»£ç ç”Ÿæˆä¸ç®¡ç†(æ”¯æŒMarkdown), ä¸ä½¿ç”¨ç¬¨é‡çš„Microsoft PPT. </li>
<li>å¯ä»¥ä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬ç®¡ç†(ä¾‹å¦‚showcaseä¸­æœ¬æ–‡å°±ä¼šè½¬æˆppt).</li>
</ul>
<h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><blockquote>
<p>revealjs + pandoc ç»„åˆç¥å™¨</p>
</blockquote>
<ul>
<li><a href="https://revealjs.com/markdown/">revealjs</a></li>
<li><a href="https://pandoc.org/installing.html">pandoc</a></li>
</ul>
<p>åˆšå¥½è‡ªå·±å¹³æ—¶è¦åšPPT, ä½†ä½œä¸ºç¨‹åºå‘˜, åˆååˆ†æŠµè§¦å†…å®¹ä¸æ ·å¼ä¸åˆ†ç¦»çš„æ–¹å¼, åˆ¶ä½œèµ·æ¥ä¹Ÿè€—æ—¶.<br>å€Ÿé‰´è¿™ç§æ–¹æ¡ˆ, è½»æ¾å†™å‡ºä¸“ä¸šä¸”ç®€çº¦çš„PPT.</p>
<h1 id="å®‰è£…-amp-é…ç½®"><a href="#å®‰è£…-amp-é…ç½®" class="headerlink" title="å®‰è£…&amp;é…ç½®"></a>å®‰è£…&amp;é…ç½®</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul>
<li>revealjs: <a href="https://revealjs.com/installation/#full-setup">å®‰è£…æ‰‹å†Œ</a></li>
<li>pandoc: æŠŠmarkdownè½¬æˆrevealjsçš„html, <a href="https://pandoc.org/installing.html">å®‰è£…æ‰‹å†Œ</a></li>
<li><a href="https://tailwindcss.com/">tailwind css</a>: JYYè€å¸ˆçš„, ä¸ªäººè¿˜åœ¨ç ”ç©¶ä¸­</li>
</ul>
<h2 id="revealjsä¸ªäººé…ç½®"><a href="#revealjsä¸ªäººé…ç½®" class="headerlink" title="revealjsä¸ªäººé…ç½®"></a>revealjsä¸ªäººé…ç½®</h2><ul>
<li>Enable <a href="https://revealjs.com/slide-numbers/">Slide Numbers</a></li>
<li>Disable <a href="https://revealjs.com/config/">Vertical centering of slides</a></li>
<li>Disable <a href="https://revealjs.com/config/">controlsTutorial</a></li>
</ul>
<h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><ul>
<li><p>revealjs</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é»˜è®¤8000ç«¯å£</span>
<span class="token function">npm</span> start
<span class="token comment"># æŒ‡å®š8001ç«¯å£</span>
<span class="token function">npm</span> start -- --port<span class="token operator">=</span><span class="token number">8001</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>pandoc</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># md to html. æ³¨æ„éœ€è¦è®¾ç½® --slide-level=2 å‚æ•°. ä¸€çº§æ ‡é¢˜è®¾ç½®horizontalå¤§ç±», äºŒçº§æ ‡é¢˜å†…å®¹ä¸ºverticalå­ç±». </span>
pandoc id-token-in-wf.md -o id-token-in-wf.html -t revealjs -s -V <span class="token assign-left variable">theme</span><span class="token operator">=</span>white --slide-level<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment"># æ‰€æœ‰revealjsçš„å‚æ•°, éƒ½å¯ä»¥é€šè¿‡ -V xxx=xxx æ¥è®¾ç½®</span>
pandoc id-token-in-wf.md -o id-token-in-wf.html -t revealjs -s -V <span class="token assign-left variable">theme</span><span class="token operator">=</span>white -V <span class="token assign-left variable">center</span><span class="token operator">=</span>false -V <span class="token assign-left variable">controlsTutorial</span><span class="token operator">=</span>false -V <span class="token assign-left variable">slideNumber</span><span class="token operator">=</span>true --slide-level<span class="token operator">=</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h2><ul>
<li><code>o</code> è¿›å…¥ç¼©ç•¥å›¾æ¨¡å¼.</li>
<li><code>b</code> å±è”½å½“å‰PPT</li>
<li><code>f</code> è¿›å…¥å…¨å±æ¨¡å¼</li>
<li><code>ctrl+shift+f</code>: å…¨å±€æœç´¢</li>
</ul>
<h1 id="showcase"><a href="#showcase" class="headerlink" title="showcase"></a>showcase</h1><h2 id="self-explained"><a href="#self-explained" class="headerlink" title="self-explained"></a>self-explained</h2><p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202303052309110.png"></p>
<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><h2 id="æ ·å¼ä¼˜åŒ–"><a href="#æ ·å¼ä¼˜åŒ–" class="headerlink" title="æ ·å¼ä¼˜åŒ–"></a>æ ·å¼ä¼˜åŒ–</h2><p>ä¸JYYè€å¸ˆç›¸æ¯”, é¡µé¢è¿˜æ˜¯è¿‡äºç®€é™‹</p>
<ul>
<li>Header: ç±»ä¼¼markdownçš„åˆ†éš”ç¬¦</li>
<li>Image: å›¾ç‰‡æœ‰äº›æ˜¾ç¤ºä¸å…¨â—</li>
<li>Align: å­—é»˜è®¤å±…ä¸­, éœ€è¦<font color='red'><strong>å±…å·¦</strong></font></li>
<li>Syntax Highlighting: ç°åœ¨<strong>å¤ªä¸‘</strong></li>
<li>Citation&#x2F;Quote: ä¹Ÿ<strong>å¤ªä¸‘</strong></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <categories>
        <category>å·¥ç¨‹ææ•ˆå·¥å…·</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>ppt</tag>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨è½¯ä»¶å·¥ç¨‹ä½œå›¾å·¥å…·æ±‡æ€»</title>
    <url>//2023-04-10-software-diagrams-summary/</url>
    <content><![CDATA[<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä½œä¸ºç¨‹åºå‘˜, é™¤äº†æ—¥å¸¸æ•²ä»£ç å¤–, æˆ‘ä»¬é€šå¸¸ä¹Ÿè¦èŠ±å¾ˆå¤šæ—¶é—´åœ¨ä½œå›¾ä¸Š.</p>
<ul>
<li>æ±‡æŠ¥æˆ–è€…è®¾è®¡æ–‡æ¡£ä¸­, ä¸€å›¾èƒœåƒè¨€.</li>
<li>ä½†ä¸æƒ³èŠ±è¿‡å¤šæ—¶é—´åœ¨æ¡†æ¡†çš„å¯¹é½, é¢œè‰²çš„æŒ‘é€‰, æ ·å¼çš„è°ƒæ•´, ä½œå›¾å·¥å…·çš„é€‰æ‹©ä¸Š.</li>
</ul>
<p>å› æ­¤æœ¬æ–‡ç³»ç»Ÿæ€»ç»“ä¸‹è‡ªå·±ç”¨çš„å·¥å…·ä¸æœ€ä½³å®è·µ.å¸Œæœ›å¯ä»¥<code>make our hard life a little easier</code>. </p>
<h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><ul>
<li>å¯¹å†…&#x2F;éæ­£å¼:<ul>
<li>è¯¦ç»†&#x2F;æ¦‚è¦è®¾è®¡æ–‡æ¡£</li>
<li>ä»£ç é€»è¾‘&#x2F;æ¶æ„æ¢³ç†</li>
<li>ä¸ªäººæ•°æ®åˆ†æ</li>
</ul>
</li>
<li>å¯¹å†…&#x2F;å¤–, åŠæ­£å¼:<ul>
<li>æŠ€æœ¯æ–‡ç« &#x2F;Doc&#x2F;åšå®¢</li>
</ul>
</li>
<li>å¯¹å¤–&#x2F;æ­£å¼:<ul>
<li>å‘ä¸Šæ€»ç»“æ±‡æŠ¥</li>
<li>é¡¹ç›®KO&#x2F;æ±‡æŠ¥</li>
</ul>
</li>
</ul>
<h2 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h2><ul>
<li>ä¼˜å…ˆ: codeåŒ–(diagrams-as-code), mermaid<ul>
<li>æ–¹ä¾¿gitç‰ˆæœ¬ç®¡ç†</li>
</ul>
</li>
<li>å…¶æ¬¡: draw.io &gt; yuque å¯¼å‡ºå›¾ç‰‡ç±»å‹<ul>
<li>png &gt; svg &gt; jpeg</li>
</ul>
</li>
<li>æœ€ç»ˆ: ç¾å­¦ä¸Šè¦æœ‰è¿½æ±‚, å¦‚è‰²è°ƒé£æ ¼ç»Ÿä¸€<ul>
<li>å¦‚<a href="https://cn.dubbo.apache.org/zh-cn/">Dubbo</a>ä½¿ç”¨è“ç´«è¿‡æ¸¡è‰²è°ƒ</li>
</ul>
</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102223182.png"></p>
<h2 id="å·¥å…·æ¯”è¾ƒ"><a href="#å·¥å…·æ¯”è¾ƒ" class="headerlink" title="å·¥å…·æ¯”è¾ƒ"></a>å·¥å…·æ¯”è¾ƒ</h2><table>
<thead>
<tr>
<th>åç§°</th>
<th>Diagrams As Code</th>
<th>æ˜¯å¦æ”¶è´¹(by 20230314)</th>
<th>ä¼˜åŠ¿</th>
<th>ç¼ºç‚¹</th>
<th>æ¨èä¼˜å…ˆçº§</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://mermaid.js.org/intro/">mermaid</a></td>
<td>Y</td>
<td>N</td>
<td>DAS, é¡¹ç›®æ´»è·ƒ, å®¡ç¾åœ¨çº¿</td>
<td>æ”¯æŒå›¾ç±»å‹å°‘(æœ‰æ½œåŠ›)</td>
<td><strong>é«˜</strong>: è®¾è®¡æ–‡æ¡£ä¼˜å…ˆ</td>
</tr>
<tr>
<td><a href="https://app.diagrams.net/">draw.io</a></td>
<td>N</td>
<td>N</td>
<td>å›¾ç±»å‹å…¨</td>
<td>éDAS, <font color='red'><strong>æ³¨æ„ä¿ç•™æºæ–‡ä»¶</strong></font></td>
<td><strong>é«˜</strong>: è®¾è®¡æ–‡æ¡£ä¼˜å…ˆ</td>
</tr>
<tr>
<td><a href="https://aliyuque.antfin.com/dashboard">è¯­é›€ç”»æ¿</a></td>
<td>N</td>
<td>N</td>
<td>å›¾ç±»å‹å…¨, å®¡ç¾åœ¨çº¿</td>
<td>éDAS; æ¨¡æ¿æ ·ä¾‹è¾ƒå°‘</td>
<td><strong>é«˜</strong>: è®¾è®¡æ–‡æ¡£ä¼˜å…ˆ</td>
</tr>
<tr>
<td>PPT&#x2F;WPS</td>
<td>N</td>
<td>Y</td>
<td></td>
<td></td>
<td><strong>é«˜</strong>: æ±‡æŠ¥æ–‡æ¡£ä¼˜å…ˆ</td>
</tr>
<tr>
<td>xmind</td>
<td>N</td>
<td>Y</td>
<td>æ–¹ä¾¿æ˜“ç”¨, å®¡ç¾åœ¨çº¿</td>
<td>é€‚ç”¨èŒƒå›´çª„: åªé€‚åˆç”»æ€ç»´å¯¼å›¾</td>
<td>ä¸­</td>
</tr>
<tr>
<td><a href="https://ggplot2.tidyverse.org/">ggplot2</a></td>
<td>N</td>
<td>N</td>
<td></td>
<td>é€‚ç”¨èŒƒå›´çª„: åªé€‚åˆæ•°å­¦ç»Ÿè®¡ç±»</td>
<td>ç»Ÿè®¡ç±»é«˜ä¼˜æ¨è</td>
</tr>
<tr>
<td><a href="https://www.rapidtables.com/tools/line-graph.html">Rapid Tables Line Graph Maker</a></td>
<td>N</td>
<td>N</td>
<td>åæ ‡è½´å›¾å¯ä»¥ç”¨æ•°å­—ç²¾ç¡®è¡¨ç¤º</td>
<td>é€‚ç”¨èŒƒå›´çª„: åªé€‚ç”¨åæ ‡è½´å›¾</td>
<td>æ•°å­—åæ ‡è½´ç±»é«˜ä¼˜</td>
</tr>
<tr>
<td><a href="">Aliyun ROS Visual Editor</a></td>
<td>Y</td>
<td>N</td>
<td>DAS</td>
<td>é€‚ç”¨èŒƒå›´çª„: åªé€‚ç”¨äº‘ä¸Šéƒ¨ç½²å›¾</td>
<td>äº‘ä¸Šéƒ¨ç½²ç±»é«˜ä¼˜</td>
</tr>
<tr>
<td><del><a href="https://plantuml.com/zh/">plantml</a></del></td>
<td><del>Y</del></td>
<td><del>N</del></td>
<td><del>DAS, å›¾ç±»å‹å…¨</del></td>
<td><del>è¿‡äºé™ˆæ—§, åºŸå¼ƒä¸ç”¨.</del></td>
<td><del>åºŸå¼ƒ</del></td>
</tr>
<tr>
<td><del>gliffy</del></td>
<td>N</td>
<td>Y</td>
<td><del>è½»é‡</del></td>
<td><del>åºŸå¼ƒ</del></td>
<td><del>åºŸå¼ƒ</del></td>
</tr>
<tr>
<td><del><a href="https://www.processon.com/">processon</a></del></td>
<td>N</td>
<td>Y</td>
<td><del>æ¨¡æ¿æ ·ä¾‹å¤š</del></td>
<td></td>
<td><del>åºŸå¼ƒ</del></td>
</tr>
<tr>
<td><del>staruml</del></td>
<td>N</td>
<td>Y</td>
<td></td>
<td></td>
<td><del>åºŸå¼ƒ</del></td>
</tr>
</tbody></table>
<h1 id="æ¶æ„å›¾-architecture"><a href="#æ¶æ„å›¾-architecture" class="headerlink" title="æ¶æ„å›¾(architecture)"></a>æ¶æ„å›¾(architecture)</h1><ul>
<li>ç‰¹ç‚¹: å®è§‚çš„, ä¸Šå±‚çš„</li>
<li>ä½¿ç”¨åœºæ™¯: æ±‡æŠ¥PPT</li>
<li>é¢å‘å¯¹è±¡: è€æ¿, å¤–éƒ¨</li>
</ul>
<h2 id="Landscape-Eco"><a href="#Landscape-Eco" class="headerlink" title="Landscape(Eco)"></a>Landscape(Eco)</h2><ul>
<li>åœºæ™¯: ä¸ºäº†è¯´æ˜æŸä¸ªç³»ç»Ÿçš„å…³è”ç”Ÿæ€</li>
<li>å·¥å…·: draw.io</li>
<li>Tips: å°½é‡ä½¿ç”¨Logo + ä¸è§„åˆ™å½¢çŠ¶ + å¤§ç®­å¤´</li>
<li>æ ·ä¾‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102222693.png" alt="sentinel-opensource-eco-landscape-en"></li>
</ul>
<h2 id="ä¸šåŠ¡æ¶æ„å›¾-è±†è…å—"><a href="#ä¸šåŠ¡æ¶æ„å›¾-è±†è…å—" class="headerlink" title="ä¸šåŠ¡æ¶æ„å›¾(è±†è…å—)"></a>ä¸šåŠ¡æ¶æ„å›¾(è±†è…å—)</h2><ul>
<li>åœºæ™¯: ä¸ºäº†è¯´æ˜æŸä¸ªç³»ç»Ÿä¸šåŠ¡æ¶æ„</li>
<li>å·¥å…·: draw.io &gt; è¯­é›€ç”»æ¿</li>
<li>Tips: åŒè‰², åˆ†å±‚</li>
<li>æ ·ä¾‹:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102227065.png" alt="yuque_diagram-biz-arch"></p>
<h2 id="æŠ€æœ¯æ¶æ„å›¾"><a href="#æŠ€æœ¯æ¶æ„å›¾" class="headerlink" title="æŠ€æœ¯æ¶æ„å›¾"></a>æŠ€æœ¯æ¶æ„å›¾</h2><h2 id="äº‘ä¸Šéƒ¨ç½²å›¾-Cloud-Infra"><a href="#äº‘ä¸Šéƒ¨ç½²å›¾-Cloud-Infra" class="headerlink" title="äº‘ä¸Šéƒ¨ç½²å›¾(Cloud Infra)"></a>äº‘ä¸Šéƒ¨ç½²å›¾(Cloud Infra)</h2><ul>
<li>åœºæ™¯: ä¸ºäº†è¯´æ˜æŸä¸ªç³»ç»Ÿçš„éƒ¨ç½²æ¶æ„</li>
<li>å·¥å…·: draw.io&gt; <a href="https://rosnext.console.aliyun.com/designer">rosdesigner</a> </li>
<li>Tips: <a href="https://rosnext.console.aliyun.com/designer">rosdesigner</a> å¯ä»¥ç›´æ¥å¯è§†åŒ–ç¼–è¾‘, ä¹Ÿå¯ä»¥åŸºäºå·²æœ‰å®ä¾‹ç”Ÿæˆæ‹“æ‰‘. ç¼ºç‚¹æ˜¯ä¸å¤ªç¾è§‚.</li>
<li>æ ·ä¾‹:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102229011.png"></p>
<h2 id="é€»è¾‘ç¤ºæ„å›¾-é‡è¦"><a href="#é€»è¾‘ç¤ºæ„å›¾-é‡è¦" class="headerlink" title="é€»è¾‘ç¤ºæ„å›¾(é‡è¦)"></a>é€»è¾‘ç¤ºæ„å›¾(é‡è¦)</h2><ul>
<li>åœºæ™¯: ä¸ºäº†è¯´æ˜æŸä¸ªå·¥å…·&#x2F;æµç¨‹workçš„æœºåˆ¶, å¯ç”¨äºæ±‡æŠ¥, ä¹Ÿå¯ç”¨äºæŠ€æœ¯æ–‡ç« . å±äºæœ€çµæ´»çš„ä¸€ç±».</li>
<li>å·¥å…·: è¯­é›€ç”»æ¿ &gt; draw.io &gt;&gt; mermaid(å¯ç”¨ä½†ä¸çµæ´», ä¸ç¾è§‚)</li>
<li>æ ·ä¾‹:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102341355.png"></p>
<h2 id="åæ ‡è½´å›¾-axis"><a href="#åæ ‡è½´å›¾-axis" class="headerlink" title="åæ ‡è½´å›¾(axis)"></a>åæ ‡è½´å›¾(axis)</h2><ul>
<li>åœºæ™¯: PPTæ±‡æŠ¥é‡Œ, å±äºâ€é€»è¾‘ç¤ºæ„å›¾â€çš„å­ç±».</li>
<li>å·¥å…·: <a href="https://www.rapidtables.com/tools/line-graph.html">Line graph maker</a> &gt;&gt; draw.io &gt; è¯­é›€ç”»æ¿. æš‚æ—¶æ²¡æœ‰æ•°å­—æè¿°çš„åæ ‡å›¾å·¥å…·.</li>
<li>æ ·ä¾‹:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304110029478.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102239302.png" alt="draw-axis"></p>
<h2 id="æ—¶é—´è½´å›¾-timeline"><a href="#æ—¶é—´è½´å›¾-timeline" class="headerlink" title="æ—¶é—´è½´å›¾(timeline)"></a>æ—¶é—´è½´å›¾(timeline)</h2><ul>
<li>åœºæ™¯: PPTæ±‡æŠ¥é‡Œ, å±•ç¤ºé¡¹ç›®æ•´ä½“milestone</li>
<li>å·¥å…·: è¯­é›€ç”»æ¿(å®é™…ä½¿ç”¨è„‘å›¾å®ç°) &gt; xmind &gt; mermaid(ç‰ˆæœ¬éœ€è¦å‡çº§, ä¸”ä¸å¤ªç¾è§‚)</li>
<li>sample:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102242364.png" alt="yuque-timeline"></p>
<pre class="mermaid">timeline
    title History of Social Media Platform
    2002 : LinkedIn
    2004 : Facebook
         : Google
    2005 : Youtube
    2006 : Twitter</pre>

<h1 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h1><ul>
<li>ç‰¹ç‚¹: å¾®è§‚çš„, åº•å±‚çš„</li>
<li>ä½¿ç”¨åœºæ™¯: è½¯ä»¶è®¾è®¡æ–‡æ¡£</li>
<li>é¢å‘å¯¹è±¡: å¼€å‘äººå‘˜, å†…éƒ¨äººå‘˜</li>
</ul>
<h2 id="çŠ¶æ€å›¾-State-Diagram"><a href="#çŠ¶æ€å›¾-State-Diagram" class="headerlink" title="çŠ¶æ€å›¾(State Diagram)"></a>çŠ¶æ€å›¾(State Diagram)</h2><ul>
<li>åœºæ™¯: æè¿°æŸä¸ªçŠ¶æ€æœº. ä¾‹å¦‚Javaçº¿ç¨‹, NCçŠ¶æ€, VMçŠ¶æ€ç­‰. <strong>ä¸é€‚åˆæ±‡æŠ¥</strong></li>
<li>å·¥å…·: mermaid(ä¸å¤ªç¾è§‚) &gt; è¯­é›€ç”»æ¿ &gt; draw.io</li>
<li>Sample:</li>
</ul>
<pre class="mermaid">stateDiagram-v2
      [*] --> Init
      Init --> Processing: process
      Processing --> Success
      Processing --> Failed
            Failed --> Init: reinit
            Success --> Init: reinit
            Processing --> Init: reinit
      Success --> [*]
      Failed --> [*]</pre>


<h2 id="æ—¶åºå›¾-Sequence-Diagram"><a href="#æ—¶åºå›¾-Sequence-Diagram" class="headerlink" title="æ—¶åºå›¾(Sequence Diagram)"></a>æ—¶åºå›¾(Sequence Diagram)</h2><ul>
<li>åœºæ™¯: å¤šä¸ªè§’è‰²&#x2F;ç³»ç»Ÿé—´æ¥å£äº¤äº’. ä¸æ³³é“å›¾ç›¸æ¯”, æ›´ç»†ç²’åº¦. <strong>é€‚åˆä»£ç åˆ†æ, ä¸é€‚åˆæ±‡æŠ¥</strong></li>
<li>å·¥å…·: mermaid</li>
<li>Sample:</li>
</ul>
<pre class="mermaid">sequenceDiagram
      participant Alice
      participant John
      participant Tom
      Alice->>+John: Hello John, how are you?
      John->>+Tom: Hello Tom
      Tom-->>-John: Yes
      John-->>-Alice: Great!</pre>


<h2 id="æ³³é“å›¾-BPM"><a href="#æ³³é“å›¾-BPM" class="headerlink" title="æ³³é“å›¾(BPM)"></a>æ³³é“å›¾(BPM)</h2><ul>
<li>åœºæ™¯: å¤šä¸ªè§’è‰²&#x2F;ç³»ç»Ÿé—´äº¤äº’, æ›´å¤šåœ°é¢å‘åŠŸèƒ½. ä¸æ—¶åºå›¾ç›¸æ¯”, æ›´ç²—ç²’åº¦. <strong>é€‚åˆæ±‡æŠ¥</strong></li>
<li>å·¥å…·: draw.io</li>
<li>Tips: å¢åŠ æ¨ªå‘å®¹å™¨, å¡«å……é¢œè‰², çº¿æ®µäº¤å‰ç”¨arch</li>
<li>Sample:</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102245036.png"></p>
<h2 id="ç”˜ç‰¹å›¾-Gantt-Chart"><a href="#ç”˜ç‰¹å›¾-Gantt-Chart" class="headerlink" title="ç”˜ç‰¹å›¾(Gantt Chart)"></a>ç”˜ç‰¹å›¾(Gantt Chart)</h2><ul>
<li>åœºæ™¯: æ–¹ä¾¿ç®¡ç†é¡¹ç›®è§„åˆ’, è·Ÿè¸ªè¿›å±•</li>
<li>å·¥å…·: mermaid &gt;&gt; è¯­é›€ç”»æ¿ &gt; draw.io</li>
<li>Tips: æ¨ªå‘section</li>
<li>Sample:</li>
</ul>
<pre class="mermaid">gantt
    title ç°åº¦è®¡åˆ’
    dateFormat  YYYYMMDD
    section æµ‹è¯•ç¯å¢ƒéªŒè¯
    Alphaç­–ç•¥éªŒè¯        :a1, 20230302, 20230310
        Betaè”è°ƒéªŒè¯ 		:20230303, 20230312
    section æµ·å¤–åœ°åŸŸç°åº¦
    æ¾³æ´²      :a2, 20230310  , 14d
    å¾·å›½      :a3, 20230313 ,10d
        section å›½å†…åœ°åŸŸç°åº¦
        æ­å·			:a4, 20230316, 15d
        æ·±åœ³			:a5, 20230316, 15d
        åŒ—äº¬			:a6, 20230320, 15d
        ä¸Šæµ·			:a7, 20230320, 15d
        é’å²›			:a7, 20230320, 15d
        é¦™æ¸¯			:a8, 20230322, 15d
        å¼ åŒ—			:a9, 20230322, 15d
        ç¾è¥¿			:a10, 20230322, 15d</pre>

<h2 id="ERå›¾"><a href="#ERå›¾" class="headerlink" title="ERå›¾"></a>ERå›¾</h2><ul>
<li>åœºæ™¯: æŠ€æœ¯è®¾è®¡æ–‡æ¡£ä¸­ä½¿ç”¨, ä¸é€‚åˆæ±‡æŠ¥</li>
<li>å·¥å…·: mermaid</li>
<li>Sample:</li>
</ul>
<pre class="mermaid">erDiagram
    user_profile_define ||--o{ user_profile : defines
        user_profile_define {
            string profile_type
            string profile_attr
        }
        user_profile {
            long user_profile_id
            long uid
            string location_type
        }
    schedule_strategy ||--|{ schedule_strategy_binding : bind
    schedule_strategy_binding }|..|{ user_profile : bind
        schedule_strategy {
            long strategy_id
            string strict_expression
        }
        schedule_strategy_binding {
            string strategy_name
            string user_profile_expression
        }</pre>


<h2 id="éƒ¨ç½²å›¾-Deployment-Diagram"><a href="#éƒ¨ç½²å›¾-Deployment-Diagram" class="headerlink" title="éƒ¨ç½²å›¾(Deployment Diagram)"></a>éƒ¨ç½²å›¾(Deployment Diagram)</h2><ul>
<li>åœºæ™¯: æ–¹ä¾¿</li>
<li>å·¥å…·:</li>
<li>Sample:</li>
</ul>
<h1 id="ç»Ÿè®¡å›¾"><a href="#ç»Ÿè®¡å›¾" class="headerlink" title="ç»Ÿè®¡å›¾"></a>ç»Ÿè®¡å›¾</h1><ul>
<li>ç‰¹ç‚¹: é¢å‘æ•°å­¦ç»Ÿè®¡ç±»</li>
<li>ä½¿ç”¨åœºæ™¯: ä¸ªäººåˆ†æ, æ±‡æŠ¥PPT</li>
<li>é¢å‘å¯¹è±¡: å†…éƒ¨, å¤–éƒ¨å‡å¯</li>
<li>å·¥å…·: æ¨èä½¿ç”¨ggplot</li>
</ul>
<h2 id="é¥¼å›¾-Pie-Chart"><a href="#é¥¼å›¾-Pie-Chart" class="headerlink" title="é¥¼å›¾(Pie Chart)"></a>é¥¼å›¾(Pie Chart)</h2><ul>
<li>å·¥å…·: mermaid, ggplot2</li>
<li>ä½¿ç”¨åœºæ™¯: ç ”ç©¶æŠ¥å‘Š, æ±‡æŠ¥PPT</li>
<li>é¢å‘å¯¹è±¡: å¤–éƒ¨</li>
</ul>
<pre class="mermaid">pie title Pets adopted by volunteers
    "Dogs" : 386
    "Cats" : 85
    "Rats" : 15</pre>


<h2 id="æ•£ç‚¹å›¾-å¸¦æ‹Ÿåˆ"><a href="#æ•£ç‚¹å›¾-å¸¦æ‹Ÿåˆ" class="headerlink" title="æ•£ç‚¹å›¾(å¸¦æ‹Ÿåˆ)"></a>æ•£ç‚¹å›¾(å¸¦æ‹Ÿåˆ)</h2><ul>
<li>å·¥å…·: ggplot2</li>
<li>ä½¿ç”¨åœºæ™¯: ç ”ç©¶æŠ¥å‘Š, æ±‡æŠ¥PPT</li>
<li>é¢å‘å¯¹è±¡: å†…&#x2F;å¤–éƒ¨</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102345217.png"></p>
<h2 id="è¶‹åŠ¿å›¾"><a href="#è¶‹åŠ¿å›¾" class="headerlink" title="è¶‹åŠ¿å›¾"></a>è¶‹åŠ¿å›¾</h2><ul>
<li>å·¥å…·: ggplot2</li>
<li>ä½¿ç”¨åœºæ™¯: ç ”ç©¶æŠ¥å‘Š, æ±‡æŠ¥PPT</li>
<li>Tips: æ‹Ÿåˆ</li>
<li>é¢å‘å¯¹è±¡: å†…&#x2F;å¤–éƒ¨</li>
</ul>
<h2 id="åŒå‘æŸ±å½¢å›¾"><a href="#åŒå‘æŸ±å½¢å›¾" class="headerlink" title="åŒå‘æŸ±å½¢å›¾"></a>åŒå‘æŸ±å½¢å›¾</h2><ul>
<li>å·¥å…·: <a href="https://zhuanlan.zhihu.com/p/445273345">ggplot2</a> &gt;  <a href="https://www.bioladder.cn/web/#/pro/index">bioladder</a> <strong>å¯ä»¥åœ¨çº¿ç”Ÿæˆ, ç´§æ€¥ä½¿ç”¨éå¸¸æ–¹ä¾¿</strong></li>
<li>ä½¿ç”¨åœºæ™¯: ç ”ç©¶æŠ¥å‘Š, æ±‡æŠ¥PPT</li>
<li>é¢å‘å¯¹è±¡: å†…&#x2F;å¤–éƒ¨</li>
</ul>
<p><img data-src="https://www.jingege.wang/wp-content/uploads/2022/03/image-5.png"></p>
<h2 id="ç»Ÿè®¡ç±»å…¶ä»–å›¾"><a href="#ç»Ÿè®¡ç±»å…¶ä»–å›¾" class="headerlink" title="ç»Ÿè®¡ç±»å…¶ä»–å›¾"></a>ç»Ÿè®¡ç±»å…¶ä»–å›¾</h2><div class="note info"><p>å½“æƒ³ä¸åˆ°è¯¥ç”¨å“ªç§å›¾æ¥DataVizæ—¶, å¯ä»¥ä»<a href="https://antv-2018.alipay.com/zh-cn/vis/chart/index.html">AntV</a>é‡ŒæŒ‰ç…§åˆ†ç±»è¿›è¡Œé€‰å– </p>
</div>

<ul>
<li>åŒè½´å›¾</li>
<li>çƒ­åŠ›å›¾</li>
</ul>
<h1 id="å…¶ä»–å›¾"><a href="#å…¶ä»–å›¾" class="headerlink" title="å…¶ä»–å›¾"></a>å…¶ä»–å›¾</h1><h2 id="è„‘å›¾"><a href="#è„‘å›¾" class="headerlink" title="è„‘å›¾"></a>è„‘å›¾</h2><ul>
<li>åœºæ™¯: ä¸šåŠ¡è§„åˆ’,</li>
<li>å·¥å…·: yuque &gt; xmind &gt; mermaid(å¤ªä¸‘, ä¸”éœ€è¦é«˜ç‰ˆæœ¬)</li>
<li>Sample:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102310399.png" alt="yuque_diagram-xmind2"></li>
</ul>
<h2 id="ASCIIå›¾"><a href="#ASCIIå›¾" class="headerlink" title="ASCIIå›¾"></a>ASCIIå›¾</h2><ul>
<li>åœºæ™¯: CLI&#x2F;DocFileé‡Œæ— æ³•æ˜¾ç¤ºå›¾ç‰‡, å¯ä»¥ç”¨ASCIIå›¾</li>
<li>å·¥å…·: <a href="https://asciiflow.cn/">asciiflow</a> (ç¼ºç‚¹æ˜¯: å¢åŠ æ–‡æœ¬, ç§»åŠ¨ç­‰æ“ä½œä¸å¤ªçµæ´»)</li>
<li>Sample:</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">     +-------error---------+
     |                     |
+----v----+         +------+---+-+         +----------+
|         |         |          | |         |          |
|  init   +---------&gt; processing +-success-&gt; finished |
|         |         |          | |         |          |
+----^----+         +----------+-+         +-----+----+
     |                                           |
     |                                           |
     |                                           |
     |                                           |
     +-------------------retry-------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h1><h2 id="ä¸‰çº§å†…å®¹ä¼˜åŒ–"><a href="#ä¸‰çº§å†…å®¹ä¼˜åŒ–" class="headerlink" title="ä¸‰çº§å†…å®¹ä¼˜åŒ–"></a>ä¸‰çº§å†…å®¹ä¼˜åŒ–</h2><ul>
<li>åˆ†è¾¨ç‡ä¼˜åŒ–: PNGç¼©æ”¾400%, æå‡åˆ†è¾¨ç‡</li>
<li>å·¥å…·ç†Ÿç»ƒ: å–„ç”¨å¯¹é½</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102316078.png"></p>
<h2 id="è±†è…å—é…è‰²ä¼˜åŒ–"><a href="#è±†è…å—é…è‰²ä¼˜åŒ–" class="headerlink" title="è±†è…å—é…è‰²ä¼˜åŒ–"></a>è±†è…å—é…è‰²ä¼˜åŒ–</h2><ul>
<li>é…è‰²ä» <a href="https://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3"><del>colorbrewer2</del></a> <a href="https://www.colorgg.com/66cc66">ColorGG é¢œè‰²æ­é…</a>ä¸­é€‰æ‹©</li>
<li>å¤§åŒºåŸŸä¸å°åŒºåŸŸåŒè‰²ç³», ä¸åŒæ·±åº¦</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102330899.png"></p>
<h2 id="é…è‰²-amp-å­—ä½“-Ubuntué£æ ¼-contâ€™d"><a href="#é…è‰²-amp-å­—ä½“-Ubuntué£æ ¼-contâ€™d" class="headerlink" title="é…è‰²&amp;å­—ä½“-Ubuntué£æ ¼(contâ€™d)"></a>é…è‰²&amp;å­—ä½“-Ubuntué£æ ¼(contâ€™d)</h2><ul>
<li>é…è‰²: ä¸èƒ½ç”¨ç™½åº•, é»‘åº•(0x333333) + ç»¿å­—(0x33FF33) + äº®æµ·è“(0x2023A6) + é›è“(0x115354) + (0x481036)</li>
<li>å­—ä½“: Comic Sans MS</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102331383.png"></p>
<h2 id="é…è‰²-amp-å­—ä½“-SegmentFaulté£æ ¼"><a href="#é…è‰²-amp-å­—ä½“-SegmentFaulté£æ ¼" class="headerlink" title="é…è‰²&amp;å­—ä½“-SegmentFaulté£æ ¼"></a>é…è‰²&amp;å­—ä½“-SegmentFaulté£æ ¼</h2><ul>
<li>é…è‰²: ç™½çƒŸè‰²(0xF0F0F0) + é“¬ç»¿(0x188D5D) + è–„è·ç»¿(0x199562)  + æš—å²©è“(0xA680B8)</li>
<li>å­—ä½“: Verdanaå­—ä½“<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202304102331102.png"></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>best-practice</tag>
        <tag>software-engineering</tag>
        <tag>soft-skills</tag>
        <tag>diagrams</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ªäººä¹¦ç±ç®¡ç†å·¥ä½œæµæ€»ç»“</title>
    <url>//2023-05-09-ebook-manage/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¸ªäººæ¯”è¾ƒå–œæ¬¢çœ‹å„ç§ä¹¦(æ‚ä¹¦å±…å¤š, ğŸ˜„), æ‰‹å¤´çš„ç”µå­è®¾å¤‡ä¹Ÿå·¨å¤š(æ•°äº†ä¸‹, å±…ç„¶æœ‰9ä¸ªä¹‹å¤šğŸ¤”). ç»å¸¸å‘ç°æƒ³è¦çœ‹æŸæœ¬ä¹¦, ä½†è¿™æœ¬ä¹¦å´åœ¨å¦å¤–ä¸€ä¸ªè®¾å¤‡ä¸Š, æ²¡æœ‰åŒæ­¥è¿‡æ¥.<br>è€Œé‚£ä¸ªè®¾å¤‡å´ä¸åœ¨æ‰‹å¤´, å¦‚åŒå°¿æ€¥çš„äººæ‰¾ä¸åˆ°å°¿å£¶, ç€å®ä»¤äººæ²®ä¸§ğŸ˜­.<br>å› æ­¤é€šè¿‡æœ¬ç¯‡æ€»ç»“, å°†ä¹¦æœ¬çš„ç®¡ç†è¿›è¡Œç³»ç»Ÿçš„æ¢³ç†, å½¢æˆä¸€ä¸ªæƒ¯ä¾‹(convention), ç‰¢ç‰¢éµå¾ª, ä»¥è§£å†³ä¸Šè¾¹çš„é—®é¢˜. </p>
<div class="note warning"><p>æ•´ä½“ç­–ç•¥å°±æ˜¯ä»¥åšæœäº‘ä¸ºæ ¸å¿ƒ, ä»¥zlibä¸ºä¸»è¦çš„ä¸‹è½½æº, ä»¥epubå’Œpdfä¸ºä¸»è¦çš„æ ¼å¼, ç»Ÿä¸€è¿›è¡Œç®¡ç†. </p>
</div>

<h1 id="å°è¯´ç±»ç®¡ç†æ–¹å¼"><a href="#å°è¯´ç±»ç®¡ç†æ–¹å¼" class="headerlink" title="å°è¯´ç±»ç®¡ç†æ–¹å¼"></a>å°è¯´ç±»ç®¡ç†æ–¹å¼</h1><ul>
<li>ç‰¹ç‚¹: éæŠ€æœ¯ç±»æˆ–è€…åŠæŠ€æœ¯ç±»; æ— éœ€è®°å½•å¤ªå¤šç¬”è®°; åŸºæœ¬æ— éœ€è¿›è¡Œå®æ“; æ— éœ€åœ¨å·¥ä½œç”µè„‘ä¸­æŸ¥çœ‹.</li>
<li>é™åˆ¶: <strong>å¿…é¡»ä½¿ç”¨epubæ ¼å¼.</strong> mobiæ ¼å¼åªèƒ½åœ¨kindleä¸­çœ‹, åœ¨macä¸Š, ipadä¸Š, æ‰‹æœºä¸Š, éƒ½æ— æ³•è§£æ;</li>
<li>ç®¡ç†æµç¨‹å¦‚ä¸‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305112245705.png"></li>
</ul>
<h1 id="æŠ€æœ¯ç±»ç®¡ç†æ–¹å¼"><a href="#æŠ€æœ¯ç±»ç®¡ç†æ–¹å¼" class="headerlink" title="æŠ€æœ¯ç±»ç®¡ç†æ–¹å¼"></a>æŠ€æœ¯ç±»ç®¡ç†æ–¹å¼</h1><ul>
<li>ç‰¹ç‚¹: æŠ€æœ¯ç±»; éœ€è¦è®°å½•å¾ˆå¤šç¬”è®°; å¸¸å¸¸éœ€è¦å®æ“; éœ€è¦åœ¨å·¥ä½œç”µè„‘ä¸­æŸ¥çœ‹.</li>
<li>é™åˆ¶: é€šå¸¸éƒ½æ˜¯pdfæ ¼å¼. ä½†ç”±äºå·¥ä½œç”µè„‘æ— æ³•å®‰è£…åšæœäº‘, å› æ­¤ä¹¦ç±åªèƒ½é€šè¿‡é’‰é’‰ä¼ è¾“, ä¸”åªèƒ½å•å‘ä¼ è¾“. </li>
<li>ç®¡ç†æµç¨‹å¦‚ä¸‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305100008704.png"></li>
</ul>
<h1 id="åç»­äº‹é¡¹"><a href="#åç»­äº‹é¡¹" class="headerlink" title="åç»­äº‹é¡¹"></a>åç»­äº‹é¡¹</h1><ol>
<li>ç¬”è®°åŒæ­¥æ–¹æ¡ˆ: å½“å‰åªæ¢³ç†äº†å¦‚ä½•æŠŠä¹¦ç±åŒæ­¥åˆ°å„ä¸ªè®¾å¤‡, ä½†å®é™…ä¸Šå„ä¸ªè®¾å¤‡ä¸Šçš„ä¹Ÿè®°å½•äº†è¯¸å¤šç¬”è®°, è¿™äº›ç¬”è®°å¦‚ä½•åŒæ­¥ç®¡ç†ä¹Ÿæ˜¯ä»¤äººå¤´ç–¼. åˆæ­¥æƒ³æ³•æ˜¯é€šè¿‡<a href="https://www.notion.so/">notion</a>æ¥æ, æŠŠä¹¦å•ä¹Ÿä¸€èµ·ç»´æŠ¤èµ·æ¥, ä½†ä¹Ÿæ˜¯ä¸ªä¸å°çš„å·¥ç¨‹.</li>
<li><code>send to kindle</code>ä¸‹çº¿é£é™©: è™½ç„¶å¯ä»¥é€šè¿‡é‚®ä»¶<code>send to kindle</code>, ä½†**<a href="https://bookfere.com/post/985.html">2024 å¹´ 6 æœˆ 30 æ—¥ä¹‹åï¼Œç”¨æˆ·å°†æ— æ³•ä½¿ç”¨â€œå‘é€è‡³ Kindleâ€åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æ— æ³•å†é€šè¿‡é‚®ç®±ç­‰æ–¹å¼å°†ç”µå­ä¹¦æ¨é€åˆ° Kindleã€‚</a>** è¿˜æ˜¯è¦æƒ³å¥½è¿ç§»æ–¹æ¡ˆ.<br>æ€»ä¹‹, å…ˆè¿™æ ·å§, ä¸€ä¸ªé—®é¢˜ä¸€ä¸ªé—®é¢˜æ¥è§£å†³.</li>
<li>æ–‡ä»¶æ ¼å¼é—®é¢˜: å¾ˆå¤šåŠæŠ€æœ¯ç±»çš„ä¹¦ç±, éƒ½æ˜¯pdfæ ¼å¼, å‹æ ¹æ²¡æœ‰epub. ä½†pdfåœ¨æ‰‹æœº&amp;kindleä¸ŠæŸ¥çœ‹ç®€ç›´æ˜¯ç¾éš¾. æ²¡æƒ³å¥½å’‹è§£å†³.</li>
</ol>
<h1 id="å…¶ä»–å¤‡æ³¨"><a href="#å…¶ä»–å¤‡æ³¨" class="headerlink" title="å…¶ä»–å¤‡æ³¨"></a>å…¶ä»–å¤‡æ³¨</h1><ul>
<li><a href="https://z-lib.is/">zlib</a> æ²¡æ³•ç”¨äº†(by 2023å¹´05æœˆ11æ—¥), ç”¨ <a href="https://tool.yibook.org/">yibook</a> æ¥æ›¿ä»£å§, å¯ä»¥é€šè¿‡ç™¾åº¦ç½‘ç›˜æ¥ä¼ è¾“, é€Ÿåº¦å—–å—–åœ°.</li>
<li>zlibçš„å¦å¤–æ›¿ä»£: <a href="https://bookfere.com/ebook#ebook_1">Kindle å›¾ä¹¦èµ„æº</a></li>
<li>kindleé‚®ç®±å¤‡å¿˜:<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">KindleOasis1: davyjones2010_0312@kindle.cn
KindleOasis2: davyjones2010_0311@kindle.cn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>books</tag>
        <tag>best-practice</tag>
        <tag>soft-skills</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äº&quot;ä¸“ä¸š&quot;ä¸&quot;é è°±&quot;çš„å‡ ä¸ªæ¡ˆä¾‹ä¸æ€è€ƒ</title>
    <url>//2023-05-11-how-to-be-professional/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å¸¸å¸¸åœ¨å·¥ä½œä¸­ä¼šé‡åˆ°ä¸€äº›ä¸é è°±çš„åˆä½œä¼™ä¼´, ä¼šæ€’å…¶ä¸äº‰; ä¹Ÿç»å¸¸ä¼šå‘ç°ä¸åæ€è‡ªå·±å¾ˆå¤šåœ°æ–¹åšå¾—ä¸é è°±ä¸ä¸“ä¸š, ä¼šæ·±åˆ»åçœ.<br>å› æ­¤ç§¯ç´¯äº†ä¸€äº›æ¡ˆä¾‹ä¸å¿ƒå¾—, æœ¬æ–‡å°è¯•è¿›è¡Œä¸‹åˆ†äº«ä¸æ€»ç»“.<br>å¸Œæœ›å¤§å®¶çœ‹å®Œæœ¬æ–‡èƒ½æœ‰æ‰€æ”¶è·.  </p>
<h1 id="å‡ ä¸ªæ¡ˆä¾‹"><a href="#å‡ ä¸ªæ¡ˆä¾‹" class="headerlink" title="å‡ ä¸ªæ¡ˆä¾‹"></a>å‡ ä¸ªæ¡ˆä¾‹</h1><h2 id="ä»£ç ç‰ˆæœ¬ä¾èµ–é—®é¢˜"><a href="#ä»£ç ç‰ˆæœ¬ä¾èµ–é—®é¢˜" class="headerlink" title="ä»£ç ç‰ˆæœ¬ä¾èµ–é—®é¢˜"></a>ä»£ç ç‰ˆæœ¬ä¾èµ–é—®é¢˜</h2><p>ç”¨æˆ·åé¦ˆ<a href="">Jenkinsæ’ä»¶</a>ä¾èµ–çš„fastjsonç‰ˆæœ¬å¤ªä½, æœ‰å®‰å…¨æ¼æ´, å¸Œæœ›æˆ‘ä½œä¸ºmaintainer, èƒ½è¿›è¡Œå‡çº§ä¿®å¤.<br>é‚è®©åŒå­¦è¿›è¡Œè·Ÿè¿›ä¿®å¤: </p>
<ol>
<li>å¼€å‘åŒå­¦ç¡®è®¤å½“å‰ä¾èµ–çš„fastjsonç‰ˆæœ¬æ˜¯ä½ç‰ˆæœ¬; å‡çº§pomä¾èµ–, å‘ç‰ˆæœ¬, è·Ÿç”¨æˆ·åé¦ˆå‡çº§å®Œæˆ.</li>
<li>ç”¨æˆ·å‡çº§ç‰ˆæœ¬å, å‘ç°ä¾èµ–çš„ç‰ˆæœ¬è¿˜æ˜¯è€çš„. </li>
<li>å¼€å‘åŒå­¦å†æ¬¡ç¡®è®¤, å‘ç°æ˜¯ç”±äºéšå¼å¼•æ¥åˆ°å¦å¤–ä¸€ä¸ªæ’ä»¶, å¦å¤–æ’ä»¶ä¸­. ä¿®å¤; è·Ÿç”¨æˆ·åé¦ˆå¯ç”¨</li>
<li>ç”¨æˆ·å‡çº§ç‰ˆæœ¬å, å‘ç°ä¾èµ–çš„ç‰ˆæœ¬è¿˜æ˜¯è€çš„.</li>
<li>å¼€å‘åŒå­¦å†æ¬¡ç¡®è®¤, å‘ç°æ˜¯ç”±äºçœŸæ­£ä¾èµ–çš„æ˜¯Jenkinsæ¡†æ¶ä¸­çš„fastjson, å‡çº§Jenkinsæ¡†æ¶, ä¿®å¤, è·Ÿç”¨æˆ·åé¦ˆå¯ç”¨</li>
</ol>
<div class="note warning"><p>çœŸçš„å¯ç”¨äº†ä¹ˆ?<br>ä¸“ä¸šä¹ˆ?<br>é è°±ä¹ˆ?</p>
</div>


<h2 id="èµ„æºé¢„ç•™é—®é¢˜"><a href="#èµ„æºé¢„ç•™é—®é¢˜" class="headerlink" title="èµ„æºé¢„ç•™é—®é¢˜"></a>èµ„æºé¢„ç•™é—®é¢˜</h2><p>ç”¨æˆ·ä½¿ç”¨é¢„ç•™èµ„æºå¤±è´¥: </p>
<ol>
<li>æ’æŸ¥åå‘ç°æ˜¯é—®é¢˜A(ä»˜è´¹ç±»å‹ä¸åŒ¹é…)å¯¼è‡´, ä¿®å¤é—®é¢˜Aåè·Ÿç”¨æˆ·åé¦ˆå¯ç”¨. </li>
<li>ç”¨æˆ·å†æ¬¡å°è¯•, å‘ç°è¿˜æ˜¯ä¸è¡Œ, æ’æŸ¥åå‘ç°æ˜¯è¿˜æœ‰é—®é¢˜B(é¢„ç•™èµ„æºå°šæœªå¯ç”¨), ä¿®å¤é—®é¢˜Båè·Ÿç”¨æˆ·åé¦ˆå¯ç”¨.</li>
<li>ç”¨æˆ·å†æ¬¡ç¡®è®¤, å‘ç°è¿˜æ˜¯ä¸è¡Œ, æ’æŸ¥åå‘ç°æ˜¯è¿˜æœ‰é—®é¢˜C(ç”¨æˆ·Quotaä¸è¶³), ä¿®å¤é—®é¢˜Cåè·Ÿç”¨æˆ·åé¦ˆå¯ç”¨.</li>
</ol>
<p>åå¤å¤šè½®ä¸‹æ¥, ç”¨æˆ·å‡ ä¹å´©æºƒ, è´¨ç–‘æˆ‘ä»¬çš„ä¸“ä¸šåº¦.</p>
<div class="note warning"><p>ä¸€è¨€ä¹é¼: è¯´è§£å†³äº†, é‚£å°±æ˜¯è§£å†³äº†, å°±æ˜¯èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚çš„.</p>
</div>

<h2 id="æ•°æ®çº¿-amp-é¥æ§å™¨é—®é¢˜"><a href="#æ•°æ®çº¿-amp-é¥æ§å™¨é—®é¢˜" class="headerlink" title="æ•°æ®çº¿&amp;é¥æ§å™¨é—®é¢˜"></a>æ•°æ®çº¿&amp;é¥æ§å™¨é—®é¢˜</h2><p>æƒ³è¦ä¹°ä¸€æ ¹ä¸€æ‹–ä¸‰çš„USBæ•°æ®çº¿, æ˜¯å¦æ”¯æŒå¿«å……? æ”¯æŒåä¸º&#x2F;å°ç±³å¿«å……åè®®ä¹ˆ? æœ€å¤§æ”¯æŒå¤šå°‘ç“¦? USB2.0 or USB3.0? æœ€å¤§ä¼ è¾“é€Ÿåº¦æ˜¯å¤šå°‘? æ˜¯å¦<br>å‘ç°å–å®¶é™¤äº†ä»·æ ¼, åˆ«çš„ä¸€é—®ä¸‰ä¸çŸ¥.  </p>
<p>å®¶é‡Œçš„æœºé¡¶ç›’é¥æ§å™¨å¤±çµäº†, å‹å·æ˜¯ <code>çƒ½ç«HG689-J</code> æƒ³è¦ä¹°ä¸ªæ›¿æ¢çš„, ä½†ä¸æƒ³ä¹°è·ŸåŸæ¥ä¸€æ ·æ¬¾å¼çš„, åŸæ¥çš„å¤ªéš¾ç”¨äº†.</p>
<p>é‚ä¸Šæ·˜å®æ ¹æ®å‹å·æœç´¢<code>å¯ç”¨ä¸”å¥½ç”¨</code>çš„é¥æ§å™¨, æ ‡é¢˜ä¸Šéƒ½å†™çš„æ”¯æŒ<code>çƒ½ç«HG689-J</code>å‹å·, é—®äº†å‡ ä¸ªå–å®¶è¿›è¡Œç¡®è®¤: </p>
<ul>
<li>ä¸çŸ¥æ‰€äº‘å‹: ç†è§£ä¸äº†ç”¨æˆ·çš„è¯‰æ±‚. åå¤ç»™æˆ‘å¼ºè°ƒ: <code>äº², æ‚¨å°±ä¹°è·Ÿç°åœ¨ä¸€æ ·çš„é¥æ§å™¨å°±å¥½äº†</code>. é—®é¢˜æ˜¯ç°åœ¨è¿™ä¸ª<code>ä¸å¥½ç”¨</code>, æˆ‘å‹æ ¹ä¸æƒ³ç”¨. å¼€å¯å¤è¯»æœºæ¨¡å¼. </li>
<li>èƒ¡è¯´å…«é“å‹: äº², ä¸é€šç”¨å‘¢.</li>
<li>ä¸€é—®ä¸‰ä¸çŸ¥å‹: äº², æ‚¨ä¹°å›å»è¯•ä¸‹å§.</li>
<li>è£…è‹ä½œå“‘å‹: é—®äº†è¿™ä¸ªé—®é¢˜ä¹‹å, å‹æ ¹ä¸ç†æˆ‘.</li>
<li>é è°±å‹: èƒ½ç”¨çš„, å¯ä»¥çš„, ç›´æ¥ç”¨. ç›´æ¥æ³ªç›®, ä¹°ä¹°ä¹°!</li>
</ul>
<div class="note warning"><p>ä¸€è¨€ä¹é¼: å¯¹è‡ªå·±è´Ÿè´£çš„äº§å“è¶³å¤Ÿå¤šçš„äº†è§£, ç»™ç”¨æˆ·æœ‰æ•ˆçš„ä¿¡æ¯.</p>
</div>

<h2 id="å’–å•¡æœº-amp-ç”µè„‘ç”µæ± é—®é¢˜"><a href="#å’–å•¡æœº-amp-ç”µè„‘ç”µæ± é—®é¢˜" class="headerlink" title="å’–å•¡æœº&amp;ç”µè„‘ç”µæ± é—®é¢˜"></a>å’–å•¡æœº&amp;ç”µè„‘ç”µæ± é—®é¢˜</h2><ul>
<li>å¾·é¾™çš„å’–å•¡æœº, ç”¨è¿‡ä¸€æ®µæ—¶é—´å, æç¤ºéœ€è¦è‡ªæ´&amp;æ¸…æ´—. ä½¿ç”¨ä¸“ä¸šçš„æ¸…æ´—å‰‚, è¯¦ç»†ä¸“ä¸šæ­¥éª¤çš„æŒ‡å¯¼.</li>
<li>MacBookProç”µæ± , ä¼šæ£€æµ‹å¾ªç¯æ¬¡æ•°ä¸æŸè€—åº¦, è¶…è¿‡ä¸€å®šæ¯”ä¾‹, ä¼šæç¤ºç”¨æˆ·è¿›è¡Œæ›´æ¢. å¯ä»¥å¾ˆæ–¹ä¾¿ç‚¹å‡»é€‰æ‹©GeniusBarè¿›è¡Œé¢„çº¦ç»´ä¿®æ›´æ¢.</li>
</ul>
<div class="note warning"><ul>
<li>äº§å“è®¾è®¡å¼€å‘, ä¸æ˜¯ä¸€é”¤å­ä¹°å–, éœ€è¦è€ƒè™‘å…¨ç”Ÿå‘½å‘¨æœŸ. å”®ååŒæ ·å¾ˆé‡è¦, è¦åšé•¿ä¹…çš„ç”Ÿæ„.</li>
<li>ç‰¢éªšå¤ªç››é˜²è‚ æ–­, é£ç‰©é•¿å®œæ”¾çœ¼é‡</li>
</ul>
</div>


<h1 id="æ€»ç»“-ä¸“ä¸šä¸ä¸ä¸“ä¸šçš„è¡Œä¸ºæ¨¡å¼æ¯”è¾ƒ"><a href="#æ€»ç»“-ä¸“ä¸šä¸ä¸ä¸“ä¸šçš„è¡Œä¸ºæ¨¡å¼æ¯”è¾ƒ" class="headerlink" title="æ€»ç»“: ä¸“ä¸šä¸ä¸ä¸“ä¸šçš„è¡Œä¸ºæ¨¡å¼æ¯”è¾ƒ"></a>æ€»ç»“: ä¸“ä¸šä¸ä¸ä¸“ä¸šçš„è¡Œä¸ºæ¨¡å¼æ¯”è¾ƒ</h1><p>ä¸Šè¾¹å‡ ä¸ªé—®é¢˜, éƒ½é€éœ²å‡ºæˆ‘ä»¬çš„ä¸ä¸“ä¸š.<br>ä»¥<code>é—®é¢˜æ’æŸ¥</code>ä¸ºä¾‹è¿›è¡Œä¸‹æŠ½è±¡: </p>
<h2 id="ä¸ä¸“ä¸šçš„è¡Œä¸º"><a href="#ä¸ä¸“ä¸šçš„è¡Œä¸º" class="headerlink" title="ä¸ä¸“ä¸šçš„è¡Œä¸º"></a>ä¸ä¸“ä¸šçš„è¡Œä¸º</h2><p>å¦‚ä¸‹, æ•´ä½“Developerä¸Useræœ‰<code>2N+1</code>æ¬¡äº¤äº’: </p>
<ol>
<li>ä¿®å¤å‰: æ‰“æ‰°ç”¨æˆ·è¦æ±‚æä¾›æ›´å¤šä¿¡æ¯. </li>
<li>ä¿®å¤ä¸­: æ¶‰åŠNè½®ä¸ç”¨æˆ·æ²Ÿé€šç¡®è®¤é‡è¯•ç­‰, ç”¨æˆ·å¿…ç„¶ä¼šå¤±å»è€å¿ƒ, è´¨ç–‘æˆ‘ä»¬çš„ä¸“ä¸šåº¦.</li>
<li>ä¿®å¤å: è¿˜è¦æ‰“æ‰°ç”¨æˆ·, å’¨è¯¢æ˜¯å¦ä¿®å¤äº†é—®é¢˜; æ¯”è¿™ä¸ªæ›´å·®çš„æ˜¯, æœ‰äº›åŒå­¦æ ¹æœ¬ä¸ä¼šæœ‰è¿™ä¸€æ­¥. <code>Fire and Forget</code> å•¦.</li>
</ol>
<pre class="mermaid">sequenceDiagram
    par é—®é¢˜ç¬¬ä¸€è½®ä¿®å¤
    User->>Developer: åé¦ˆé—®é¢˜
    Developer-->>User: è¦æ±‚æä¾›æ›´å¤šä¿¡æ¯
    User->>Developer: errorInfo
    Developer->>System: ç¡®è®¤é—®é¢˜, åˆ†æåŸå› , ä¿®å¤é—®é¢˜ 
    Developer-->>User: åé¦ˆé—®é¢˜å·²ä¿®å¤
    User->>System: ç”¨æˆ·ç¡®è®¤éªŒè¯
    end
    
    par é—®é¢˜ç¬¬äºŒè½®ä¿®å¤
    User->>Developer: é—®é¢˜ä»å­˜åœ¨
    Developer-->>User: åœ¨æˆ‘è¿™å„¿æ˜¯å¥½å¥½çš„å‘€? è¦æ±‚æä¾›æ›´å¤šä¿¡æ¯
    User->>Developer: errorInfo
    Developer->>Developer: ç¡®è®¤é—®é¢˜, åˆ†æåŸå› , ä¿®å¤é—®é¢˜
    Developer-->>User: åé¦ˆé—®é¢˜å·²ä¿®å¤
    User->>System: ç”¨æˆ·ç¡®è®¤éªŒè¯
    end
    
    par é—®é¢˜ç¬¬Nè½®ä¿®å¤
    User->>Developer: é—®é¢˜ä»å­˜åœ¨
    Developer-->>User: åœ¨æˆ‘è¿™å„¿æ˜¯å¥½å¥½çš„å‘€? è¦æ±‚æä¾›æ›´å¤šä¿¡æ¯
    User->>Developer: errorInfo
    Developer->>Developer: ç¡®è®¤é—®é¢˜, åˆ†æåŸå› , ä¿®å¤é—®é¢˜
    Developer-->>User: åé¦ˆé—®é¢˜å·²ä¿®å¤
    User->>System: ç”¨æˆ·ç¡®è®¤éªŒè¯
    end
    
    Developer ->> User: é—®é¢˜æ˜¯å¦å·²ç»è§£å†³å•¦?
    User -->> Developer: ç»ˆäºè§£å†³äº†, ä½†ä½ ä»¬ä¹Ÿå¤ªä¸ä¸“ä¸š, å¤ªä¸é è°±äº†.</pre>

<h2 id="ä¸“ä¸šçš„è¡Œä¸º"><a href="#ä¸“ä¸šçš„è¡Œä¸º" class="headerlink" title="ä¸“ä¸šçš„è¡Œä¸º"></a>ä¸“ä¸šçš„è¡Œä¸º</h2><p>å¦‚ä¸‹, æ•´ä½“Developerä¸Useråªæœ‰<code>1</code>æ¬¡äº¤äº’: </p>
<ol>
<li>ä¿®å¤å‰: æ ¹æ®ç°æœ‰ä¿¡æ¯å»æ’æŸ¥é—®é¢˜, ä¸æ‰“æ‰°ç”¨æˆ·.</li>
<li>ä¿®å¤ä¸­: Nè½®åå¤ä¿®å¤, éƒ½åœ¨ç ”å‘å†…éƒ¨é—­ç¯, ä¸æ‰“æ‰°ç”¨æˆ·.</li>
<li>ä¿®å¤å: ç ”å‘è‡ªä¸»å»æ£€æŸ¥ä¹‹åç”¨æˆ·çš„è¯·æ±‚, è‡ªä¸»ç¡®è®¤é—®é¢˜ä¿®å¤æƒ…å†µ, ä¸æ‰“æ‰°ç”¨æˆ·.</li>
</ol>
<pre class="mermaid">sequenceDiagram
    User->>Developer: åé¦ˆé—®é¢˜
    
    par é—®é¢˜ç¬¬ä¸€è½®ä¿®å¤
    Developer->>System: æ ¹æ®å·²æœ‰ä¿¡æ¯è·å–æ›´å¤š
    System-->>Developer: errorInfo
    Developer->>System: ç¡®è®¤é—®é¢˜, åˆ†æåŸå› , ä¿®å¤é—®é¢˜
    Developer->>System: æ¨¡æ‹Ÿç”¨æˆ·(exactlyç›¸åŒçš„è·¯å¾„ä¸å‚æ•°), é‡ç°éªŒè¯
    System-->>Developer: é—®é¢˜ä»å­˜åœ¨
    end
    
    par é—®é¢˜ç¬¬äºŒè½®ä¿®å¤
    Developer->>System: æ ¹æ®å·²æœ‰ä¿¡æ¯è·å–æ›´å¤š
    System-->>Developer: errorInfo
    Developer->>System: ç¡®è®¤é—®é¢˜, åˆ†æåŸå› , ä¿®å¤é—®é¢˜
    Developer->>System: æ¨¡æ‹Ÿç”¨æˆ·(exactlyç›¸åŒçš„è·¯å¾„ä¸å‚æ•°), é‡ç°éªŒè¯
    System-->>Developer: é—®é¢˜ä»å­˜åœ¨
    end

    par é—®é¢˜ç¬¬Nè½®ä¿®å¤
    Developer->>System: æ ¹æ®å·²æœ‰ä¿¡æ¯è·å–æ›´å¤š
    System-->>Developer: errorInfo
    Developer->>System: ç¡®è®¤é—®é¢˜, åˆ†æåŸå› , ä¿®å¤é—®é¢˜
    Developer->>System: æ¨¡æ‹Ÿç”¨æˆ·(exactlyç›¸åŒçš„è·¯å¾„ä¸å‚æ•°), é‡ç°éªŒè¯
    System-->>Developer: é—®é¢˜å·²è§£å†³
    end
    
    Developer-->>User: åé¦ˆé—®é¢˜å·²ä¿®å¤
    User->>System: ç”¨æˆ·ç¡®è®¤éªŒè¯
    
    Developer->>System: è§‚å¯Ÿåç»­è¯·æ±‚, è‡ªä¸»ç¡®è®¤é—®é¢˜æ˜¯å¦å®Œæˆä¿®å¤.</pre>

<h1 id="æ€è€ƒ-å¦‚ä½•å˜å¾—ä¸“ä¸š"><a href="#æ€è€ƒ-å¦‚ä½•å˜å¾—ä¸“ä¸š" class="headerlink" title="æ€è€ƒ: å¦‚ä½•å˜å¾—ä¸“ä¸š?"></a>æ€è€ƒ: å¦‚ä½•å˜å¾—ä¸“ä¸š?</h1><h2 id="å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„Developer"><a href="#å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„Developer" class="headerlink" title="å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„Developer"></a>å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„Developer</h2><p>ç›®æ ‡: åšåˆ°<strong>ä¸€è¨€ä¹é¼</strong>(è·Ÿç”¨æˆ·åé¦ˆè§£å†³&#x2F;å®Œæˆ, é‚£å°±éœ€è¦ä¿è¯ç”¨æˆ·è§†è§’ä¸‹100%æ˜¯å¯ç”¨äº†, ä¸çè¯´, ä¸è¯¯å¯¼), å°‘æ‰“æ‰°ç”¨æˆ·.<br>è·¯å¾„: ç†Ÿæ‚‰è‡ªå·±çš„äº§å“.</p>
<h2 id="å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„User"><a href="#å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„User" class="headerlink" title="å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„User"></a>å¦‚ä½•åšä¸€ä¸ªåˆæ ¼çš„User</h2><p>å°½é‡æä¾›è¶³å¤Ÿå¤šçš„ä¿¡æ¯, ä¾‹å¦‚traceId, å‘ç”Ÿç¯å¢ƒ, å‘ç”Ÿæ—¶é—´ç‚¹, æ˜¯å¦å¿…ç°, å‡ºç°è·¯å¾„æ˜¯æ€æ ·çš„, ä½¿ç”¨æ–‡æœ¬è€Œéæˆªå›¾. </p>
<p>åœ¨ç³»ç»Ÿä¸å®Œå–„æ—¶, éœ€è¦åˆæ ¼çš„User. ä½†æ›´é‡è¦çš„æ˜¯<strong>Developeråœ¨è®¾è®¡ç³»ç»Ÿæ—¶è€ƒè™‘å‘¨å…¨</strong>, æŠŠé—®é¢˜æ’æŸ¥(å”®å)é“¾è·¯çº³å…¥è€ƒè™‘èŒƒå›´.<br>ä¹‹å‰è‡ªå·±åœ¨ä½œä¸ºUserå‘ä¸­é—´ä»¶å›¢é˜Ÿå’¨è¯¢&#x2F;åé¦ˆé—®é¢˜æ—¶, å‘ç°å¾ˆå¤šåŒå­¦æˆ¾æ°”å¾ˆé‡, ç»å¸¸åŸ‹æ€¨ç”¨æˆ·æ²¡æœ‰æä¾›è¶³å¤Ÿå¤šçš„ä¿¡æ¯, è®©ä»–ä»¬ä¸å¥½æ’æŸ¥.<br>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨åæ§½ç”¨æˆ·ç»™çš„ä¿¡æ¯ä¸å¤Ÿå¤šæ—¶, æ˜¯å¦å¯ä»¥æ€è€ƒä¸‹, å¦‚ä½•ä¸è‹›æ±‚ç”¨æˆ·? </p>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>ä¸ªäººå®¹æ˜“å¿½ç•¥çš„äº‹æƒ…: </p>
<ul>
<li>ç»™åˆ«äººå‘ä¸€ä¸ªæŠ¥è¡¨&#x2F;æ–‡æ¡£æ—¶, æ˜¯å¦æŠŠæƒé™ç»™ä»–ä»¬æ‰“å¼€äº†?</li>
</ul>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>â€œä¸“ä¸šâ€, â€œé è°±â€ æ˜¯éå¸¸ä¸¥è‚ƒçš„å®šä¹‰, è¦è¾¾æˆä¸æ˜“, éƒ½éœ€è¦è€—è´¹å¤§é‡çš„å¿ƒåŠ›ä¸è„‘åŠ›:  </p>
<ul>
<li>ç³»ç»Ÿ&#x2F;äº§å“è®¾è®¡æ—¶çš„æ¨æ¼”èƒ½åŠ›</li>
<li>é—®é¢˜æ’æŸ¥æ—¶çš„åˆ†æèƒ½åŠ›</li>
<li>é—®é¢˜ä¿®å¤ååå¤ç¡®è®¤, é•¿æœŸè·Ÿè¿›çš„èƒ½åŠ›</li>
</ul>
<p>å¸Œæœ›å¤§å®¶éƒ½èƒ½åšä¸€ä¸ªä¸“ä¸šä¸”é è°±çš„å¼€å‘è€…! å…±å‹‰!</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>best-practice</tag>
        <tag>soft-skills</tag>
      </tags>
  </entry>
  <entry>
    <title>draw.ioä½¿ç”¨æŠ€å·§æ€»ç»“</title>
    <url>//2023-05-15-drawio-tips/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è‡ªä»ä¸Šæ¬¡å‘å¥‹è¦å¥½å¥½å­¦ä¹ åšå›¾, åšPPT, æ•°æ®å¯è§†åŒ–ä¹‹å. è¿‘ä¸¤ä¸ªæœˆå¯¹draw.ioè¿›è¡Œäº†æ·±åº¦çš„ä½¿ç”¨.<br>å­¦ä¹ åˆ°äº†å¾ˆå¤šæŠ€å·§, ä½¿ç”¨èµ·æ¥æ›´åŠ å¾—å¿ƒåº”æ‰‹, ä¹Ÿé€æ¸å¼€å§‹äº«å—ç”»å›¾çš„è¿‡ç¨‹, åšåˆ°äº†<code>Happy diagramming!~</code><br>è¿™é‡ŒæŠŠä½¿ç”¨çš„ä¸€äº›å¿ƒå¾—æ€»ç»“ä¸‹æ¥, é˜²æ­¢ä»¥åé—å¿˜.</p>
<div class="note info"><p>draw.ioåšå¤§ç²¾æ·±, æœ¬æ–‡åªåˆ—å‡ºå½“å‰è‡ªå·±å¸¸ç”¨çš„, åç»­é€æ­¥å®Œå–„.</p>
</div>

<h1 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h1><ul>
<li><a href="https://www.drawio.com/doc/faq/shapes-delete-connections">åˆ é™¤ Shapes+Connections</a>: <code>ctrl/cmd + Delete</code></li>
<li>é€‰æ‹©æ‰€æœ‰Edges: <code>cmd+shift+e</code></li>
<li>é€‰æ‹©æ‰€æœ‰Shapes&#x2F;Vertices: <code>cmd+shift+i</code></li>
<li>Group: <code>cmd+g</code>; Ungroup: <code>cmd+shift+u</code></li>
<li>Bring to Front: <code>ctrl+shift+f</code>; Send to Back: <code>ctrl+shfit+b</code></li>
<li>CopySize: <code>option+shift+x</code>  pasteSize: <code>option+shift+v</code></li>
<li>Duplicate: <code>cmd+enter</code> or <code>cmd+d</code> â€“&gt; æ¯” cmd+c ++ cmd+v å¥½ç”¨å¤šå•¦!</li>
<li>Reset view: <code>enter</code>  â€“&gt; ä¹‹å‰ç”»å¸ƒæ‹–åŠ¨å¤ªå¤š, å¯¼è‡´å›¾å½¢ä¸¢å¤±äº†. è¿˜å¾—æ‹–åŠ¨baræ¥æ‰¾, å¾ˆéº»çƒ¦, ç”¨è¿™ä¸ªç®€ç›´ææ•ˆç¥å™¨!</li>
<li>Lock Shape: <code>cmd+l</code> â€“&gt; åœ¨å¤šä¸ªå›¾å½¢overlap, éœ€è¦å‹¾é€‰å…¶ä¸­æŸäº›çš„æ—¶å€™, å¯ä»¥å…ˆæŠŠä¸å¸Œæœ›é€‰åˆ°çš„å›¾å½¢lockä½</li>
<li>AutoReset Size: <code>cmd+shift+y</code> â€“&gt; ä¼šæŠŠshapeçš„sizeè‡ªåŠ¨è®¾ç½®ä¸ºåˆšå¥½åŒ…ä¸‹é‡Œè¾¹çš„Text</li>
</ul>
<h1 id="æŠ€å·§"><a href="#æŠ€å·§" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h1><h2 id="LineJump"><a href="#LineJump" class="headerlink" title="LineJump"></a>LineJump</h2><div class="note info"><p>çº¿æ®µäº¤å‰æ—¶, ç”¨<code>linejump</code>, æ¸…æ™°æ˜“è¯»</p>
</div>

<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305152320352.png"></p>
<h2 id="WayPoint"><a href="#WayPoint" class="headerlink" title="WayPoint"></a>WayPoint</h2><div class="note info"><p>ç®­å¤´åˆ†å‰æ—¶, ç”¨<code>waypoint</code></p>
</div>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305152325340.png"></p>
<h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><div class="note info"><p>å¤šä¸ªShapeç»„åˆæ—¶, ç”¨<code>container</code></p>
</div>


<h2 id="Floating-amp-Fixed-connectors"><a href="#Floating-amp-Fixed-connectors" class="headerlink" title="Floating &amp; Fixed connectors"></a>Floating &amp; Fixed connectors</h2><p>å‚è§: <a href="https://www.drawio.com/blog/connectors">Floating &amp; Fixed connectors</a><br><a href="https://www.youtube.com/watch?v=xM04I-WVXlE&amp;ab_channel=draw.io">https://www.youtube.com/watch?v=xM04I-WVXlE&amp;ab_channel=draw.io</a></p>
<ul>
<li>Floating connectors: è¿æ¥çº¿å‰åç”¨<code>o</code>æ ‡è®°, é»˜è®¤çš„éƒ½æ˜¯Floating connectors.</li>
<li>Fixed connectors: è¿æ¥çº¿å‰åç”¨<code>x</code>æ ‡è®°</li>
</ul>
<p><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305162239974.png"></p>
<h2 id="è°ƒæ•´å•ä¸ªå¯¹è±¡çš„å¤§å°"><a href="#è°ƒæ•´å•ä¸ªå¯¹è±¡çš„å¤§å°" class="headerlink" title="è°ƒæ•´å•ä¸ªå¯¹è±¡çš„å¤§å°"></a>è°ƒæ•´å•ä¸ªå¯¹è±¡çš„å¤§å°</h2><div class="note warning"><p>è°ƒæ•´å¤§å°æ—¶, ä¿æŒä¸­å¿ƒä¸åŠ¨, æ˜¯éå¸¸é‡è¦çš„, é˜²æ­¢ç»“æ„è¢«ç ´å. </p>
</div>

<ul>
<li><p>Hold <code>CMD</code>, ç„¶åæ‹–åŠ¨å¯¹è±¡å¤§å°, å¯ä»¥ä¿æŒå¯¹è±¡<strong>ä¸­å¿ƒä¸åŠ¨</strong>.<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305182305893.gif"></p>
</li>
<li><p>Hode <code>CMD+Shift</code>, ç„¶åæ‹–åŠ¨å¯¹è±¡å¤§å°, å¯ä»¥ä¿æŒå¯¹è±¡ä¸­å¿ƒä¸åŠ¨, ä¸”å¯¹è±¡æ¯”ä¾‹ç­‰æ¯”ç¼©æ”¾. â€“&gt; éå¸¸å¥½ç”¨!<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305182306535.gif"></p>
</li>
<li><p>Copy&amp;Paste Size, å¿«æ·é”® copySize: <code>option+shift+x</code>; pasteSize: <code>option+shift+v</code><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305190001415.png"></p>
</li>
</ul>
<h2 id="åŒæ—¶é€‰æ‹©å¤šä¸ªå¯¹è±¡"><a href="#åŒæ—¶é€‰æ‹©å¤šä¸ªå¯¹è±¡" class="headerlink" title="åŒæ—¶é€‰æ‹©å¤šä¸ªå¯¹è±¡"></a>åŒæ—¶é€‰æ‹©å¤šä¸ªå¯¹è±¡</h2><ul>
<li><p>æŒ‰ä½ <code>Option</code> ç„¶åæ‹–é€‰, åªè¦è§¦ç¢°åˆ°çš„, éƒ½ä¼šè¢«é€‰åˆ°(ä¸ç”¨æŠŠæ•´ä¸ªå¯¹è±¡éƒ½åŒ…å«è¿›å») â€“&gt; è§£æ•‘äººç±»!<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305190008608.gif"></p>
</li>
<li><p>ä½†è²Œä¼¼æœ‰çš„æ—¶å€™è¡Œä¸ºä¸ä¸€è‡´, æŒ‰ä¸‹<code>Option</code>ç„¶åæ‹–é€‰çš„è¡Œä¸ºæ˜¯é˜²æ­¢ç‚¹é€‰åˆ°å¤–éƒ¨çš„å®¹å™¨&#x2F;Shape</p>
</li>
</ul>
<h2 id="åŒæ—¶è°ƒæ•´å¤šä¸ªå¯¹è±¡çš„å¤§å°"><a href="#åŒæ—¶è°ƒæ•´å¤šä¸ªå¯¹è±¡çš„å¤§å°" class="headerlink" title="åŒæ—¶è°ƒæ•´å¤šä¸ªå¯¹è±¡çš„å¤§å°"></a>åŒæ—¶è°ƒæ•´å¤šä¸ªå¯¹è±¡çš„å¤§å°</h2><ol>
<li><p>ä½¿ç”¨åˆ†ç»„<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305172248220.gif"></p>
</li>
<li><p>å¤šé€‰, Arrangeé‡Œè°ƒæ•´<br><a href="https://webapps.stackexchange.com/questions/52230/scaling-a-group-of-shapes-in-diagramly">Scaling a group of shapes in Diagramly</a></p>
</li>
<li><p>ä½¿ç”¨å®¹å™¨<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305172256303.gif"></p>
</li>
</ol>
<div class="note warning"><p>å–„ç”¨ <strong>åˆ†ç»„</strong> ä¸ <strong>å®¹å™¨</strong></p>
</div>

<h2 id="ç§»åŠ¨å¯¹è±¡"><a href="#ç§»åŠ¨å¯¹è±¡" class="headerlink" title="ç§»åŠ¨å¯¹è±¡"></a>ç§»åŠ¨å¯¹è±¡</h2><ul>
<li>æŒ‰ä½ <code>Shift+CMD</code> ç§»åŠ¨, æŠŠå¯¹è±¡é™åˆ¶åœ¨æ°´å¹³&amp;å‚ç›´æ–¹å‘ç§»åŠ¨(å¼ºçº¦æŸ)</li>
<li>æŒ‰ä½ <code>Shift</code> ç§»åŠ¨, å¯ä»¥å°†å¯¹è±¡å°½é‡åœ¨æ°´å¹³&#x2F;å‚ç›´æ–¹å‘ç§»åŠ¨(å¼±çº¦æŸ, ç²˜æ€§)</li>
<li>é˜²æ­¢ç§»åŠ¨çš„å¯¹è±¡è¢«æ”¾å…¥åˆ°containeré‡Œ: æ‹–åŠ¨å¯¹è±¡, ç„¶åæŒ‰ä½option<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202308162219643.gif"></li>
</ul>
<h2 id="æ—‹è½¬Shapeé‡Œçš„Text"><a href="#æ—‹è½¬Shapeé‡Œçš„Text" class="headerlink" title="æ—‹è½¬Shapeé‡Œçš„Text"></a>æ—‹è½¬Shapeé‡Œçš„Text</h2><ul>
<li>ç»å¸¸ä¼šé‡åˆ°å­å›¾å½¢è¦†ç›–æ‰Parentçš„Text, å¯¼è‡´å¯è¯»æ€§å¾ˆå·®. æ­¤æ—¶å¯ä»¥æ—‹è½¬Parentçš„ Text ä½ç½®åˆ°å·¦ä¾§&#x2F;å³ä¾§, å¦‚ä¸‹æ ·ä¾‹:<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202308162232737.png"><br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202308162231340.gif"></li>
</ul>
<h2 id="å…ˆå†³å®šå¸ƒå±€-å†å†³å®šé£æ ¼"><a href="#å…ˆå†³å®šå¸ƒå±€-å†å†³å®šé£æ ¼" class="headerlink" title="å…ˆå†³å®šå¸ƒå±€, å†å†³å®šé£æ ¼"></a>å…ˆå†³å®šå¸ƒå±€, å†å†³å®šé£æ ¼</h2><p>å…ˆæŠŠå¸ƒå±€å†³å®šå¥½, ä¹‹åç»Ÿä¸€è°ƒæ•´é£æ ¼(é¢œè‰², å¤§å°, æ ·å¼)ä¼šå®¹æ˜“ä¸€äº›.</p>
<h1 id="é£æ ¼"><a href="#é£æ ¼" class="headerlink" title="é£æ ¼"></a>é£æ ¼</h1><h2 id="æ³³é“å›¾"><a href="#æ³³é“å›¾" class="headerlink" title="æ³³é“å›¾"></a>æ³³é“å›¾</h2><p>æœ€å¥½æ¯ä¸ªæ³³é“è®¾å®šèƒŒæ™¯è‰²(LaneColor), ç„¶åé‡Œè¾¹çš„å„ä¸ªTaskèƒŒæ™¯ç™½è‰², èƒ½çªå‡ºé‡ç‚¹, ç¾è§‚. å¯¹æ¯”ä¸‹: </p>
<ul>
<li><p>æœªè®¾å®šLane Color<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305190018059.png"></p>
</li>
<li><p>è®¾å®šäº†Lane Color<br><img data-src="https://davywalker-bucket.oss-cn-shanghai.aliyuncs.com/img/202305190017534.png"></p>
</li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><div class="note info"><p>draw.io<a href="https://drawio-app.com/blog/">å®˜ç½‘æ–‡æ¡£</a>æ¸…æ™°æ˜“æ‡‚, æ˜¯ä¸ªçœŸæ­£çš„å¥½äº§å“!</p>
</div>

<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>best-practice</tag>
        <tag>software-engineering</tag>
        <tag>soft-skills</tag>
        <tag>diagrams</tag>
      </tags>
  </entry>
  <entry>
    <title>K8s containerd ç­‰ç ”ç©¶</title>
    <url>//2023-05-24-k8s-container-components/</url>
    <content><![CDATA[<p>å®¹å™¨è¿è¡Œæ—¶: è¿è¡Œå’Œç®¡ç†å®¹å™¨è¿›ç¨‹ã€é•œåƒçš„å·¥å…·</p>
<h2 id="ä½å±‚è¿è¡Œæ—¶"><a href="#ä½å±‚è¿è¡Œæ—¶" class="headerlink" title="ä½å±‚è¿è¡Œæ—¶:"></a>ä½å±‚è¿è¡Œæ—¶:</h2><h3 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><ul>
<li>è´Ÿè´£ä¸å®¿ä¸»æœºæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œæ ¹æ®æŒ‡å®šçš„å®¹å™¨é•œåƒåœ¨å®¿ä¸»æœºä¸Šè¿è¡Œå®¹å™¨çš„è¿›ç¨‹ï¼Œå¹¶å¯¹å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸè¿›è¡Œç®¡ç†ã€‚</li>
<li>è€Œè¿™ä¸ªä½å±‚è¿è¡Œæ—¶ï¼Œæ­£æ˜¯è´Ÿè´£æ‰§è¡Œæˆ‘ä»¬å‰é¢è®²è§£è¿‡çš„è®¾ç½®å®¹å™¨ Namespaceã€Cgroupsç­‰åŸºç¡€æ“ä½œçš„ç»„ä»¶ã€‚</li>
</ul>
<h3 id="å®ç°åˆ†ç±»"><a href="#å®ç°åˆ†ç±»" class="headerlink" title="å®ç°åˆ†ç±»"></a>å®ç°åˆ†ç±»</h3><ul>
<li>runc: ä¼ ç»Ÿçš„è¿è¡Œæ—¶ï¼ŒåŸºäºLinux Namespaceå’ŒCgroupsæŠ€æœ¯å®ç°ï¼Œä»£è¡¨å®ç°Docker. libcontainer(Dockerå…¬å¸) â€”å¼€æºâ€“&gt; æ”¹åä¸ºrunc</li>
<li>runv: åŸºäºè™šæ‹Ÿæœºç®¡ç†ç¨‹åºçš„è¿è¡Œæ—¶ï¼Œé€šè¿‡è™šæ‹ŸåŒ– guest kernelï¼Œå°†å®¹å™¨å’Œä¸»æœºéš”ç¦»å¼€æ¥ï¼Œä½¿å¾—å…¶è¾¹ç•Œæ›´åŠ æ¸…æ™°ï¼Œä»£è¡¨å®ç°æ˜¯Kata Containerå’ŒFirecracker. ç›®å‰å·²ç»åºŸå¼ƒ, æ¨èä½¿ç”¨kata container. </li>
<li>runscï¼šrunc + safety ï¼Œé€šè¿‡æ‹¦æˆªåº”ç”¨ç¨‹åºçš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œæä¾›å®‰å…¨éš”ç¦»çš„è½»é‡çº§å®¹å™¨è¿è¡Œæ—¶æ²™ç®±ï¼Œä»£è¡¨å®ç°æ˜¯è°·æ­Œçš„gVisor</li>
</ul>
<h2 id="é«˜å±‚è¿è¡Œæ—¶"><a href="#é«˜å±‚è¿è¡Œæ—¶" class="headerlink" title="é«˜å±‚è¿è¡Œæ—¶:"></a>é«˜å±‚è¿è¡Œæ—¶:</h2><h3 id="åŠŸèƒ½-1"><a href="#åŠŸèƒ½-1" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>è´Ÿè´£é•œåƒçš„ç®¡ç†ã€è½¬åŒ–ç­‰å·¥ä½œ, ä¸ºå®¹å™¨çš„è¿è¡Œåšå‰æå‡†å¤‡</p>
<h3 id="å®ç°åˆ†ç±»-1"><a href="#å®ç°åˆ†ç±»-1" class="headerlink" title="å®ç°åˆ†ç±»"></a>å®ç°åˆ†ç±»</h3><p>ä¸»æµçš„é«˜å±‚è¿è¡Œæ—¶</p>
<ul>
<li>containerd</li>
<li>CRI-O</li>
</ul>
<p>é«˜å±‚è¿è¡Œæ—¶ä¸ä½å±‚è¿è¡Œæ—¶å„å¸å…¶èŒï¼Œå®¹å™¨è¿è¡Œæ—¶ä¸€èˆ¬</p>
<ol>
<li>å…ˆç”±é«˜å±‚è¿è¡Œæ—¶å°†å®¹å™¨é•œåƒä¸‹è½½ä¸‹æ¥ï¼Œå¹¶è§£å‹è½¬æ¢ä¸ºå®¹å™¨è¿è¡Œéœ€è¦çš„æ“ä½œç³»ç»Ÿæ–‡ä»¶</li>
<li>å†ç”±ä½å±‚è¿è¡Œæ—¶å¯åŠ¨å’Œç®¡ç†å®¹å™¨ã€‚<br><img data-src="https://pic3.zhimg.com/v2-388832b9ff6ded6f9e04e30c02078a72_r.jpg"></li>
</ol>
<h2 id="CRI"><a href="#CRI" class="headerlink" title="CRI"></a>CRI</h2><p>Kubernetesæ—©æœŸæ˜¯åˆ©ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ç®¡ç†å·¥å…·, åæ¥å¢åŠ äº†rktç­‰. éšç€è¿è¡Œæ—¶ç§ç±»çš„å¢åŠ ,<br>Kuberneteså°†å¯¹å®¹å™¨çš„æ“ä½œæŠ½è±¡ä¸ºä¸€ä¸ªæ¥å£ï¼Œå°†æ¥å£ä½œä¸ºkubeletä¸è¿è¡Œæ—¶å·¥å…·ä¹‹é—´çš„æ¡¥æ¢ï¼Œkubeleté€šè¿‡å‘é€æ¥å£è¯·æ±‚å¯¹å®¹å™¨è¿›è¡Œå¯åŠ¨å’Œç®¡ç†ï¼Œå„ä¸ªå®¹å™¨å·¥å…·é€šè¿‡å®ç°è¿™ä¸ªæ¥å£å³å¯æ¥å…¥Kubernetesã€‚<br>è¿™ä¸ªç»Ÿä¸€çš„å®¹å™¨æ“ä½œæ¥å£ï¼Œå°±æ˜¯å®¹å™¨è¿è¡Œæ—¶æ¥å£(Container Runtime Interface, CRI)ã€‚<br><img data-src="https://pic4.zhimg.com/v2-e8c76976f12a9b6552381a2dd4402887_r.jpg"></p>
<ul>
<li>kublet: æ¥æ”¶æ‹‰èµ·&#x2F;é”€æ¯å®¹å™¨çš„è¯·æ±‚, æŠŠè¯·æ±‚é€šè¿‡grpcæ–¹å¼è°ƒç”¨CRIæ¥å£, è¯·æ±‚è·¯ç”±åˆ°CRI shimä¸Š. (è€Œä¸ä¼šç›´æ¥è°ƒç”¨dockerçš„API)</li>
<li>CRI shim: ä½œä¸ºgRPCæœåŠ¡ç«¯æ¥å“åº”CRIè¯·æ±‚ï¼Œè´Ÿè´£å°†CRIè¯·æ±‚çš„å†…å®¹è½¬æ¢ä¸ºå…·ä½“çš„å®¹å™¨è¿è¡Œæ—¶APIï¼Œåœ¨kubeletå’Œè¿è¡Œæ—¶ä¹‹é—´å……å½“ç¿»è¯‘çš„è§’è‰²</li>
<li>ä»»ä½•å®¹å™¨è¿è¡Œæ—¶å¦‚æœæƒ³æ¥å…¥Kubernetesï¼Œéƒ½éœ€è¦å®ç°ä¸€ä¸ªè‡ªå·±çš„CRI shimï¼Œæ¥å®ç°CRIæ¥å£è§„èŒƒã€‚</li>
</ul>
<p>CRIæ¥å£, åŒ…å«å¦‚ä¸‹2ä¸ªæœåŠ¡: </p>
<ul>
<li><p>RuntimeService</p>
<ul>
<li>PodSandbox çš„ç®¡ç†æ¥å£ï¼š<ul>
<li>CRI è®¾è®¡çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼Œå°±æ˜¯ç¡®ä¿è¿™ä¸ªæ¥å£æœ¬èº«ï¼Œåªå…³æ³¨å®¹å™¨ï¼Œä¸å…³æ³¨ Podã€‚</li>
<li>PodSandbox æ˜¯å¯¹ Kubernete Pod çš„æŠ½è±¡ï¼Œç”¨æ¥ç»™å®¹å™¨æä¾›ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒï¼ˆæ¯”å¦‚æŒ‚è½½åˆ°ç›¸åŒçš„ CGroup ä¸‹é¢ï¼‰ï¼Œå¹¶æä¾›ç½‘ç»œç­‰å…±äº«çš„å‘½åç©ºé—´ã€‚PodSandbox é€šå¸¸å¯¹åº”åˆ°ä¸€ä¸ª Pause å®¹å™¨æˆ–è€…ä¸€å°è™šæ‹Ÿæœºï¼›</li>
</ul>
</li>
<li>Container çš„ç®¡ç†æ¥å£ï¼šåœ¨æŒ‡å®šçš„ PodSandbox ä¸­åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢å’Œåˆ é™¤å®¹å™¨ï¼›</li>
<li>Streaming APIæ¥å£: åŒ…æ‹¬ Execã€Attach å’Œ PortForward ç­‰ä¸‰ä¸ªå’Œå®¹å™¨è¿›è¡Œæ•°æ®äº¤äº’çš„æ¥å£ï¼Œè¿™ä¸‰ä¸ªæ¥å£è¿”å›çš„æ˜¯è¿è¡Œæ—¶ Streaming Server çš„ URLï¼Œè€Œä¸æ˜¯ç›´æ¥è·Ÿå®¹å™¨äº¤äº’ã€‚kubelet éœ€è¦è·Ÿå®¹å™¨é¡¹ç›®ç»´æŠ¤ä¸€ä¸ªé•¿è¿æ¥æ¥ä¼ è¾“æ•°æ®ã€‚è¿™ç§ APIï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º Streaming APIã€‚</li>
<li>çŠ¶æ€æ¥å£ï¼šåŒ…æ‹¬æŸ¥è¯¢ API ç‰ˆæœ¬å’ŒæŸ¥è¯¢è¿è¡Œæ—¶çŠ¶æ€ã€‚</li>
</ul>
</li>
<li><p>ImageService</p>
<ul>
<li>æŸ¥è¯¢é•œåƒåˆ—è¡¨</li>
<li>æ‹‰å»é•œåƒåˆ°æœ¬åœ°</li>
<li>æŸ¥è¯¢é•œåƒçŠ¶æ€</li>
<li>åˆ é™¤æœ¬åœ°é•œåƒ</li>
<li>æŸ¥è¯¢é•œåƒå ç”¨ç©ºé—´</li>
</ul>
</li>
</ul>
<h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><p>ä¸€ç›´ä»¥æ¥, æ··æ·†äº†ä¸¤ä¸ªæ¦‚å¿µ, â€œå®¹å™¨ç¼–æ’â€ ä¸ â€œé›†ç¾¤ç®¡ç†â€. é‡æ–°å›é¡¾â€æ·±å…¥å‰–æKubernetesâ€è¿™æœ¬ä¹¦, æ‰æœ‰äº†æ›´æ·±åˆ»çš„ç†è§£. </p>
<ul>
<li>å®¹å™¨ç¼–æ’: é¢å‘çš„å¯¹è±¡æ˜¯å¤šä¸ªå®¹å™¨&#x2F;åº”ç”¨ä¹‹é—´çš„ä¾èµ–å…³ç³». å…¸å‹å®ç°æ˜¯Dockerå…¬å¸æ¨å‡ºçš„Compose.</li>
<li>é›†ç¾¤ç®¡ç†: é¢å‘çš„å¯¹è±¡æ˜¯åº•å±‚çš„Host, å…¸å‹å®ç°æ˜¯Dockerå…¬å¸æ¨å‡ºçš„Swarm.</li>
</ul>
<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ul>
<li><a href="https://zhuanlan.zhihu.com/p/577765547">å®¹å™¨è¿è¡Œæ—¶</a></li>
<li><a href="https://www.alibabacloud.com/blog/cri-and-shimv2-a-new-idea-for-kubernetes-integrating-container-runtime_594783">CRI and ShimV2: A New Idea for Kubernetes Integrating Container Runtime</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/438351320">CRI shimï¼škubeletæ€ä¹ˆä¸runtimeäº¤äº’ï¼ˆä¸€ï¼‰</a></li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
  </entry>
  <entry>
    <title>Spring SPELè¯­æ³•å¸¸ç”¨æ ·ä¾‹</title>
    <url>//2023-06-28-spring-spel-sample/</url>
    <content><![CDATA[<p>å·¥ä½œä¸­ä½¿ç”¨äº†SpringCache, å› æ­¤éœ€è¦ç»å¸¸å†™cacheKeyçš„è¡¨è¾¾å¼, è€Œè¿™äº›è¡¨è¾¾å¼å°±æ˜¯<a href="https://docs.spring.io/spring-framework/docs/3.0.x/reference/expressions.html">Spring Expression Language (SpEL)</a><br>å› æ­¤åœ¨è¿™é‡Œåˆ†æäº†å‡ ç§å¸¸è§çš„SPELä½¿ç”¨æ–¹å¼, åºŸè¯ä¸å¤šè¯´, è¯¦ç»†ä»£ç æµ‹è¯•ç”¨ä¾‹å‚è§: <a href="https://github.com/DavyJones2010/test-core/blob/master/src/test/java/edu/xmu/test/framework/spring/spel/SpelTest.java">SpelTest.java Â· GitHub</a></p>
<p>ä¸Šè¿°æ ·ä¾‹, åªæ˜¯æ»¡è¶³äº†æ—¥å¸¸åŠŸèƒ½å±‚é¢çš„éœ€æ±‚, è®°å½•ä¸‹æ¥é˜²æ­¢é—å¿˜.<br>å…·ä½“æ·±å…¥çš„æ€§èƒ½ä»¥åŠèƒ½åŠ›çš„è¾¹ç•Œ, æš‚æ—¶ä¸åšè®¨è®º.</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring-cache</tag>
        <tag>spring</tag>
        <tag>spring-spel</tag>
      </tags>
  </entry>
</search>
